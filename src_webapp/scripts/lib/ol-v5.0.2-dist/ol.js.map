{"version":3,"file":"ol.js","sources":["../src/ol/util.js","../src/ol/AssertionError.js","../src/ol/CollectionEventType.js","../src/ol/ObjectEventType.js","../src/ol/obj.js","../src/ol/events.js","../src/ol/functions.js","../src/ol/Disposable.js","../src/ol/events/Event.js","../src/ol/events/EventTarget.js","../src/ol/events/EventType.js","../src/ol/Observable.js","../src/ol/Object.js","../src/ol/Collection.js","../src/ol/asserts.js","../src/ol/extent/Corner.js","../src/ol/extent/Relationship.js","../src/ol/extent.js","../src/ol/geom/flat/transform.js","../src/ol/math.js","../src/ol/geom/GeometryType.js","../src/ol/sphere.js","../src/ol/proj/Units.js","../src/ol/proj/Projection.js","../src/ol/proj/epsg3857.js","../src/ol/proj/epsg4326.js","../src/ol/proj/projections.js","../src/ol/proj/transforms.js","../src/ol/proj.js","../src/ol/transform.js","../src/ol/geom/Geometry.js","../src/ol/color.js","../src/ol/colorlike.js","../src/ol/dom.js","../src/ol/webgl.js","../src/ol/has.js","../src/ol/css.js","../src/ol/ImageState.js","../src/ol/structs/LRUCache.js","../src/ol/render/canvas.js","../src/ol/style/Image.js","../src/ol/style/RegularShape.js","../src/ol/style/Circle.js","../src/ol/style/Fill.js","../src/ol/style/Stroke.js","../src/ol/style/Style.js","../src/ol/Feature.js","../src/ol/GeolocationProperty.js","../src/ol/array.js","../src/ol/geom/GeometryLayout.js","../src/ol/geom/SimpleGeometry.js","../src/ol/geom/flat/area.js","../src/ol/geom/flat/closest.js","../src/ol/geom/flat/deflate.js","../src/ol/geom/flat/inflate.js","../src/ol/geom/flat/simplify.js","../src/ol/geom/LinearRing.js","../src/ol/geom/Point.js","../src/ol/geom/flat/contains.js","../src/ol/geom/flat/interiorpoint.js","../src/ol/geom/flat/segments.js","../src/ol/geom/flat/intersectsextent.js","../src/ol/geom/flat/reverse.js","../src/ol/geom/flat/orient.js","../src/ol/geom/Polygon.js","../src/ol/Geolocation.js","../src/ol/string.js","../src/ol/coordinate.js","../src/ol/geom/flat/interpolate.js","../src/ol/geom/flat/length.js","../src/ol/geom/LineString.js","../src/ol/geom/flat/geodesic.js","../src/ol/render/EventType.js","../src/ol/style/TextPlacement.js","../src/ol/style/Text.js","../src/ol/Graticule.js","../src/ol/ImageBase.js","../src/ol/Image.js","../src/ol/TileState.js","../src/ol/easing.js","../src/ol/Tile.js","../src/ol/ImageTile.js","../src/ol/Kinetic.js","../src/ol/MapEvent.js","../src/ol/MapBrowserEvent.js","../src/ol/MapBrowserEventType.js","../src/ol/MapBrowserPointerEvent.js","../src/ol/pointer/EventType.js","../src/ol/pointer/EventSource.js","../src/ol/pointer/MouseSource.js","../src/ol/pointer/MsSource.js","../src/ol/pointer/NativeSource.js","../src/ol/pointer/PointerEvent.js","../src/ol/pointer/TouchSource.js","../src/ol/pointer/PointerEventHandler.js","../src/ol/MapBrowserEventHandler.js","../src/ol/MapEventType.js","../src/ol/MapProperty.js","../src/ol/structs/PriorityQueue.js","../src/ol/TileQueue.js","../src/ol/tilegrid/common.js","../src/ol/centerconstraint.js","../src/ol/rotationconstraint.js","../src/ol/ViewHint.js","../src/ol/ViewProperty.js","../src/ol/View.js","../src/ol/resolutionconstraint.js","../src/ol/layer/Property.js","../src/ol/layer/Base.js","../src/ol/source/State.js","../src/ol/layer/Group.js","../src/ol/size.js","../src/ol/PluggableMap.js","../src/ol/control/Control.js","../src/ol/layer/Layer.js","../src/ol/control/Attribution.js","../src/ol/control/Rotate.js","../src/ol/control/Zoom.js","../src/ol/control/util.js","../src/ol/interaction/Property.js","../src/ol/interaction/Interaction.js","../src/ol/interaction/DoubleClickZoom.js","../src/ol/events/condition.js","../src/ol/interaction/Pointer.js","../src/ol/interaction/DragPan.js","../src/ol/interaction/DragRotate.js","../src/ol/render/Box.js","../src/ol/interaction/DragBox.js","../src/ol/interaction/DragZoom.js","../src/ol/events/KeyCode.js","../src/ol/interaction/KeyboardPan.js","../src/ol/interaction/KeyboardZoom.js","../src/ol/interaction/MouseWheelZoom.js","../src/ol/interaction/PinchRotate.js","../src/ol/interaction/PinchZoom.js","../src/ol/interaction/DragAndDrop.js","../src/ol/interaction/DragRotateAndZoom.js","../src/ol/geom/Circle.js","../src/ol/geom/MultiLineString.js","../src/ol/geom/MultiPoint.js","../src/ol/geom/flat/center.js","../src/ol/geom/MultiPolygon.js","../src/ol/LayerType.js","../src/ol/layer/VectorRenderType.js","../src/ol/layer/Vector.js","../src/ol/format/FormatType.js","../src/ol/featureloader.js","../src/ol/loadingstrategy.js","../src/ol/source/Source.js","../src/ol/source/VectorEventType.js","../node_modules/quickselect/quickselect.js","../node_modules/rbush/index.js","../src/ol/structs/RBush.js","../src/ol/source/Vector.js","../src/ol/interaction/Draw.js","../src/ol/interaction/Extent.js","../src/ol/interaction/Modify.js","../src/ol/interaction/Select.js","../src/ol/interaction/Snap.js","../src/ol/interaction/Translate.js","../src/ol/interaction.js","../src/ol/reproj/common.js","../src/ol/ImageCanvas.js","../src/ol/render/Event.js","../src/ol/render/VectorContext.js","../src/ol/render/canvas/Immediate.js","../src/ol/style/IconImageCache.js","../src/ol/renderer/Map.js","../src/ol/renderer/canvas/Map.js","../src/ol/renderer/Layer.js","../src/ol/renderer/canvas/Layer.js","../src/ol/renderer/canvas/IntermediateCanvas.js","../src/ol/renderer/canvas/ImageLayer.js","../src/ol/TileRange.js","../src/ol/renderer/canvas/TileLayer.js","../src/ol/render/ReplayGroup.js","../src/ol/render/ReplayType.js","../src/ol/geom/flat/textpath.js","../src/ol/render/canvas/Instruction.js","../src/ol/render/replay.js","../src/ol/render/canvas/Replay.js","../src/ol/render/canvas/ImageReplay.js","../src/ol/render/canvas/LineStringReplay.js","../src/ol/render/canvas/PolygonReplay.js","../src/ol/geom/flat/straightchunk.js","../src/ol/render/canvas/TextReplay.js","../src/ol/render/canvas/ReplayGroup.js","../src/ol/renderer/vector.js","../src/ol/renderer/canvas/VectorLayer.js","../src/ol/layer/VectorTileRenderType.js","../src/ol/renderer/canvas/VectorTileLayer.js","../src/ol/Map.js","../src/ol/OverlayPositioning.js","../src/ol/Overlay.js","../src/ol/VectorTile.js","../src/ol/control/FullScreen.js","../src/ol/control/OverviewMap.js","../src/ol/control/ScaleLine.js","../src/ol/control/ZoomSlider.js","../src/ol/control/ZoomToExtent.js","../src/ol/webgl/Shader.js","../src/ol/webgl/Fragment.js","../src/ol/webgl/Vertex.js","../src/ol/render/webgl/circlereplay/defaultshader.js","../src/ol/render/webgl/circlereplay/defaultshader/Locations.js","../src/ol/vec/mat4.js","../src/ol/render/webgl/Replay.js","../src/ol/render/webgl.js","../src/ol/webgl/Buffer.js","../src/ol/render/webgl/CircleReplay.js","../src/ol/render/webgl/texturereplay/defaultshader.js","../src/ol/render/webgl/texturereplay/defaultshader/Locations.js","../src/ol/webgl/ContextEventType.js","../src/ol/webgl/Context.js","../src/ol/render/webgl/TextureReplay.js","../src/ol/render/webgl/ImageReplay.js","../src/ol/geom/flat/topology.js","../src/ol/render/webgl/linestringreplay/defaultshader.js","../src/ol/render/webgl/linestringreplay/defaultshader/Locations.js","../src/ol/render/webgl/LineStringReplay.js","../src/ol/render/webgl/polygonreplay/defaultshader.js","../src/ol/render/webgl/polygonreplay/defaultshader/Locations.js","../src/ol/structs/LinkedList.js","../src/ol/render/webgl/PolygonReplay.js","../src/ol/style/Atlas.js","../src/ol/style/AtlasManager.js","../src/ol/render/webgl/TextReplay.js","../src/ol/render/webgl/ReplayGroup.js","../src/ol/render/webgl/Immediate.js","../src/ol/renderer/webgl/defaultmapshader.js","../src/ol/renderer/webgl/defaultmapshader/Locations.js","../src/ol/renderer/webgl/Layer.js","../src/ol/renderer/webgl/ImageLayer.js","../src/ol/renderer/webgl/Map.js","../src/ol/renderer/webgl/tilelayershader.js","../src/ol/renderer/webgl/tilelayershader/Locations.js","../src/ol/renderer/webgl/TileLayer.js","../src/ol/renderer/webgl/VectorLayer.js","../src/ol/WebGLMap.js","../src/ol/control/MousePosition.js","../src/ol/format/Feature.js","../src/ol/format/JSONFeature.js","../src/ol/format/EsriJSON.js","../src/ol/xml.js","../src/ol/format/XMLFeature.js","../src/ol/format/GMLBase.js","../src/ol/format/xsd.js","../src/ol/format/GML3.js","../src/ol/format/GML.js","../src/ol/format/GML2.js","../src/ol/format/GPX.js","../src/ol/geom/GeometryCollection.js","../src/ol/format/GeoJSON.js","../src/ol/format/TextFeature.js","../src/ol/format/IGC.js","../src/ol/style/IconAnchorUnits.js","../src/ol/style/IconImage.js","../src/ol/format/KML.js","../src/ol/style/IconOrigin.js","../src/ol/style/Icon.js","../node_modules/ieee754/index.js","../node_modules/pbf/index.js","../src/ol/render/Feature.js","../src/ol/format/MVT.js","../src/ol/format/OSMXML.js","../src/ol/geom/flat/flip.js","../src/ol/format/Polyline.js","../src/ol/format/TopoJSON.js","../src/ol/format/filter/Filter.js","../src/ol/format/filter/LogicalNary.js","../src/ol/format/filter/And.js","../src/ol/format/filter/Bbox.js","../src/ol/format/filter/Spatial.js","../src/ol/format/filter/Contains.js","../src/ol/format/filter/Comparison.js","../src/ol/format/filter/During.js","../src/ol/format/filter/ComparisonBinary.js","../src/ol/format/filter/EqualTo.js","../src/ol/format/filter/GreaterThan.js","../src/ol/format/filter/GreaterThanOrEqualTo.js","../src/ol/format/filter/Intersects.js","../src/ol/format/filter/IsBetween.js","../src/ol/format/filter/IsLike.js","../src/ol/format/filter/IsNull.js","../src/ol/format/filter/LessThan.js","../src/ol/format/filter/LessThanOrEqualTo.js","../src/ol/format/filter/Not.js","../src/ol/format/filter/NotEqualTo.js","../src/ol/format/filter/Or.js","../src/ol/format/filter/Within.js","../src/ol/format/filter.js","../src/ol/format/WFS.js","../src/ol/format/WKT.js","../src/ol/format/XLink.js","../src/ol/format/XML.js","../src/ol/format/WMSCapabilities.js","../src/ol/format/WMSGetFeatureInfo.js","../src/ol/format/OWS.js","../src/ol/format/WMTSCapabilities.js","../src/ol/layer/Heatmap.js","../src/ol/layer/Image.js","../src/ol/layer/TileProperty.js","../src/ol/layer/Tile.js","../src/ol/layer/VectorTile.js","../src/ol/tilecoord.js","../src/ol/tileurlfunction.js","../src/ol/net.js","../src/ol/TileCache.js","../src/ol/reproj.js","../src/ol/reproj/Triangulation.js","../src/ol/reproj/Tile.js","../src/ol/tilegrid/TileGrid.js","../src/ol/tilegrid.js","../src/ol/source/Tile.js","../src/ol/source/TileEventType.js","../src/ol/source/UrlTile.js","../src/ol/source/TileImage.js","../src/ol/source/BingMaps.js","../src/ol/source/XYZ.js","../src/ol/source/CartoDB.js","../src/ol/source/Cluster.js","../src/ol/reproj/Image.js","../src/ol/source/Image.js","../src/ol/uri.js","../src/ol/source/ImageArcGISRest.js","../src/ol/source/ImageCanvas.js","../src/ol/source/ImageMapGuide.js","../src/ol/source/ImageStatic.js","../src/ol/source/common.js","../src/ol/source/WMSServerType.js","../src/ol/source/ImageWMS.js","../src/ol/source/OSM.js","../node_modules/pixelworks/lib/util.js","../node_modules/pixelworks/lib/processor.js","../src/ol/source/Raster.js","../src/ol/source/Stamen.js","../src/ol/source/TileArcGISRest.js","../src/ol/source/TileDebug.js","../src/ol/source/TileJSON.js","../src/ol/source/TileWMS.js","../src/ol/source/UTFGrid.js","../src/ol/VectorImageTile.js","../src/ol/source/VectorTile.js","../src/ol/source/WMTSRequestEncoding.js","../src/ol/tilegrid/WMTS.js","../src/ol/source/WMTS.js","../src/ol/source/Zoomify.js","../src/index.js","../src/ol/proj/proj4.js","../src/ol/render.js"],"sourcesContent":["/**\n * @module ol/util\n */\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * Usage:\n *\n *     function ParentClass(a, b) { }\n *     ParentClass.prototype.foo = function(a) { }\n *\n *     function ChildClass(a, b, c) {\n *       // Call parent constructor\n *       ParentClass.call(this, a, b);\n *     }\n *     inherits(ChildClass, ParentClass);\n *\n *     var child = new ChildClass('a', 'b', 'see');\n *     child.foo(); // This works.\n *\n * @param {!Function} childCtor Child constructor.\n * @param {!Function} parentCtor Parent constructor.\n * @function module:ol.inherits\n * @api\n */\nexport function inherits(childCtor, parentCtor) {\n  childCtor.prototype = Object.create(parentCtor.prototype);\n  childCtor.prototype.constructor = childCtor;\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n * @private\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.ol_uid || (obj.ol_uid = ++uidCounter_);\n}\n\n/**\n * OpenLayers version.\n * @type {string}\n */\nexport const VERSION = '5.0.2';\n","/**\n * @module ol/AssertionError\n */\nimport {VERSION, inherits} from './util.js';\n\n/**\n * Error object thrown when an assertion failed. This is an ECMA-262 Error,\n * extended with a `code` property.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error}\n * @constructor\n * @extends {Error}\n * @param {number} code Error code.\n */\nconst AssertionError = function(code) {\n\n  const path = VERSION.split('-')[0];\n\n  /**\n   * @type {string}\n   */\n  this.message = 'Assertion failed. See https://openlayers.org/en/' + path +\n      '/doc/errors/#' + code + ' for details.';\n\n  /**\n   * Error code. The meaning of the code can be found on\n   * {@link https://openlayers.org/en/latest/doc/errors/} (replace `latest` with\n   * the version found in the OpenLayers script's header comment if a version\n   * other than the latest is used).\n   * @type {number}\n   * @api\n   */\n  this.code = code;\n\n  this.name = 'AssertionError';\n\n};\n\ninherits(AssertionError, Error);\n\nexport default AssertionError;\n","/**\n * @module ol/CollectionEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when an item is added to the collection.\n   * @event module:ol/Collection~CollectionEvent#add\n   * @api\n   */\n  ADD: 'add',\n  /**\n   * Triggered when an item is removed from the collection.\n   * @event module:ol/Collection~CollectionEvent#remove\n   * @api\n   */\n  REMOVE: 'remove'\n};\n","/**\n * @module ol/ObjectEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a property is changed.\n   * @event module:ol/Object~ObjectEvent#propertychange\n   * @api\n   */\n  PROPERTYCHANGE: 'propertychange'\n};\n","/**\n * @module ol/obj\n */\n\n\n/**\n * Polyfill for Object.assign().  Assigns enumerable and own properties from\n * one or more source objects to a target object.\n *\n * @see https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n * @param {!Object} target The target object.\n * @param {...Object} var_sources The source object(s).\n * @return {!Object} The modified target object.\n */\nexport const assign = (typeof Object.assign === 'function') ? Object.assign : function(target, var_sources) {\n  if (target === undefined || target === null) {\n    throw new TypeError('Cannot convert undefined or null to object');\n  }\n\n  const output = Object(target);\n  for (let i = 1, ii = arguments.length; i < ii; ++i) {\n    const source = arguments[i];\n    if (source !== undefined && source !== null) {\n      for (const key in source) {\n        if (source.hasOwnProperty(key)) {\n          output[key] = source[key];\n        }\n      }\n    }\n  }\n  return output;\n};\n\n\n/**\n * Removes all properties from an object.\n * @param {Object} object The object to clear.\n */\nexport function clear(object) {\n  for (const property in object) {\n    delete object[property];\n  }\n}\n\n\n/**\n * Get an array of property values from an object.\n * @param {Object<K,V>} object The object from which to get the values.\n * @return {!Array<V>} The property values.\n * @template K,V\n */\nexport function getValues(object) {\n  const values = [];\n  for (const property in object) {\n    values.push(object[property]);\n  }\n  return values;\n}\n\n\n/**\n * Determine if an object has any properties.\n * @param {Object} object The object to check.\n * @return {boolean} The object is empty.\n */\nexport function isEmpty(object) {\n  let property;\n  for (property in object) {\n    return false;\n  }\n  return !property;\n}\n","/**\n * @module ol/events\n */\nimport {clear} from './obj.js';\n\n\n/**\n * Key to use with {@link module:ol/Observable~Observable#unByKey}.\n * @typedef {Object} EventsKey\n * @property {Object} [bindTo]\n * @property {module:ol/events~ListenerFunction} [boundListener]\n * @property {boolean} callOnce\n * @property {number} [deleteIndex]\n * @property {module:ol/events~ListenerFunction} listener\n * @property {EventTarget|module:ol/events/EventTarget} target\n * @property {string} type\n * @api\n */\n\n\n/**\n * Listener function. This function is called with an event object as argument.\n * When the function returns `false`, event propagation will stop.\n *\n * @typedef {function(module:ol/events/Event)|function(module:ol/events/Event): boolean} ListenerFunction\n * @api\n */\n\n\n/**\n * @param {module:ol/events~EventsKey} listenerObj Listener object.\n * @return {module:ol/events~ListenerFunction} Bound listener.\n */\nexport function bindListener(listenerObj) {\n  const boundListener = function(evt) {\n    const listener = listenerObj.listener;\n    const bindTo = listenerObj.bindTo || listenerObj.target;\n    if (listenerObj.callOnce) {\n      unlistenByKey(listenerObj);\n    }\n    return listener.call(bindTo, evt);\n  };\n  listenerObj.boundListener = boundListener;\n  return boundListener;\n}\n\n\n/**\n * Finds the matching {@link module:ol/events~EventsKey} in the given listener\n * array.\n *\n * @param {!Array<!module:ol/events~EventsKey>} listeners Array of listeners.\n * @param {!Function} listener The listener function.\n * @param {Object=} opt_this The `this` value inside the listener.\n * @param {boolean=} opt_setDeleteIndex Set the deleteIndex on the matching\n *     listener, for {@link module:ol/events~unlistenByKey}.\n * @return {module:ol/events~EventsKey|undefined} The matching listener object.\n */\nexport function findListener(listeners, listener, opt_this, opt_setDeleteIndex) {\n  let listenerObj;\n  for (let i = 0, ii = listeners.length; i < ii; ++i) {\n    listenerObj = listeners[i];\n    if (listenerObj.listener === listener &&\n        listenerObj.bindTo === opt_this) {\n      if (opt_setDeleteIndex) {\n        listenerObj.deleteIndex = i;\n      }\n      return listenerObj;\n    }\n  }\n  return undefined;\n}\n\n\n/**\n * @param {module:ol/events/EventTarget~EventTargetLike} target Target.\n * @param {string} type Type.\n * @return {Array.<module:ol/events~EventsKey>|undefined} Listeners.\n */\nexport function getListeners(target, type) {\n  const listenerMap = target.ol_lm;\n  return listenerMap ? listenerMap[type] : undefined;\n}\n\n\n/**\n * Get the lookup of listeners.  If one does not exist on the target, it is\n * created.\n * @param {module:ol/events/EventTarget~EventTargetLike} target Target.\n * @return {!Object.<string, Array.<module:ol/events~EventsKey>>} Map of\n *     listeners by event type.\n */\nfunction getListenerMap(target) {\n  let listenerMap = target.ol_lm;\n  if (!listenerMap) {\n    listenerMap = target.ol_lm = {};\n  }\n  return listenerMap;\n}\n\n\n/**\n * Clean up all listener objects of the given type.  All properties on the\n * listener objects will be removed, and if no listeners remain in the listener\n * map, it will be removed from the target.\n * @param {module:ol/events/EventTarget~EventTargetLike} target Target.\n * @param {string} type Type.\n */\nfunction removeListeners(target, type) {\n  const listeners = getListeners(target, type);\n  if (listeners) {\n    for (let i = 0, ii = listeners.length; i < ii; ++i) {\n      target.removeEventListener(type, listeners[i].boundListener);\n      clear(listeners[i]);\n    }\n    listeners.length = 0;\n    const listenerMap = target.ol_lm;\n    if (listenerMap) {\n      delete listenerMap[type];\n      if (Object.keys(listenerMap).length === 0) {\n        delete target.ol_lm;\n      }\n    }\n  }\n}\n\n\n/**\n * Registers an event listener on an event target. Inspired by\n * {@link https://google.github.io/closure-library/api/source/closure/goog/events/events.js.src.html}\n *\n * This function efficiently binds a `listener` to a `this` object, and returns\n * a key for use with {@link module:ol/events~unlistenByKey}.\n *\n * @param {module:ol/events/EventTarget~EventTargetLike} target Event target.\n * @param {string} type Event type.\n * @param {module:ol/events~ListenerFunction} listener Listener.\n * @param {Object=} opt_this Object referenced by the `this` keyword in the\n *     listener. Default is the `target`.\n * @param {boolean=} opt_once If true, add the listener as one-off listener.\n * @return {module:ol/events~EventsKey} Unique key for the listener.\n */\nexport function listen(target, type, listener, opt_this, opt_once) {\n  const listenerMap = getListenerMap(target);\n  let listeners = listenerMap[type];\n  if (!listeners) {\n    listeners = listenerMap[type] = [];\n  }\n  let listenerObj = findListener(listeners, listener, opt_this, false);\n  if (listenerObj) {\n    if (!opt_once) {\n      // Turn one-off listener into a permanent one.\n      listenerObj.callOnce = false;\n    }\n  } else {\n    listenerObj = /** @type {module:ol/events~EventsKey} */ ({\n      bindTo: opt_this,\n      callOnce: !!opt_once,\n      listener: listener,\n      target: target,\n      type: type\n    });\n    target.addEventListener(type, bindListener(listenerObj));\n    listeners.push(listenerObj);\n  }\n\n  return listenerObj;\n}\n\n\n/**\n * Registers a one-off event listener on an event target. Inspired by\n * {@link https://google.github.io/closure-library/api/source/closure/goog/events/events.js.src.html}\n *\n * This function efficiently binds a `listener` as self-unregistering listener\n * to a `this` object, and returns a key for use with\n * {@link module:ol/events~unlistenByKey} in case the listener needs to be\n * unregistered before it is called.\n *\n * When {@link module:ol/events~listen} is called with the same arguments after this\n * function, the self-unregistering listener will be turned into a permanent\n * listener.\n *\n * @param {module:ol/events/EventTarget~EventTargetLike} target Event target.\n * @param {string} type Event type.\n * @param {module:ol/events~ListenerFunction} listener Listener.\n * @param {Object=} opt_this Object referenced by the `this` keyword in the\n *     listener. Default is the `target`.\n * @return {module:ol/events~EventsKey} Key for unlistenByKey.\n */\nexport function listenOnce(target, type, listener, opt_this) {\n  return listen(target, type, listener, opt_this, true);\n}\n\n\n/**\n * Unregisters an event listener on an event target. Inspired by\n * {@link https://google.github.io/closure-library/api/source/closure/goog/events/events.js.src.html}\n *\n * To return a listener, this function needs to be called with the exact same\n * arguments that were used for a previous {@link module:ol/events~listen} call.\n *\n * @param {module:ol/events/EventTarget~EventTargetLike} target Event target.\n * @param {string} type Event type.\n * @param {module:ol/events~ListenerFunction} listener Listener.\n * @param {Object=} opt_this Object referenced by the `this` keyword in the\n *     listener. Default is the `target`.\n */\nexport function unlisten(target, type, listener, opt_this) {\n  const listeners = getListeners(target, type);\n  if (listeners) {\n    const listenerObj = findListener(listeners, listener, opt_this, true);\n    if (listenerObj) {\n      unlistenByKey(listenerObj);\n    }\n  }\n}\n\n\n/**\n * Unregisters event listeners on an event target. Inspired by\n * {@link https://google.github.io/closure-library/api/source/closure/goog/events/events.js.src.html}\n *\n * The argument passed to this function is the key returned from\n * {@link module:ol/events~listen} or {@link module:ol/events~listenOnce}.\n *\n * @param {module:ol/events~EventsKey} key The key.\n */\nexport function unlistenByKey(key) {\n  if (key && key.target) {\n    key.target.removeEventListener(key.type, key.boundListener);\n    const listeners = getListeners(key.target, key.type);\n    if (listeners) {\n      const i = 'deleteIndex' in key ? key.deleteIndex : listeners.indexOf(key);\n      if (i !== -1) {\n        listeners.splice(i, 1);\n      }\n      if (listeners.length === 0) {\n        removeListeners(key.target, key.type);\n      }\n    }\n    clear(key);\n  }\n}\n\n\n/**\n * Unregisters all event listeners on an event target. Inspired by\n * {@link https://google.github.io/closure-library/api/source/closure/goog/events/events.js.src.html}\n *\n * @param {module:ol/events/EventTarget~EventTargetLike} target Target.\n */\nexport function unlistenAll(target) {\n  const listenerMap = getListenerMap(target);\n  for (const type in listenerMap) {\n    removeListeners(target, type);\n  }\n}\n","/**\n * @module ol/functions\n */\n\n/**\n * Always returns true.\n * @returns {boolean} true.\n */\nexport function TRUE() {\n  return true;\n}\n\n/**\n * Always returns false.\n * @returns {boolean} false.\n */\nexport function FALSE() {\n  return false;\n}\n\n/**\n * A reusable function, used e.g. as a default for callbacks.\n *\n * @return {undefined} Nothing.\n */\nexport function UNDEFINED() {}\n","/**\n * @module ol/Disposable\n */\nimport {UNDEFINED} from './functions.js';\n\n/**\n * Objects that need to clean up after themselves.\n * @constructor\n */\nconst Disposable = function() {};\n\n/**\n * The object has already been disposed.\n * @type {boolean}\n * @private\n */\nDisposable.prototype.disposed_ = false;\n\n/**\n * Clean up.\n */\nDisposable.prototype.dispose = function() {\n  if (!this.disposed_) {\n    this.disposed_ = true;\n    this.disposeInternal();\n  }\n};\n\n/**\n * Extension point for disposable objects.\n * @protected\n */\nDisposable.prototype.disposeInternal = UNDEFINED;\nexport default Disposable;\n","/**\n * @module ol/events/Event\n */\n/**\n * @classdesc\n * Stripped down implementation of the W3C DOM Level 2 Event interface.\n * @see {@link https://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-interface}\n *\n * This implementation only provides `type` and `target` properties, and\n * `stopPropagation` and `preventDefault` methods. It is meant as base class\n * for higher level events defined in the library, and works with\n * {@link module:ol/events/EventTarget~EventTarget}.\n *\n * @constructor\n * @param {string} type Type.\n */\nconst Event = function(type) {\n\n  /**\n   * @type {boolean}\n   */\n  this.propagationStopped;\n\n  /**\n   * The event type.\n   * @type {string}\n   * @api\n   */\n  this.type = type;\n\n  /**\n   * The event target.\n   * @type {Object}\n   * @api\n   */\n  this.target = null;\n\n};\n\n\n/**\n * Stop event propagation.\n * @function\n * @api\n */\nEvent.prototype.preventDefault =\n\n  /**\n   * Stop event propagation.\n   * @function\n   * @api\n   */\n  Event.prototype.stopPropagation = function() {\n    this.propagationStopped = true;\n  };\n\n\n/**\n * @param {Event|module:ol/events/Event} evt Event\n */\nexport function stopPropagation(evt) {\n  evt.stopPropagation();\n}\n\n\n/**\n * @param {Event|module:ol/events/Event} evt Event\n */\nexport function preventDefault(evt) {\n  evt.preventDefault();\n}\n\nexport default Event;\n","/**\n * @module ol/events/EventTarget\n */\nimport {inherits} from '../util.js';\nimport Disposable from '../Disposable.js';\nimport {unlistenAll} from '../events.js';\nimport {UNDEFINED} from '../functions.js';\nimport Event from '../events/Event.js';\n\n\n/**\n * @typedef {EventTarget|module:ol/events/EventTarget} EventTargetLike\n */\n\n\n/**\n * @classdesc\n * A simplified implementation of the W3C DOM Level 2 EventTarget interface.\n * @see {@link https://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/events.html#Events-EventTarget}\n *\n * There are two important simplifications compared to the specification:\n *\n * 1. The handling of `useCapture` in `addEventListener` and\n *    `removeEventListener`. There is no real capture model.\n * 2. The handling of `stopPropagation` and `preventDefault` on `dispatchEvent`.\n *    There is no event target hierarchy. When a listener calls\n *    `stopPropagation` or `preventDefault` on an event object, it means that no\n *    more listeners after this one will be called. Same as when the listener\n *    returns false.\n *\n * @constructor\n * @extends {module:ol/Disposable}\n */\nconst EventTarget = function() {\n\n  Disposable.call(this);\n\n  /**\n   * @private\n   * @type {!Object.<string, number>}\n   */\n  this.pendingRemovals_ = {};\n\n  /**\n   * @private\n   * @type {!Object.<string, number>}\n   */\n  this.dispatching_ = {};\n\n  /**\n   * @private\n   * @type {!Object.<string, Array.<module:ol/events~ListenerFunction>>}\n   */\n  this.listeners_ = {};\n\n};\n\ninherits(EventTarget, Disposable);\n\n\n/**\n * @param {string} type Type.\n * @param {module:ol/events~ListenerFunction} listener Listener.\n */\nEventTarget.prototype.addEventListener = function(type, listener) {\n  let listeners = this.listeners_[type];\n  if (!listeners) {\n    listeners = this.listeners_[type] = [];\n  }\n  if (listeners.indexOf(listener) === -1) {\n    listeners.push(listener);\n  }\n};\n\n\n/**\n * @param {{type: string,\n *     target: (EventTarget|module:ol/events/EventTarget|undefined)}|module:ol/events/Event|\n *     string} event Event or event type.\n * @return {boolean|undefined} `false` if anyone called preventDefault on the\n *     event object or if any of the listeners returned false.\n */\nEventTarget.prototype.dispatchEvent = function(event) {\n  const evt = typeof event === 'string' ? new Event(event) : event;\n  const type = evt.type;\n  evt.target = this;\n  const listeners = this.listeners_[type];\n  let propagate;\n  if (listeners) {\n    if (!(type in this.dispatching_)) {\n      this.dispatching_[type] = 0;\n      this.pendingRemovals_[type] = 0;\n    }\n    ++this.dispatching_[type];\n    for (let i = 0, ii = listeners.length; i < ii; ++i) {\n      if (listeners[i].call(this, evt) === false || evt.propagationStopped) {\n        propagate = false;\n        break;\n      }\n    }\n    --this.dispatching_[type];\n    if (this.dispatching_[type] === 0) {\n      let pendingRemovals = this.pendingRemovals_[type];\n      delete this.pendingRemovals_[type];\n      while (pendingRemovals--) {\n        this.removeEventListener(type, UNDEFINED);\n      }\n      delete this.dispatching_[type];\n    }\n    return propagate;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nEventTarget.prototype.disposeInternal = function() {\n  unlistenAll(this);\n};\n\n\n/**\n * Get the listeners for a specified event type. Listeners are returned in the\n * order that they will be called in.\n *\n * @param {string} type Type.\n * @return {Array.<module:ol/events~ListenerFunction>} Listeners.\n */\nEventTarget.prototype.getListeners = function(type) {\n  return this.listeners_[type];\n};\n\n\n/**\n * @param {string=} opt_type Type. If not provided,\n *     `true` will be returned if this EventTarget has any listeners.\n * @return {boolean} Has listeners.\n */\nEventTarget.prototype.hasListener = function(opt_type) {\n  return opt_type ?\n    opt_type in this.listeners_ :\n    Object.keys(this.listeners_).length > 0;\n};\n\n\n/**\n * @param {string} type Type.\n * @param {module:ol/events~ListenerFunction} listener Listener.\n */\nEventTarget.prototype.removeEventListener = function(type, listener) {\n  const listeners = this.listeners_[type];\n  if (listeners) {\n    const index = listeners.indexOf(listener);\n    if (type in this.pendingRemovals_) {\n      // make listener a no-op, and remove later in #dispatchEvent()\n      listeners[index] = UNDEFINED;\n      ++this.pendingRemovals_[type];\n    } else {\n      listeners.splice(index, 1);\n      if (listeners.length === 0) {\n        delete this.listeners_[type];\n      }\n    }\n  }\n};\nexport default EventTarget;\n","/**\n * @module ol/events/EventType\n */\n\n/**\n * @enum {string}\n * @const\n */\nexport default {\n  /**\n   * Generic change event. Triggered when the revision counter is increased.\n   * @event module:ol/events/Event~Event#change\n   * @api\n   */\n  CHANGE: 'change',\n\n  CLEAR: 'clear',\n  CONTEXTMENU: 'contextmenu',\n  CLICK: 'click',\n  DBLCLICK: 'dblclick',\n  DRAGENTER: 'dragenter',\n  DRAGOVER: 'dragover',\n  DROP: 'drop',\n  ERROR: 'error',\n  KEYDOWN: 'keydown',\n  KEYPRESS: 'keypress',\n  LOAD: 'load',\n  MOUSEDOWN: 'mousedown',\n  MOUSEMOVE: 'mousemove',\n  MOUSEOUT: 'mouseout',\n  MOUSEUP: 'mouseup',\n  MOUSEWHEEL: 'mousewheel',\n  MSPOINTERDOWN: 'MSPointerDown',\n  RESIZE: 'resize',\n  TOUCHSTART: 'touchstart',\n  TOUCHMOVE: 'touchmove',\n  TOUCHEND: 'touchend',\n  WHEEL: 'wheel'\n};\n","/**\n * @module ol/Observable\n */\nimport {inherits} from './util.js';\nimport {listen, unlistenByKey, unlisten, listenOnce} from './events.js';\nimport EventTarget from './events/EventTarget.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * An event target providing convenient methods for listener registration\n * and unregistration. A generic `change` event is always available through\n * {@link module:ol/Observable~Observable#changed}.\n *\n * @constructor\n * @extends {module:ol/events/EventTarget}\n * @fires module:ol/events/Event~Event\n * @struct\n * @api\n */\nconst Observable = function() {\n\n  EventTarget.call(this);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.revision_ = 0;\n\n};\n\ninherits(Observable, EventTarget);\n\n\n/**\n * Removes an event listener using the key returned by `on()` or `once()`.\n * @param {module:ol/events~EventsKey|Array.<module:ol/events~EventsKey>} key The key returned by `on()`\n *     or `once()` (or an array of keys).\n * @api\n */\nexport function unByKey(key) {\n  if (Array.isArray(key)) {\n    for (let i = 0, ii = key.length; i < ii; ++i) {\n      unlistenByKey(key[i]);\n    }\n  } else {\n    unlistenByKey(/** @type {module:ol/events~EventsKey} */ (key));\n  }\n}\n\n\n/**\n * Increases the revision counter and dispatches a 'change' event.\n * @api\n */\nObservable.prototype.changed = function() {\n  ++this.revision_;\n  this.dispatchEvent(EventType.CHANGE);\n};\n\n\n/**\n * Dispatches an event and calls all listeners listening for events\n * of this type. The event parameter can either be a string or an\n * Object with a `type` property.\n *\n * @param {{type: string,\n *     target: (EventTarget|module:ol/events/EventTarget|undefined)}|\n *     module:ol/events/Event|string} event Event object.\n * @function\n * @api\n */\nObservable.prototype.dispatchEvent;\n\n\n/**\n * Get the version number for this object.  Each time the object is modified,\n * its version number will be incremented.\n * @return {number} Revision.\n * @api\n */\nObservable.prototype.getRevision = function() {\n  return this.revision_;\n};\n\n\n/**\n * Listen for a certain type of event.\n * @param {string|Array.<string>} type The event type or array of event types.\n * @param {function(?): ?} listener The listener function.\n * @return {module:ol/events~EventsKey|Array.<module:ol/events~EventsKey>} Unique key for the listener. If\n *     called with an array of event types as the first argument, the return\n *     will be an array of keys.\n * @api\n */\nObservable.prototype.on = function(type, listener) {\n  if (Array.isArray(type)) {\n    const len = type.length;\n    const keys = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      keys[i] = listen(this, type[i], listener);\n    }\n    return keys;\n  } else {\n    return listen(this, /** @type {string} */ (type), listener);\n  }\n};\n\n\n/**\n * Listen once for a certain type of event.\n * @param {string|Array.<string>} type The event type or array of event types.\n * @param {function(?): ?} listener The listener function.\n * @return {module:ol/events~EventsKey|Array.<module:ol/events~EventsKey>} Unique key for the listener. If\n *     called with an array of event types as the first argument, the return\n *     will be an array of keys.\n * @api\n */\nObservable.prototype.once = function(type, listener) {\n  if (Array.isArray(type)) {\n    const len = type.length;\n    const keys = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      keys[i] = listenOnce(this, type[i], listener);\n    }\n    return keys;\n  } else {\n    return listenOnce(this, /** @type {string} */ (type), listener);\n  }\n};\n\n\n/**\n * Unlisten for a certain type of event.\n * @param {string|Array.<string>} type The event type or array of event types.\n * @param {function(?): ?} listener The listener function.\n * @api\n */\nObservable.prototype.un = function(type, listener) {\n  if (Array.isArray(type)) {\n    for (let i = 0, ii = type.length; i < ii; ++i) {\n      unlisten(this, type[i], listener);\n    }\n    return;\n  } else {\n    unlisten(this, /** @type {string} */ (type), listener);\n  }\n};\nexport default Observable;\n","/**\n * @module ol/Object\n */\nimport {getUid, inherits} from './util.js';\nimport ObjectEventType from './ObjectEventType.js';\nimport Observable from './Observable.js';\nimport Event from './events/Event.js';\nimport {assign} from './obj.js';\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Object~BaseObject} instances are instances of\n * this type.\n *\n * @param {string} type The event type.\n * @param {string} key The property name.\n * @param {*} oldValue The old value for `key`.\n * @extends {module:ol/events/Event}\n * @constructor\n */\nconst ObjectEvent = function(type, key, oldValue) {\n  Event.call(this, type);\n\n  /**\n   * The name of the property whose value is changing.\n   * @type {string}\n   * @api\n   */\n  this.key = key;\n\n  /**\n   * The old value. To get the new value use `e.target.get(e.key)` where\n   * `e` is the event object.\n   * @type {*}\n   * @api\n   */\n  this.oldValue = oldValue;\n\n};\ninherits(ObjectEvent, Event);\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Most non-trivial classes inherit from this.\n *\n * This extends {@link module:ol/Observable} with observable\n * properties, where each property is observable as well as the object as a\n * whole.\n *\n * Classes that inherit from this have pre-defined properties, to which you can\n * add your owns. The pre-defined properties are listed in this documentation as\n * 'Observable Properties', and have their own accessors; for example,\n * {@link module:ol/Map~Map} has a `target` property, accessed with\n * `getTarget()` and changed with `setTarget()`. Not all properties are however\n * settable. There are also general-purpose accessors `get()` and `set()`. For\n * example, `get('target')` is equivalent to `getTarget()`.\n *\n * The `set` accessors trigger a change event, and you can monitor this by\n * registering a listener. For example, {@link module:ol/View~View} has a\n * `center` property, so `view.on('change:center', function(evt) {...});` would\n * call the function whenever the value of the center property changes. Within\n * the function, `evt.target` would be the view, so `evt.target.getCenter()`\n * would return the new center.\n *\n * You can add your own observable properties with\n * `object.set('prop', 'value')`, and retrieve that with `object.get('prop')`.\n * You can listen for changes on that property value with\n * `object.on('change:prop', listener)`. You can get a list of all\n * properties with {@link module:ol/Object~BaseObject#getProperties}.\n *\n * Note that the observable properties are separate from standard JS properties.\n * You can, for example, give your map object a title with\n * `map.title='New title'` and with `map.set('title', 'Another title')`. The\n * first will be a `hasOwnProperty`; the second will appear in\n * `getProperties()`. Only the second is observable.\n *\n * Properties can be deleted by using the unset method. E.g.\n * object.unset('foo').\n *\n * @constructor\n * @extends {module:ol/Observable}\n * @param {Object.<string, *>=} opt_values An object with key-value pairs.\n * @fires module:ol/Object~ObjectEvent\n * @api\n */\nconst BaseObject = function(opt_values) {\n  Observable.call(this);\n\n  // Call {@link module:ol~getUid} to ensure that the order of objects' ids is\n  // the same as the order in which they were created.  This also helps to\n  // ensure that object properties are always added in the same order, which\n  // helps many JavaScript engines generate faster code.\n  getUid(this);\n\n  /**\n   * @private\n   * @type {!Object.<string, *>}\n   */\n  this.values_ = {};\n\n  if (opt_values !== undefined) {\n    this.setProperties(opt_values);\n  }\n};\n\ninherits(BaseObject, Observable);\n\n\n/**\n * @type {Object.<string, string>}\n */\nconst changeEventTypeCache = {};\n\n\n/**\n * @param {string} key Key name.\n * @return {string} Change name.\n */\nexport function getChangeEventType(key) {\n  return changeEventTypeCache.hasOwnProperty(key) ?\n    changeEventTypeCache[key] :\n    (changeEventTypeCache[key] = 'change:' + key);\n}\n\n\n/**\n * Gets a value.\n * @param {string} key Key name.\n * @return {*} Value.\n * @api\n */\nBaseObject.prototype.get = function(key) {\n  let value;\n  if (this.values_.hasOwnProperty(key)) {\n    value = this.values_[key];\n  }\n  return value;\n};\n\n\n/**\n * Get a list of object property names.\n * @return {Array.<string>} List of property names.\n * @api\n */\nBaseObject.prototype.getKeys = function() {\n  return Object.keys(this.values_);\n};\n\n\n/**\n * Get an object of all property names and values.\n * @return {Object.<string, *>} Object.\n * @api\n */\nBaseObject.prototype.getProperties = function() {\n  return assign({}, this.values_);\n};\n\n\n/**\n * @param {string} key Key name.\n * @param {*} oldValue Old value.\n */\nBaseObject.prototype.notify = function(key, oldValue) {\n  let eventType;\n  eventType = getChangeEventType(key);\n  this.dispatchEvent(new ObjectEvent(eventType, key, oldValue));\n  eventType = ObjectEventType.PROPERTYCHANGE;\n  this.dispatchEvent(new ObjectEvent(eventType, key, oldValue));\n};\n\n\n/**\n * Sets a value.\n * @param {string} key Key name.\n * @param {*} value Value.\n * @param {boolean=} opt_silent Update without triggering an event.\n * @api\n */\nBaseObject.prototype.set = function(key, value, opt_silent) {\n  if (opt_silent) {\n    this.values_[key] = value;\n  } else {\n    const oldValue = this.values_[key];\n    this.values_[key] = value;\n    if (oldValue !== value) {\n      this.notify(key, oldValue);\n    }\n  }\n};\n\n\n/**\n * Sets a collection of key-value pairs.  Note that this changes any existing\n * properties and adds new ones (it does not remove any existing properties).\n * @param {Object.<string, *>} values Values.\n * @param {boolean=} opt_silent Update without triggering an event.\n * @api\n */\nBaseObject.prototype.setProperties = function(values, opt_silent) {\n  for (const key in values) {\n    this.set(key, values[key], opt_silent);\n  }\n};\n\n\n/**\n * Unsets a property.\n * @param {string} key Key name.\n * @param {boolean=} opt_silent Unset without triggering an event.\n * @api\n */\nBaseObject.prototype.unset = function(key, opt_silent) {\n  if (key in this.values_) {\n    const oldValue = this.values_[key];\n    delete this.values_[key];\n    if (!opt_silent) {\n      this.notify(key, oldValue);\n    }\n  }\n};\n\n\nexport default BaseObject;\n","/**\n * @module ol/Collection\n */\nimport {inherits} from './util.js';\nimport AssertionError from './AssertionError.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport BaseObject from './Object.js';\nimport Event from './events/Event.js';\n\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  LENGTH: 'length'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Collection~Collection} instances are instances of this\n * type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {module:ol/CollectionEventType} type Type.\n * @param {*=} opt_element Element.\n */\nexport const CollectionEvent = function(type, opt_element) {\n\n  Event.call(this, type);\n\n  /**\n   * The element that is added to or removed from the collection.\n   * @type {*}\n   * @api\n   */\n  this.element = opt_element;\n\n};\n\ninherits(CollectionEvent, Event);\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [unique=false] Disallow the same item from being added to\n * the collection twice.\n */\n\n/**\n * @classdesc\n * An expanded version of standard JS Array, adding convenience methods for\n * manipulation. Add and remove changes to the Collection trigger a Collection\n * event. Note that this does not cover changes to the objects _within_ the\n * Collection; they trigger events on the appropriate object, not on the\n * Collection as a whole.\n *\n * @constructor\n * @extends {module:ol/Object}\n * @fires module:ol/Collection~CollectionEvent\n * @param {Array.<T>=} opt_array Array.\n * @param {module:ol/Collection~Options=} opt_options Collection options.\n * @template T\n * @api\n */\nconst Collection = function(opt_array, opt_options) {\n\n  BaseObject.call(this);\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.unique_ = !!options.unique;\n\n  /**\n   * @private\n   * @type {!Array.<T>}\n   */\n  this.array_ = opt_array ? opt_array : [];\n\n  if (this.unique_) {\n    for (let i = 0, ii = this.array_.length; i < ii; ++i) {\n      this.assertUnique_(this.array_[i], i);\n    }\n  }\n\n  this.updateLength_();\n\n};\n\ninherits(Collection, BaseObject);\n\n\n/**\n * Remove all elements from the collection.\n * @api\n */\nCollection.prototype.clear = function() {\n  while (this.getLength() > 0) {\n    this.pop();\n  }\n};\n\n\n/**\n * Add elements to the collection.  This pushes each item in the provided array\n * to the end of the collection.\n * @param {!Array.<T>} arr Array.\n * @return {module:ol/Collection.<T>} This collection.\n * @api\n */\nCollection.prototype.extend = function(arr) {\n  for (let i = 0, ii = arr.length; i < ii; ++i) {\n    this.push(arr[i]);\n  }\n  return this;\n};\n\n\n/**\n * Iterate over each element, calling the provided callback.\n * @param {function(T, number, Array.<T>): *} f The function to call\n *     for every element. This function takes 3 arguments (the element, the\n *     index and the array). The return value is ignored.\n * @api\n */\nCollection.prototype.forEach = function(f) {\n  const array = this.array_;\n  for (let i = 0, ii = array.length; i < ii; ++i) {\n    f(array[i], i, array);\n  }\n};\n\n\n/**\n * Get a reference to the underlying Array object. Warning: if the array\n * is mutated, no events will be dispatched by the collection, and the\n * collection's \"length\" property won't be in sync with the actual length\n * of the array.\n * @return {!Array.<T>} Array.\n * @api\n */\nCollection.prototype.getArray = function() {\n  return this.array_;\n};\n\n\n/**\n * Get the element at the provided index.\n * @param {number} index Index.\n * @return {T} Element.\n * @api\n */\nCollection.prototype.item = function(index) {\n  return this.array_[index];\n};\n\n\n/**\n * Get the length of this collection.\n * @return {number} The length of the array.\n * @observable\n * @api\n */\nCollection.prototype.getLength = function() {\n  return /** @type {number} */ (this.get(Property.LENGTH));\n};\n\n\n/**\n * Insert an element at the provided index.\n * @param {number} index Index.\n * @param {T} elem Element.\n * @api\n */\nCollection.prototype.insertAt = function(index, elem) {\n  if (this.unique_) {\n    this.assertUnique_(elem);\n  }\n  this.array_.splice(index, 0, elem);\n  this.updateLength_();\n  this.dispatchEvent(\n    new CollectionEvent(CollectionEventType.ADD, elem));\n};\n\n\n/**\n * Remove the last element of the collection and return it.\n * Return `undefined` if the collection is empty.\n * @return {T|undefined} Element.\n * @api\n */\nCollection.prototype.pop = function() {\n  return this.removeAt(this.getLength() - 1);\n};\n\n\n/**\n * Insert the provided element at the end of the collection.\n * @param {T} elem Element.\n * @return {number} New length of the collection.\n * @api\n */\nCollection.prototype.push = function(elem) {\n  if (this.unique_) {\n    this.assertUnique_(elem);\n  }\n  const n = this.getLength();\n  this.insertAt(n, elem);\n  return this.getLength();\n};\n\n\n/**\n * Remove the first occurrence of an element from the collection.\n * @param {T} elem Element.\n * @return {T|undefined} The removed element or undefined if none found.\n * @api\n */\nCollection.prototype.remove = function(elem) {\n  const arr = this.array_;\n  for (let i = 0, ii = arr.length; i < ii; ++i) {\n    if (arr[i] === elem) {\n      return this.removeAt(i);\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * Remove the element at the provided index and return it.\n * Return `undefined` if the collection does not contain this index.\n * @param {number} index Index.\n * @return {T|undefined} Value.\n * @api\n */\nCollection.prototype.removeAt = function(index) {\n  const prev = this.array_[index];\n  this.array_.splice(index, 1);\n  this.updateLength_();\n  this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE, prev));\n  return prev;\n};\n\n\n/**\n * Set the element at the provided index.\n * @param {number} index Index.\n * @param {T} elem Element.\n * @api\n */\nCollection.prototype.setAt = function(index, elem) {\n  const n = this.getLength();\n  if (index < n) {\n    if (this.unique_) {\n      this.assertUnique_(elem, index);\n    }\n    const prev = this.array_[index];\n    this.array_[index] = elem;\n    this.dispatchEvent(\n      new CollectionEvent(CollectionEventType.REMOVE, prev));\n    this.dispatchEvent(\n      new CollectionEvent(CollectionEventType.ADD, elem));\n  } else {\n    for (let j = n; j < index; ++j) {\n      this.insertAt(j, undefined);\n    }\n    this.insertAt(index, elem);\n  }\n};\n\n\n/**\n * @private\n */\nCollection.prototype.updateLength_ = function() {\n  this.set(Property.LENGTH, this.array_.length);\n};\n\n\n/**\n * @private\n * @param {T} elem Element.\n * @param {number=} opt_except Optional index to ignore.\n */\nCollection.prototype.assertUnique_ = function(elem, opt_except) {\n  for (let i = 0, ii = this.array_.length; i < ii; ++i) {\n    if (this.array_[i] === elem && i !== opt_except) {\n      throw new AssertionError(58);\n    }\n  }\n};\n\nexport default Collection;\n","/**\n * @module ol/asserts\n */\nimport AssertionError from './AssertionError.js';\n\n/**\n * @param {*} assertion Assertion we expected to be truthy.\n * @param {number} errorCode Error code.\n */\nexport function assert(assertion, errorCode) {\n  if (!assertion) {\n    throw new AssertionError(errorCode);\n  }\n}\n","/**\n * @module ol/extent/Corner\n */\n\n/**\n * Extent corner.\n * @enum {string}\n */\nexport default {\n  BOTTOM_LEFT: 'bottom-left',\n  BOTTOM_RIGHT: 'bottom-right',\n  TOP_LEFT: 'top-left',\n  TOP_RIGHT: 'top-right'\n};\n","/**\n * @module ol/extent/Relationship\n */\n\n/**\n * Relationship to an extent.\n * @enum {number}\n */\nexport default {\n  UNKNOWN: 0,\n  INTERSECTING: 1,\n  ABOVE: 2,\n  RIGHT: 4,\n  BELOW: 8,\n  LEFT: 16\n};\n","/**\n * @module ol/extent\n */\nimport {assert} from './asserts.js';\nimport Corner from './extent/Corner.js';\nimport Relationship from './extent/Relationship.js';\n\n\n/**\n * An array of numbers representing an extent: `[minx, miny, maxx, maxy]`.\n * @typedef {Array.<number>} Extent\n * @api\n */\n\n/**\n * Build an extent that includes all given coordinates.\n *\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @return {module:ol/extent~Extent} Bounding extent.\n * @api\n */\nexport function boundingExtent(coordinates) {\n  const extent = createEmpty();\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    extendCoordinate(extent, coordinates[i]);\n  }\n  return extent;\n}\n\n\n/**\n * @param {Array.<number>} xs Xs.\n * @param {Array.<number>} ys Ys.\n * @param {module:ol/extent~Extent=} opt_extent Destination extent.\n * @private\n * @return {module:ol/extent~Extent} Extent.\n */\nfunction _boundingExtentXYs(xs, ys, opt_extent) {\n  const minX = Math.min.apply(null, xs);\n  const minY = Math.min.apply(null, ys);\n  const maxX = Math.max.apply(null, xs);\n  const maxY = Math.max.apply(null, ys);\n  return createOrUpdate(minX, minY, maxX, maxY, opt_extent);\n}\n\n\n/**\n * Return extent increased by the provided value.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} value The amount by which the extent should be buffered.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nexport function buffer(extent, value, opt_extent) {\n  if (opt_extent) {\n    opt_extent[0] = extent[0] - value;\n    opt_extent[1] = extent[1] - value;\n    opt_extent[2] = extent[2] + value;\n    opt_extent[3] = extent[3] + value;\n    return opt_extent;\n  } else {\n    return [\n      extent[0] - value,\n      extent[1] - value,\n      extent[2] + value,\n      extent[3] + value\n    ];\n  }\n}\n\n\n/**\n * Creates a clone of an extent.\n *\n * @param {module:ol/extent~Extent} extent Extent to clone.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} The clone.\n */\nexport function clone(extent, opt_extent) {\n  if (opt_extent) {\n    opt_extent[0] = extent[0];\n    opt_extent[1] = extent[1];\n    opt_extent[2] = extent[2];\n    opt_extent[3] = extent[3];\n    return opt_extent;\n  } else {\n    return extent.slice();\n  }\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {number} Closest squared distance.\n */\nexport function closestSquaredDistanceXY(extent, x, y) {\n  let dx, dy;\n  if (x < extent[0]) {\n    dx = extent[0] - x;\n  } else if (extent[2] < x) {\n    dx = x - extent[2];\n  } else {\n    dx = 0;\n  }\n  if (y < extent[1]) {\n    dy = extent[1] - y;\n  } else if (extent[3] < y) {\n    dy = y - extent[3];\n  } else {\n    dy = 0;\n  }\n  return dx * dx + dy * dy;\n}\n\n\n/**\n * Check if the passed coordinate is contained or on the edge of the extent.\n *\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @return {boolean} The coordinate is contained in the extent.\n * @api\n */\nexport function containsCoordinate(extent, coordinate) {\n  return containsXY(extent, coordinate[0], coordinate[1]);\n}\n\n\n/**\n * Check if one extent contains another.\n *\n * An extent is deemed contained if it lies completely within the other extent,\n * including if they share one or more edges.\n *\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent 2.\n * @return {boolean} The second extent is contained by or on the edge of the\n *     first.\n * @api\n */\nexport function containsExtent(extent1, extent2) {\n  return extent1[0] <= extent2[0] && extent2[2] <= extent1[2] &&\n      extent1[1] <= extent2[1] && extent2[3] <= extent1[3];\n}\n\n\n/**\n * Check if the passed coordinate is contained or on the edge of the extent.\n *\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n * @return {boolean} The x, y values are contained in the extent.\n * @api\n */\nexport function containsXY(extent, x, y) {\n  return extent[0] <= x && x <= extent[2] && extent[1] <= y && y <= extent[3];\n}\n\n\n/**\n * Get the relationship between a coordinate and extent.\n * @param {module:ol/extent~Extent} extent The extent.\n * @param {module:ol/coordinate~Coordinate} coordinate The coordinate.\n * @return {module:ol/extent/Relationship} The relationship (bitwise compare with\n *     module:ol/extent/Relationship~Relationship).\n */\nexport function coordinateRelationship(extent, coordinate) {\n  const minX = extent[0];\n  const minY = extent[1];\n  const maxX = extent[2];\n  const maxY = extent[3];\n  const x = coordinate[0];\n  const y = coordinate[1];\n  let relationship = Relationship.UNKNOWN;\n  if (x < minX) {\n    relationship = relationship | Relationship.LEFT;\n  } else if (x > maxX) {\n    relationship = relationship | Relationship.RIGHT;\n  }\n  if (y < minY) {\n    relationship = relationship | Relationship.BELOW;\n  } else if (y > maxY) {\n    relationship = relationship | Relationship.ABOVE;\n  }\n  if (relationship === Relationship.UNKNOWN) {\n    relationship = Relationship.INTERSECTING;\n  }\n  return relationship;\n}\n\n\n/**\n * Create an empty extent.\n * @return {module:ol/extent~Extent} Empty extent.\n * @api\n */\nexport function createEmpty() {\n  return [Infinity, Infinity, -Infinity, -Infinity];\n}\n\n\n/**\n * Create a new extent or update the provided extent.\n * @param {number} minX Minimum X.\n * @param {number} minY Minimum Y.\n * @param {number} maxX Maximum X.\n * @param {number} maxY Maximum Y.\n * @param {module:ol/extent~Extent=} opt_extent Destination extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdate(minX, minY, maxX, maxY, opt_extent) {\n  if (opt_extent) {\n    opt_extent[0] = minX;\n    opt_extent[1] = minY;\n    opt_extent[2] = maxX;\n    opt_extent[3] = maxY;\n    return opt_extent;\n  } else {\n    return [minX, minY, maxX, maxY];\n  }\n}\n\n\n/**\n * Create a new empty extent or make the provided one empty.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdateEmpty(opt_extent) {\n  return createOrUpdate(\n    Infinity, Infinity, -Infinity, -Infinity, opt_extent);\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdateFromCoordinate(coordinate, opt_extent) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n  return createOrUpdate(x, y, x, y, opt_extent);\n}\n\n\n/**\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdateFromCoordinates(coordinates, opt_extent) {\n  const extent = createOrUpdateEmpty(opt_extent);\n  return extendCoordinates(extent, coordinates);\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdateFromFlatCoordinates(flatCoordinates, offset, end, stride, opt_extent) {\n  const extent = createOrUpdateEmpty(opt_extent);\n  return extendFlatCoordinates(extent, flatCoordinates, offset, end, stride);\n}\n\n/**\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} rings Rings.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function createOrUpdateFromRings(rings, opt_extent) {\n  const extent = createOrUpdateEmpty(opt_extent);\n  return extendRings(extent, rings);\n}\n\n\n/**\n * Determine if two extents are equivalent.\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent 2.\n * @return {boolean} The two extents are equivalent.\n * @api\n */\nexport function equals(extent1, extent2) {\n  return extent1[0] == extent2[0] && extent1[2] == extent2[2] &&\n      extent1[1] == extent2[1] && extent1[3] == extent2[3];\n}\n\n\n/**\n * Modify an extent to include another extent.\n * @param {module:ol/extent~Extent} extent1 The extent to be modified.\n * @param {module:ol/extent~Extent} extent2 The extent that will be included in the first.\n * @return {module:ol/extent~Extent} A reference to the first (extended) extent.\n * @api\n */\nexport function extend(extent1, extent2) {\n  if (extent2[0] < extent1[0]) {\n    extent1[0] = extent2[0];\n  }\n  if (extent2[2] > extent1[2]) {\n    extent1[2] = extent2[2];\n  }\n  if (extent2[1] < extent1[1]) {\n    extent1[1] = extent2[1];\n  }\n  if (extent2[3] > extent1[3]) {\n    extent1[3] = extent2[3];\n  }\n  return extent1;\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n */\nexport function extendCoordinate(extent, coordinate) {\n  if (coordinate[0] < extent[0]) {\n    extent[0] = coordinate[0];\n  }\n  if (coordinate[0] > extent[2]) {\n    extent[2] = coordinate[0];\n  }\n  if (coordinate[1] < extent[1]) {\n    extent[1] = coordinate[1];\n  }\n  if (coordinate[1] > extent[3]) {\n    extent[3] = coordinate[1];\n  }\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function extendCoordinates(extent, coordinates) {\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    extendCoordinate(extent, coordinates[i]);\n  }\n  return extent;\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function extendFlatCoordinates(extent, flatCoordinates, offset, end, stride) {\n  for (; offset < end; offset += stride) {\n    extendXY(extent, flatCoordinates[offset], flatCoordinates[offset + 1]);\n  }\n  return extent;\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} rings Rings.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function extendRings(extent, rings) {\n  for (let i = 0, ii = rings.length; i < ii; ++i) {\n    extendCoordinates(extent, rings[i]);\n  }\n  return extent;\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} x X.\n * @param {number} y Y.\n */\nexport function extendXY(extent, x, y) {\n  extent[0] = Math.min(extent[0], x);\n  extent[1] = Math.min(extent[1], y);\n  extent[2] = Math.max(extent[2], x);\n  extent[3] = Math.max(extent[3], y);\n}\n\n\n/**\n * This function calls `callback` for each corner of the extent. If the\n * callback returns a truthy value the function returns that value\n * immediately. Otherwise the function returns `false`.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {function(this:T, module:ol/coordinate~Coordinate): S} callback Callback.\n * @param {T=} opt_this Value to use as `this` when executing `callback`.\n * @return {S|boolean} Value.\n * @template S, T\n */\nexport function forEachCorner(extent, callback, opt_this) {\n  let val;\n  val = callback.call(opt_this, getBottomLeft(extent));\n  if (val) {\n    return val;\n  }\n  val = callback.call(opt_this, getBottomRight(extent));\n  if (val) {\n    return val;\n  }\n  val = callback.call(opt_this, getTopRight(extent));\n  if (val) {\n    return val;\n  }\n  val = callback.call(opt_this, getTopLeft(extent));\n  if (val) {\n    return val;\n  }\n  return false;\n}\n\n\n/**\n * Get the size of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {number} Area.\n * @api\n */\nexport function getArea(extent) {\n  let area = 0;\n  if (!isEmpty(extent)) {\n    area = getWidth(extent) * getHeight(extent);\n  }\n  return area;\n}\n\n\n/**\n * Get the bottom left coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/coordinate~Coordinate} Bottom left coordinate.\n * @api\n */\nexport function getBottomLeft(extent) {\n  return [extent[0], extent[1]];\n}\n\n\n/**\n * Get the bottom right coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/coordinate~Coordinate} Bottom right coordinate.\n * @api\n */\nexport function getBottomRight(extent) {\n  return [extent[2], extent[1]];\n}\n\n\n/**\n * Get the center coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/coordinate~Coordinate} Center.\n * @api\n */\nexport function getCenter(extent) {\n  return [(extent[0] + extent[2]) / 2, (extent[1] + extent[3]) / 2];\n}\n\n\n/**\n * Get a corner coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/extent/Corner} corner Corner.\n * @return {module:ol/coordinate~Coordinate} Corner coordinate.\n */\nexport function getCorner(extent, corner) {\n  let coordinate;\n  if (corner === Corner.BOTTOM_LEFT) {\n    coordinate = getBottomLeft(extent);\n  } else if (corner === Corner.BOTTOM_RIGHT) {\n    coordinate = getBottomRight(extent);\n  } else if (corner === Corner.TOP_LEFT) {\n    coordinate = getTopLeft(extent);\n  } else if (corner === Corner.TOP_RIGHT) {\n    coordinate = getTopRight(extent);\n  } else {\n    assert(false, 13); // Invalid corner\n  }\n  return (\n    /** @type {!module:ol/coordinate~Coordinate} */ (coordinate)\n  );\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent 2.\n * @return {number} Enlarged area.\n */\nexport function getEnlargedArea(extent1, extent2) {\n  const minX = Math.min(extent1[0], extent2[0]);\n  const minY = Math.min(extent1[1], extent2[1]);\n  const maxX = Math.max(extent1[2], extent2[2]);\n  const maxY = Math.max(extent1[3], extent2[3]);\n  return (maxX - minX) * (maxY - minY);\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {module:ol/extent~Extent=} opt_extent Destination extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function getForViewAndSize(center, resolution, rotation, size, opt_extent) {\n  const dx = resolution * size[0] / 2;\n  const dy = resolution * size[1] / 2;\n  const cosRotation = Math.cos(rotation);\n  const sinRotation = Math.sin(rotation);\n  const xCos = dx * cosRotation;\n  const xSin = dx * sinRotation;\n  const yCos = dy * cosRotation;\n  const ySin = dy * sinRotation;\n  const x = center[0];\n  const y = center[1];\n  const x0 = x - xCos + ySin;\n  const x1 = x - xCos - ySin;\n  const x2 = x + xCos - ySin;\n  const x3 = x + xCos + ySin;\n  const y0 = y - xSin - yCos;\n  const y1 = y - xSin + yCos;\n  const y2 = y + xSin + yCos;\n  const y3 = y + xSin - yCos;\n  return createOrUpdate(\n    Math.min(x0, x1, x2, x3), Math.min(y0, y1, y2, y3),\n    Math.max(x0, x1, x2, x3), Math.max(y0, y1, y2, y3),\n    opt_extent);\n}\n\n\n/**\n * Get the height of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {number} Height.\n * @api\n */\nexport function getHeight(extent) {\n  return extent[3] - extent[1];\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent 2.\n * @return {number} Intersection area.\n */\nexport function getIntersectionArea(extent1, extent2) {\n  const intersection = getIntersection(extent1, extent2);\n  return getArea(intersection);\n}\n\n\n/**\n * Get the intersection of two extents.\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent 2.\n * @param {module:ol/extent~Extent=} opt_extent Optional extent to populate with intersection.\n * @return {module:ol/extent~Extent} Intersecting extent.\n * @api\n */\nexport function getIntersection(extent1, extent2, opt_extent) {\n  const intersection = opt_extent ? opt_extent : createEmpty();\n  if (intersects(extent1, extent2)) {\n    if (extent1[0] > extent2[0]) {\n      intersection[0] = extent1[0];\n    } else {\n      intersection[0] = extent2[0];\n    }\n    if (extent1[1] > extent2[1]) {\n      intersection[1] = extent1[1];\n    } else {\n      intersection[1] = extent2[1];\n    }\n    if (extent1[2] < extent2[2]) {\n      intersection[2] = extent1[2];\n    } else {\n      intersection[2] = extent2[2];\n    }\n    if (extent1[3] < extent2[3]) {\n      intersection[3] = extent1[3];\n    } else {\n      intersection[3] = extent2[3];\n    }\n  } else {\n    createOrUpdateEmpty(intersection);\n  }\n  return intersection;\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {number} Margin.\n */\nexport function getMargin(extent) {\n  return getWidth(extent) + getHeight(extent);\n}\n\n\n/**\n * Get the size (width, height) of an extent.\n * @param {module:ol/extent~Extent} extent The extent.\n * @return {module:ol/size~Size} The extent size.\n * @api\n */\nexport function getSize(extent) {\n  return [extent[2] - extent[0], extent[3] - extent[1]];\n}\n\n\n/**\n * Get the top left coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/coordinate~Coordinate} Top left coordinate.\n * @api\n */\nexport function getTopLeft(extent) {\n  return [extent[0], extent[3]];\n}\n\n\n/**\n * Get the top right coordinate of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/coordinate~Coordinate} Top right coordinate.\n * @api\n */\nexport function getTopRight(extent) {\n  return [extent[2], extent[3]];\n}\n\n\n/**\n * Get the width of an extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {number} Width.\n * @api\n */\nexport function getWidth(extent) {\n  return extent[2] - extent[0];\n}\n\n\n/**\n * Determine if one extent intersects another.\n * @param {module:ol/extent~Extent} extent1 Extent 1.\n * @param {module:ol/extent~Extent} extent2 Extent.\n * @return {boolean} The two extents intersect.\n * @api\n */\nexport function intersects(extent1, extent2) {\n  return extent1[0] <= extent2[2] &&\n      extent1[2] >= extent2[0] &&\n      extent1[1] <= extent2[3] &&\n      extent1[3] >= extent2[1];\n}\n\n\n/**\n * Determine if an extent is empty.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} Is empty.\n * @api\n */\nexport function isEmpty(extent) {\n  return extent[2] < extent[0] || extent[3] < extent[1];\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function returnOrUpdate(extent, opt_extent) {\n  if (opt_extent) {\n    opt_extent[0] = extent[0];\n    opt_extent[1] = extent[1];\n    opt_extent[2] = extent[2];\n    opt_extent[3] = extent[3];\n    return opt_extent;\n  } else {\n    return extent;\n  }\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} value Value.\n */\nexport function scaleFromCenter(extent, value) {\n  const deltaX = ((extent[2] - extent[0]) / 2) * (value - 1);\n  const deltaY = ((extent[3] - extent[1]) / 2) * (value - 1);\n  extent[0] -= deltaX;\n  extent[2] += deltaX;\n  extent[1] -= deltaY;\n  extent[3] += deltaY;\n}\n\n\n/**\n * Determine if the segment between two coordinates intersects (crosses,\n * touches, or is contained by) the provided extent.\n * @param {module:ol/extent~Extent} extent The extent.\n * @param {module:ol/coordinate~Coordinate} start Segment start coordinate.\n * @param {module:ol/coordinate~Coordinate} end Segment end coordinate.\n * @return {boolean} The segment intersects the extent.\n */\nexport function intersectsSegment(extent, start, end) {\n  let intersects = false;\n  const startRel = coordinateRelationship(extent, start);\n  const endRel = coordinateRelationship(extent, end);\n  if (startRel === Relationship.INTERSECTING ||\n      endRel === Relationship.INTERSECTING) {\n    intersects = true;\n  } else {\n    const minX = extent[0];\n    const minY = extent[1];\n    const maxX = extent[2];\n    const maxY = extent[3];\n    const startX = start[0];\n    const startY = start[1];\n    const endX = end[0];\n    const endY = end[1];\n    const slope = (endY - startY) / (endX - startX);\n    let x, y;\n    if (!!(endRel & Relationship.ABOVE) &&\n        !(startRel & Relationship.ABOVE)) {\n      // potentially intersects top\n      x = endX - ((endY - maxY) / slope);\n      intersects = x >= minX && x <= maxX;\n    }\n    if (!intersects && !!(endRel & Relationship.RIGHT) &&\n        !(startRel & Relationship.RIGHT)) {\n      // potentially intersects right\n      y = endY - ((endX - maxX) * slope);\n      intersects = y >= minY && y <= maxY;\n    }\n    if (!intersects && !!(endRel & Relationship.BELOW) &&\n        !(startRel & Relationship.BELOW)) {\n      // potentially intersects bottom\n      x = endX - ((endY - minY) / slope);\n      intersects = x >= minX && x <= maxX;\n    }\n    if (!intersects && !!(endRel & Relationship.LEFT) &&\n        !(startRel & Relationship.LEFT)) {\n      // potentially intersects left\n      y = endY - ((endX - minX) * slope);\n      intersects = y >= minY && y <= maxY;\n    }\n\n  }\n  return intersects;\n}\n\n\n/**\n * Apply a transform function to the extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/proj~TransformFunction} transformFn Transform function.\n * Called with `[minX, minY, maxX, maxY]` extent coordinates.\n * @param {module:ol/extent~Extent=} opt_extent Destination extent.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nexport function applyTransform(extent, transformFn, opt_extent) {\n  const coordinates = [\n    extent[0], extent[1],\n    extent[0], extent[3],\n    extent[2], extent[1],\n    extent[2], extent[3]\n  ];\n  transformFn(coordinates, coordinates, 2);\n  const xs = [coordinates[0], coordinates[2], coordinates[4], coordinates[6]];\n  const ys = [coordinates[1], coordinates[3], coordinates[5], coordinates[7]];\n  return _boundingExtentXYs(xs, ys, opt_extent);\n}\n","/**\n * @module ol/geom/flat/transform\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Transformed coordinates.\n */\nexport function transform2D(flatCoordinates, offset, end, stride, transform, opt_dest) {\n  const dest = opt_dest ? opt_dest : [];\n  let i = 0;\n  for (let j = offset; j < end; j += stride) {\n    const x = flatCoordinates[j];\n    const y = flatCoordinates[j + 1];\n    dest[i++] = transform[0] * x + transform[2] * y + transform[4];\n    dest[i++] = transform[1] * x + transform[3] * y + transform[5];\n  }\n  if (opt_dest && dest.length != i) {\n    dest.length = i;\n  }\n  return dest;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} angle Angle.\n * @param {Array.<number>} anchor Rotation anchor point.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Transformed coordinates.\n */\nexport function rotate(flatCoordinates, offset, end, stride, angle, anchor, opt_dest) {\n  const dest = opt_dest ? opt_dest : [];\n  const cos = Math.cos(angle);\n  const sin = Math.sin(angle);\n  const anchorX = anchor[0];\n  const anchorY = anchor[1];\n  let i = 0;\n  for (let j = offset; j < end; j += stride) {\n    const deltaX = flatCoordinates[j] - anchorX;\n    const deltaY = flatCoordinates[j + 1] - anchorY;\n    dest[i++] = anchorX + deltaX * cos - deltaY * sin;\n    dest[i++] = anchorY + deltaX * sin + deltaY * cos;\n    for (let k = j + 2; k < j + stride; ++k) {\n      dest[i++] = flatCoordinates[k];\n    }\n  }\n  if (opt_dest && dest.length != i) {\n    dest.length = i;\n  }\n  return dest;\n}\n\n\n/**\n * Scale the coordinates.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} sx Scale factor in the x-direction.\n * @param {number} sy Scale factor in the y-direction.\n * @param {Array.<number>} anchor Scale anchor point.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Transformed coordinates.\n */\nexport function scale(flatCoordinates, offset, end, stride, sx, sy, anchor, opt_dest) {\n  const dest = opt_dest ? opt_dest : [];\n  const anchorX = anchor[0];\n  const anchorY = anchor[1];\n  let i = 0;\n  for (let j = offset; j < end; j += stride) {\n    const deltaX = flatCoordinates[j] - anchorX;\n    const deltaY = flatCoordinates[j + 1] - anchorY;\n    dest[i++] = anchorX + sx * deltaX;\n    dest[i++] = anchorY + sy * deltaY;\n    for (let k = j + 2; k < j + stride; ++k) {\n      dest[i++] = flatCoordinates[k];\n    }\n  }\n  if (opt_dest && dest.length != i) {\n    dest.length = i;\n  }\n  return dest;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} deltaX Delta X.\n * @param {number} deltaY Delta Y.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Transformed coordinates.\n */\nexport function translate(flatCoordinates, offset, end, stride, deltaX, deltaY, opt_dest) {\n  const dest = opt_dest ? opt_dest : [];\n  let i = 0;\n  for (let j = offset; j < end; j += stride) {\n    dest[i++] = flatCoordinates[j] + deltaX;\n    dest[i++] = flatCoordinates[j + 1] + deltaY;\n    for (let k = j + 2; k < j + stride; ++k) {\n      dest[i++] = flatCoordinates[k];\n    }\n  }\n  if (opt_dest && dest.length != i) {\n    dest.length = i;\n  }\n  return dest;\n}\n","/**\n * @module ol/math\n */\nimport {assert} from './asserts.js';\n\n/**\n * Takes a number and clamps it to within the provided bounds.\n * @param {number} value The input number.\n * @param {number} min The minimum value to return.\n * @param {number} max The maximum value to return.\n * @return {number} The input number if it is within bounds, or the nearest\n *     number within the bounds.\n */\nexport function clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n\n/**\n * Return the hyperbolic cosine of a given number. The method will use the\n * native `Math.cosh` function if it is available, otherwise the hyperbolic\n * cosine will be calculated via the reference implementation of the Mozilla\n * developer network.\n *\n * @param {number} x X.\n * @return {number} Hyperbolic cosine of x.\n */\nexport const cosh  = (function() {\n  // Wrapped in a iife, to save the overhead of checking for the native\n  // implementation on every invocation.\n  let cosh;\n  if ('cosh' in Math) {\n    // The environment supports the native Math.cosh function, use it\n    cosh = Math.cosh;\n  } else {\n    //  else, use the reference implementation of MDN:\n    cosh = function(x) {\n      const y = Math.exp(x);\n      return (y + 1 / y) / 2;\n    };\n  }\n  return cosh;\n}());\n\n\n/**\n * @param {number} x X.\n * @return {number} The smallest power of two greater than or equal to x.\n */\nexport function roundUpToPowerOfTwo(x) {\n  assert(0 < x, 29); // `x` must be greater than `0`\n  return Math.pow(2, Math.ceil(Math.log(x) / Math.LN2));\n}\n\n\n/**\n * Returns the square of the closest distance between the point (x, y) and the\n * line segment (x1, y1) to (x2, y2).\n * @param {number} x X.\n * @param {number} y Y.\n * @param {number} x1 X1.\n * @param {number} y1 Y1.\n * @param {number} x2 X2.\n * @param {number} y2 Y2.\n * @return {number} Squared distance.\n */\nexport function squaredSegmentDistance(x, y, x1, y1, x2, y2) {\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  if (dx !== 0 || dy !== 0) {\n    const t = ((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      x1 = x2;\n      y1 = y2;\n    } else if (t > 0) {\n      x1 += dx * t;\n      y1 += dy * t;\n    }\n  }\n  return squaredDistance(x, y, x1, y1);\n}\n\n\n/**\n * Returns the square of the distance between the points (x1, y1) and (x2, y2).\n * @param {number} x1 X1.\n * @param {number} y1 Y1.\n * @param {number} x2 X2.\n * @param {number} y2 Y2.\n * @return {number} Squared distance.\n */\nexport function squaredDistance(x1, y1, x2, y2) {\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  return dx * dx + dy * dy;\n}\n\n\n/**\n * Solves system of linear equations using Gaussian elimination method.\n *\n * @param {Array.<Array.<number>>} mat Augmented matrix (n x n + 1 column)\n *                                     in row-major order.\n * @return {Array.<number>} The resulting vector.\n */\nexport function solveLinearSystem(mat) {\n  const n = mat.length;\n\n  for (let i = 0; i < n; i++) {\n    // Find max in the i-th column (ignoring i - 1 first rows)\n    let maxRow = i;\n    let maxEl = Math.abs(mat[i][i]);\n    for (let r = i + 1; r < n; r++) {\n      const absValue = Math.abs(mat[r][i]);\n      if (absValue > maxEl) {\n        maxEl = absValue;\n        maxRow = r;\n      }\n    }\n\n    if (maxEl === 0) {\n      return null; // matrix is singular\n    }\n\n    // Swap max row with i-th (current) row\n    const tmp = mat[maxRow];\n    mat[maxRow] = mat[i];\n    mat[i] = tmp;\n\n    // Subtract the i-th row to make all the remaining rows 0 in the i-th column\n    for (let j = i + 1; j < n; j++) {\n      const coef = -mat[j][i] / mat[i][i];\n      for (let k = i; k < n + 1; k++) {\n        if (i == k) {\n          mat[j][k] = 0;\n        } else {\n          mat[j][k] += coef * mat[i][k];\n        }\n      }\n    }\n  }\n\n  // Solve Ax=b for upper triangular matrix A (mat)\n  const x = new Array(n);\n  for (let l = n - 1; l >= 0; l--) {\n    x[l] = mat[l][n] / mat[l][l];\n    for (let m = l - 1; m >= 0; m--) {\n      mat[m][n] -= mat[m][l] * x[l];\n    }\n  }\n  return x;\n}\n\n\n/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n\n/**\n * Returns the modulo of a / b, depending on the sign of b.\n *\n * @param {number} a Dividend.\n * @param {number} b Divisor.\n * @return {number} Modulo.\n */\nexport function modulo(a, b) {\n  const r = a % b;\n  return r * b < 0 ? r + b : r;\n}\n\n/**\n * Calculates the linearly interpolated value of x between a and b.\n *\n * @param {number} a Number\n * @param {number} b Number\n * @param {number} x Value to be interpolated.\n * @return {number} Interpolated value.\n */\nexport function lerp(a, b, x) {\n  return a + x * (b - a);\n}\n","/**\n * @module ol/geom/GeometryType\n */\n\n/**\n * The geometry type. One of `'Point'`, `'LineString'`, `'LinearRing'`,\n * `'Polygon'`, `'MultiPoint'`, `'MultiLineString'`, `'MultiPolygon'`,\n * `'GeometryCollection'`, `'Circle'`.\n * @enum {string}\n */\nexport default {\n  POINT: 'Point',\n  LINE_STRING: 'LineString',\n  LINEAR_RING: 'LinearRing',\n  POLYGON: 'Polygon',\n  MULTI_POINT: 'MultiPoint',\n  MULTI_LINE_STRING: 'MultiLineString',\n  MULTI_POLYGON: 'MultiPolygon',\n  GEOMETRY_COLLECTION: 'GeometryCollection',\n  CIRCLE: 'Circle'\n};\n","/**\n * @license\n * Latitude/longitude spherical geodesy formulae taken from\n * http://www.movable-type.co.uk/scripts/latlong.html\n * Licensed under CC-BY-3.0.\n */\n\n/**\n * @module ol/sphere\n */\nimport {toRadians, toDegrees} from './math.js';\nimport GeometryType from './geom/GeometryType.js';\n\n\n/**\n * Object literal with options for the {@link getLength} or {@link getArea}\n * functions.\n * @typedef {Object} SphereMetricOptions\n * @property {module:ol/proj~ProjectionLike} [projection='EPSG:3857']\n * Projection of the  geometry.  By default, the geometry is assumed to be in\n * Web Mercator.\n * @property {number} [radius=6371008.8] Sphere radius.  By default, the radius of the\n * earth is used (Clarke 1866 Authalic Sphere).\n */\n\n\n/**\n * The mean Earth radius (1/3 * (2a + b)) for the WGS84 ellipsoid.\n * https://en.wikipedia.org/wiki/Earth_radius#Mean_radius\n * @type {number}\n */\nexport const DEFAULT_RADIUS = 6371008.8;\n\n\n/**\n * Get the great circle distance (in meters) between two geographic coordinates.\n * @param {Array} c1 Starting coordinate.\n * @param {Array} c2 Ending coordinate.\n * @param {number=} opt_radius The sphere radius to use.  Defaults to the Earth's\n *     mean radius using the WGS84 ellipsoid.\n * @return {number} The great circle distance between the points (in meters).\n * @api\n */\nexport function getDistance(c1, c2, opt_radius) {\n  const radius = opt_radius || DEFAULT_RADIUS;\n  const lat1 = toRadians(c1[1]);\n  const lat2 = toRadians(c2[1]);\n  const deltaLatBy2 = (lat2 - lat1) / 2;\n  const deltaLonBy2 = toRadians(c2[0] - c1[0]) / 2;\n  const a = Math.sin(deltaLatBy2) * Math.sin(deltaLatBy2) +\n      Math.sin(deltaLonBy2) * Math.sin(deltaLonBy2) *\n      Math.cos(lat1) * Math.cos(lat2);\n  return 2 * radius * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n\n\n/**\n * Get the cumulative great circle length of linestring coordinates (geographic).\n * @param {Array} coordinates Linestring coordinates.\n * @param {number} radius The sphere radius to use.\n * @return {number} The length (in meters).\n */\nfunction getLengthInternal(coordinates, radius) {\n  let length = 0;\n  for (let i = 0, ii = coordinates.length; i < ii - 1; ++i) {\n    length += getDistance(coordinates[i], coordinates[i + 1], radius);\n  }\n  return length;\n}\n\n\n/**\n * Get the spherical length of a geometry.  This length is the sum of the\n * great circle distances between coordinates.  For polygons, the length is\n * the sum of all rings.  For points, the length is zero.  For multi-part\n * geometries, the length is the sum of the length of each part.\n * @param {module:ol/geom/Geometry} geometry A geometry.\n * @param {module:ol/sphere~SphereMetricOptions=} opt_options Options for the\n * length calculation.  By default, geometries are assumed to be in 'EPSG:3857'.\n * You can change this by providing a `projection` option.\n * @return {number} The spherical length (in meters).\n * @api\n */\nexport function getLength(geometry, opt_options) {\n  const options = opt_options || {};\n  const radius = options.radius || DEFAULT_RADIUS;\n  const projection = options.projection || 'EPSG:3857';\n  const type = geometry.getType();\n  if (type !== GeometryType.GEOMETRY_COLLECTION) {\n    geometry = geometry.clone().transform(projection, 'EPSG:4326');\n  }\n  let length = 0;\n  let coordinates, coords, i, ii, j, jj;\n  switch (type) {\n    case GeometryType.POINT:\n    case GeometryType.MULTI_POINT: {\n      break;\n    }\n    case GeometryType.LINE_STRING:\n    case GeometryType.LINEAR_RING: {\n      coordinates = /** @type {module:ol/geom/SimpleGeometry} */ (geometry).getCoordinates();\n      length = getLengthInternal(coordinates, radius);\n      break;\n    }\n    case GeometryType.MULTI_LINE_STRING:\n    case GeometryType.POLYGON: {\n      coordinates = /** @type {module:ol/geom/SimpleGeometry} */ (geometry).getCoordinates();\n      for (i = 0, ii = coordinates.length; i < ii; ++i) {\n        length += getLengthInternal(coordinates[i], radius);\n      }\n      break;\n    }\n    case GeometryType.MULTI_POLYGON: {\n      coordinates = /** @type {module:ol/geom/SimpleGeometry} */ (geometry).getCoordinates();\n      for (i = 0, ii = coordinates.length; i < ii; ++i) {\n        coords = coordinates[i];\n        for (j = 0, jj = coords.length; j < jj; ++j) {\n          length += getLengthInternal(coords[j], radius);\n        }\n      }\n      break;\n    }\n    case GeometryType.GEOMETRY_COLLECTION: {\n      const geometries = /** @type {module:ol/geom/GeometryCollection} */ (geometry).getGeometries();\n      for (i = 0, ii = geometries.length; i < ii; ++i) {\n        length += getLength(geometries[i], opt_options);\n      }\n      break;\n    }\n    default: {\n      throw new Error('Unsupported geometry type: ' + type);\n    }\n  }\n  return length;\n}\n\n\n/**\n * Returns the spherical area for a list of coordinates.\n *\n * [Reference](https://trs-new.jpl.nasa.gov/handle/2014/40409)\n * Robert. G. Chamberlain and William H. Duquette, \"Some Algorithms for\n * Polygons on a Sphere\", JPL Publication 07-03, Jet Propulsion\n * Laboratory, Pasadena, CA, June 2007\n *\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates List of coordinates of a linear\n * ring. If the ring is oriented clockwise, the area will be positive,\n * otherwise it will be negative.\n * @param {number} radius The sphere radius.\n * @return {number} Area (in square meters).\n */\nfunction getAreaInternal(coordinates, radius) {\n  let area = 0;\n  const len = coordinates.length;\n  let x1 = coordinates[len - 1][0];\n  let y1 = coordinates[len - 1][1];\n  for (let i = 0; i < len; i++) {\n    const x2 = coordinates[i][0];\n    const y2 = coordinates[i][1];\n    area += toRadians(x2 - x1) *\n        (2 + Math.sin(toRadians(y1)) +\n        Math.sin(toRadians(y2)));\n    x1 = x2;\n    y1 = y2;\n  }\n  return area * radius * radius / 2.0;\n}\n\n\n/**\n * Get the spherical area of a geometry.  This is the area (in meters) assuming\n * that polygon edges are segments of great circles on a sphere.\n * @param {module:ol/geom/Geometry} geometry A geometry.\n * @param {module:ol/sphere~SphereMetricOptions=} opt_options Options for the area\n *     calculation.  By default, geometries are assumed to be in 'EPSG:3857'.\n *     You can change this by providing a `projection` option.\n * @return {number} The spherical area (in square meters).\n * @api\n */\nexport function getArea(geometry, opt_options) {\n  const options = opt_options || {};\n  const radius = options.radius || DEFAULT_RADIUS;\n  const projection = options.projection || 'EPSG:3857';\n  const type = geometry.getType();\n  if (type !== GeometryType.GEOMETRY_COLLECTION) {\n    geometry = geometry.clone().transform(projection, 'EPSG:4326');\n  }\n  let area = 0;\n  let coordinates, coords, i, ii, j, jj;\n  switch (type) {\n    case GeometryType.POINT:\n    case GeometryType.MULTI_POINT:\n    case GeometryType.LINE_STRING:\n    case GeometryType.MULTI_LINE_STRING:\n    case GeometryType.LINEAR_RING: {\n      break;\n    }\n    case GeometryType.POLYGON: {\n      coordinates = /** @type {module:ol/geom/Polygon} */ (geometry).getCoordinates();\n      area = Math.abs(getAreaInternal(coordinates[0], radius));\n      for (i = 1, ii = coordinates.length; i < ii; ++i) {\n        area -= Math.abs(getAreaInternal(coordinates[i], radius));\n      }\n      break;\n    }\n    case GeometryType.MULTI_POLYGON: {\n      coordinates = /** @type {module:ol/geom/SimpleGeometry} */ (geometry).getCoordinates();\n      for (i = 0, ii = coordinates.length; i < ii; ++i) {\n        coords = coordinates[i];\n        area += Math.abs(getAreaInternal(coords[0], radius));\n        for (j = 1, jj = coords.length; j < jj; ++j) {\n          area -= Math.abs(getAreaInternal(coords[j], radius));\n        }\n      }\n      break;\n    }\n    case GeometryType.GEOMETRY_COLLECTION: {\n      const geometries = /** @type {module:ol/geom/GeometryCollection} */ (geometry).getGeometries();\n      for (i = 0, ii = geometries.length; i < ii; ++i) {\n        area += getArea(geometries[i], opt_options);\n      }\n      break;\n    }\n    default: {\n      throw new Error('Unsupported geometry type: ' + type);\n    }\n  }\n  return area;\n}\n\n\n/**\n * Returns the coordinate at the given distance and bearing from `c1`.\n *\n * @param {module:ol/coordinate~Coordinate} c1 The origin point (`[lon, lat]` in degrees).\n * @param {number} distance The great-circle distance between the origin\n *     point and the target point.\n * @param {number} bearing The bearing (in radians).\n * @param {number=} opt_radius The sphere radius to use.  Defaults to the Earth's\n *     mean radius using the WGS84 ellipsoid.\n * @return {module:ol/coordinate~Coordinate} The target point.\n */\nexport function offset(c1, distance, bearing, opt_radius) {\n  const radius = opt_radius || DEFAULT_RADIUS;\n  const lat1 = toRadians(c1[1]);\n  const lon1 = toRadians(c1[0]);\n  const dByR = distance / radius;\n  const lat = Math.asin(\n    Math.sin(lat1) * Math.cos(dByR) +\n      Math.cos(lat1) * Math.sin(dByR) * Math.cos(bearing));\n  const lon = lon1 + Math.atan2(\n    Math.sin(bearing) * Math.sin(dByR) * Math.cos(lat1),\n    Math.cos(dByR) - Math.sin(lat1) * Math.sin(lat));\n  return [toDegrees(lon), toDegrees(lat)];\n}\n","/**\n * @module ol/proj/Units\n */\n\n/**\n * Projection units: `'degrees'`, `'ft'`, `'m'`, `'pixels'`, `'tile-pixels'` or\n * `'us-ft'`.\n * @enum {string}\n */\nconst Units = {\n  DEGREES: 'degrees',\n  FEET: 'ft',\n  METERS: 'm',\n  PIXELS: 'pixels',\n  TILE_PIXELS: 'tile-pixels',\n  USFEET: 'us-ft'\n};\n\n\n/**\n * Meters per unit lookup table.\n * @const\n * @type {Object.<module:ol/proj/Units, number>}\n * @api\n */\nexport const METERS_PER_UNIT = {};\n// use the radius of the Normal sphere\nMETERS_PER_UNIT[Units.DEGREES] = 2 * Math.PI * 6370997 / 360;\nMETERS_PER_UNIT[Units.FEET] = 0.3048;\nMETERS_PER_UNIT[Units.METERS] = 1;\nMETERS_PER_UNIT[Units.USFEET] = 1200 / 3937;\n\nexport default Units;\n","/**\n * @module ol/proj/Projection\n */\nimport {METERS_PER_UNIT} from '../proj/Units.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} code The SRS identifier code, e.g. `EPSG:4326`.\n * @property {module:ol/proj/Units|string} [units] Units. Required unless a\n * proj4 projection is defined for `code`.\n * @property {module:ol/extent~Extent} [extent] The validity extent for the SRS.\n * @property {string} [axisOrientation='enu'] The axis orientation as specified in Proj4.\n * @property {boolean} [global=false] Whether the projection is valid for the whole globe.\n * @property {number} [metersPerUnit] The meters per unit for the SRS.\n * If not provided, the `units` are used to get the meters per unit from the {@link module:ol/proj/Units~METERS_PER_UNIT}\n * lookup table.\n * @property {module:ol/extent~Extent} [worldExtent] The world extent for the SRS.\n * @property {function(number, module:ol/coordinate~Coordinate):number} [getPointResolution]\n * Function to determine resolution at a point. The function is called with a\n * `{number}` view resolution and an `{module:ol/coordinate~Coordinate}` as arguments, and returns\n * the `{number}` resolution at the passed coordinate. If this is `undefined`,\n * the default {@link module:ol/proj#getPointResolution} function will be used.\n */\n\n\n/**\n * @classdesc\n * Projection definition class. One of these is created for each projection\n * supported in the application and stored in the {@link module:ol/proj} namespace.\n * You can use these in applications, but this is not required, as API params\n * and options use {@link module:ol/proj~ProjectionLike} which means the simple string\n * code will suffice.\n *\n * You can use {@link module:ol/proj~get} to retrieve the object for a particular\n * projection.\n *\n * The library includes definitions for `EPSG:4326` and `EPSG:3857`, together\n * with the following aliases:\n * * `EPSG:4326`: CRS:84, urn:ogc:def:crs:EPSG:6.6:4326,\n *     urn:ogc:def:crs:OGC:1.3:CRS84, urn:ogc:def:crs:OGC:2:84,\n *     http://www.opengis.net/gml/srs/epsg.xml#4326,\n *     urn:x-ogc:def:crs:EPSG:4326\n * * `EPSG:3857`: EPSG:102100, EPSG:102113, EPSG:900913,\n *     urn:ogc:def:crs:EPSG:6.18:3:3857,\n *     http://www.opengis.net/gml/srs/epsg.xml#3857\n *\n * If you use proj4js, aliases can be added using `proj4.defs()`; see\n * [documentation](https://github.com/proj4js/proj4js). To set an alternative\n * namespace for proj4, use {@link module:ol/proj~setProj4}.\n *\n * @constructor\n * @param {module:ol/proj/Projection~Options} options Projection options.\n * @struct\n * @api\n */\nconst Projection = function(options) {\n  /**\n   * @private\n   * @type {string}\n   */\n  this.code_ = options.code;\n\n  /**\n   * Units of projected coordinates. When set to `TILE_PIXELS`, a\n   * `this.extent_` and `this.worldExtent_` must be configured properly for each\n   * tile.\n   * @private\n   * @type {module:ol/proj/Units}\n   */\n  this.units_ = /** @type {module:ol/proj/Units} */ (options.units);\n\n  /**\n   * Validity extent of the projection in projected coordinates. For projections\n   * with `TILE_PIXELS` units, this is the extent of the tile in\n   * tile pixel space.\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = options.extent !== undefined ? options.extent : null;\n\n  /**\n   * Extent of the world in EPSG:4326. For projections with\n   * `TILE_PIXELS` units, this is the extent of the tile in\n   * projected coordinate space.\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.worldExtent_ = options.worldExtent !== undefined ?\n    options.worldExtent : null;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.axisOrientation_ = options.axisOrientation !== undefined ?\n    options.axisOrientation : 'enu';\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.global_ = options.global !== undefined ? options.global : false;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.canWrapX_ = !!(this.global_ && this.extent_);\n\n  /**\n   * @private\n   * @type {function(number, module:ol/coordinate~Coordinate):number|undefined}\n   */\n  this.getPointResolutionFunc_ = options.getPointResolution;\n\n  /**\n   * @private\n   * @type {module:ol/tilegrid/TileGrid}\n   */\n  this.defaultTileGrid_ = null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.metersPerUnit_ = options.metersPerUnit;\n};\n\n\n/**\n * @return {boolean} The projection is suitable for wrapping the x-axis\n */\nProjection.prototype.canWrapX = function() {\n  return this.canWrapX_;\n};\n\n\n/**\n * Get the code for this projection, e.g. 'EPSG:4326'.\n * @return {string} Code.\n * @api\n */\nProjection.prototype.getCode = function() {\n  return this.code_;\n};\n\n\n/**\n * Get the validity extent for this projection.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nProjection.prototype.getExtent = function() {\n  return this.extent_;\n};\n\n\n/**\n * Get the units of this projection.\n * @return {module:ol/proj/Units} Units.\n * @api\n */\nProjection.prototype.getUnits = function() {\n  return this.units_;\n};\n\n\n/**\n * Get the amount of meters per unit of this projection.  If the projection is\n * not configured with `metersPerUnit` or a units identifier, the return is\n * `undefined`.\n * @return {number|undefined} Meters.\n * @api\n */\nProjection.prototype.getMetersPerUnit = function() {\n  return this.metersPerUnit_ || METERS_PER_UNIT[this.units_];\n};\n\n\n/**\n * Get the world extent for this projection.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nProjection.prototype.getWorldExtent = function() {\n  return this.worldExtent_;\n};\n\n\n/**\n * Get the axis orientation of this projection.\n * Example values are:\n * enu - the default easting, northing, elevation.\n * neu - northing, easting, up - useful for \"lat/long\" geographic coordinates,\n *     or south orientated transverse mercator.\n * wnu - westing, northing, up - some planetary coordinate systems have\n *     \"west positive\" coordinate systems\n * @return {string} Axis orientation.\n * @api\n */\nProjection.prototype.getAxisOrientation = function() {\n  return this.axisOrientation_;\n};\n\n\n/**\n * Is this projection a global projection which spans the whole world?\n * @return {boolean} Whether the projection is global.\n * @api\n */\nProjection.prototype.isGlobal = function() {\n  return this.global_;\n};\n\n\n/**\n* Set if the projection is a global projection which spans the whole world\n* @param {boolean} global Whether the projection is global.\n* @api\n*/\nProjection.prototype.setGlobal = function(global) {\n  this.global_ = global;\n  this.canWrapX_ = !!(global && this.extent_);\n};\n\n\n/**\n * @return {module:ol/tilegrid/TileGrid} The default tile grid.\n */\nProjection.prototype.getDefaultTileGrid = function() {\n  return this.defaultTileGrid_;\n};\n\n\n/**\n * @param {module:ol/tilegrid/TileGrid} tileGrid The default tile grid.\n */\nProjection.prototype.setDefaultTileGrid = function(tileGrid) {\n  this.defaultTileGrid_ = tileGrid;\n};\n\n\n/**\n * Set the validity extent for this projection.\n * @param {module:ol/extent~Extent} extent Extent.\n * @api\n */\nProjection.prototype.setExtent = function(extent) {\n  this.extent_ = extent;\n  this.canWrapX_ = !!(this.global_ && extent);\n};\n\n\n/**\n * Set the world extent for this projection.\n * @param {module:ol/extent~Extent} worldExtent World extent\n *     [minlon, minlat, maxlon, maxlat].\n * @api\n */\nProjection.prototype.setWorldExtent = function(worldExtent) {\n  this.worldExtent_ = worldExtent;\n};\n\n\n/**\n * Set the getPointResolution function (see {@link module:ol/proj~getPointResolution}\n * for this projection.\n * @param {function(number, module:ol/coordinate~Coordinate):number} func Function\n * @api\n */\nProjection.prototype.setGetPointResolution = function(func) {\n  this.getPointResolutionFunc_ = func;\n};\n\n\n/**\n * Get the custom point resolution function for this projection (if set).\n * @return {function(number, module:ol/coordinate~Coordinate):number|undefined} The custom point\n * resolution function (if set).\n */\nProjection.prototype.getPointResolutionFunc = function() {\n  return this.getPointResolutionFunc_;\n};\nexport default Projection;\n","/**\n * @module ol/proj/epsg3857\n */\nimport {inherits} from '../util.js';\nimport {cosh} from '../math.js';\nimport Projection from '../proj/Projection.js';\nimport Units from '../proj/Units.js';\n\n\n/**\n * Radius of WGS84 sphere\n *\n * @const\n * @type {number}\n */\nexport const RADIUS = 6378137;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const HALF_SIZE = Math.PI * RADIUS;\n\n\n/**\n * @const\n * @type {module:ol/extent~Extent}\n */\nexport const EXTENT = [\n  -HALF_SIZE, -HALF_SIZE,\n  HALF_SIZE, HALF_SIZE\n];\n\n\n/**\n * @const\n * @type {module:ol/extent~Extent}\n */\nexport const WORLD_EXTENT = [-180, -85, 180, 85];\n\n\n/**\n * @classdesc\n * Projection object for web/spherical Mercator (EPSG:3857).\n *\n * @constructor\n * @extends {module:ol/proj/Projection}\n * @param {string} code Code.\n */\nfunction EPSG3857Projection(code) {\n  Projection.call(this, {\n    code: code,\n    units: Units.METERS,\n    extent: EXTENT,\n    global: true,\n    worldExtent: WORLD_EXTENT,\n    getPointResolution: function(resolution, point) {\n      return resolution / cosh(point[1] / RADIUS);\n    }\n  });\n}\ninherits(EPSG3857Projection, Projection);\n\n\n/**\n * Projections equal to EPSG:3857.\n *\n * @const\n * @type {Array.<module:ol/proj/Projection>}\n */\nexport const PROJECTIONS = [\n  new EPSG3857Projection('EPSG:3857'),\n  new EPSG3857Projection('EPSG:102100'),\n  new EPSG3857Projection('EPSG:102113'),\n  new EPSG3857Projection('EPSG:900913'),\n  new EPSG3857Projection('urn:ogc:def:crs:EPSG:6.18:3:3857'),\n  new EPSG3857Projection('urn:ogc:def:crs:EPSG::3857'),\n  new EPSG3857Projection('http://www.opengis.net/gml/srs/epsg.xml#3857')\n];\n\n\n/**\n * Transformation from EPSG:4326 to EPSG:3857.\n *\n * @param {Array.<number>} input Input array of coordinate values.\n * @param {Array.<number>=} opt_output Output array of coordinate values.\n * @param {number=} opt_dimension Dimension (default is `2`).\n * @return {Array.<number>} Output array of coordinate values.\n */\nexport function fromEPSG4326(input, opt_output, opt_dimension) {\n  const length = input.length;\n  const dimension = opt_dimension > 1 ? opt_dimension : 2;\n  let output = opt_output;\n  if (output === undefined) {\n    if (dimension > 2) {\n      // preserve values beyond second dimension\n      output = input.slice();\n    } else {\n      output = new Array(length);\n    }\n  }\n  const halfSize = HALF_SIZE;\n  for (let i = 0; i < length; i += dimension) {\n    output[i] = halfSize * input[i] / 180;\n    let y = RADIUS *\n        Math.log(Math.tan(Math.PI * (input[i + 1] + 90) / 360));\n    if (y > halfSize) {\n      y = halfSize;\n    } else if (y < -halfSize) {\n      y = -halfSize;\n    }\n    output[i + 1] = y;\n  }\n  return output;\n}\n\n\n/**\n * Transformation from EPSG:3857 to EPSG:4326.\n *\n * @param {Array.<number>} input Input array of coordinate values.\n * @param {Array.<number>=} opt_output Output array of coordinate values.\n * @param {number=} opt_dimension Dimension (default is `2`).\n * @return {Array.<number>} Output array of coordinate values.\n */\nexport function toEPSG4326(input, opt_output, opt_dimension) {\n  const length = input.length;\n  const dimension = opt_dimension > 1 ? opt_dimension : 2;\n  let output = opt_output;\n  if (output === undefined) {\n    if (dimension > 2) {\n      // preserve values beyond second dimension\n      output = input.slice();\n    } else {\n      output = new Array(length);\n    }\n  }\n  for (let i = 0; i < length; i += dimension) {\n    output[i] = 180 * input[i] / HALF_SIZE;\n    output[i + 1] = 360 * Math.atan(\n      Math.exp(input[i + 1] / RADIUS)) / Math.PI - 90;\n  }\n  return output;\n}\n","/**\n * @module ol/proj/epsg4326\n */\nimport {inherits} from '../util.js';\nimport Projection from '../proj/Projection.js';\nimport Units from '../proj/Units.js';\n\n\n/**\n * Semi-major radius of the WGS84 ellipsoid.\n *\n * @const\n * @type {number}\n */\nexport const RADIUS = 6378137;\n\n\n/**\n * Extent of the EPSG:4326 projection which is the whole world.\n *\n * @const\n * @type {module:ol/extent~Extent}\n */\nexport const EXTENT = [-180, -90, 180, 90];\n\n\n/**\n * @const\n * @type {number}\n */\nexport const METERS_PER_UNIT = Math.PI * RADIUS / 180;\n\n\n/**\n * @classdesc\n * Projection object for WGS84 geographic coordinates (EPSG:4326).\n *\n * Note that OpenLayers does not strictly comply with the EPSG definition.\n * The EPSG registry defines 4326 as a CRS for Latitude,Longitude (y,x).\n * OpenLayers treats EPSG:4326 as a pseudo-projection, with x,y coordinates.\n *\n * @constructor\n * @extends {module:ol/proj/Projection}\n * @param {string} code Code.\n * @param {string=} opt_axisOrientation Axis orientation.\n */\nfunction EPSG4326Projection(code, opt_axisOrientation) {\n  Projection.call(this, {\n    code: code,\n    units: Units.DEGREES,\n    extent: EXTENT,\n    axisOrientation: opt_axisOrientation,\n    global: true,\n    metersPerUnit: METERS_PER_UNIT,\n    worldExtent: EXTENT\n  });\n}\ninherits(EPSG4326Projection, Projection);\n\n\n/**\n * Projections equal to EPSG:4326.\n *\n * @const\n * @type {Array.<module:ol/proj/Projection>}\n */\nexport const PROJECTIONS = [\n  new EPSG4326Projection('CRS:84'),\n  new EPSG4326Projection('EPSG:4326', 'neu'),\n  new EPSG4326Projection('urn:ogc:def:crs:EPSG::4326', 'neu'),\n  new EPSG4326Projection('urn:ogc:def:crs:EPSG:6.6:4326', 'neu'),\n  new EPSG4326Projection('urn:ogc:def:crs:OGC:1.3:CRS84'),\n  new EPSG4326Projection('urn:ogc:def:crs:OGC:2:84'),\n  new EPSG4326Projection('http://www.opengis.net/gml/srs/epsg.xml#4326', 'neu'),\n  new EPSG4326Projection('urn:x-ogc:def:crs:EPSG:4326', 'neu')\n];\n","/**\n * @module ol/proj/projections\n */\n\n\n/**\n * @type {Object.<string, module:ol/proj/Projection>}\n */\nlet cache = {};\n\n\n/**\n * Clear the projections cache.\n */\nexport function clear() {\n  cache = {};\n}\n\n\n/**\n * Get a cached projection by code.\n * @param {string} code The code for the projection.\n * @return {module:ol/proj/Projection} The projection (if cached).\n */\nexport function get(code) {\n  return cache[code] || null;\n}\n\n\n/**\n * Add a projection to the cache.\n * @param {string} code The projection code.\n * @param {module:ol/proj/Projection} projection The projection to cache.\n */\nexport function add(code, projection) {\n  cache[code] = projection;\n}\n","/**\n * @module ol/proj/transforms\n */\nimport {isEmpty} from '../obj.js';\n\n\n/**\n * @private\n * @type {!Object.<string, Object.<string, module:ol/proj~TransformFunction>>}\n */\nlet transforms = {};\n\n\n/**\n * Clear the transform cache.\n */\nexport function clear() {\n  transforms = {};\n}\n\n\n/**\n * Registers a conversion function to convert coordinates from the source\n * projection to the destination projection.\n *\n * @param {module:ol/proj/Projection} source Source.\n * @param {module:ol/proj/Projection} destination Destination.\n * @param {module:ol/proj~TransformFunction} transformFn Transform.\n */\nexport function add(source, destination, transformFn) {\n  const sourceCode = source.getCode();\n  const destinationCode = destination.getCode();\n  if (!(sourceCode in transforms)) {\n    transforms[sourceCode] = {};\n  }\n  transforms[sourceCode][destinationCode] = transformFn;\n}\n\n\n/**\n * Unregisters the conversion function to convert coordinates from the source\n * projection to the destination projection.  This method is used to clean up\n * cached transforms during testing.\n *\n * @param {module:ol/proj/Projection} source Source projection.\n * @param {module:ol/proj/Projection} destination Destination projection.\n * @return {module:ol/proj~TransformFunction} transformFn The unregistered transform.\n */\nexport function remove(source, destination) {\n  const sourceCode = source.getCode();\n  const destinationCode = destination.getCode();\n  const transform = transforms[sourceCode][destinationCode];\n  delete transforms[sourceCode][destinationCode];\n  if (isEmpty(transforms[sourceCode])) {\n    delete transforms[sourceCode];\n  }\n  return transform;\n}\n\n\n/**\n * Get a transform given a source code and a destination code.\n * @param {string} sourceCode The code for the source projection.\n * @param {string} destinationCode The code for the destination projection.\n * @return {module:ol/proj~TransformFunction|undefined} The transform function (if found).\n */\nexport function get(sourceCode, destinationCode) {\n  let transform;\n  if (sourceCode in transforms && destinationCode in transforms[sourceCode]) {\n    transform = transforms[sourceCode][destinationCode];\n  }\n  return transform;\n}\n","/**\n * @module ol/proj\n */\n\n/**\n * The ol/proj module stores:\n * * a list of {@link module:ol/proj/Projection}\n * objects, one for each projection supported by the application\n * * a list of transform functions needed to convert coordinates in one projection\n * into another.\n *\n * The static functions are the methods used to maintain these.\n * Each transform function can handle not only simple coordinate pairs, but also\n * large arrays of coordinates such as vector geometries.\n *\n * When loaded, the library adds projection objects for EPSG:4326 (WGS84\n * geographic coordinates) and EPSG:3857 (Web or Spherical Mercator, as used\n * for example by Bing Maps or OpenStreetMap), together with the relevant\n * transform functions.\n *\n * Additional transforms may be added by using the {@link http://proj4js.org/}\n * library (version 2.2 or later). You can use the full build supplied by\n * Proj4js, or create a custom build to support those projections you need; see\n * the Proj4js website for how to do this. You also need the Proj4js definitions\n * for the required projections. These definitions can be obtained from\n * {@link https://epsg.io/}, and are a JS function, so can be loaded in a script\n * tag (as in the examples) or pasted into your application.\n *\n * After all required projection definitions are added to proj4's registry (by\n * using `proj4.defs()`), simply call `register(proj4)` from the `ol/proj/proj4`\n * package. Existing transforms are not changed by this function. See\n * examples/wms-image-custom-proj for an example of this.\n *\n * Additional projection definitions can be registered with `proj4.defs()` any\n * time. Just make sure to call `register(proj4)` again; for example, with user-supplied data where you don't\n * know in advance what projections are needed, you can initially load minimal\n * support and then load whichever are requested.\n *\n * Note that Proj4js does not support projection extents. If you want to add\n * one for creating default tile grids, you can add it after the Projection\n * object has been created with `setExtent`, for example,\n * `get('EPSG:1234').setExtent(extent)`.\n *\n * In addition to Proj4js support, any transform functions can be added with\n * {@link module:ol/proj~addCoordinateTransforms}. To use this, you must first create\n * a {@link module:ol/proj/Projection} object for the new projection and add it with\n * {@link module:ol/proj~addProjection}. You can then add the forward and inverse\n * functions with {@link module:ol/proj~addCoordinateTransforms}. See\n * examples/wms-custom-proj for an example of this.\n *\n * Note that if no transforms are needed and you only need to define the\n * projection, just add a {@link module:ol/proj/Projection} with\n * {@link module:ol/proj~addProjection}. See examples/wms-no-proj for an example of\n * this.\n */\nimport {getDistance} from './sphere.js';\nimport {applyTransform} from './extent.js';\nimport {modulo} from './math.js';\nimport {toEPSG4326, fromEPSG4326, PROJECTIONS as EPSG3857_PROJECTIONS} from './proj/epsg3857.js';\nimport {PROJECTIONS as EPSG4326_PROJECTIONS} from './proj/epsg4326.js';\nimport Projection from './proj/Projection.js';\nimport Units, {METERS_PER_UNIT} from './proj/Units.js';\nimport * as projections from './proj/projections.js';\nimport {add as addTransformFunc, clear as clearTransformFuncs, get as getTransformFunc} from './proj/transforms.js';\n\n\n/**\n * A projection as {@link module:ol/proj/Projection}, SRS identifier\n * string or undefined.\n * @typedef {module:ol/proj/Projection|string|undefined} ProjectionLike\n * @api\n */\n\n\n/**\n * A transform function accepts an array of input coordinate values, an optional\n * output array, and an optional dimension (default should be 2).  The function\n * transforms the input coordinate values, populates the output array, and\n * returns the output array.\n *\n * @typedef {function(Array.<number>, Array.<number>=, number=): Array.<number>} TransformFunction\n * @api\n */\n\n\nexport {METERS_PER_UNIT};\n\n\n/**\n * @param {Array.<number>} input Input coordinate array.\n * @param {Array.<number>=} opt_output Output array of coordinate values.\n * @param {number=} opt_dimension Dimension.\n * @return {Array.<number>} Output coordinate array (new array, same coordinate\n *     values).\n */\nexport function cloneTransform(input, opt_output, opt_dimension) {\n  let output;\n  if (opt_output !== undefined) {\n    for (let i = 0, ii = input.length; i < ii; ++i) {\n      opt_output[i] = input[i];\n    }\n    output = opt_output;\n  } else {\n    output = input.slice();\n  }\n  return output;\n}\n\n\n/**\n * @param {Array.<number>} input Input coordinate array.\n * @param {Array.<number>=} opt_output Output array of coordinate values.\n * @param {number=} opt_dimension Dimension.\n * @return {Array.<number>} Input coordinate array (same array as input).\n */\nexport function identityTransform(input, opt_output, opt_dimension) {\n  if (opt_output !== undefined && input !== opt_output) {\n    for (let i = 0, ii = input.length; i < ii; ++i) {\n      opt_output[i] = input[i];\n    }\n    input = opt_output;\n  }\n  return input;\n}\n\n\n/**\n * Add a Projection object to the list of supported projections that can be\n * looked up by their code.\n *\n * @param {module:ol/proj/Projection} projection Projection instance.\n * @api\n */\nexport function addProjection(projection) {\n  projections.add(projection.getCode(), projection);\n  addTransformFunc(projection, projection, cloneTransform);\n}\n\n\n/**\n * @param {Array.<module:ol/proj/Projection>} projections Projections.\n */\nexport function addProjections(projections) {\n  projections.forEach(addProjection);\n}\n\n\n/**\n * Fetches a Projection object for the code specified.\n *\n * @param {module:ol/proj~ProjectionLike} projectionLike Either a code string which is\n *     a combination of authority and identifier such as \"EPSG:4326\", or an\n *     existing projection object, or undefined.\n * @return {module:ol/proj/Projection} Projection object, or null if not in list.\n * @api\n */\nexport function get(projectionLike) {\n  let projection = null;\n  if (projectionLike instanceof Projection) {\n    projection = projectionLike;\n  } else if (typeof projectionLike === 'string') {\n    const code = projectionLike;\n    projection = projections.get(code);\n  }\n  return projection;\n}\n\n\n/**\n * Get the resolution of the point in degrees or distance units.\n * For projections with degrees as the unit this will simply return the\n * provided resolution. For other projections the point resolution is\n * by default estimated by transforming the 'point' pixel to EPSG:4326,\n * measuring its width and height on the normal sphere,\n * and taking the average of the width and height.\n * A custom function can be provided for a specific projection, either\n * by setting the `getPointResolution` option in the\n * {@link module:ol/proj/Projection~Projection} constructor or by using\n * {@link module:ol/proj/Projection~Projection#setGetPointResolution} to change an existing\n * projection object.\n * @param {module:ol/proj~ProjectionLike} projection The projection.\n * @param {number} resolution Nominal resolution in projection units.\n * @param {module:ol/coordinate~Coordinate} point Point to find adjusted resolution at.\n * @param {module:ol/proj/Units=} opt_units Units to get the point resolution in.\n * Default is the projection's units.\n * @return {number} Point resolution.\n * @api\n */\nexport function getPointResolution(projection, resolution, point, opt_units) {\n  projection = get(projection);\n  let pointResolution;\n  const getter = projection.getPointResolutionFunc();\n  if (getter) {\n    pointResolution = getter(resolution, point);\n  } else {\n    const units = projection.getUnits();\n    if (units == Units.DEGREES && !opt_units || opt_units == Units.DEGREES) {\n      pointResolution = resolution;\n    } else {\n      // Estimate point resolution by transforming the center pixel to EPSG:4326,\n      // measuring its width and height on the normal sphere, and taking the\n      // average of the width and height.\n      const toEPSG4326 = getTransformFromProjections(projection, get('EPSG:4326'));\n      let vertices = [\n        point[0] - resolution / 2, point[1],\n        point[0] + resolution / 2, point[1],\n        point[0], point[1] - resolution / 2,\n        point[0], point[1] + resolution / 2\n      ];\n      vertices = toEPSG4326(vertices, vertices, 2);\n      const width = getDistance(vertices.slice(0, 2), vertices.slice(2, 4));\n      const height = getDistance(vertices.slice(4, 6), vertices.slice(6, 8));\n      pointResolution = (width + height) / 2;\n      const metersPerUnit = opt_units ?\n        METERS_PER_UNIT[opt_units] :\n        projection.getMetersPerUnit();\n      if (metersPerUnit !== undefined) {\n        pointResolution /= metersPerUnit;\n      }\n    }\n  }\n  return pointResolution;\n}\n\n\n/**\n * Registers transformation functions that don't alter coordinates. Those allow\n * to transform between projections with equal meaning.\n *\n * @param {Array.<module:ol/proj/Projection>} projections Projections.\n * @api\n */\nexport function addEquivalentProjections(projections) {\n  addProjections(projections);\n  projections.forEach(function(source) {\n    projections.forEach(function(destination) {\n      if (source !== destination) {\n        addTransformFunc(source, destination, cloneTransform);\n      }\n    });\n  });\n}\n\n\n/**\n * Registers transformation functions to convert coordinates in any projection\n * in projection1 to any projection in projection2.\n *\n * @param {Array.<module:ol/proj/Projection>} projections1 Projections with equal\n *     meaning.\n * @param {Array.<module:ol/proj/Projection>} projections2 Projections with equal\n *     meaning.\n * @param {module:ol/proj~TransformFunction} forwardTransform Transformation from any\n *   projection in projection1 to any projection in projection2.\n * @param {module:ol/proj~TransformFunction} inverseTransform Transform from any projection\n *   in projection2 to any projection in projection1..\n */\nexport function addEquivalentTransforms(projections1, projections2, forwardTransform, inverseTransform) {\n  projections1.forEach(function(projection1) {\n    projections2.forEach(function(projection2) {\n      addTransformFunc(projection1, projection2, forwardTransform);\n      addTransformFunc(projection2, projection1, inverseTransform);\n    });\n  });\n}\n\n\n/**\n * Clear all cached projections and transforms.\n */\nexport function clearAllProjections() {\n  projections.clear();\n  clearTransformFuncs();\n}\n\n\n/**\n * @param {module:ol/proj/Projection|string|undefined} projection Projection.\n * @param {string} defaultCode Default code.\n * @return {module:ol/proj/Projection} Projection.\n */\nexport function createProjection(projection, defaultCode) {\n  if (!projection) {\n    return get(defaultCode);\n  } else if (typeof projection === 'string') {\n    return get(projection);\n  } else {\n    return (\n      /** @type {module:ol/proj/Projection} */ (projection)\n    );\n  }\n}\n\n\n/**\n * Creates a {@link module:ol/proj~TransformFunction} from a simple 2D coordinate transform\n * function.\n * @param {function(module:ol/coordinate~Coordinate): module:ol/coordinate~Coordinate} coordTransform Coordinate\n *     transform.\n * @return {module:ol/proj~TransformFunction} Transform function.\n */\nexport function createTransformFromCoordinateTransform(coordTransform) {\n  return (\n    /**\n     * @param {Array.<number>} input Input.\n     * @param {Array.<number>=} opt_output Output.\n     * @param {number=} opt_dimension Dimension.\n     * @return {Array.<number>} Output.\n     */\n    function(input, opt_output, opt_dimension) {\n      const length = input.length;\n      const dimension = opt_dimension !== undefined ? opt_dimension : 2;\n      const output = opt_output !== undefined ? opt_output : new Array(length);\n      for (let i = 0; i < length; i += dimension) {\n        const point = coordTransform([input[i], input[i + 1]]);\n        output[i] = point[0];\n        output[i + 1] = point[1];\n        for (let j = dimension - 1; j >= 2; --j) {\n          output[i + j] = input[i + j];\n        }\n      }\n      return output;\n    });\n}\n\n\n/**\n * Registers coordinate transform functions to convert coordinates between the\n * source projection and the destination projection.\n * The forward and inverse functions convert coordinate pairs; this function\n * converts these into the functions used internally which also handle\n * extents and coordinate arrays.\n *\n * @param {module:ol/proj~ProjectionLike} source Source projection.\n * @param {module:ol/proj~ProjectionLike} destination Destination projection.\n * @param {function(module:ol/coordinate~Coordinate): module:ol/coordinate~Coordinate} forward The forward transform\n *     function (that is, from the source projection to the destination\n *     projection) that takes a {@link module:ol/coordinate~Coordinate} as argument and returns\n *     the transformed {@link module:ol/coordinate~Coordinate}.\n * @param {function(module:ol/coordinate~Coordinate): module:ol/coordinate~Coordinate} inverse The inverse transform\n *     function (that is, from the destination projection to the source\n *     projection) that takes a {@link module:ol/coordinate~Coordinate} as argument and returns\n *     the transformed {@link module:ol/coordinate~Coordinate}.\n * @api\n */\nexport function addCoordinateTransforms(source, destination, forward, inverse) {\n  const sourceProj = get(source);\n  const destProj = get(destination);\n  addTransformFunc(sourceProj, destProj, createTransformFromCoordinateTransform(forward));\n  addTransformFunc(destProj, sourceProj, createTransformFromCoordinateTransform(inverse));\n}\n\n\n/**\n * Transforms a coordinate from longitude/latitude to a different projection.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate as longitude and latitude, i.e.\n *     an array with longitude as 1st and latitude as 2nd element.\n * @param {module:ol/proj~ProjectionLike=} opt_projection Target projection. The\n *     default is Web Mercator, i.e. 'EPSG:3857'.\n * @return {module:ol/coordinate~Coordinate} Coordinate projected to the target projection.\n * @api\n */\nexport function fromLonLat(coordinate, opt_projection) {\n  return transform(coordinate, 'EPSG:4326',\n    opt_projection !== undefined ? opt_projection : 'EPSG:3857');\n}\n\n\n/**\n * Transforms a coordinate to longitude/latitude.\n * @param {module:ol/coordinate~Coordinate} coordinate Projected coordinate.\n * @param {module:ol/proj~ProjectionLike=} opt_projection Projection of the coordinate.\n *     The default is Web Mercator, i.e. 'EPSG:3857'.\n * @return {module:ol/coordinate~Coordinate} Coordinate as longitude and latitude, i.e. an array\n *     with longitude as 1st and latitude as 2nd element.\n * @api\n */\nexport function toLonLat(coordinate, opt_projection) {\n  const lonLat = transform(coordinate,\n    opt_projection !== undefined ? opt_projection : 'EPSG:3857', 'EPSG:4326');\n  const lon = lonLat[0];\n  if (lon < -180 || lon > 180) {\n    lonLat[0] = modulo(lon + 180, 360) - 180;\n  }\n  return lonLat;\n}\n\n\n/**\n * Checks if two projections are the same, that is every coordinate in one\n * projection does represent the same geographic point as the same coordinate in\n * the other projection.\n *\n * @param {module:ol/proj/Projection} projection1 Projection 1.\n * @param {module:ol/proj/Projection} projection2 Projection 2.\n * @return {boolean} Equivalent.\n * @api\n */\nexport function equivalent(projection1, projection2) {\n  if (projection1 === projection2) {\n    return true;\n  }\n  const equalUnits = projection1.getUnits() === projection2.getUnits();\n  if (projection1.getCode() === projection2.getCode()) {\n    return equalUnits;\n  } else {\n    const transformFunc = getTransformFromProjections(projection1, projection2);\n    return transformFunc === cloneTransform && equalUnits;\n  }\n}\n\n\n/**\n * Searches in the list of transform functions for the function for converting\n * coordinates from the source projection to the destination projection.\n *\n * @param {module:ol/proj/Projection} sourceProjection Source Projection object.\n * @param {module:ol/proj/Projection} destinationProjection Destination Projection\n *     object.\n * @return {module:ol/proj~TransformFunction} Transform function.\n */\nexport function getTransformFromProjections(sourceProjection, destinationProjection) {\n  const sourceCode = sourceProjection.getCode();\n  const destinationCode = destinationProjection.getCode();\n  let transformFunc = getTransformFunc(sourceCode, destinationCode);\n  if (!transformFunc) {\n    transformFunc = identityTransform;\n  }\n  return transformFunc;\n}\n\n\n/**\n * Given the projection-like objects, searches for a transformation\n * function to convert a coordinates array from the source projection to the\n * destination projection.\n *\n * @param {module:ol/proj~ProjectionLike} source Source.\n * @param {module:ol/proj~ProjectionLike} destination Destination.\n * @return {module:ol/proj~TransformFunction} Transform function.\n * @api\n */\nexport function getTransform(source, destination) {\n  const sourceProjection = get(source);\n  const destinationProjection = get(destination);\n  return getTransformFromProjections(sourceProjection, destinationProjection);\n}\n\n\n/**\n * Transforms a coordinate from source projection to destination projection.\n * This returns a new coordinate (and does not modify the original).\n *\n * See {@link module:ol/proj~transformExtent} for extent transformation.\n * See the transform method of {@link module:ol/geom/Geometry~Geometry} and its\n * subclasses for geometry transforms.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/proj~ProjectionLike} source Source projection-like.\n * @param {module:ol/proj~ProjectionLike} destination Destination projection-like.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n * @api\n */\nexport function transform(coordinate, source, destination) {\n  const transformFunc = getTransform(source, destination);\n  return transformFunc(coordinate, undefined, coordinate.length);\n}\n\n\n/**\n * Transforms an extent from source projection to destination projection.  This\n * returns a new extent (and does not modify the original).\n *\n * @param {module:ol/extent~Extent} extent The extent to transform.\n * @param {module:ol/proj~ProjectionLike} source Source projection-like.\n * @param {module:ol/proj~ProjectionLike} destination Destination projection-like.\n * @return {module:ol/extent~Extent} The transformed extent.\n * @api\n */\nexport function transformExtent(extent, source, destination) {\n  const transformFunc = getTransform(source, destination);\n  return applyTransform(extent, transformFunc);\n}\n\n\n/**\n * Transforms the given point to the destination projection.\n *\n * @param {module:ol/coordinate~Coordinate} point Point.\n * @param {module:ol/proj/Projection} sourceProjection Source projection.\n * @param {module:ol/proj/Projection} destinationProjection Destination projection.\n * @return {module:ol/coordinate~Coordinate} Point.\n */\nexport function transformWithProjections(point, sourceProjection, destinationProjection) {\n  const transformFunc = getTransformFromProjections(sourceProjection, destinationProjection);\n  return transformFunc(point);\n}\n\n/**\n * Add transforms to and from EPSG:4326 and EPSG:3857.  This function is called\n * by when this module is executed and should only need to be called again after\n * `clearAllProjections()` is called (e.g. in tests).\n */\nexport function addCommon() {\n  // Add transformations that don't alter coordinates to convert within set of\n  // projections with equal meaning.\n  addEquivalentProjections(EPSG3857_PROJECTIONS);\n  addEquivalentProjections(EPSG4326_PROJECTIONS);\n  // Add transformations to convert EPSG:4326 like coordinates to EPSG:3857 like\n  // coordinates and back.\n  addEquivalentTransforms(EPSG4326_PROJECTIONS, EPSG3857_PROJECTIONS, fromEPSG4326, toEPSG4326);\n}\n\naddCommon();\n","/**\n * @module ol/transform\n */\nimport {assert} from './asserts.js';\n\n\n/**\n * An array representing an affine 2d transformation for use with\n * {@link module:ol/transform} functions. The array has 6 elements.\n * @typedef {!Array.<number>} Transform\n */\n\n\n/**\n * Collection of affine 2d transformation functions. The functions work on an\n * array of 6 elements. The element order is compatible with the [SVGMatrix\n * interface](https://developer.mozilla.org/en-US/docs/Web/API/SVGMatrix) and is\n * a subset (elements a to f) of a 33 matrix:\n * ```\n * [ a c e ]\n * [ b d f ]\n * [ 0 0 1 ]\n * ```\n */\n\n\n/**\n * @private\n * @type {module:ol/transform~Transform}\n */\nconst tmp_ = new Array(6);\n\n\n/**\n * Create an identity transform.\n * @return {!module:ol/transform~Transform} Identity transform.\n */\nexport function create() {\n  return [1, 0, 0, 1, 0, 0];\n}\n\n\n/**\n * Resets the given transform to an identity transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @return {!module:ol/transform~Transform} Transform.\n */\nexport function reset(transform) {\n  return set(transform, 1, 0, 0, 1, 0, 0);\n}\n\n\n/**\n * Multiply the underlying matrices of two transforms and return the result in\n * the first transform.\n * @param {!module:ol/transform~Transform} transform1 Transform parameters of matrix 1.\n * @param {!module:ol/transform~Transform} transform2 Transform parameters of matrix 2.\n * @return {!module:ol/transform~Transform} transform1 multiplied with transform2.\n */\nexport function multiply(transform1, transform2) {\n  const a1 = transform1[0];\n  const b1 = transform1[1];\n  const c1 = transform1[2];\n  const d1 = transform1[3];\n  const e1 = transform1[4];\n  const f1 = transform1[5];\n  const a2 = transform2[0];\n  const b2 = transform2[1];\n  const c2 = transform2[2];\n  const d2 = transform2[3];\n  const e2 = transform2[4];\n  const f2 = transform2[5];\n\n  transform1[0] = a1 * a2 + c1 * b2;\n  transform1[1] = b1 * a2 + d1 * b2;\n  transform1[2] = a1 * c2 + c1 * d2;\n  transform1[3] = b1 * c2 + d1 * d2;\n  transform1[4] = a1 * e2 + c1 * f2 + e1;\n  transform1[5] = b1 * e2 + d1 * f2 + f1;\n\n  return transform1;\n}\n\n/**\n * Set the transform components a-f on a given transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @param {number} a The a component of the transform.\n * @param {number} b The b component of the transform.\n * @param {number} c The c component of the transform.\n * @param {number} d The d component of the transform.\n * @param {number} e The e component of the transform.\n * @param {number} f The f component of the transform.\n * @return {!module:ol/transform~Transform} Matrix with transform applied.\n */\nexport function set(transform, a, b, c, d, e, f) {\n  transform[0] = a;\n  transform[1] = b;\n  transform[2] = c;\n  transform[3] = d;\n  transform[4] = e;\n  transform[5] = f;\n  return transform;\n}\n\n\n/**\n * Set transform on one matrix from another matrix.\n * @param {!module:ol/transform~Transform} transform1 Matrix to set transform to.\n * @param {!module:ol/transform~Transform} transform2 Matrix to set transform from.\n * @return {!module:ol/transform~Transform} transform1 with transform from transform2 applied.\n */\nexport function setFromArray(transform1, transform2) {\n  transform1[0] = transform2[0];\n  transform1[1] = transform2[1];\n  transform1[2] = transform2[2];\n  transform1[3] = transform2[3];\n  transform1[4] = transform2[4];\n  transform1[5] = transform2[5];\n  return transform1;\n}\n\n\n/**\n * Transforms the given coordinate with the given transform returning the\n * resulting, transformed coordinate. The coordinate will be modified in-place.\n *\n * @param {module:ol/transform~Transform} transform The transformation.\n * @param {module:ol/coordinate~Coordinate|module:ol~Pixel} coordinate The coordinate to transform.\n * @return {module:ol/coordinate~Coordinate|module:ol~Pixel} return coordinate so that operations can be\n *     chained together.\n */\nexport function apply(transform, coordinate) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n  coordinate[0] = transform[0] * x + transform[2] * y + transform[4];\n  coordinate[1] = transform[1] * x + transform[3] * y + transform[5];\n  return coordinate;\n}\n\n\n/**\n * Applies rotation to the given transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @param {number} angle Angle in radians.\n * @return {!module:ol/transform~Transform} The rotated transform.\n */\nexport function rotate(transform, angle) {\n  const cos = Math.cos(angle);\n  const sin = Math.sin(angle);\n  return multiply(transform, set(tmp_, cos, sin, -sin, cos, 0, 0));\n}\n\n\n/**\n * Applies scale to a given transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @param {number} x Scale factor x.\n * @param {number} y Scale factor y.\n * @return {!module:ol/transform~Transform} The scaled transform.\n */\nexport function scale(transform, x, y) {\n  return multiply(transform, set(tmp_, x, 0, 0, y, 0, 0));\n}\n\n\n/**\n * Applies translation to the given transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @param {number} dx Translation x.\n * @param {number} dy Translation y.\n * @return {!module:ol/transform~Transform} The translated transform.\n */\nexport function translate(transform, dx, dy) {\n  return multiply(transform, set(tmp_, 1, 0, 0, 1, dx, dy));\n}\n\n\n/**\n * Creates a composite transform given an initial translation, scale, rotation, and\n * final translation (in that order only, not commutative).\n * @param {!module:ol/transform~Transform} transform The transform (will be modified in place).\n * @param {number} dx1 Initial translation x.\n * @param {number} dy1 Initial translation y.\n * @param {number} sx Scale factor x.\n * @param {number} sy Scale factor y.\n * @param {number} angle Rotation (in counter-clockwise radians).\n * @param {number} dx2 Final translation x.\n * @param {number} dy2 Final translation y.\n * @return {!module:ol/transform~Transform} The composite transform.\n */\nexport function compose(transform, dx1, dy1, sx, sy, angle, dx2, dy2) {\n  const sin = Math.sin(angle);\n  const cos = Math.cos(angle);\n  transform[0] = sx * cos;\n  transform[1] = sy * sin;\n  transform[2] = -sx * sin;\n  transform[3] = sy * cos;\n  transform[4] = dx2 * sx * cos - dy2 * sx * sin + dx1;\n  transform[5] = dx2 * sy * sin + dy2 * sy * cos + dy1;\n  return transform;\n}\n\n\n/**\n * Invert the given transform.\n * @param {!module:ol/transform~Transform} transform Transform.\n * @return {!module:ol/transform~Transform} Inverse of the transform.\n */\nexport function invert(transform) {\n  const det = determinant(transform);\n  assert(det !== 0, 32); // Transformation matrix cannot be inverted\n\n  const a = transform[0];\n  const b = transform[1];\n  const c = transform[2];\n  const d = transform[3];\n  const e = transform[4];\n  const f = transform[5];\n\n  transform[0] = d / det;\n  transform[1] = -b / det;\n  transform[2] = -c / det;\n  transform[3] = a / det;\n  transform[4] = (c * f - d * e) / det;\n  transform[5] = -(a * f - b * e) / det;\n\n  return transform;\n}\n\n\n/**\n * Returns the determinant of the given matrix.\n * @param {!module:ol/transform~Transform} mat Matrix.\n * @return {number} Determinant.\n */\nexport function determinant(mat) {\n  return mat[0] * mat[3] - mat[1] * mat[2];\n}\n","/**\n * @module ol/geom/Geometry\n */\nimport {inherits} from '../util.js';\nimport BaseObject from '../Object.js';\nimport {createEmpty, getHeight, returnOrUpdate} from '../extent.js';\nimport {FALSE} from '../functions.js';\nimport {transform2D} from '../geom/flat/transform.js';\nimport {get as getProjection, getTransform} from '../proj.js';\nimport Units from '../proj/Units.js';\nimport {create as createTransform, compose as composeTransform} from '../transform.js';\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for vector geometries.\n *\n * To get notified of changes to the geometry, register a listener for the\n * generic `change` event on your geometry instance.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/Object}\n * @api\n */\nconst Geometry = function() {\n\n  BaseObject.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = createEmpty();\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.extentRevision_ = -1;\n\n  /**\n   * @protected\n   * @type {Object.<string, module:ol/geom/Geometry>}\n   */\n  this.simplifiedGeometryCache = {};\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.simplifiedGeometryMaxMinSquaredTolerance = 0;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.simplifiedGeometryRevision = 0;\n\n};\n\ninherits(Geometry, BaseObject);\n\n\n/**\n * @type {module:ol/transform~Transform}\n */\nconst tmpTransform = createTransform();\n\n\n/**\n * Make a complete copy of the geometry.\n * @abstract\n * @return {!module:ol/geom/Geometry} Clone.\n */\nGeometry.prototype.clone = function() {};\n\n\n/**\n * @abstract\n * @param {number} x X.\n * @param {number} y Y.\n * @param {module:ol/coordinate~Coordinate} closestPoint Closest point.\n * @param {number} minSquaredDistance Minimum squared distance.\n * @return {number} Minimum squared distance.\n */\nGeometry.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {};\n\n\n/**\n * Return the closest point of the geometry to the passed point as\n * {@link module:ol/coordinate~Coordinate coordinate}.\n * @param {module:ol/coordinate~Coordinate} point Point.\n * @param {module:ol/coordinate~Coordinate=} opt_closestPoint Closest point.\n * @return {module:ol/coordinate~Coordinate} Closest point.\n * @api\n */\nGeometry.prototype.getClosestPoint = function(point, opt_closestPoint) {\n  const closestPoint = opt_closestPoint ? opt_closestPoint : [NaN, NaN];\n  this.closestPointXY(point[0], point[1], closestPoint, Infinity);\n  return closestPoint;\n};\n\n\n/**\n * Returns true if this geometry includes the specified coordinate. If the\n * coordinate is on the boundary of the geometry, returns false.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @return {boolean} Contains coordinate.\n * @api\n */\nGeometry.prototype.intersectsCoordinate = function(coordinate) {\n  return this.containsXY(coordinate[0], coordinate[1]);\n};\n\n\n/**\n * @abstract\n * @param {module:ol/extent~Extent} extent Extent.\n * @protected\n * @return {module:ol/extent~Extent} extent Extent.\n */\nGeometry.prototype.computeExtent = function(extent) {};\n\n\n/**\n * @param {number} x X.\n * @param {number} y Y.\n * @return {boolean} Contains (x, y).\n */\nGeometry.prototype.containsXY = FALSE;\n\n\n/**\n * Get the extent of the geometry.\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} extent Extent.\n * @api\n */\nGeometry.prototype.getExtent = function(opt_extent) {\n  if (this.extentRevision_ != this.getRevision()) {\n    this.extent_ = this.computeExtent(this.extent_);\n    this.extentRevision_ = this.getRevision();\n  }\n  return returnOrUpdate(this.extent_, opt_extent);\n};\n\n\n/**\n * Rotate the geometry around a given coordinate. This modifies the geometry\n * coordinates in place.\n * @abstract\n * @param {number} angle Rotation angle in radians.\n * @param {module:ol/coordinate~Coordinate} anchor The rotation center.\n * @api\n */\nGeometry.prototype.rotate = function(angle, anchor) {};\n\n\n/**\n * Scale the geometry (with an optional origin).  This modifies the geometry\n * coordinates in place.\n * @abstract\n * @param {number} sx The scaling factor in the x-direction.\n * @param {number=} opt_sy The scaling factor in the y-direction (defaults to\n *     sx).\n * @param {module:ol/coordinate~Coordinate=} opt_anchor The scale origin (defaults to the center\n *     of the geometry extent).\n * @api\n */\nGeometry.prototype.scale = function(sx, opt_sy, opt_anchor) {};\n\n\n/**\n * Create a simplified version of this geometry.  For linestrings, this uses\n * the the {@link\n * https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm\n * Douglas Peucker} algorithm.  For polygons, a quantization-based\n * simplification is used to preserve topology.\n * @function\n * @param {number} tolerance The tolerance distance for simplification.\n * @return {module:ol/geom/Geometry} A new, simplified version of the original\n *     geometry.\n * @api\n */\nGeometry.prototype.simplify = function(tolerance) {\n  return this.getSimplifiedGeometry(tolerance * tolerance);\n};\n\n\n/**\n * Create a simplified version of this geometry using the Douglas Peucker\n * algorithm.\n * @see https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm\n * @abstract\n * @param {number} squaredTolerance Squared tolerance.\n * @return {module:ol/geom/Geometry} Simplified geometry.\n */\nGeometry.prototype.getSimplifiedGeometry = function(squaredTolerance) {};\n\n\n/**\n * Get the type of this geometry.\n * @abstract\n * @return {module:ol/geom/GeometryType} Geometry type.\n */\nGeometry.prototype.getType = function() {};\n\n\n/**\n * Apply a transform function to each coordinate of the geometry.\n * The geometry is modified in place.\n * If you do not want the geometry modified in place, first `clone()` it and\n * then use this function on the clone.\n * @abstract\n * @param {module:ol/proj~TransformFunction} transformFn Transform.\n */\nGeometry.prototype.applyTransform = function(transformFn) {};\n\n\n/**\n * Test if the geometry and the passed extent intersect.\n * @abstract\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} `true` if the geometry and the extent intersect.\n */\nGeometry.prototype.intersectsExtent = function(extent) {};\n\n\n/**\n * Translate the geometry.  This modifies the geometry coordinates in place.  If\n * instead you want a new geometry, first `clone()` this geometry.\n * @abstract\n * @param {number} deltaX Delta X.\n * @param {number} deltaY Delta Y.\n */\nGeometry.prototype.translate = function(deltaX, deltaY) {};\n\n\n/**\n * Transform each coordinate of the geometry from one coordinate reference\n * system to another. The geometry is modified in place.\n * For example, a line will be transformed to a line and a circle to a circle.\n * If you do not want the geometry modified in place, first `clone()` it and\n * then use this function on the clone.\n *\n * @param {module:ol/proj~ProjectionLike} source The current projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @param {module:ol/proj~ProjectionLike} destination The desired projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @return {module:ol/geom/Geometry} This geometry.  Note that original geometry is\n *     modified in place.\n * @api\n */\nGeometry.prototype.transform = function(source, destination) {\n  source = getProjection(source);\n  const transformFn = source.getUnits() == Units.TILE_PIXELS ?\n    function(inCoordinates, outCoordinates, stride) {\n      const pixelExtent = source.getExtent();\n      const projectedExtent = source.getWorldExtent();\n      const scale = getHeight(projectedExtent) / getHeight(pixelExtent);\n      composeTransform(tmpTransform,\n        projectedExtent[0], projectedExtent[3],\n        scale, -scale, 0,\n        0, 0);\n      transform2D(inCoordinates, 0, inCoordinates.length, stride,\n        tmpTransform, outCoordinates);\n      return getTransform(source, destination)(inCoordinates, outCoordinates, stride);\n    } :\n    getTransform(source, destination);\n  this.applyTransform(transformFn);\n  return this;\n};\nexport default Geometry;\n","/**\n * @module ol/color\n */\nimport {assert} from './asserts.js';\nimport {clamp} from './math.js';\n\n\n/**\n * A color represented as a short array [red, green, blue, alpha].\n * red, green, and blue should be integers in the range 0..255 inclusive.\n * alpha should be a float in the range 0..1 inclusive. If no alpha value is\n * given then `1` will be used.\n * @typedef {Array.<number>} Color\n * @api\n */\n\n\n/**\n * This RegExp matches # followed by 3, 4, 6, or 8 hex digits.\n * @const\n * @type {RegExp}\n * @private\n */\nconst HEX_COLOR_RE_ = /^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i;\n\n\n/**\n * Regular expression for matching potential named color style strings.\n * @const\n * @type {RegExp}\n * @private\n */\nconst NAMED_COLOR_RE_ = /^([a-z]*)$/i;\n\n\n/**\n * Return the color as an rgba string.\n * @param {module:ol/color~Color|string} color Color.\n * @return {string} Rgba string.\n * @api\n */\nexport function asString(color) {\n  if (typeof color === 'string') {\n    return color;\n  } else {\n    return toString(color);\n  }\n}\n\n/**\n * Return named color as an rgba string.\n * @param {string} color Named color.\n * @return {string} Rgb string.\n */\nfunction fromNamed(color) {\n  const el = document.createElement('div');\n  el.style.color = color;\n  if (el.style.color !== '') {\n    document.body.appendChild(el);\n    const rgb = getComputedStyle(el).color;\n    document.body.removeChild(el);\n    return rgb;\n  } else {\n    return '';\n  }\n}\n\n\n/**\n * @param {string} s String.\n * @return {module:ol/color~Color} Color.\n */\nexport const fromString = (\n  function() {\n\n    // We maintain a small cache of parsed strings.  To provide cheap LRU-like\n    // semantics, whenever the cache grows too large we simply delete an\n    // arbitrary 25% of the entries.\n\n    /**\n     * @const\n     * @type {number}\n     */\n    const MAX_CACHE_SIZE = 1024;\n\n    /**\n     * @type {Object.<string, module:ol/color~Color>}\n     */\n    const cache = {};\n\n    /**\n     * @type {number}\n     */\n    let cacheSize = 0;\n\n    return (\n      /**\n       * @param {string} s String.\n       * @return {module:ol/color~Color} Color.\n       */\n      function(s) {\n        let color;\n        if (cache.hasOwnProperty(s)) {\n          color = cache[s];\n        } else {\n          if (cacheSize >= MAX_CACHE_SIZE) {\n            let i = 0;\n            for (const key in cache) {\n              if ((i++ & 3) === 0) {\n                delete cache[key];\n                --cacheSize;\n              }\n            }\n          }\n          color = fromStringInternal_(s);\n          cache[s] = color;\n          ++cacheSize;\n        }\n        return color;\n      }\n    );\n\n  })();\n\n/**\n * Return the color as an array. This function maintains a cache of calculated\n * arrays which means the result should not be modified.\n * @param {module:ol/color~Color|string} color Color.\n * @return {module:ol/color~Color} Color.\n * @api\n */\nexport function asArray(color) {\n  if (Array.isArray(color)) {\n    return color;\n  } else {\n    return fromString(/** @type {string} */ (color));\n  }\n}\n\n/**\n * @param {string} s String.\n * @private\n * @return {module:ol/color~Color} Color.\n */\nfunction fromStringInternal_(s) {\n  let r, g, b, a, color;\n\n  if (NAMED_COLOR_RE_.exec(s)) {\n    s = fromNamed(s);\n  }\n\n  if (HEX_COLOR_RE_.exec(s)) { // hex\n    const n = s.length - 1; // number of hex digits\n    let d; // number of digits per channel\n    if (n <= 4) {\n      d = 1;\n    } else {\n      d = 2;\n    }\n    const hasAlpha = n === 4 || n === 8;\n    r = parseInt(s.substr(1 + 0 * d, d), 16);\n    g = parseInt(s.substr(1 + 1 * d, d), 16);\n    b = parseInt(s.substr(1 + 2 * d, d), 16);\n    if (hasAlpha) {\n      a = parseInt(s.substr(1 + 3 * d, d), 16);\n    } else {\n      a = 255;\n    }\n    if (d == 1) {\n      r = (r << 4) + r;\n      g = (g << 4) + g;\n      b = (b << 4) + b;\n      if (hasAlpha) {\n        a = (a << 4) + a;\n      }\n    }\n    color = [r, g, b, a / 255];\n  } else if (s.indexOf('rgba(') == 0) { // rgba()\n    color = s.slice(5, -1).split(',').map(Number);\n    normalize(color);\n  } else if (s.indexOf('rgb(') == 0) { // rgb()\n    color = s.slice(4, -1).split(',').map(Number);\n    color.push(1);\n    normalize(color);\n  } else {\n    assert(false, 14); // Invalid color\n  }\n  return (\n    /** @type {module:ol/color~Color} */ (color)\n  );\n}\n\n\n/**\n * TODO this function is only used in the test, we probably shouldn't export it\n * @param {module:ol/color~Color} color Color.\n * @return {module:ol/color~Color} Clamped color.\n */\nexport function normalize(color) {\n  color[0] = clamp((color[0] + 0.5) | 0, 0, 255);\n  color[1] = clamp((color[1] + 0.5) | 0, 0, 255);\n  color[2] = clamp((color[2] + 0.5) | 0, 0, 255);\n  color[3] = clamp(color[3], 0, 1);\n  return color;\n}\n\n\n/**\n * @param {module:ol/color~Color} color Color.\n * @return {string} String.\n */\nexport function toString(color) {\n  let r = color[0];\n  if (r != (r | 0)) {\n    r = (r + 0.5) | 0;\n  }\n  let g = color[1];\n  if (g != (g | 0)) {\n    g = (g + 0.5) | 0;\n  }\n  let b = color[2];\n  if (b != (b | 0)) {\n    b = (b + 0.5) | 0;\n  }\n  const a = color[3] === undefined ? 1 : color[3];\n  return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n}\n","/**\n * @module ol/colorlike\n */\nimport {toString} from './color.js';\n\n\n/**\n * A type accepted by CanvasRenderingContext2D.fillStyle\n * or CanvasRenderingContext2D.strokeStyle.\n * Represents a color, pattern, or gradient. The origin for patterns and\n * gradients as fill style is an increment of 512 css pixels from map coordinate\n * `[0, 0]`. For seamless repeat patterns, width and height of the pattern image\n * must be a factor of two (2, 4, 8, ..., 512).\n *\n * @typedef {string|CanvasPattern|CanvasGradient} ColorLike\n * @api\n */\n\n\n/**\n * @param {module:ol/color~Color|module:ol/colorlike~ColorLike} color Color.\n * @return {module:ol/colorlike~ColorLike} The color as an {@link ol/colorlike~ColorLike}.\n * @api\n */\nexport function asColorLike(color) {\n  if (isColorLike(color)) {\n    return /** @type {string|CanvasPattern|CanvasGradient} */ (color);\n  } else {\n    return toString(/** @type {module:ol/color~Color} */ (color));\n  }\n}\n\n\n/**\n * @param {?} color The value that is potentially an {@link ol/colorlike~ColorLike}.\n * @return {boolean} The color is an {@link ol/colorlike~ColorLike}.\n */\nexport function isColorLike(color) {\n  return (\n    typeof color === 'string' ||\n    color instanceof CanvasPattern ||\n    color instanceof CanvasGradient\n  );\n}\n","/**\n * @module ol/dom\n */\n\n\n/**\n * Create an html canvas element and returns its 2d context.\n * @param {number=} opt_width Canvas width.\n * @param {number=} opt_height Canvas height.\n * @return {CanvasRenderingContext2D} The context.\n */\nexport function createCanvasContext2D(opt_width, opt_height) {\n  const canvas = /** @type {HTMLCanvasElement} */ (document.createElement('CANVAS'));\n  if (opt_width) {\n    canvas.width = opt_width;\n  }\n  if (opt_height) {\n    canvas.height = opt_height;\n  }\n  return /** @type {CanvasRenderingContext2D} */ (canvas.getContext('2d'));\n}\n\n\n/**\n * Get the current computed width for the given element including margin,\n * padding and border.\n * Equivalent to jQuery's `$(el).outerWidth(true)`.\n * @param {!Element} element Element.\n * @return {number} The width.\n */\nexport function outerWidth(element) {\n  let width = element.offsetWidth;\n  const style = getComputedStyle(element);\n  width += parseInt(style.marginLeft, 10) + parseInt(style.marginRight, 10);\n\n  return width;\n}\n\n\n/**\n * Get the current computed height for the given element including margin,\n * padding and border.\n * Equivalent to jQuery's `$(el).outerHeight(true)`.\n * @param {!Element} element Element.\n * @return {number} The height.\n */\nexport function outerHeight(element) {\n  let height = element.offsetHeight;\n  const style = getComputedStyle(element);\n  height += parseInt(style.marginTop, 10) + parseInt(style.marginBottom, 10);\n\n  return height;\n}\n\n/**\n * @param {Node} newNode Node to replace old node\n * @param {Node} oldNode The node to be replaced\n */\nexport function replaceNode(newNode, oldNode) {\n  const parent = oldNode.parentNode;\n  if (parent) {\n    parent.replaceChild(newNode, oldNode);\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n","/**\n * @module ol/webgl\n */\n\n\n/**\n * Constants taken from goog.webgl\n */\n\n\n/**\n * @const\n * @type {number}\n */\nexport const ONE = 1;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const SRC_ALPHA = 0x0302;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const COLOR_ATTACHMENT0 = 0x8CE0;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const COLOR_BUFFER_BIT = 0x00004000;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TRIANGLES = 0x0004;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TRIANGLE_STRIP = 0x0005;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const ONE_MINUS_SRC_ALPHA = 0x0303;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const ARRAY_BUFFER = 0x8892;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const ELEMENT_ARRAY_BUFFER = 0x8893;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const STREAM_DRAW = 0x88E0;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const STATIC_DRAW = 0x88E4;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DYNAMIC_DRAW = 0x88E8;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const CULL_FACE = 0x0B44;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const BLEND = 0x0BE2;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const STENCIL_TEST = 0x0B90;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEPTH_TEST = 0x0B71;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const SCISSOR_TEST = 0x0C11;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_BYTE = 0x1401;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_SHORT = 0x1403;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const UNSIGNED_INT = 0x1405;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const FLOAT = 0x1406;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const RGBA = 0x1908;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const FRAGMENT_SHADER = 0x8B30;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const VERTEX_SHADER = 0x8B31;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const LINK_STATUS = 0x8B82;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const LINEAR = 0x2601;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE_MAG_FILTER = 0x2800;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE_MIN_FILTER = 0x2801;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE_WRAP_S = 0x2802;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE_WRAP_T = 0x2803;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE_2D = 0x0DE1;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const TEXTURE0 = 0x84C0;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const CLAMP_TO_EDGE = 0x812F;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const COMPILE_STATUS = 0x8B81;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const FRAMEBUFFER = 0x8D40;\n\n\n/** end of goog.webgl constants\n */\n\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst CONTEXT_IDS = [\n  'experimental-webgl',\n  'webgl',\n  'webkit-3d',\n  'moz-webgl'\n];\n\n\n/**\n * @param {HTMLCanvasElement} canvas Canvas.\n * @param {Object=} opt_attributes Attributes.\n * @return {WebGLRenderingContext} WebGL rendering context.\n */\nexport function getContext(canvas, opt_attributes) {\n  const ii = CONTEXT_IDS.length;\n  for (let i = 0; i < ii; ++i) {\n    try {\n      const context = canvas.getContext(CONTEXT_IDS[i], opt_attributes);\n      if (context) {\n        return /** @type {!WebGLRenderingContext} */ (context);\n      }\n    } catch (e) {\n      // pass\n    }\n  }\n  return null;\n}\n\n\n/**\n * Include debuggable shader sources.  Default is `true`. This should be set to\n * `false` for production builds.\n * @type {boolean}\n */\nexport const DEBUG = true;\n\n\n/**\n * The maximum supported WebGL texture size in pixels. If WebGL is not\n * supported, the value is set to `undefined`.\n * @type {number|undefined}\n */\nlet MAX_TEXTURE_SIZE; // value is set below\n\n\n/**\n * List of supported WebGL extensions.\n * @type {Array.<string>}\n */\nlet EXTENSIONS; // value is set below\n\n\n/**\n * True if both OpenLayers and browser support WebGL.\n * @const ol/has.WEBGL\n * @type {boolean}\n * @api\n */\nlet HAS = false;\n\n//TODO Remove side effects\nif (typeof window !== 'undefined' && 'WebGLRenderingContext' in window) {\n  try {\n    const canvas = /** @type {HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const gl = getContext(canvas, {failIfMajorPerformanceCaveat: true});\n    if (gl) {\n      HAS = true;\n      MAX_TEXTURE_SIZE = /** @type {number} */ (gl.getParameter(gl.MAX_TEXTURE_SIZE));\n      EXTENSIONS = gl.getSupportedExtensions();\n    }\n  } catch (e) {\n    // pass\n  }\n}\n\nexport {HAS, MAX_TEXTURE_SIZE, EXTENSIONS};\n","/**\n * @module ol/has\n */\n\nconst ua = typeof navigator !== 'undefined' ?\n  navigator.userAgent.toLowerCase() : '';\n\n/**\n * User agent string says we are dealing with Firefox as browser.\n * @type {boolean}\n */\nexport const FIREFOX = ua.indexOf('firefox') !== -1;\n\n/**\n * User agent string says we are dealing with Safari as browser.\n * @type {boolean}\n */\nexport const SAFARI = ua.indexOf('safari') !== -1 && ua.indexOf('chrom') == -1;\n\n/**\n * User agent string says we are dealing with a WebKit engine.\n * @type {boolean}\n */\nexport const WEBKIT = ua.indexOf('webkit') !== -1 && ua.indexOf('edge') == -1;\n\n/**\n * User agent string says we are dealing with a Mac as platform.\n * @type {boolean}\n */\nexport const MAC = ua.indexOf('macintosh') !== -1;\n\n\n/**\n * The ratio between physical pixels and device-independent pixels\n * (dips) on the device (`window.devicePixelRatio`).\n * @const\n * @type {number}\n * @api\n */\nexport const DEVICE_PIXEL_RATIO = window.devicePixelRatio || 1;\n\n\n/**\n * True if the browser's Canvas implementation implements {get,set}LineDash.\n * @type {boolean}\n */\nexport const CANVAS_LINE_DASH = function() {\n  let has = false;\n  try {\n    has = !!document.createElement('CANVAS').getContext('2d').setLineDash;\n  } catch (e) {\n    // pass\n  }\n  return has;\n}();\n\n\n/**\n * Is HTML5 geolocation supported in the current browser?\n * @const\n * @type {boolean}\n * @api\n */\nexport const GEOLOCATION = 'geolocation' in navigator;\n\n\n/**\n * True if browser supports touch events.\n * @const\n * @type {boolean}\n * @api\n */\nexport const TOUCH = 'ontouchstart' in window;\n\n\n/**\n * True if browser supports pointer events.\n * @const\n * @type {boolean}\n */\nexport const POINTER = 'PointerEvent' in window;\n\n\n/**\n * True if browser supports ms pointer events (IE 10).\n * @const\n * @type {boolean}\n */\nexport const MSPOINTER = !!(navigator.msPointerEnabled);\n\n\nexport {HAS as WEBGL} from './webgl.js';\n","/**\n * @module ol/css\n */\n\n\n/**\n * The CSS class for hidden feature.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_HIDDEN = 'ol-hidden';\n\n\n/**\n * The CSS class that we'll give the DOM elements to have them selectable.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_SELECTABLE = 'ol-selectable';\n\n\n/**\n * The CSS class that we'll give the DOM elements to have them unselectable.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_UNSELECTABLE = 'ol-unselectable';\n\n\n/**\n * The CSS class for unsupported feature.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_UNSUPPORTED = 'ol-unsupported';\n\n\n/**\n * The CSS class for controls.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_CONTROL = 'ol-control';\n\n\n/**\n * The CSS class that we'll give the DOM elements that are collapsed, i.e.\n * to those elements which usually can be expanded.\n *\n * @const\n * @type {string}\n */\nexport const CLASS_COLLAPSED = 'ol-collapsed';\n\n\n/**\n * Get the list of font families from a font spec.  Note that this doesn't work\n * for font families that have commas in them.\n * @param {string} The CSS font property.\n * @return {Object.<string>} The font families (or null if the input spec is invalid).\n */\nexport const getFontFamilies = (function() {\n  let style;\n  const cache = {};\n  return function(font) {\n    if (!style) {\n      style = document.createElement('div').style;\n    }\n    if (!(font in cache)) {\n      style.font = font;\n      const family = style.fontFamily;\n      style.font = '';\n      if (!family) {\n        return null;\n      }\n      cache[font] = family.split(/,\\s?/);\n    }\n    return cache[font];\n  };\n})();\n","/**\n * @module ol/ImageState\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  IDLE: 0,\n  LOADING: 1,\n  LOADED: 2,\n  ERROR: 3\n};\n","/**\n * @module ol/structs/LRUCache\n */\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport EventTarget from '../events/EventTarget.js';\nimport EventType from '../events/EventType.js';\n\n\n/**\n * @typedef {Object} Entry\n * @property {string} key_\n * @property {Object} newer\n * @property {Object} older\n * @property {*} value_\n */\n\n\n/**\n * Implements a Least-Recently-Used cache where the keys do not conflict with\n * Object's properties (e.g. 'hasOwnProperty' is not allowed as a key). Expiring\n * items from the cache is the responsibility of the user.\n * @constructor\n * @extends {module:ol/events/EventTarget}\n * @fires module:ol/events/Event~Event\n * @struct\n * @template T\n * @param {number=} opt_highWaterMark High water mark.\n */\nconst LRUCache = function(opt_highWaterMark) {\n\n  EventTarget.call(this);\n\n  /**\n   * @type {number}\n   */\n  this.highWaterMark = opt_highWaterMark !== undefined ? opt_highWaterMark : 2048;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.count_ = 0;\n\n  /**\n   * @private\n   * @type {!Object.<string, module:ol/structs/LRUCache~Entry>}\n   */\n  this.entries_ = {};\n\n  /**\n   * @private\n   * @type {?module:ol/structs/LRUCache~Entry}\n   */\n  this.oldest_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/structs/LRUCache~Entry}\n   */\n  this.newest_ = null;\n\n};\n\ninherits(LRUCache, EventTarget);\n\n\n/**\n * @return {boolean} Can expire cache.\n */\nLRUCache.prototype.canExpireCache = function() {\n  return this.getCount() > this.highWaterMark;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nLRUCache.prototype.clear = function() {\n  this.count_ = 0;\n  this.entries_ = {};\n  this.oldest_ = null;\n  this.newest_ = null;\n  this.dispatchEvent(EventType.CLEAR);\n};\n\n\n/**\n * @param {string} key Key.\n * @return {boolean} Contains key.\n */\nLRUCache.prototype.containsKey = function(key) {\n  return this.entries_.hasOwnProperty(key);\n};\n\n\n/**\n * @param {function(this: S, T, string, module:ol/structs/LRUCache): ?} f The function\n *     to call for every entry from the oldest to the newer. This function takes\n *     3 arguments (the entry value, the entry key and the LRUCache object).\n *     The return value is ignored.\n * @param {S=} opt_this The object to use as `this` in `f`.\n * @template S\n */\nLRUCache.prototype.forEach = function(f, opt_this) {\n  let entry = this.oldest_;\n  while (entry) {\n    f.call(opt_this, entry.value_, entry.key_, this);\n    entry = entry.newer;\n  }\n};\n\n\n/**\n * @param {string} key Key.\n * @return {T} Value.\n */\nLRUCache.prototype.get = function(key) {\n  const entry = this.entries_[key];\n  assert(entry !== undefined,\n    15); // Tried to get a value for a key that does not exist in the cache\n  if (entry === this.newest_) {\n    return entry.value_;\n  } else if (entry === this.oldest_) {\n    this.oldest_ = /** @type {module:ol/structs/LRUCache~Entry} */ (this.oldest_.newer);\n    this.oldest_.older = null;\n  } else {\n    entry.newer.older = entry.older;\n    entry.older.newer = entry.newer;\n  }\n  entry.newer = null;\n  entry.older = this.newest_;\n  this.newest_.newer = entry;\n  this.newest_ = entry;\n  return entry.value_;\n};\n\n\n/**\n * Remove an entry from the cache.\n * @param {string} key The entry key.\n * @return {T} The removed entry.\n */\nLRUCache.prototype.remove = function(key) {\n  const entry = this.entries_[key];\n  assert(entry !== undefined, 15); // Tried to get a value for a key that does not exist in the cache\n  if (entry === this.newest_) {\n    this.newest_ = /** @type {module:ol/structs/LRUCache~Entry} */ (entry.older);\n    if (this.newest_) {\n      this.newest_.newer = null;\n    }\n  } else if (entry === this.oldest_) {\n    this.oldest_ = /** @type {module:ol/structs/LRUCache~Entry} */ (entry.newer);\n    if (this.oldest_) {\n      this.oldest_.older = null;\n    }\n  } else {\n    entry.newer.older = entry.older;\n    entry.older.newer = entry.newer;\n  }\n  delete this.entries_[key];\n  --this.count_;\n  return entry.value_;\n};\n\n\n/**\n * @return {number} Count.\n */\nLRUCache.prototype.getCount = function() {\n  return this.count_;\n};\n\n\n/**\n * @return {Array.<string>} Keys.\n */\nLRUCache.prototype.getKeys = function() {\n  const keys = new Array(this.count_);\n  let i = 0;\n  let entry;\n  for (entry = this.newest_; entry; entry = entry.older) {\n    keys[i++] = entry.key_;\n  }\n  return keys;\n};\n\n\n/**\n * @return {Array.<T>} Values.\n */\nLRUCache.prototype.getValues = function() {\n  const values = new Array(this.count_);\n  let i = 0;\n  let entry;\n  for (entry = this.newest_; entry; entry = entry.older) {\n    values[i++] = entry.value_;\n  }\n  return values;\n};\n\n\n/**\n * @return {T} Last value.\n */\nLRUCache.prototype.peekLast = function() {\n  return this.oldest_.value_;\n};\n\n\n/**\n * @return {string} Last key.\n */\nLRUCache.prototype.peekLastKey = function() {\n  return this.oldest_.key_;\n};\n\n\n/**\n * Get the key of the newest item in the cache.  Throws if the cache is empty.\n * @return {string} The newest key.\n */\nLRUCache.prototype.peekFirstKey = function() {\n  return this.newest_.key_;\n};\n\n\n/**\n * @return {T} value Value.\n */\nLRUCache.prototype.pop = function() {\n  const entry = this.oldest_;\n  delete this.entries_[entry.key_];\n  if (entry.newer) {\n    entry.newer.older = null;\n  }\n  this.oldest_ = /** @type {module:ol/structs/LRUCache~Entry} */ (entry.newer);\n  if (!this.oldest_) {\n    this.newest_ = null;\n  }\n  --this.count_;\n  return entry.value_;\n};\n\n\n/**\n * @param {string} key Key.\n * @param {T} value Value.\n */\nLRUCache.prototype.replace = function(key, value) {\n  this.get(key);  // update `newest_`\n  this.entries_[key].value_ = value;\n};\n\n\n/**\n * @param {string} key Key.\n * @param {T} value Value.\n */\nLRUCache.prototype.set = function(key, value) {\n  assert(!(key in this.entries_),\n    16); // Tried to set a value for a key that is used already\n  const entry = /** @type {module:ol/structs/LRUCache~Entry} */ ({\n    key_: key,\n    newer: null,\n    older: this.newest_,\n    value_: value\n  });\n  if (!this.newest_) {\n    this.oldest_ = entry;\n  } else {\n    this.newest_.newer = entry;\n  }\n  this.newest_ = entry;\n  this.entries_[key] = entry;\n  ++this.count_;\n};\n\n\n/**\n * Set a maximum number of entries for the cache.\n * @param {number} size Cache size.\n * @api\n */\nLRUCache.prototype.setSize = function(size) {\n  this.highWaterMark = size;\n};\n\n\n/**\n * Prune the cache.\n */\nLRUCache.prototype.prune = function() {\n  while (this.canExpireCache()) {\n    this.pop();\n  }\n};\nexport default LRUCache;\n","/**\n * @module ol/render/canvas\n */\nimport {getFontFamilies} from '../css.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {clear} from '../obj.js';\nimport LRUCache from '../structs/LRUCache.js';\nimport {create as createTransform} from '../transform.js';\n\n\n/**\n * @typedef {Object} FillState\n * @property {module:ol/colorlike~ColorLike} fillStyle\n */\n\n\n/**\n * @typedef {Object} FillStrokeState\n * @property {module:ol/colorlike~ColorLike} [currentFillStyle]\n * @property {module:ol/colorlike~ColorLike} [currentStrokeStyle]\n * @property {string} [currentLineCap]\n * @property {Array.<number>} currentLineDash\n * @property {number} [currentLineDashOffset]\n * @property {string} [currentLineJoin]\n * @property {number} [currentLineWidth]\n * @property {number} [currentMiterLimit]\n * @property {number} [lastStroke]\n * @property {module:ol/colorlike~ColorLike} [fillStyle]\n * @property {module:ol/colorlike~ColorLike} [strokeStyle]\n * @property {string} [lineCap]\n * @property {Array.<number>} lineDash\n * @property {number} [lineDashOffset]\n * @property {string} [lineJoin]\n * @property {number} [lineWidth]\n * @property {number} [miterLimit]\n */\n\n\n/**\n * @typedef {Object} StrokeState\n * @property {string} lineCap\n * @property {Array.<number>} lineDash\n * @property {number} lineDashOffset\n * @property {string} lineJoin\n * @property {number} lineWidth\n * @property {number} miterLimit\n * @property {module:ol/colorlike~ColorLike} strokeStyle\n */\n\n\n/**\n * @typedef {Object} TextState\n * @property {string} font\n * @property {string} [textAlign]\n * @property {string} textBaseline\n */\n\n\n/**\n * Container for decluttered replay instructions that need to be rendered or\n * omitted together, i.e. when styles render both an image and text, or for the\n * characters that form text along lines. The basic elements of this array are\n * `[minX, minY, maxX, maxY, count]`, where the first four entries are the\n * rendered extent of the group in pixel space. `count` is the number of styles\n * in the group, i.e. 2 when an image and a text are grouped, or 1 otherwise.\n * In addition to these four elements, declutter instruction arrays (i.e. the\n * arguments to {@link module:ol/render/canvas~drawImage} are appended to the array.\n * @typedef {Array.<*>} DeclutterGroup\n */\n\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultFont = '10px sans-serif';\n\n\n/**\n * @const\n * @type {module:ol/color~Color}\n */\nexport const defaultFillStyle = [0, 0, 0, 1];\n\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultLineCap = 'round';\n\n\n/**\n * @const\n * @type {Array.<number>}\n */\nexport const defaultLineDash = [];\n\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultLineDashOffset = 0;\n\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultLineJoin = 'round';\n\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultMiterLimit = 10;\n\n\n/**\n * @const\n * @type {module:ol/color~Color}\n */\nexport const defaultStrokeStyle = [0, 0, 0, 1];\n\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultTextAlign = 'center';\n\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultTextBaseline = 'middle';\n\n\n/**\n * @const\n * @type {Array.<number>}\n */\nexport const defaultPadding = [0, 0, 0, 0];\n\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultLineWidth = 1;\n\n\n/**\n * The label cache for text rendering. To change the default cache size of 2048\n * entries, use {@link module:ol/structs/LRUCache#setSize}.\n * @type {module:ol/structs/LRUCache.<HTMLCanvasElement>}\n * @api\n */\nexport const labelCache = new LRUCache();\n\n\n/**\n * @type {!Object.<string, number>}\n */\nexport const checkedFonts = {};\n\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet measureContext = null;\n\n\n/**\n * @type {!Object.<string, number>}\n */\nexport const textHeights = {};\n\n\n/**\n * Clears the label cache when a font becomes available.\n * @param {string} fontSpec CSS font spec.\n */\nexport const checkFont = (function() {\n  const retries = 60;\n  const checked = checkedFonts;\n  const size = '32px ';\n  const referenceFonts = ['monospace', 'serif'];\n  const len = referenceFonts.length;\n  const text = 'wmytzilWMYTZIL@#/&?$%10\\uF013';\n  let interval, referenceWidth;\n\n  function isAvailable(font) {\n    const context = getMeasureContext();\n    let available = true;\n    for (let i = 0; i < len; ++i) {\n      const referenceFont = referenceFonts[i];\n      context.font = size + referenceFont;\n      referenceWidth = context.measureText(text).width;\n      if (font != referenceFont) {\n        context.font = size + font + ',' + referenceFont;\n        const width = context.measureText(text).width;\n        // If width and referenceWidth are the same, then the fallback was used\n        // instead of the font we wanted, so the font is not available.\n        available = available && width != referenceWidth;\n      }\n    }\n    return available;\n  }\n\n  function check() {\n    let done = true;\n    for (const font in checked) {\n      if (checked[font] < retries) {\n        if (isAvailable(font)) {\n          checked[font] = retries;\n          clear(textHeights);\n          // Make sure that loaded fonts are picked up by Safari\n          measureContext = null;\n          labelCache.clear();\n        } else {\n          ++checked[font];\n          done = false;\n        }\n      }\n    }\n    if (done) {\n      clearInterval(interval);\n      interval = undefined;\n    }\n  }\n\n  return function(fontSpec) {\n    const fontFamilies = getFontFamilies(fontSpec);\n    if (!fontFamilies) {\n      return;\n    }\n    for (let i = 0, ii = fontFamilies.length; i < ii; ++i) {\n      const fontFamily = fontFamilies[i];\n      if (!(fontFamily in checked)) {\n        checked[fontFamily] = retries;\n        if (!isAvailable(fontFamily)) {\n          checked[fontFamily] = 0;\n          if (interval === undefined) {\n            interval = setInterval(check, 32);\n          }\n        }\n      }\n    }\n  };\n})();\n\n\n/**\n * @return {CanvasRenderingContext2D} Measure context.\n */\nfunction getMeasureContext() {\n  if (!measureContext) {\n    measureContext = createCanvasContext2D(1, 1);\n  }\n  return measureContext;\n}\n\n\n/**\n * @param {string} font Font to use for measuring.\n * @return {module:ol/size~Size} Measurement.\n */\nexport const measureTextHeight = (function() {\n  let span;\n  const heights = textHeights;\n  return function(font) {\n    let height = heights[font];\n    if (height == undefined) {\n      if (!span) {\n        span = document.createElement('span');\n        span.textContent = 'M';\n        span.style.margin = span.style.padding = '0 !important';\n        span.style.position = 'absolute !important';\n        span.style.left = '-99999px !important';\n      }\n      span.style.font = font;\n      document.body.appendChild(span);\n      height = heights[font] = span.offsetHeight;\n      document.body.removeChild(span);\n    }\n    return height;\n  };\n})();\n\n\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {number} Width.\n */\nexport function measureTextWidth(font, text) {\n  const measureContext = getMeasureContext();\n  if (font != measureContext.font) {\n    measureContext.font = font;\n  }\n  return measureContext.measureText(text).width;\n}\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n * @param {number} offsetX X offset.\n * @param {number} offsetY Y offset.\n */\nexport function rotateAtOffset(context, rotation, offsetX, offsetY) {\n  if (rotation !== 0) {\n    context.translate(offsetX, offsetY);\n    context.rotate(rotation);\n    context.translate(-offsetX, -offsetY);\n  }\n}\n\n\nexport const resetTransform = createTransform();\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform|null} transform Transform.\n * @param {number} opacity Opacity.\n * @param {HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} image Image.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} w Width.\n * @param {number} h Height.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {number} scale Scale.\n */\nexport function drawImage(context,\n  transform, opacity, image, originX, originY, w, h, x, y, scale) {\n  let alpha;\n  if (opacity != 1) {\n    alpha = context.globalAlpha;\n    context.globalAlpha = alpha * opacity;\n  }\n  if (transform) {\n    context.setTransform.apply(context, transform);\n  }\n\n  context.drawImage(image, originX, originY, w, h, x, y, w * scale, h * scale);\n\n  if (alpha) {\n    context.globalAlpha = alpha;\n  }\n  if (transform) {\n    context.setTransform.apply(context, resetTransform);\n  }\n}\n","/**\n * @module ol/style/Image\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {number} opacity\n * @property {boolean} rotateWithView\n * @property {number} rotation\n * @property {number} scale\n * @property {boolean} snapToPixel\n */\n\n\n/**\n * @classdesc\n * A base class used for creating subclasses and not instantiated in\n * apps. Base class for {@link module:ol/style/Icon~Icon}, {@link module:ol/style/Circle~CircleStyle} and\n * {@link module:ol/style/RegularShape~RegularShape}.\n *\n * @constructor\n * @abstract\n * @param {module:ol/style/Image~Options} options Options.\n * @api\n */\nconst ImageStyle = function(options) {\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.opacity_ = options.opacity;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.rotateWithView_ = options.rotateWithView;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.rotation_ = options.rotation;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.scale_ = options.scale;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.snapToPixel_ = options.snapToPixel;\n\n};\n\n\n/**\n * Get the symbolizer opacity.\n * @return {number} Opacity.\n * @api\n */\nImageStyle.prototype.getOpacity = function() {\n  return this.opacity_;\n};\n\n\n/**\n * Determine whether the symbolizer rotates with the map.\n * @return {boolean} Rotate with map.\n * @api\n */\nImageStyle.prototype.getRotateWithView = function() {\n  return this.rotateWithView_;\n};\n\n\n/**\n * Get the symoblizer rotation.\n * @return {number} Rotation.\n * @api\n */\nImageStyle.prototype.getRotation = function() {\n  return this.rotation_;\n};\n\n\n/**\n * Get the symbolizer scale.\n * @return {number} Scale.\n * @api\n */\nImageStyle.prototype.getScale = function() {\n  return this.scale_;\n};\n\n\n/**\n * Determine whether the symbolizer should be snapped to a pixel.\n * @return {boolean} The symbolizer should snap to a pixel.\n * @api\n */\nImageStyle.prototype.getSnapToPixel = function() {\n  return this.snapToPixel_;\n};\n\n\n/**\n * Get the anchor point in pixels. The anchor determines the center point for the\n * symbolizer.\n * @abstract\n * @return {Array.<number>} Anchor.\n */\nImageStyle.prototype.getAnchor = function() {};\n\n\n/**\n * Get the image element for the symbolizer.\n * @abstract\n * @param {number} pixelRatio Pixel ratio.\n * @return {HTMLCanvasElement|HTMLVideoElement|Image} Image element.\n */\nImageStyle.prototype.getImage = function(pixelRatio) {};\n\n\n/**\n * @abstract\n * @param {number} pixelRatio Pixel ratio.\n * @return {HTMLCanvasElement|HTMLVideoElement|Image} Image element.\n */\nImageStyle.prototype.getHitDetectionImage = function(pixelRatio) {};\n\n\n/**\n * @abstract\n * @return {module:ol/ImageState} Image state.\n */\nImageStyle.prototype.getImageState = function() {};\n\n\n/**\n * @abstract\n * @return {module:ol/size~Size} Image size.\n */\nImageStyle.prototype.getImageSize = function() {};\n\n\n/**\n * @abstract\n * @return {module:ol/size~Size} Size of the hit-detection image.\n */\nImageStyle.prototype.getHitDetectionImageSize = function() {};\n\n\n/**\n * Get the origin of the symbolizer.\n * @abstract\n * @return {Array.<number>} Origin.\n */\nImageStyle.prototype.getOrigin = function() {};\n\n\n/**\n * Get the size of the symbolizer (in pixels).\n * @abstract\n * @return {module:ol/size~Size} Size.\n */\nImageStyle.prototype.getSize = function() {};\n\n\n/**\n * Set the opacity.\n *\n * @param {number} opacity Opacity.\n * @api\n */\nImageStyle.prototype.setOpacity = function(opacity) {\n  this.opacity_ = opacity;\n};\n\n\n/**\n * Set whether to rotate the style with the view.\n *\n * @param {boolean} rotateWithView Rotate with map.\n * @api\n */\nImageStyle.prototype.setRotateWithView = function(rotateWithView) {\n  this.rotateWithView_ = rotateWithView;\n};\n\n\n/**\n * Set the rotation.\n *\n * @param {number} rotation Rotation.\n * @api\n */\nImageStyle.prototype.setRotation = function(rotation) {\n  this.rotation_ = rotation;\n};\n\n\n/**\n * Set the scale.\n *\n * @param {number} scale Scale.\n * @api\n */\nImageStyle.prototype.setScale = function(scale) {\n  this.scale_ = scale;\n};\n\n\n/**\n * Set whether to snap the image to the closest pixel.\n *\n * @param {boolean} snapToPixel Snap to pixel?\n * @api\n */\nImageStyle.prototype.setSnapToPixel = function(snapToPixel) {\n  this.snapToPixel_ = snapToPixel;\n};\n\n\n/**\n * @abstract\n * @param {function(this: T, module:ol/events/Event)} listener Listener function.\n * @param {T} thisArg Value to use as `this` when executing `listener`.\n * @return {module:ol/events~EventsKey|undefined} Listener key.\n * @template T\n */\nImageStyle.prototype.listenImageChange = function(listener, thisArg) {};\n\n\n/**\n * Load not yet loaded URI.\n * @abstract\n */\nImageStyle.prototype.load = function() {};\n\n\n/**\n * @abstract\n * @param {function(this: T, module:ol/events/Event)} listener Listener function.\n * @param {T} thisArg Value to use as `this` when executing `listener`.\n * @template T\n */\nImageStyle.prototype.unlistenImageChange = function(listener, thisArg) {};\nexport default ImageStyle;\n","/**\n * @module ol/style/RegularShape\n */\nimport {inherits} from '../util.js';\nimport {asColorLike} from '../colorlike.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {CANVAS_LINE_DASH} from '../has.js';\nimport ImageState from '../ImageState.js';\nimport {defaultStrokeStyle, defaultFillStyle, defaultLineCap, defaultLineWidth, defaultLineJoin, defaultMiterLimit} from '../render/canvas.js';\nimport ImageStyle from '../style/Image.js';\n\n\n/**\n * Specify radius for regular polygons, or radius1 and radius2 for stars.\n * @typedef {Object} Options\n * @property {module:ol/style/Fill} [fill] Fill style.\n * @property {number} points Number of points for stars and regular polygons. In case of a polygon, the number of points\n * is the number of sides.\n * @property {number} [radius] Radius of a regular polygon.\n * @property {number} [radius1] Outer radius of a star.\n * @property {number} [radius2] Inner radius of a star.\n * @property {number} [angle=0] Shape's angle in radians. A value of 0 will have one of the shape's point facing up.\n * @property {boolean} [snapToPixel=true] If `true` integral numbers of pixels are used as the X and Y pixel coordinate\n * when drawing the shape in the output canvas. If `false` fractional numbers may be used. Using `true` allows for\n * \"sharp\" rendering (no blur), while using `false` allows for \"accurate\" rendering. Note that accuracy is important if\n * the shape's position is animated. Without it, the shape may jitter noticeably.\n * @property {module:ol/style/Stroke} [stroke] Stroke style.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {boolean} [rotateWithView=false] Whether to rotate the shape with the view.\n * @property {module:ol/style/AtlasManager} [atlasManager] The atlas manager to use for this symbol. When\n * using WebGL it is recommended to use an atlas manager to avoid texture switching. If an atlas manager is given, the\n * symbol is added to an atlas. By default no atlas manager is used.\n */\n\n\n/**\n * @typedef {Object} RenderOptions\n * @property {module:ol/colorlike~ColorLike} [strokeStyle]\n * @property {number} strokeWidth\n * @property {number} size\n * @property {string} lineCap\n * @property {Array.<number>} lineDash\n * @property {number} lineDashOffset\n * @property {string} lineJoin\n * @property {number} miterLimit\n */\n\n\n/**\n * @classdesc\n * Set regular shape style for vector features. The resulting shape will be\n * a regular polygon when `radius` is provided, or a star when `radius1` and\n * `radius2` are provided.\n *\n * @constructor\n * @param {module:ol/style/RegularShape~Options} options Options.\n * @extends {module:ol/style/Image}\n * @api\n */\nconst RegularShape = function(options) {\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.checksums_ = null;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = null;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.hitDetectionCanvas_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Fill}\n   */\n  this.fill_ = options.fill !== undefined ? options.fill : null;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.origin_ = [0, 0];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.points_ = options.points;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.radius_ = /** @type {number} */ (options.radius !== undefined ?\n    options.radius : options.radius1);\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.radius2_ = options.radius2;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.angle_ = options.angle !== undefined ? options.angle : 0;\n\n  /**\n   * @private\n   * @type {module:ol/style/Stroke}\n   */\n  this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.anchor_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.size_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.imageSize_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.hitDetectionImageSize_ = null;\n\n  /**\n   * @protected\n   * @type {module:ol/style/AtlasManager|undefined}\n   */\n  this.atlasManager_ = options.atlasManager;\n\n  this.render_(this.atlasManager_);\n\n  /**\n   * @type {boolean}\n   */\n  const snapToPixel = options.snapToPixel !== undefined ?\n    options.snapToPixel : true;\n\n  /**\n   * @type {boolean}\n   */\n  const rotateWithView = options.rotateWithView !== undefined ?\n    options.rotateWithView : false;\n\n  ImageStyle.call(this, {\n    opacity: 1,\n    rotateWithView: rotateWithView,\n    rotation: options.rotation !== undefined ? options.rotation : 0,\n    scale: 1,\n    snapToPixel: snapToPixel\n  });\n};\n\ninherits(RegularShape, ImageStyle);\n\n\n/**\n * Clones the style. If an atlasmanager was provided to the original style it will be used in the cloned style, too.\n * @return {module:ol/style/RegularShape} The cloned style.\n * @api\n */\nRegularShape.prototype.clone = function() {\n  const style = new RegularShape({\n    fill: this.getFill() ? this.getFill().clone() : undefined,\n    points: this.getPoints(),\n    radius: this.getRadius(),\n    radius2: this.getRadius2(),\n    angle: this.getAngle(),\n    snapToPixel: this.getSnapToPixel(),\n    stroke: this.getStroke() ?  this.getStroke().clone() : undefined,\n    rotation: this.getRotation(),\n    rotateWithView: this.getRotateWithView(),\n    atlasManager: this.atlasManager_\n  });\n  style.setOpacity(this.getOpacity());\n  style.setScale(this.getScale());\n  return style;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nRegularShape.prototype.getAnchor = function() {\n  return this.anchor_;\n};\n\n\n/**\n * Get the angle used in generating the shape.\n * @return {number} Shape's rotation in radians.\n * @api\n */\nRegularShape.prototype.getAngle = function() {\n  return this.angle_;\n};\n\n\n/**\n * Get the fill style for the shape.\n * @return {module:ol/style/Fill} Fill style.\n * @api\n */\nRegularShape.prototype.getFill = function() {\n  return this.fill_;\n};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.getHitDetectionImage = function(pixelRatio) {\n  return this.hitDetectionCanvas_;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nRegularShape.prototype.getImage = function(pixelRatio) {\n  return this.canvas_;\n};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.getImageSize = function() {\n  return this.imageSize_;\n};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.getHitDetectionImageSize = function() {\n  return this.hitDetectionImageSize_;\n};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.getImageState = function() {\n  return ImageState.LOADED;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nRegularShape.prototype.getOrigin = function() {\n  return this.origin_;\n};\n\n\n/**\n * Get the number of points for generating the shape.\n * @return {number} Number of points for stars and regular polygons.\n * @api\n */\nRegularShape.prototype.getPoints = function() {\n  return this.points_;\n};\n\n\n/**\n * Get the (primary) radius for the shape.\n * @return {number} Radius.\n * @api\n */\nRegularShape.prototype.getRadius = function() {\n  return this.radius_;\n};\n\n\n/**\n * Get the secondary radius for the shape.\n * @return {number|undefined} Radius2.\n * @api\n */\nRegularShape.prototype.getRadius2 = function() {\n  return this.radius2_;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nRegularShape.prototype.getSize = function() {\n  return this.size_;\n};\n\n\n/**\n * Get the stroke style for the shape.\n * @return {module:ol/style/Stroke} Stroke style.\n * @api\n */\nRegularShape.prototype.getStroke = function() {\n  return this.stroke_;\n};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.listenImageChange = function(listener, thisArg) {};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.load = function() {};\n\n\n/**\n * @inheritDoc\n */\nRegularShape.prototype.unlistenImageChange = function(listener, thisArg) {};\n\n\n/**\n * @protected\n * @param {module:ol/style/AtlasManager|undefined} atlasManager An atlas manager.\n */\nRegularShape.prototype.render_ = function(atlasManager) {\n  let imageSize;\n  let lineCap = '';\n  let lineJoin = '';\n  let miterLimit = 0;\n  let lineDash = null;\n  let lineDashOffset = 0;\n  let strokeStyle;\n  let strokeWidth = 0;\n\n  if (this.stroke_) {\n    strokeStyle = this.stroke_.getColor();\n    if (strokeStyle === null) {\n      strokeStyle = defaultStrokeStyle;\n    }\n    strokeStyle = asColorLike(strokeStyle);\n    strokeWidth = this.stroke_.getWidth();\n    if (strokeWidth === undefined) {\n      strokeWidth = defaultLineWidth;\n    }\n    lineDash = this.stroke_.getLineDash();\n    lineDashOffset = this.stroke_.getLineDashOffset();\n    if (!CANVAS_LINE_DASH) {\n      lineDash = null;\n      lineDashOffset = 0;\n    }\n    lineJoin = this.stroke_.getLineJoin();\n    if (lineJoin === undefined) {\n      lineJoin = defaultLineJoin;\n    }\n    lineCap = this.stroke_.getLineCap();\n    if (lineCap === undefined) {\n      lineCap = defaultLineCap;\n    }\n    miterLimit = this.stroke_.getMiterLimit();\n    if (miterLimit === undefined) {\n      miterLimit = defaultMiterLimit;\n    }\n  }\n\n  let size = 2 * (this.radius_ + strokeWidth) + 1;\n\n  /** @type {module:ol/style/RegularShape~RenderOptions} */\n  const renderOptions = {\n    strokeStyle: strokeStyle,\n    strokeWidth: strokeWidth,\n    size: size,\n    lineCap: lineCap,\n    lineDash: lineDash,\n    lineDashOffset: lineDashOffset,\n    lineJoin: lineJoin,\n    miterLimit: miterLimit\n  };\n\n  if (atlasManager === undefined) {\n    // no atlas manager is used, create a new canvas\n    const context = createCanvasContext2D(size, size);\n    this.canvas_ = context.canvas;\n\n    // canvas.width and height are rounded to the closest integer\n    size = this.canvas_.width;\n    imageSize = size;\n\n    this.draw_(renderOptions, context, 0, 0);\n\n    this.createHitDetectionCanvas_(renderOptions);\n  } else {\n    // an atlas manager is used, add the symbol to an atlas\n    size = Math.round(size);\n\n    const hasCustomHitDetectionImage = !this.fill_;\n    let renderHitDetectionCallback;\n    if (hasCustomHitDetectionImage) {\n      // render the hit-detection image into a separate atlas image\n      renderHitDetectionCallback =\n          this.drawHitDetectionCanvas_.bind(this, renderOptions);\n    }\n\n    const id = this.getChecksum();\n    const info = atlasManager.add(\n      id, size, size, this.draw_.bind(this, renderOptions),\n      renderHitDetectionCallback);\n\n    this.canvas_ = info.image;\n    this.origin_ = [info.offsetX, info.offsetY];\n    imageSize = info.image.width;\n\n    if (hasCustomHitDetectionImage) {\n      this.hitDetectionCanvas_ = info.hitImage;\n      this.hitDetectionImageSize_ =\n          [info.hitImage.width, info.hitImage.height];\n    } else {\n      this.hitDetectionCanvas_ = this.canvas_;\n      this.hitDetectionImageSize_ = [imageSize, imageSize];\n    }\n  }\n\n  this.anchor_ = [size / 2, size / 2];\n  this.size_ = [size, size];\n  this.imageSize_ = [imageSize, imageSize];\n};\n\n\n/**\n * @private\n * @param {module:ol/style/RegularShape~RenderOptions} renderOptions Render options.\n * @param {CanvasRenderingContext2D} context The rendering context.\n * @param {number} x The origin for the symbol (x).\n * @param {number} y The origin for the symbol (y).\n */\nRegularShape.prototype.draw_ = function(renderOptions, context, x, y) {\n  let i, angle0, radiusC;\n  // reset transform\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // then move to (x, y)\n  context.translate(x, y);\n\n  context.beginPath();\n\n  let points = this.points_;\n  if (points === Infinity) {\n    context.arc(\n      renderOptions.size / 2, renderOptions.size / 2,\n      this.radius_, 0, 2 * Math.PI, true);\n  } else {\n    const radius2 = (this.radius2_ !== undefined) ? this.radius2_\n      : this.radius_;\n    if (radius2 !== this.radius_) {\n      points = 2 * points;\n    }\n    for (i = 0; i <= points; i++) {\n      angle0 = i * 2 * Math.PI / points - Math.PI / 2 + this.angle_;\n      radiusC = i % 2 === 0 ? this.radius_ : radius2;\n      context.lineTo(renderOptions.size / 2 + radiusC * Math.cos(angle0),\n        renderOptions.size / 2 + radiusC * Math.sin(angle0));\n    }\n  }\n\n\n  if (this.fill_) {\n    let color = this.fill_.getColor();\n    if (color === null) {\n      color = defaultFillStyle;\n    }\n    context.fillStyle = asColorLike(color);\n    context.fill();\n  }\n  if (this.stroke_) {\n    context.strokeStyle = renderOptions.strokeStyle;\n    context.lineWidth = renderOptions.strokeWidth;\n    if (renderOptions.lineDash) {\n      context.setLineDash(renderOptions.lineDash);\n      context.lineDashOffset = renderOptions.lineDashOffset;\n    }\n    context.lineCap = renderOptions.lineCap;\n    context.lineJoin = renderOptions.lineJoin;\n    context.miterLimit = renderOptions.miterLimit;\n    context.stroke();\n  }\n  context.closePath();\n};\n\n\n/**\n * @private\n * @param {module:ol/style/RegularShape~RenderOptions} renderOptions Render options.\n */\nRegularShape.prototype.createHitDetectionCanvas_ = function(renderOptions) {\n  this.hitDetectionImageSize_ = [renderOptions.size, renderOptions.size];\n  if (this.fill_) {\n    this.hitDetectionCanvas_ = this.canvas_;\n    return;\n  }\n\n  // if no fill style is set, create an extra hit-detection image with a\n  // default fill style\n  const context = createCanvasContext2D(renderOptions.size, renderOptions.size);\n  this.hitDetectionCanvas_ = context.canvas;\n\n  this.drawHitDetectionCanvas_(renderOptions, context, 0, 0);\n};\n\n\n/**\n * @private\n * @param {module:ol/style/RegularShape~RenderOptions} renderOptions Render options.\n * @param {CanvasRenderingContext2D} context The context.\n * @param {number} x The origin for the symbol (x).\n * @param {number} y The origin for the symbol (y).\n */\nRegularShape.prototype.drawHitDetectionCanvas_ = function(renderOptions, context, x, y) {\n  // reset transform\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // then move to (x, y)\n  context.translate(x, y);\n\n  context.beginPath();\n\n  let points = this.points_;\n  if (points === Infinity) {\n    context.arc(\n      renderOptions.size / 2, renderOptions.size / 2,\n      this.radius_, 0, 2 * Math.PI, true);\n  } else {\n    const radius2 = (this.radius2_ !== undefined) ? this.radius2_\n      : this.radius_;\n    if (radius2 !== this.radius_) {\n      points = 2 * points;\n    }\n    let i, radiusC, angle0;\n    for (i = 0; i <= points; i++) {\n      angle0 = i * 2 * Math.PI / points - Math.PI / 2 + this.angle_;\n      radiusC = i % 2 === 0 ? this.radius_ : radius2;\n      context.lineTo(renderOptions.size / 2 + radiusC * Math.cos(angle0),\n        renderOptions.size / 2 + radiusC * Math.sin(angle0));\n    }\n  }\n\n  context.fillStyle = defaultFillStyle;\n  context.fill();\n  if (this.stroke_) {\n    context.strokeStyle = renderOptions.strokeStyle;\n    context.lineWidth = renderOptions.strokeWidth;\n    if (renderOptions.lineDash) {\n      context.setLineDash(renderOptions.lineDash);\n      context.lineDashOffset = renderOptions.lineDashOffset;\n    }\n    context.stroke();\n  }\n  context.closePath();\n};\n\n\n/**\n * @return {string} The checksum.\n */\nRegularShape.prototype.getChecksum = function() {\n  const strokeChecksum = this.stroke_ ?\n    this.stroke_.getChecksum() : '-';\n  const fillChecksum = this.fill_ ?\n    this.fill_.getChecksum() : '-';\n\n  const recalculate = !this.checksums_ ||\n      (strokeChecksum != this.checksums_[1] ||\n      fillChecksum != this.checksums_[2] ||\n      this.radius_ != this.checksums_[3] ||\n      this.radius2_ != this.checksums_[4] ||\n      this.angle_ != this.checksums_[5] ||\n      this.points_ != this.checksums_[6]);\n\n  if (recalculate) {\n    const checksum = 'r' + strokeChecksum + fillChecksum +\n        (this.radius_ !== undefined ? this.radius_.toString() : '-') +\n        (this.radius2_ !== undefined ? this.radius2_.toString() : '-') +\n        (this.angle_ !== undefined ? this.angle_.toString() : '-') +\n        (this.points_ !== undefined ? this.points_.toString() : '-');\n    this.checksums_ = [checksum, strokeChecksum, fillChecksum,\n      this.radius_, this.radius2_, this.angle_, this.points_];\n  }\n\n  return this.checksums_[0];\n};\nexport default RegularShape;\n","/**\n * @module ol/style/Circle\n */\nimport {inherits} from '../util.js';\nimport RegularShape from '../style/RegularShape.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/style/Fill} [fill] Fill style.\n * @property {number} radius Circle radius.\n * @property {boolean} [snapToPixel=true] If `true` integral numbers of pixels are used as the X and Y pixel coordinate\n * when drawing the circle in the output canvas. If `false` fractional numbers may be used. Using `true` allows for\n * \"sharp\" rendering (no blur), while using `false` allows for \"accurate\" rendering. Note that accuracy is important if\n * the circle's position is animated. Without it, the circle may jitter noticeably.\n * @property {module:ol/style/Stroke} [stroke] Stroke style.\n * @property {module:ol/style/AtlasManager} [atlasManager] The atlas manager to use for this circle.\n * When using WebGL it is recommended to use an atlas manager to avoid texture switching. If an atlas manager is given,\n * the circle is added to an atlas. By default no atlas manager is used.\n */\n\n\n/**\n * @classdesc\n * Set circle style for vector features.\n *\n * @constructor\n * @param {module:ol/style/Circle~Options=} opt_options Options.\n * @extends {module:ol/style/RegularShape}\n * @api\n */\nconst CircleStyle = function(opt_options) {\n\n  const options = opt_options || {};\n\n  RegularShape.call(this, {\n    points: Infinity,\n    fill: options.fill,\n    radius: options.radius,\n    snapToPixel: options.snapToPixel,\n    stroke: options.stroke,\n    atlasManager: options.atlasManager\n  });\n\n};\n\ninherits(CircleStyle, RegularShape);\n\n\n/**\n * Clones the style.  If an atlasmanager was provided to the original style it will be used in the cloned style, too.\n * @return {module:ol/style/Circle} The cloned style.\n * @override\n * @api\n */\nCircleStyle.prototype.clone = function() {\n  const style = new CircleStyle({\n    fill: this.getFill() ? this.getFill().clone() : undefined,\n    stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n    radius: this.getRadius(),\n    snapToPixel: this.getSnapToPixel(),\n    atlasManager: this.atlasManager_\n  });\n  style.setOpacity(this.getOpacity());\n  style.setScale(this.getScale());\n  return style;\n};\n\n\n/**\n * Set the circle radius.\n *\n * @param {number} radius Circle radius.\n * @api\n */\nCircleStyle.prototype.setRadius = function(radius) {\n  this.radius_ = radius;\n  this.render_(this.atlasManager_);\n};\nexport default CircleStyle;\n","/**\n * @module ol/style/Fill\n */\nimport {getUid} from '../util.js';\nimport {asString} from '../color.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/color~Color|module:ol/colorlike~ColorLike} [color] A color, gradient or pattern.\n * See {@link module:ol/color~Color} and {@link module:ol/colorlike~ColorLike} for possible formats.\n * Default null; if null, the Canvas/renderer default black will be used.\n */\n\n\n/**\n * @classdesc\n * Set fill style for vector features.\n *\n * @constructor\n * @param {module:ol/style/Fill~Options=} opt_options Options.\n * @api\n */\nconst Fill = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {module:ol/color~Color|module:ol/colorlike~ColorLike}\n   */\n  this.color_ = options.color !== undefined ? options.color : null;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Clones the style. The color is not cloned if it is an {@link module:ol/colorlike~ColorLike}.\n * @return {module:ol/style/Fill} The cloned style.\n * @api\n */\nFill.prototype.clone = function() {\n  const color = this.getColor();\n  return new Fill({\n    color: (color && color.slice) ? color.slice() : color || undefined\n  });\n};\n\n\n/**\n * Get the fill color.\n * @return {module:ol/color~Color|module:ol/colorlike~ColorLike} Color.\n * @api\n */\nFill.prototype.getColor = function() {\n  return this.color_;\n};\n\n\n/**\n * Set the color.\n *\n * @param {module:ol/color~Color|module:ol/colorlike~ColorLike} color Color.\n * @api\n */\nFill.prototype.setColor = function(color) {\n  this.color_ = color;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * @return {string} The checksum.\n */\nFill.prototype.getChecksum = function() {\n  if (this.checksum_ === undefined) {\n    if (\n      this.color_ instanceof CanvasPattern ||\n        this.color_ instanceof CanvasGradient\n    ) {\n      this.checksum_ = getUid(this.color_).toString();\n    } else {\n      this.checksum_ = 'f' + (this.color_ ? asString(this.color_) : '-');\n    }\n  }\n\n  return this.checksum_;\n};\nexport default Fill;\n","/**\n * @module ol/style/Stroke\n */\nimport {getUid} from '../util.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/color~Color|module:ol/colorlike~ColorLike} [color] A color, gradient or pattern.\n * See {@link module:ol/color~Color} and {@link module:ol/colorlike~ColorLike} for possible formats.\n * Default null; if null, the Canvas/renderer default black will be used.\n * @property {string} [lineCap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {string} [lineJoin='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array.<number>} [lineDash] Line dash pattern. Default is `undefined` (no dash).\n * Please note that Internet Explorer 10 and lower do not support the `setLineDash` method on\n * the `CanvasRenderingContext2D` and therefore this option will have no visual effect in these browsers.\n * @property {number} [lineDashOffset=0] Line dash offset.\n * @property {number} [miterLimit=10] Miter limit.\n * @property {number} [width] Width.\n */\n\n\n/**\n * @classdesc\n * Set stroke style for vector features.\n * Note that the defaults given are the Canvas defaults, which will be used if\n * option is not defined. The `get` functions return whatever was entered in\n * the options; they will not return the default.\n *\n * @constructor\n * @param {module:ol/style/Stroke~Options=} opt_options Options.\n * @api\n */\nconst Stroke = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {module:ol/color~Color|module:ol/colorlike~ColorLike}\n   */\n  this.color_ = options.color !== undefined ? options.color : null;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.lineCap_ = options.lineCap;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.lineDash_ = options.lineDash !== undefined ? options.lineDash : null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lineDashOffset_ = options.lineDashOffset;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.lineJoin_ = options.lineJoin;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.miterLimit_ = options.miterLimit;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.width_ = options.width;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Clones the style.\n * @return {module:ol/style/Stroke} The cloned style.\n * @api\n */\nStroke.prototype.clone = function() {\n  const color = this.getColor();\n  return new Stroke({\n    color: (color && color.slice) ? color.slice() : color || undefined,\n    lineCap: this.getLineCap(),\n    lineDash: this.getLineDash() ? this.getLineDash().slice() : undefined,\n    lineDashOffset: this.getLineDashOffset(),\n    lineJoin: this.getLineJoin(),\n    miterLimit: this.getMiterLimit(),\n    width: this.getWidth()\n  });\n};\n\n\n/**\n * Get the stroke color.\n * @return {module:ol/color~Color|module:ol/colorlike~ColorLike} Color.\n * @api\n */\nStroke.prototype.getColor = function() {\n  return this.color_;\n};\n\n\n/**\n * Get the line cap type for the stroke.\n * @return {string|undefined} Line cap.\n * @api\n */\nStroke.prototype.getLineCap = function() {\n  return this.lineCap_;\n};\n\n\n/**\n * Get the line dash style for the stroke.\n * @return {Array.<number>} Line dash.\n * @api\n */\nStroke.prototype.getLineDash = function() {\n  return this.lineDash_;\n};\n\n\n/**\n * Get the line dash offset for the stroke.\n * @return {number|undefined} Line dash offset.\n * @api\n */\nStroke.prototype.getLineDashOffset = function() {\n  return this.lineDashOffset_;\n};\n\n\n/**\n * Get the line join type for the stroke.\n * @return {string|undefined} Line join.\n * @api\n */\nStroke.prototype.getLineJoin = function() {\n  return this.lineJoin_;\n};\n\n\n/**\n * Get the miter limit for the stroke.\n * @return {number|undefined} Miter limit.\n * @api\n */\nStroke.prototype.getMiterLimit = function() {\n  return this.miterLimit_;\n};\n\n\n/**\n * Get the stroke width.\n * @return {number|undefined} Width.\n * @api\n */\nStroke.prototype.getWidth = function() {\n  return this.width_;\n};\n\n\n/**\n * Set the color.\n *\n * @param {module:ol/color~Color|module:ol/colorlike~ColorLike} color Color.\n * @api\n */\nStroke.prototype.setColor = function(color) {\n  this.color_ = color;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the line cap.\n *\n * @param {string|undefined} lineCap Line cap.\n * @api\n */\nStroke.prototype.setLineCap = function(lineCap) {\n  this.lineCap_ = lineCap;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the line dash.\n *\n * Please note that Internet Explorer 10 and lower [do not support][mdn] the\n * `setLineDash` method on the `CanvasRenderingContext2D` and therefore this\n * property will have no visual effect in these browsers.\n *\n * [mdn]: https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/setLineDash#Browser_compatibility\n *\n * @param {Array.<number>} lineDash Line dash.\n * @api\n */\nStroke.prototype.setLineDash = function(lineDash) {\n  this.lineDash_ = lineDash;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the line dash offset.\n *\n * @param {number|undefined} lineDashOffset Line dash offset.\n * @api\n */\nStroke.prototype.setLineDashOffset = function(lineDashOffset) {\n  this.lineDashOffset_ = lineDashOffset;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the line join.\n *\n * @param {string|undefined} lineJoin Line join.\n * @api\n */\nStroke.prototype.setLineJoin = function(lineJoin) {\n  this.lineJoin_ = lineJoin;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the miter limit.\n *\n * @param {number|undefined} miterLimit Miter limit.\n * @api\n */\nStroke.prototype.setMiterLimit = function(miterLimit) {\n  this.miterLimit_ = miterLimit;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * Set the width.\n *\n * @param {number|undefined} width Width.\n * @api\n */\nStroke.prototype.setWidth = function(width) {\n  this.width_ = width;\n  this.checksum_ = undefined;\n};\n\n\n/**\n * @return {string} The checksum.\n */\nStroke.prototype.getChecksum = function() {\n  if (this.checksum_ === undefined) {\n    this.checksum_ = 's';\n    if (this.color_) {\n      if (typeof this.color_ === 'string') {\n        this.checksum_ += this.color_;\n      } else {\n        this.checksum_ += getUid(this.color_).toString();\n      }\n    } else {\n      this.checksum_ += '-';\n    }\n    this.checksum_ += ',' +\n        (this.lineCap_ !== undefined ?\n          this.lineCap_.toString() : '-') + ',' +\n        (this.lineDash_ ?\n          this.lineDash_.toString() : '-') + ',' +\n        (this.lineDashOffset_ !== undefined ?\n          this.lineDashOffset_ : '-') + ',' +\n        (this.lineJoin_ !== undefined ?\n          this.lineJoin_ : '-') + ',' +\n        (this.miterLimit_ !== undefined ?\n          this.miterLimit_.toString() : '-') + ',' +\n        (this.width_ !== undefined ?\n          this.width_.toString() : '-');\n  }\n\n  return this.checksum_;\n};\nexport default Stroke;\n","/**\n * @module ol/style/Style\n */\n\n/**\n * Feature styles.\n *\n * If no style is defined, the following default style is used:\n * ```js\n *  import {Fill, Stroke, Circle, Style} from 'ol/style';\n *\n *  var fill = new Fill({\n *    color: 'rgba(255,255,255,0.4)'\n *  });\n *  var stroke = new Stroke({\n *    color: '#3399CC',\n *    width: 1.25\n *  });\n *  var styles = [\n *    new Style({\n *      image: new Circle({\n *        fill: fill,\n *        stroke: stroke,\n *        radius: 5\n *      }),\n *      fill: fill,\n *      stroke: stroke\n *    })\n *  ];\n * ```\n *\n * A separate editing style has the following defaults:\n * ```js\n *  import {Fill, Stroke, Circle, Style} from 'ol/style';\n *  import GeometryType from 'ol/geom/GeometryType';\n *\n *  var white = [255, 255, 255, 1];\n *  var blue = [0, 153, 255, 1];\n *  var width = 3;\n *  styles[GeometryType.POLYGON] = [\n *    new Style({\n *      fill: new Fill({\n *        color: [255, 255, 255, 0.5]\n *      })\n *    })\n *  ];\n *  styles[GeometryType.MULTI_POLYGON] =\n *      styles[GeometryType.POLYGON];\n *  styles[GeometryType.LINE_STRING] = [\n *    new Style({\n *      stroke: new Stroke({\n *        color: white,\n *        width: width + 2\n *      })\n *    }),\n *    new Style({\n *      stroke: new Stroke({\n *        color: blue,\n *        width: width\n *      })\n *    })\n *  ];\n *  styles[GeometryType.MULTI_LINE_STRING] =\n *      styles[GeometryType.LINE_STRING];\n *  styles[GeometryType.POINT] = [\n *    new Style({\n *      image: new Circle({\n *        radius: width * 2,\n *        fill: new Fill({\n *          color: blue\n *        }),\n *        stroke: new Stroke({\n *          color: white,\n *          width: width / 2\n *        })\n *      }),\n *      zIndex: Infinity\n *    })\n *  ];\n *  styles[GeometryType.MULTI_POINT] =\n *      styles[GeometryType.POINT];\n *  styles[GeometryType.GEOMETRY_COLLECTION] =\n *      styles[GeometryType.POLYGON].concat(\n *          styles[GeometryType.LINE_STRING],\n *          styles[GeometryType.POINT]\n *      );\n * ```\n */\nimport {assert} from '../asserts.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport CircleStyle from '../style/Circle.js';\nimport Fill from '../style/Fill.js';\nimport Stroke from '../style/Stroke.js';\n\n\n/**\n * A function that takes an {@link module:ol/Feature} and a `{number}`\n * representing the view's resolution. The function should return a\n * {@link module:ol/style/Style} or an array of them. This way e.g. a\n * vector layer can be styled.\n *\n * @typedef {function((module:ol/Feature|module:ol/render/Feature), number):\n *     (module:ol/style/Style|Array.<module:ol/style/Style>)} StyleFunction\n */\n\n\n/**\n * A function that takes an {@link module:ol/Feature} as argument and returns an\n * {@link module:ol/geom/Geometry} that will be rendered and styled for the feature.\n *\n * @typedef {function((module:ol/Feature|module:ol/render/Feature)):\n *     (module:ol/geom/Geometry|module:ol/render/Feature|undefined)} GeometryFunction\n */\n\n\n/**\n * Custom renderer function. Takes two arguments:\n *\n * 1. The pixel coordinates of the geometry in GeoJSON notation.\n * 2. The {@link module:ol/render~State} of the layer renderer.\n *\n * @typedef {function((module:ol/coordinate~Coordinate|Array<module:ol/coordinate~Coordinate>|Array.<Array.<module:ol/coordinate~Coordinate>>),module:ol/render~State)}\n * RenderFunction\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {string|module:ol/geom/Geometry|module:ol/style/Style~GeometryFunction} [geometry] Feature property or geometry\n * or function returning a geometry to render for this style.\n * @property {module:ol/style/Fill} [fill] Fill style.\n * @property {module:ol/style/Image} [image] Image style.\n * @property {module:ol/style/Style~RenderFunction} [renderer] Custom renderer. When configured, `fill`, `stroke` and `image` will be\n * ignored, and the provided function will be called with each render frame for each geometry.\n * @property {module:ol/style/Stroke} [stroke] Stroke style.\n * @property {module:ol/style/Text} [text] Text style.\n * @property {number} [zIndex] Z index.\n */\n\n\n/**\n * @classdesc\n * Container for vector feature rendering styles. Any changes made to the style\n * or its children through `set*()` methods will not take effect until the\n * feature or layer that uses the style is re-rendered.\n *\n * @constructor\n * @struct\n * @param {module:ol/style/Style~Options=} opt_options Style options.\n * @api\n */\nconst Style = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {string|module:ol/geom/Geometry|module:ol/style/Style~GeometryFunction}\n   */\n  this.geometry_ = null;\n\n  /**\n   * @private\n   * @type {!module:ol/style/Style~GeometryFunction}\n   */\n  this.geometryFunction_ = defaultGeometryFunction;\n\n  if (options.geometry !== undefined) {\n    this.setGeometry(options.geometry);\n  }\n\n  /**\n   * @private\n   * @type {module:ol/style/Fill}\n   */\n  this.fill_ = options.fill !== undefined ? options.fill : null;\n\n  /**\n     * @private\n     * @type {module:ol/style/Image}\n     */\n  this.image_ = options.image !== undefined ? options.image : null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Style~RenderFunction|null}\n   */\n  this.renderer_ = options.renderer !== undefined ? options.renderer : null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Stroke}\n   */\n  this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Text}\n   */\n  this.text_ = options.text !== undefined ? options.text : null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.zIndex_ = options.zIndex;\n\n};\n\n\n/**\n * Clones the style.\n * @return {module:ol/style/Style} The cloned style.\n * @api\n */\nStyle.prototype.clone = function() {\n  let geometry = this.getGeometry();\n  if (geometry && geometry.clone) {\n    geometry = geometry.clone();\n  }\n  return new Style({\n    geometry: geometry,\n    fill: this.getFill() ? this.getFill().clone() : undefined,\n    image: this.getImage() ? this.getImage().clone() : undefined,\n    stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n    text: this.getText() ? this.getText().clone() : undefined,\n    zIndex: this.getZIndex()\n  });\n};\n\n\n/**\n * Get the custom renderer function that was configured with\n * {@link #setRenderer} or the `renderer` constructor option.\n * @return {module:ol/style/Style~RenderFunction|null} Custom renderer function.\n * @api\n */\nStyle.prototype.getRenderer = function() {\n  return this.renderer_;\n};\n\n\n/**\n * Sets a custom renderer function for this style. When set, `fill`, `stroke`\n * and `image` options of the style will be ignored.\n * @param {module:ol/style/Style~RenderFunction|null} renderer Custom renderer function.\n * @api\n */\nStyle.prototype.setRenderer = function(renderer) {\n  this.renderer_ = renderer;\n};\n\n\n/**\n * Get the geometry to be rendered.\n * @return {string|module:ol/geom/Geometry|module:ol/style/Style~GeometryFunction}\n * Feature property or geometry or function that returns the geometry that will\n * be rendered with this style.\n * @api\n */\nStyle.prototype.getGeometry = function() {\n  return this.geometry_;\n};\n\n\n/**\n * Get the function used to generate a geometry for rendering.\n * @return {!module:ol/style/Style~GeometryFunction} Function that is called with a feature\n * and returns the geometry to render instead of the feature's geometry.\n * @api\n */\nStyle.prototype.getGeometryFunction = function() {\n  return this.geometryFunction_;\n};\n\n\n/**\n * Get the fill style.\n * @return {module:ol/style/Fill} Fill style.\n * @api\n */\nStyle.prototype.getFill = function() {\n  return this.fill_;\n};\n\n\n/**\n * Set the fill style.\n * @param {module:ol/style/Fill} fill Fill style.\n * @api\n */\nStyle.prototype.setFill = function(fill) {\n  this.fill_ = fill;\n};\n\n\n/**\n * Get the image style.\n * @return {module:ol/style/Image} Image style.\n * @api\n */\nStyle.prototype.getImage = function() {\n  return this.image_;\n};\n\n\n/**\n * Set the image style.\n * @param {module:ol/style/Image} image Image style.\n * @api\n */\nStyle.prototype.setImage = function(image) {\n  this.image_ = image;\n};\n\n\n/**\n * Get the stroke style.\n * @return {module:ol/style/Stroke} Stroke style.\n * @api\n */\nStyle.prototype.getStroke = function() {\n  return this.stroke_;\n};\n\n\n/**\n * Set the stroke style.\n * @param {module:ol/style/Stroke} stroke Stroke style.\n * @api\n */\nStyle.prototype.setStroke = function(stroke) {\n  this.stroke_ = stroke;\n};\n\n\n/**\n * Get the text style.\n * @return {module:ol/style/Text} Text style.\n * @api\n */\nStyle.prototype.getText = function() {\n  return this.text_;\n};\n\n\n/**\n * Set the text style.\n * @param {module:ol/style/Text} text Text style.\n * @api\n */\nStyle.prototype.setText = function(text) {\n  this.text_ = text;\n};\n\n\n/**\n * Get the z-index for the style.\n * @return {number|undefined} ZIndex.\n * @api\n */\nStyle.prototype.getZIndex = function() {\n  return this.zIndex_;\n};\n\n\n/**\n * Set a geometry that is rendered instead of the feature's geometry.\n *\n * @param {string|module:ol/geom/Geometry|module:ol/style/Style~GeometryFunction} geometry\n *     Feature property or geometry or function returning a geometry to render\n *     for this style.\n * @api\n */\nStyle.prototype.setGeometry = function(geometry) {\n  if (typeof geometry === 'function') {\n    this.geometryFunction_ = geometry;\n  } else if (typeof geometry === 'string') {\n    this.geometryFunction_ = function(feature) {\n      return (\n        /** @type {module:ol/geom/Geometry} */ (feature.get(geometry))\n      );\n    };\n  } else if (!geometry) {\n    this.geometryFunction_ = defaultGeometryFunction;\n  } else if (geometry !== undefined) {\n    this.geometryFunction_ = function() {\n      return (\n        /** @type {module:ol/geom/Geometry} */ (geometry)\n      );\n    };\n  }\n  this.geometry_ = geometry;\n};\n\n\n/**\n * Set the z-index.\n *\n * @param {number|undefined} zIndex ZIndex.\n * @api\n */\nStyle.prototype.setZIndex = function(zIndex) {\n  this.zIndex_ = zIndex;\n};\n\n\n/**\n * Convert the provided object into a style function.  Functions passed through\n * unchanged.  Arrays of module:ol/style/Style or single style objects wrapped in a\n * new style function.\n * @param {module:ol/style/Style~StyleFunction|Array.<module:ol/style/Style>|module:ol/style/Style} obj\n *     A style function, a single style, or an array of styles.\n * @return {module:ol/style/Style~StyleFunction} A style function.\n */\nexport function toFunction(obj) {\n  let styleFunction;\n\n  if (typeof obj === 'function') {\n    styleFunction = obj;\n  } else {\n    /**\n     * @type {Array.<module:ol/style/Style>}\n     */\n    let styles;\n    if (Array.isArray(obj)) {\n      styles = obj;\n    } else {\n      assert(obj instanceof Style,\n        41); // Expected an `module:ol/style/Style~Style` or an array of `module:ol/style/Style~Style`\n      styles = [obj];\n    }\n    styleFunction = function() {\n      return styles;\n    };\n  }\n  return styleFunction;\n}\n\n\n/**\n * @type {Array.<module:ol/style/Style>}\n */\nlet defaultStyles = null;\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {number} resolution Resolution.\n * @return {Array.<module:ol/style/Style>} Style.\n */\nexport function createDefaultStyle(feature, resolution) {\n  // We don't use an immediately-invoked function\n  // and a closure so we don't get an error at script evaluation time in\n  // browsers that do not support Canvas. (module:ol/style/Circle~CircleStyle does\n  // canvas.getContext('2d') at construction time, which will cause an.error\n  // in such browsers.)\n  if (!defaultStyles) {\n    const fill = new Fill({\n      color: 'rgba(255,255,255,0.4)'\n    });\n    const stroke = new Stroke({\n      color: '#3399CC',\n      width: 1.25\n    });\n    defaultStyles = [\n      new Style({\n        image: new CircleStyle({\n          fill: fill,\n          stroke: stroke,\n          radius: 5\n        }),\n        fill: fill,\n        stroke: stroke\n      })\n    ];\n  }\n  return defaultStyles;\n}\n\n\n/**\n * Default styles for editing features.\n * @return {Object.<module:ol/geom/GeometryType, Array.<module:ol/style/Style>>} Styles\n */\nexport function createEditingStyle() {\n  /** @type {Object.<module:ol/geom/GeometryType, Array.<module:ol/style/Style>>} */\n  const styles = {};\n  const white = [255, 255, 255, 1];\n  const blue = [0, 153, 255, 1];\n  const width = 3;\n  styles[GeometryType.POLYGON] = [\n    new Style({\n      fill: new Fill({\n        color: [255, 255, 255, 0.5]\n      })\n    })\n  ];\n  styles[GeometryType.MULTI_POLYGON] =\n      styles[GeometryType.POLYGON];\n\n  styles[GeometryType.LINE_STRING] = [\n    new Style({\n      stroke: new Stroke({\n        color: white,\n        width: width + 2\n      })\n    }),\n    new Style({\n      stroke: new Stroke({\n        color: blue,\n        width: width\n      })\n    })\n  ];\n  styles[GeometryType.MULTI_LINE_STRING] =\n      styles[GeometryType.LINE_STRING];\n\n  styles[GeometryType.CIRCLE] =\n      styles[GeometryType.POLYGON].concat(\n        styles[GeometryType.LINE_STRING]\n      );\n\n\n  styles[GeometryType.POINT] = [\n    new Style({\n      image: new CircleStyle({\n        radius: width * 2,\n        fill: new Fill({\n          color: blue\n        }),\n        stroke: new Stroke({\n          color: white,\n          width: width / 2\n        })\n      }),\n      zIndex: Infinity\n    })\n  ];\n  styles[GeometryType.MULTI_POINT] =\n      styles[GeometryType.POINT];\n\n  styles[GeometryType.GEOMETRY_COLLECTION] =\n      styles[GeometryType.POLYGON].concat(\n        styles[GeometryType.LINE_STRING],\n        styles[GeometryType.POINT]\n      );\n\n  return styles;\n}\n\n\n/**\n * Function that is called with a feature and returns its default geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature to get the geometry for.\n * @return {module:ol/geom/Geometry|module:ol/render/Feature|undefined} Geometry to render.\n */\nfunction defaultGeometryFunction(feature) {\n  return feature.getGeometry();\n}\n\nexport default Style;\n","/**\n * @module ol/Feature\n */\nimport {assert} from './asserts.js';\nimport {listen, unlisten, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\nimport {inherits} from './util.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport Geometry from './geom/Geometry.js';\nimport Style from './style/Style.js';\n\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature';\n * import Polygon from 'ol/geom/Polygon';\n * import Point from 'ol/geom/Point';\n *\n * var feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon'\n * });\n *\n * // get the polygon geometry\n * var poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * var point = feature.getGeometry();\n * ```\n *\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/geom/Geometry|Object.<string, *>=} opt_geometryOrProperties\n * You may pass a Geometry object directly, or an object literal containing\n * properties. If you pass an object literal, you may include a Geometry\n * associated with a `geometry` key.\n * @api\n */\nconst Feature = function(opt_geometryOrProperties) {\n\n  BaseObject.call(this);\n\n  /**\n   * @private\n   * @type {number|string|undefined}\n   */\n  this.id_ = undefined;\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.geometryName_ = 'geometry';\n\n  /**\n   * User provided style.\n   * @private\n   * @type {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction}\n   */\n  this.style_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Style~StyleFunction|undefined}\n   */\n  this.styleFunction_ = undefined;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.geometryChangeKey_ = null;\n\n  listen(\n    this, getChangeEventType(this.geometryName_),\n    this.handleGeometryChanged_, this);\n\n  if (opt_geometryOrProperties !== undefined) {\n    if (opt_geometryOrProperties instanceof Geometry ||\n        !opt_geometryOrProperties) {\n      const geometry = opt_geometryOrProperties;\n      this.setGeometry(geometry);\n    } else {\n      /** @type {Object.<string, *>} */\n      const properties = opt_geometryOrProperties;\n      this.setProperties(properties);\n    }\n  }\n};\n\ninherits(Feature, BaseObject);\n\n\n/**\n * Clone this feature. If the original feature has a geometry it\n * is also cloned. The feature id is not set in the clone.\n * @return {module:ol/Feature} The clone.\n * @api\n */\nFeature.prototype.clone = function() {\n  const clone = new Feature(this.getProperties());\n  clone.setGeometryName(this.getGeometryName());\n  const geometry = this.getGeometry();\n  if (geometry) {\n    clone.setGeometry(geometry.clone());\n  }\n  const style = this.getStyle();\n  if (style) {\n    clone.setStyle(style);\n  }\n  return clone;\n};\n\n\n/**\n * Get the feature's default geometry.  A feature may have any number of named\n * geometries.  The \"default\" geometry (the one that is rendered by default) is\n * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n * @return {module:ol/geom/Geometry|undefined} The default geometry for the feature.\n * @api\n * @observable\n */\nFeature.prototype.getGeometry = function() {\n  return (\n    /** @type {module:ol/geom/Geometry|undefined} */ (this.get(this.geometryName_))\n  );\n};\n\n\n/**\n * Get the feature identifier.  This is a stable identifier for the feature and\n * is either set when reading data from a remote source or set explicitly by\n * calling {@link module:ol/Feature~Feature#setId}.\n * @return {number|string|undefined} Id.\n * @api\n */\nFeature.prototype.getId = function() {\n  return this.id_;\n};\n\n\n/**\n * Get the name of the feature's default geometry.  By default, the default\n * geometry is named `geometry`.\n * @return {string} Get the property name associated with the default geometry\n *     for this feature.\n * @api\n */\nFeature.prototype.getGeometryName = function() {\n  return this.geometryName_;\n};\n\n\n/**\n * Get the feature's style. Will return what was provided to the\n * {@link module:ol/Feature~Feature#setStyle} method.\n * @return {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} The feature style.\n * @api\n */\nFeature.prototype.getStyle = function() {\n  return this.style_;\n};\n\n\n/**\n * Get the feature's style function.\n * @return {module:ol/style/Style~StyleFunction|undefined} Return a function\n * representing the current style of this feature.\n * @api\n */\nFeature.prototype.getStyleFunction = function() {\n  return this.styleFunction_;\n};\n\n\n/**\n * @private\n */\nFeature.prototype.handleGeometryChange_ = function() {\n  this.changed();\n};\n\n\n/**\n * @private\n */\nFeature.prototype.handleGeometryChanged_ = function() {\n  if (this.geometryChangeKey_) {\n    unlistenByKey(this.geometryChangeKey_);\n    this.geometryChangeKey_ = null;\n  }\n  const geometry = this.getGeometry();\n  if (geometry) {\n    this.geometryChangeKey_ = listen(geometry,\n      EventType.CHANGE, this.handleGeometryChange_, this);\n  }\n  this.changed();\n};\n\n\n/**\n * Set the default geometry for the feature.  This will update the property\n * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n * @param {module:ol/geom/Geometry|undefined} geometry The new geometry.\n * @api\n * @observable\n */\nFeature.prototype.setGeometry = function(geometry) {\n  this.set(this.geometryName_, geometry);\n};\n\n\n/**\n * Set the style for the feature.  This can be a single style object, an array\n * of styles, or a function that takes a resolution and returns an array of\n * styles. If it is `null` the feature has no style (a `null` style).\n * @param {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} style Style for this feature.\n * @api\n * @fires module:ol/events/Event~Event#event:change\n */\nFeature.prototype.setStyle = function(style) {\n  this.style_ = style;\n  this.styleFunction_ = !style ? undefined : createStyleFunction(style);\n  this.changed();\n};\n\n\n/**\n * Set the feature id.  The feature id is considered stable and may be used when\n * requesting features or comparing identifiers returned from a remote source.\n * The feature id can be used with the\n * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n * @param {number|string|undefined} id The feature id.\n * @api\n * @fires module:ol/events/Event~Event#event:change\n */\nFeature.prototype.setId = function(id) {\n  this.id_ = id;\n  this.changed();\n};\n\n\n/**\n * Set the property name to be used when getting the feature's default geometry.\n * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n * this name will be returned.\n * @param {string} name The property name of the default geometry.\n * @api\n */\nFeature.prototype.setGeometryName = function(name) {\n  unlisten(\n    this, getChangeEventType(this.geometryName_),\n    this.handleGeometryChanged_, this);\n  this.geometryName_ = name;\n  listen(\n    this, getChangeEventType(this.geometryName_),\n    this.handleGeometryChanged_, this);\n  this.handleGeometryChanged_();\n};\n\n\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of module:ol/style/Style or single style objects wrapped\n * in a new feature style function.\n * @param {module:ol/style/Style~StyleFunction|!Array.<module:ol/style/Style>|!module:ol/style/Style} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {module:ol/style/Style~StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n  if (typeof obj === 'function') {\n    return obj;\n  } else {\n    /**\n     * @type {Array.<module:ol/style/Style>}\n     */\n    let styles;\n    if (Array.isArray(obj)) {\n      styles = obj;\n    } else {\n      assert(obj instanceof Style,\n        41); // Expected an `module:ol/style/Style~Style` or an array of `module:ol/style/Style~Style`\n      styles = [obj];\n    }\n    return function() {\n      return styles;\n    };\n  }\n}\nexport default Feature;\n","/**\n * @module ol/GeolocationProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  ACCURACY: 'accuracy',\n  ACCURACY_GEOMETRY: 'accuracyGeometry',\n  ALTITUDE: 'altitude',\n  ALTITUDE_ACCURACY: 'altitudeAccuracy',\n  HEADING: 'heading',\n  POSITION: 'position',\n  PROJECTION: 'projection',\n  SPEED: 'speed',\n  TRACKING: 'tracking',\n  TRACKING_OPTIONS: 'trackingOptions'\n};\n","/**\n * @module ol/array\n */\n\n\n/**\n * Performs a binary search on the provided sorted list and returns the index of the item if found. If it can't be found it'll return -1.\n * https://github.com/darkskyapp/binary-search\n *\n * @param {Array.<*>} haystack Items to search through.\n * @param {*} needle The item to look for.\n * @param {Function=} opt_comparator Comparator function.\n * @return {number} The index of the item if found, -1 if not.\n */\nexport function binarySearch(haystack, needle, opt_comparator) {\n  let mid, cmp;\n  const comparator = opt_comparator || numberSafeCompareFunction;\n  let low = 0;\n  let high = haystack.length;\n  let found = false;\n\n  while (low < high) {\n    /* Note that \"(low + high) >>> 1\" may overflow, and results in a typecast\n     * to double (which gives the wrong results). */\n    mid = low + (high - low >> 1);\n    cmp = +comparator(haystack[mid], needle);\n\n    if (cmp < 0.0) { /* Too low. */\n      low  = mid + 1;\n\n    } else { /* Key found or too high */\n      high = mid;\n      found = !cmp;\n    }\n  }\n\n  /* Key not found. */\n  return found ? low : ~low;\n}\n\n\n/**\n * Compare function for array sort that is safe for numbers.\n * @param {*} a The first object to be compared.\n * @param {*} b The second object to be compared.\n * @return {number} A negative number, zero, or a positive number as the first\n *     argument is less than, equal to, or greater than the second.\n */\nexport function numberSafeCompareFunction(a, b) {\n  return a > b ? 1 : a < b ? -1 : 0;\n}\n\n\n/**\n * Whether the array contains the given object.\n * @param {Array.<*>} arr The array to test for the presence of the element.\n * @param {*} obj The object for which to test.\n * @return {boolean} The object is in the array.\n */\nexport function includes(arr, obj) {\n  return arr.indexOf(obj) >= 0;\n}\n\n\n/**\n * @param {Array.<number>} arr Array.\n * @param {number} target Target.\n * @param {number} direction 0 means return the nearest, > 0\n *    means return the largest nearest, < 0 means return the\n *    smallest nearest.\n * @return {number} Index.\n */\nexport function linearFindNearest(arr, target, direction) {\n  const n = arr.length;\n  if (arr[0] <= target) {\n    return 0;\n  } else if (target <= arr[n - 1]) {\n    return n - 1;\n  } else {\n    let i;\n    if (direction > 0) {\n      for (i = 1; i < n; ++i) {\n        if (arr[i] < target) {\n          return i - 1;\n        }\n      }\n    } else if (direction < 0) {\n      for (i = 1; i < n; ++i) {\n        if (arr[i] <= target) {\n          return i;\n        }\n      }\n    } else {\n      for (i = 1; i < n; ++i) {\n        if (arr[i] == target) {\n          return i;\n        } else if (arr[i] < target) {\n          if (arr[i - 1] - target < target - arr[i]) {\n            return i - 1;\n          } else {\n            return i;\n          }\n        }\n      }\n    }\n    return n - 1;\n  }\n}\n\n\n/**\n * @param {Array.<*>} arr Array.\n * @param {number} begin Begin index.\n * @param {number} end End index.\n */\nexport function reverseSubArray(arr, begin, end) {\n  while (begin < end) {\n    const tmp = arr[begin];\n    arr[begin] = arr[end];\n    arr[end] = tmp;\n    ++begin;\n    --end;\n  }\n}\n\n\n/**\n * @param {Array.<VALUE>} arr The array to modify.\n * @param {!Array.<VALUE>|VALUE} data The elements or arrays of elements to add to arr.\n * @template VALUE\n */\nexport function extend(arr, data) {\n  const extension = Array.isArray(data) ? data : [data];\n  const length = extension.length;\n  for (let i = 0; i < length; i++) {\n    arr[arr.length] = extension[i];\n  }\n}\n\n\n/**\n * @param {Array.<VALUE>} arr The array to modify.\n * @param {VALUE} obj The element to remove.\n * @template VALUE\n * @return {boolean} If the element was removed.\n */\nexport function remove(arr, obj) {\n  const i = arr.indexOf(obj);\n  const found = i > -1;\n  if (found) {\n    arr.splice(i, 1);\n  }\n  return found;\n}\n\n\n/**\n * @param {Array.<VALUE>} arr The array to search in.\n * @param {function(VALUE, number, ?) : boolean} func The function to compare.\n * @template VALUE\n * @return {VALUE|null} The element found or null.\n */\nexport function find(arr, func) {\n  const length = arr.length >>> 0;\n  let value;\n\n  for (let i = 0; i < length; i++) {\n    value = arr[i];\n    if (func(value, i, arr)) {\n      return value;\n    }\n  }\n  return null;\n}\n\n\n/**\n * @param {Array|Uint8ClampedArray} arr1 The first array to compare.\n * @param {Array|Uint8ClampedArray} arr2 The second array to compare.\n * @return {boolean} Whether the two arrays are equal.\n */\nexport function equals(arr1, arr2) {\n  const len1 = arr1.length;\n  if (len1 !== arr2.length) {\n    return false;\n  }\n  for (let i = 0; i < len1; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n\n/**\n * @param {Array.<*>} arr The array to sort (modifies original).\n * @param {Function} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  let i;\n  for (i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort(function(a, b) {\n    return compareFnc(a.value, b.value) || a.index - b.index;\n  });\n  for (i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n\n/**\n * @param {Array.<*>} arr The array to search in.\n * @param {Function} func Comparison function.\n * @return {number} Return index.\n */\nexport function findIndex(arr, func) {\n  let index;\n  const found = !arr.every(function(el, idx) {\n    index = idx;\n    return !func(el, idx, arr);\n  });\n  return found ? index : -1;\n}\n\n\n/**\n * @param {Array.<*>} arr The array to test.\n * @param {Function=} opt_func Comparison function.\n * @param {boolean=} opt_strict Strictly sorted (default false).\n * @return {boolean} Return index.\n */\nexport function isSorted(arr, opt_func, opt_strict) {\n  const compare = opt_func || numberSafeCompareFunction;\n  return arr.every(function(currentVal, index) {\n    if (index === 0) {\n      return true;\n    }\n    const res = compare(arr[index - 1], currentVal);\n    return !(res > 0 || opt_strict && res === 0);\n  });\n}\n","/**\n * @module ol/geom/GeometryLayout\n */\n\n/**\n * The coordinate layout for geometries, indicating whether a 3rd or 4th z ('Z')\n * or measure ('M') coordinate is available. Supported values are `'XY'`,\n * `'XYZ'`, `'XYM'`, `'XYZM'`.\n * @enum {string}\n */\nexport default {\n  XY: 'XY',\n  XYZ: 'XYZ',\n  XYM: 'XYM',\n  XYZM: 'XYZM'\n};\n","/**\n * @module ol/geom/SimpleGeometry\n */\nimport {inherits} from '../util.js';\nimport {FALSE} from '../functions.js';\nimport {createOrUpdateFromFlatCoordinates, getCenter} from '../extent.js';\nimport Geometry from '../geom/Geometry.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport {rotate, scale, translate, transform2D} from '../geom/flat/transform.js';\nimport {clear} from '../obj.js';\n\n/**\n * @classdesc\n * Abstract base class; only used for creating subclasses; do not instantiate\n * in apps, as cannot be rendered.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/geom/Geometry}\n * @api\n */\nconst SimpleGeometry = function() {\n\n  Geometry.call(this);\n\n  /**\n   * @protected\n   * @type {module:ol/geom/GeometryLayout}\n   */\n  this.layout = GeometryLayout.XY;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.stride = 2;\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.flatCoordinates = null;\n\n};\n\ninherits(SimpleGeometry, Geometry);\n\n\n/**\n * @param {number} stride Stride.\n * @return {module:ol/geom/GeometryLayout} layout Layout.\n */\nfunction getLayoutForStride(stride) {\n  let layout;\n  if (stride == 2) {\n    layout = GeometryLayout.XY;\n  } else if (stride == 3) {\n    layout = GeometryLayout.XYZ;\n  } else if (stride == 4) {\n    layout = GeometryLayout.XYZM;\n  }\n  return (\n    /** @type {module:ol/geom/GeometryLayout} */ (layout)\n  );\n}\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @return {number} Stride.\n */\nexport function getStrideForLayout(layout) {\n  let stride;\n  if (layout == GeometryLayout.XY) {\n    stride = 2;\n  } else if (layout == GeometryLayout.XYZ || layout == GeometryLayout.XYM) {\n    stride = 3;\n  } else if (layout == GeometryLayout.XYZM) {\n    stride = 4;\n  }\n  return /** @type {number} */ (stride);\n}\n\n\n/**\n * @inheritDoc\n */\nSimpleGeometry.prototype.containsXY = FALSE;\n\n\n/**\n * @inheritDoc\n */\nSimpleGeometry.prototype.computeExtent = function(extent) {\n  return createOrUpdateFromFlatCoordinates(this.flatCoordinates,\n    0, this.flatCoordinates.length, this.stride, extent);\n};\n\n\n/**\n * @abstract\n * @return {Array} Coordinates.\n */\nSimpleGeometry.prototype.getCoordinates = function() {};\n\n\n/**\n * Return the first coordinate of the geometry.\n * @return {module:ol/coordinate~Coordinate} First coordinate.\n * @api\n */\nSimpleGeometry.prototype.getFirstCoordinate = function() {\n  return this.flatCoordinates.slice(0, this.stride);\n};\n\n\n/**\n * @return {Array.<number>} Flat coordinates.\n */\nSimpleGeometry.prototype.getFlatCoordinates = function() {\n  return this.flatCoordinates;\n};\n\n\n/**\n * Return the last coordinate of the geometry.\n * @return {module:ol/coordinate~Coordinate} Last point.\n * @api\n */\nSimpleGeometry.prototype.getLastCoordinate = function() {\n  return this.flatCoordinates.slice(this.flatCoordinates.length - this.stride);\n};\n\n\n/**\n * Return the {@link module:ol/geom/GeometryLayout~GeometryLayout layout} of the geometry.\n * @return {module:ol/geom/GeometryLayout} Layout.\n * @api\n */\nSimpleGeometry.prototype.getLayout = function() {\n  return this.layout;\n};\n\n\n/**\n * @inheritDoc\n */\nSimpleGeometry.prototype.getSimplifiedGeometry = function(squaredTolerance) {\n  if (this.simplifiedGeometryRevision != this.getRevision()) {\n    clear(this.simplifiedGeometryCache);\n    this.simplifiedGeometryMaxMinSquaredTolerance = 0;\n    this.simplifiedGeometryRevision = this.getRevision();\n  }\n  // If squaredTolerance is negative or if we know that simplification will not\n  // have any effect then just return this.\n  if (squaredTolerance < 0 ||\n      (this.simplifiedGeometryMaxMinSquaredTolerance !== 0 &&\n       squaredTolerance <= this.simplifiedGeometryMaxMinSquaredTolerance)) {\n    return this;\n  }\n  const key = squaredTolerance.toString();\n  if (this.simplifiedGeometryCache.hasOwnProperty(key)) {\n    return this.simplifiedGeometryCache[key];\n  } else {\n    const simplifiedGeometry =\n        this.getSimplifiedGeometryInternal(squaredTolerance);\n    const simplifiedFlatCoordinates = simplifiedGeometry.getFlatCoordinates();\n    if (simplifiedFlatCoordinates.length < this.flatCoordinates.length) {\n      this.simplifiedGeometryCache[key] = simplifiedGeometry;\n      return simplifiedGeometry;\n    } else {\n      // Simplification did not actually remove any coordinates.  We now know\n      // that any calls to getSimplifiedGeometry with a squaredTolerance less\n      // than or equal to the current squaredTolerance will also not have any\n      // effect.  This allows us to short circuit simplification (saving CPU\n      // cycles) and prevents the cache of simplified geometries from filling\n      // up with useless identical copies of this geometry (saving memory).\n      this.simplifiedGeometryMaxMinSquaredTolerance = squaredTolerance;\n      return this;\n    }\n  }\n};\n\n\n/**\n * @param {number} squaredTolerance Squared tolerance.\n * @return {module:ol/geom/SimpleGeometry} Simplified geometry.\n * @protected\n */\nSimpleGeometry.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  return this;\n};\n\n\n/**\n * @return {number} Stride.\n */\nSimpleGeometry.prototype.getStride = function() {\n  return this.stride;\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @protected\n */\nSimpleGeometry.prototype.setFlatCoordinatesInternal = function(layout, flatCoordinates) {\n  this.stride = getStrideForLayout(layout);\n  this.layout = layout;\n  this.flatCoordinates = flatCoordinates;\n};\n\n\n/**\n * @abstract\n * @param {Array} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n */\nSimpleGeometry.prototype.setCoordinates = function(coordinates, opt_layout) {};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout|undefined} layout Layout.\n * @param {Array} coordinates Coordinates.\n * @param {number} nesting Nesting.\n * @protected\n */\nSimpleGeometry.prototype.setLayout = function(layout, coordinates, nesting) {\n  /** @type {number} */\n  let stride;\n  if (layout) {\n    stride = getStrideForLayout(layout);\n  } else {\n    for (let i = 0; i < nesting; ++i) {\n      if (coordinates.length === 0) {\n        this.layout = GeometryLayout.XY;\n        this.stride = 2;\n        return;\n      } else {\n        coordinates = /** @type {Array} */ (coordinates[0]);\n      }\n    }\n    stride = coordinates.length;\n    layout = getLayoutForStride(stride);\n  }\n  this.layout = layout;\n  this.stride = stride;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nSimpleGeometry.prototype.applyTransform = function(transformFn) {\n  if (this.flatCoordinates) {\n    transformFn(this.flatCoordinates, this.flatCoordinates, this.stride);\n    this.changed();\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nSimpleGeometry.prototype.rotate = function(angle, anchor) {\n  const flatCoordinates = this.getFlatCoordinates();\n  if (flatCoordinates) {\n    const stride = this.getStride();\n    rotate(\n      flatCoordinates, 0, flatCoordinates.length,\n      stride, angle, anchor, flatCoordinates);\n    this.changed();\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nSimpleGeometry.prototype.scale = function(sx, opt_sy, opt_anchor) {\n  let sy = opt_sy;\n  if (sy === undefined) {\n    sy = sx;\n  }\n  let anchor = opt_anchor;\n  if (!anchor) {\n    anchor = getCenter(this.getExtent());\n  }\n  const flatCoordinates = this.getFlatCoordinates();\n  if (flatCoordinates) {\n    const stride = this.getStride();\n    scale(\n      flatCoordinates, 0, flatCoordinates.length,\n      stride, sx, sy, anchor, flatCoordinates);\n    this.changed();\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nSimpleGeometry.prototype.translate = function(deltaX, deltaY) {\n  const flatCoordinates = this.getFlatCoordinates();\n  if (flatCoordinates) {\n    const stride = this.getStride();\n    translate(\n      flatCoordinates, 0, flatCoordinates.length, stride,\n      deltaX, deltaY, flatCoordinates);\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/SimpleGeometry} simpleGeometry Simple geometry.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Transformed flat coordinates.\n */\nexport function transformGeom2D(simpleGeometry, transform, opt_dest) {\n  const flatCoordinates = simpleGeometry.getFlatCoordinates();\n  if (!flatCoordinates) {\n    return null;\n  } else {\n    const stride = simpleGeometry.getStride();\n    return transform2D(\n      flatCoordinates, 0, flatCoordinates.length, stride,\n      transform, opt_dest);\n  }\n}\n\nexport default SimpleGeometry;\n","/**\n * @module ol/geom/flat/area\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} Area.\n */\nexport function linearRing(flatCoordinates, offset, end, stride) {\n  let twiceArea = 0;\n  let x1 = flatCoordinates[end - stride];\n  let y1 = flatCoordinates[end - stride + 1];\n  for (; offset < end; offset += stride) {\n    const x2 = flatCoordinates[offset];\n    const y2 = flatCoordinates[offset + 1];\n    twiceArea += y1 * x2 - x1 * y2;\n    x1 = x2;\n    y1 = y2;\n  }\n  return twiceArea / 2;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @return {number} Area.\n */\nexport function linearRings(flatCoordinates, offset, ends, stride) {\n  let area = 0;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    area += linearRing(flatCoordinates, offset, end, stride);\n    offset = end;\n  }\n  return area;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @return {number} Area.\n */\nexport function linearRingss(flatCoordinates, offset, endss, stride) {\n  let area = 0;\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    area += linearRings(flatCoordinates, offset, ends, stride);\n    offset = ends[ends.length - 1];\n  }\n  return area;\n}\n","/**\n * @module ol/geom/flat/closest\n */\nimport {lerp, squaredDistance as squaredDx} from '../../math.js';\n\n\n/**\n * Returns the point on the 2D line segment flatCoordinates[offset1] to\n * flatCoordinates[offset2] that is closest to the point (x, y).  Extra\n * dimensions are linearly interpolated.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset1 Offset 1.\n * @param {number} offset2 Offset 2.\n * @param {number} stride Stride.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {Array.<number>} closestPoint Closest point.\n */\nfunction assignClosest(flatCoordinates, offset1, offset2, stride, x, y, closestPoint) {\n  const x1 = flatCoordinates[offset1];\n  const y1 = flatCoordinates[offset1 + 1];\n  const dx = flatCoordinates[offset2] - x1;\n  const dy = flatCoordinates[offset2 + 1] - y1;\n  let offset;\n  if (dx === 0 && dy === 0) {\n    offset = offset1;\n  } else {\n    const t = ((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      offset = offset2;\n    } else if (t > 0) {\n      for (let i = 0; i < stride; ++i) {\n        closestPoint[i] = lerp(flatCoordinates[offset1 + i],\n          flatCoordinates[offset2 + i], t);\n      }\n      closestPoint.length = stride;\n      return;\n    } else {\n      offset = offset1;\n    }\n  }\n  for (let i = 0; i < stride; ++i) {\n    closestPoint[i] = flatCoordinates[offset + i];\n  }\n  closestPoint.length = stride;\n}\n\n\n/**\n * Return the squared of the largest distance between any pair of consecutive\n * coordinates.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} max Max squared delta.\n * @return {number} Max squared delta.\n */\nexport function maxSquaredDelta(flatCoordinates, offset, end, stride, max) {\n  let x1 = flatCoordinates[offset];\n  let y1 = flatCoordinates[offset + 1];\n  for (offset += stride; offset < end; offset += stride) {\n    const x2 = flatCoordinates[offset];\n    const y2 = flatCoordinates[offset + 1];\n    const squaredDelta = squaredDx(x1, y1, x2, y2);\n    if (squaredDelta > max) {\n      max = squaredDelta;\n    }\n    x1 = x2;\n    y1 = y2;\n  }\n  return max;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} max Max squared delta.\n * @return {number} Max squared delta.\n */\nexport function arrayMaxSquaredDelta(flatCoordinates, offset, ends, stride, max) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    max = maxSquaredDelta(\n      flatCoordinates, offset, end, stride, max);\n    offset = end;\n  }\n  return max;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {number} max Max squared delta.\n * @return {number} Max squared delta.\n */\nexport function multiArrayMaxSquaredDelta(flatCoordinates, offset, endss, stride, max) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    max = arrayMaxSquaredDelta(\n      flatCoordinates, offset, ends, stride, max);\n    offset = ends[ends.length - 1];\n  }\n  return max;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} maxDelta Max delta.\n * @param {boolean} isRing Is ring.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {Array.<number>} closestPoint Closest point.\n * @param {number} minSquaredDistance Minimum squared distance.\n * @param {Array.<number>=} opt_tmpPoint Temporary point object.\n * @return {number} Minimum squared distance.\n */\nexport function assignClosestPoint(flatCoordinates, offset, end,\n  stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance,\n  opt_tmpPoint) {\n  if (offset == end) {\n    return minSquaredDistance;\n  }\n  let i, squaredDistance;\n  if (maxDelta === 0) {\n    // All points are identical, so just test the first point.\n    squaredDistance = squaredDx(\n      x, y, flatCoordinates[offset], flatCoordinates[offset + 1]);\n    if (squaredDistance < minSquaredDistance) {\n      for (i = 0; i < stride; ++i) {\n        closestPoint[i] = flatCoordinates[offset + i];\n      }\n      closestPoint.length = stride;\n      return squaredDistance;\n    } else {\n      return minSquaredDistance;\n    }\n  }\n  const tmpPoint = opt_tmpPoint ? opt_tmpPoint : [NaN, NaN];\n  let index = offset + stride;\n  while (index < end) {\n    assignClosest(\n      flatCoordinates, index - stride, index, stride, x, y, tmpPoint);\n    squaredDistance = squaredDx(x, y, tmpPoint[0], tmpPoint[1]);\n    if (squaredDistance < minSquaredDistance) {\n      minSquaredDistance = squaredDistance;\n      for (i = 0; i < stride; ++i) {\n        closestPoint[i] = tmpPoint[i];\n      }\n      closestPoint.length = stride;\n      index += stride;\n    } else {\n      // Skip ahead multiple points, because we know that all the skipped\n      // points cannot be any closer than the closest point we have found so\n      // far.  We know this because we know how close the current point is, how\n      // close the closest point we have found so far is, and the maximum\n      // distance between consecutive points.  For example, if we're currently\n      // at distance 10, the best we've found so far is 3, and that the maximum\n      // distance between consecutive points is 2, then we'll need to skip at\n      // least (10 - 3) / 2 == 3 (rounded down) points to have any chance of\n      // finding a closer point.  We use Math.max(..., 1) to ensure that we\n      // always advance at least one point, to avoid an infinite loop.\n      index += stride * Math.max(\n        ((Math.sqrt(squaredDistance) -\n            Math.sqrt(minSquaredDistance)) / maxDelta) | 0, 1);\n    }\n  }\n  if (isRing) {\n    // Check the closing segment.\n    assignClosest(\n      flatCoordinates, end - stride, offset, stride, x, y, tmpPoint);\n    squaredDistance = squaredDx(x, y, tmpPoint[0], tmpPoint[1]);\n    if (squaredDistance < minSquaredDistance) {\n      minSquaredDistance = squaredDistance;\n      for (i = 0; i < stride; ++i) {\n        closestPoint[i] = tmpPoint[i];\n      }\n      closestPoint.length = stride;\n    }\n  }\n  return minSquaredDistance;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} maxDelta Max delta.\n * @param {boolean} isRing Is ring.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {Array.<number>} closestPoint Closest point.\n * @param {number} minSquaredDistance Minimum squared distance.\n * @param {Array.<number>=} opt_tmpPoint Temporary point object.\n * @return {number} Minimum squared distance.\n */\nexport function assignClosestArrayPoint(flatCoordinates, offset, ends,\n  stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance,\n  opt_tmpPoint) {\n  const tmpPoint = opt_tmpPoint ? opt_tmpPoint : [NaN, NaN];\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    minSquaredDistance = assignClosestPoint(\n      flatCoordinates, offset, end, stride,\n      maxDelta, isRing, x, y, closestPoint, minSquaredDistance, tmpPoint);\n    offset = end;\n  }\n  return minSquaredDistance;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {number} maxDelta Max delta.\n * @param {boolean} isRing Is ring.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {Array.<number>} closestPoint Closest point.\n * @param {number} minSquaredDistance Minimum squared distance.\n * @param {Array.<number>=} opt_tmpPoint Temporary point object.\n * @return {number} Minimum squared distance.\n */\nexport function assignClosestMultiArrayPoint(flatCoordinates, offset,\n  endss, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance,\n  opt_tmpPoint) {\n  const tmpPoint = opt_tmpPoint ? opt_tmpPoint : [NaN, NaN];\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    minSquaredDistance = assignClosestArrayPoint(\n      flatCoordinates, offset, ends, stride,\n      maxDelta, isRing, x, y, closestPoint, minSquaredDistance, tmpPoint);\n    offset = ends[ends.length - 1];\n  }\n  return minSquaredDistance;\n}\n","/**\n * @module ol/geom/flat/deflate\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} stride Stride.\n * @return {number} offset Offset.\n */\nexport function deflateCoordinate(flatCoordinates, offset, coordinate, stride) {\n  for (let i = 0, ii = coordinate.length; i < ii; ++i) {\n    flatCoordinates[offset++] = coordinate[i];\n  }\n  return offset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {number} stride Stride.\n * @return {number} offset Offset.\n */\nexport function deflateCoordinates(flatCoordinates, offset, coordinates, stride) {\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    const coordinate = coordinates[i];\n    for (let j = 0; j < stride; ++j) {\n      flatCoordinates[offset++] = coordinate[j];\n    }\n  }\n  return offset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} coordinatess Coordinatess.\n * @param {number} stride Stride.\n * @param {Array.<number>=} opt_ends Ends.\n * @return {Array.<number>} Ends.\n */\nexport function deflateCoordinatesArray(flatCoordinates, offset, coordinatess, stride, opt_ends) {\n  const ends = opt_ends ? opt_ends : [];\n  let i = 0;\n  for (let j = 0, jj = coordinatess.length; j < jj; ++j) {\n    const end = deflateCoordinates(\n      flatCoordinates, offset, coordinatess[j], stride);\n    ends[i++] = end;\n    offset = end;\n  }\n  ends.length = i;\n  return ends;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>} coordinatesss Coordinatesss.\n * @param {number} stride Stride.\n * @param {Array.<Array.<number>>=} opt_endss Endss.\n * @return {Array.<Array.<number>>} Endss.\n */\nexport function deflateMultiCoordinatesArray(flatCoordinates, offset, coordinatesss, stride, opt_endss) {\n  const endss = opt_endss ? opt_endss : [];\n  let i = 0;\n  for (let j = 0, jj = coordinatesss.length; j < jj; ++j) {\n    const ends = deflateCoordinatesArray(\n      flatCoordinates, offset, coordinatesss[j], stride, endss[i]);\n    endss[i++] = ends;\n    offset = ends[ends.length - 1];\n  }\n  endss.length = i;\n  return endss;\n}\n","/**\n * @module ol/geom/flat/inflate\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {Array.<module:ol/coordinate~Coordinate>=} opt_coordinates Coordinates.\n * @return {Array.<module:ol/coordinate~Coordinate>} Coordinates.\n */\nexport function inflateCoordinates(flatCoordinates, offset, end, stride, opt_coordinates) {\n  const coordinates = opt_coordinates !== undefined ? opt_coordinates : [];\n  let i = 0;\n  for (let j = offset; j < end; j += stride) {\n    coordinates[i++] = flatCoordinates.slice(j, j + stride);\n  }\n  coordinates.length = i;\n  return coordinates;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>=} opt_coordinatess Coordinatess.\n * @return {Array.<Array.<module:ol/coordinate~Coordinate>>} Coordinatess.\n */\nexport function inflateCoordinatesArray(flatCoordinates, offset, ends, stride, opt_coordinatess) {\n  const coordinatess = opt_coordinatess !== undefined ? opt_coordinatess : [];\n  let i = 0;\n  for (let j = 0, jj = ends.length; j < jj; ++j) {\n    const end = ends[j];\n    coordinatess[i++] = inflateCoordinates(\n      flatCoordinates, offset, end, stride, coordinatess[i]);\n    offset = end;\n  }\n  coordinatess.length = i;\n  return coordinatess;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>=} opt_coordinatesss\n *     Coordinatesss.\n * @return {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>} Coordinatesss.\n */\nexport function inflateMultiCoordinatesArray(flatCoordinates, offset, endss, stride, opt_coordinatesss) {\n  const coordinatesss = opt_coordinatesss !== undefined ? opt_coordinatesss : [];\n  let i = 0;\n  for (let j = 0, jj = endss.length; j < jj; ++j) {\n    const ends = endss[j];\n    coordinatesss[i++] = inflateCoordinatesArray(\n      flatCoordinates, offset, ends, stride, coordinatesss[i]);\n    offset = ends[ends.length - 1];\n  }\n  coordinatesss.length = i;\n  return coordinatesss;\n}\n","/**\n * @module ol/geom/flat/simplify\n */\n// Based on simplify-js https://github.com/mourner/simplify-js\n// Copyright (c) 2012, Vladimir Agafonkin\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are met:\n//\n//    1. Redistributions of source code must retain the above copyright notice,\n//       this list of conditions and the following disclaimer.\n//\n//    2. Redistributions in binary form must reproduce the above copyright\n//       notice, this list of conditions and the following disclaimer in the\n//       documentation and/or other materials provided with the distribution.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n// ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n// POSSIBILITY OF SUCH DAMAGE.\n\nimport {squaredSegmentDistance, squaredDistance} from '../../math.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {boolean} highQuality Highest quality.\n * @param {Array.<number>=} opt_simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @return {Array.<number>} Simplified line string.\n */\nexport function simplifyLineString(flatCoordinates, offset, end,\n  stride, squaredTolerance, highQuality, opt_simplifiedFlatCoordinates) {\n  const simplifiedFlatCoordinates = opt_simplifiedFlatCoordinates !== undefined ?\n    opt_simplifiedFlatCoordinates : [];\n  if (!highQuality) {\n    end = radialDistance(flatCoordinates, offset, end,\n      stride, squaredTolerance,\n      simplifiedFlatCoordinates, 0);\n    flatCoordinates = simplifiedFlatCoordinates;\n    offset = 0;\n    stride = 2;\n  }\n  simplifiedFlatCoordinates.length = douglasPeucker(\n    flatCoordinates, offset, end, stride, squaredTolerance,\n    simplifiedFlatCoordinates, 0);\n  return simplifiedFlatCoordinates;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @return {number} Simplified offset.\n */\nexport function douglasPeucker(flatCoordinates, offset, end,\n  stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset) {\n  const n = (end - offset) / stride;\n  if (n < 3) {\n    for (; offset < end; offset += stride) {\n      simplifiedFlatCoordinates[simplifiedOffset++] =\n          flatCoordinates[offset];\n      simplifiedFlatCoordinates[simplifiedOffset++] =\n          flatCoordinates[offset + 1];\n    }\n    return simplifiedOffset;\n  }\n  /** @type {Array.<number>} */\n  const markers = new Array(n);\n  markers[0] = 1;\n  markers[n - 1] = 1;\n  /** @type {Array.<number>} */\n  const stack = [offset, end - stride];\n  let index = 0;\n  while (stack.length > 0) {\n    const last = stack.pop();\n    const first = stack.pop();\n    let maxSquaredDistance = 0;\n    const x1 = flatCoordinates[first];\n    const y1 = flatCoordinates[first + 1];\n    const x2 = flatCoordinates[last];\n    const y2 = flatCoordinates[last + 1];\n    for (let i = first + stride; i < last; i += stride) {\n      const x = flatCoordinates[i];\n      const y = flatCoordinates[i + 1];\n      const squaredDistance = squaredSegmentDistance(\n        x, y, x1, y1, x2, y2);\n      if (squaredDistance > maxSquaredDistance) {\n        index = i;\n        maxSquaredDistance = squaredDistance;\n      }\n    }\n    if (maxSquaredDistance > squaredTolerance) {\n      markers[(index - offset) / stride] = 1;\n      if (first + stride < index) {\n        stack.push(first, index);\n      }\n      if (index + stride < last) {\n        stack.push(index, last);\n      }\n    }\n  }\n  for (let i = 0; i < n; ++i) {\n    if (markers[i]) {\n      simplifiedFlatCoordinates[simplifiedOffset++] =\n          flatCoordinates[offset + i * stride];\n      simplifiedFlatCoordinates[simplifiedOffset++] =\n          flatCoordinates[offset + i * stride + 1];\n    }\n  }\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @param {Array.<number>} simplifiedEnds Simplified ends.\n * @return {number} Simplified offset.\n */\nexport function douglasPeuckerArray(flatCoordinates, offset,\n  ends, stride, squaredTolerance, simplifiedFlatCoordinates,\n  simplifiedOffset, simplifiedEnds) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    simplifiedOffset = douglasPeucker(\n      flatCoordinates, offset, end, stride, squaredTolerance,\n      simplifiedFlatCoordinates, simplifiedOffset);\n    simplifiedEnds.push(simplifiedOffset);\n    offset = end;\n  }\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @param {Array.<Array.<number>>} simplifiedEndss Simplified endss.\n * @return {number} Simplified offset.\n */\nexport function douglasPeuckerMultiArray(\n  flatCoordinates, offset, endss, stride, squaredTolerance,\n  simplifiedFlatCoordinates, simplifiedOffset, simplifiedEndss) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    const simplifiedEnds = [];\n    simplifiedOffset = douglasPeuckerArray(\n      flatCoordinates, offset, ends, stride, squaredTolerance,\n      simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds);\n    simplifiedEndss.push(simplifiedEnds);\n    offset = ends[ends.length - 1];\n  }\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @return {number} Simplified offset.\n */\nexport function radialDistance(flatCoordinates, offset, end,\n  stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset) {\n  if (end <= offset + stride) {\n    // zero or one point, no simplification possible, so copy and return\n    for (; offset < end; offset += stride) {\n      simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset];\n      simplifiedFlatCoordinates[simplifiedOffset++] =\n          flatCoordinates[offset + 1];\n    }\n    return simplifiedOffset;\n  }\n  let x1 = flatCoordinates[offset];\n  let y1 = flatCoordinates[offset + 1];\n  // copy first point\n  simplifiedFlatCoordinates[simplifiedOffset++] = x1;\n  simplifiedFlatCoordinates[simplifiedOffset++] = y1;\n  let x2 = x1;\n  let y2 = y1;\n  for (offset += stride; offset < end; offset += stride) {\n    x2 = flatCoordinates[offset];\n    y2 = flatCoordinates[offset + 1];\n    if (squaredDistance(x1, y1, x2, y2) > squaredTolerance) {\n      // copy point at offset\n      simplifiedFlatCoordinates[simplifiedOffset++] = x2;\n      simplifiedFlatCoordinates[simplifiedOffset++] = y2;\n      x1 = x2;\n      y1 = y2;\n    }\n  }\n  if (x2 != x1 || y2 != y1) {\n    // copy last point\n    simplifiedFlatCoordinates[simplifiedOffset++] = x2;\n    simplifiedFlatCoordinates[simplifiedOffset++] = y2;\n  }\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {number} value Value.\n * @param {number} tolerance Tolerance.\n * @return {number} Rounded value.\n */\nexport function snap(value, tolerance) {\n  return tolerance * Math.round(value / tolerance);\n}\n\n\n/**\n * Simplifies a line string using an algorithm designed by Tim Schaub.\n * Coordinates are snapped to the nearest value in a virtual grid and\n * consecutive duplicate coordinates are discarded.  This effectively preserves\n * topology as the simplification of any subsection of a line string is\n * independent of the rest of the line string.  This means that, for examples,\n * the common edge between two polygons will be simplified to the same line\n * string independently in both polygons.  This implementation uses a single\n * pass over the coordinates and eliminates intermediate collinear points.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} tolerance Tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @return {number} Simplified offset.\n */\nexport function quantize(flatCoordinates, offset, end, stride,\n  tolerance, simplifiedFlatCoordinates, simplifiedOffset) {\n  // do nothing if the line is empty\n  if (offset == end) {\n    return simplifiedOffset;\n  }\n  // snap the first coordinate (P1)\n  let x1 = snap(flatCoordinates[offset], tolerance);\n  let y1 = snap(flatCoordinates[offset + 1], tolerance);\n  offset += stride;\n  // add the first coordinate to the output\n  simplifiedFlatCoordinates[simplifiedOffset++] = x1;\n  simplifiedFlatCoordinates[simplifiedOffset++] = y1;\n  // find the next coordinate that does not snap to the same value as the first\n  // coordinate (P2)\n  let x2, y2;\n  do {\n    x2 = snap(flatCoordinates[offset], tolerance);\n    y2 = snap(flatCoordinates[offset + 1], tolerance);\n    offset += stride;\n    if (offset == end) {\n      // all coordinates snap to the same value, the line collapses to a point\n      // push the last snapped value anyway to ensure that the output contains\n      // at least two points\n      // FIXME should we really return at least two points anyway?\n      simplifiedFlatCoordinates[simplifiedOffset++] = x2;\n      simplifiedFlatCoordinates[simplifiedOffset++] = y2;\n      return simplifiedOffset;\n    }\n  } while (x2 == x1 && y2 == y1);\n  while (offset < end) {\n    // snap the next coordinate (P3)\n    const x3 = snap(flatCoordinates[offset], tolerance);\n    const y3 = snap(flatCoordinates[offset + 1], tolerance);\n    offset += stride;\n    // skip P3 if it is equal to P2\n    if (x3 == x2 && y3 == y2) {\n      continue;\n    }\n    // calculate the delta between P1 and P2\n    const dx1 = x2 - x1;\n    const dy1 = y2 - y1;\n    // calculate the delta between P3 and P1\n    const dx2 = x3 - x1;\n    const dy2 = y3 - y1;\n    // if P1, P2, and P3 are colinear and P3 is further from P1 than P2 is from\n    // P1 in the same direction then P2 is on the straight line between P1 and\n    // P3\n    if ((dx1 * dy2 == dy1 * dx2) &&\n        ((dx1 < 0 && dx2 < dx1) || dx1 == dx2 || (dx1 > 0 && dx2 > dx1)) &&\n        ((dy1 < 0 && dy2 < dy1) || dy1 == dy2 || (dy1 > 0 && dy2 > dy1))) {\n      // discard P2 and set P2 = P3\n      x2 = x3;\n      y2 = y3;\n      continue;\n    }\n    // either P1, P2, and P3 are not colinear, or they are colinear but P3 is\n    // between P3 and P1 or on the opposite half of the line to P2.  add P2,\n    // and continue with P1 = P2 and P2 = P3\n    simplifiedFlatCoordinates[simplifiedOffset++] = x2;\n    simplifiedFlatCoordinates[simplifiedOffset++] = y2;\n    x1 = x2;\n    y1 = y2;\n    x2 = x3;\n    y2 = y3;\n  }\n  // add the last point (P2)\n  simplifiedFlatCoordinates[simplifiedOffset++] = x2;\n  simplifiedFlatCoordinates[simplifiedOffset++] = y2;\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} tolerance Tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @param {Array.<number>} simplifiedEnds Simplified ends.\n * @return {number} Simplified offset.\n */\nexport function quantizeArray(\n  flatCoordinates, offset, ends, stride,\n  tolerance,\n  simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    simplifiedOffset = quantize(\n      flatCoordinates, offset, end, stride,\n      tolerance,\n      simplifiedFlatCoordinates, simplifiedOffset);\n    simplifiedEnds.push(simplifiedOffset);\n    offset = end;\n  }\n  return simplifiedOffset;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {number} tolerance Tolerance.\n * @param {Array.<number>} simplifiedFlatCoordinates Simplified flat\n *     coordinates.\n * @param {number} simplifiedOffset Simplified offset.\n * @param {Array.<Array.<number>>} simplifiedEndss Simplified endss.\n * @return {number} Simplified offset.\n */\nexport function quantizeMultiArray(\n  flatCoordinates, offset, endss, stride,\n  tolerance,\n  simplifiedFlatCoordinates, simplifiedOffset, simplifiedEndss) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    const simplifiedEnds = [];\n    simplifiedOffset = quantizeArray(\n      flatCoordinates, offset, ends, stride,\n      tolerance,\n      simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds);\n    simplifiedEndss.push(simplifiedEnds);\n    offset = ends[ends.length - 1];\n  }\n  return simplifiedOffset;\n}\n","/**\n * @module ol/geom/LinearRing\n */\nimport {inherits} from '../util.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {linearRing as linearRingArea} from '../geom/flat/area.js';\nimport {assignClosestPoint, maxSquaredDelta} from '../geom/flat/closest.js';\nimport {deflateCoordinates} from '../geom/flat/deflate.js';\nimport {inflateCoordinates} from '../geom/flat/inflate.js';\nimport {douglasPeucker} from '../geom/flat/simplify.js';\n\n/**\n * @classdesc\n * Linear ring geometry. Only used as part of polygon; cannot be rendered\n * on its own.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst LinearRing = function(coordinates, opt_layout) {\n\n  SimpleGeometry.call(this);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDelta_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDeltaRevision_ = -1;\n\n  this.setCoordinates(coordinates, opt_layout);\n\n};\n\ninherits(LinearRing, SimpleGeometry);\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/LinearRing} Clone.\n * @override\n * @api\n */\nLinearRing.prototype.clone = function() {\n  const linearRing = new LinearRing(null);\n  linearRing.setFlatCoordinates(this.layout, this.flatCoordinates.slice());\n  return linearRing;\n};\n\n\n/**\n * @inheritDoc\n */\nLinearRing.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  if (this.maxDeltaRevision_ != this.getRevision()) {\n    this.maxDelta_ = Math.sqrt(maxSquaredDelta(\n      this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, 0));\n    this.maxDeltaRevision_ = this.getRevision();\n  }\n  return assignClosestPoint(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    this.maxDelta_, true, x, y, closestPoint, minSquaredDistance);\n};\n\n\n/**\n * Return the area of the linear ring on projected plane.\n * @return {number} Area (on projected plane).\n * @api\n */\nLinearRing.prototype.getArea = function() {\n  return linearRingArea(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);\n};\n\n\n/**\n * Return the coordinates of the linear ring.\n * @return {Array.<module:ol/coordinate~Coordinate>} Coordinates.\n * @override\n * @api\n */\nLinearRing.prototype.getCoordinates = function() {\n  return inflateCoordinates(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);\n};\n\n\n/**\n * @inheritDoc\n */\nLinearRing.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  const simplifiedFlatCoordinates = [];\n  simplifiedFlatCoordinates.length = douglasPeucker(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    squaredTolerance, simplifiedFlatCoordinates, 0);\n  const simplifiedLinearRing = new LinearRing(null);\n  simplifiedLinearRing.setFlatCoordinates(\n    GeometryLayout.XY, simplifiedFlatCoordinates);\n  return simplifiedLinearRing;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nLinearRing.prototype.getType = function() {\n  return GeometryType.LINEAR_RING;\n};\n\n\n/**\n * @inheritDoc\n */\nLinearRing.prototype.intersectsExtent = function(extent) {};\n\n\n/**\n * Set the coordinates of the linear ring.\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nLinearRing.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null);\n  } else {\n    this.setLayout(opt_layout, coordinates, 1);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinates(\n      this.flatCoordinates, 0, coordinates, this.stride);\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n */\nLinearRing.prototype.setFlatCoordinates = function(layout, flatCoordinates) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.changed();\n};\nexport default LinearRing;\n","/**\n * @module ol/geom/Point\n */\nimport {inherits} from '../util.js';\nimport {createOrUpdateFromCoordinate, containsXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {deflateCoordinate} from '../geom/flat/deflate.js';\nimport {squaredDistance as squaredDx} from '../math.js';\n\n/**\n * @classdesc\n * Point geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {module:ol/coordinate~Coordinate} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst Point = function(coordinates, opt_layout) {\n  SimpleGeometry.call(this);\n  this.setCoordinates(coordinates, opt_layout);\n};\n\ninherits(Point, SimpleGeometry);\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/Point} Clone.\n * @override\n * @api\n */\nPoint.prototype.clone = function() {\n  const point = new Point(null);\n  point.setFlatCoordinates(this.layout, this.flatCoordinates.slice());\n  return point;\n};\n\n\n/**\n * @inheritDoc\n */\nPoint.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  const flatCoordinates = this.flatCoordinates;\n  const squaredDistance = squaredDx(x, y, flatCoordinates[0], flatCoordinates[1]);\n  if (squaredDistance < minSquaredDistance) {\n    const stride = this.stride;\n    for (let i = 0; i < stride; ++i) {\n      closestPoint[i] = flatCoordinates[i];\n    }\n    closestPoint.length = stride;\n    return squaredDistance;\n  } else {\n    return minSquaredDistance;\n  }\n};\n\n\n/**\n * Return the coordinate of the point.\n * @return {module:ol/coordinate~Coordinate} Coordinates.\n * @override\n * @api\n */\nPoint.prototype.getCoordinates = function() {\n  return !this.flatCoordinates ? [] : this.flatCoordinates.slice();\n};\n\n\n/**\n * @inheritDoc\n */\nPoint.prototype.computeExtent = function(extent) {\n  return createOrUpdateFromCoordinate(this.flatCoordinates, extent);\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nPoint.prototype.getType = function() {\n  return GeometryType.POINT;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nPoint.prototype.intersectsExtent = function(extent) {\n  return containsXY(extent, this.flatCoordinates[0], this.flatCoordinates[1]);\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nPoint.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null);\n  } else {\n    this.setLayout(opt_layout, coordinates, 0);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinate(\n      this.flatCoordinates, 0, coordinates, this.stride);\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n */\nPoint.prototype.setFlatCoordinates = function(layout, flatCoordinates) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.changed();\n};\nexport default Point;\n","/**\n * @module ol/geom/flat/contains\n */\nimport {forEachCorner} from '../../extent.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} Contains extent.\n */\nexport function linearRingContainsExtent(flatCoordinates, offset, end, stride, extent) {\n  const outside = forEachCorner(extent,\n    /**\n     * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n     * @return {boolean} Contains (x, y).\n     */\n    function(coordinate) {\n      return !linearRingContainsXY(flatCoordinates, offset, end, stride, coordinate[0], coordinate[1]);\n    });\n  return !outside;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {boolean} Contains (x, y).\n */\nexport function linearRingContainsXY(flatCoordinates, offset, end, stride, x, y) {\n  // http://geomalgorithms.com/a03-_inclusion.html\n  // Copyright 2000 softSurfer, 2012 Dan Sunday\n  // This code may be freely used and modified for any purpose\n  // providing that this copyright notice is included with it.\n  // SoftSurfer makes no warranty for this code, and cannot be held\n  // liable for any real or imagined damage resulting from its use.\n  // Users of this code must verify correctness for their application.\n  let wn = 0;\n  let x1 = flatCoordinates[end - stride];\n  let y1 = flatCoordinates[end - stride + 1];\n  for (; offset < end; offset += stride) {\n    const x2 = flatCoordinates[offset];\n    const y2 = flatCoordinates[offset + 1];\n    if (y1 <= y) {\n      if (y2 > y && ((x2 - x1) * (y - y1)) - ((x - x1) * (y2 - y1)) > 0) {\n        wn++;\n      }\n    } else if (y2 <= y && ((x2 - x1) * (y - y1)) - ((x - x1) * (y2 - y1)) < 0) {\n      wn--;\n    }\n    x1 = x2;\n    y1 = y2;\n  }\n  return wn !== 0;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {boolean} Contains (x, y).\n */\nexport function linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y) {\n  if (ends.length === 0) {\n    return false;\n  }\n  if (!linearRingContainsXY(flatCoordinates, offset, ends[0], stride, x, y)) {\n    return false;\n  }\n  for (let i = 1, ii = ends.length; i < ii; ++i) {\n    if (linearRingContainsXY(flatCoordinates, ends[i - 1], ends[i], stride, x, y)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {boolean} Contains (x, y).\n */\nexport function linearRingssContainsXY(flatCoordinates, offset, endss, stride, x, y) {\n  if (endss.length === 0) {\n    return false;\n  }\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    if (linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y)) {\n      return true;\n    }\n    offset = ends[ends.length - 1];\n  }\n  return false;\n}\n","/**\n * @module ol/geom/flat/interiorpoint\n */\nimport {numberSafeCompareFunction} from '../../array.js';\nimport {linearRingsContainsXY} from '../flat/contains.js';\n\n\n/**\n * Calculates a point that is likely to lie in the interior of the linear rings.\n * Inspired by JTS's com.vividsolutions.jts.geom.Geometry#getInteriorPoint.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {Array.<number>} flatCenters Flat centers.\n * @param {number} flatCentersOffset Flat center offset.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Destination point as XYM coordinate, where M is the\n * length of the horizontal intersection that the point belongs to.\n */\nexport function getInteriorPointOfArray(flatCoordinates, offset,\n  ends, stride, flatCenters, flatCentersOffset, opt_dest) {\n  let i, ii, x, x1, x2, y1, y2;\n  const y = flatCenters[flatCentersOffset + 1];\n  /** @type {Array.<number>} */\n  const intersections = [];\n  // Calculate intersections with the horizontal line\n  for (let r = 0, rr = ends.length; r < rr; ++r) {\n    const end = ends[r];\n    x1 = flatCoordinates[end - stride];\n    y1 = flatCoordinates[end - stride + 1];\n    for (i = offset; i < end; i += stride) {\n      x2 = flatCoordinates[i];\n      y2 = flatCoordinates[i + 1];\n      if ((y <= y1 && y2 <= y) || (y1 <= y && y <= y2)) {\n        x = (y - y1) / (y2 - y1) * (x2 - x1) + x1;\n        intersections.push(x);\n      }\n      x1 = x2;\n      y1 = y2;\n    }\n  }\n  // Find the longest segment of the horizontal line that has its center point\n  // inside the linear ring.\n  let pointX = NaN;\n  let maxSegmentLength = -Infinity;\n  intersections.sort(numberSafeCompareFunction);\n  x1 = intersections[0];\n  for (i = 1, ii = intersections.length; i < ii; ++i) {\n    x2 = intersections[i];\n    const segmentLength = Math.abs(x2 - x1);\n    if (segmentLength > maxSegmentLength) {\n      x = (x1 + x2) / 2;\n      if (linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y)) {\n        pointX = x;\n        maxSegmentLength = segmentLength;\n      }\n    }\n    x1 = x2;\n  }\n  if (isNaN(pointX)) {\n    // There is no horizontal line that has its center point inside the linear\n    // ring.  Use the center of the the linear ring's extent.\n    pointX = flatCenters[flatCentersOffset];\n  }\n  if (opt_dest) {\n    opt_dest.push(pointX, y, maxSegmentLength);\n    return opt_dest;\n  } else {\n    return [pointX, y, maxSegmentLength];\n  }\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {Array.<number>} flatCenters Flat centers.\n * @return {Array.<number>} Interior points as XYM coordinates, where M is the\n * length of the horizontal intersection that the point belongs to.\n */\nexport function getInteriorPointsOfMultiArray(flatCoordinates, offset, endss, stride, flatCenters) {\n  let interiorPoints = [];\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    interiorPoints = getInteriorPointOfArray(flatCoordinates,\n      offset, ends, stride, flatCenters, 2 * i, interiorPoints);\n    offset = ends[ends.length - 1];\n  }\n  return interiorPoints;\n}\n","/**\n * @module ol/geom/flat/segments\n */\n\n\n/**\n * This function calls `callback` for each segment of the flat coordinates\n * array. If the callback returns a truthy value the function returns that\n * value immediately. Otherwise the function returns `false`.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {function(this: S, module:ol/coordinate~Coordinate, module:ol/coordinate~Coordinate): T} callback Function\n *     called for each segment.\n * @param {S=} opt_this The object to be used as the value of 'this'\n *     within callback.\n * @return {T|boolean} Value.\n * @template T,S\n */\nexport function forEach(flatCoordinates, offset, end, stride, callback, opt_this) {\n  const point1 = [flatCoordinates[offset], flatCoordinates[offset + 1]];\n  const point2 = [];\n  let ret;\n  for (; (offset + stride) < end; offset += stride) {\n    point2[0] = flatCoordinates[offset + stride];\n    point2[1] = flatCoordinates[offset + stride + 1];\n    ret = callback.call(opt_this, point1, point2);\n    if (ret) {\n      return ret;\n    }\n    point1[0] = point2[0];\n    point1[1] = point2[1];\n  }\n  return false;\n}\n","/**\n * @module ol/geom/flat/intersectsextent\n */\nimport {containsExtent, createEmpty, extendFlatCoordinates, intersects, intersectsSegment} from '../../extent.js';\nimport {linearRingContainsXY, linearRingContainsExtent} from '../flat/contains.js';\nimport {forEach as forEachSegment} from '../flat/segments.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} True if the geometry and the extent intersect.\n */\nexport function intersectsLineString(flatCoordinates, offset, end, stride, extent) {\n  const coordinatesExtent = extendFlatCoordinates(\n    createEmpty(), flatCoordinates, offset, end, stride);\n  if (!intersects(extent, coordinatesExtent)) {\n    return false;\n  }\n  if (containsExtent(extent, coordinatesExtent)) {\n    return true;\n  }\n  if (coordinatesExtent[0] >= extent[0] &&\n      coordinatesExtent[2] <= extent[2]) {\n    return true;\n  }\n  if (coordinatesExtent[1] >= extent[1] &&\n      coordinatesExtent[3] <= extent[3]) {\n    return true;\n  }\n  return forEachSegment(flatCoordinates, offset, end, stride,\n    /**\n     * @param {module:ol/coordinate~Coordinate} point1 Start point.\n     * @param {module:ol/coordinate~Coordinate} point2 End point.\n     * @return {boolean} `true` if the segment and the extent intersect,\n     *     `false` otherwise.\n     */\n    function(point1, point2) {\n      return intersectsSegment(extent, point1, point2);\n    });\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} True if the geometry and the extent intersect.\n */\nexport function intersectsLineStringArray(flatCoordinates, offset, ends, stride, extent) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    if (intersectsLineString(\n      flatCoordinates, offset, ends[i], stride, extent)) {\n      return true;\n    }\n    offset = ends[i];\n  }\n  return false;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} True if the geometry and the extent intersect.\n */\nexport function intersectsLinearRing(flatCoordinates, offset, end, stride, extent) {\n  if (intersectsLineString(\n    flatCoordinates, offset, end, stride, extent)) {\n    return true;\n  }\n  if (linearRingContainsXY(flatCoordinates, offset, end, stride, extent[0], extent[1])) {\n    return true;\n  }\n  if (linearRingContainsXY(flatCoordinates, offset, end, stride, extent[0], extent[3])) {\n    return true;\n  }\n  if (linearRingContainsXY(flatCoordinates, offset, end, stride, extent[2], extent[1])) {\n    return true;\n  }\n  if (linearRingContainsXY(flatCoordinates, offset, end, stride, extent[2], extent[3])) {\n    return true;\n  }\n  return false;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} True if the geometry and the extent intersect.\n */\nexport function intersectsLinearRingArray(flatCoordinates, offset, ends, stride, extent) {\n  if (!intersectsLinearRing(\n    flatCoordinates, offset, ends[0], stride, extent)) {\n    return false;\n  }\n  if (ends.length === 1) {\n    return true;\n  }\n  for (let i = 1, ii = ends.length; i < ii; ++i) {\n    if (linearRingContainsExtent(flatCoordinates, ends[i - 1], ends[i], stride, extent)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {boolean} True if the geometry and the extent intersect.\n */\nexport function intersectsLinearRingMultiArray(flatCoordinates, offset, endss, stride, extent) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    if (intersectsLinearRingArray(\n      flatCoordinates, offset, ends, stride, extent)) {\n      return true;\n    }\n    offset = ends[ends.length - 1];\n  }\n  return false;\n}\n","/**\n * @module ol/geom/flat/reverse\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\nexport function coordinates(flatCoordinates, offset, end, stride) {\n  while (offset < end - stride) {\n    for (let i = 0; i < stride; ++i) {\n      const tmp = flatCoordinates[offset + i];\n      flatCoordinates[offset + i] = flatCoordinates[end - stride + i];\n      flatCoordinates[end - stride + i] = tmp;\n    }\n    offset += stride;\n    end -= stride;\n  }\n}\n","/**\n * @module ol/geom/flat/orient\n */\nimport {coordinates as reverseCoordinates} from '../flat/reverse.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {boolean} Is clockwise.\n */\nexport function linearRingIsClockwise(flatCoordinates, offset, end, stride) {\n  // http://tinyurl.com/clockwise-method\n  // https://github.com/OSGeo/gdal/blob/trunk/gdal/ogr/ogrlinearring.cpp\n  let edge = 0;\n  let x1 = flatCoordinates[end - stride];\n  let y1 = flatCoordinates[end - stride + 1];\n  for (; offset < end; offset += stride) {\n    const x2 = flatCoordinates[offset];\n    const y2 = flatCoordinates[offset + 1];\n    edge += (x2 - x1) * (y2 + y1);\n    x1 = x2;\n    y1 = y2;\n  }\n  return edge > 0;\n}\n\n\n/**\n * Determines if linear rings are oriented.  By default, left-hand orientation\n * is tested (first ring must be clockwise, remaining rings counter-clockwise).\n * To test for right-hand orientation, use the `opt_right` argument.\n *\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Array of end indexes.\n * @param {number} stride Stride.\n * @param {boolean=} opt_right Test for right-hand orientation\n *     (counter-clockwise exterior ring and clockwise interior rings).\n * @return {boolean} Rings are correctly oriented.\n */\nexport function linearRingIsOriented(flatCoordinates, offset, ends, stride, opt_right) {\n  const right = opt_right !== undefined ? opt_right : false;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const isClockwise = linearRingIsClockwise(\n      flatCoordinates, offset, end, stride);\n    if (i === 0) {\n      if ((right && isClockwise) || (!right && !isClockwise)) {\n        return false;\n      }\n    } else {\n      if ((right && !isClockwise) || (!right && isClockwise)) {\n        return false;\n      }\n    }\n    offset = end;\n  }\n  return true;\n}\n\n\n/**\n * Determines if linear rings are oriented.  By default, left-hand orientation\n * is tested (first ring must be clockwise, remaining rings counter-clockwise).\n * To test for right-hand orientation, use the `opt_right` argument.\n *\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Array of array of end indexes.\n * @param {number} stride Stride.\n * @param {boolean=} opt_right Test for right-hand orientation\n *     (counter-clockwise exterior ring and clockwise interior rings).\n * @return {boolean} Rings are correctly oriented.\n */\nexport function linearRingsAreOriented(flatCoordinates, offset, endss, stride, opt_right) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    if (!linearRingIsOriented(\n      flatCoordinates, offset, endss[i], stride, opt_right)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n\n/**\n * Orient coordinates in a flat array of linear rings.  By default, rings\n * are oriented following the left-hand rule (clockwise for exterior and\n * counter-clockwise for interior rings).  To orient according to the\n * right-hand rule, use the `opt_right` argument.\n *\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {boolean=} opt_right Follow the right-hand rule for orientation.\n * @return {number} End.\n */\nexport function orientLinearRings(flatCoordinates, offset, ends, stride, opt_right) {\n  const right = opt_right !== undefined ? opt_right : false;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const isClockwise = linearRingIsClockwise(\n      flatCoordinates, offset, end, stride);\n    const reverse = i === 0 ?\n      (right && isClockwise) || (!right && !isClockwise) :\n      (right && !isClockwise) || (!right && isClockwise);\n    if (reverse) {\n      reverseCoordinates(flatCoordinates, offset, end, stride);\n    }\n    offset = end;\n  }\n  return offset;\n}\n\n\n/**\n * Orient coordinates in a flat array of linear rings.  By default, rings\n * are oriented following the left-hand rule (clockwise for exterior and\n * counter-clockwise for interior rings).  To orient according to the\n * right-hand rule, use the `opt_right` argument.\n *\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Array of array of end indexes.\n * @param {number} stride Stride.\n * @param {boolean=} opt_right Follow the right-hand rule for orientation.\n * @return {number} End.\n */\nexport function orientLinearRingsArray(flatCoordinates, offset, endss, stride, opt_right) {\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    offset = orientLinearRings(\n      flatCoordinates, offset, endss[i], stride, opt_right);\n  }\n  return offset;\n}\n","/**\n * @module ol/geom/Polygon\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {closestSquaredDistanceXY, getCenter} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LinearRing from '../geom/LinearRing.js';\nimport Point from '../geom/Point.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {offset as sphereOffset} from '../sphere.js';\nimport {linearRings as linearRingsArea} from '../geom/flat/area.js';\nimport {assignClosestArrayPoint, arrayMaxSquaredDelta} from '../geom/flat/closest.js';\nimport {linearRingsContainsXY} from '../geom/flat/contains.js';\nimport {deflateCoordinatesArray} from '../geom/flat/deflate.js';\nimport {inflateCoordinatesArray} from '../geom/flat/inflate.js';\nimport {getInteriorPointOfArray} from '../geom/flat/interiorpoint.js';\nimport {intersectsLinearRingArray} from '../geom/flat/intersectsextent.js';\nimport {linearRingIsOriented, orientLinearRings} from '../geom/flat/orient.js';\nimport {quantizeArray} from '../geom/flat/simplify.js';\nimport {modulo} from '../math.js';\n\n/**\n * @classdesc\n * Polygon geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} coordinates Array of linear\n *     rings that define the polygon. The first linear ring of the array\n *     defines the outer-boundary or surface of the polygon. Each subsequent\n *     linear ring defines a hole in the surface of the polygon. A linear ring\n *     is an array of vertices' coordinates where the first coordinate and the\n *     last are equivalent.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst Polygon = function(coordinates, opt_layout) {\n\n  SimpleGeometry.call(this);\n\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n  this.ends_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.flatInteriorPointRevision_ = -1;\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.flatInteriorPoint_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDelta_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDeltaRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.orientedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.orientedFlatCoordinates_ = null;\n\n  this.setCoordinates(coordinates, opt_layout);\n\n};\n\ninherits(Polygon, SimpleGeometry);\n\n\n/**\n * Append the passed linear ring to this polygon.\n * @param {module:ol/geom/LinearRing} linearRing Linear ring.\n * @api\n */\nPolygon.prototype.appendLinearRing = function(linearRing) {\n  if (!this.flatCoordinates) {\n    this.flatCoordinates = linearRing.getFlatCoordinates().slice();\n  } else {\n    extend(this.flatCoordinates, linearRing.getFlatCoordinates());\n  }\n  this.ends_.push(this.flatCoordinates.length);\n  this.changed();\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/Polygon} Clone.\n * @override\n * @api\n */\nPolygon.prototype.clone = function() {\n  const polygon = new Polygon(null);\n  polygon.setFlatCoordinates(\n    this.layout, this.flatCoordinates.slice(), this.ends_.slice());\n  return polygon;\n};\n\n\n/**\n * @inheritDoc\n */\nPolygon.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  if (this.maxDeltaRevision_ != this.getRevision()) {\n    this.maxDelta_ = Math.sqrt(arrayMaxSquaredDelta(\n      this.flatCoordinates, 0, this.ends_, this.stride, 0));\n    this.maxDeltaRevision_ = this.getRevision();\n  }\n  return assignClosestArrayPoint(\n    this.flatCoordinates, 0, this.ends_, this.stride,\n    this.maxDelta_, true, x, y, closestPoint, minSquaredDistance);\n};\n\n\n/**\n * @inheritDoc\n */\nPolygon.prototype.containsXY = function(x, y) {\n  return linearRingsContainsXY(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride, x, y);\n};\n\n\n/**\n * Return the area of the polygon on projected plane.\n * @return {number} Area (on projected plane).\n * @api\n */\nPolygon.prototype.getArea = function() {\n  return linearRingsArea(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride);\n};\n\n\n/**\n * Get the coordinate array for this geometry.  This array has the structure\n * of a GeoJSON coordinate array for polygons.\n *\n * @param {boolean=} opt_right Orient coordinates according to the right-hand\n *     rule (counter-clockwise for exterior and clockwise for interior rings).\n *     If `false`, coordinates will be oriented according to the left-hand rule\n *     (clockwise for exterior and counter-clockwise for interior rings).\n *     By default, coordinate orientation will depend on how the geometry was\n *     constructed.\n * @return {Array.<Array.<module:ol/coordinate~Coordinate>>} Coordinates.\n * @override\n * @api\n */\nPolygon.prototype.getCoordinates = function(opt_right) {\n  let flatCoordinates;\n  if (opt_right !== undefined) {\n    flatCoordinates = this.getOrientedFlatCoordinates().slice();\n    orientLinearRings(\n      flatCoordinates, 0, this.ends_, this.stride, opt_right);\n  } else {\n    flatCoordinates = this.flatCoordinates;\n  }\n\n  return inflateCoordinatesArray(\n    flatCoordinates, 0, this.ends_, this.stride);\n};\n\n\n/**\n * @return {Array.<number>} Ends.\n */\nPolygon.prototype.getEnds = function() {\n  return this.ends_;\n};\n\n\n/**\n * @return {Array.<number>} Interior point.\n */\nPolygon.prototype.getFlatInteriorPoint = function() {\n  if (this.flatInteriorPointRevision_ != this.getRevision()) {\n    const flatCenter = getCenter(this.getExtent());\n    this.flatInteriorPoint_ = getInteriorPointOfArray(\n      this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride,\n      flatCenter, 0);\n    this.flatInteriorPointRevision_ = this.getRevision();\n  }\n  return this.flatInteriorPoint_;\n};\n\n\n/**\n * Return an interior point of the polygon.\n * @return {module:ol/geom/Point} Interior point as XYM coordinate, where M is the\n * length of the horizontal intersection that the point belongs to.\n * @api\n */\nPolygon.prototype.getInteriorPoint = function() {\n  return new Point(this.getFlatInteriorPoint(), GeometryLayout.XYM);\n};\n\n\n/**\n * Return the number of rings of the polygon,  this includes the exterior\n * ring and any interior rings.\n *\n * @return {number} Number of rings.\n * @api\n */\nPolygon.prototype.getLinearRingCount = function() {\n  return this.ends_.length;\n};\n\n\n/**\n * Return the Nth linear ring of the polygon geometry. Return `null` if the\n * given index is out of range.\n * The exterior linear ring is available at index `0` and the interior rings\n * at index `1` and beyond.\n *\n * @param {number} index Index.\n * @return {module:ol/geom/LinearRing} Linear ring.\n * @api\n */\nPolygon.prototype.getLinearRing = function(index) {\n  if (index < 0 || this.ends_.length <= index) {\n    return null;\n  }\n  const linearRing = new LinearRing(null);\n  linearRing.setFlatCoordinates(this.layout, this.flatCoordinates.slice(\n    index === 0 ? 0 : this.ends_[index - 1], this.ends_[index]));\n  return linearRing;\n};\n\n\n/**\n * Return the linear rings of the polygon.\n * @return {Array.<module:ol/geom/LinearRing>} Linear rings.\n * @api\n */\nPolygon.prototype.getLinearRings = function() {\n  const layout = this.layout;\n  const flatCoordinates = this.flatCoordinates;\n  const ends = this.ends_;\n  const linearRings = [];\n  let offset = 0;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const linearRing = new LinearRing(null);\n    linearRing.setFlatCoordinates(layout, flatCoordinates.slice(offset, end));\n    linearRings.push(linearRing);\n    offset = end;\n  }\n  return linearRings;\n};\n\n\n/**\n * @return {Array.<number>} Oriented flat coordinates.\n */\nPolygon.prototype.getOrientedFlatCoordinates = function() {\n  if (this.orientedRevision_ != this.getRevision()) {\n    const flatCoordinates = this.flatCoordinates;\n    if (linearRingIsOriented(\n      flatCoordinates, 0, this.ends_, this.stride)) {\n      this.orientedFlatCoordinates_ = flatCoordinates;\n    } else {\n      this.orientedFlatCoordinates_ = flatCoordinates.slice();\n      this.orientedFlatCoordinates_.length =\n          orientLinearRings(\n            this.orientedFlatCoordinates_, 0, this.ends_, this.stride);\n    }\n    this.orientedRevision_ = this.getRevision();\n  }\n  return this.orientedFlatCoordinates_;\n};\n\n\n/**\n * @inheritDoc\n */\nPolygon.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  const simplifiedFlatCoordinates = [];\n  const simplifiedEnds = [];\n  simplifiedFlatCoordinates.length = quantizeArray(\n    this.flatCoordinates, 0, this.ends_, this.stride,\n    Math.sqrt(squaredTolerance),\n    simplifiedFlatCoordinates, 0, simplifiedEnds);\n  const simplifiedPolygon = new Polygon(null);\n  simplifiedPolygon.setFlatCoordinates(\n    GeometryLayout.XY, simplifiedFlatCoordinates, simplifiedEnds);\n  return simplifiedPolygon;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nPolygon.prototype.getType = function() {\n  return GeometryType.POLYGON;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nPolygon.prototype.intersectsExtent = function(extent) {\n  return intersectsLinearRingArray(\n    this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride, extent);\n};\n\n\n/**\n * Set the coordinates of the polygon.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nPolygon.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null, this.ends_);\n  } else {\n    this.setLayout(opt_layout, coordinates, 2);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    const ends = deflateCoordinatesArray(\n      this.flatCoordinates, 0, coordinates, this.stride, this.ends_);\n    this.flatCoordinates.length = ends.length === 0 ? 0 : ends[ends.length - 1];\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<number>} ends Ends.\n */\nPolygon.prototype.setFlatCoordinates = function(layout, flatCoordinates, ends) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.ends_ = ends;\n  this.changed();\n};\n\nexport default Polygon;\n\n\n/**\n * Create an approximation of a circle on the surface of a sphere.\n * @param {module:ol/coordinate~Coordinate} center Center (`[lon, lat]` in degrees).\n * @param {number} radius The great-circle distance from the center to\n *     the polygon vertices.\n * @param {number=} opt_n Optional number of vertices for the resulting\n *     polygon. Default is `32`.\n * @param {number=} opt_sphereRadius Optional radius for the sphere (defaults to\n *     the Earth's mean radius using the WGS84 ellipsoid).\n * @return {module:ol/geom/Polygon} The \"circular\" polygon.\n * @api\n */\nexport function circular(center, radius, opt_n, opt_sphereRadius) {\n  const n = opt_n ? opt_n : 32;\n  /** @type {Array.<number>} */\n  const flatCoordinates = [];\n  for (let i = 0; i < n; ++i) {\n    extend(flatCoordinates, sphereOffset(center, radius, 2 * Math.PI * i / n, opt_sphereRadius));\n  }\n  flatCoordinates.push(flatCoordinates[0], flatCoordinates[1]);\n  const polygon = new Polygon(null);\n  polygon.setFlatCoordinates(GeometryLayout.XY, flatCoordinates, [flatCoordinates.length]);\n  return polygon;\n}\n\n\n/**\n * Create a polygon from an extent. The layout used is `XY`.\n * @param {module:ol/extent~Extent} extent The extent.\n * @return {module:ol/geom/Polygon} The polygon.\n * @api\n */\nexport function fromExtent(extent) {\n  const minX = extent[0];\n  const minY = extent[1];\n  const maxX = extent[2];\n  const maxY = extent[3];\n  const flatCoordinates =\n      [minX, minY, minX, maxY, maxX, maxY, maxX, minY, minX, minY];\n  const polygon = new Polygon(null);\n  polygon.setFlatCoordinates(\n    GeometryLayout.XY, flatCoordinates, [flatCoordinates.length]);\n  return polygon;\n}\n\n\n/**\n * Create a regular polygon from a circle.\n * @param {module:ol/geom/Circle} circle Circle geometry.\n * @param {number=} opt_sides Number of sides of the polygon. Default is 32.\n * @param {number=} opt_angle Start angle for the first vertex of the polygon in\n *     radians. Default is 0.\n * @return {module:ol/geom/Polygon} Polygon geometry.\n * @api\n */\nexport function fromCircle(circle, opt_sides, opt_angle) {\n  const sides = opt_sides ? opt_sides : 32;\n  const stride = circle.getStride();\n  const layout = circle.getLayout();\n  const polygon = new Polygon(null, layout);\n  const arrayLength = stride * (sides + 1);\n  const flatCoordinates = new Array(arrayLength);\n  for (let i = 0; i < arrayLength; i++) {\n    flatCoordinates[i] = 0;\n  }\n  const ends = [flatCoordinates.length];\n  polygon.setFlatCoordinates(layout, flatCoordinates, ends);\n  makeRegular(polygon, circle.getCenter(), circle.getRadius(), opt_angle);\n  return polygon;\n}\n\n\n/**\n * Modify the coordinates of a polygon to make it a regular polygon.\n * @param {module:ol/geom/Polygon} polygon Polygon geometry.\n * @param {module:ol/coordinate~Coordinate} center Center of the regular polygon.\n * @param {number} radius Radius of the regular polygon.\n * @param {number=} opt_angle Start angle for the first vertex of the polygon in\n *     radians. Default is 0.\n */\nexport function makeRegular(polygon, center, radius, opt_angle) {\n  const flatCoordinates = polygon.getFlatCoordinates();\n  const layout = polygon.getLayout();\n  const stride = polygon.getStride();\n  const ends = polygon.getEnds();\n  const sides = flatCoordinates.length / stride - 1;\n  const startAngle = opt_angle ? opt_angle : 0;\n  for (let i = 0; i <= sides; ++i) {\n    const offset = i * stride;\n    const angle = startAngle + (modulo(i, sides) * 2 * Math.PI / sides);\n    flatCoordinates[offset] = center[0] + (radius * Math.cos(angle));\n    flatCoordinates[offset + 1] = center[1] + (radius * Math.sin(angle));\n  }\n  polygon.setFlatCoordinates(layout, flatCoordinates, ends);\n}\n","/**\n * @module ol/Geolocation\n */\nimport {inherits} from './util.js';\nimport GeolocationProperty from './GeolocationProperty.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport {listen} from './events.js';\nimport EventType from './events/EventType.js';\nimport {circular as circularPolygon} from './geom/Polygon.js';\nimport {GEOLOCATION} from './has.js';\nimport {toRadians} from './math.js';\nimport {get as getProjection, getTransformFromProjections, identityTransform} from './proj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [tracking=false] Start Tracking right after\n * instantiation.\n * @property {GeolocationPositionOptions} [trackingOptions] Tracking options.\n * See {@link http://www.w3.org/TR/geolocation-API/#position_options_interface}.\n * @property {module:ol/proj~ProjectionLike} [projection] The projection the position\n * is reported in.\n */\n\n\n/**\n * @classdesc\n * Helper class for providing HTML5 Geolocation capabilities.\n * The [Geolocation API](http://www.w3.org/TR/geolocation-API/)\n * is used to locate a user's position.\n *\n * To get notified of position changes, register a listener for the generic\n * `change` event on your instance of {@link module:ol/Geolocation~Geolocation}.\n *\n * Example:\n *\n *     var geolocation = new Geolocation({\n *       // take the projection to use from the map's view\n *       projection: view.getProjection()\n *     });\n *     // listen to changes in position\n *     geolocation.on('change', function(evt) {\n *       window.console.log(geolocation.getPosition());\n *     });\n *\n * @fires error\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/Geolocation~Options=} opt_options Options.\n * @api\n */\nconst Geolocation = function(opt_options) {\n\n  BaseObject.call(this);\n\n  const options = opt_options || {};\n\n  /**\n   * The unprojected (EPSG:4326) device position.\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.position_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/proj~TransformFunction}\n   */\n  this.transform_ = identityTransform;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.watchId_ = undefined;\n\n  listen(\n    this, getChangeEventType(GeolocationProperty.PROJECTION),\n    this.handleProjectionChanged_, this);\n  listen(\n    this, getChangeEventType(GeolocationProperty.TRACKING),\n    this.handleTrackingChanged_, this);\n\n  if (options.projection !== undefined) {\n    this.setProjection(options.projection);\n  }\n  if (options.trackingOptions !== undefined) {\n    this.setTrackingOptions(options.trackingOptions);\n  }\n\n  this.setTracking(options.tracking !== undefined ? options.tracking : false);\n\n};\n\ninherits(Geolocation, BaseObject);\n\n\n/**\n * @inheritDoc\n */\nGeolocation.prototype.disposeInternal = function() {\n  this.setTracking(false);\n  BaseObject.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @private\n */\nGeolocation.prototype.handleProjectionChanged_ = function() {\n  const projection = this.getProjection();\n  if (projection) {\n    this.transform_ = getTransformFromProjections(\n      getProjection('EPSG:4326'), projection);\n    if (this.position_) {\n      this.set(GeolocationProperty.POSITION, this.transform_(this.position_));\n    }\n  }\n};\n\n\n/**\n * @private\n */\nGeolocation.prototype.handleTrackingChanged_ = function() {\n  if (GEOLOCATION) {\n    const tracking = this.getTracking();\n    if (tracking && this.watchId_ === undefined) {\n      this.watchId_ = navigator.geolocation.watchPosition(\n        this.positionChange_.bind(this),\n        this.positionError_.bind(this),\n        this.getTrackingOptions());\n    } else if (!tracking && this.watchId_ !== undefined) {\n      navigator.geolocation.clearWatch(this.watchId_);\n      this.watchId_ = undefined;\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {GeolocationPosition} position position event.\n */\nGeolocation.prototype.positionChange_ = function(position) {\n  const coords = position.coords;\n  this.set(GeolocationProperty.ACCURACY, coords.accuracy);\n  this.set(GeolocationProperty.ALTITUDE,\n    coords.altitude === null ? undefined : coords.altitude);\n  this.set(GeolocationProperty.ALTITUDE_ACCURACY,\n    coords.altitudeAccuracy === null ?\n      undefined : coords.altitudeAccuracy);\n  this.set(GeolocationProperty.HEADING, coords.heading === null ?\n    undefined : toRadians(coords.heading));\n  if (!this.position_) {\n    this.position_ = [coords.longitude, coords.latitude];\n  } else {\n    this.position_[0] = coords.longitude;\n    this.position_[1] = coords.latitude;\n  }\n  const projectedPosition = this.transform_(this.position_);\n  this.set(GeolocationProperty.POSITION, projectedPosition);\n  this.set(GeolocationProperty.SPEED,\n    coords.speed === null ? undefined : coords.speed);\n  const geometry = circularPolygon(this.position_, coords.accuracy);\n  geometry.applyTransform(this.transform_);\n  this.set(GeolocationProperty.ACCURACY_GEOMETRY, geometry);\n  this.changed();\n};\n\n/**\n * Triggered when the Geolocation returns an error.\n * @event error\n * @api\n */\n\n/**\n * @private\n * @param {GeolocationPositionError} error error object.\n */\nGeolocation.prototype.positionError_ = function(error) {\n  error.type = EventType.ERROR;\n  this.setTracking(false);\n  this.dispatchEvent(/** @type {{type: string, target: undefined}} */ (error));\n};\n\n\n/**\n * Get the accuracy of the position in meters.\n * @return {number|undefined} The accuracy of the position measurement in\n *     meters.\n * @observable\n * @api\n */\nGeolocation.prototype.getAccuracy = function() {\n  return /** @type {number|undefined} */ (this.get(GeolocationProperty.ACCURACY));\n};\n\n\n/**\n * Get a geometry of the position accuracy.\n * @return {?module:ol/geom/Polygon} A geometry of the position accuracy.\n * @observable\n * @api\n */\nGeolocation.prototype.getAccuracyGeometry = function() {\n  return (\n    /** @type {?module:ol/geom/Polygon} */ (this.get(GeolocationProperty.ACCURACY_GEOMETRY) || null)\n  );\n};\n\n\n/**\n * Get the altitude associated with the position.\n * @return {number|undefined} The altitude of the position in meters above mean\n *     sea level.\n * @observable\n * @api\n */\nGeolocation.prototype.getAltitude = function() {\n  return /** @type {number|undefined} */ (this.get(GeolocationProperty.ALTITUDE));\n};\n\n\n/**\n * Get the altitude accuracy of the position.\n * @return {number|undefined} The accuracy of the altitude measurement in\n *     meters.\n * @observable\n * @api\n */\nGeolocation.prototype.getAltitudeAccuracy = function() {\n  return /** @type {number|undefined} */ (this.get(GeolocationProperty.ALTITUDE_ACCURACY));\n};\n\n\n/**\n * Get the heading as radians clockwise from North.\n * Note: depending on the browser, the heading is only defined if the `enableHighAccuracy`\n * is set to `true` in the tracking options.\n * @return {number|undefined} The heading of the device in radians from north.\n * @observable\n * @api\n */\nGeolocation.prototype.getHeading = function() {\n  return /** @type {number|undefined} */ (this.get(GeolocationProperty.HEADING));\n};\n\n\n/**\n * Get the position of the device.\n * @return {module:ol/coordinate~Coordinate|undefined} The current position of the device reported\n *     in the current projection.\n * @observable\n * @api\n */\nGeolocation.prototype.getPosition = function() {\n  return (\n    /** @type {module:ol/coordinate~Coordinate|undefined} */ (this.get(GeolocationProperty.POSITION))\n  );\n};\n\n\n/**\n * Get the projection associated with the position.\n * @return {module:ol/proj/Projection|undefined} The projection the position is\n *     reported in.\n * @observable\n * @api\n */\nGeolocation.prototype.getProjection = function() {\n  return (\n    /** @type {module:ol/proj/Projection|undefined} */ (this.get(GeolocationProperty.PROJECTION))\n  );\n};\n\n\n/**\n * Get the speed in meters per second.\n * @return {number|undefined} The instantaneous speed of the device in meters\n *     per second.\n * @observable\n * @api\n */\nGeolocation.prototype.getSpeed = function() {\n  return /** @type {number|undefined} */ (this.get(GeolocationProperty.SPEED));\n};\n\n\n/**\n * Determine if the device location is being tracked.\n * @return {boolean} The device location is being tracked.\n * @observable\n * @api\n */\nGeolocation.prototype.getTracking = function() {\n  return /** @type {boolean} */ (this.get(GeolocationProperty.TRACKING));\n};\n\n\n/**\n * Get the tracking options.\n * @see http://www.w3.org/TR/geolocation-API/#position-options\n * @return {GeolocationPositionOptions|undefined} PositionOptions as defined by\n *     the [HTML5 Geolocation spec\n *     ](http://www.w3.org/TR/geolocation-API/#position_options_interface).\n * @observable\n * @api\n */\nGeolocation.prototype.getTrackingOptions = function() {\n  return /** @type {GeolocationPositionOptions|undefined} */ (this.get(GeolocationProperty.TRACKING_OPTIONS));\n};\n\n\n/**\n * Set the projection to use for transforming the coordinates.\n * @param {module:ol/proj~ProjectionLike} projection The projection the position is\n *     reported in.\n * @observable\n * @api\n */\nGeolocation.prototype.setProjection = function(projection) {\n  this.set(GeolocationProperty.PROJECTION, getProjection(projection));\n};\n\n\n/**\n * Enable or disable tracking.\n * @param {boolean} tracking Enable tracking.\n * @observable\n * @api\n */\nGeolocation.prototype.setTracking = function(tracking) {\n  this.set(GeolocationProperty.TRACKING, tracking);\n};\n\n\n/**\n * Set the tracking options.\n * @see http://www.w3.org/TR/geolocation-API/#position-options\n * @param {GeolocationPositionOptions} options PositionOptions as defined by the\n *     [HTML5 Geolocation spec\n *     ](http://www.w3.org/TR/geolocation-API/#position_options_interface).\n * @observable\n * @api\n */\nGeolocation.prototype.setTrackingOptions = function(options) {\n  this.set(GeolocationProperty.TRACKING_OPTIONS, options);\n};\nexport default Geolocation;\n","/**\n * @module ol/string\n */\n\n/**\n * @param {number} number Number to be formatted\n * @param {number} width The desired width\n * @param {number=} opt_precision Precision of the output string (i.e. number of decimal places)\n * @returns {string} Formatted string\n */\nexport function padNumber(number, width, opt_precision) {\n  const numberString = opt_precision !== undefined ? number.toFixed(opt_precision) : '' + number;\n  let decimal = numberString.indexOf('.');\n  decimal = decimal === -1 ? numberString.length : decimal;\n  return decimal > width ? numberString : new Array(1 + width - decimal).join('0') + numberString;\n}\n\n\n/**\n * Adapted from https://github.com/omichelsen/compare-versions/blob/master/index.js\n * @param {string|number} v1 First version\n * @param {string|number} v2 Second version\n * @returns {number} Value\n */\nexport function compareVersions(v1, v2) {\n  const s1 = ('' + v1).split('.');\n  const s2 = ('' + v2).split('.');\n\n  for (let i = 0; i < Math.max(s1.length, s2.length); i++) {\n    const n1 = parseInt(s1[i] || '0', 10);\n    const n2 = parseInt(s2[i] || '0', 10);\n\n    if (n1 > n2) {\n      return 1;\n    }\n    if (n2 > n1) {\n      return -1;\n    }\n  }\n\n  return 0;\n}\n","/**\n * @module ol/coordinate\n */\nimport {modulo} from './math.js';\nimport {padNumber} from './string.js';\n\n\n/**\n * An array of numbers representing an xy coordinate. Example: `[16, 48]`.\n * @typedef {Array.<number>} Coordinate\n * @api\n */\n\n\n/**\n * A function that takes a {@link module:ol/coordinate~Coordinate} and\n * transforms it into a `{string}`.\n *\n * @typedef {function((module:ol/coordinate~Coordinate|undefined)): string} CoordinateFormat\n * @api\n */\n\n\n/**\n * Add `delta` to `coordinate`. `coordinate` is modified in place and returned\n * by the function.\n *\n * Example:\n *\n *     import {add} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     add(coord, [-2, 4]);\n *     // coord is now [5.85, 51.983333]\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/coordinate~Coordinate} delta Delta.\n * @return {module:ol/coordinate~Coordinate} The input coordinate adjusted by\n * the given delta.\n * @api\n */\nexport function add(coordinate, delta) {\n  coordinate[0] += delta[0];\n  coordinate[1] += delta[1];\n  return coordinate;\n}\n\n\n/**\n * Calculates the point closest to the passed coordinate on the passed circle.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate The coordinate.\n * @param {module:ol/geom/Circle} circle The circle.\n * @return {module:ol/coordinate~Coordinate} Closest point on the circumference.\n */\nexport function closestOnCircle(coordinate, circle) {\n  const r = circle.getRadius();\n  const center = circle.getCenter();\n  const x0 = center[0];\n  const y0 = center[1];\n  const x1 = coordinate[0];\n  const y1 = coordinate[1];\n\n  let dx = x1 - x0;\n  const dy = y1 - y0;\n  if (dx === 0 && dy === 0) {\n    dx = 1;\n  }\n  const d = Math.sqrt(dx * dx + dy * dy);\n\n  const x = x0 + r * dx / d;\n  const y = y0 + r * dy / d;\n\n  return [x, y];\n}\n\n\n/**\n * Calculates the point closest to the passed coordinate on the passed segment.\n * This is the foot of the perpendicular of the coordinate to the segment when\n * the foot is on the segment, or the closest segment coordinate when the foot\n * is outside the segment.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate The coordinate.\n * @param {Array.<module:ol/coordinate~Coordinate>} segment The two coordinates\n * of the segment.\n * @return {module:ol/coordinate~Coordinate} The foot of the perpendicular of\n * the coordinate to the segment.\n */\nexport function closestOnSegment(coordinate, segment) {\n  const x0 = coordinate[0];\n  const y0 = coordinate[1];\n  const start = segment[0];\n  const end = segment[1];\n  const x1 = start[0];\n  const y1 = start[1];\n  const x2 = end[0];\n  const y2 = end[1];\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const along = (dx === 0 && dy === 0) ? 0 :\n    ((dx * (x0 - x1)) + (dy * (y0 - y1))) / ((dx * dx + dy * dy) || 0);\n  let x, y;\n  if (along <= 0) {\n    x = x1;\n    y = y1;\n  } else if (along >= 1) {\n    x = x2;\n    y = y2;\n  } else {\n    x = x1 + along * dx;\n    y = y1 + along * dy;\n  }\n  return [x, y];\n}\n\n\n/**\n * Returns a {@link module:ol/coordinate~CoordinateFormat} function that can be\n * used to format\n * a {module:ol/coordinate~Coordinate} to a string.\n *\n * Example without specifying the fractional digits:\n *\n *     import {createStringXY} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var stringifyFunc = createStringXY();\n *     var out = stringifyFunc(coord);\n *     // out is now '8, 48'\n *\n * Example with explicitly specifying 2 fractional digits:\n *\n *     import {createStringXY} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var stringifyFunc = createStringXY(2);\n *     var out = stringifyFunc(coord);\n *     // out is now '7.85, 47.98'\n *\n * @param {number=} opt_fractionDigits The number of digits to include\n *    after the decimal point. Default is `0`.\n * @return {module:ol/coordinate~CoordinateFormat} Coordinate format.\n * @api\n */\nexport function createStringXY(opt_fractionDigits) {\n  return (\n    /**\n     * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n     * @return {string} String XY.\n     */\n    function(coordinate) {\n      return toStringXY(coordinate, opt_fractionDigits);\n    }\n  );\n}\n\n\n/**\n * @param {string} hemispheres Hemispheres.\n * @param {number} degrees Degrees.\n * @param {number=} opt_fractionDigits The number of digits to include\n *    after the decimal point. Default is `0`.\n * @return {string} String.\n */\nexport function degreesToStringHDMS(hemispheres, degrees, opt_fractionDigits) {\n  const normalizedDegrees = modulo(degrees + 180, 360) - 180;\n  const x = Math.abs(3600 * normalizedDegrees);\n  const dflPrecision = opt_fractionDigits || 0;\n  const precision = Math.pow(10, dflPrecision);\n\n  let deg = Math.floor(x / 3600);\n  let min = Math.floor((x - deg * 3600) / 60);\n  let sec = x - (deg * 3600) - (min * 60);\n  sec = Math.ceil(sec * precision) / precision;\n\n  if (sec >= 60) {\n    sec = 0;\n    min += 1;\n  }\n\n  if (min >= 60) {\n    min = 0;\n    deg += 1;\n  }\n\n  return deg + '\\u00b0 ' + padNumber(min, 2) + '\\u2032 ' +\n    padNumber(sec, 2, dflPrecision) + '\\u2033' +\n    (normalizedDegrees == 0 ? '' : ' ' + hemispheres.charAt(normalizedDegrees < 0 ? 1 : 0));\n}\n\n\n/**\n * Transforms the given {@link module:ol/coordinate~Coordinate} to a string\n * using the given string template. The strings `{x}` and `{y}` in the template\n * will be replaced with the first and second coordinate values respectively.\n *\n * Example without specifying the fractional digits:\n *\n *     import {format} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var template = 'Coordinate is ({x}|{y}).';\n *     var out = format(coord, template);\n *     // out is now 'Coordinate is (8|48).'\n *\n * Example explicitly specifying the fractional digits:\n *\n *     import {format} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var template = 'Coordinate is ({x}|{y}).';\n *     var out = format(coord, template, 2);\n *     // out is now 'Coordinate is (7.85|47.98).'\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {string} template A template string with `{x}` and `{y}` placeholders\n *     that will be replaced by first and second coordinate values.\n * @param {number=} opt_fractionDigits The number of digits to include\n *    after the decimal point. Default is `0`.\n * @return {string} Formatted coordinate.\n * @api\n */\nexport function format(coordinate, template, opt_fractionDigits) {\n  if (coordinate) {\n    return template\n      .replace('{x}', coordinate[0].toFixed(opt_fractionDigits))\n      .replace('{y}', coordinate[1].toFixed(opt_fractionDigits));\n  } else {\n    return '';\n  }\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate1 First coordinate.\n * @param {module:ol/coordinate~Coordinate} coordinate2 Second coordinate.\n * @return {boolean} The two coordinates are equal.\n */\nexport function equals(coordinate1, coordinate2) {\n  let equals = true;\n  for (let i = coordinate1.length - 1; i >= 0; --i) {\n    if (coordinate1[i] != coordinate2[i]) {\n      equals = false;\n      break;\n    }\n  }\n  return equals;\n}\n\n\n/**\n * Rotate `coordinate` by `angle`. `coordinate` is modified in place and\n * returned by the function.\n *\n * Example:\n *\n *     import {rotate} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var rotateRadians = Math.PI / 2; // 90 degrees\n *     rotate(coord, rotateRadians);\n *     // coord is now [-47.983333, 7.85]\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} angle Angle in radian.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n * @api\n */\nexport function rotate(coordinate, angle) {\n  const cosAngle = Math.cos(angle);\n  const sinAngle = Math.sin(angle);\n  const x = coordinate[0] * cosAngle - coordinate[1] * sinAngle;\n  const y = coordinate[1] * cosAngle + coordinate[0] * sinAngle;\n  coordinate[0] = x;\n  coordinate[1] = y;\n  return coordinate;\n}\n\n\n/**\n * Scale `coordinate` by `scale`. `coordinate` is modified in place and returned\n * by the function.\n *\n * Example:\n *\n *     import {scale as scaleCoordinate} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var scale = 1.2;\n *     scaleCoordinate(coord, scale);\n *     // coord is now [9.42, 57.5799996]\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} scale Scale factor.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n */\nexport function scale(coordinate, scale) {\n  coordinate[0] *= scale;\n  coordinate[1] *= scale;\n  return coordinate;\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coord1 First coordinate.\n * @param {module:ol/coordinate~Coordinate} coord2 Second coordinate.\n * @return {number} Squared distance between coord1 and coord2.\n */\nexport function squaredDistance(coord1, coord2) {\n  const dx = coord1[0] - coord2[0];\n  const dy = coord1[1] - coord2[1];\n  return dx * dx + dy * dy;\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coord1 First coordinate.\n * @param {module:ol/coordinate~Coordinate} coord2 Second coordinate.\n * @return {number} Distance between coord1 and coord2.\n */\nexport function distance(coord1, coord2) {\n  return Math.sqrt(squaredDistance(coord1, coord2));\n}\n\n\n/**\n * Calculate the squared distance from a coordinate to a line segment.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate of the point.\n * @param {Array.<module:ol/coordinate~Coordinate>} segment Line segment (2\n * coordinates).\n * @return {number} Squared distance from the point to the line segment.\n */\nexport function squaredDistanceToSegment(coordinate, segment) {\n  return squaredDistance(coordinate,\n    closestOnSegment(coordinate, segment));\n}\n\n\n/**\n * Format a geographic coordinate with the hemisphere, degrees, minutes, and\n * seconds.\n *\n * Example without specifying fractional digits:\n *\n *     import {toStringHDMS} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var out = toStringHDMS(coord);\n *     // out is now '47 58 60 N 7 50 60 E'\n *\n * Example explicitly specifying 1 fractional digit:\n *\n *     import {toStringHDMS} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var out = toStringHDMS(coord, 1);\n *     // out is now '47 58 60.0 N 7 50 60.0 E'\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number=} opt_fractionDigits The number of digits to include\n *    after the decimal point. Default is `0`.\n * @return {string} Hemisphere, degrees, minutes and seconds.\n * @api\n */\nexport function toStringHDMS(coordinate, opt_fractionDigits) {\n  if (coordinate) {\n    return degreesToStringHDMS('NS', coordinate[1], opt_fractionDigits) + ' ' +\n        degreesToStringHDMS('EW', coordinate[0], opt_fractionDigits);\n  } else {\n    return '';\n  }\n}\n\n\n/**\n * Format a coordinate as a comma delimited string.\n *\n * Example without specifying fractional digits:\n *\n *     import {toStringXY} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var out = toStringXY(coord);\n *     // out is now '8, 48'\n *\n * Example explicitly specifying 1 fractional digit:\n *\n *     import {toStringXY} from 'ol/coordinate';\n *\n *     var coord = [7.85, 47.983333];\n *     var out = toStringXY(coord, 1);\n *     // out is now '7.8, 48.0'\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number=} opt_fractionDigits The number of digits to include\n *    after the decimal point. Default is `0`.\n * @return {string} XY.\n * @api\n */\nexport function toStringXY(coordinate, opt_fractionDigits) {\n  return format(coordinate, '{x}, {y}', opt_fractionDigits);\n}\n","/**\n * @module ol/geom/flat/interpolate\n */\nimport {binarySearch} from '../../array.js';\nimport {lerp} from '../../math.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} fraction Fraction.\n * @param {Array.<number>=} opt_dest Destination.\n * @return {Array.<number>} Destination.\n */\nexport function interpolatePoint(flatCoordinates, offset, end, stride, fraction, opt_dest) {\n  let pointX = NaN;\n  let pointY = NaN;\n  const n = (end - offset) / stride;\n  if (n === 1) {\n    pointX = flatCoordinates[offset];\n    pointY = flatCoordinates[offset + 1];\n  } else if (n == 2) {\n    pointX = (1 - fraction) * flatCoordinates[offset] +\n        fraction * flatCoordinates[offset + stride];\n    pointY = (1 - fraction) * flatCoordinates[offset + 1] +\n        fraction * flatCoordinates[offset + stride + 1];\n  } else if (n !== 0) {\n    let x1 = flatCoordinates[offset];\n    let y1 = flatCoordinates[offset + 1];\n    let length = 0;\n    const cumulativeLengths = [0];\n    for (let i = offset + stride; i < end; i += stride) {\n      const x2 = flatCoordinates[i];\n      const y2 = flatCoordinates[i + 1];\n      length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n      cumulativeLengths.push(length);\n      x1 = x2;\n      y1 = y2;\n    }\n    const target = fraction * length;\n    const index = binarySearch(cumulativeLengths, target);\n    if (index < 0) {\n      const t = (target - cumulativeLengths[-index - 2]) /\n          (cumulativeLengths[-index - 1] - cumulativeLengths[-index - 2]);\n      const o = offset + (-index - 2) * stride;\n      pointX = lerp(\n        flatCoordinates[o], flatCoordinates[o + stride], t);\n      pointY = lerp(\n        flatCoordinates[o + 1], flatCoordinates[o + stride + 1], t);\n    } else {\n      pointX = flatCoordinates[offset + index * stride];\n      pointY = flatCoordinates[offset + index * stride + 1];\n    }\n  }\n  if (opt_dest) {\n    opt_dest[0] = pointX;\n    opt_dest[1] = pointY;\n    return opt_dest;\n  } else {\n    return [pointX, pointY];\n  }\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} m M.\n * @param {boolean} extrapolate Extrapolate.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n */\nexport function lineStringCoordinateAtM(flatCoordinates, offset, end, stride, m, extrapolate) {\n  if (end == offset) {\n    return null;\n  }\n  let coordinate;\n  if (m < flatCoordinates[offset + stride - 1]) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(offset, offset + stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    } else {\n      return null;\n    }\n  } else if (flatCoordinates[end - 1] < m) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(end - stride, end);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    } else {\n      return null;\n    }\n  }\n  // FIXME use O(1) search\n  if (m == flatCoordinates[offset + stride - 1]) {\n    return flatCoordinates.slice(offset, offset + stride);\n  }\n  let lo = offset / stride;\n  let hi = end / stride;\n  while (lo < hi) {\n    const mid = (lo + hi) >> 1;\n    if (m < flatCoordinates[(mid + 1) * stride - 1]) {\n      hi = mid;\n    } else {\n      lo = mid + 1;\n    }\n  }\n  const m0 = flatCoordinates[lo * stride - 1];\n  if (m == m0) {\n    return flatCoordinates.slice((lo - 1) * stride, (lo - 1) * stride + stride);\n  }\n  const m1 = flatCoordinates[(lo + 1) * stride - 1];\n  const t = (m - m0) / (m1 - m0);\n  coordinate = [];\n  for (let i = 0; i < stride - 1; ++i) {\n    coordinate.push(lerp(flatCoordinates[(lo - 1) * stride + i],\n      flatCoordinates[lo * stride + i], t));\n  }\n  coordinate.push(m);\n  return coordinate;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} m M.\n * @param {boolean} extrapolate Extrapolate.\n * @param {boolean} interpolate Interpolate.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n */\nexport function lineStringsCoordinateAtM(\n  flatCoordinates, offset, ends, stride, m, extrapolate, interpolate) {\n  if (interpolate) {\n    return lineStringCoordinateAtM(\n      flatCoordinates, offset, ends[ends.length - 1], stride, m, extrapolate);\n  }\n  let coordinate;\n  if (m < flatCoordinates[stride - 1]) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(0, stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    } else {\n      return null;\n    }\n  }\n  if (flatCoordinates[flatCoordinates.length - 1] < m) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(flatCoordinates.length - stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    } else {\n      return null;\n    }\n  }\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    if (offset == end) {\n      continue;\n    }\n    if (m < flatCoordinates[offset + stride - 1]) {\n      return null;\n    } else if (m <= flatCoordinates[end - 1]) {\n      return lineStringCoordinateAtM(\n        flatCoordinates, offset, end, stride, m, false);\n    }\n    offset = end;\n  }\n  return null;\n}\n","/**\n * @module ol/geom/flat/length\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} Length.\n */\nexport function lineStringLength(flatCoordinates, offset, end, stride) {\n  let x1 = flatCoordinates[offset];\n  let y1 = flatCoordinates[offset + 1];\n  let length = 0;\n  for (let i = offset + stride; i < end; i += stride) {\n    const x2 = flatCoordinates[i];\n    const y2 = flatCoordinates[i + 1];\n    length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n    x1 = x2;\n    y1 = y2;\n  }\n  return length;\n}\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} Perimeter.\n */\nexport function linearRingLength(flatCoordinates, offset, end, stride) {\n  let perimeter = lineStringLength(flatCoordinates, offset, end, stride);\n  const dx = flatCoordinates[end - stride] - flatCoordinates[offset];\n  const dy = flatCoordinates[end - stride + 1] - flatCoordinates[offset + 1];\n  perimeter += Math.sqrt(dx * dx + dy * dy);\n  return perimeter;\n}\n","/**\n * @module ol/geom/LineString\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {assignClosestPoint, maxSquaredDelta} from '../geom/flat/closest.js';\nimport {deflateCoordinates} from '../geom/flat/deflate.js';\nimport {inflateCoordinates} from '../geom/flat/inflate.js';\nimport {interpolatePoint, lineStringCoordinateAtM} from '../geom/flat/interpolate.js';\nimport {intersectsLineString} from '../geom/flat/intersectsextent.js';\nimport {lineStringLength} from '../geom/flat/length.js';\nimport {forEach as forEachSegment} from '../geom/flat/segments.js';\nimport {douglasPeucker} from '../geom/flat/simplify.js';\n\n/**\n * @classdesc\n * Linestring geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst LineString = function(coordinates, opt_layout) {\n\n  SimpleGeometry.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.flatMidpoint_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.flatMidpointRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDelta_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDeltaRevision_ = -1;\n\n  this.setCoordinates(coordinates, opt_layout);\n\n};\n\ninherits(LineString, SimpleGeometry);\n\n\n/**\n * Append the passed coordinate to the coordinates of the linestring.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @api\n */\nLineString.prototype.appendCoordinate = function(coordinate) {\n  if (!this.flatCoordinates) {\n    this.flatCoordinates = coordinate.slice();\n  } else {\n    extend(this.flatCoordinates, coordinate);\n  }\n  this.changed();\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/LineString} Clone.\n * @override\n * @api\n */\nLineString.prototype.clone = function() {\n  const lineString = new LineString(null);\n  lineString.setFlatCoordinates(this.layout, this.flatCoordinates.slice());\n  return lineString;\n};\n\n\n/**\n * @inheritDoc\n */\nLineString.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  if (this.maxDeltaRevision_ != this.getRevision()) {\n    this.maxDelta_ = Math.sqrt(maxSquaredDelta(\n      this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, 0));\n    this.maxDeltaRevision_ = this.getRevision();\n  }\n  return assignClosestPoint(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    this.maxDelta_, false, x, y, closestPoint, minSquaredDistance);\n};\n\n\n/**\n * Iterate over each segment, calling the provided callback.\n * If the callback returns a truthy value the function returns that\n * value immediately. Otherwise the function returns `false`.\n *\n * @param {function(this: S, module:ol/coordinate~Coordinate, module:ol/coordinate~Coordinate): T} callback Function\n *     called for each segment.\n * @return {T|boolean} Value.\n * @template T,S\n * @api\n */\nLineString.prototype.forEachSegment = function(callback) {\n  return forEachSegment(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, callback);\n};\n\n\n/**\n * Returns the coordinate at `m` using linear interpolation, or `null` if no\n * such coordinate exists.\n *\n * `opt_extrapolate` controls extrapolation beyond the range of Ms in the\n * MultiLineString. If `opt_extrapolate` is `true` then Ms less than the first\n * M will return the first coordinate and Ms greater than the last M will\n * return the last coordinate.\n *\n * @param {number} m M.\n * @param {boolean=} opt_extrapolate Extrapolate. Default is `false`.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n * @api\n */\nLineString.prototype.getCoordinateAtM = function(m, opt_extrapolate) {\n  if (this.layout != GeometryLayout.XYM &&\n      this.layout != GeometryLayout.XYZM) {\n    return null;\n  }\n  const extrapolate = opt_extrapolate !== undefined ? opt_extrapolate : false;\n  return lineStringCoordinateAtM(this.flatCoordinates, 0,\n    this.flatCoordinates.length, this.stride, m, extrapolate);\n};\n\n\n/**\n * Return the coordinates of the linestring.\n * @return {Array.<module:ol/coordinate~Coordinate>} Coordinates.\n * @override\n * @api\n */\nLineString.prototype.getCoordinates = function() {\n  return inflateCoordinates(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);\n};\n\n\n/**\n * Return the coordinate at the provided fraction along the linestring.\n * The `fraction` is a number between 0 and 1, where 0 is the start of the\n * linestring and 1 is the end.\n * @param {number} fraction Fraction.\n * @param {module:ol/coordinate~Coordinate=} opt_dest Optional coordinate whose values will\n *     be modified. If not provided, a new coordinate will be returned.\n * @return {module:ol/coordinate~Coordinate} Coordinate of the interpolated point.\n * @api\n */\nLineString.prototype.getCoordinateAt = function(fraction, opt_dest) {\n  return interpolatePoint(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    fraction, opt_dest);\n};\n\n\n/**\n * Return the length of the linestring on projected plane.\n * @return {number} Length (on projected plane).\n * @api\n */\nLineString.prototype.getLength = function() {\n  return lineStringLength(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);\n};\n\n\n/**\n * @return {Array.<number>} Flat midpoint.\n */\nLineString.prototype.getFlatMidpoint = function() {\n  if (this.flatMidpointRevision_ != this.getRevision()) {\n    this.flatMidpoint_ = this.getCoordinateAt(0.5, this.flatMidpoint_);\n    this.flatMidpointRevision_ = this.getRevision();\n  }\n  return this.flatMidpoint_;\n};\n\n\n/**\n * @inheritDoc\n */\nLineString.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  const simplifiedFlatCoordinates = [];\n  simplifiedFlatCoordinates.length = douglasPeucker(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    squaredTolerance, simplifiedFlatCoordinates, 0);\n  const simplifiedLineString = new LineString(null);\n  simplifiedLineString.setFlatCoordinates(\n    GeometryLayout.XY, simplifiedFlatCoordinates);\n  return simplifiedLineString;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nLineString.prototype.getType = function() {\n  return GeometryType.LINE_STRING;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nLineString.prototype.intersectsExtent = function(extent) {\n  return intersectsLineString(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride,\n    extent);\n};\n\n\n/**\n * Set the coordinates of the linestring.\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nLineString.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null);\n  } else {\n    this.setLayout(opt_layout, coordinates, 1);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinates(\n      this.flatCoordinates, 0, coordinates, this.stride);\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n */\nLineString.prototype.setFlatCoordinates = function(layout, flatCoordinates) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.changed();\n};\nexport default LineString;\n","/**\n * @module ol/geom/flat/geodesic\n */\nimport {squaredSegmentDistance, toRadians, toDegrees} from '../../math.js';\nimport {get as getProjection, getTransform} from '../../proj.js';\n\n\n/**\n * @param {function(number): module:ol/coordinate~Coordinate} interpolate Interpolate function.\n * @param {module:ol/proj~TransformFunction} transform Transform from longitude/latitude to\n *     projected coordinates.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {Array.<number>} Flat coordinates.\n */\nfunction line(interpolate, transform, squaredTolerance) {\n  // FIXME reduce garbage generation\n  // FIXME optimize stack operations\n\n  /** @type {Array.<number>} */\n  const flatCoordinates = [];\n\n  let geoA = interpolate(0);\n  let geoB = interpolate(1);\n\n  let a = transform(geoA);\n  let b = transform(geoB);\n\n  /** @type {Array.<module:ol/coordinate~Coordinate>} */\n  const geoStack = [geoB, geoA];\n  /** @type {Array.<module:ol/coordinate~Coordinate>} */\n  const stack = [b, a];\n  /** @type {Array.<number>} */\n  const fractionStack = [1, 0];\n\n  /** @type {!Object.<string, boolean>} */\n  const fractions = {};\n\n  let maxIterations = 1e5;\n  let geoM, m, fracA, fracB, fracM, key;\n\n  while (--maxIterations > 0 && fractionStack.length > 0) {\n    // Pop the a coordinate off the stack\n    fracA = fractionStack.pop();\n    geoA = geoStack.pop();\n    a = stack.pop();\n    // Add the a coordinate if it has not been added yet\n    key = fracA.toString();\n    if (!(key in fractions)) {\n      flatCoordinates.push(a[0], a[1]);\n      fractions[key] = true;\n    }\n    // Pop the b coordinate off the stack\n    fracB = fractionStack.pop();\n    geoB = geoStack.pop();\n    b = stack.pop();\n    // Find the m point between the a and b coordinates\n    fracM = (fracA + fracB) / 2;\n    geoM = interpolate(fracM);\n    m = transform(geoM);\n    if (squaredSegmentDistance(m[0], m[1], a[0], a[1],\n      b[0], b[1]) < squaredTolerance) {\n      // If the m point is sufficiently close to the straight line, then we\n      // discard it.  Just use the b coordinate and move on to the next line\n      // segment.\n      flatCoordinates.push(b[0], b[1]);\n      key = fracB.toString();\n      fractions[key] = true;\n    } else {\n      // Otherwise, we need to subdivide the current line segment.  Split it\n      // into two and push the two line segments onto the stack.\n      fractionStack.push(fracB, fracM, fracM, fracA);\n      stack.push(b, m, m, a);\n      geoStack.push(geoB, geoM, geoM, geoA);\n    }\n  }\n\n  return flatCoordinates;\n}\n\n\n/**\n * Generate a great-circle arcs between two lat/lon points.\n * @param {number} lon1 Longitude 1 in degrees.\n * @param {number} lat1 Latitude 1 in degrees.\n * @param {number} lon2 Longitude 2 in degrees.\n * @param {number} lat2 Latitude 2 in degrees.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {Array.<number>} Flat coordinates.\n */\nexport function greatCircleArc(lon1, lat1, lon2, lat2, projection, squaredTolerance) {\n  const geoProjection = getProjection('EPSG:4326');\n\n  const cosLat1 = Math.cos(toRadians(lat1));\n  const sinLat1 = Math.sin(toRadians(lat1));\n  const cosLat2 = Math.cos(toRadians(lat2));\n  const sinLat2 = Math.sin(toRadians(lat2));\n  const cosDeltaLon = Math.cos(toRadians(lon2 - lon1));\n  const sinDeltaLon = Math.sin(toRadians(lon2 - lon1));\n  const d = sinLat1 * sinLat2 + cosLat1 * cosLat2 * cosDeltaLon;\n\n  return line(\n    /**\n     * @param {number} frac Fraction.\n     * @return {module:ol/coordinate~Coordinate} Coordinate.\n     */\n    function(frac) {\n      if (1 <= d) {\n        return [lon2, lat2];\n      }\n      const D = frac * Math.acos(d);\n      const cosD = Math.cos(D);\n      const sinD = Math.sin(D);\n      const y = sinDeltaLon * cosLat2;\n      const x = cosLat1 * sinLat2 - sinLat1 * cosLat2 * cosDeltaLon;\n      const theta = Math.atan2(y, x);\n      const lat = Math.asin(sinLat1 * cosD + cosLat1 * sinD * Math.cos(theta));\n      const lon = toRadians(lon1) +\n            Math.atan2(Math.sin(theta) * sinD * cosLat1,\n              cosD - sinLat1 * Math.sin(lat));\n      return [toDegrees(lon), toDegrees(lat)];\n    }, getTransform(geoProjection, projection), squaredTolerance);\n}\n\n\n/**\n * Generate a meridian (line at constant longitude).\n * @param {number} lon Longitude.\n * @param {number} lat1 Latitude 1.\n * @param {number} lat2 Latitude 2.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {Array.<number>} Flat coordinates.\n */\nexport function meridian(lon, lat1, lat2, projection, squaredTolerance) {\n  const epsg4326Projection = getProjection('EPSG:4326');\n  return line(\n    /**\n     * @param {number} frac Fraction.\n     * @return {module:ol/coordinate~Coordinate} Coordinate.\n     */\n    function(frac) {\n      return [lon, lat1 + ((lat2 - lat1) * frac)];\n    },\n    getTransform(epsg4326Projection, projection), squaredTolerance);\n}\n\n\n/**\n * Generate a parallel (line at constant latitude).\n * @param {number} lat Latitude.\n * @param {number} lon1 Longitude 1.\n * @param {number} lon2 Longitude 2.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {Array.<number>} Flat coordinates.\n */\nexport function parallel(lat, lon1, lon2, projection, squaredTolerance) {\n  const epsg4326Projection = getProjection('EPSG:4326');\n  return line(\n    /**\n     * @param {number} frac Fraction.\n     * @return {module:ol/coordinate~Coordinate} Coordinate.\n     */\n    function(frac) {\n      return [lon1 + ((lon2 - lon1) * frac), lat];\n    },\n    getTransform(epsg4326Projection, projection), squaredTolerance);\n}\n","/**\n * @module ol/render/EventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * @event module:ol/render/Event~RenderEvent#postcompose\n   * @api\n   */\n  POSTCOMPOSE: 'postcompose',\n  /**\n   * @event module:ol/render/Event~RenderEvent#precompose\n   * @api\n   */\n  PRECOMPOSE: 'precompose',\n  /**\n   * @event module:ol/render/Event~RenderEvent#render\n   * @api\n   */\n  RENDER: 'render'\n};\n","/**\n * @module ol/style/TextPlacement\n */\n\n/**\n * Text placement. One of `'point'`, `'line'`. Default is `'point'`. Note that\n * `'line'` requires the underlying geometry to be a {@link module:ol/geom/LineString~LineString},\n * {@link module:ol/geom/Polygon~Polygon}, {@link module:ol/geom/MultiLineString~MultiLineString} or\n * {@link module:ol/geom/MultiPolygon~MultiPolygon}.\n * @enum {string}\n */\nexport default {\n  POINT: 'point',\n  LINE: 'line'\n};\n","/**\n * @module ol/style/Text\n */\nimport Fill from '../style/Fill.js';\nimport TextPlacement from '../style/TextPlacement.js';\n\n\n/**\n * The default fill color to use if no fill was set at construction time; a\n * blackish `#333`.\n *\n * @const {string}\n */\nconst DEFAULT_FILL_COLOR = '#333';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [font] Font style as CSS 'font' value, see:\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font}. Default is '10px sans-serif'\n * @property {number} [maxAngle] When `placement` is set to `'line'`, allow a maximum angle between adjacent characters.\n * The expected value is in radians, and the default is 45 (`Math.PI / 4`).\n * @property {number} [offsetX=0] Horizontal text offset in pixels. A positive will shift the text right.\n * @property {number} [offsetY=0] Vertical text offset in pixels. A positive will shift the text down.\n * @property {boolean} [overflow=false] For polygon labels or when `placement` is set to `'line'`, allow text to exceed\n * the width of the polygon at the label position or the length of the path that it follows.\n * @property {module:ol/style/TextPlacement|string} [placement] Text placement.\n * @property {number} [scale] Scale.\n * @property {boolean} [rotateWithView=false] Whether to rotate the text with the view.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {string} [text] Text content.\n * @property {string} [textAlign] Text alignment. Possible values: 'left', 'right', 'center', 'end' or 'start'.\n * Default is 'center' for `placement: 'point'`. For `placement: 'line'`, the default is to let the renderer choose a\n * placement where `maxAngle` is not exceeded.\n * @property {string} [textBaseline='middle'] Text base line. Possible values: 'bottom', 'top', 'middle', 'alphabetic',\n * 'hanging', 'ideographic'.\n * @property {module:ol/style/Fill} [fill] Fill style. If none is provided, we'll use a dark fill-style (#333).\n * @property {module:ol/style/Stroke} [stroke] Stroke style.\n * @property {module:ol/style/Fill} [backgroundFill] Fill style for the text background when `placement` is\n * `'point'`. Default is no fill.\n * @property {module:ol/style/Stroke} [backgroundStroke] Stroke style for the text background  when `placement`\n * is `'point'`. Default is no stroke.\n * @property {Array.<number>} [padding=[0, 0, 0, 0]] Padding in pixels around the text for decluttering and background. The order of\n * values in the array is `[top, right, bottom, left]`.\n */\n\n\n/**\n * @classdesc\n * Set text style for vector features.\n *\n * @constructor\n * @param {module:ol/style/Text~Options=} opt_options Options.\n * @api\n */\nconst Text = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.font_ = options.font;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.rotation_ = options.rotation;\n\n  /**\n   * @private\n   * @type {boolean|undefined}\n   */\n  this.rotateWithView_ = options.rotateWithView;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.scale_ = options.scale;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.text_ = options.text;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.textAlign_ = options.textAlign;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.textBaseline_ = options.textBaseline;\n\n  /**\n   * @private\n   * @type {module:ol/style/Fill}\n   */\n  this.fill_ = options.fill !== undefined ? options.fill :\n    new Fill({color: DEFAULT_FILL_COLOR});\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxAngle_ = options.maxAngle !== undefined ? options.maxAngle : Math.PI / 4;\n\n  /**\n   * @private\n   * @type {module:ol/style/TextPlacement|string}\n   */\n  this.placement_ = options.placement !== undefined ? options.placement : TextPlacement.POINT;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.overflow_ = !!options.overflow;\n\n  /**\n   * @private\n   * @type {module:ol/style/Stroke}\n   */\n  this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.offsetX_ = options.offsetX !== undefined ? options.offsetX : 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.offsetY_ = options.offsetY !== undefined ? options.offsetY : 0;\n\n  /**\n   * @private\n   * @type {module:ol/style/Fill}\n   */\n  this.backgroundFill_ = options.backgroundFill ? options.backgroundFill : null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Stroke}\n   */\n  this.backgroundStroke_ = options.backgroundStroke ? options.backgroundStroke : null;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.padding_ = options.padding === undefined ? null : options.padding;\n};\n\n\n/**\n * Clones the style.\n * @return {module:ol/style/Text} The cloned style.\n * @api\n */\nText.prototype.clone = function() {\n  return new Text({\n    font: this.getFont(),\n    placement: this.getPlacement(),\n    maxAngle: this.getMaxAngle(),\n    overflow: this.getOverflow(),\n    rotation: this.getRotation(),\n    rotateWithView: this.getRotateWithView(),\n    scale: this.getScale(),\n    text: this.getText(),\n    textAlign: this.getTextAlign(),\n    textBaseline: this.getTextBaseline(),\n    fill: this.getFill() ? this.getFill().clone() : undefined,\n    stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n    offsetX: this.getOffsetX(),\n    offsetY: this.getOffsetY(),\n    backgroundFill: this.getBackgroundFill() ? this.getBackgroundFill().clone() : undefined,\n    backgroundStroke: this.getBackgroundStroke() ? this.getBackgroundStroke().clone() : undefined\n  });\n};\n\n\n/**\n * Get the `overflow` configuration.\n * @return {boolean} Let text overflow the length of the path they follow.\n * @api\n */\nText.prototype.getOverflow = function() {\n  return this.overflow_;\n};\n\n\n/**\n * Get the font name.\n * @return {string|undefined} Font.\n * @api\n */\nText.prototype.getFont = function() {\n  return this.font_;\n};\n\n\n/**\n * Get the maximum angle between adjacent characters.\n * @return {number} Angle in radians.\n * @api\n */\nText.prototype.getMaxAngle = function() {\n  return this.maxAngle_;\n};\n\n\n/**\n * Get the label placement.\n * @return {module:ol/style/TextPlacement|string} Text placement.\n * @api\n */\nText.prototype.getPlacement = function() {\n  return this.placement_;\n};\n\n\n/**\n * Get the x-offset for the text.\n * @return {number} Horizontal text offset.\n * @api\n */\nText.prototype.getOffsetX = function() {\n  return this.offsetX_;\n};\n\n\n/**\n * Get the y-offset for the text.\n * @return {number} Vertical text offset.\n * @api\n */\nText.prototype.getOffsetY = function() {\n  return this.offsetY_;\n};\n\n\n/**\n * Get the fill style for the text.\n * @return {module:ol/style/Fill} Fill style.\n * @api\n */\nText.prototype.getFill = function() {\n  return this.fill_;\n};\n\n\n/**\n * Determine whether the text rotates with the map.\n * @return {boolean|undefined} Rotate with map.\n * @api\n */\nText.prototype.getRotateWithView = function() {\n  return this.rotateWithView_;\n};\n\n\n/**\n * Get the text rotation.\n * @return {number|undefined} Rotation.\n * @api\n */\nText.prototype.getRotation = function() {\n  return this.rotation_;\n};\n\n\n/**\n * Get the text scale.\n * @return {number|undefined} Scale.\n * @api\n */\nText.prototype.getScale = function() {\n  return this.scale_;\n};\n\n\n/**\n * Get the stroke style for the text.\n * @return {module:ol/style/Stroke} Stroke style.\n * @api\n */\nText.prototype.getStroke = function() {\n  return this.stroke_;\n};\n\n\n/**\n * Get the text to be rendered.\n * @return {string|undefined} Text.\n * @api\n */\nText.prototype.getText = function() {\n  return this.text_;\n};\n\n\n/**\n * Get the text alignment.\n * @return {string|undefined} Text align.\n * @api\n */\nText.prototype.getTextAlign = function() {\n  return this.textAlign_;\n};\n\n\n/**\n * Get the text baseline.\n * @return {string|undefined} Text baseline.\n * @api\n */\nText.prototype.getTextBaseline = function() {\n  return this.textBaseline_;\n};\n\n\n/**\n * Get the background fill style for the text.\n * @return {module:ol/style/Fill} Fill style.\n * @api\n */\nText.prototype.getBackgroundFill = function() {\n  return this.backgroundFill_;\n};\n\n\n/**\n * Get the background stroke style for the text.\n * @return {module:ol/style/Stroke} Stroke style.\n * @api\n */\nText.prototype.getBackgroundStroke = function() {\n  return this.backgroundStroke_;\n};\n\n\n/**\n * Get the padding for the text.\n * @return {Array.<number>} Padding.\n * @api\n */\nText.prototype.getPadding = function() {\n  return this.padding_;\n};\n\n\n/**\n * Set the `overflow` property.\n *\n * @param {boolean} overflow Let text overflow the path that it follows.\n * @api\n */\nText.prototype.setOverflow = function(overflow) {\n  this.overflow_ = overflow;\n};\n\n\n/**\n * Set the font.\n *\n * @param {string|undefined} font Font.\n * @api\n */\nText.prototype.setFont = function(font) {\n  this.font_ = font;\n};\n\n\n/**\n * Set the maximum angle between adjacent characters.\n *\n * @param {number} maxAngle Angle in radians.\n * @api\n */\nText.prototype.setMaxAngle = function(maxAngle) {\n  this.maxAngle_ = maxAngle;\n};\n\n\n/**\n * Set the x offset.\n *\n * @param {number} offsetX Horizontal text offset.\n * @api\n */\nText.prototype.setOffsetX = function(offsetX) {\n  this.offsetX_ = offsetX;\n};\n\n\n/**\n * Set the y offset.\n *\n * @param {number} offsetY Vertical text offset.\n * @api\n */\nText.prototype.setOffsetY = function(offsetY) {\n  this.offsetY_ = offsetY;\n};\n\n\n/**\n * Set the text placement.\n *\n * @param {module:ol/style/TextPlacement|string} placement Placement.\n * @api\n */\nText.prototype.setPlacement = function(placement) {\n  this.placement_ = placement;\n};\n\n\n/**\n * Set the fill.\n *\n * @param {module:ol/style/Fill} fill Fill style.\n * @api\n */\nText.prototype.setFill = function(fill) {\n  this.fill_ = fill;\n};\n\n\n/**\n * Set the rotation.\n *\n * @param {number|undefined} rotation Rotation.\n * @api\n */\nText.prototype.setRotation = function(rotation) {\n  this.rotation_ = rotation;\n};\n\n\n/**\n * Set the scale.\n *\n * @param {number|undefined} scale Scale.\n * @api\n */\nText.prototype.setScale = function(scale) {\n  this.scale_ = scale;\n};\n\n\n/**\n * Set the stroke.\n *\n * @param {module:ol/style/Stroke} stroke Stroke style.\n * @api\n */\nText.prototype.setStroke = function(stroke) {\n  this.stroke_ = stroke;\n};\n\n\n/**\n * Set the text.\n *\n * @param {string|undefined} text Text.\n * @api\n */\nText.prototype.setText = function(text) {\n  this.text_ = text;\n};\n\n\n/**\n * Set the text alignment.\n *\n * @param {string|undefined} textAlign Text align.\n * @api\n */\nText.prototype.setTextAlign = function(textAlign) {\n  this.textAlign_ = textAlign;\n};\n\n\n/**\n * Set the text baseline.\n *\n * @param {string|undefined} textBaseline Text baseline.\n * @api\n */\nText.prototype.setTextBaseline = function(textBaseline) {\n  this.textBaseline_ = textBaseline;\n};\n\n\n/**\n * Set the background fill.\n *\n * @param {module:ol/style/Fill} fill Fill style.\n * @api\n */\nText.prototype.setBackgroundFill = function(fill) {\n  this.backgroundFill_ = fill;\n};\n\n\n/**\n * Set the background stroke.\n *\n * @param {module:ol/style/Stroke} stroke Stroke style.\n * @api\n */\nText.prototype.setBackgroundStroke = function(stroke) {\n  this.backgroundStroke_ = stroke;\n};\n\n\n/**\n * Set the padding (`[top, right, bottom, left]`).\n *\n * @param {!Array.<number>} padding Padding.\n * @api\n */\nText.prototype.setPadding = function(padding) {\n  this.padding_ = padding;\n};\nexport default Text;\n","/**\n * @module ol/Graticule\n */\nimport {degreesToStringHDMS} from './coordinate.js';\nimport {listen, unlistenByKey} from './events.js';\nimport {intersects, getCenter} from './extent.js';\nimport GeometryLayout from './geom/GeometryLayout.js';\nimport LineString from './geom/LineString.js';\nimport Point from './geom/Point.js';\nimport {meridian, parallel} from './geom/flat/geodesic.js';\nimport {clamp} from './math.js';\nimport {get as getProjection, equivalent as equivalentProjection, getTransform, transformExtent} from './proj.js';\nimport RenderEventType from './render/EventType.js';\nimport Fill from './style/Fill.js';\nimport Stroke from './style/Stroke.js';\nimport Text from './style/Text.js';\n\n\n/**\n * @type {module:ol/style/Stroke}\n * @private\n * @const\n */\nconst DEFAULT_STROKE_STYLE = new Stroke({\n  color: 'rgba(0,0,0,0.2)'\n});\n\n/**\n * TODO can be configurable\n * @type {Array.<number>}\n * @private\n */\nconst INTERVALS = [\n  90, 45, 30, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1, 0.05, 0.01, 0.005, 0.002, 0.001\n];\n\n/**\n * @typedef {Object} GraticuleLabelDataType\n * @property {module:ol/geom/Point} geom\n * @property {string} text\n */\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/PluggableMap} [map] Reference to an\n * {@link module:ol/Map~Map} object.\n * @property {number} [maxLines=100] The maximum number of meridians and\n * parallels from the center of the map. The default value of 100 means that at\n * most 200 meridians and 200 parallels will be displayed. The default value is\n * appropriate for conformal projections like Spherical Mercator. If you\n * increase the value, more lines will be drawn and the drawing performance will\n * decrease.\n * @property {module:ol/style/Stroke} [strokeStyle='rgba(0,0,0,0.2)'] The\n * stroke style to use for drawing the graticule. If not provided, a not fully\n * opaque black will be used.\n * @property {number} [targetSize=100] The target size of the graticule cells,\n * in pixels.\n * @property {boolean} [showLabels=false] Render a label with the respective\n * latitude/longitude for each graticule line.\n * @property {function(number):string} [lonLabelFormatter] Label formatter for\n * longitudes. This function is called with the longitude as argument, and\n * should return a formatted string representing the longitude. By default,\n * labels are formatted as degrees, minutes, seconds and hemisphere.\n * @property {function(number):string} [latLabelFormatter] Label formatter for\n * latitudes. This function is called with the latitude as argument, and\n * should return a formatted string representing the latitude. By default,\n * labels are formatted as degrees, minutes, seconds and hemisphere.\n * @property {number} [lonLabelPosition=0] Longitude label position in fractions\n * (0..1) of view extent. 0 means at the bottom of the viewport, 1 means at the\n * top.\n * @property {number} [latLabelPosition=1] Latitude label position in fractions\n * (0..1) of view extent. 0 means at the left of the viewport, 1 means at the\n * right.\n * @property {module:ol/style/Text} [lonLabelStyle] Longitude label text\n * style. If not provided, the following style will be used:\n * ```js\n * new Text({\n *   font: '12px Calibri,sans-serif',\n *   textBaseline: 'bottom',\n *   fill: new Fill({\n *     color: 'rgba(0,0,0,1)'\n *   }),\n *   stroke: new Stroke({\n *     color: 'rgba(255,255,255,1)',\n *     width: 3\n *   })\n * });\n * ```\n * Note that the default's `textBaseline` configuration will not work well for\n * `lonLabelPosition` configurations that position labels close to the top of\n * the viewport.\n * @property {module:ol/style/Text} [latLabelStyle] Latitude label text style.\n * If not provided, the following style will be used:\n * ```js\n * new Text({\n *   font: '12px Calibri,sans-serif',\n *   textAlign: 'end',\n *   fill: new Fill({\n *     color: 'rgba(0,0,0,1)'\n *   }),\n *   stroke: Stroke({\n *     color: 'rgba(255,255,255,1)',\n *     width: 3\n *   })\n * });\n * ```\n * Note that the default's `textAlign` configuration will not work well for\n * `latLabelPosition` configurations that position labels close to the left of\n * the viewport.\n */\n\n\n/**\n * Render a grid for a coordinate system on a map.\n * @constructor\n * @param {module:ol/Graticule~Options=} opt_options Options.\n * @api\n */\nconst Graticule = function(opt_options) {\n  const options = opt_options || {};\n\n  /**\n   * @type {module:ol/PluggableMap}\n   * @private\n   */\n  this.map_ = null;\n\n  /**\n   * @type {?module:ol/events~EventsKey}\n   * @private\n   */\n  this.postcomposeListenerKey_ = null;\n\n  /**\n   * @type {module:ol/proj/Projection}\n   */\n  this.projection_ = null;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxLat_ = Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxLon_ = Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.minLat_ = -Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.minLon_ = -Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxLatP_ = Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxLonP_ = Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.minLatP_ = -Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.minLonP_ = -Infinity;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.targetSize_ = options.targetSize !== undefined ? options.targetSize : 100;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxLines_ = options.maxLines !== undefined ? options.maxLines : 100;\n\n  /**\n   * @type {Array.<module:ol/geom/LineString>}\n   * @private\n   */\n  this.meridians_ = [];\n\n  /**\n   * @type {Array.<module:ol/geom/LineString>}\n   * @private\n   */\n  this.parallels_ = [];\n\n  /**\n   * @type {module:ol/style/Stroke}\n   * @private\n   */\n  this.strokeStyle_ = options.strokeStyle !== undefined ? options.strokeStyle : DEFAULT_STROKE_STYLE;\n\n  /**\n   * @type {module:ol/proj~TransformFunction|undefined}\n   * @private\n   */\n  this.fromLonLatTransform_ = undefined;\n\n  /**\n   * @type {module:ol/proj~TransformFunction|undefined}\n   * @private\n   */\n  this.toLonLatTransform_ = undefined;\n\n  /**\n   * @type {module:ol/coordinate~Coordinate}\n   * @private\n   */\n  this.projectionCenterLonLat_ = null;\n\n  /**\n   * @type {Array.<module:ol/Graticule~GraticuleLabelDataType>}\n   * @private\n   */\n  this.meridiansLabels_ = null;\n\n  /**\n   * @type {Array.<module:ol/Graticule~GraticuleLabelDataType>}\n   * @private\n   */\n  this.parallelsLabels_ = null;\n\n  if (options.showLabels == true) {\n\n    /**\n     * @type {null|function(number):string}\n     * @private\n     */\n    this.lonLabelFormatter_ = options.lonLabelFormatter == undefined ?\n      degreesToStringHDMS.bind(this, 'EW') : options.lonLabelFormatter;\n\n    /**\n     * @type {function(number):string}\n     * @private\n     */\n    this.latLabelFormatter_ = options.latLabelFormatter == undefined ?\n      degreesToStringHDMS.bind(this, 'NS') : options.latLabelFormatter;\n\n    /**\n     * Longitude label position in fractions (0..1) of view extent. 0 means\n     * bottom, 1 means top.\n     * @type {number}\n     * @private\n     */\n    this.lonLabelPosition_ = options.lonLabelPosition == undefined ? 0 :\n      options.lonLabelPosition;\n\n    /**\n     * Latitude Label position in fractions (0..1) of view extent. 0 means left, 1\n     * means right.\n     * @type {number}\n     * @private\n     */\n    this.latLabelPosition_ = options.latLabelPosition == undefined ? 1 :\n      options.latLabelPosition;\n\n    /**\n     * @type {module:ol/style/Text}\n     * @private\n     */\n    this.lonLabelStyle_ = options.lonLabelStyle !== undefined ? options.lonLabelStyle :\n      new Text({\n        font: '12px Calibri,sans-serif',\n        textBaseline: 'bottom',\n        fill: new Fill({\n          color: 'rgba(0,0,0,1)'\n        }),\n        stroke: new Stroke({\n          color: 'rgba(255,255,255,1)',\n          width: 3\n        })\n      });\n\n    /**\n     * @type {module:ol/style/Text}\n     * @private\n     */\n    this.latLabelStyle_ = options.latLabelStyle !== undefined ? options.latLabelStyle :\n      new Text({\n        font: '12px Calibri,sans-serif',\n        textAlign: 'end',\n        fill: new Fill({\n          color: 'rgba(0,0,0,1)'\n        }),\n        stroke: new Stroke({\n          color: 'rgba(255,255,255,1)',\n          width: 3\n        })\n      });\n\n    this.meridiansLabels_ = [];\n    this.parallelsLabels_ = [];\n  }\n\n  this.setMap(options.map !== undefined ? options.map : null);\n};\n\n\n/**\n * @param {number} lon Longitude.\n * @param {number} minLat Minimal latitude.\n * @param {number} maxLat Maximal latitude.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} index Index.\n * @return {number} Index.\n * @private\n */\nGraticule.prototype.addMeridian_ = function(lon, minLat, maxLat, squaredTolerance, extent, index) {\n  const lineString = this.getMeridian_(lon, minLat, maxLat, squaredTolerance, index);\n  if (intersects(lineString.getExtent(), extent)) {\n    if (this.meridiansLabels_) {\n      const textPoint = this.getMeridianPoint_(lineString, extent, index);\n      this.meridiansLabels_[index] = {\n        geom: textPoint,\n        text: this.lonLabelFormatter_(lon)\n      };\n    }\n    this.meridians_[index++] = lineString;\n  }\n  return index;\n};\n\n/**\n * @param {module:ol/geom/LineString} lineString Meridian\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} index Index.\n * @return {module:ol/geom/Point} Meridian point.\n * @private\n */\nGraticule.prototype.getMeridianPoint_ = function(lineString, extent, index) {\n  const flatCoordinates = lineString.getFlatCoordinates();\n  const clampedBottom = Math.max(extent[1], flatCoordinates[1]);\n  const clampedTop = Math.min(extent[3], flatCoordinates[flatCoordinates.length - 1]);\n  const lat = clamp(\n    extent[1] + Math.abs(extent[1] - extent[3]) * this.lonLabelPosition_,\n    clampedBottom, clampedTop);\n  const coordinate = [flatCoordinates[0], lat];\n  const point = this.meridiansLabels_[index] !== undefined ?\n    this.meridiansLabels_[index].geom : new Point(null);\n  point.setCoordinates(coordinate);\n  return point;\n};\n\n\n/**\n * @param {number} lat Latitude.\n * @param {number} minLon Minimal longitude.\n * @param {number} maxLon Maximal longitude.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} index Index.\n * @return {number} Index.\n * @private\n */\nGraticule.prototype.addParallel_ = function(lat, minLon, maxLon, squaredTolerance, extent, index) {\n  const lineString = this.getParallel_(lat, minLon, maxLon, squaredTolerance, index);\n  if (intersects(lineString.getExtent(), extent)) {\n    if (this.parallelsLabels_) {\n      const textPoint = this.getParallelPoint_(lineString, extent, index);\n      this.parallelsLabels_[index] = {\n        geom: textPoint,\n        text: this.latLabelFormatter_(lat)\n      };\n    }\n    this.parallels_[index++] = lineString;\n  }\n  return index;\n};\n\n\n/**\n * @param {module:ol/geom/LineString} lineString Parallels.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} index Index.\n * @return {module:ol/geom/Point} Parallel point.\n * @private\n */\nGraticule.prototype.getParallelPoint_ = function(lineString, extent, index) {\n  const flatCoordinates = lineString.getFlatCoordinates();\n  const clampedLeft = Math.max(extent[0], flatCoordinates[0]);\n  const clampedRight = Math.min(extent[2], flatCoordinates[flatCoordinates.length - 2]);\n  const lon = clamp(\n    extent[0] + Math.abs(extent[0] - extent[2]) * this.latLabelPosition_,\n    clampedLeft, clampedRight);\n  const coordinate = [lon, flatCoordinates[1]];\n  const point = this.parallelsLabels_[index] !== undefined ?\n    this.parallelsLabels_[index].geom : new Point(null);\n  point.setCoordinates(coordinate);\n  return point;\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} squaredTolerance Squared tolerance.\n * @private\n */\nGraticule.prototype.createGraticule_ = function(extent, center, resolution, squaredTolerance) {\n\n  const interval = this.getInterval_(resolution);\n  if (interval == -1) {\n    this.meridians_.length = this.parallels_.length = 0;\n    if (this.meridiansLabels_) {\n      this.meridiansLabels_.length = 0;\n    }\n    if (this.parallelsLabels_) {\n      this.parallelsLabels_.length = 0;\n    }\n    return;\n  }\n\n  const centerLonLat = this.toLonLatTransform_(center);\n  let centerLon = centerLonLat[0];\n  let centerLat = centerLonLat[1];\n  const maxLines = this.maxLines_;\n  let cnt, idx, lat, lon;\n\n  let validExtent = [\n    Math.max(extent[0], this.minLonP_),\n    Math.max(extent[1], this.minLatP_),\n    Math.min(extent[2], this.maxLonP_),\n    Math.min(extent[3], this.maxLatP_)\n  ];\n\n  validExtent = transformExtent(validExtent, this.projection_, 'EPSG:4326');\n  const maxLat = validExtent[3];\n  const maxLon = validExtent[2];\n  const minLat = validExtent[1];\n  const minLon = validExtent[0];\n\n  // Create meridians\n\n  centerLon = Math.floor(centerLon / interval) * interval;\n  lon = clamp(centerLon, this.minLon_, this.maxLon_);\n\n  idx = this.addMeridian_(lon, minLat, maxLat, squaredTolerance, extent, 0);\n\n  cnt = 0;\n  while (lon != this.minLon_ && cnt++ < maxLines) {\n    lon = Math.max(lon - interval, this.minLon_);\n    idx = this.addMeridian_(lon, minLat, maxLat, squaredTolerance, extent, idx);\n  }\n\n  lon = clamp(centerLon, this.minLon_, this.maxLon_);\n\n  cnt = 0;\n  while (lon != this.maxLon_ && cnt++ < maxLines) {\n    lon = Math.min(lon + interval, this.maxLon_);\n    idx = this.addMeridian_(lon, minLat, maxLat, squaredTolerance, extent, idx);\n  }\n\n  this.meridians_.length = idx;\n  if (this.meridiansLabels_) {\n    this.meridiansLabels_.length = idx;\n  }\n\n  // Create parallels\n\n  centerLat = Math.floor(centerLat / interval) * interval;\n  lat = clamp(centerLat, this.minLat_, this.maxLat_);\n\n  idx = this.addParallel_(lat, minLon, maxLon, squaredTolerance, extent, 0);\n\n  cnt = 0;\n  while (lat != this.minLat_ && cnt++ < maxLines) {\n    lat = Math.max(lat - interval, this.minLat_);\n    idx = this.addParallel_(lat, minLon, maxLon, squaredTolerance, extent, idx);\n  }\n\n  lat = clamp(centerLat, this.minLat_, this.maxLat_);\n\n  cnt = 0;\n  while (lat != this.maxLat_ && cnt++ < maxLines) {\n    lat = Math.min(lat + interval, this.maxLat_);\n    idx = this.addParallel_(lat, minLon, maxLon, squaredTolerance, extent, idx);\n  }\n\n  this.parallels_.length = idx;\n  if (this.parallelsLabels_) {\n    this.parallelsLabels_.length = idx;\n  }\n\n};\n\n\n/**\n * @param {number} resolution Resolution.\n * @return {number} The interval in degrees.\n * @private\n */\nGraticule.prototype.getInterval_ = function(resolution) {\n  const centerLon = this.projectionCenterLonLat_[0];\n  const centerLat = this.projectionCenterLonLat_[1];\n  let interval = -1;\n  const target = Math.pow(this.targetSize_ * resolution, 2);\n  /** @type {Array.<number>} **/\n  const p1 = [];\n  /** @type {Array.<number>} **/\n  const p2 = [];\n  for (let i = 0, ii = INTERVALS.length; i < ii; ++i) {\n    const delta = INTERVALS[i] / 2;\n    p1[0] = centerLon - delta;\n    p1[1] = centerLat - delta;\n    p2[0] = centerLon + delta;\n    p2[1] = centerLat + delta;\n    this.fromLonLatTransform_(p1, p1);\n    this.fromLonLatTransform_(p2, p2);\n    const dist = Math.pow(p2[0] - p1[0], 2) + Math.pow(p2[1] - p1[1], 2);\n    if (dist <= target) {\n      break;\n    }\n    interval = INTERVALS[i];\n  }\n  return interval;\n};\n\n\n/**\n * Get the map associated with this graticule.\n * @return {module:ol/PluggableMap} The map.\n * @api\n */\nGraticule.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * @param {number} lon Longitude.\n * @param {number} minLat Minimal latitude.\n * @param {number} maxLat Maximal latitude.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {module:ol/geom/LineString} The meridian line string.\n * @param {number} index Index.\n * @private\n */\nGraticule.prototype.getMeridian_ = function(lon, minLat, maxLat, squaredTolerance, index) {\n  const flatCoordinates = meridian(lon, minLat, maxLat, this.projection_, squaredTolerance);\n  const lineString = this.meridians_[index] !== undefined ? this.meridians_[index] : new LineString(null);\n  lineString.setFlatCoordinates(GeometryLayout.XY, flatCoordinates);\n  return lineString;\n};\n\n\n/**\n * Get the list of meridians.  Meridians are lines of equal longitude.\n * @return {Array.<module:ol/geom/LineString>} The meridians.\n * @api\n */\nGraticule.prototype.getMeridians = function() {\n  return this.meridians_;\n};\n\n\n/**\n * @param {number} lat Latitude.\n * @param {number} minLon Minimal longitude.\n * @param {number} maxLon Maximal longitude.\n * @param {number} squaredTolerance Squared tolerance.\n * @return {module:ol/geom/LineString} The parallel line string.\n * @param {number} index Index.\n * @private\n */\nGraticule.prototype.getParallel_ = function(lat, minLon, maxLon, squaredTolerance, index) {\n  const flatCoordinates = parallel(lat, minLon, maxLon, this.projection_, squaredTolerance);\n  const lineString = this.parallels_[index] !== undefined ? this.parallels_[index] : new LineString(null);\n  lineString.setFlatCoordinates(GeometryLayout.XY, flatCoordinates);\n  return lineString;\n};\n\n\n/**\n * Get the list of parallels.  Parallels are lines of equal latitude.\n * @return {Array.<module:ol/geom/LineString>} The parallels.\n * @api\n */\nGraticule.prototype.getParallels = function() {\n  return this.parallels_;\n};\n\n\n/**\n * @param {module:ol/render/Event} e Event.\n * @private\n */\nGraticule.prototype.handlePostCompose_ = function(e) {\n  const vectorContext = e.vectorContext;\n  const frameState = e.frameState;\n  const extent = frameState.extent;\n  const viewState = frameState.viewState;\n  const center = viewState.center;\n  const projection = viewState.projection;\n  const resolution = viewState.resolution;\n  const pixelRatio = frameState.pixelRatio;\n  const squaredTolerance =\n      resolution * resolution / (4 * pixelRatio * pixelRatio);\n\n  const updateProjectionInfo = !this.projection_ ||\n      !equivalentProjection(this.projection_, projection);\n\n  if (updateProjectionInfo) {\n    this.updateProjectionInfo_(projection);\n  }\n\n  this.createGraticule_(extent, center, resolution, squaredTolerance);\n\n  // Draw the lines\n  vectorContext.setFillStrokeStyle(null, this.strokeStyle_);\n  let i, l, line;\n  for (i = 0, l = this.meridians_.length; i < l; ++i) {\n    line = this.meridians_[i];\n    vectorContext.drawGeometry(line);\n  }\n  for (i = 0, l = this.parallels_.length; i < l; ++i) {\n    line = this.parallels_[i];\n    vectorContext.drawGeometry(line);\n  }\n  let labelData;\n  if (this.meridiansLabels_) {\n    for (i = 0, l = this.meridiansLabels_.length; i < l; ++i) {\n      labelData = this.meridiansLabels_[i];\n      this.lonLabelStyle_.setText(labelData.text);\n      vectorContext.setTextStyle(this.lonLabelStyle_);\n      vectorContext.drawGeometry(labelData.geom);\n    }\n  }\n  if (this.parallelsLabels_) {\n    for (i = 0, l = this.parallelsLabels_.length; i < l; ++i) {\n      labelData = this.parallelsLabels_[i];\n      this.latLabelStyle_.setText(labelData.text);\n      vectorContext.setTextStyle(this.latLabelStyle_);\n      vectorContext.drawGeometry(labelData.geom);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @private\n */\nGraticule.prototype.updateProjectionInfo_ = function(projection) {\n  const epsg4326Projection = getProjection('EPSG:4326');\n\n  const worldExtent = projection.getWorldExtent();\n  const worldExtentP = transformExtent(worldExtent, epsg4326Projection, projection);\n\n  this.maxLat_ = worldExtent[3];\n  this.maxLon_ = worldExtent[2];\n  this.minLat_ = worldExtent[1];\n  this.minLon_ = worldExtent[0];\n\n  this.maxLatP_ = worldExtentP[3];\n  this.maxLonP_ = worldExtentP[2];\n  this.minLatP_ = worldExtentP[1];\n  this.minLonP_ = worldExtentP[0];\n\n  this.fromLonLatTransform_ = getTransform(epsg4326Projection, projection);\n\n  this.toLonLatTransform_ = getTransform(projection, epsg4326Projection);\n\n  this.projectionCenterLonLat_ = this.toLonLatTransform_(getCenter(projection.getExtent()));\n\n  this.projection_ = projection;\n};\n\n\n/**\n * Set the map for this graticule.  The graticule will be rendered on the\n * provided map.\n * @param {module:ol/PluggableMap} map Map.\n * @api\n */\nGraticule.prototype.setMap = function(map) {\n  if (this.map_) {\n    unlistenByKey(this.postcomposeListenerKey_);\n    this.postcomposeListenerKey_ = null;\n    this.map_.render();\n  }\n  if (map) {\n    this.postcomposeListenerKey_ = listen(map, RenderEventType.POSTCOMPOSE, this.handlePostCompose_, this);\n    map.render();\n  }\n  this.map_ = map;\n};\nexport default Graticule;\n","/**\n * @module ol/ImageBase\n */\nimport {inherits} from './util.js';\nimport EventTarget from './events/EventTarget.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/events/EventTarget}\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number|undefined} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/ImageState} state State.\n */\nconst ImageBase = function(extent, resolution, pixelRatio, state) {\n\n  EventTarget.call(this);\n\n  /**\n   * @protected\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent = extent;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelRatio_ = pixelRatio;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.resolution = resolution;\n\n  /**\n   * @protected\n   * @type {module:ol/ImageState}\n   */\n  this.state = state;\n\n};\n\ninherits(ImageBase, EventTarget);\n\n\n/**\n * @protected\n */\nImageBase.prototype.changed = function() {\n  this.dispatchEvent(EventType.CHANGE);\n};\n\n\n/**\n * @return {module:ol/extent~Extent} Extent.\n */\nImageBase.prototype.getExtent = function() {\n  return this.extent;\n};\n\n\n/**\n * @abstract\n * @return {HTMLCanvasElement|Image|HTMLVideoElement} Image.\n */\nImageBase.prototype.getImage = function() {};\n\n\n/**\n * @return {number} PixelRatio.\n */\nImageBase.prototype.getPixelRatio = function() {\n  return this.pixelRatio_;\n};\n\n\n/**\n * @return {number} Resolution.\n */\nImageBase.prototype.getResolution = function() {\n  return /** @type {number} */ (this.resolution);\n};\n\n\n/**\n * @return {module:ol/ImageState} State.\n */\nImageBase.prototype.getState = function() {\n  return this.state;\n};\n\n\n/**\n * Load not yet loaded URI.\n * @abstract\n */\nImageBase.prototype.load = function() {};\n\nexport default ImageBase;\n","/**\n * @module ol/Image\n */\nimport {inherits} from './util.js';\nimport ImageBase from './ImageBase.js';\nimport ImageState from './ImageState.js';\nimport {listenOnce, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\nimport {getHeight} from './extent.js';\n\n\n/**\n * A function that takes an {@link module:ol/Image~Image} for the image and a\n * `{string}` for the src as arguments. It is supposed to make it so the\n * underlying image {@link module:ol/Image~Image#getImage} is assigned the\n * content specified by the src. If not specified, the default is\n *\n *     function(image, src) {\n *       image.getImage().src = src;\n *     }\n *\n * Providing a custom `imageLoadFunction` can be useful to load images with\n * post requests or - in general - through XHR requests, where the src of the\n * image element would be set to a data URI when the content is loaded.\n *\n * @typedef {function(module:ol/Image, string)} LoadFunction\n * @api\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/ImageBase}\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number|undefined} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {string} src Image source URI.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/Image~LoadFunction} imageLoadFunction Image load function.\n */\nconst ImageWrapper = function(extent, resolution, pixelRatio, src, crossOrigin, imageLoadFunction) {\n\n  ImageBase.call(this, extent, resolution, pixelRatio, ImageState.IDLE);\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.src_ = src;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement|Image|HTMLVideoElement}\n   */\n  this.image_ = new Image();\n  if (crossOrigin !== null) {\n    this.image_.crossOrigin = crossOrigin;\n  }\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.imageListenerKeys_ = null;\n\n  /**\n   * @protected\n   * @type {module:ol/ImageState}\n   */\n  this.state = ImageState.IDLE;\n\n  /**\n   * @private\n   * @type {module:ol/Image~LoadFunction}\n   */\n  this.imageLoadFunction_ = imageLoadFunction;\n\n};\n\ninherits(ImageWrapper, ImageBase);\n\n\n/**\n * @inheritDoc\n * @api\n */\nImageWrapper.prototype.getImage = function() {\n  return this.image_;\n};\n\n\n/**\n * Tracks loading or read errors.\n *\n * @private\n */\nImageWrapper.prototype.handleImageError_ = function() {\n  this.state = ImageState.ERROR;\n  this.unlistenImage_();\n  this.changed();\n};\n\n\n/**\n * Tracks successful image load.\n *\n * @private\n */\nImageWrapper.prototype.handleImageLoad_ = function() {\n  if (this.resolution === undefined) {\n    this.resolution = getHeight(this.extent) / this.image_.height;\n  }\n  this.state = ImageState.LOADED;\n  this.unlistenImage_();\n  this.changed();\n};\n\n\n/**\n * Load the image or retry if loading previously failed.\n * Loading is taken care of by the tile queue, and calling this method is\n * only needed for preloading or for reloading in case of an error.\n * @override\n * @api\n */\nImageWrapper.prototype.load = function() {\n  if (this.state == ImageState.IDLE || this.state == ImageState.ERROR) {\n    this.state = ImageState.LOADING;\n    this.changed();\n    this.imageListenerKeys_ = [\n      listenOnce(this.image_, EventType.ERROR,\n        this.handleImageError_, this),\n      listenOnce(this.image_, EventType.LOAD,\n        this.handleImageLoad_, this)\n    ];\n    this.imageLoadFunction_(this, this.src_);\n  }\n};\n\n\n/**\n * @param {HTMLCanvasElement|Image|HTMLVideoElement} image Image.\n */\nImageWrapper.prototype.setImage = function(image) {\n  this.image_ = image;\n};\n\n\n/**\n * Discards event handlers which listen for load completion or errors.\n *\n * @private\n */\nImageWrapper.prototype.unlistenImage_ = function() {\n  this.imageListenerKeys_.forEach(unlistenByKey);\n  this.imageListenerKeys_ = null;\n};\n\nexport default ImageWrapper;\n","/**\n * @module ol/TileState\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  IDLE: 0,\n  LOADING: 1,\n  LOADED: 2,\n  ERROR: 3,\n  EMPTY: 4,\n  ABORT: 5\n};\n","/**\n * @module ol/easing\n */\n\n\n/**\n * Start slow and speed up.\n * @param {number} t Input between 0 and 1.\n * @return {number} Output between 0 and 1.\n * @api\n */\nexport function easeIn(t) {\n  return Math.pow(t, 3);\n}\n\n\n/**\n * Start fast and slow down.\n * @param {number} t Input between 0 and 1.\n * @return {number} Output between 0 and 1.\n * @api\n */\nexport function easeOut(t) {\n  return 1 - easeIn(1 - t);\n}\n\n\n/**\n * Start slow, speed up, and then slow down again.\n * @param {number} t Input between 0 and 1.\n * @return {number} Output between 0 and 1.\n * @api\n */\nexport function inAndOut(t) {\n  return 3 * t * t - 2 * t * t * t;\n}\n\n\n/**\n * Maintain a constant speed over time.\n * @param {number} t Input between 0 and 1.\n * @return {number} Output between 0 and 1.\n * @api\n */\nexport function linear(t) {\n  return t;\n}\n\n\n/**\n * Start slow, speed up, and at the very end slow down again.  This has the\n * same general behavior as {@link module:ol/easing~inAndOut}, but the final\n * slowdown is delayed.\n * @param {number} t Input between 0 and 1.\n * @return {number} Output between 0 and 1.\n * @api\n */\nexport function upAndDown(t) {\n  if (t < 0.5) {\n    return inAndOut(2 * t);\n  } else {\n    return 1 - inAndOut(2 * (t - 0.5));\n  }\n}\n","/**\n * @module ol/Tile\n */\nimport {inherits} from './util.js';\nimport TileState from './TileState.js';\nimport {easeIn} from './easing.js';\nimport EventTarget from './events/EventTarget.js';\nimport EventType from './events/EventType.js';\n\n\n/**\n * A function that takes an {@link module:ol/Tile} for the tile and a\n * `{string}` for the url as arguments.\n *\n * @typedef {function(module:ol/Tile, string)} LoadFunction\n * @api\n */\n\n/**\n * {@link module:ol/source/Tile~Tile} sources use a function of this type to get\n * the url that provides a tile for a given tile coordinate.\n *\n * This function takes an {@link module:ol/tilecoord~TileCoord} for the tile\n * coordinate, a `{number}` representing the pixel ratio and a\n * {@link module:ol/proj/Projection} for the projection  as arguments\n * and returns a `{string}` representing the tile URL, or undefined if no tile\n * should be requested for the passed tile coordinate.\n *\n * @typedef {function(module:ol/tilecoord~TileCoord, number,\n *           module:ol/proj/Projection): (string|undefined)} UrlFunction\n * @api\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [transition=250] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @api\n */\n\n\n/**\n * @classdesc\n * Base class for tiles.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/events/EventTarget}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {module:ol/Tile~Options=} opt_options Tile options.\n */\nconst Tile = function(tileCoord, state, opt_options) {\n  EventTarget.call(this);\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {module:ol/tilecoord~TileCoord}\n   */\n  this.tileCoord = tileCoord;\n\n  /**\n   * @protected\n   * @type {module:ol/TileState}\n   */\n  this.state = state;\n\n  /**\n   * An \"interim\" tile for this tile. The interim tile may be used while this\n   * one is loading, for \"smooth\" transitions when changing params/dimensions\n   * on the source.\n   * @type {module:ol/Tile}\n   */\n  this.interimTile = null;\n\n  /**\n   * A key assigned to the tile. This is used by the tile source to determine\n   * if this tile can effectively be used, or if a new tile should be created\n   * and this one be used as an interim tile for this new tile.\n   * @type {string}\n   */\n  this.key = '';\n\n  /**\n   * The duration for the opacity transition.\n   * @type {number}\n   */\n  this.transition_ = options.transition === undefined ? 250 : options.transition;\n\n  /**\n   * Lookup of start times for rendering transitions.  If the start time is\n   * equal to -1, the transition is complete.\n   * @type {Object.<number, number>}\n   */\n  this.transitionStarts_ = {};\n\n};\n\ninherits(Tile, EventTarget);\n\n\n/**\n * @protected\n */\nTile.prototype.changed = function() {\n  this.dispatchEvent(EventType.CHANGE);\n};\n\n\n/**\n * @return {string} Key.\n */\nTile.prototype.getKey = function() {\n  return this.key + '/' + this.tileCoord;\n};\n\n/**\n * Get the interim tile most suitable for rendering using the chain of interim\n * tiles. This corresponds to the  most recent tile that has been loaded, if no\n * such tile exists, the original tile is returned.\n * @return {!module:ol/Tile} Best tile for rendering.\n */\nTile.prototype.getInterimTile = function() {\n  if (!this.interimTile) {\n    //empty chain\n    return this;\n  }\n  let tile = this.interimTile;\n\n  // find the first loaded tile and return it. Since the chain is sorted in\n  // decreasing order of creation time, there is no need to search the remainder\n  // of the list (all those tiles correspond to older requests and will be\n  // cleaned up by refreshInterimChain)\n  do {\n    if (tile.getState() == TileState.LOADED) {\n      return tile;\n    }\n    tile = tile.interimTile;\n  } while (tile);\n\n  // we can not find a better tile\n  return this;\n};\n\n/**\n * Goes through the chain of interim tiles and discards sections of the chain\n * that are no longer relevant.\n */\nTile.prototype.refreshInterimChain = function() {\n  if (!this.interimTile) {\n    return;\n  }\n\n  let tile = this.interimTile;\n  let prev = this;\n\n  do {\n    if (tile.getState() == TileState.LOADED) {\n      //we have a loaded tile, we can discard the rest of the list\n      //we would could abort any LOADING tile request\n      //older than this tile (i.e. any LOADING tile following this entry in the chain)\n      tile.interimTile = null;\n      break;\n    } else if (tile.getState() == TileState.LOADING) {\n      //keep this LOADING tile any loaded tiles later in the chain are\n      //older than this tile, so we're still interested in the request\n      prev = tile;\n    } else if (tile.getState() == TileState.IDLE) {\n      //the head of the list is the most current tile, we don't need\n      //to start any other requests for this chain\n      prev.interimTile = tile.interimTile;\n    } else {\n      prev = tile;\n    }\n    tile = prev.interimTile;\n  } while (tile);\n};\n\n/**\n * Get the tile coordinate for this tile.\n * @return {module:ol/tilecoord~TileCoord} The tile coordinate.\n * @api\n */\nTile.prototype.getTileCoord = function() {\n  return this.tileCoord;\n};\n\n\n/**\n * @return {module:ol/TileState} State.\n */\nTile.prototype.getState = function() {\n  return this.state;\n};\n\n/**\n * @param {module:ol/TileState} state State.\n */\nTile.prototype.setState = function(state) {\n  this.state = state;\n  this.changed();\n};\n\n/**\n * Load the image or retry if loading previously failed.\n * Loading is taken care of by the tile queue, and calling this method is\n * only needed for preloading or for reloading in case of an error.\n * @abstract\n * @api\n */\nTile.prototype.load = function() {};\n\n/**\n * Get the alpha value for rendering.\n * @param {number} id An id for the renderer.\n * @param {number} time The render frame time.\n * @return {number} A number between 0 and 1.\n */\nTile.prototype.getAlpha = function(id, time) {\n  if (!this.transition_) {\n    return 1;\n  }\n\n  let start = this.transitionStarts_[id];\n  if (!start) {\n    start = time;\n    this.transitionStarts_[id] = start;\n  } else if (start === -1) {\n    return 1;\n  }\n\n  const delta = time - start + (1000 / 60); // avoid rendering at 0\n  if (delta >= this.transition_) {\n    return 1;\n  }\n  return easeIn(delta / this.transition_);\n};\n\n/**\n * Determine if a tile is in an alpha transition.  A tile is considered in\n * transition if tile.getAlpha() has not yet been called or has been called\n * and returned 1.\n * @param {number} id An id for the renderer.\n * @return {boolean} The tile is in transition.\n */\nTile.prototype.inTransition = function(id) {\n  if (!this.transition_) {\n    return false;\n  }\n  return this.transitionStarts_[id] !== -1;\n};\n\n/**\n * Mark a transition as complete.\n * @param {number} id An id for the renderer.\n */\nTile.prototype.endTransition = function(id) {\n  if (this.transition_) {\n    this.transitionStarts_[id] = -1;\n  }\n};\nexport default Tile;\n","/**\n * @module ol/ImageTile\n */\nimport {inherits} from './util.js';\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\nimport {createCanvasContext2D} from './dom.js';\nimport {listenOnce, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @typedef {function(new: module:ol/ImageTile, module:ol/tilecoord~TileCoord,\n * module:ol/TileState, string, ?string, module:ol/Tile~LoadFunction)} TileClass\n * @api\n */\n\n/**\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {string} src Image source URI.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/Tile~LoadFunction} tileLoadFunction Tile load function.\n * @param {module:ol/Tile~Options=} opt_options Tile options.\n */\nconst ImageTile = function(tileCoord, state, src, crossOrigin, tileLoadFunction, opt_options) {\n\n  Tile.call(this, tileCoord, state, opt_options);\n\n  /**\n   * @private\n   * @type {?string}\n   */\n  this.crossOrigin_ = crossOrigin;\n\n  /**\n   * Image URI\n   *\n   * @private\n   * @type {string}\n   */\n  this.src_ = src;\n\n  /**\n   * @private\n   * @type {Image|HTMLCanvasElement}\n   */\n  this.image_ = new Image();\n  if (crossOrigin !== null) {\n    this.image_.crossOrigin = crossOrigin;\n  }\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.imageListenerKeys_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/Tile~LoadFunction}\n   */\n  this.tileLoadFunction_ = tileLoadFunction;\n\n};\n\ninherits(ImageTile, Tile);\n\n\n/**\n * @inheritDoc\n */\nImageTile.prototype.disposeInternal = function() {\n  if (this.state == TileState.LOADING) {\n    this.unlistenImage_();\n    this.image_ = getBlankImage();\n  }\n  if (this.interimTile) {\n    this.interimTile.dispose();\n  }\n  this.state = TileState.ABORT;\n  this.changed();\n  Tile.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * Get the HTML image element for this tile (may be a Canvas, Image, or Video).\n * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n * @api\n */\nImageTile.prototype.getImage = function() {\n  return this.image_;\n};\n\n\n/**\n * @inheritDoc\n */\nImageTile.prototype.getKey = function() {\n  return this.src_;\n};\n\n\n/**\n * Tracks loading or read errors.\n *\n * @private\n */\nImageTile.prototype.handleImageError_ = function() {\n  this.state = TileState.ERROR;\n  this.unlistenImage_();\n  this.image_ = getBlankImage();\n  this.changed();\n};\n\n\n/**\n * Tracks successful image load.\n *\n * @private\n */\nImageTile.prototype.handleImageLoad_ = function() {\n  if (this.image_.naturalWidth && this.image_.naturalHeight) {\n    this.state = TileState.LOADED;\n  } else {\n    this.state = TileState.EMPTY;\n  }\n  this.unlistenImage_();\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nImageTile.prototype.load = function() {\n  if (this.state == TileState.ERROR) {\n    this.state = TileState.IDLE;\n    this.image_ = new Image();\n    if (this.crossOrigin_ !== null) {\n      this.image_.crossOrigin = this.crossOrigin_;\n    }\n  }\n  if (this.state == TileState.IDLE) {\n    this.state = TileState.LOADING;\n    this.changed();\n    this.imageListenerKeys_ = [\n      listenOnce(this.image_, EventType.ERROR,\n        this.handleImageError_, this),\n      listenOnce(this.image_, EventType.LOAD,\n        this.handleImageLoad_, this)\n    ];\n    this.tileLoadFunction_(this, this.src_);\n  }\n};\n\n\n/**\n * Discards event handlers which listen for load completion or errors.\n *\n * @private\n */\nImageTile.prototype.unlistenImage_ = function() {\n  this.imageListenerKeys_.forEach(unlistenByKey);\n  this.imageListenerKeys_ = null;\n};\n\n\n/**\n * Get a 1-pixel blank image.\n * @return {HTMLCanvasElement} Blank image.\n */\nfunction getBlankImage() {\n  const ctx = createCanvasContext2D(1, 1);\n  ctx.fillStyle = 'rgba(0,0,0,0)';\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.canvas;\n}\n\nexport default ImageTile;\n","/**\n * @module ol/Kinetic\n */\n\n/**\n * @classdesc\n * Implementation of inertial deceleration for map movement.\n *\n * @constructor\n * @param {number} decay Rate of decay (must be negative).\n * @param {number} minVelocity Minimum velocity (pixels/millisecond).\n * @param {number} delay Delay to consider to calculate the kinetic\n *     initial values (milliseconds).\n * @struct\n * @api\n */\nconst Kinetic = function(decay, minVelocity, delay) {\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.decay_ = decay;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minVelocity_ = minVelocity;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delay_ = delay;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.points_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.angle_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.initialVelocity_ = 0;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nKinetic.prototype.begin = function() {\n  this.points_.length = 0;\n  this.angle_ = 0;\n  this.initialVelocity_ = 0;\n};\n\n\n/**\n * @param {number} x X.\n * @param {number} y Y.\n */\nKinetic.prototype.update = function(x, y) {\n  this.points_.push(x, y, Date.now());\n};\n\n\n/**\n * @return {boolean} Whether we should do kinetic animation.\n */\nKinetic.prototype.end = function() {\n  if (this.points_.length < 6) {\n    // at least 2 points are required (i.e. there must be at least 6 elements\n    // in the array)\n    return false;\n  }\n  const delay = Date.now() - this.delay_;\n  const lastIndex = this.points_.length - 3;\n  if (this.points_[lastIndex + 2] < delay) {\n    // the last tracked point is too old, which means that the user stopped\n    // panning before releasing the map\n    return false;\n  }\n\n  // get the first point which still falls into the delay time\n  let firstIndex = lastIndex - 3;\n  while (firstIndex > 0 && this.points_[firstIndex + 2] > delay) {\n    firstIndex -= 3;\n  }\n\n  const duration = this.points_[lastIndex + 2] - this.points_[firstIndex + 2];\n  // we don't want a duration of 0 (divide by zero)\n  // we also make sure the user panned for a duration of at least one frame\n  // (1/60s) to compute sane displacement values\n  if (duration < 1000 / 60) {\n    return false;\n  }\n\n  const dx = this.points_[lastIndex] - this.points_[firstIndex];\n  const dy = this.points_[lastIndex + 1] - this.points_[firstIndex + 1];\n  this.angle_ = Math.atan2(dy, dx);\n  this.initialVelocity_ = Math.sqrt(dx * dx + dy * dy) / duration;\n  return this.initialVelocity_ > this.minVelocity_;\n};\n\n\n/**\n * @return {number} Total distance travelled (pixels).\n */\nKinetic.prototype.getDistance = function() {\n  return (this.minVelocity_ - this.initialVelocity_) / this.decay_;\n};\n\n\n/**\n * @return {number} Angle of the kinetic panning animation (radians).\n */\nKinetic.prototype.getAngle = function() {\n  return this.angle_;\n};\nexport default Kinetic;\n","/**\n * @module ol/MapEvent\n */\nimport {inherits} from './util.js';\nimport Event from './events/Event.js';\n\n/**\n * @classdesc\n * Events emitted as map events are instances of this type.\n * See {@link module:ol/Map~Map} for which events trigger a map event.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type Event type.\n * @param {module:ol/PluggableMap} map Map.\n * @param {?module:ol/PluggableMap~FrameState=} opt_frameState Frame state.\n */\nconst MapEvent = function(type, map, opt_frameState) {\n\n  Event.call(this, type);\n\n  /**\n   * The map where the event occurred.\n   * @type {module:ol/PluggableMap}\n   * @api\n   */\n  this.map = map;\n\n  /**\n   * The frame state at the time of the event.\n   * @type {?module:ol/PluggableMap~FrameState}\n   * @api\n   */\n  this.frameState = opt_frameState !== undefined ? opt_frameState : null;\n\n};\n\ninherits(MapEvent, Event);\nexport default MapEvent;\n","/**\n * @module ol/MapBrowserEvent\n */\nimport {inherits} from './util.js';\nimport MapEvent from './MapEvent.js';\n\n/**\n * @classdesc\n * Events emitted as map browser events are instances of this type.\n * See {@link module:ol/Map~Map} for which events trigger a map browser event.\n *\n * @constructor\n * @extends {module:ol/MapEvent}\n * @param {string} type Event type.\n * @param {module:ol/PluggableMap} map Map.\n * @param {Event} browserEvent Browser event.\n * @param {boolean=} opt_dragging Is the map currently being dragged?\n * @param {?module:ol/PluggableMap~FrameState=} opt_frameState Frame state.\n */\nconst MapBrowserEvent = function(type, map, browserEvent, opt_dragging, opt_frameState) {\n\n  MapEvent.call(this, type, map, opt_frameState);\n\n  /**\n   * The original browser event.\n   * @const\n   * @type {Event}\n   * @api\n   */\n  this.originalEvent = browserEvent;\n\n  /**\n   * The map pixel relative to the viewport corresponding to the original browser event.\n   * @type {module:ol~Pixel}\n   * @api\n   */\n  this.pixel = map.getEventPixel(browserEvent);\n\n  /**\n   * The coordinate in view projection corresponding to the original browser event.\n   * @type {module:ol/coordinate~Coordinate}\n   * @api\n   */\n  this.coordinate = map.getCoordinateFromPixel(this.pixel);\n\n  /**\n   * Indicates if the map is currently being dragged. Only set for\n   * `POINTERDRAG` and `POINTERMOVE` events. Default is `false`.\n   *\n   * @type {boolean}\n   * @api\n   */\n  this.dragging = opt_dragging !== undefined ? opt_dragging : false;\n\n};\n\ninherits(MapBrowserEvent, MapEvent);\n\n\n/**\n * Prevents the default browser action.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/event.preventDefault\n * @override\n * @api\n */\nMapBrowserEvent.prototype.preventDefault = function() {\n  MapEvent.prototype.preventDefault.call(this);\n  this.originalEvent.preventDefault();\n};\n\n\n/**\n * Prevents further propagation of the current event.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/event.stopPropagation\n * @override\n * @api\n */\nMapBrowserEvent.prototype.stopPropagation = function() {\n  MapEvent.prototype.stopPropagation.call(this);\n  this.originalEvent.stopPropagation();\n};\nexport default MapBrowserEvent;\n","/**\n * @module ol/MapBrowserEventType\n */\nimport EventType from './events/EventType.js';\n\n/**\n * Constants for event names.\n * @enum {string}\n */\nexport default {\n\n  /**\n   * A true single click with no dragging and no double click. Note that this\n   * event is delayed by 250 ms to ensure that it is not a double click.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#singleclick\n   * @api\n   */\n  SINGLECLICK: 'singleclick',\n\n  /**\n   * A click with no dragging. A double click will fire two of this.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#click\n   * @api\n   */\n  CLICK: EventType.CLICK,\n\n  /**\n   * A true double click, with no dragging.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#dblclick\n   * @api\n   */\n  DBLCLICK: EventType.DBLCLICK,\n\n  /**\n   * Triggered when a pointer is dragged.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#pointerdrag\n   * @api\n   */\n  POINTERDRAG: 'pointerdrag',\n\n  /**\n   * Triggered when a pointer is moved. Note that on touch devices this is\n   * triggered when the map is panned, so is not the same as mousemove.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#pointermove\n   * @api\n   */\n  POINTERMOVE: 'pointermove',\n\n  POINTERDOWN: 'pointerdown',\n  POINTERUP: 'pointerup',\n  POINTEROVER: 'pointerover',\n  POINTEROUT: 'pointerout',\n  POINTERENTER: 'pointerenter',\n  POINTERLEAVE: 'pointerleave',\n  POINTERCANCEL: 'pointercancel'\n};\n","/**\n * @module ol/MapBrowserPointerEvent\n */\nimport {inherits} from './util.js';\nimport MapBrowserEvent from './MapBrowserEvent.js';\n\n/**\n * @constructor\n * @extends {module:ol/MapBrowserEvent}\n * @param {string} type Event type.\n * @param {module:ol/PluggableMap} map Map.\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @param {boolean=} opt_dragging Is the map currently being dragged?\n * @param {?module:ol/PluggableMap~FrameState=} opt_frameState Frame state.\n */\nconst MapBrowserPointerEvent = function(type, map, pointerEvent, opt_dragging,\n  opt_frameState) {\n\n  MapBrowserEvent.call(this, type, map, pointerEvent.originalEvent, opt_dragging,\n    opt_frameState);\n\n  /**\n   * @const\n   * @type {module:ol/pointer/PointerEvent}\n   */\n  this.pointerEvent = pointerEvent;\n\n};\n\ninherits(MapBrowserPointerEvent, MapBrowserEvent);\nexport default MapBrowserPointerEvent;\n","/**\n * @module ol/pointer/EventType\n */\n\n/**\n * Constants for event names.\n * @enum {string}\n */\nexport default {\n  POINTERMOVE: 'pointermove',\n  POINTERDOWN: 'pointerdown',\n  POINTERUP: 'pointerup',\n  POINTEROVER: 'pointerover',\n  POINTEROUT: 'pointerout',\n  POINTERENTER: 'pointerenter',\n  POINTERLEAVE: 'pointerleave',\n  POINTERCANCEL: 'pointercancel'\n};\n","/**\n * @module ol/pointer/EventSource\n */\n/**\n * @param {module:ol/pointer/PointerEventHandler} dispatcher Event handler.\n * @param {!Object.<string, function(Event)>} mapping Event mapping.\n * @constructor\n */\nconst EventSource = function(dispatcher, mapping) {\n  /**\n   * @type {module:ol/pointer/PointerEventHandler}\n   */\n  this.dispatcher = dispatcher;\n\n  /**\n   * @private\n   * @const\n   * @type {!Object.<string, function(Event)>}\n   */\n  this.mapping_ = mapping;\n};\n\n\n/**\n * List of events supported by this source.\n * @return {Array.<string>} Event names\n */\nEventSource.prototype.getEvents = function() {\n  return Object.keys(this.mapping_);\n};\n\n\n/**\n * Returns the handler that should handle a given event type.\n * @param {string} eventType The event type.\n * @return {function(Event)} Handler\n */\nEventSource.prototype.getHandlerForEvent = function(eventType) {\n  return this.mapping_[eventType];\n};\nexport default EventSource;\n","/**\n * @module ol/pointer/MouseSource\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport EventSource from '../pointer/EventSource.js';\n\n/**\n * @param {module:ol/pointer/PointerEventHandler} dispatcher Event handler.\n * @constructor\n * @extends {module:ol/pointer/EventSource}\n */\nconst MouseSource = function(dispatcher) {\n  const mapping = {\n    'mousedown': this.mousedown,\n    'mousemove': this.mousemove,\n    'mouseup': this.mouseup,\n    'mouseover': this.mouseover,\n    'mouseout': this.mouseout\n  };\n  EventSource.call(this, dispatcher, mapping);\n\n  /**\n   * @const\n   * @type {!Object.<string, Event|Object>}\n   */\n  this.pointerMap = dispatcher.pointerMap;\n\n  /**\n   * @const\n   * @type {Array.<module:ol~Pixel>}\n   */\n  this.lastTouches = [];\n};\n\ninherits(MouseSource, EventSource);\n\n\n/**\n * @type {number}\n */\nexport const POINTER_ID = 1;\n\n\n/**\n * @type {string}\n */\nexport const POINTER_TYPE = 'mouse';\n\n\n/**\n * Radius around touchend that swallows mouse events.\n *\n * @type {number}\n */\nconst DEDUP_DIST = 25;\n\n\n/**\n * Detect if a mouse event was simulated from a touch by\n * checking if previously there was a touch event at the\n * same position.\n *\n * FIXME - Known problem with the native Android browser on\n * Samsung GT-I9100 (Android 4.1.2):\n * In case the page is scrolled, this function does not work\n * correctly when a canvas is used (WebGL or canvas renderer).\n * Mouse listeners on canvas elements (for this browser), create\n * two mouse events: One 'good' and one 'bad' one (on other browsers or\n * when a div is used, there is only one event). For the 'bad' one,\n * clientX/clientY and also pageX/pageY are wrong when the page\n * is scrolled. Because of that, this function can not detect if\n * the events were simulated from a touch event. As result, a\n * pointer event at a wrong position is dispatched, which confuses\n * the map interactions.\n * It is unclear, how one can get the correct position for the event\n * or detect that the positions are invalid.\n *\n * @private\n * @param {Event} inEvent The in event.\n * @return {boolean} True, if the event was generated by a touch.\n */\nMouseSource.prototype.isEventSimulatedFromTouch_ = function(inEvent) {\n  const lts = this.lastTouches;\n  const x = inEvent.clientX;\n  const y = inEvent.clientY;\n  for (let i = 0, l = lts.length, t; i < l && (t = lts[i]); i++) {\n    // simulated mouse events will be swallowed near a primary touchend\n    const dx = Math.abs(x - t[0]);\n    const dy = Math.abs(y - t[1]);\n    if (dx <= DEDUP_DIST && dy <= DEDUP_DIST) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Creates a copy of the original event that will be used\n * for the fake pointer event.\n *\n * @param {Event} inEvent The in event.\n * @param {module:ol/pointer/PointerEventHandler} dispatcher Event handler.\n * @return {Object} The copied event.\n */\nfunction prepareEvent(inEvent, dispatcher) {\n  const e = dispatcher.cloneEvent(inEvent, inEvent);\n\n  // forward mouse preventDefault\n  const pd = e.preventDefault;\n  e.preventDefault = function() {\n    inEvent.preventDefault();\n    pd();\n  };\n\n  e.pointerId = POINTER_ID;\n  e.isPrimary = true;\n  e.pointerType = POINTER_TYPE;\n\n  return e;\n}\n\n\n/**\n * Handler for `mousedown`.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.mousedown = function(inEvent) {\n  if (!this.isEventSimulatedFromTouch_(inEvent)) {\n    // TODO(dfreedman) workaround for some elements not sending mouseup\n    // http://crbug/149091\n    if (POINTER_ID.toString() in this.pointerMap) {\n      this.cancel(inEvent);\n    }\n    const e = prepareEvent(inEvent, this.dispatcher);\n    this.pointerMap[POINTER_ID.toString()] = inEvent;\n    this.dispatcher.down(e, inEvent);\n  }\n};\n\n\n/**\n * Handler for `mousemove`.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.mousemove = function(inEvent) {\n  if (!this.isEventSimulatedFromTouch_(inEvent)) {\n    const e = prepareEvent(inEvent, this.dispatcher);\n    this.dispatcher.move(e, inEvent);\n  }\n};\n\n\n/**\n * Handler for `mouseup`.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.mouseup = function(inEvent) {\n  if (!this.isEventSimulatedFromTouch_(inEvent)) {\n    const p = this.pointerMap[POINTER_ID.toString()];\n\n    if (p && p.button === inEvent.button) {\n      const e = prepareEvent(inEvent, this.dispatcher);\n      this.dispatcher.up(e, inEvent);\n      this.cleanupMouse();\n    }\n  }\n};\n\n\n/**\n * Handler for `mouseover`.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.mouseover = function(inEvent) {\n  if (!this.isEventSimulatedFromTouch_(inEvent)) {\n    const e = prepareEvent(inEvent, this.dispatcher);\n    this.dispatcher.enterOver(e, inEvent);\n  }\n};\n\n\n/**\n * Handler for `mouseout`.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.mouseout = function(inEvent) {\n  if (!this.isEventSimulatedFromTouch_(inEvent)) {\n    const e = prepareEvent(inEvent, this.dispatcher);\n    this.dispatcher.leaveOut(e, inEvent);\n  }\n};\n\n\n/**\n * Dispatches a `pointercancel` event.\n *\n * @param {Event} inEvent The in event.\n */\nMouseSource.prototype.cancel = function(inEvent) {\n  const e = prepareEvent(inEvent, this.dispatcher);\n  this.dispatcher.cancel(e, inEvent);\n  this.cleanupMouse();\n};\n\n\n/**\n * Remove the mouse from the list of active pointers.\n */\nMouseSource.prototype.cleanupMouse = function() {\n  delete this.pointerMap[POINTER_ID.toString()];\n};\nexport default MouseSource;\n","/**\n * @module ol/pointer/MsSource\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport EventSource from '../pointer/EventSource.js';\n\n/**\n * @param {module:ol/pointer/PointerEventHandler} dispatcher Event handler.\n * @constructor\n * @extends {module:ol/pointer/EventSource}\n */\nconst MsSource = function(dispatcher) {\n  const mapping = {\n    'MSPointerDown': this.msPointerDown,\n    'MSPointerMove': this.msPointerMove,\n    'MSPointerUp': this.msPointerUp,\n    'MSPointerOut': this.msPointerOut,\n    'MSPointerOver': this.msPointerOver,\n    'MSPointerCancel': this.msPointerCancel,\n    'MSGotPointerCapture': this.msGotPointerCapture,\n    'MSLostPointerCapture': this.msLostPointerCapture\n  };\n  EventSource.call(this, dispatcher, mapping);\n\n  /**\n   * @const\n   * @type {!Object.<string, MSPointerEvent|Object>}\n   */\n  this.pointerMap = dispatcher.pointerMap;\n};\n\ninherits(MsSource, EventSource);\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst POINTER_TYPES = [\n  '',\n  'unavailable',\n  'touch',\n  'pen',\n  'mouse'\n];\n\n\n/**\n * Creates a copy of the original event that will be used\n * for the fake pointer event.\n *\n * @private\n * @param {MSPointerEvent} inEvent The in event.\n * @return {Object} The copied event.\n */\nMsSource.prototype.prepareEvent_ = function(inEvent) {\n  let e = inEvent;\n  if (typeof inEvent.pointerType === 'number') {\n    e = this.dispatcher.cloneEvent(inEvent, inEvent);\n    e.pointerType = POINTER_TYPES[inEvent.pointerType];\n  }\n\n  return e;\n};\n\n\n/**\n * Remove this pointer from the list of active pointers.\n * @param {number} pointerId Pointer identifier.\n */\nMsSource.prototype.cleanup = function(pointerId) {\n  delete this.pointerMap[pointerId.toString()];\n};\n\n\n/**\n * Handler for `msPointerDown`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerDown = function(inEvent) {\n  this.pointerMap[inEvent.pointerId.toString()] = inEvent;\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.down(e, inEvent);\n};\n\n\n/**\n * Handler for `msPointerMove`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerMove = function(inEvent) {\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.move(e, inEvent);\n};\n\n\n/**\n * Handler for `msPointerUp`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerUp = function(inEvent) {\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.up(e, inEvent);\n  this.cleanup(inEvent.pointerId);\n};\n\n\n/**\n * Handler for `msPointerOut`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerOut = function(inEvent) {\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.leaveOut(e, inEvent);\n};\n\n\n/**\n * Handler for `msPointerOver`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerOver = function(inEvent) {\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.enterOver(e, inEvent);\n};\n\n\n/**\n * Handler for `msPointerCancel`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msPointerCancel = function(inEvent) {\n  const e = this.prepareEvent_(inEvent);\n  this.dispatcher.cancel(e, inEvent);\n  this.cleanup(inEvent.pointerId);\n};\n\n\n/**\n * Handler for `msLostPointerCapture`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msLostPointerCapture = function(inEvent) {\n  const e = this.dispatcher.makeEvent('lostpointercapture', inEvent, inEvent);\n  this.dispatcher.dispatchEvent(e);\n};\n\n\n/**\n * Handler for `msGotPointerCapture`.\n *\n * @param {MSPointerEvent} inEvent The in event.\n */\nMsSource.prototype.msGotPointerCapture = function(inEvent) {\n  const e = this.dispatcher.makeEvent('gotpointercapture', inEvent, inEvent);\n  this.dispatcher.dispatchEvent(e);\n};\nexport default MsSource;\n","/**\n * @module ol/pointer/NativeSource\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport EventSource from '../pointer/EventSource.js';\n\n/**\n * @param {module:ol/pointer/PointerEventHandler} dispatcher Event handler.\n * @constructor\n * @extends {module:ol/pointer/EventSource}\n */\nconst NativeSource = function(dispatcher) {\n  const mapping = {\n    'pointerdown': this.pointerDown,\n    'pointermove': this.pointerMove,\n    'pointerup': this.pointerUp,\n    'pointerout': this.pointerOut,\n    'pointerover': this.pointerOver,\n    'pointercancel': this.pointerCancel,\n    'gotpointercapture': this.gotPointerCapture,\n    'lostpointercapture': this.lostPointerCapture\n  };\n  EventSource.call(this, dispatcher, mapping);\n};\n\ninherits(NativeSource, EventSource);\n\n\n/**\n * Handler for `pointerdown`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerDown = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `pointermove`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerMove = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `pointerup`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerUp = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `pointerout`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerOut = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `pointerover`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerOver = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `pointercancel`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.pointerCancel = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `lostpointercapture`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.lostPointerCapture = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\n\n\n/**\n * Handler for `gotpointercapture`.\n *\n * @param {Event} inEvent The in event.\n */\nNativeSource.prototype.gotPointerCapture = function(inEvent) {\n  this.dispatcher.fireNativeEvent(inEvent);\n};\nexport default NativeSource;\n","/**\n * @module ol/pointer/PointerEvent\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport Event from '../events/Event.js';\n\n/**\n * A class for pointer events.\n *\n * This class is used as an abstraction for mouse events,\n * touch events and even native pointer events.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type The type of the event to create.\n * @param {Event} originalEvent The event.\n * @param {Object.<string, ?>=} opt_eventDict An optional dictionary of\n *    initial event properties.\n */\nconst PointerEvent = function(type, originalEvent, opt_eventDict) {\n  Event.call(this, type);\n\n  /**\n   * @const\n   * @type {Event}\n   */\n  this.originalEvent = originalEvent;\n\n  const eventDict = opt_eventDict ? opt_eventDict : {};\n\n  /**\n   * @type {number}\n   */\n  this.buttons = this.getButtons_(eventDict);\n\n  /**\n   * @type {number}\n   */\n  this.pressure = this.getPressure_(eventDict, this.buttons);\n\n  // MouseEvent related properties\n\n  /**\n   * @type {boolean}\n   */\n  this.bubbles = 'bubbles' in eventDict ? eventDict['bubbles'] : false;\n\n  /**\n   * @type {boolean}\n   */\n  this.cancelable = 'cancelable' in eventDict ? eventDict['cancelable'] : false;\n\n  /**\n   * @type {Object}\n   */\n  this.view = 'view' in eventDict ? eventDict['view'] : null;\n\n  /**\n   * @type {number}\n   */\n  this.detail = 'detail' in eventDict ? eventDict['detail'] : null;\n\n  /**\n   * @type {number}\n   */\n  this.screenX = 'screenX' in eventDict ? eventDict['screenX'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.screenY = 'screenY' in eventDict ? eventDict['screenY'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.clientX = 'clientX' in eventDict ? eventDict['clientX'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.clientY = 'clientY' in eventDict ? eventDict['clientY'] : 0;\n\n  /**\n   * @type {boolean}\n   */\n  this.ctrlKey = 'ctrlKey' in eventDict ? eventDict['ctrlKey'] : false;\n\n  /**\n   * @type {boolean}\n   */\n  this.altKey = 'altKey' in eventDict ? eventDict['altKey'] : false;\n\n  /**\n   * @type {boolean}\n   */\n  this.shiftKey = 'shiftKey' in eventDict ? eventDict['shiftKey'] : false;\n\n  /**\n   * @type {boolean}\n   */\n  this.metaKey = 'metaKey' in eventDict ? eventDict['metaKey'] : false;\n\n  /**\n   * @type {number}\n   */\n  this.button = 'button' in eventDict ? eventDict['button'] : 0;\n\n  /**\n   * @type {Node}\n   */\n  this.relatedTarget = 'relatedTarget' in eventDict ?\n    eventDict['relatedTarget'] : null;\n\n  // PointerEvent related properties\n\n  /**\n   * @const\n   * @type {number}\n   */\n  this.pointerId = 'pointerId' in eventDict ? eventDict['pointerId'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.width = 'width' in eventDict ? eventDict['width'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.height = 'height' in eventDict ? eventDict['height'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.tiltX = 'tiltX' in eventDict ? eventDict['tiltX'] : 0;\n\n  /**\n   * @type {number}\n   */\n  this.tiltY = 'tiltY' in eventDict ? eventDict['tiltY'] : 0;\n\n  /**\n   * @type {string}\n   */\n  this.pointerType = 'pointerType' in eventDict ? eventDict['pointerType'] : '';\n\n  /**\n   * @type {number}\n   */\n  this.hwTimestamp = 'hwTimestamp' in eventDict ? eventDict['hwTimestamp'] : 0;\n\n  /**\n   * @type {boolean}\n   */\n  this.isPrimary = 'isPrimary' in eventDict ? eventDict['isPrimary'] : false;\n\n  // keep the semantics of preventDefault\n  if (originalEvent.preventDefault) {\n    this.preventDefault = function() {\n      originalEvent.preventDefault();\n    };\n  }\n};\n\ninherits(PointerEvent, Event);\n\n\n/**\n * Is the `buttons` property supported?\n * @type {boolean}\n */\nlet HAS_BUTTONS = false;\n\n\n/**\n * @private\n * @param {Object.<string, ?>} eventDict The event dictionary.\n * @return {number} Button indicator.\n */\nPointerEvent.prototype.getButtons_ = function(eventDict) {\n  // According to the w3c spec,\n  // http://www.w3.org/TR/DOM-Level-3-Events/#events-MouseEvent-button\n  // MouseEvent.button == 0 can mean either no mouse button depressed, or the\n  // left mouse button depressed.\n  //\n  // As of now, the only way to distinguish between the two states of\n  // MouseEvent.button is by using the deprecated MouseEvent.which property, as\n  // this maps mouse buttons to positive integers > 0, and uses 0 to mean that\n  // no mouse button is held.\n  //\n  // MouseEvent.which is derived from MouseEvent.button at MouseEvent creation,\n  // but initMouseEvent does not expose an argument with which to set\n  // MouseEvent.which. Calling initMouseEvent with a buttonArg of 0 will set\n  // MouseEvent.button == 0 and MouseEvent.which == 1, breaking the expectations\n  // of app developers.\n  //\n  // The only way to propagate the correct state of MouseEvent.which and\n  // MouseEvent.button to a new MouseEvent.button == 0 and MouseEvent.which == 0\n  // is to call initMouseEvent with a buttonArg value of -1.\n  //\n  // This is fixed with DOM Level 4's use of buttons\n  let buttons;\n  if (eventDict.buttons || HAS_BUTTONS) {\n    buttons = eventDict.buttons;\n  } else {\n    switch (eventDict.which) {\n      case 1: buttons = 1; break;\n      case 2: buttons = 4; break;\n      case 3: buttons = 2; break;\n      default: buttons = 0;\n    }\n  }\n  return buttons;\n};\n\n\n/**\n * @private\n * @param {Object.<string, ?>} eventDict The event dictionary.\n * @param {number} buttons Button indicator.\n * @return {number} The pressure.\n */\nPointerEvent.prototype.getPressure_ = function(eventDict, buttons) {\n  // Spec requires that pointers without pressure specified use 0.5 for down\n  // state and 0 for up state.\n  let pressure = 0;\n  if (eventDict.pressure) {\n    pressure = eventDict.pressure;\n  } else {\n    pressure = buttons ? 0.5 : 0;\n  }\n  return pressure;\n};\n\n\n/**\n * Checks if the `buttons` property is supported.\n */\n(function() {\n  try {\n    const ev = new MouseEvent('click', {buttons: 1});\n    HAS_BUTTONS = ev.buttons === 1;\n  } catch (e) {\n    // pass\n  }\n})();\nexport default PointerEvent;\n","/**\n * @module ol/pointer/TouchSource\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport {remove} from '../array.js';\nimport EventSource from '../pointer/EventSource.js';\nimport {POINTER_ID} from '../pointer/MouseSource.js';\n\n\n/**\n * @constructor\n * @param {module:ol/pointer/PointerEventHandler} dispatcher The event handler.\n * @param {module:ol/pointer/MouseSource} mouseSource Mouse source.\n * @extends {module:ol/pointer/EventSource}\n */\nconst TouchSource = function(dispatcher, mouseSource) {\n  const mapping = {\n    'touchstart': this.touchstart,\n    'touchmove': this.touchmove,\n    'touchend': this.touchend,\n    'touchcancel': this.touchcancel\n  };\n  EventSource.call(this, dispatcher, mapping);\n\n  /**\n   * @const\n   * @type {!Object.<string, Event|Object>}\n   */\n  this.pointerMap = dispatcher.pointerMap;\n\n  /**\n   * @const\n   * @type {module:ol/pointer/MouseSource}\n   */\n  this.mouseSource = mouseSource;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.firstTouchId_ = undefined;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.clickCount_ = 0;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.resetId_ = undefined;\n\n  /**\n   * Mouse event timeout: This should be long enough to\n   * ignore compat mouse events made by touch.\n   * @private\n   * @type {number}\n   */\n  this.dedupTimeout_ = 2500;\n};\n\ninherits(TouchSource, EventSource);\n\n\n/**\n * @type {number}\n */\nconst CLICK_COUNT_TIMEOUT = 200;\n\n\n/**\n * @type {string}\n */\nconst POINTER_TYPE = 'touch';\n\n/**\n * @private\n * @param {Touch} inTouch The in touch.\n * @return {boolean} True, if this is the primary touch.\n */\nTouchSource.prototype.isPrimaryTouch_ = function(inTouch) {\n  return this.firstTouchId_ === inTouch.identifier;\n};\n\n\n/**\n * Set primary touch if there are no pointers, or the only pointer is the mouse.\n * @param {Touch} inTouch The in touch.\n * @private\n */\nTouchSource.prototype.setPrimaryTouch_ = function(inTouch) {\n  const count = Object.keys(this.pointerMap).length;\n  if (count === 0 || (count === 1 && POINTER_ID.toString() in this.pointerMap)) {\n    this.firstTouchId_ = inTouch.identifier;\n    this.cancelResetClickCount_();\n  }\n};\n\n\n/**\n * @private\n * @param {Object} inPointer The in pointer object.\n */\nTouchSource.prototype.removePrimaryPointer_ = function(inPointer) {\n  if (inPointer.isPrimary) {\n    this.firstTouchId_ = undefined;\n    this.resetClickCount_();\n  }\n};\n\n\n/**\n * @private\n */\nTouchSource.prototype.resetClickCount_ = function() {\n  this.resetId_ = setTimeout(\n    this.resetClickCountHandler_.bind(this),\n    CLICK_COUNT_TIMEOUT);\n};\n\n\n/**\n * @private\n */\nTouchSource.prototype.resetClickCountHandler_ = function() {\n  this.clickCount_ = 0;\n  this.resetId_ = undefined;\n};\n\n\n/**\n * @private\n */\nTouchSource.prototype.cancelResetClickCount_ = function() {\n  if (this.resetId_ !== undefined) {\n    clearTimeout(this.resetId_);\n  }\n};\n\n\n/**\n * @private\n * @param {Event} browserEvent Browser event\n * @param {Touch} inTouch Touch event\n * @return {Object} A pointer object.\n */\nTouchSource.prototype.touchToPointer_ = function(browserEvent, inTouch) {\n  const e = this.dispatcher.cloneEvent(browserEvent, inTouch);\n  // Spec specifies that pointerId 1 is reserved for Mouse.\n  // Touch identifiers can start at 0.\n  // Add 2 to the touch identifier for compatibility.\n  e.pointerId = inTouch.identifier + 2;\n  // TODO: check if this is necessary?\n  //e.target = findTarget(e);\n  e.bubbles = true;\n  e.cancelable = true;\n  e.detail = this.clickCount_;\n  e.button = 0;\n  e.buttons = 1;\n  e.width = inTouch.webkitRadiusX || inTouch.radiusX || 0;\n  e.height = inTouch.webkitRadiusY || inTouch.radiusY || 0;\n  e.pressure = inTouch.webkitForce || inTouch.force || 0.5;\n  e.isPrimary = this.isPrimaryTouch_(inTouch);\n  e.pointerType = POINTER_TYPE;\n\n  // make sure that the properties that are different for\n  // each `Touch` object are not copied from the BrowserEvent object\n  e.clientX = inTouch.clientX;\n  e.clientY = inTouch.clientY;\n  e.screenX = inTouch.screenX;\n  e.screenY = inTouch.screenY;\n\n  return e;\n};\n\n\n/**\n * @private\n * @param {Event} inEvent Touch event\n * @param {function(Event, Object)} inFunction In function.\n */\nTouchSource.prototype.processTouches_ = function(inEvent, inFunction) {\n  const touches = Array.prototype.slice.call(inEvent.changedTouches);\n  const count = touches.length;\n  function preventDefault() {\n    inEvent.preventDefault();\n  }\n  for (let i = 0; i < count; ++i) {\n    const pointer = this.touchToPointer_(inEvent, touches[i]);\n    // forward touch preventDefaults\n    pointer.preventDefault = preventDefault;\n    inFunction.call(this, inEvent, pointer);\n  }\n};\n\n\n/**\n * @private\n * @param {TouchList} touchList The touch list.\n * @param {number} searchId Search identifier.\n * @return {boolean} True, if the `Touch` with the given id is in the list.\n */\nTouchSource.prototype.findTouch_ = function(touchList, searchId) {\n  const l = touchList.length;\n  for (let i = 0; i < l; i++) {\n    const touch = touchList[i];\n    if (touch.identifier === searchId) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * In some instances, a touchstart can happen without a touchend. This\n * leaves the pointermap in a broken state.\n * Therefore, on every touchstart, we remove the touches that did not fire a\n * touchend event.\n * To keep state globally consistent, we fire a pointercancel for\n * this \"abandoned\" touch\n *\n * @private\n * @param {Event} inEvent The in event.\n */\nTouchSource.prototype.vacuumTouches_ = function(inEvent) {\n  const touchList = inEvent.touches;\n  // pointerMap.getCount() should be < touchList.length here,\n  // as the touchstart has not been processed yet.\n  const keys = Object.keys(this.pointerMap);\n  const count = keys.length;\n  if (count >= touchList.length) {\n    const d = [];\n    for (let i = 0; i < count; ++i) {\n      const key = keys[i];\n      const value = this.pointerMap[key];\n      // Never remove pointerId == 1, which is mouse.\n      // Touch identifiers are 2 smaller than their pointerId, which is the\n      // index in pointermap.\n      if (key != POINTER_ID && !this.findTouch_(touchList, key - 2)) {\n        d.push(value.out);\n      }\n    }\n    for (let i = 0; i < d.length; ++i) {\n      this.cancelOut_(inEvent, d[i]);\n    }\n  }\n};\n\n\n/**\n * Handler for `touchstart`, triggers `pointerover`,\n * `pointerenter` and `pointerdown` events.\n *\n * @param {Event} inEvent The in event.\n */\nTouchSource.prototype.touchstart = function(inEvent) {\n  this.vacuumTouches_(inEvent);\n  this.setPrimaryTouch_(inEvent.changedTouches[0]);\n  this.dedupSynthMouse_(inEvent);\n  this.clickCount_++;\n  this.processTouches_(inEvent, this.overDown_);\n};\n\n\n/**\n * @private\n * @param {Event} browserEvent The event.\n * @param {Object} inPointer The in pointer object.\n */\nTouchSource.prototype.overDown_ = function(browserEvent, inPointer) {\n  this.pointerMap[inPointer.pointerId] = {\n    target: inPointer.target,\n    out: inPointer,\n    outTarget: inPointer.target\n  };\n  this.dispatcher.over(inPointer, browserEvent);\n  this.dispatcher.enter(inPointer, browserEvent);\n  this.dispatcher.down(inPointer, browserEvent);\n};\n\n\n/**\n * Handler for `touchmove`.\n *\n * @param {Event} inEvent The in event.\n */\nTouchSource.prototype.touchmove = function(inEvent) {\n  inEvent.preventDefault();\n  this.processTouches_(inEvent, this.moveOverOut_);\n};\n\n\n/**\n * @private\n * @param {Event} browserEvent The event.\n * @param {Object} inPointer The in pointer.\n */\nTouchSource.prototype.moveOverOut_ = function(browserEvent, inPointer) {\n  const event = inPointer;\n  const pointer = this.pointerMap[event.pointerId];\n  // a finger drifted off the screen, ignore it\n  if (!pointer) {\n    return;\n  }\n  const outEvent = pointer.out;\n  const outTarget = pointer.outTarget;\n  this.dispatcher.move(event, browserEvent);\n  if (outEvent && outTarget !== event.target) {\n    outEvent.relatedTarget = event.target;\n    event.relatedTarget = outTarget;\n    // recover from retargeting by shadow\n    outEvent.target = outTarget;\n    if (event.target) {\n      this.dispatcher.leaveOut(outEvent, browserEvent);\n      this.dispatcher.enterOver(event, browserEvent);\n    } else {\n      // clean up case when finger leaves the screen\n      event.target = outTarget;\n      event.relatedTarget = null;\n      this.cancelOut_(browserEvent, event);\n    }\n  }\n  pointer.out = event;\n  pointer.outTarget = event.target;\n};\n\n\n/**\n * Handler for `touchend`, triggers `pointerup`,\n * `pointerout` and `pointerleave` events.\n *\n * @param {Event} inEvent The event.\n */\nTouchSource.prototype.touchend = function(inEvent) {\n  this.dedupSynthMouse_(inEvent);\n  this.processTouches_(inEvent, this.upOut_);\n};\n\n\n/**\n * @private\n * @param {Event} browserEvent An event.\n * @param {Object} inPointer The inPointer object.\n */\nTouchSource.prototype.upOut_ = function(browserEvent, inPointer) {\n  this.dispatcher.up(inPointer, browserEvent);\n  this.dispatcher.out(inPointer, browserEvent);\n  this.dispatcher.leave(inPointer, browserEvent);\n  this.cleanUpPointer_(inPointer);\n};\n\n\n/**\n * Handler for `touchcancel`, triggers `pointercancel`,\n * `pointerout` and `pointerleave` events.\n *\n * @param {Event} inEvent The in event.\n */\nTouchSource.prototype.touchcancel = function(inEvent) {\n  this.processTouches_(inEvent, this.cancelOut_);\n};\n\n\n/**\n * @private\n * @param {Event} browserEvent The event.\n * @param {Object} inPointer The in pointer.\n */\nTouchSource.prototype.cancelOut_ = function(browserEvent, inPointer) {\n  this.dispatcher.cancel(inPointer, browserEvent);\n  this.dispatcher.out(inPointer, browserEvent);\n  this.dispatcher.leave(inPointer, browserEvent);\n  this.cleanUpPointer_(inPointer);\n};\n\n\n/**\n * @private\n * @param {Object} inPointer The inPointer object.\n */\nTouchSource.prototype.cleanUpPointer_ = function(inPointer) {\n  delete this.pointerMap[inPointer.pointerId];\n  this.removePrimaryPointer_(inPointer);\n};\n\n\n/**\n * Prevent synth mouse events from creating pointer events.\n *\n * @private\n * @param {Event} inEvent The in event.\n */\nTouchSource.prototype.dedupSynthMouse_ = function(inEvent) {\n  const lts = this.mouseSource.lastTouches;\n  const t = inEvent.changedTouches[0];\n  // only the primary finger will synth mouse events\n  if (this.isPrimaryTouch_(t)) {\n    // remember x/y of last touch\n    const lt = [t.clientX, t.clientY];\n    lts.push(lt);\n\n    setTimeout(function() {\n      // remove touch after timeout\n      remove(lts, lt);\n    }, this.dedupTimeout_);\n  }\n};\nexport default TouchSource;\n","/**\n * @module ol/pointer/PointerEventHandler\n */\n// Based on https://github.com/Polymer/PointerEvents\n\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n// * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n// * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n// * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nimport {inherits} from '../util.js';\nimport {listen, unlisten} from '../events.js';\nimport EventTarget from '../events/EventTarget.js';\nimport {POINTER, MSPOINTER, TOUCH} from '../has.js';\nimport PointerEventType from '../pointer/EventType.js';\nimport MouseSource from '../pointer/MouseSource.js';\nimport MsSource from '../pointer/MsSource.js';\nimport NativeSource from '../pointer/NativeSource.js';\nimport PointerEvent from '../pointer/PointerEvent.js';\nimport TouchSource from '../pointer/TouchSource.js';\n\n/**\n * @constructor\n * @extends {module:ol/events/EventTarget}\n * @param {Element|HTMLDocument} element Viewport element.\n */\nconst PointerEventHandler = function(element) {\n  EventTarget.call(this);\n\n  /**\n   * @const\n   * @private\n   * @type {Element|HTMLDocument}\n   */\n  this.element_ = element;\n\n  /**\n   * @const\n   * @type {!Object.<string, Event|Object>}\n   */\n  this.pointerMap = {};\n\n  /**\n   * @type {Object.<string, function(Event)>}\n   * @private\n   */\n  this.eventMap_ = {};\n\n  /**\n   * @type {Array.<module:ol/pointer/EventSource>}\n   * @private\n   */\n  this.eventSourceList_ = [];\n\n  this.registerSources();\n};\n\ninherits(PointerEventHandler, EventTarget);\n\n/**\n * Properties to copy when cloning an event, with default values.\n * @type {Array.<Array>}\n */\nconst CLONE_PROPS = [\n  // MouseEvent\n  ['bubbles', false],\n  ['cancelable', false],\n  ['view', null],\n  ['detail', null],\n  ['screenX', 0],\n  ['screenY', 0],\n  ['clientX', 0],\n  ['clientY', 0],\n  ['ctrlKey', false],\n  ['altKey', false],\n  ['shiftKey', false],\n  ['metaKey', false],\n  ['button', 0],\n  ['relatedTarget', null],\n  // DOM Level 3\n  ['buttons', 0],\n  // PointerEvent\n  ['pointerId', 0],\n  ['width', 0],\n  ['height', 0],\n  ['pressure', 0],\n  ['tiltX', 0],\n  ['tiltY', 0],\n  ['pointerType', ''],\n  ['hwTimestamp', 0],\n  ['isPrimary', false],\n  // event instance\n  ['type', ''],\n  ['target', null],\n  ['currentTarget', null],\n  ['which', 0]\n];\n\n\n/**\n * Set up the event sources (mouse, touch and native pointers)\n * that generate pointer events.\n */\nPointerEventHandler.prototype.registerSources = function() {\n  if (POINTER) {\n    this.registerSource('native', new NativeSource(this));\n  } else if (MSPOINTER) {\n    this.registerSource('ms', new MsSource(this));\n  } else {\n    const mouseSource = new MouseSource(this);\n    this.registerSource('mouse', mouseSource);\n\n    if (TOUCH) {\n      this.registerSource('touch', new TouchSource(this, mouseSource));\n    }\n  }\n\n  // register events on the viewport element\n  this.register_();\n};\n\n\n/**\n * Add a new event source that will generate pointer events.\n *\n * @param {string} name A name for the event source\n * @param {module:ol/pointer/EventSource} source The source event.\n */\nPointerEventHandler.prototype.registerSource = function(name, source) {\n  const s = source;\n  const newEvents = s.getEvents();\n\n  if (newEvents) {\n    newEvents.forEach(function(e) {\n      const handler = s.getHandlerForEvent(e);\n\n      if (handler) {\n        this.eventMap_[e] = handler.bind(s);\n      }\n    }.bind(this));\n    this.eventSourceList_.push(s);\n  }\n};\n\n\n/**\n * Set up the events for all registered event sources.\n * @private\n */\nPointerEventHandler.prototype.register_ = function() {\n  const l = this.eventSourceList_.length;\n  for (let i = 0; i < l; i++) {\n    const eventSource = this.eventSourceList_[i];\n    this.addEvents_(eventSource.getEvents());\n  }\n};\n\n\n/**\n * Remove all registered events.\n * @private\n */\nPointerEventHandler.prototype.unregister_ = function() {\n  const l = this.eventSourceList_.length;\n  for (let i = 0; i < l; i++) {\n    const eventSource = this.eventSourceList_[i];\n    this.removeEvents_(eventSource.getEvents());\n  }\n};\n\n\n/**\n * Calls the right handler for a new event.\n * @private\n * @param {Event} inEvent Browser event.\n */\nPointerEventHandler.prototype.eventHandler_ = function(inEvent) {\n  const type = inEvent.type;\n  const handler = this.eventMap_[type];\n  if (handler) {\n    handler(inEvent);\n  }\n};\n\n\n/**\n * Setup listeners for the given events.\n * @private\n * @param {Array.<string>} events List of events.\n */\nPointerEventHandler.prototype.addEvents_ = function(events) {\n  events.forEach(function(eventName) {\n    listen(this.element_, eventName, this.eventHandler_, this);\n  }.bind(this));\n};\n\n\n/**\n * Unregister listeners for the given events.\n * @private\n * @param {Array.<string>} events List of events.\n */\nPointerEventHandler.prototype.removeEvents_ = function(events) {\n  events.forEach(function(e) {\n    unlisten(this.element_, e, this.eventHandler_, this);\n  }.bind(this));\n};\n\n\n/**\n * Returns a snapshot of inEvent, with writable properties.\n *\n * @param {Event} event Browser event.\n * @param {Event|Touch} inEvent An event that contains\n *    properties to copy.\n * @return {Object} An object containing shallow copies of\n *    `inEvent`'s properties.\n */\nPointerEventHandler.prototype.cloneEvent = function(event, inEvent) {\n  const eventCopy = {};\n  for (let i = 0, ii = CLONE_PROPS.length; i < ii; i++) {\n    const p = CLONE_PROPS[i][0];\n    eventCopy[p] = event[p] || inEvent[p] || CLONE_PROPS[i][1];\n  }\n\n  return eventCopy;\n};\n\n\n// EVENTS\n\n\n/**\n * Triggers a 'pointerdown' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.down = function(data, event) {\n  this.fireEvent(PointerEventType.POINTERDOWN, data, event);\n};\n\n\n/**\n * Triggers a 'pointermove' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.move = function(data, event) {\n  this.fireEvent(PointerEventType.POINTERMOVE, data, event);\n};\n\n\n/**\n * Triggers a 'pointerup' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.up = function(data, event) {\n  this.fireEvent(PointerEventType.POINTERUP, data, event);\n};\n\n\n/**\n * Triggers a 'pointerenter' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.enter = function(data, event) {\n  data.bubbles = false;\n  this.fireEvent(PointerEventType.POINTERENTER, data, event);\n};\n\n\n/**\n * Triggers a 'pointerleave' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.leave = function(data, event) {\n  data.bubbles = false;\n  this.fireEvent(PointerEventType.POINTERLEAVE, data, event);\n};\n\n\n/**\n * Triggers a 'pointerover' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.over = function(data, event) {\n  data.bubbles = true;\n  this.fireEvent(PointerEventType.POINTEROVER, data, event);\n};\n\n\n/**\n * Triggers a 'pointerout' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.out = function(data, event) {\n  data.bubbles = true;\n  this.fireEvent(PointerEventType.POINTEROUT, data, event);\n};\n\n\n/**\n * Triggers a 'pointercancel' event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.cancel = function(data, event) {\n  this.fireEvent(PointerEventType.POINTERCANCEL, data, event);\n};\n\n\n/**\n * Triggers a combination of 'pointerout' and 'pointerleave' events.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.leaveOut = function(data, event) {\n  this.out(data, event);\n  if (!this.contains_(data.target, data.relatedTarget)) {\n    this.leave(data, event);\n  }\n};\n\n\n/**\n * Triggers a combination of 'pointerover' and 'pointerevents' events.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.enterOver = function(data, event) {\n  this.over(data, event);\n  if (!this.contains_(data.target, data.relatedTarget)) {\n    this.enter(data, event);\n  }\n};\n\n\n/**\n * @private\n * @param {Element} container The container element.\n * @param {Element} contained The contained element.\n * @return {boolean} Returns true if the container element\n *   contains the other element.\n */\nPointerEventHandler.prototype.contains_ = function(container, contained) {\n  if (!container || !contained) {\n    return false;\n  }\n  return container.contains(contained);\n};\n\n\n// EVENT CREATION AND TRACKING\n/**\n * Creates a new Event of type `inType`, based on the information in\n * `data`.\n *\n * @param {string} inType A string representing the type of event to create.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n * @return {module:ol/pointer/PointerEvent} A PointerEvent of type `inType`.\n */\nPointerEventHandler.prototype.makeEvent = function(inType, data, event) {\n  return new PointerEvent(inType, event, data);\n};\n\n\n/**\n * Make and dispatch an event in one call.\n * @param {string} inType A string representing the type of event.\n * @param {Object} data Pointer event data.\n * @param {Event} event The event.\n */\nPointerEventHandler.prototype.fireEvent = function(inType, data, event) {\n  const e = this.makeEvent(inType, data, event);\n  this.dispatchEvent(e);\n};\n\n\n/**\n * Creates a pointer event from a native pointer event\n * and dispatches this event.\n * @param {Event} event A platform event with a target.\n */\nPointerEventHandler.prototype.fireNativeEvent = function(event) {\n  const e = this.makeEvent(event.type, event, event);\n  this.dispatchEvent(e);\n};\n\n\n/**\n * Wrap a native mouse event into a pointer event.\n * This proxy method is required for the legacy IE support.\n * @param {string} eventType The pointer event type.\n * @param {Event} event The event.\n * @return {module:ol/pointer/PointerEvent} The wrapped event.\n */\nPointerEventHandler.prototype.wrapMouseEvent = function(eventType, event) {\n  const pointerEvent = this.makeEvent(\n    eventType, MouseSource.prepareEvent(event, this), event);\n  return pointerEvent;\n};\n\n\n/**\n * @inheritDoc\n */\nPointerEventHandler.prototype.disposeInternal = function() {\n  this.unregister_();\n  EventTarget.prototype.disposeInternal.call(this);\n};\n\n\nexport default PointerEventHandler;\n","/**\n * @module ol/MapBrowserEventHandler\n */\nimport {inherits} from './util.js';\nimport {DEVICE_PIXEL_RATIO} from './has.js';\nimport MapBrowserEventType from './MapBrowserEventType.js';\nimport MapBrowserPointerEvent from './MapBrowserPointerEvent.js';\nimport {listen, unlistenByKey} from './events.js';\nimport EventTarget from './events/EventTarget.js';\nimport PointerEventType from './pointer/EventType.js';\nimport PointerEventHandler from './pointer/PointerEventHandler.js';\n\n/**\n * @param {module:ol/PluggableMap} map The map with the viewport to\n * listen to events on.\n * @param {number=} moveTolerance The minimal distance the pointer must travel\n * to trigger a move.\n * @constructor\n * @extends {module:ol/events/EventTarget}\n */\nconst MapBrowserEventHandler = function(map, moveTolerance) {\n\n  EventTarget.call(this);\n\n  /**\n   * This is the element that we will listen to the real events on.\n   * @type {module:ol/PluggableMap}\n   * @private\n   */\n  this.map_ = map;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.clickTimeoutId_ = 0;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.dragging_ = false;\n\n  /**\n   * @type {!Array.<module:ol/events~EventsKey>}\n   * @private\n   */\n  this.dragListenerKeys_ = [];\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.moveTolerance_ = moveTolerance ?\n    moveTolerance * DEVICE_PIXEL_RATIO : DEVICE_PIXEL_RATIO;\n\n  /**\n   * The most recent \"down\" type event (or null if none have occurred).\n   * Set on pointerdown.\n   * @type {module:ol/pointer/PointerEvent}\n   * @private\n   */\n  this.down_ = null;\n\n  const element = this.map_.getViewport();\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.activePointers_ = 0;\n\n  /**\n   * @type {!Object.<number, boolean>}\n   * @private\n   */\n  this.trackedTouches_ = {};\n\n  /**\n   * Event handler which generates pointer events for\n   * the viewport element.\n   *\n   * @type {module:ol/pointer/PointerEventHandler}\n   * @private\n   */\n  this.pointerEventHandler_ = new PointerEventHandler(element);\n\n  /**\n   * Event handler which generates pointer events for\n   * the document (used when dragging).\n   *\n   * @type {module:ol/pointer/PointerEventHandler}\n   * @private\n   */\n  this.documentPointerEventHandler_ = null;\n\n  /**\n   * @type {?module:ol/events~EventsKey}\n   * @private\n   */\n  this.pointerdownListenerKey_ = listen(this.pointerEventHandler_,\n    PointerEventType.POINTERDOWN,\n    this.handlePointerDown_, this);\n\n  /**\n   * @type {?module:ol/events~EventsKey}\n   * @private\n   */\n  this.relayedListenerKey_ = listen(this.pointerEventHandler_,\n    PointerEventType.POINTERMOVE,\n    this.relayEvent_, this);\n\n};\n\ninherits(MapBrowserEventHandler, EventTarget);\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.emulateClick_ = function(pointerEvent) {\n  let newEvent = new MapBrowserPointerEvent(\n    MapBrowserEventType.CLICK, this.map_, pointerEvent);\n  this.dispatchEvent(newEvent);\n  if (this.clickTimeoutId_ !== 0) {\n    // double-click\n    clearTimeout(this.clickTimeoutId_);\n    this.clickTimeoutId_ = 0;\n    newEvent = new MapBrowserPointerEvent(\n      MapBrowserEventType.DBLCLICK, this.map_, pointerEvent);\n    this.dispatchEvent(newEvent);\n  } else {\n    // click\n    this.clickTimeoutId_ = setTimeout(function() {\n      this.clickTimeoutId_ = 0;\n      const newEvent = new MapBrowserPointerEvent(\n        MapBrowserEventType.SINGLECLICK, this.map_, pointerEvent);\n      this.dispatchEvent(newEvent);\n    }.bind(this), 250);\n  }\n};\n\n\n/**\n * Keeps track on how many pointers are currently active.\n *\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.updateActivePointers_ = function(pointerEvent) {\n  const event = pointerEvent;\n\n  if (event.type == MapBrowserEventType.POINTERUP ||\n      event.type == MapBrowserEventType.POINTERCANCEL) {\n    delete this.trackedTouches_[event.pointerId];\n  } else if (event.type == MapBrowserEventType.POINTERDOWN) {\n    this.trackedTouches_[event.pointerId] = true;\n  }\n  this.activePointers_ = Object.keys(this.trackedTouches_).length;\n};\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.handlePointerUp_ = function(pointerEvent) {\n  this.updateActivePointers_(pointerEvent);\n  const newEvent = new MapBrowserPointerEvent(\n    MapBrowserEventType.POINTERUP, this.map_, pointerEvent);\n  this.dispatchEvent(newEvent);\n\n  // We emulate click events on left mouse button click, touch contact, and pen\n  // contact. isMouseActionButton returns true in these cases (evt.button is set\n  // to 0).\n  // See http://www.w3.org/TR/pointerevents/#button-states\n  // We only fire click, singleclick, and doubleclick if nobody has called\n  // event.stopPropagation() or event.preventDefault().\n  if (!newEvent.propagationStopped && !this.dragging_ && this.isMouseActionButton_(pointerEvent)) {\n    this.emulateClick_(this.down_);\n  }\n\n  if (this.activePointers_ === 0) {\n    this.dragListenerKeys_.forEach(unlistenByKey);\n    this.dragListenerKeys_.length = 0;\n    this.dragging_ = false;\n    this.down_ = null;\n    this.documentPointerEventHandler_.dispose();\n    this.documentPointerEventHandler_ = null;\n  }\n};\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @return {boolean} If the left mouse button was pressed.\n * @private\n */\nMapBrowserEventHandler.prototype.isMouseActionButton_ = function(pointerEvent) {\n  return pointerEvent.button === 0;\n};\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.handlePointerDown_ = function(pointerEvent) {\n  this.updateActivePointers_(pointerEvent);\n  const newEvent = new MapBrowserPointerEvent(\n    MapBrowserEventType.POINTERDOWN, this.map_, pointerEvent);\n  this.dispatchEvent(newEvent);\n\n  this.down_ = pointerEvent;\n\n  if (this.dragListenerKeys_.length === 0) {\n    /* Set up a pointer event handler on the `document`,\n     * which is required when the pointer is moved outside\n     * the viewport when dragging.\n     */\n    this.documentPointerEventHandler_ =\n        new PointerEventHandler(document);\n\n    this.dragListenerKeys_.push(\n      listen(this.documentPointerEventHandler_,\n        MapBrowserEventType.POINTERMOVE,\n        this.handlePointerMove_, this),\n      listen(this.documentPointerEventHandler_,\n        MapBrowserEventType.POINTERUP,\n        this.handlePointerUp_, this),\n      /* Note that the listener for `pointercancel is set up on\n       * `pointerEventHandler_` and not `documentPointerEventHandler_` like\n       * the `pointerup` and `pointermove` listeners.\n       *\n       * The reason for this is the following: `TouchSource.vacuumTouches_()`\n       * issues `pointercancel` events, when there was no `touchend` for a\n       * `touchstart`. Now, let's say a first `touchstart` is registered on\n       * `pointerEventHandler_`. The `documentPointerEventHandler_` is set up.\n       * But `documentPointerEventHandler_` doesn't know about the first\n       * `touchstart`. If there is no `touchend` for the `touchstart`, we can\n       * only receive a `touchcancel` from `pointerEventHandler_`, because it is\n       * only registered there.\n       */\n      listen(this.pointerEventHandler_,\n        MapBrowserEventType.POINTERCANCEL,\n        this.handlePointerUp_, this)\n    );\n  }\n};\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.handlePointerMove_ = function(pointerEvent) {\n  // Between pointerdown and pointerup, pointermove events are triggered.\n  // To avoid a 'false' touchmove event to be dispatched, we test if the pointer\n  // moved a significant distance.\n  if (this.isMoving_(pointerEvent)) {\n    this.dragging_ = true;\n    const newEvent = new MapBrowserPointerEvent(\n      MapBrowserEventType.POINTERDRAG, this.map_, pointerEvent,\n      this.dragging_);\n    this.dispatchEvent(newEvent);\n  }\n\n  // Some native android browser triggers mousemove events during small period\n  // of time. See: https://code.google.com/p/android/issues/detail?id=5491 or\n  // https://code.google.com/p/android/issues/detail?id=19827\n  // ex: Galaxy Tab P3110 + Android 4.1.1\n  pointerEvent.preventDefault();\n};\n\n\n/**\n * Wrap and relay a pointer event.  Note that this requires that the type\n * string for the MapBrowserPointerEvent matches the PointerEvent type.\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @private\n */\nMapBrowserEventHandler.prototype.relayEvent_ = function(pointerEvent) {\n  const dragging = !!(this.down_ && this.isMoving_(pointerEvent));\n  this.dispatchEvent(new MapBrowserPointerEvent(\n    pointerEvent.type, this.map_, pointerEvent, dragging));\n};\n\n\n/**\n * @param {module:ol/pointer/PointerEvent} pointerEvent Pointer\n * event.\n * @return {boolean} Is moving.\n * @private\n */\nMapBrowserEventHandler.prototype.isMoving_ = function(pointerEvent) {\n  return this.dragging_ ||\n      Math.abs(pointerEvent.clientX - this.down_.clientX) > this.moveTolerance_ ||\n      Math.abs(pointerEvent.clientY - this.down_.clientY) > this.moveTolerance_;\n};\n\n\n/**\n * @inheritDoc\n */\nMapBrowserEventHandler.prototype.disposeInternal = function() {\n  if (this.relayedListenerKey_) {\n    unlistenByKey(this.relayedListenerKey_);\n    this.relayedListenerKey_ = null;\n  }\n  if (this.pointerdownListenerKey_) {\n    unlistenByKey(this.pointerdownListenerKey_);\n    this.pointerdownListenerKey_ = null;\n  }\n\n  this.dragListenerKeys_.forEach(unlistenByKey);\n  this.dragListenerKeys_.length = 0;\n\n  if (this.documentPointerEventHandler_) {\n    this.documentPointerEventHandler_.dispose();\n    this.documentPointerEventHandler_ = null;\n  }\n  if (this.pointerEventHandler_) {\n    this.pointerEventHandler_.dispose();\n    this.pointerEventHandler_ = null;\n  }\n  EventTarget.prototype.disposeInternal.call(this);\n};\nexport default MapBrowserEventHandler;\n","/**\n * @module ol/MapEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n\n  /**\n   * Triggered after a map frame is rendered.\n   * @event module:ol/MapEvent~MapEvent#postrender\n   * @api\n   */\n  POSTRENDER: 'postrender',\n\n  /**\n   * Triggered when the map starts moving.\n   * @event module:ol/MapEvent~MapEvent#movestart\n   * @api\n   */\n  MOVESTART: 'movestart',\n\n  /**\n   * Triggered after the map is moved.\n   * @event module:ol/MapEvent~MapEvent#moveend\n   * @api\n   */\n  MOVEEND: 'moveend'\n\n};\n","/**\n * @module ol/MapProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  LAYERGROUP: 'layergroup',\n  SIZE: 'size',\n  TARGET: 'target',\n  VIEW: 'view'\n};\n","/**\n * @module ol/structs/PriorityQueue\n */\nimport {assert} from '../asserts.js';\nimport {clear} from '../obj.js';\n\n/**\n * Priority queue.\n *\n * The implementation is inspired from the Closure Library's Heap class and\n * Python's heapq module.\n *\n * @see http://closure-library.googlecode.com/svn/docs/closure_goog_structs_heap.js.source.html\n * @see http://hg.python.org/cpython/file/2.7/Lib/heapq.py\n *\n * @constructor\n * @param {function(T): number} priorityFunction Priority function.\n * @param {function(T): string} keyFunction Key function.\n * @struct\n * @template T\n */\nconst PriorityQueue = function(priorityFunction, keyFunction) {\n\n  /**\n   * @type {function(T): number}\n   * @private\n   */\n  this.priorityFunction_ = priorityFunction;\n\n  /**\n   * @type {function(T): string}\n   * @private\n   */\n  this.keyFunction_ = keyFunction;\n\n  /**\n   * @type {Array.<T>}\n   * @private\n   */\n  this.elements_ = [];\n\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n  this.priorities_ = [];\n\n  /**\n   * @type {!Object.<string, boolean>}\n   * @private\n   */\n  this.queuedElements_ = {};\n\n};\n\n\n/**\n * @type {number}\n */\nexport const DROP = Infinity;\n\n\n/**\n * FIXME empty description for jsdoc\n */\nPriorityQueue.prototype.clear = function() {\n  this.elements_.length = 0;\n  this.priorities_.length = 0;\n  clear(this.queuedElements_);\n};\n\n\n/**\n * Remove and return the highest-priority element. O(log N).\n * @return {T} Element.\n */\nPriorityQueue.prototype.dequeue = function() {\n  const elements = this.elements_;\n  const priorities = this.priorities_;\n  const element = elements[0];\n  if (elements.length == 1) {\n    elements.length = 0;\n    priorities.length = 0;\n  } else {\n    elements[0] = elements.pop();\n    priorities[0] = priorities.pop();\n    this.siftUp_(0);\n  }\n  const elementKey = this.keyFunction_(element);\n  delete this.queuedElements_[elementKey];\n  return element;\n};\n\n\n/**\n * Enqueue an element. O(log N).\n * @param {T} element Element.\n * @return {boolean} The element was added to the queue.\n */\nPriorityQueue.prototype.enqueue = function(element) {\n  assert(!(this.keyFunction_(element) in this.queuedElements_),\n    31); // Tried to enqueue an `element` that was already added to the queue\n  const priority = this.priorityFunction_(element);\n  if (priority != DROP) {\n    this.elements_.push(element);\n    this.priorities_.push(priority);\n    this.queuedElements_[this.keyFunction_(element)] = true;\n    this.siftDown_(0, this.elements_.length - 1);\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * @return {number} Count.\n */\nPriorityQueue.prototype.getCount = function() {\n  return this.elements_.length;\n};\n\n\n/**\n * Gets the index of the left child of the node at the given index.\n * @param {number} index The index of the node to get the left child for.\n * @return {number} The index of the left child.\n * @private\n */\nPriorityQueue.prototype.getLeftChildIndex_ = function(index) {\n  return index * 2 + 1;\n};\n\n\n/**\n * Gets the index of the right child of the node at the given index.\n * @param {number} index The index of the node to get the right child for.\n * @return {number} The index of the right child.\n * @private\n */\nPriorityQueue.prototype.getRightChildIndex_ = function(index) {\n  return index * 2 + 2;\n};\n\n\n/**\n * Gets the index of the parent of the node at the given index.\n * @param {number} index The index of the node to get the parent for.\n * @return {number} The index of the parent.\n * @private\n */\nPriorityQueue.prototype.getParentIndex_ = function(index) {\n  return (index - 1) >> 1;\n};\n\n\n/**\n * Make this a heap. O(N).\n * @private\n */\nPriorityQueue.prototype.heapify_ = function() {\n  let i;\n  for (i = (this.elements_.length >> 1) - 1; i >= 0; i--) {\n    this.siftUp_(i);\n  }\n};\n\n\n/**\n * @return {boolean} Is empty.\n */\nPriorityQueue.prototype.isEmpty = function() {\n  return this.elements_.length === 0;\n};\n\n\n/**\n * @param {string} key Key.\n * @return {boolean} Is key queued.\n */\nPriorityQueue.prototype.isKeyQueued = function(key) {\n  return key in this.queuedElements_;\n};\n\n\n/**\n * @param {T} element Element.\n * @return {boolean} Is queued.\n */\nPriorityQueue.prototype.isQueued = function(element) {\n  return this.isKeyQueued(this.keyFunction_(element));\n};\n\n\n/**\n * @param {number} index The index of the node to move down.\n * @private\n */\nPriorityQueue.prototype.siftUp_ = function(index) {\n  const elements = this.elements_;\n  const priorities = this.priorities_;\n  const count = elements.length;\n  const element = elements[index];\n  const priority = priorities[index];\n  const startIndex = index;\n\n  while (index < (count >> 1)) {\n    const lIndex = this.getLeftChildIndex_(index);\n    const rIndex = this.getRightChildIndex_(index);\n\n    const smallerChildIndex = rIndex < count &&\n        priorities[rIndex] < priorities[lIndex] ?\n      rIndex : lIndex;\n\n    elements[index] = elements[smallerChildIndex];\n    priorities[index] = priorities[smallerChildIndex];\n    index = smallerChildIndex;\n  }\n\n  elements[index] = element;\n  priorities[index] = priority;\n  this.siftDown_(startIndex, index);\n};\n\n\n/**\n * @param {number} startIndex The index of the root.\n * @param {number} index The index of the node to move up.\n * @private\n */\nPriorityQueue.prototype.siftDown_ = function(startIndex, index) {\n  const elements = this.elements_;\n  const priorities = this.priorities_;\n  const element = elements[index];\n  const priority = priorities[index];\n\n  while (index > startIndex) {\n    const parentIndex = this.getParentIndex_(index);\n    if (priorities[parentIndex] > priority) {\n      elements[index] = elements[parentIndex];\n      priorities[index] = priorities[parentIndex];\n      index = parentIndex;\n    } else {\n      break;\n    }\n  }\n  elements[index] = element;\n  priorities[index] = priority;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nPriorityQueue.prototype.reprioritize = function() {\n  const priorityFunction = this.priorityFunction_;\n  const elements = this.elements_;\n  const priorities = this.priorities_;\n  let index = 0;\n  const n = elements.length;\n  let element, i, priority;\n  for (i = 0; i < n; ++i) {\n    element = elements[i];\n    priority = priorityFunction(element);\n    if (priority == DROP) {\n      delete this.queuedElements_[this.keyFunction_(element)];\n    } else {\n      priorities[index] = priority;\n      elements[index++] = element;\n    }\n  }\n  elements.length = index;\n  priorities.length = index;\n  this.heapify_();\n};\nexport default PriorityQueue;\n","/**\n * @module ol/TileQueue\n */\nimport {inherits} from './util.js';\nimport TileState from './TileState.js';\nimport {listen, unlisten} from './events.js';\nimport EventType from './events/EventType.js';\nimport PriorityQueue from './structs/PriorityQueue.js';\n\n\n/**\n * @typedef {function(module:ol/Tile, string, module:ol/coordinate~Coordinate, number): number} PriorityFunction\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/structs/PriorityQueue.<Array>}\n * @param {module:ol/TileQueue~PriorityFunction} tilePriorityFunction\n *     Tile priority function.\n * @param {function(): ?} tileChangeCallback\n *     Function called on each tile change event.\n * @struct\n */\nconst TileQueue = function(tilePriorityFunction, tileChangeCallback) {\n\n  PriorityQueue.call(\n    this,\n    /**\n     * @param {Array} element Element.\n     * @return {number} Priority.\n     */\n    function(element) {\n      return tilePriorityFunction.apply(null, element);\n    },\n    /**\n     * @param {Array} element Element.\n     * @return {string} Key.\n     */\n    function(element) {\n      return (/** @type {module:ol/Tile} */ (element[0]).getKey());\n    });\n\n  /**\n   * @private\n   * @type {function(): ?}\n   */\n  this.tileChangeCallback_ = tileChangeCallback;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.tilesLoading_ = 0;\n\n  /**\n   * @private\n   * @type {!Object.<string,boolean>}\n   */\n  this.tilesLoadingKeys_ = {};\n\n};\n\ninherits(TileQueue, PriorityQueue);\n\n\n/**\n * @inheritDoc\n */\nTileQueue.prototype.enqueue = function(element) {\n  const added = PriorityQueue.prototype.enqueue.call(this, element);\n  if (added) {\n    const tile = element[0];\n    listen(tile, EventType.CHANGE, this.handleTileChange, this);\n  }\n  return added;\n};\n\n\n/**\n * @return {number} Number of tiles loading.\n */\nTileQueue.prototype.getTilesLoading = function() {\n  return this.tilesLoading_;\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n * @protected\n */\nTileQueue.prototype.handleTileChange = function(event) {\n  const tile = /** @type {module:ol/Tile} */ (event.target);\n  const state = tile.getState();\n  if (state === TileState.LOADED || state === TileState.ERROR ||\n      state === TileState.EMPTY || state === TileState.ABORT) {\n    unlisten(tile, EventType.CHANGE, this.handleTileChange, this);\n    const tileKey = tile.getKey();\n    if (tileKey in this.tilesLoadingKeys_) {\n      delete this.tilesLoadingKeys_[tileKey];\n      --this.tilesLoading_;\n    }\n    this.tileChangeCallback_();\n  }\n};\n\n\n/**\n * @param {number} maxTotalLoading Maximum number tiles to load simultaneously.\n * @param {number} maxNewLoads Maximum number of new tiles to load.\n */\nTileQueue.prototype.loadMoreTiles = function(maxTotalLoading, maxNewLoads) {\n  let newLoads = 0;\n  let abortedTiles = false;\n  let state, tile, tileKey;\n  while (this.tilesLoading_ < maxTotalLoading && newLoads < maxNewLoads &&\n         this.getCount() > 0) {\n    tile = /** @type {module:ol/Tile} */ (this.dequeue()[0]);\n    tileKey = tile.getKey();\n    state = tile.getState();\n    if (state === TileState.ABORT) {\n      abortedTiles = true;\n    } else if (state === TileState.IDLE && !(tileKey in this.tilesLoadingKeys_)) {\n      this.tilesLoadingKeys_[tileKey] = true;\n      ++this.tilesLoading_;\n      ++newLoads;\n      tile.load();\n    }\n  }\n  if (newLoads === 0 && abortedTiles) {\n    // Do not stop the render loop when all wanted tiles were aborted due to\n    // a small, saturated tile cache.\n    this.tileChangeCallback_();\n  }\n};\nexport default TileQueue;\n","/**\n * @module ol/tilegrid/common\n */\n\n/**\n * Default maximum zoom for default tile grids.\n * @type {number}\n */\nexport const DEFAULT_MAX_ZOOM = 42;\n\n/**\n * Default tile size.\n * @type {number}\n */\nexport const DEFAULT_TILE_SIZE = 256;\n","/**\n * @module ol/centerconstraint\n */\nimport {clamp} from './math.js';\n\n\n/**\n * @typedef {function((module:ol/coordinate~Coordinate|undefined)): (module:ol/coordinate~Coordinate|undefined)} Type\n */\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {module:ol/centerconstraint~Type} The constraint.\n */\nexport function createExtent(extent) {\n  return (\n    /**\n     * @param {module:ol/coordinate~Coordinate=} center Center.\n     * @return {module:ol/coordinate~Coordinate|undefined} Center.\n     */\n    function(center) {\n      if (center) {\n        return [\n          clamp(center[0], extent[0], extent[2]),\n          clamp(center[1], extent[1], extent[3])\n        ];\n      } else {\n        return undefined;\n      }\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate=} center Center.\n * @return {module:ol/coordinate~Coordinate|undefined} Center.\n */\nexport function none(center) {\n  return center;\n}\n","/**\n * @module ol/rotationconstraint\n */\nimport {toRadians} from './math.js';\n\n\n/**\n * @typedef {function((number|undefined), number): (number|undefined)} Type\n */\n\n\n/**\n * @param {number|undefined} rotation Rotation.\n * @param {number} delta Delta.\n * @return {number|undefined} Rotation.\n */\nexport function disable(rotation, delta) {\n  if (rotation !== undefined) {\n    return 0;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {number|undefined} rotation Rotation.\n * @param {number} delta Delta.\n * @return {number|undefined} Rotation.\n */\nexport function none(rotation, delta) {\n  if (rotation !== undefined) {\n    return rotation + delta;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {number} n N.\n * @return {module:ol/rotationconstraint~Type} Rotation constraint.\n */\nexport function createSnapToN(n) {\n  const theta = 2 * Math.PI / n;\n  return (\n    /**\n     * @param {number|undefined} rotation Rotation.\n     * @param {number} delta Delta.\n     * @return {number|undefined} Rotation.\n     */\n    function(rotation, delta) {\n      if (rotation !== undefined) {\n        rotation = Math.floor((rotation + delta) / theta + 0.5) * theta;\n        return rotation;\n      } else {\n        return undefined;\n      }\n    });\n}\n\n\n/**\n * @param {number=} opt_tolerance Tolerance.\n * @return {module:ol/rotationconstraint~Type} Rotation constraint.\n */\nexport function createSnapToZero(opt_tolerance) {\n  const tolerance = opt_tolerance || toRadians(5);\n  return (\n    /**\n     * @param {number|undefined} rotation Rotation.\n     * @param {number} delta Delta.\n     * @return {number|undefined} Rotation.\n     */\n    function(rotation, delta) {\n      if (rotation !== undefined) {\n        if (Math.abs(rotation + delta) <= tolerance) {\n          return 0;\n        } else {\n          return rotation + delta;\n        }\n      } else {\n        return undefined;\n      }\n    });\n}\n","/**\n * @module ol/ViewHint\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  ANIMATING: 0,\n  INTERACTING: 1\n};\n","/**\n * @module ol/ViewProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  CENTER: 'center',\n  RESOLUTION: 'resolution',\n  ROTATION: 'rotation'\n};\n","/**\n * @module ol/View\n */\nimport {DEFAULT_TILE_SIZE} from './tilegrid/common.js';\nimport {getUid, inherits} from './util.js';\nimport {UNDEFINED} from './functions.js';\nimport {createExtent, none as centerNone} from './centerconstraint.js';\nimport BaseObject from './Object.js';\nimport {createSnapToResolutions, createSnapToPower} from './resolutionconstraint.js';\nimport {createSnapToZero, createSnapToN, none as rotationNone, disable} from './rotationconstraint.js';\nimport ViewHint from './ViewHint.js';\nimport ViewProperty from './ViewProperty.js';\nimport {linearFindNearest} from './array.js';\nimport {assert} from './asserts.js';\nimport {add as addCoordinate, rotate as rotateCoordinate, equals as coordinatesEqual} from './coordinate.js';\nimport {inAndOut} from './easing.js';\nimport {getForViewAndSize, getCenter, getHeight, getWidth, isEmpty} from './extent.js';\nimport GeometryType from './geom/GeometryType.js';\nimport {fromExtent as polygonFromExtent} from './geom/Polygon.js';\nimport SimpleGeometry from './geom/SimpleGeometry.js';\nimport {clamp, modulo} from './math.js';\nimport {assign} from './obj.js';\nimport {createProjection, METERS_PER_UNIT} from './proj.js';\nimport Units from './proj/Units.js';\n\n\n/**\n * An animation configuration\n *\n * @typedef {Object} Animation\n * @property {module:ol/coordinate~Coordinate} [sourceCenter]\n * @property {module:ol/coordinate~Coordinate} [targetCenter]\n * @property {number} [sourceResolution]\n * @property {number} [targetResolution]\n * @property {number} [sourceRotation]\n * @property {number} [sourceRotation]\n * @property {module:ol/coordinate~Coordinate} [anchor]\n * @property {number} start\n * @property {number} duration\n * @property {boolean} complete\n * @property {function(number):number} easing\n * @property {function(boolean)} callback\n */\n\n\n/**\n * @typedef {Object} Constraints\n * @property {module:ol/centerconstraint~Type} center\n * @property {module:ol/resolutionconstraint~Type} resolution\n * @property {module:ol/rotationconstraint~Type} rotation\n */\n\n\n/**\n * @typedef {Object} FitOptions\n * @property {module:ol/size~Size} [size] The size in pixels of the box to fit\n * the extent into. Default is the current size of the first map in the DOM that\n * uses this view, or `[100, 100]` if no such map is found.\n * @property {!Array.<number>} [padding=[0, 0, 0, 0]] Padding (in pixels) to be\n * cleared inside the view. Values in the array are top, right, bottom and left\n * padding.\n * @property {boolean} [constrainResolution=true] Constrain the resolution.\n * @property {boolean} [nearest=false] If `constrainResolution` is `true`, get\n * the nearest extent instead of the closest that actually fits the view.\n * @property {number} [minResolution=0] Minimum resolution that we zoom to.\n * @property {number} [maxZoom] Maximum zoom level that we zoom to. If\n * `minResolution` is given, this property is ignored.\n * @property {number} [duration] The duration of the animation in milliseconds.\n * By default, there is no animation to the target extent.\n * @property {function(number):number} [easing] The easing function used during\n * the animation (defaults to {@link module:ol/easing~inAndOut}).\n * The function will be called for each frame with a number representing a\n * fraction of the animation's duration.  The function should return a number\n * between 0 and 1 representing the progress toward the destination state.\n * @property {function(boolean)} [callback] Function called when the view is in\n * its final position. The callback will be called with `true` if the animation\n * series completed on its own or `false` if it was cancelled.\n */\n\n\n/**\n * @typedef {Object} ViewOptions\n * @property {module:ol/coordinate~Coordinate} [center] The initial center for\n * the view. The coordinate system for the center is specified with the\n * `projection` option. Layer sources will not be fetched if this is not set,\n * but the center can be set later with {@link #setCenter}.\n * @property {boolean|number} [constrainRotation=true] Rotation constraint.\n * `false` means no constraint. `true` means no constraint, but snap to zero\n * near zero. A number constrains the rotation to that number of values. For\n * example, `4` will constrain the rotation to 0, 90, 180, and 270 degrees.\n * @property {boolean} [enableRotation=true] Enable rotation.\n * If `false`, a rotation constraint that always sets the rotation to zero is\n * used. The `constrainRotation` option has no effect if `enableRotation` is\n * `false`.\n * @property {module:ol/extent~Extent} [extent] The extent that constrains the\n * center, in other words, center cannot be set outside this extent.\n * @property {number} [maxResolution] The maximum resolution used to determine\n * the resolution constraint. It is used together with `minResolution` (or\n * `maxZoom`) and `zoomFactor`. If unspecified it is calculated in such a way\n * that the projection's validity extent fits in a 256x256 px tile. If the\n * projection is Spherical Mercator (the default) then `maxResolution` defaults\n * to `40075016.68557849 / 256 = 156543.03392804097`.\n * @property {number} [minResolution] The minimum resolution used to determine\n * the resolution constraint.  It is used together with `maxResolution` (or\n * `minZoom`) and `zoomFactor`.  If unspecified it is calculated assuming 29\n * zoom levels (with a factor of 2). If the projection is Spherical Mercator\n * (the default) then `minResolution` defaults to\n * `40075016.68557849 / 256 / Math.pow(2, 28) = 0.0005831682455839253`.\n * @property {number} [maxZoom=28] The maximum zoom level used to determine the\n * resolution constraint. It is used together with `minZoom` (or\n * `maxResolution`) and `zoomFactor`.  Note that if `minResolution` is also\n * provided, it is given precedence over `maxZoom`.\n * @property {number} [minZoom=0] The minimum zoom level used to determine the\n * resolution constraint. It is used together with `maxZoom` (or\n * `minResolution`) and `zoomFactor`.  Note that if `maxResolution` is also\n * provided, it is given precedence over `minZoom`.\n * @property {module:ol/proj~ProjectionLike} [projection='EPSG:3857'] The\n * projection. The default is Spherical Mercator.\n * @property {number} [resolution] The initial resolution for the view. The\n * units are `projection` units per pixel (e.g. meters per pixel). An\n * alternative to setting this is to set `zoom`. Layer sources will not be\n * fetched if neither this nor `zoom` are defined, but they can be set later\n * with {@link #setZoom} or {@link #setResolution}.\n * @property {Array.<number>} [resolutions] Resolutions to determine the\n * resolution constraint. If set the `maxResolution`, `minResolution`,\n * `minZoom`, `maxZoom`, and `zoomFactor` options are ignored.\n * @property {number} [rotation=0] The initial rotation for the view in radians\n * (positive rotation clockwise, 0 means North).\n * @property {number} [zoom] Only used if `resolution` is not defined. Zoom\n * level used to calculate the initial resolution for the view. The initial\n * resolution is determined using the {@link #constrainResolution} method.\n * @property {number} [zoomFactor=2] The zoom factor used to determine the\n * resolution constraint.\n */\n\n\n/**\n * @typedef {Object} AnimationOptions\n * @property {module:ol/coordinate~Coordinate|undefined} center The center of the view at the end of\n * the animation.\n * @property {number|undefined} zoom The zoom level of the view at the end of the\n * animation. This takes precedence over `resolution`.\n * @property {number|undefined} resolution The resolution of the view at the end\n * of the animation.  If `zoom` is also provided, this option will be ignored.\n * @property {number|undefined} rotation The rotation of the view at the end of\n * the animation.\n * @property {module:ol/coordinate~Coordinate|undefined} anchor Optional anchor to remained fixed\n * during a rotation or resolution animation.\n * @property {number} [duration=1000] The duration of the animation in milliseconds.\n * @property {function(number):number} [easing] The easing function used\n * during the animation (defaults to {@link module:ol/easing~inAndOut}).\n * The function will be called for each frame with a number representing a\n * fraction of the animation's duration.  The function should return a number\n * between 0 and 1 representing the progress toward the destination state.\n */\n\n\n/**\n * @typedef {Object} State\n * @property {module:ol/coordinate~Coordinate} center\n * @property {module:ol/proj/Projection} projection\n * @property {number} resolution\n * @property {number} rotation\n * @property {number} zoom\n */\n\n\n/**\n * Default min zoom level for the map view.\n * @type {number}\n */\nconst DEFAULT_MIN_ZOOM = 0;\n\n\n/**\n * @classdesc\n * A View object represents a simple 2D view of the map.\n *\n * This is the object to act upon to change the center, resolution,\n * and rotation of the map.\n *\n * ### The view states\n *\n * An View is determined by three states: `center`, `resolution`,\n * and `rotation`. Each state has a corresponding getter and setter, e.g.\n * `getCenter` and `setCenter` for the `center` state.\n *\n * An View has a `projection`. The projection determines the\n * coordinate system of the center, and its units determine the units of the\n * resolution (projection units per pixel). The default projection is\n * Spherical Mercator (EPSG:3857).\n *\n * ### The constraints\n *\n * `setCenter`, `setResolution` and `setRotation` can be used to change the\n * states of the view. Any value can be passed to the setters. And the value\n * that is passed to a setter will effectively be the value set in the view,\n * and returned by the corresponding getter.\n *\n * But a View object also has a *resolution constraint*, a\n * *rotation constraint* and a *center constraint*.\n *\n * As said above, no constraints are applied when the setters are used to set\n * new states for the view. Applying constraints is done explicitly through\n * the use of the `constrain*` functions (`constrainResolution` and\n * `constrainRotation` and `constrainCenter`).\n *\n * The main users of the constraints are the interactions and the\n * controls. For example, double-clicking on the map changes the view to\n * the \"next\" resolution. And releasing the fingers after pinch-zooming\n * snaps to the closest resolution (with an animation).\n *\n * The *resolution constraint* snaps to specific resolutions. It is\n * determined by the following options: `resolutions`, `maxResolution`,\n * `maxZoom`, and `zoomFactor`. If `resolutions` is set, the other three\n * options are ignored. See documentation for each option for more\n * information.\n *\n * The *rotation constraint* snaps to specific angles. It is determined\n * by the following options: `enableRotation` and `constrainRotation`.\n * By default the rotation value is snapped to zero when approaching the\n * horizontal.\n *\n * The *center constraint* is determined by the `extent` option. By\n * default the center is not constrained at all.\n *\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/View~ViewOptions=} opt_options View options.\n * @api\n */\nconst View = function(opt_options) {\n  BaseObject.call(this);\n\n  const options = assign({}, opt_options);\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.hints_ = [0, 0];\n\n  /**\n   * @private\n   * @type {Array.<Array.<module:ol/View~Animation>>}\n   */\n  this.animations_ = [];\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.updateAnimationKey_;\n\n  this.updateAnimations_ = this.updateAnimations_.bind(this);\n\n  /**\n   * @private\n   * @const\n   * @type {module:ol/proj/Projection}\n   */\n  this.projection_ = createProjection(options.projection, 'EPSG:3857');\n\n  this.applyOptions_(options);\n};\n\ninherits(View, BaseObject);\n\n\n/**\n * Set up the view with the given options.\n * @param {module:ol/View~ViewOptions} options View options.\n */\nView.prototype.applyOptions_ = function(options) {\n\n  /**\n   * @type {Object.<string, *>}\n   */\n  const properties = {};\n  properties[ViewProperty.CENTER] = options.center !== undefined ?\n    options.center : null;\n\n  const resolutionConstraintInfo = createResolutionConstraint(options);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxResolution_ = resolutionConstraintInfo.maxResolution;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minResolution_ = resolutionConstraintInfo.minResolution;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.zoomFactor_ = resolutionConstraintInfo.zoomFactor;\n\n  /**\n   * @private\n   * @type {Array.<number>|undefined}\n   */\n  this.resolutions_ = options.resolutions;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minZoom_ = resolutionConstraintInfo.minZoom;\n\n  const centerConstraint = createCenterConstraint(options);\n  const resolutionConstraint = resolutionConstraintInfo.constraint;\n  const rotationConstraint = createRotationConstraint(options);\n\n  /**\n   * @private\n   * @type {module:ol/View~Constraints}\n   */\n  this.constraints_ = {\n    center: centerConstraint,\n    resolution: resolutionConstraint,\n    rotation: rotationConstraint\n  };\n\n  if (options.resolution !== undefined) {\n    properties[ViewProperty.RESOLUTION] = options.resolution;\n  } else if (options.zoom !== undefined) {\n    properties[ViewProperty.RESOLUTION] = this.constrainResolution(\n      this.maxResolution_, options.zoom - this.minZoom_);\n\n    if (this.resolutions_) { // in case map zoom is out of min/max zoom range\n      properties[ViewProperty.RESOLUTION] = clamp(\n        Number(this.getResolution() || properties[ViewProperty.RESOLUTION]),\n        this.minResolution_, this.maxResolution_);\n    }\n  }\n  properties[ViewProperty.ROTATION] = options.rotation !== undefined ? options.rotation : 0;\n  this.setProperties(properties);\n\n  /**\n   * @private\n   * @type {module:ol/View~ViewOptions}\n   */\n  this.options_ = options;\n\n};\n\n/**\n * Get an updated version of the view options used to construct the view.  The\n * current resolution (or zoom), center, and rotation are applied to any stored\n * options.  The provided options can be used to apply new min/max zoom or\n * resolution limits.\n * @param {module:ol/View~ViewOptions} newOptions New options to be applied.\n * @return {module:ol/View~ViewOptions} New options updated with the current view state.\n */\nView.prototype.getUpdatedOptions_ = function(newOptions) {\n  const options = assign({}, this.options_);\n\n  // preserve resolution (or zoom)\n  if (options.resolution !== undefined) {\n    options.resolution = this.getResolution();\n  } else {\n    options.zoom = this.getZoom();\n  }\n\n  // preserve center\n  options.center = this.getCenter();\n\n  // preserve rotation\n  options.rotation = this.getRotation();\n\n  return assign({}, options, newOptions);\n};\n\n\n/**\n * Animate the view.  The view's center, zoom (or resolution), and rotation\n * can be animated for smooth transitions between view states.  For example,\n * to animate the view to a new zoom level:\n *\n *     view.animate({zoom: view.getZoom() + 1});\n *\n * By default, the animation lasts one second and uses in-and-out easing.  You\n * can customize this behavior by including `duration` (in milliseconds) and\n * `easing` options (see {@link module:ol/easing}).\n *\n * To chain together multiple animations, call the method with multiple\n * animation objects.  For example, to first zoom and then pan:\n *\n *     view.animate({zoom: 10}, {center: [0, 0]});\n *\n * If you provide a function as the last argument to the animate method, it\n * will get called at the end of an animation series.  The callback will be\n * called with `true` if the animation series completed on its own or `false`\n * if it was cancelled.\n *\n * Animations are cancelled by user interactions (e.g. dragging the map) or by\n * calling `view.setCenter()`, `view.setResolution()`, or `view.setRotation()`\n * (or another method that calls one of these).\n *\n * @param {...(module:ol/View~AnimationOptions|function(boolean))} var_args Animation\n *     options.  Multiple animations can be run in series by passing multiple\n *     options objects.  To run multiple animations in parallel, call the method\n *     multiple times.  An optional callback can be provided as a final\n *     argument.  The callback will be called with a boolean indicating whether\n *     the animation completed without being cancelled.\n * @api\n */\nView.prototype.animate = function(var_args) {\n  let animationCount = arguments.length;\n  let callback;\n  if (animationCount > 1 && typeof arguments[animationCount - 1] === 'function') {\n    callback = arguments[animationCount - 1];\n    --animationCount;\n  }\n  if (!this.isDef()) {\n    // if view properties are not yet set, shortcut to the final state\n    const state = arguments[animationCount - 1];\n    if (state.center) {\n      this.setCenter(state.center);\n    }\n    if (state.zoom !== undefined) {\n      this.setZoom(state.zoom);\n    }\n    if (state.rotation !== undefined) {\n      this.setRotation(state.rotation);\n    }\n    if (callback) {\n      setTimeout(function() {\n        callback(true);\n      }, 0);\n    }\n    return;\n  }\n  let start = Date.now();\n  let center = this.getCenter().slice();\n  let resolution = this.getResolution();\n  let rotation = this.getRotation();\n  const series = [];\n  for (let i = 0; i < animationCount; ++i) {\n    const options = /** @type {module:ol/View~AnimationOptions} */ (arguments[i]);\n\n    const animation = /** @type {module:ol/View~Animation} */ ({\n      start: start,\n      complete: false,\n      anchor: options.anchor,\n      duration: options.duration !== undefined ? options.duration : 1000,\n      easing: options.easing || inAndOut\n    });\n\n    if (options.center) {\n      animation.sourceCenter = center;\n      animation.targetCenter = options.center;\n      center = animation.targetCenter;\n    }\n\n    if (options.zoom !== undefined) {\n      animation.sourceResolution = resolution;\n      animation.targetResolution = this.constrainResolution(\n        this.maxResolution_, options.zoom - this.minZoom_, 0);\n      resolution = animation.targetResolution;\n    } else if (options.resolution) {\n      animation.sourceResolution = resolution;\n      animation.targetResolution = options.resolution;\n      resolution = animation.targetResolution;\n    }\n\n    if (options.rotation !== undefined) {\n      animation.sourceRotation = rotation;\n      const delta = modulo(options.rotation - rotation + Math.PI, 2 * Math.PI) - Math.PI;\n      animation.targetRotation = rotation + delta;\n      rotation = animation.targetRotation;\n    }\n\n    animation.callback = callback;\n\n    // check if animation is a no-op\n    if (isNoopAnimation(animation)) {\n      animation.complete = true;\n      // we still push it onto the series for callback handling\n    } else {\n      start += animation.duration;\n    }\n    series.push(animation);\n  }\n  this.animations_.push(series);\n  this.setHint(ViewHint.ANIMATING, 1);\n  this.updateAnimations_();\n};\n\n\n/**\n * Determine if the view is being animated.\n * @return {boolean} The view is being animated.\n * @api\n */\nView.prototype.getAnimating = function() {\n  return this.hints_[ViewHint.ANIMATING] > 0;\n};\n\n\n/**\n * Determine if the user is interacting with the view, such as panning or zooming.\n * @return {boolean} The view is being interacted with.\n * @api\n */\nView.prototype.getInteracting = function() {\n  return this.hints_[ViewHint.INTERACTING] > 0;\n};\n\n\n/**\n * Cancel any ongoing animations.\n * @api\n */\nView.prototype.cancelAnimations = function() {\n  this.setHint(ViewHint.ANIMATING, -this.hints_[ViewHint.ANIMATING]);\n  for (let i = 0, ii = this.animations_.length; i < ii; ++i) {\n    const series = this.animations_[i];\n    if (series[0].callback) {\n      series[0].callback(false);\n    }\n  }\n  this.animations_.length = 0;\n};\n\n/**\n * Update all animations.\n */\nView.prototype.updateAnimations_ = function() {\n  if (this.updateAnimationKey_ !== undefined) {\n    cancelAnimationFrame(this.updateAnimationKey_);\n    this.updateAnimationKey_ = undefined;\n  }\n  if (!this.getAnimating()) {\n    return;\n  }\n  const now = Date.now();\n  let more = false;\n  for (let i = this.animations_.length - 1; i >= 0; --i) {\n    const series = this.animations_[i];\n    let seriesComplete = true;\n    for (let j = 0, jj = series.length; j < jj; ++j) {\n      const animation = series[j];\n      if (animation.complete) {\n        continue;\n      }\n      const elapsed = now - animation.start;\n      let fraction = animation.duration > 0 ? elapsed / animation.duration : 1;\n      if (fraction >= 1) {\n        animation.complete = true;\n        fraction = 1;\n      } else {\n        seriesComplete = false;\n      }\n      const progress = animation.easing(fraction);\n      if (animation.sourceCenter) {\n        const x0 = animation.sourceCenter[0];\n        const y0 = animation.sourceCenter[1];\n        const x1 = animation.targetCenter[0];\n        const y1 = animation.targetCenter[1];\n        const x = x0 + progress * (x1 - x0);\n        const y = y0 + progress * (y1 - y0);\n        this.set(ViewProperty.CENTER, [x, y]);\n      }\n      if (animation.sourceResolution && animation.targetResolution) {\n        const resolution = progress === 1 ?\n          animation.targetResolution :\n          animation.sourceResolution + progress * (animation.targetResolution - animation.sourceResolution);\n        if (animation.anchor) {\n          this.set(ViewProperty.CENTER,\n            this.calculateCenterZoom(resolution, animation.anchor));\n        }\n        this.set(ViewProperty.RESOLUTION, resolution);\n      }\n      if (animation.sourceRotation !== undefined && animation.targetRotation !== undefined) {\n        const rotation = progress === 1 ?\n          modulo(animation.targetRotation + Math.PI, 2 * Math.PI) - Math.PI :\n          animation.sourceRotation + progress * (animation.targetRotation - animation.sourceRotation);\n        if (animation.anchor) {\n          this.set(ViewProperty.CENTER,\n            this.calculateCenterRotate(rotation, animation.anchor));\n        }\n        this.set(ViewProperty.ROTATION, rotation);\n      }\n      more = true;\n      if (!animation.complete) {\n        break;\n      }\n    }\n    if (seriesComplete) {\n      this.animations_[i] = null;\n      this.setHint(ViewHint.ANIMATING, -1);\n      const callback = series[0].callback;\n      if (callback) {\n        setTimeout(function() {\n          callback(true);\n        }, 0);\n      }\n    }\n  }\n  // prune completed series\n  this.animations_ = this.animations_.filter(Boolean);\n  if (more && this.updateAnimationKey_ === undefined) {\n    this.updateAnimationKey_ = requestAnimationFrame(this.updateAnimations_);\n  }\n};\n\n/**\n * @param {number} rotation Target rotation.\n * @param {module:ol/coordinate~Coordinate} anchor Rotation anchor.\n * @return {module:ol/coordinate~Coordinate|undefined} Center for rotation and anchor.\n */\nView.prototype.calculateCenterRotate = function(rotation, anchor) {\n  let center;\n  const currentCenter = this.getCenter();\n  if (currentCenter !== undefined) {\n    center = [currentCenter[0] - anchor[0], currentCenter[1] - anchor[1]];\n    rotateCoordinate(center, rotation - this.getRotation());\n    addCoordinate(center, anchor);\n  }\n  return center;\n};\n\n\n/**\n * @param {number} resolution Target resolution.\n * @param {module:ol/coordinate~Coordinate} anchor Zoom anchor.\n * @return {module:ol/coordinate~Coordinate|undefined} Center for resolution and anchor.\n */\nView.prototype.calculateCenterZoom = function(resolution, anchor) {\n  let center;\n  const currentCenter = this.getCenter();\n  const currentResolution = this.getResolution();\n  if (currentCenter !== undefined && currentResolution !== undefined) {\n    const x = anchor[0] - resolution * (anchor[0] - currentCenter[0]) / currentResolution;\n    const y = anchor[1] - resolution * (anchor[1] - currentCenter[1]) / currentResolution;\n    center = [x, y];\n  }\n  return center;\n};\n\n\n/**\n * @private\n * @return {module:ol/size~Size} Viewport size or `[100, 100]` when no viewport is found.\n */\nView.prototype.getSizeFromViewport_ = function() {\n  const size = [100, 100];\n  const selector = '.ol-viewport[data-view=\"' + getUid(this) + '\"]';\n  const element = document.querySelector(selector);\n  if (element) {\n    const metrics = getComputedStyle(element);\n    size[0] = parseInt(metrics.width, 10);\n    size[1] = parseInt(metrics.height, 10);\n  }\n  return size;\n};\n\n\n/**\n * Get the constrained center of this view.\n * @param {module:ol/coordinate~Coordinate|undefined} center Center.\n * @return {module:ol/coordinate~Coordinate|undefined} Constrained center.\n * @api\n */\nView.prototype.constrainCenter = function(center) {\n  return this.constraints_.center(center);\n};\n\n\n/**\n * Get the constrained resolution of this view.\n * @param {number|undefined} resolution Resolution.\n * @param {number=} opt_delta Delta. Default is `0`.\n * @param {number=} opt_direction Direction. Default is `0`.\n * @return {number|undefined} Constrained resolution.\n * @api\n */\nView.prototype.constrainResolution = function(resolution, opt_delta, opt_direction) {\n  const delta = opt_delta || 0;\n  const direction = opt_direction || 0;\n  return this.constraints_.resolution(resolution, delta, direction);\n};\n\n\n/**\n * Get the constrained rotation of this view.\n * @param {number|undefined} rotation Rotation.\n * @param {number=} opt_delta Delta. Default is `0`.\n * @return {number|undefined} Constrained rotation.\n * @api\n */\nView.prototype.constrainRotation = function(rotation, opt_delta) {\n  const delta = opt_delta || 0;\n  return this.constraints_.rotation(rotation, delta);\n};\n\n\n/**\n * Get the view center.\n * @return {module:ol/coordinate~Coordinate|undefined} The center of the view.\n * @observable\n * @api\n */\nView.prototype.getCenter = function() {\n  return (\n    /** @type {module:ol/coordinate~Coordinate|undefined} */ (this.get(ViewProperty.CENTER))\n  );\n};\n\n\n/**\n * @return {module:ol/View~Constraints} Constraints.\n */\nView.prototype.getConstraints = function() {\n  return this.constraints_;\n};\n\n\n/**\n * @param {Array.<number>=} opt_hints Destination array.\n * @return {Array.<number>} Hint.\n */\nView.prototype.getHints = function(opt_hints) {\n  if (opt_hints !== undefined) {\n    opt_hints[0] = this.hints_[0];\n    opt_hints[1] = this.hints_[1];\n    return opt_hints;\n  } else {\n    return this.hints_.slice();\n  }\n};\n\n\n/**\n * Calculate the extent for the current view state and the passed size.\n * The size is the pixel dimensions of the box into which the calculated extent\n * should fit. In most cases you want to get the extent of the entire map,\n * that is `map.getSize()`.\n * @param {module:ol/size~Size=} opt_size Box pixel size. If not provided, the size of the\n * first map that uses this view will be used.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nView.prototype.calculateExtent = function(opt_size) {\n  const size = opt_size || this.getSizeFromViewport_();\n  const center = /** @type {!module:ol/coordinate~Coordinate} */ (this.getCenter());\n  assert(center, 1); // The view center is not defined\n  const resolution = /** @type {!number} */ (this.getResolution());\n  assert(resolution !== undefined, 2); // The view resolution is not defined\n  const rotation = /** @type {!number} */ (this.getRotation());\n  assert(rotation !== undefined, 3); // The view rotation is not defined\n\n  return getForViewAndSize(center, resolution, rotation, size);\n};\n\n\n/**\n * Get the maximum resolution of the view.\n * @return {number} The maximum resolution of the view.\n * @api\n */\nView.prototype.getMaxResolution = function() {\n  return this.maxResolution_;\n};\n\n\n/**\n * Get the minimum resolution of the view.\n * @return {number} The minimum resolution of the view.\n * @api\n */\nView.prototype.getMinResolution = function() {\n  return this.minResolution_;\n};\n\n\n/**\n * Get the maximum zoom level for the view.\n * @return {number} The maximum zoom level.\n * @api\n */\nView.prototype.getMaxZoom = function() {\n  return /** @type {number} */ (this.getZoomForResolution(this.minResolution_));\n};\n\n\n/**\n * Set a new maximum zoom level for the view.\n * @param {number} zoom The maximum zoom level.\n * @api\n */\nView.prototype.setMaxZoom = function(zoom) {\n  this.applyOptions_(this.getUpdatedOptions_({maxZoom: zoom}));\n};\n\n\n/**\n * Get the minimum zoom level for the view.\n * @return {number} The minimum zoom level.\n * @api\n */\nView.prototype.getMinZoom = function() {\n  return /** @type {number} */ (this.getZoomForResolution(this.maxResolution_));\n};\n\n\n/**\n * Set a new minimum zoom level for the view.\n * @param {number} zoom The minimum zoom level.\n * @api\n */\nView.prototype.setMinZoom = function(zoom) {\n  this.applyOptions_(this.getUpdatedOptions_({minZoom: zoom}));\n};\n\n\n/**\n * Get the view projection.\n * @return {module:ol/proj/Projection} The projection of the view.\n * @api\n */\nView.prototype.getProjection = function() {\n  return this.projection_;\n};\n\n\n/**\n * Get the view resolution.\n * @return {number|undefined} The resolution of the view.\n * @observable\n * @api\n */\nView.prototype.getResolution = function() {\n  return /** @type {number|undefined} */ (this.get(ViewProperty.RESOLUTION));\n};\n\n\n/**\n * Get the resolutions for the view. This returns the array of resolutions\n * passed to the constructor of the View, or undefined if none were given.\n * @return {Array.<number>|undefined} The resolutions of the view.\n * @api\n */\nView.prototype.getResolutions = function() {\n  return this.resolutions_;\n};\n\n\n/**\n * Get the resolution for a provided extent (in map units) and size (in pixels).\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/size~Size=} opt_size Box pixel size.\n * @return {number} The resolution at which the provided extent will render at\n *     the given size.\n * @api\n */\nView.prototype.getResolutionForExtent = function(extent, opt_size) {\n  const size = opt_size || this.getSizeFromViewport_();\n  const xResolution = getWidth(extent) / size[0];\n  const yResolution = getHeight(extent) / size[1];\n  return Math.max(xResolution, yResolution);\n};\n\n\n/**\n * Return a function that returns a value between 0 and 1 for a\n * resolution. Exponential scaling is assumed.\n * @param {number=} opt_power Power.\n * @return {function(number): number} Resolution for value function.\n */\nView.prototype.getResolutionForValueFunction = function(opt_power) {\n  const power = opt_power || 2;\n  const maxResolution = this.maxResolution_;\n  const minResolution = this.minResolution_;\n  const max = Math.log(maxResolution / minResolution) / Math.log(power);\n  return (\n    /**\n     * @param {number} value Value.\n     * @return {number} Resolution.\n     */\n    function(value) {\n      const resolution = maxResolution / Math.pow(power, value * max);\n      return resolution;\n    });\n};\n\n\n/**\n * Get the view rotation.\n * @return {number} The rotation of the view in radians.\n * @observable\n * @api\n */\nView.prototype.getRotation = function() {\n  return /** @type {number} */ (this.get(ViewProperty.ROTATION));\n};\n\n\n/**\n * Return a function that returns a resolution for a value between\n * 0 and 1. Exponential scaling is assumed.\n * @param {number=} opt_power Power.\n * @return {function(number): number} Value for resolution function.\n */\nView.prototype.getValueForResolutionFunction = function(opt_power) {\n  const power = opt_power || 2;\n  const maxResolution = this.maxResolution_;\n  const minResolution = this.minResolution_;\n  const max = Math.log(maxResolution / minResolution) / Math.log(power);\n  return (\n    /**\n     * @param {number} resolution Resolution.\n     * @return {number} Value.\n     */\n    function(resolution) {\n      const value = (Math.log(maxResolution / resolution) / Math.log(power)) / max;\n      return value;\n    });\n};\n\n\n/**\n * @return {module:ol/View~State} View state.\n */\nView.prototype.getState = function() {\n  const center = /** @type {module:ol/coordinate~Coordinate} */ (this.getCenter());\n  const projection = this.getProjection();\n  const resolution = /** @type {number} */ (this.getResolution());\n  const rotation = this.getRotation();\n  return (\n    /** @type {module:ol/View~State} */ ({\n      center: center.slice(),\n      projection: projection !== undefined ? projection : null,\n      resolution: resolution,\n      rotation: rotation,\n      zoom: this.getZoom()\n    })\n  );\n};\n\n\n/**\n * Get the current zoom level.  If you configured your view with a resolutions\n * array (this is rare), this method may return non-integer zoom levels (so\n * the zoom level is not safe to use as an index into a resolutions array).\n * @return {number|undefined} Zoom.\n * @api\n */\nView.prototype.getZoom = function() {\n  let zoom;\n  const resolution = this.getResolution();\n  if (resolution !== undefined) {\n    zoom = this.getZoomForResolution(resolution);\n  }\n  return zoom;\n};\n\n\n/**\n * Get the zoom level for a resolution.\n * @param {number} resolution The resolution.\n * @return {number|undefined} The zoom level for the provided resolution.\n * @api\n */\nView.prototype.getZoomForResolution = function(resolution) {\n  let offset = this.minZoom_ || 0;\n  let max, zoomFactor;\n  if (this.resolutions_) {\n    const nearest = linearFindNearest(this.resolutions_, resolution, 1);\n    offset = nearest;\n    max = this.resolutions_[nearest];\n    if (nearest == this.resolutions_.length - 1) {\n      zoomFactor = 2;\n    } else {\n      zoomFactor = max / this.resolutions_[nearest + 1];\n    }\n  } else {\n    max = this.maxResolution_;\n    zoomFactor = this.zoomFactor_;\n  }\n  return offset + Math.log(max / resolution) / Math.log(zoomFactor);\n};\n\n\n/**\n * Get the resolution for a zoom level.\n * @param {number} zoom Zoom level.\n * @return {number} The view resolution for the provided zoom level.\n * @api\n */\nView.prototype.getResolutionForZoom = function(zoom) {\n  return /** @type {number} */ (this.constrainResolution(\n    this.maxResolution_, zoom - this.minZoom_, 0));\n};\n\n\n/**\n * Fit the given geometry or extent based on the given map size and border.\n * The size is pixel dimensions of the box to fit the extent into.\n * In most cases you will want to use the map size, that is `map.getSize()`.\n * Takes care of the map angle.\n * @param {module:ol/geom/SimpleGeometry|module:ol/extent~Extent} geometryOrExtent The geometry or\n *     extent to fit the view to.\n * @param {module:ol/View~FitOptions=} opt_options Options.\n * @api\n */\nView.prototype.fit = function(geometryOrExtent, opt_options) {\n  const options = opt_options || {};\n  let size = options.size;\n  if (!size) {\n    size = this.getSizeFromViewport_();\n  }\n  /** @type {module:ol/geom/SimpleGeometry} */\n  let geometry;\n  if (!(geometryOrExtent instanceof SimpleGeometry)) {\n    assert(Array.isArray(geometryOrExtent),\n      24); // Invalid extent or geometry provided as `geometry`\n    assert(!isEmpty(geometryOrExtent),\n      25); // Cannot fit empty extent provided as `geometry`\n    geometry = polygonFromExtent(geometryOrExtent);\n  } else if (geometryOrExtent.getType() === GeometryType.CIRCLE) {\n    geometryOrExtent = geometryOrExtent.getExtent();\n    geometry = polygonFromExtent(geometryOrExtent);\n    geometry.rotate(this.getRotation(), getCenter(geometryOrExtent));\n  } else {\n    geometry = geometryOrExtent;\n  }\n\n  const padding = options.padding !== undefined ? options.padding : [0, 0, 0, 0];\n  const constrainResolution = options.constrainResolution !== undefined ?\n    options.constrainResolution : true;\n  const nearest = options.nearest !== undefined ? options.nearest : false;\n  let minResolution;\n  if (options.minResolution !== undefined) {\n    minResolution = options.minResolution;\n  } else if (options.maxZoom !== undefined) {\n    minResolution = this.constrainResolution(\n      this.maxResolution_, options.maxZoom - this.minZoom_, 0);\n  } else {\n    minResolution = 0;\n  }\n  const coords = geometry.getFlatCoordinates();\n\n  // calculate rotated extent\n  const rotation = this.getRotation();\n  const cosAngle = Math.cos(-rotation);\n  let sinAngle = Math.sin(-rotation);\n  let minRotX = +Infinity;\n  let minRotY = +Infinity;\n  let maxRotX = -Infinity;\n  let maxRotY = -Infinity;\n  const stride = geometry.getStride();\n  for (let i = 0, ii = coords.length; i < ii; i += stride) {\n    const rotX = coords[i] * cosAngle - coords[i + 1] * sinAngle;\n    const rotY = coords[i] * sinAngle + coords[i + 1] * cosAngle;\n    minRotX = Math.min(minRotX, rotX);\n    minRotY = Math.min(minRotY, rotY);\n    maxRotX = Math.max(maxRotX, rotX);\n    maxRotY = Math.max(maxRotY, rotY);\n  }\n\n  // calculate resolution\n  let resolution = this.getResolutionForExtent(\n    [minRotX, minRotY, maxRotX, maxRotY],\n    [size[0] - padding[1] - padding[3], size[1] - padding[0] - padding[2]]);\n  resolution = isNaN(resolution) ? minResolution :\n    Math.max(resolution, minResolution);\n  if (constrainResolution) {\n    let constrainedResolution = this.constrainResolution(resolution, 0, 0);\n    if (!nearest && constrainedResolution < resolution) {\n      constrainedResolution = this.constrainResolution(\n        constrainedResolution, -1, 0);\n    }\n    resolution = constrainedResolution;\n  }\n\n  // calculate center\n  sinAngle = -sinAngle; // go back to original rotation\n  let centerRotX = (minRotX + maxRotX) / 2;\n  let centerRotY = (minRotY + maxRotY) / 2;\n  centerRotX += (padding[1] - padding[3]) / 2 * resolution;\n  centerRotY += (padding[0] - padding[2]) / 2 * resolution;\n  const centerX = centerRotX * cosAngle - centerRotY * sinAngle;\n  const centerY = centerRotY * cosAngle + centerRotX * sinAngle;\n  const center = [centerX, centerY];\n  const callback = options.callback ? options.callback : UNDEFINED;\n\n  if (options.duration !== undefined) {\n    this.animate({\n      resolution: resolution,\n      center: center,\n      duration: options.duration,\n      easing: options.easing\n    }, callback);\n  } else {\n    this.setResolution(resolution);\n    this.setCenter(center);\n    setTimeout(callback.bind(undefined, true), 0);\n  }\n};\n\n\n/**\n * Center on coordinate and view position.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/size~Size} size Box pixel size.\n * @param {module:ol~Pixel} position Position on the view to center on.\n * @api\n */\nView.prototype.centerOn = function(coordinate, size, position) {\n  // calculate rotated position\n  const rotation = this.getRotation();\n  const cosAngle = Math.cos(-rotation);\n  let sinAngle = Math.sin(-rotation);\n  let rotX = coordinate[0] * cosAngle - coordinate[1] * sinAngle;\n  let rotY = coordinate[1] * cosAngle + coordinate[0] * sinAngle;\n  const resolution = this.getResolution();\n  rotX += (size[0] / 2 - position[0]) * resolution;\n  rotY += (position[1] - size[1] / 2) * resolution;\n\n  // go back to original angle\n  sinAngle = -sinAngle; // go back to original rotation\n  const centerX = rotX * cosAngle - rotY * sinAngle;\n  const centerY = rotY * cosAngle + rotX * sinAngle;\n\n  this.setCenter([centerX, centerY]);\n};\n\n\n/**\n * @return {boolean} Is defined.\n */\nView.prototype.isDef = function() {\n  return !!this.getCenter() && this.getResolution() !== undefined;\n};\n\n\n/**\n * Rotate the view around a given coordinate.\n * @param {number} rotation New rotation value for the view.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor The rotation center.\n * @api\n */\nView.prototype.rotate = function(rotation, opt_anchor) {\n  if (opt_anchor !== undefined) {\n    const center = this.calculateCenterRotate(rotation, opt_anchor);\n    this.setCenter(center);\n  }\n  this.setRotation(rotation);\n};\n\n\n/**\n * Set the center of the current view.\n * @param {module:ol/coordinate~Coordinate|undefined} center The center of the view.\n * @observable\n * @api\n */\nView.prototype.setCenter = function(center) {\n  this.set(ViewProperty.CENTER, center);\n  if (this.getAnimating()) {\n    this.cancelAnimations();\n  }\n};\n\n\n/**\n * @param {module:ol/ViewHint} hint Hint.\n * @param {number} delta Delta.\n * @return {number} New value.\n */\nView.prototype.setHint = function(hint, delta) {\n  this.hints_[hint] += delta;\n  this.changed();\n  return this.hints_[hint];\n};\n\n\n/**\n * Set the resolution for this view.\n * @param {number|undefined} resolution The resolution of the view.\n * @observable\n * @api\n */\nView.prototype.setResolution = function(resolution) {\n  this.set(ViewProperty.RESOLUTION, resolution);\n  if (this.getAnimating()) {\n    this.cancelAnimations();\n  }\n};\n\n\n/**\n * Set the rotation for this view.\n * @param {number} rotation The rotation of the view in radians.\n * @observable\n * @api\n */\nView.prototype.setRotation = function(rotation) {\n  this.set(ViewProperty.ROTATION, rotation);\n  if (this.getAnimating()) {\n    this.cancelAnimations();\n  }\n};\n\n\n/**\n * Zoom to a specific zoom level.\n * @param {number} zoom Zoom level.\n * @api\n */\nView.prototype.setZoom = function(zoom) {\n  this.setResolution(this.getResolutionForZoom(zoom));\n};\n\n\n/**\n * @param {module:ol/View~ViewOptions} options View options.\n * @return {module:ol/centerconstraint~Type} The constraint.\n */\nexport function createCenterConstraint(options) {\n  if (options.extent !== undefined) {\n    return createExtent(options.extent);\n  } else {\n    return centerNone;\n  }\n}\n\n\n/**\n * @param {module:ol/View~ViewOptions} options View options.\n * @return {{constraint: module:ol/resolutionconstraint~Type, maxResolution: number,\n *     minResolution: number, minZoom: number, zoomFactor: number}} The constraint.\n */\nexport function createResolutionConstraint(options) {\n  let resolutionConstraint;\n  let maxResolution;\n  let minResolution;\n\n  // TODO: move these to be ol constants\n  // see https://github.com/openlayers/openlayers/issues/2076\n  const defaultMaxZoom = 28;\n  const defaultZoomFactor = 2;\n\n  let minZoom = options.minZoom !== undefined ?\n    options.minZoom : DEFAULT_MIN_ZOOM;\n\n  let maxZoom = options.maxZoom !== undefined ?\n    options.maxZoom : defaultMaxZoom;\n\n  const zoomFactor = options.zoomFactor !== undefined ?\n    options.zoomFactor : defaultZoomFactor;\n\n  if (options.resolutions !== undefined) {\n    const resolutions = options.resolutions;\n    maxResolution = resolutions[minZoom];\n    minResolution = resolutions[maxZoom] !== undefined ?\n      resolutions[maxZoom] : resolutions[resolutions.length - 1];\n    resolutionConstraint = createSnapToResolutions(\n      resolutions);\n  } else {\n    // calculate the default min and max resolution\n    const projection = createProjection(options.projection, 'EPSG:3857');\n    const extent = projection.getExtent();\n    const size = !extent ?\n      // use an extent that can fit the whole world if need be\n      360 * METERS_PER_UNIT[Units.DEGREES] /\n            projection.getMetersPerUnit() :\n      Math.max(getWidth(extent), getHeight(extent));\n\n    const defaultMaxResolution = size / DEFAULT_TILE_SIZE / Math.pow(\n      defaultZoomFactor, DEFAULT_MIN_ZOOM);\n\n    const defaultMinResolution = defaultMaxResolution / Math.pow(\n      defaultZoomFactor, defaultMaxZoom - DEFAULT_MIN_ZOOM);\n\n    // user provided maxResolution takes precedence\n    maxResolution = options.maxResolution;\n    if (maxResolution !== undefined) {\n      minZoom = 0;\n    } else {\n      maxResolution = defaultMaxResolution / Math.pow(zoomFactor, minZoom);\n    }\n\n    // user provided minResolution takes precedence\n    minResolution = options.minResolution;\n    if (minResolution === undefined) {\n      if (options.maxZoom !== undefined) {\n        if (options.maxResolution !== undefined) {\n          minResolution = maxResolution / Math.pow(zoomFactor, maxZoom);\n        } else {\n          minResolution = defaultMaxResolution / Math.pow(zoomFactor, maxZoom);\n        }\n      } else {\n        minResolution = defaultMinResolution;\n      }\n    }\n\n    // given discrete zoom levels, minResolution may be different than provided\n    maxZoom = minZoom + Math.floor(\n      Math.log(maxResolution / minResolution) / Math.log(zoomFactor));\n    minResolution = maxResolution / Math.pow(zoomFactor, maxZoom - minZoom);\n\n    resolutionConstraint = createSnapToPower(\n      zoomFactor, maxResolution, maxZoom - minZoom);\n  }\n  return {constraint: resolutionConstraint, maxResolution: maxResolution,\n    minResolution: minResolution, minZoom: minZoom, zoomFactor: zoomFactor};\n}\n\n\n/**\n * @param {module:ol/View~ViewOptions} options View options.\n * @return {module:ol/rotationconstraint~Type} Rotation constraint.\n */\nexport function createRotationConstraint(options) {\n  const enableRotation = options.enableRotation !== undefined ?\n    options.enableRotation : true;\n  if (enableRotation) {\n    const constrainRotation = options.constrainRotation;\n    if (constrainRotation === undefined || constrainRotation === true) {\n      return createSnapToZero();\n    } else if (constrainRotation === false) {\n      return rotationNone;\n    } else if (typeof constrainRotation === 'number') {\n      return createSnapToN(constrainRotation);\n    } else {\n      return rotationNone;\n    }\n  } else {\n    return disable;\n  }\n}\n\n\n/**\n * Determine if an animation involves no view change.\n * @param {module:ol/View~Animation} animation The animation.\n * @return {boolean} The animation involves no view change.\n */\nexport function isNoopAnimation(animation) {\n  if (animation.sourceCenter && animation.targetCenter) {\n    if (!coordinatesEqual(animation.sourceCenter, animation.targetCenter)) {\n      return false;\n    }\n  }\n  if (animation.sourceResolution !== animation.targetResolution) {\n    return false;\n  }\n  if (animation.sourceRotation !== animation.targetRotation) {\n    return false;\n  }\n  return true;\n}\n\nexport default View;\n","/**\n * @module ol/resolutionconstraint\n */\nimport {linearFindNearest} from './array.js';\nimport {clamp} from './math.js';\n\n\n/**\n * @typedef {function((number|undefined), number, number): (number|undefined)} Type\n */\n\n\n/**\n * @param {Array.<number>} resolutions Resolutions.\n * @return {module:ol/resolutionconstraint~Type} Zoom function.\n */\nexport function createSnapToResolutions(resolutions) {\n  return (\n    /**\n     * @param {number|undefined} resolution Resolution.\n     * @param {number} delta Delta.\n     * @param {number} direction Direction.\n     * @return {number|undefined} Resolution.\n     */\n    function(resolution, delta, direction) {\n      if (resolution !== undefined) {\n        let z = linearFindNearest(resolutions, resolution, direction);\n        z = clamp(z + delta, 0, resolutions.length - 1);\n        const index = Math.floor(z);\n        if (z != index && index < resolutions.length - 1) {\n          const power = resolutions[index] / resolutions[index + 1];\n          return resolutions[index] / Math.pow(power, z - index);\n        } else {\n          return resolutions[index];\n        }\n      } else {\n        return undefined;\n      }\n    }\n  );\n}\n\n\n/**\n * @param {number} power Power.\n * @param {number} maxResolution Maximum resolution.\n * @param {number=} opt_maxLevel Maximum level.\n * @return {module:ol/resolutionconstraint~Type} Zoom function.\n */\nexport function createSnapToPower(power, maxResolution, opt_maxLevel) {\n  return (\n    /**\n     * @param {number|undefined} resolution Resolution.\n     * @param {number} delta Delta.\n     * @param {number} direction Direction.\n     * @return {number|undefined} Resolution.\n     */\n    function(resolution, delta, direction) {\n      if (resolution !== undefined) {\n        const offset = -direction / 2 + 0.5;\n        const oldLevel = Math.floor(\n          Math.log(maxResolution / resolution) / Math.log(power) + offset);\n        let newLevel = Math.max(oldLevel + delta, 0);\n        if (opt_maxLevel !== undefined) {\n          newLevel = Math.min(newLevel, opt_maxLevel);\n        }\n        return maxResolution / Math.pow(power, newLevel);\n      } else {\n        return undefined;\n      }\n    });\n}\n","/**\n * @module ol/layer/Property\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  OPACITY: 'opacity',\n  VISIBLE: 'visible',\n  EXTENT: 'extent',\n  Z_INDEX: 'zIndex',\n  MAX_RESOLUTION: 'maxResolution',\n  MIN_RESOLUTION: 'minResolution',\n  SOURCE: 'source'\n};\n","/**\n * @module ol/layer/Base\n */\nimport {inherits} from '../util.js';\nimport BaseObject from '../Object.js';\nimport LayerProperty from '../layer/Property.js';\nimport {clamp} from '../math.js';\nimport {assign} from '../obj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Note that with {@link module:ol/layer/Base} and all its subclasses, any property set in\n * the options is set as a {@link module:ol/Object} property on the layer object, so\n * is observable, and has get/set accessors.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/Object}\n * @param {module:ol/layer/Base~Options} options Layer options.\n * @api\n */\nconst BaseLayer = function(options) {\n\n  BaseObject.call(this);\n\n  /**\n   * @type {Object.<string, *>}\n   */\n  const properties = assign({}, options);\n  properties[LayerProperty.OPACITY] =\n      options.opacity !== undefined ? options.opacity : 1;\n  properties[LayerProperty.VISIBLE] =\n      options.visible !== undefined ? options.visible : true;\n  properties[LayerProperty.Z_INDEX] =\n      options.zIndex !== undefined ? options.zIndex : 0;\n  properties[LayerProperty.MAX_RESOLUTION] =\n      options.maxResolution !== undefined ? options.maxResolution : Infinity;\n  properties[LayerProperty.MIN_RESOLUTION] =\n      options.minResolution !== undefined ? options.minResolution : 0;\n\n  this.setProperties(properties);\n\n  /**\n   * @type {module:ol/layer/Layer~State}\n   * @private\n   */\n  this.state_ = /** @type {module:ol/layer/Layer~State} */ ({\n    layer: /** @type {module:ol/layer/Layer} */ (this),\n    managed: true\n  });\n\n  /**\n   * The layer type.\n   * @type {module:ol/LayerType}\n   * @protected;\n   */\n  this.type;\n\n};\n\ninherits(BaseLayer, BaseObject);\n\n\n/**\n * Get the layer type (used when creating a layer renderer).\n * @return {module:ol/LayerType} The layer type.\n */\nBaseLayer.prototype.getType = function() {\n  return this.type;\n};\n\n\n/**\n * @return {module:ol/layer/Layer~State} Layer state.\n */\nBaseLayer.prototype.getLayerState = function() {\n  this.state_.opacity = clamp(this.getOpacity(), 0, 1);\n  this.state_.sourceState = this.getSourceState();\n  this.state_.visible = this.getVisible();\n  this.state_.extent = this.getExtent();\n  this.state_.zIndex = this.getZIndex();\n  this.state_.maxResolution = this.getMaxResolution();\n  this.state_.minResolution = Math.max(this.getMinResolution(), 0);\n\n  return this.state_;\n};\n\n\n/**\n * @abstract\n * @param {Array.<module:ol/layer/Layer>=} opt_array Array of layers (to be\n *     modified in place).\n * @return {Array.<module:ol/layer/Layer>} Array of layers.\n */\nBaseLayer.prototype.getLayersArray = function(opt_array) {};\n\n\n/**\n * @abstract\n * @param {Array.<module:ol/layer/Layer~State>=} opt_states Optional list of layer\n *     states (to be modified in place).\n * @return {Array.<module:ol/layer/Layer~State>} List of layer states.\n */\nBaseLayer.prototype.getLayerStatesArray = function(opt_states) {};\n\n\n/**\n * Return the {@link module:ol/extent~Extent extent} of the layer or `undefined` if it\n * will be visible regardless of extent.\n * @return {module:ol/extent~Extent|undefined} The layer extent.\n * @observable\n * @api\n */\nBaseLayer.prototype.getExtent = function() {\n  return (\n    /** @type {module:ol/extent~Extent|undefined} */ (this.get(LayerProperty.EXTENT))\n  );\n};\n\n\n/**\n * Return the maximum resolution of the layer.\n * @return {number} The maximum resolution of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.getMaxResolution = function() {\n  return /** @type {number} */ (this.get(LayerProperty.MAX_RESOLUTION));\n};\n\n\n/**\n * Return the minimum resolution of the layer.\n * @return {number} The minimum resolution of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.getMinResolution = function() {\n  return /** @type {number} */ (this.get(LayerProperty.MIN_RESOLUTION));\n};\n\n\n/**\n * Return the opacity of the layer (between 0 and 1).\n * @return {number} The opacity of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.getOpacity = function() {\n  return /** @type {number} */ (this.get(LayerProperty.OPACITY));\n};\n\n\n/**\n * @abstract\n * @return {module:ol/source/State} Source state.\n */\nBaseLayer.prototype.getSourceState = function() {};\n\n\n/**\n * Return the visibility of the layer (`true` or `false`).\n * @return {boolean} The visibility of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.getVisible = function() {\n  return /** @type {boolean} */ (this.get(LayerProperty.VISIBLE));\n};\n\n\n/**\n * Return the Z-index of the layer, which is used to order layers before\n * rendering. The default Z-index is 0.\n * @return {number} The Z-index of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.getZIndex = function() {\n  return /** @type {number} */ (this.get(LayerProperty.Z_INDEX));\n};\n\n\n/**\n * Set the extent at which the layer is visible.  If `undefined`, the layer\n * will be visible at all extents.\n * @param {module:ol/extent~Extent|undefined} extent The extent of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setExtent = function(extent) {\n  this.set(LayerProperty.EXTENT, extent);\n};\n\n\n/**\n * Set the maximum resolution at which the layer is visible.\n * @param {number} maxResolution The maximum resolution of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setMaxResolution = function(maxResolution) {\n  this.set(LayerProperty.MAX_RESOLUTION, maxResolution);\n};\n\n\n/**\n * Set the minimum resolution at which the layer is visible.\n * @param {number} minResolution The minimum resolution of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setMinResolution = function(minResolution) {\n  this.set(LayerProperty.MIN_RESOLUTION, minResolution);\n};\n\n\n/**\n * Set the opacity of the layer, allowed values range from 0 to 1.\n * @param {number} opacity The opacity of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setOpacity = function(opacity) {\n  this.set(LayerProperty.OPACITY, opacity);\n};\n\n\n/**\n * Set the visibility of the layer (`true` or `false`).\n * @param {boolean} visible The visibility of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setVisible = function(visible) {\n  this.set(LayerProperty.VISIBLE, visible);\n};\n\n\n/**\n * Set Z-index of the layer, which is used to order layers before rendering.\n * The default Z-index is 0.\n * @param {number} zindex The z-index of the layer.\n * @observable\n * @api\n */\nBaseLayer.prototype.setZIndex = function(zindex) {\n  this.set(LayerProperty.Z_INDEX, zindex);\n};\nexport default BaseLayer;\n","/**\n * @module ol/source/State\n */\n\n/**\n * State of the source, one of 'undefined', 'loading', 'ready' or 'error'.\n * @enum {string}\n */\nexport default {\n  UNDEFINED: 'undefined',\n  LOADING: 'loading',\n  READY: 'ready',\n  ERROR: 'error'\n};\n","/**\n * @module ol/layer/Group\n */\nimport {getUid, inherits} from '../util.js';\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport {getChangeEventType} from '../Object.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport {assert} from '../asserts.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getIntersection} from '../extent.js';\nimport BaseLayer from '../layer/Base.js';\nimport {assign, clear} from '../obj.js';\nimport SourceState from '../source/State.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {(Array.<module:ol/layer/Base>|module:ol/Collection.<module:ol/layer/Base>)} [layers] Child layers.\n */\n\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  LAYERS: 'layers'\n};\n\n\n/**\n * @classdesc\n * A {@link module:ol/Collection~Collection} of layers that are handled together.\n *\n * A generic `change` event is triggered when the group/Collection changes.\n *\n * @constructor\n * @extends {module:ol/layer/Base}\n * @param {module:ol/layer/Group~Options=} opt_options Layer options.\n * @api\n */\nconst LayerGroup = function(opt_options) {\n\n  const options = opt_options || {};\n  const baseOptions = /** @type {module:ol/layer/Group~Options} */ (assign({}, options));\n  delete baseOptions.layers;\n\n  let layers = options.layers;\n\n  BaseLayer.call(this, baseOptions);\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.layersListenerKeys_ = [];\n\n  /**\n   * @private\n   * @type {Object.<string, Array.<module:ol/events~EventsKey>>}\n   */\n  this.listenerKeys_ = {};\n\n  listen(this,\n    getChangeEventType(Property.LAYERS),\n    this.handleLayersChanged_, this);\n\n  if (layers) {\n    if (Array.isArray(layers)) {\n      layers = new Collection(layers.slice(), {unique: true});\n    } else {\n      assert(layers instanceof Collection,\n        43); // Expected `layers` to be an array or a `Collection`\n      layers = layers;\n    }\n  } else {\n    layers = new Collection(undefined, {unique: true});\n  }\n\n  this.setLayers(layers);\n\n};\n\ninherits(LayerGroup, BaseLayer);\n\n\n/**\n * @private\n */\nLayerGroup.prototype.handleLayerChange_ = function() {\n  this.changed();\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n * @private\n */\nLayerGroup.prototype.handleLayersChanged_ = function(event) {\n  this.layersListenerKeys_.forEach(unlistenByKey);\n  this.layersListenerKeys_.length = 0;\n\n  const layers = this.getLayers();\n  this.layersListenerKeys_.push(\n    listen(layers, CollectionEventType.ADD, this.handleLayersAdd_, this),\n    listen(layers, CollectionEventType.REMOVE, this.handleLayersRemove_, this)\n  );\n\n  for (const id in this.listenerKeys_) {\n    this.listenerKeys_[id].forEach(unlistenByKey);\n  }\n  clear(this.listenerKeys_);\n\n  const layersArray = layers.getArray();\n  for (let i = 0, ii = layersArray.length; i < ii; i++) {\n    const layer = layersArray[i];\n    this.listenerKeys_[getUid(layer).toString()] = [\n      listen(layer, ObjectEventType.PROPERTYCHANGE, this.handleLayerChange_, this),\n      listen(layer, EventType.CHANGE, this.handleLayerChange_, this)\n    ];\n  }\n\n  this.changed();\n};\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} collectionEvent CollectionEvent.\n * @private\n */\nLayerGroup.prototype.handleLayersAdd_ = function(collectionEvent) {\n  const layer = /** @type {module:ol/layer/Base} */ (collectionEvent.element);\n  const key = getUid(layer).toString();\n  this.listenerKeys_[key] = [\n    listen(layer, ObjectEventType.PROPERTYCHANGE, this.handleLayerChange_, this),\n    listen(layer, EventType.CHANGE, this.handleLayerChange_, this)\n  ];\n  this.changed();\n};\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} collectionEvent CollectionEvent.\n * @private\n */\nLayerGroup.prototype.handleLayersRemove_ = function(collectionEvent) {\n  const layer = /** @type {module:ol/layer/Base} */ (collectionEvent.element);\n  const key = getUid(layer).toString();\n  this.listenerKeys_[key].forEach(unlistenByKey);\n  delete this.listenerKeys_[key];\n  this.changed();\n};\n\n\n/**\n * Returns the {@link module:ol/Collection collection} of {@link module:ol/layer/Layer~Layer layers}\n * in this group.\n * @return {!module:ol/Collection.<module:ol/layer/Base>} Collection of\n *   {@link module:ol/layer/Base layers} that are part of this group.\n * @observable\n * @api\n */\nLayerGroup.prototype.getLayers = function() {\n  return (\n    /** @type {!module:ol/Collection.<module:ol/layer/Base>} */ (this.get(Property.LAYERS))\n  );\n};\n\n\n/**\n * Set the {@link module:ol/Collection collection} of {@link module:ol/layer/Layer~Layer layers}\n * in this group.\n * @param {!module:ol/Collection.<module:ol/layer/Base>} layers Collection of\n *   {@link module:ol/layer/Base layers} that are part of this group.\n * @observable\n * @api\n */\nLayerGroup.prototype.setLayers = function(layers) {\n  this.set(Property.LAYERS, layers);\n};\n\n\n/**\n * @inheritDoc\n */\nLayerGroup.prototype.getLayersArray = function(opt_array) {\n  const array = opt_array !== undefined ? opt_array : [];\n  this.getLayers().forEach(function(layer) {\n    layer.getLayersArray(array);\n  });\n  return array;\n};\n\n\n/**\n * @inheritDoc\n */\nLayerGroup.prototype.getLayerStatesArray = function(opt_states) {\n  const states = opt_states !== undefined ? opt_states : [];\n\n  const pos = states.length;\n\n  this.getLayers().forEach(function(layer) {\n    layer.getLayerStatesArray(states);\n  });\n\n  const ownLayerState = this.getLayerState();\n  for (let i = pos, ii = states.length; i < ii; i++) {\n    const layerState = states[i];\n    layerState.opacity *= ownLayerState.opacity;\n    layerState.visible = layerState.visible && ownLayerState.visible;\n    layerState.maxResolution = Math.min(\n      layerState.maxResolution, ownLayerState.maxResolution);\n    layerState.minResolution = Math.max(\n      layerState.minResolution, ownLayerState.minResolution);\n    if (ownLayerState.extent !== undefined) {\n      if (layerState.extent !== undefined) {\n        layerState.extent = getIntersection(layerState.extent, ownLayerState.extent);\n      } else {\n        layerState.extent = ownLayerState.extent;\n      }\n    }\n  }\n\n  return states;\n};\n\n\n/**\n * @inheritDoc\n */\nLayerGroup.prototype.getSourceState = function() {\n  return SourceState.READY;\n};\n\nexport default LayerGroup;\n","/**\n * @module ol/size\n */\n\n\n/**\n * An array of numbers representing a size: `[width, height]`.\n * @typedef {Array.<number>} Size\n * @api\n */\n\n\n/**\n * Returns a buffered size.\n * @param {module:ol/size~Size} size Size.\n * @param {number} num The amount by which to buffer.\n * @param {module:ol/size~Size=} opt_size Optional reusable size array.\n * @return {module:ol/size~Size} The buffered size.\n */\nexport function buffer(size, num, opt_size) {\n  if (opt_size === undefined) {\n    opt_size = [0, 0];\n  }\n  opt_size[0] = size[0] + 2 * num;\n  opt_size[1] = size[1] + 2 * num;\n  return opt_size;\n}\n\n\n/**\n * Determines if a size has a positive area.\n * @param {module:ol/size~Size} size The size to test.\n * @return {boolean} The size has a positive area.\n */\nexport function hasArea(size) {\n  return size[0] > 0 && size[1] > 0;\n}\n\n\n/**\n * Returns a size scaled by a ratio. The result will be an array of integers.\n * @param {module:ol/size~Size} size Size.\n * @param {number} ratio Ratio.\n * @param {module:ol/size~Size=} opt_size Optional reusable size array.\n * @return {module:ol/size~Size} The scaled size.\n */\nexport function scale(size, ratio, opt_size) {\n  if (opt_size === undefined) {\n    opt_size = [0, 0];\n  }\n  opt_size[0] = (size[0] * ratio + 0.5) | 0;\n  opt_size[1] = (size[1] * ratio + 0.5) | 0;\n  return opt_size;\n}\n\n\n/**\n * Returns an `module:ol/size~Size` array for the passed in number (meaning: square) or\n * `module:ol/size~Size` array.\n * (meaning: non-square),\n * @param {number|module:ol/size~Size} size Width and height.\n * @param {module:ol/size~Size=} opt_size Optional reusable size array.\n * @return {module:ol/size~Size} Size.\n * @api\n */\nexport function toSize(size, opt_size) {\n  if (Array.isArray(size)) {\n    return size;\n  } else {\n    if (opt_size === undefined) {\n      opt_size = [size, size];\n    } else {\n      opt_size[0] = opt_size[1] = /** @type {number} */ (size);\n    }\n    return opt_size;\n  }\n}\n","/**\n * @module ol/PluggableMap\n */\nimport {getUid, inherits} from './util.js';\nimport Collection from './Collection.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport MapBrowserEvent from './MapBrowserEvent.js';\nimport MapBrowserEventHandler from './MapBrowserEventHandler.js';\nimport MapBrowserEventType from './MapBrowserEventType.js';\nimport MapEvent from './MapEvent.js';\nimport MapEventType from './MapEventType.js';\nimport MapProperty from './MapProperty.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport ObjectEventType from './ObjectEventType.js';\nimport TileQueue from './TileQueue.js';\nimport View from './View.js';\nimport ViewHint from './ViewHint.js';\nimport {assert} from './asserts.js';\nimport {removeNode} from './dom.js';\nimport {listen, unlistenByKey, unlisten} from './events.js';\nimport {stopPropagation} from './events/Event.js';\nimport EventType from './events/EventType.js';\nimport {createEmpty, clone, createOrUpdateEmpty, equals, getForViewAndSize, isEmpty} from './extent.js';\nimport {TRUE} from './functions.js';\nimport {DEVICE_PIXEL_RATIO, TOUCH} from './has.js';\nimport LayerGroup from './layer/Group.js';\nimport {hasArea} from './size.js';\nimport {DROP} from './structs/PriorityQueue.js';\nimport {create as createTransform, apply as applyTransform} from './transform.js';\n\n\n/**\n * State of the current frame. Only `pixelRatio`, `time` and `viewState` should\n * be used in applications.\n * @typedef {Object} FrameState\n * @property {number} pixelRatio The pixel ratio of the frame.\n * @property {number} time The time when rendering of the frame was requested.\n * @property {module:ol/View~State} viewState The state of the current view.\n * @property {boolean} animate\n * @property {module:ol/transform~Transform} coordinateToPixelTransform\n * @property {null|module:ol/extent~Extent} extent\n * @property {module:ol/coordinate~Coordinate} focus\n * @property {number} index\n * @property {Object.<number, module:ol/layer/Layer~State>} layerStates\n * @property {Array.<module:ol/layer/Layer~State>} layerStatesArray\n * @property {module:ol/transform~Transform} pixelToCoordinateTransform\n * @property {Array.<module:ol/PluggableMap~PostRenderFunction>} postRenderFunctions\n * @property {module:ol/size~Size} size\n * @property {!Object.<string, boolean>} skippedFeatureUids\n * @property {module:ol/TileQueue} tileQueue\n * @property {Object.<string, Object.<string, module:ol/TileRange>>} usedTiles\n * @property {Array.<number>} viewHints\n * @property {!Object.<string, Object.<string, boolean>>} wantedTiles\n */\n\n\n/**\n * @typedef {function(module:ol/PluggableMap, ?module:ol/PluggableMap~FrameState): boolean} PostRenderFunction\n */\n\n\n/**\n * @typedef {Object} AtPixelOptions\n * @property {((function(module:ol/layer/Layer): boolean)|undefined)} layerFilter Layer filter\n * function. The filter function will receive one argument, the\n * {@link module:ol/layer/Layer layer-candidate} and it should return a boolean value.\n * Only layers which are visible and for which this function returns `true`\n * will be tested for features. By default, all visible layers will be tested.\n * @property {number} [hitTolerance=0] Hit-detection tolerance in pixels. Pixels\n * inside the radius around the given position will be checked for features. This only\n * works for the canvas renderer and not for WebGL.\n */\n\n\n/**\n * @typedef {Object} MapOptionsInternal\n * @property {module:ol/Collection.<module:ol/control/Control>} [controls]\n * @property {module:ol/Collection.<module:ol/interaction/Interaction>} [interactions]\n * @property {Element|Document} keyboardEventTarget\n * @property {module:ol/Collection.<module:ol/Overlay>} overlays\n * @property {Object.<string, *>} values\n */\n\n\n/**\n * Object literal with config options for the map.\n * @typedef {Object} MapOptions\n * @property {module:ol/Collection.<module:ol/control/Control>|Array.<module:ol/control/Control>} [controls]\n * Controls initially added to the map. If not specified,\n * {@link module:ol/control/util~defaults} is used.\n * @property {number} [pixelRatio=window.devicePixelRatio] The ratio between\n * physical pixels and device-independent pixels (dips) on the device.\n * @property {module:ol/Collection.<module:ol/interaction/Interaction>|Array.<module:ol/interaction/Interaction>} [interactions]\n * Interactions that are initially added to the map. If not specified,\n * {@link module:ol/interaction~defaults} is used.\n * @property {Element|Document|string} [keyboardEventTarget] The element to\n * listen to keyboard events on. This determines when the `KeyboardPan` and\n * `KeyboardZoom` interactions trigger. For example, if this option is set to\n * `document` the keyboard interactions will always trigger. If this option is\n * not specified, the element the library listens to keyboard events on is the\n * map target (i.e. the user-provided div for the map). If this is not\n * `document`, the target element needs to be focused for key events to be\n * emitted, requiring that the target element has a `tabindex` attribute.\n * @property {Array.<module:ol/layer/Base>|module:ol/Collection.<module:ol/layer/Base>} [layers]\n * Layers. If this is not defined, a map with no layers will be rendered. Note\n * that layers are rendered in the order supplied, so if you want, for example,\n * a vector layer to appear on top of a tile layer, it must come after the tile\n * layer.\n * @property {number} [maxTilesLoading=16] Maximum number tiles to load\n * simultaneously.\n * @property {boolean} [loadTilesWhileAnimating=false] When set to `true`, tiles\n * will be loaded during animations. This may improve the user experience, but\n * can also make animations stutter on devices with slow memory.\n * @property {boolean} [loadTilesWhileInteracting=false] When set to `true`,\n * tiles will be loaded while interacting with the map. This may improve the\n * user experience, but can also make map panning and zooming choppy on devices\n * with slow memory.\n * @property {number} [moveTolerance=1] The minimum distance in pixels the\n * cursor must move to be detected as a map move event instead of a click.\n * Increasing this value can make it easier to click on the map.\n * @property {module:ol/Collection.<module:ol/Overlay>|Array.<module:ol/Overlay>} [overlays]\n * Overlays initially added to the map. By default, no overlays are added.\n * @property {Element|string} [target] The container for the map, either the\n * element itself or the `id` of the element. If not specified at construction\n * time, {@link module:ol/Map~Map#setTarget} must be called for the map to be\n * rendered.\n * @property {module:ol/View} [view] The map's view.  No layer sources will be\n * fetched unless this is specified at construction time or through\n * {@link module:ol/Map~Map#setView}.\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/PluggableMap~MapOptions} options Map options.\n * @fires module:ol/MapBrowserEvent~MapBrowserEvent\n * @fires module:ol/MapEvent~MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @api\n */\nconst PluggableMap = function(options) {\n\n  BaseObject.call(this);\n\n  const optionsInternal = createOptionsInternal(options);\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxTilesLoading_ = options.maxTilesLoading !== undefined ? options.maxTilesLoading : 16;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.loadTilesWhileAnimating_ =\n      options.loadTilesWhileAnimating !== undefined ?\n        options.loadTilesWhileAnimating : false;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.loadTilesWhileInteracting_ =\n      options.loadTilesWhileInteracting !== undefined ?\n        options.loadTilesWhileInteracting : false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelRatio_ = options.pixelRatio !== undefined ?\n    options.pixelRatio : DEVICE_PIXEL_RATIO;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.animationDelayKey_;\n\n  /**\n   * @private\n   */\n  this.animationDelay_ = function() {\n    this.animationDelayKey_ = undefined;\n    this.renderFrame_.call(this, Date.now());\n  }.bind(this);\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.coordinateToPixelTransform_ = createTransform();\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.pixelToCoordinateTransform_ = createTransform();\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.frameIndex_ = 0;\n\n  /**\n   * @private\n   * @type {?module:ol/PluggableMap~FrameState}\n   */\n  this.frameState_ = null;\n\n  /**\n   * The extent at the previous 'moveend' event.\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.previousExtent_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.viewPropertyListenerKey_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.viewChangeListenerKey_ = null;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.layerGroupPropertyListenerKeys_ = null;\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.viewport_ = document.createElement('DIV');\n  this.viewport_.className = 'ol-viewport' + (TOUCH ? ' ol-touch' : '');\n  this.viewport_.style.position = 'relative';\n  this.viewport_.style.overflow = 'hidden';\n  this.viewport_.style.width = '100%';\n  this.viewport_.style.height = '100%';\n  // prevent page zoom on IE >= 10 browsers\n  this.viewport_.style.msTouchAction = 'none';\n  this.viewport_.style.touchAction = 'none';\n\n  /**\n   * @private\n   * @type {!Element}\n   */\n  this.overlayContainer_ = document.createElement('DIV');\n  this.overlayContainer_.className = 'ol-overlaycontainer';\n  this.viewport_.appendChild(this.overlayContainer_);\n\n  /**\n   * @private\n   * @type {!Element}\n   */\n  this.overlayContainerStopEvent_ = document.createElement('DIV');\n  this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n  const overlayEvents = [\n    EventType.CLICK,\n    EventType.DBLCLICK,\n    EventType.MOUSEDOWN,\n    EventType.TOUCHSTART,\n    EventType.MSPOINTERDOWN,\n    MapBrowserEventType.POINTERDOWN,\n    EventType.MOUSEWHEEL,\n    EventType.WHEEL\n  ];\n  for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n    listen(this.overlayContainerStopEvent_, overlayEvents[i], stopPropagation);\n  }\n  this.viewport_.appendChild(this.overlayContainerStopEvent_);\n\n  /**\n   * @private\n   * @type {module:ol/MapBrowserEventHandler}\n   */\n  this.mapBrowserEventHandler_ = new MapBrowserEventHandler(this, options.moveTolerance);\n  for (const key in MapBrowserEventType) {\n    listen(this.mapBrowserEventHandler_, MapBrowserEventType[key],\n      this.handleMapBrowserEvent, this);\n  }\n\n  /**\n   * @private\n   * @type {Element|Document}\n   */\n  this.keyboardEventTarget_ = optionsInternal.keyboardEventTarget;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.keyHandlerKeys_ = null;\n\n  listen(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n  listen(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n  listen(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n\n  /**\n   * @type {module:ol/Collection.<module:ol/control/Control>}\n   * @protected\n   */\n  this.controls = optionsInternal.controls || new Collection();\n\n  /**\n   * @type {module:ol/Collection.<module:ol/interaction/Interaction>}\n   * @protected\n   */\n  this.interactions = optionsInternal.interactions || new Collection();\n\n  /**\n   * @type {module:ol/Collection.<module:ol/Overlay>}\n   * @private\n   */\n  this.overlays_ = optionsInternal.overlays;\n\n  /**\n   * A lookup of overlays by id.\n   * @private\n   * @type {Object.<string, module:ol/Overlay>}\n   */\n  this.overlayIdIndex_ = {};\n\n  /**\n   * @type {module:ol/renderer/Map}\n   * @private\n   */\n  this.renderer_ = this.createRenderer();\n\n  /**\n   * @type {function(Event)|undefined}\n   * @private\n   */\n  this.handleResize_;\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.focus_ = null;\n\n  /**\n   * @private\n   * @type {!Array.<module:ol/PluggableMap~PostRenderFunction>}\n   */\n  this.postRenderFunctions_ = [];\n\n  /**\n   * @private\n   * @type {module:ol/TileQueue}\n   */\n  this.tileQueue_ = new TileQueue(\n    this.getTilePriority.bind(this),\n    this.handleTileChange_.bind(this));\n\n  /**\n   * Uids of features to skip at rendering time.\n   * @type {Object.<string, boolean>}\n   * @private\n   */\n  this.skippedFeatureUids_ = {};\n\n  listen(\n    this, getChangeEventType(MapProperty.LAYERGROUP),\n    this.handleLayerGroupChanged_, this);\n  listen(this, getChangeEventType(MapProperty.VIEW),\n    this.handleViewChanged_, this);\n  listen(this, getChangeEventType(MapProperty.SIZE),\n    this.handleSizeChanged_, this);\n  listen(this, getChangeEventType(MapProperty.TARGET),\n    this.handleTargetChanged_, this);\n\n  // setProperties will trigger the rendering of the map if the map\n  // is \"defined\" already.\n  this.setProperties(optionsInternal.values);\n\n  this.controls.forEach(\n    /**\n     * @param {module:ol/control/Control} control Control.\n     * @this {module:ol/PluggableMap}\n     */\n    (function(control) {\n      control.setMap(this);\n    }).bind(this));\n\n  listen(this.controls, CollectionEventType.ADD,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      event.element.setMap(this);\n    }, this);\n\n  listen(this.controls, CollectionEventType.REMOVE,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      event.element.setMap(null);\n    }, this);\n\n  this.interactions.forEach(\n    /**\n     * @param {module:ol/interaction/Interaction} interaction Interaction.\n     * @this {module:ol/PluggableMap}\n     */\n    (function(interaction) {\n      interaction.setMap(this);\n    }).bind(this));\n\n  listen(this.interactions, CollectionEventType.ADD,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      event.element.setMap(this);\n    }, this);\n\n  listen(this.interactions, CollectionEventType.REMOVE,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      event.element.setMap(null);\n    }, this);\n\n  this.overlays_.forEach(this.addOverlayInternal_.bind(this));\n\n  listen(this.overlays_, CollectionEventType.ADD,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      this.addOverlayInternal_(/** @type {module:ol/Overlay} */ (event.element));\n    }, this);\n\n  listen(this.overlays_, CollectionEventType.REMOVE,\n    /**\n     * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\n     */\n    function(event) {\n      const overlay = /** @type {module:ol/Overlay} */ (event.element);\n      const id = overlay.getId();\n      if (id !== undefined) {\n        delete this.overlayIdIndex_[id.toString()];\n      }\n      event.element.setMap(null);\n    }, this);\n\n};\n\ninherits(PluggableMap, BaseObject);\n\n\nPluggableMap.prototype.createRenderer = function() {\n  throw new Error('Use a map type that has a createRenderer method');\n};\n\n\n/**\n * Add the given control to the map.\n * @param {module:ol/control/Control} control Control.\n * @api\n */\nPluggableMap.prototype.addControl = function(control) {\n  this.getControls().push(control);\n};\n\n\n/**\n * Add the given interaction to the map.\n * @param {module:ol/interaction/Interaction} interaction Interaction to add.\n * @api\n */\nPluggableMap.prototype.addInteraction = function(interaction) {\n  this.getInteractions().push(interaction);\n};\n\n\n/**\n * Adds the given layer to the top of this map. If you want to add a layer\n * elsewhere in the stack, use `getLayers()` and the methods available on\n * {@link module:ol/Collection~Collection}.\n * @param {module:ol/layer/Base} layer Layer.\n * @api\n */\nPluggableMap.prototype.addLayer = function(layer) {\n  const layers = this.getLayerGroup().getLayers();\n  layers.push(layer);\n};\n\n\n/**\n * Add the given overlay to the map.\n * @param {module:ol/Overlay} overlay Overlay.\n * @api\n */\nPluggableMap.prototype.addOverlay = function(overlay) {\n  this.getOverlays().push(overlay);\n};\n\n\n/**\n * This deals with map's overlay collection changes.\n * @param {module:ol/Overlay} overlay Overlay.\n * @private\n */\nPluggableMap.prototype.addOverlayInternal_ = function(overlay) {\n  const id = overlay.getId();\n  if (id !== undefined) {\n    this.overlayIdIndex_[id.toString()] = overlay;\n  }\n  overlay.setMap(this);\n};\n\n\n/**\n *\n * @inheritDoc\n */\nPluggableMap.prototype.disposeInternal = function() {\n  this.mapBrowserEventHandler_.dispose();\n  unlisten(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n  unlisten(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n  unlisten(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n  if (this.handleResize_ !== undefined) {\n    removeEventListener(EventType.RESIZE, this.handleResize_, false);\n    this.handleResize_ = undefined;\n  }\n  if (this.animationDelayKey_) {\n    cancelAnimationFrame(this.animationDelayKey_);\n    this.animationDelayKey_ = undefined;\n  }\n  this.setTarget(null);\n  BaseObject.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * Detect features that intersect a pixel on the viewport, and execute a\n * callback with each intersecting feature. Layers included in the detection can\n * be configured through the `layerFilter` option in `opt_options`.\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {function(this: S, (module:ol/Feature|module:ol/render/Feature),\n *     module:ol/layer/Layer): T} callback Feature callback. The callback will be\n *     called with two arguments. The first argument is one\n *     {@link module:ol/Feature feature} or\n *     {@link module:ol/render/Feature render feature} at the pixel, the second is\n *     the {@link module:ol/layer/Layer layer} of the feature and will be null for\n *     unmanaged layers. To stop detection, callback functions can return a\n *     truthy value.\n * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\n * @return {T|undefined} Callback result, i.e. the return value of last\n * callback execution, or the first truthy callback return value.\n * @template S,T\n * @api\n */\nPluggableMap.prototype.forEachFeatureAtPixel = function(pixel, callback, opt_options) {\n  if (!this.frameState_) {\n    return;\n  }\n  const coordinate = this.getCoordinateFromPixel(pixel);\n  opt_options = opt_options !== undefined ? opt_options : {};\n  const hitTolerance = opt_options.hitTolerance !== undefined ?\n    opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n  const layerFilter = opt_options.layerFilter !== undefined ?\n    opt_options.layerFilter : TRUE;\n  return this.renderer_.forEachFeatureAtCoordinate(\n    coordinate, this.frameState_, hitTolerance, callback, null,\n    layerFilter, null);\n};\n\n\n/**\n * Get all features that intersect a pixel on the viewport.\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\n * @return {Array.<module:ol/Feature|module:ol/render/Feature>} The detected features or\n * `null` if none were found.\n * @api\n */\nPluggableMap.prototype.getFeaturesAtPixel = function(pixel, opt_options) {\n  let features = null;\n  this.forEachFeatureAtPixel(pixel, function(feature) {\n    if (!features) {\n      features = [];\n    }\n    features.push(feature);\n  }, opt_options);\n  return features;\n};\n\n/**\n * Detect layers that have a color value at a pixel on the viewport, and\n * execute a callback with each matching layer. Layers included in the\n * detection can be configured through `opt_layerFilter`.\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {function(this: S, module:ol/layer/Layer, (Uint8ClampedArray|Uint8Array)): T} callback\n *     Layer callback. This callback will receive two arguments: first is the\n *     {@link module:ol/layer/Layer layer}, second argument is an array representing\n *     [R, G, B, A] pixel values (0 - 255) and will be `null` for layer types\n *     that do not currently support this argument. To stop detection, callback\n *     functions can return a truthy value.\n * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Configuration options.\n * @return {T|undefined} Callback result, i.e. the return value of last\n * callback execution, or the first truthy callback return value.\n * @template S,T\n * @api\n */\nPluggableMap.prototype.forEachLayerAtPixel = function(pixel, callback, opt_options) {\n  if (!this.frameState_) {\n    return;\n  }\n  const options = opt_options || {};\n  const hitTolerance = options.hitTolerance !== undefined ?\n    opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n  const layerFilter = options.layerFilter || TRUE;\n  return this.renderer_.forEachLayerAtPixel(\n    pixel, this.frameState_, hitTolerance, callback, null, layerFilter, null);\n};\n\n\n/**\n * Detect if features intersect a pixel on the viewport. Layers included in the\n * detection can be configured through `opt_layerFilter`.\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\n * @return {boolean} Is there a feature at the given pixel?\n * @template U\n * @api\n */\nPluggableMap.prototype.hasFeatureAtPixel = function(pixel, opt_options) {\n  if (!this.frameState_) {\n    return false;\n  }\n  const coordinate = this.getCoordinateFromPixel(pixel);\n  opt_options = opt_options !== undefined ? opt_options : {};\n  const layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : TRUE;\n  const hitTolerance = opt_options.hitTolerance !== undefined ?\n    opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n  return this.renderer_.hasFeatureAtCoordinate(\n    coordinate, this.frameState_, hitTolerance, layerFilter, null);\n};\n\n\n/**\n * Returns the coordinate in view projection for a browser event.\n * @param {Event} event Event.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n * @api\n */\nPluggableMap.prototype.getEventCoordinate = function(event) {\n  return this.getCoordinateFromPixel(this.getEventPixel(event));\n};\n\n\n/**\n * Returns the map pixel position for a browser event relative to the viewport.\n * @param {Event} event Event.\n * @return {module:ol~Pixel} Pixel.\n * @api\n */\nPluggableMap.prototype.getEventPixel = function(event) {\n  const viewportPosition = this.viewport_.getBoundingClientRect();\n  const eventPosition = event.changedTouches ? event.changedTouches[0] : event;\n  return [\n    eventPosition.clientX - viewportPosition.left,\n    eventPosition.clientY - viewportPosition.top\n  ];\n};\n\n\n/**\n * Get the target in which this map is rendered.\n * Note that this returns what is entered as an option or in setTarget:\n * if that was an element, it returns an element; if a string, it returns that.\n * @return {Element|string|undefined} The Element or id of the Element that the\n *     map is rendered in.\n * @observable\n * @api\n */\nPluggableMap.prototype.getTarget = function() {\n  return /** @type {Element|string|undefined} */ (this.get(MapProperty.TARGET));\n};\n\n\n/**\n * Get the DOM element into which this map is rendered. In contrast to\n * `getTarget` this method always return an `Element`, or `null` if the\n * map has no target.\n * @return {Element} The element that the map is rendered in.\n * @api\n */\nPluggableMap.prototype.getTargetElement = function() {\n  const target = this.getTarget();\n  if (target !== undefined) {\n    return typeof target === 'string' ? document.getElementById(target) : target;\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * Get the coordinate for a given pixel.  This returns a coordinate in the\n * map view projection.\n * @param {module:ol~Pixel} pixel Pixel position in the map viewport.\n * @return {module:ol/coordinate~Coordinate} The coordinate for the pixel position.\n * @api\n */\nPluggableMap.prototype.getCoordinateFromPixel = function(pixel) {\n  const frameState = this.frameState_;\n  if (!frameState) {\n    return null;\n  } else {\n    return applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\n  }\n};\n\n\n/**\n * Get the map controls. Modifying this collection changes the controls\n * associated with the map.\n * @return {module:ol/Collection.<module:ol/control/Control>} Controls.\n * @api\n */\nPluggableMap.prototype.getControls = function() {\n  return this.controls;\n};\n\n\n/**\n * Get the map overlays. Modifying this collection changes the overlays\n * associated with the map.\n * @return {module:ol/Collection.<module:ol/Overlay>} Overlays.\n * @api\n */\nPluggableMap.prototype.getOverlays = function() {\n  return this.overlays_;\n};\n\n\n/**\n * Get an overlay by its identifier (the value returned by overlay.getId()).\n * Note that the index treats string and numeric identifiers as the same. So\n * `map.getOverlayById(2)` will return an overlay with id `'2'` or `2`.\n * @param {string|number} id Overlay identifier.\n * @return {module:ol/Overlay} Overlay.\n * @api\n */\nPluggableMap.prototype.getOverlayById = function(id) {\n  const overlay = this.overlayIdIndex_[id.toString()];\n  return overlay !== undefined ? overlay : null;\n};\n\n\n/**\n * Get the map interactions. Modifying this collection changes the interactions\n * associated with the map.\n *\n * Interactions are used for e.g. pan, zoom and rotate.\n * @return {module:ol/Collection.<module:ol/interaction/Interaction>} Interactions.\n * @api\n */\nPluggableMap.prototype.getInteractions = function() {\n  return this.interactions;\n};\n\n\n/**\n * Get the layergroup associated with this map.\n * @return {module:ol/layer/Group} A layer group containing the layers in this map.\n * @observable\n * @api\n */\nPluggableMap.prototype.getLayerGroup = function() {\n  return (\n    /** @type {module:ol/layer/Group} */ (this.get(MapProperty.LAYERGROUP))\n  );\n};\n\n\n/**\n * Get the collection of layers associated with this map.\n * @return {!module:ol/Collection.<module:ol/layer/Base>} Layers.\n * @api\n */\nPluggableMap.prototype.getLayers = function() {\n  const layers = this.getLayerGroup().getLayers();\n  return layers;\n};\n\n\n/**\n * Get the pixel for a coordinate.  This takes a coordinate in the map view\n * projection and returns the corresponding pixel.\n * @param {module:ol/coordinate~Coordinate} coordinate A map coordinate.\n * @return {module:ol~Pixel} A pixel position in the map viewport.\n * @api\n */\nPluggableMap.prototype.getPixelFromCoordinate = function(coordinate) {\n  const frameState = this.frameState_;\n  if (!frameState) {\n    return null;\n  } else {\n    return applyTransform(frameState.coordinateToPixelTransform, coordinate.slice(0, 2));\n  }\n};\n\n\n/**\n * Get the map renderer.\n * @return {module:ol/renderer/Map} Renderer\n */\nPluggableMap.prototype.getRenderer = function() {\n  return this.renderer_;\n};\n\n\n/**\n * Get the size of this map.\n * @return {module:ol/size~Size|undefined} The size in pixels of the map in the DOM.\n * @observable\n * @api\n */\nPluggableMap.prototype.getSize = function() {\n  return (\n    /** @type {module:ol/size~Size|undefined} */ (this.get(MapProperty.SIZE))\n  );\n};\n\n\n/**\n * Get the view associated with this map. A view manages properties such as\n * center and resolution.\n * @return {module:ol/View} The view that controls this map.\n * @observable\n * @api\n */\nPluggableMap.prototype.getView = function() {\n  return (\n    /** @type {module:ol/View} */ (this.get(MapProperty.VIEW))\n  );\n};\n\n\n/**\n * Get the element that serves as the map viewport.\n * @return {Element} Viewport.\n * @api\n */\nPluggableMap.prototype.getViewport = function() {\n  return this.viewport_;\n};\n\n\n/**\n * Get the element that serves as the container for overlays.  Elements added to\n * this container will let mousedown and touchstart events through to the map,\n * so clicks and gestures on an overlay will trigger {@link module:ol/MapBrowserEvent~MapBrowserEvent}\n * events.\n * @return {!Element} The map's overlay container.\n */\nPluggableMap.prototype.getOverlayContainer = function() {\n  return this.overlayContainer_;\n};\n\n\n/**\n * Get the element that serves as a container for overlays that don't allow\n * event propagation. Elements added to this container won't let mousedown and\n * touchstart events through to the map, so clicks and gestures on an overlay\n * don't trigger any {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n * @return {!Element} The map's overlay container that stops events.\n */\nPluggableMap.prototype.getOverlayContainerStopEvent = function() {\n  return this.overlayContainerStopEvent_;\n};\n\n\n/**\n * @param {module:ol/Tile} tile Tile.\n * @param {string} tileSourceKey Tile source key.\n * @param {module:ol/coordinate~Coordinate} tileCenter Tile center.\n * @param {number} tileResolution Tile resolution.\n * @return {number} Tile priority.\n */\nPluggableMap.prototype.getTilePriority = function(tile, tileSourceKey, tileCenter, tileResolution) {\n  // Filter out tiles at higher zoom levels than the current zoom level, or that\n  // are outside the visible extent.\n  const frameState = this.frameState_;\n  if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {\n    return DROP;\n  }\n  if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {\n    return DROP;\n  }\n  // Prioritize the highest zoom level tiles closest to the focus.\n  // Tiles at higher zoom levels are prioritized using Math.log(tileResolution).\n  // Within a zoom level, tiles are prioritized by the distance in pixels\n  // between the center of the tile and the focus.  The factor of 65536 means\n  // that the prioritization should behave as desired for tiles up to\n  // 65536 * Math.log(2) = 45426 pixels from the focus.\n  const deltaX = tileCenter[0] - frameState.focus[0];\n  const deltaY = tileCenter[1] - frameState.focus[1];\n  return 65536 * Math.log(tileResolution) +\n      Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n};\n\n\n/**\n * @param {Event} browserEvent Browser event.\n * @param {string=} opt_type Type.\n */\nPluggableMap.prototype.handleBrowserEvent = function(browserEvent, opt_type) {\n  const type = opt_type || browserEvent.type;\n  const mapBrowserEvent = new MapBrowserEvent(type, this, browserEvent);\n  this.handleMapBrowserEvent(mapBrowserEvent);\n};\n\n\n/**\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent The event to handle.\n */\nPluggableMap.prototype.handleMapBrowserEvent = function(mapBrowserEvent) {\n  if (!this.frameState_) {\n    // With no view defined, we cannot translate pixels into geographical\n    // coordinates so interactions cannot be used.\n    return;\n  }\n  this.focus_ = mapBrowserEvent.coordinate;\n  mapBrowserEvent.frameState = this.frameState_;\n  const interactionsArray = this.getInteractions().getArray();\n  if (this.dispatchEvent(mapBrowserEvent) !== false) {\n    for (let i = interactionsArray.length - 1; i >= 0; i--) {\n      const interaction = interactionsArray[i];\n      if (!interaction.getActive()) {\n        continue;\n      }\n      const cont = interaction.handleEvent(mapBrowserEvent);\n      if (!cont) {\n        break;\n      }\n    }\n  }\n};\n\n\n/**\n * @protected\n */\nPluggableMap.prototype.handlePostRender = function() {\n\n  const frameState = this.frameState_;\n\n  // Manage the tile queue\n  // Image loads are expensive and a limited resource, so try to use them\n  // efficiently:\n  // * When the view is static we allow a large number of parallel tile loads\n  //   to complete the frame as quickly as possible.\n  // * When animating or interacting, image loads can cause janks, so we reduce\n  //   the maximum number of loads per frame and limit the number of parallel\n  //   tile loads to remain reactive to view changes and to reduce the chance of\n  //   loading tiles that will quickly disappear from view.\n  const tileQueue = this.tileQueue_;\n  if (!tileQueue.isEmpty()) {\n    let maxTotalLoading = this.maxTilesLoading_;\n    let maxNewLoads = maxTotalLoading;\n    if (frameState) {\n      const hints = frameState.viewHints;\n      if (hints[ViewHint.ANIMATING]) {\n        maxTotalLoading = this.loadTilesWhileAnimating_ ? 8 : 0;\n        maxNewLoads = 2;\n      }\n      if (hints[ViewHint.INTERACTING]) {\n        maxTotalLoading = this.loadTilesWhileInteracting_ ? 8 : 0;\n        maxNewLoads = 2;\n      }\n    }\n    if (tileQueue.getTilesLoading() < maxTotalLoading) {\n      tileQueue.reprioritize(); // FIXME only call if view has changed\n      tileQueue.loadMoreTiles(maxTotalLoading, maxNewLoads);\n    }\n  }\n\n  const postRenderFunctions = this.postRenderFunctions_;\n  for (let i = 0, ii = postRenderFunctions.length; i < ii; ++i) {\n    postRenderFunctions[i](this, frameState);\n  }\n  postRenderFunctions.length = 0;\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleSizeChanged_ = function() {\n  this.render();\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleTargetChanged_ = function() {\n  // target may be undefined, null, a string or an Element.\n  // If it's a string we convert it to an Element before proceeding.\n  // If it's not now an Element we remove the viewport from the DOM.\n  // If it's an Element we append the viewport element to it.\n\n  let targetElement;\n  if (this.getTarget()) {\n    targetElement = this.getTargetElement();\n  }\n\n  if (this.keyHandlerKeys_) {\n    for (let i = 0, ii = this.keyHandlerKeys_.length; i < ii; ++i) {\n      unlistenByKey(this.keyHandlerKeys_[i]);\n    }\n    this.keyHandlerKeys_ = null;\n  }\n\n  if (!targetElement) {\n    this.renderer_.removeLayerRenderers();\n    removeNode(this.viewport_);\n    if (this.handleResize_ !== undefined) {\n      removeEventListener(EventType.RESIZE, this.handleResize_, false);\n      this.handleResize_ = undefined;\n    }\n  } else {\n    targetElement.appendChild(this.viewport_);\n\n    const keyboardEventTarget = !this.keyboardEventTarget_ ?\n      targetElement : this.keyboardEventTarget_;\n    this.keyHandlerKeys_ = [\n      listen(keyboardEventTarget, EventType.KEYDOWN, this.handleBrowserEvent, this),\n      listen(keyboardEventTarget, EventType.KEYPRESS, this.handleBrowserEvent, this)\n    ];\n\n    if (!this.handleResize_) {\n      this.handleResize_ = this.updateSize.bind(this);\n      addEventListener(EventType.RESIZE, this.handleResize_, false);\n    }\n  }\n\n  this.updateSize();\n  // updateSize calls setSize, so no need to call this.render\n  // ourselves here.\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleTileChange_ = function() {\n  this.render();\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleViewPropertyChanged_ = function() {\n  this.render();\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleViewChanged_ = function() {\n  if (this.viewPropertyListenerKey_) {\n    unlistenByKey(this.viewPropertyListenerKey_);\n    this.viewPropertyListenerKey_ = null;\n  }\n  if (this.viewChangeListenerKey_) {\n    unlistenByKey(this.viewChangeListenerKey_);\n    this.viewChangeListenerKey_ = null;\n  }\n  const view = this.getView();\n  if (view) {\n    this.viewport_.setAttribute('data-view', getUid(view));\n    this.viewPropertyListenerKey_ = listen(\n      view, ObjectEventType.PROPERTYCHANGE,\n      this.handleViewPropertyChanged_, this);\n    this.viewChangeListenerKey_ = listen(\n      view, EventType.CHANGE,\n      this.handleViewPropertyChanged_, this);\n  }\n  this.render();\n};\n\n\n/**\n * @private\n */\nPluggableMap.prototype.handleLayerGroupChanged_ = function() {\n  if (this.layerGroupPropertyListenerKeys_) {\n    this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey);\n    this.layerGroupPropertyListenerKeys_ = null;\n  }\n  const layerGroup = this.getLayerGroup();\n  if (layerGroup) {\n    this.layerGroupPropertyListenerKeys_ = [\n      listen(\n        layerGroup, ObjectEventType.PROPERTYCHANGE,\n        this.render, this),\n      listen(\n        layerGroup, EventType.CHANGE,\n        this.render, this)\n    ];\n  }\n  this.render();\n};\n\n\n/**\n * @return {boolean} Is rendered.\n */\nPluggableMap.prototype.isRendered = function() {\n  return !!this.frameState_;\n};\n\n\n/**\n * Requests an immediate render in a synchronous manner.\n * @api\n */\nPluggableMap.prototype.renderSync = function() {\n  if (this.animationDelayKey_) {\n    cancelAnimationFrame(this.animationDelayKey_);\n  }\n  this.animationDelay_();\n};\n\n\n/**\n * Request a map rendering (at the next animation frame).\n * @api\n */\nPluggableMap.prototype.render = function() {\n  if (this.animationDelayKey_ === undefined) {\n    this.animationDelayKey_ = requestAnimationFrame(this.animationDelay_);\n  }\n};\n\n\n/**\n * Remove the given control from the map.\n * @param {module:ol/control/Control} control Control.\n * @return {module:ol/control/Control|undefined} The removed control (or undefined\n *     if the control was not found).\n * @api\n */\nPluggableMap.prototype.removeControl = function(control) {\n  return this.getControls().remove(control);\n};\n\n\n/**\n * Remove the given interaction from the map.\n * @param {module:ol/interaction/Interaction} interaction Interaction to remove.\n * @return {module:ol/interaction/Interaction|undefined} The removed interaction (or\n *     undefined if the interaction was not found).\n * @api\n */\nPluggableMap.prototype.removeInteraction = function(interaction) {\n  return this.getInteractions().remove(interaction);\n};\n\n\n/**\n * Removes the given layer from the map.\n * @param {module:ol/layer/Base} layer Layer.\n * @return {module:ol/layer/Base|undefined} The removed layer (or undefined if the\n *     layer was not found).\n * @api\n */\nPluggableMap.prototype.removeLayer = function(layer) {\n  const layers = this.getLayerGroup().getLayers();\n  return layers.remove(layer);\n};\n\n\n/**\n * Remove the given overlay from the map.\n * @param {module:ol/Overlay} overlay Overlay.\n * @return {module:ol/Overlay|undefined} The removed overlay (or undefined\n *     if the overlay was not found).\n * @api\n */\nPluggableMap.prototype.removeOverlay = function(overlay) {\n  return this.getOverlays().remove(overlay);\n};\n\n\n/**\n * @param {number} time Time.\n * @private\n */\nPluggableMap.prototype.renderFrame_ = function(time) {\n  let viewState;\n\n  const size = this.getSize();\n  const view = this.getView();\n  const extent = createEmpty();\n  const previousFrameState = this.frameState_;\n  /** @type {?module:ol/PluggableMap~FrameState} */\n  let frameState = null;\n  if (size !== undefined && hasArea(size) && view && view.isDef()) {\n    const viewHints = view.getHints(this.frameState_ ? this.frameState_.viewHints : undefined);\n    const layerStatesArray = this.getLayerGroup().getLayerStatesArray();\n    const layerStates = {};\n    for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n      layerStates[getUid(layerStatesArray[i].layer)] = layerStatesArray[i];\n    }\n    viewState = view.getState();\n    let focus = this.focus_;\n    if (!focus) {\n      focus = viewState.center;\n      const pixelResolution = viewState.resolution / this.pixelRatio_;\n      focus[0] = Math.round(focus[0] / pixelResolution) * pixelResolution;\n      focus[1] = Math.round(focus[1] / pixelResolution) * pixelResolution;\n    }\n    frameState = /** @type {module:ol/PluggableMap~FrameState} */ ({\n      animate: false,\n      coordinateToPixelTransform: this.coordinateToPixelTransform_,\n      extent: extent,\n      focus: focus,\n      index: this.frameIndex_++,\n      layerStates: layerStates,\n      layerStatesArray: layerStatesArray,\n      pixelRatio: this.pixelRatio_,\n      pixelToCoordinateTransform: this.pixelToCoordinateTransform_,\n      postRenderFunctions: [],\n      size: size,\n      skippedFeatureUids: this.skippedFeatureUids_,\n      tileQueue: this.tileQueue_,\n      time: time,\n      usedTiles: {},\n      viewState: viewState,\n      viewHints: viewHints,\n      wantedTiles: {}\n    });\n  }\n\n  if (frameState) {\n    frameState.extent = getForViewAndSize(viewState.center,\n      viewState.resolution, viewState.rotation, frameState.size, extent);\n  }\n\n  this.frameState_ = frameState;\n  this.renderer_.renderFrame(frameState);\n\n  if (frameState) {\n    if (frameState.animate) {\n      this.render();\n    }\n    Array.prototype.push.apply(this.postRenderFunctions_, frameState.postRenderFunctions);\n\n    if (previousFrameState) {\n      const moveStart = !this.previousExtent_ ||\n                  (!isEmpty(this.previousExtent_) &&\n                  !equals(frameState.extent, this.previousExtent_));\n      if (moveStart) {\n        this.dispatchEvent(\n          new MapEvent(MapEventType.MOVESTART, this, previousFrameState));\n        this.previousExtent_ = createOrUpdateEmpty(this.previousExtent_);\n      }\n    }\n\n    const idle = this.previousExtent_ &&\n        !frameState.viewHints[ViewHint.ANIMATING] &&\n        !frameState.viewHints[ViewHint.INTERACTING] &&\n        !equals(frameState.extent, this.previousExtent_);\n\n    if (idle) {\n      this.dispatchEvent(new MapEvent(MapEventType.MOVEEND, this, frameState));\n      clone(frameState.extent, this.previousExtent_);\n    }\n  }\n\n  this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER, this, frameState));\n\n  setTimeout(this.handlePostRender.bind(this), 0);\n\n};\n\n\n/**\n * Sets the layergroup of this map.\n * @param {module:ol/layer/Group} layerGroup A layer group containing the layers in this map.\n * @observable\n * @api\n */\nPluggableMap.prototype.setLayerGroup = function(layerGroup) {\n  this.set(MapProperty.LAYERGROUP, layerGroup);\n};\n\n\n/**\n * Set the size of this map.\n * @param {module:ol/size~Size|undefined} size The size in pixels of the map in the DOM.\n * @observable\n * @api\n */\nPluggableMap.prototype.setSize = function(size) {\n  this.set(MapProperty.SIZE, size);\n};\n\n\n/**\n * Set the target element to render this map into.\n * @param {Element|string|undefined} target The Element or id of the Element\n *     that the map is rendered in.\n * @observable\n * @api\n */\nPluggableMap.prototype.setTarget = function(target) {\n  this.set(MapProperty.TARGET, target);\n};\n\n\n/**\n * Set the view for this map.\n * @param {module:ol/View} view The view that controls this map.\n * @observable\n * @api\n */\nPluggableMap.prototype.setView = function(view) {\n  this.set(MapProperty.VIEW, view);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n */\nPluggableMap.prototype.skipFeature = function(feature) {\n  const featureUid = getUid(feature).toString();\n  this.skippedFeatureUids_[featureUid] = true;\n  this.render();\n};\n\n\n/**\n * Force a recalculation of the map viewport size.  This should be called when\n * third-party code changes the size of the map viewport.\n * @api\n */\nPluggableMap.prototype.updateSize = function() {\n  const targetElement = this.getTargetElement();\n\n  if (!targetElement) {\n    this.setSize(undefined);\n  } else {\n    const computedStyle = getComputedStyle(targetElement);\n    this.setSize([\n      targetElement.offsetWidth -\n          parseFloat(computedStyle['borderLeftWidth']) -\n          parseFloat(computedStyle['paddingLeft']) -\n          parseFloat(computedStyle['paddingRight']) -\n          parseFloat(computedStyle['borderRightWidth']),\n      targetElement.offsetHeight -\n          parseFloat(computedStyle['borderTopWidth']) -\n          parseFloat(computedStyle['paddingTop']) -\n          parseFloat(computedStyle['paddingBottom']) -\n          parseFloat(computedStyle['borderBottomWidth'])\n    ]);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n */\nPluggableMap.prototype.unskipFeature = function(feature) {\n  const featureUid = getUid(feature).toString();\n  delete this.skippedFeatureUids_[featureUid];\n  this.render();\n};\n\n\n/**\n * @param {MapOptions} options Map options.\n * @return {module:ol/PluggableMap~MapOptionsInternal} Internal map options.\n */\nfunction createOptionsInternal(options) {\n\n  /**\n   * @type {Element|Document}\n   */\n  let keyboardEventTarget = null;\n  if (options.keyboardEventTarget !== undefined) {\n    keyboardEventTarget = typeof options.keyboardEventTarget === 'string' ?\n      document.getElementById(options.keyboardEventTarget) :\n      options.keyboardEventTarget;\n  }\n\n  /**\n   * @type {Object.<string, *>}\n   */\n  const values = {};\n\n  const layerGroup = (options.layers instanceof LayerGroup) ?\n    options.layers : new LayerGroup({layers: options.layers});\n  values[MapProperty.LAYERGROUP] = layerGroup;\n\n  values[MapProperty.TARGET] = options.target;\n\n  values[MapProperty.VIEW] = options.view !== undefined ?\n    options.view : new View();\n\n  let controls;\n  if (options.controls !== undefined) {\n    if (Array.isArray(options.controls)) {\n      controls = new Collection(options.controls.slice());\n    } else {\n      assert(options.controls instanceof Collection,\n        47); // Expected `controls` to be an array or an `module:ol/Collection~Collection`\n      controls = options.controls;\n    }\n  }\n\n  let interactions;\n  if (options.interactions !== undefined) {\n    if (Array.isArray(options.interactions)) {\n      interactions = new Collection(options.interactions.slice());\n    } else {\n      assert(options.interactions instanceof Collection,\n        48); // Expected `interactions` to be an array or an `module:ol/Collection~Collection`\n      interactions = options.interactions;\n    }\n  }\n\n  let overlays;\n  if (options.overlays !== undefined) {\n    if (Array.isArray(options.overlays)) {\n      overlays = new Collection(options.overlays.slice());\n    } else {\n      assert(options.overlays instanceof Collection,\n        49); // Expected `overlays` to be an array or an `module:ol/Collection~Collection`\n      overlays = options.overlays;\n    }\n  } else {\n    overlays = new Collection();\n  }\n\n  return {\n    controls: controls,\n    interactions: interactions,\n    keyboardEventTarget: keyboardEventTarget,\n    overlays: overlays,\n    values: values\n  };\n\n}\nexport default PluggableMap;\n","/**\n * @module ol/control/Control\n */\nimport {inherits} from '../util.js';\nimport {UNDEFINED} from '../functions.js';\nimport MapEventType from '../MapEventType.js';\nimport BaseObject from '../Object.js';\nimport {removeNode} from '../dom.js';\nimport {listen, unlistenByKey} from '../events.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {Element} [element] The element is the control's\n * container element. This only needs to be specified if you're developing\n * a custom control.\n * @property {function(module:ol/MapEvent)} [render] Function called when\n * the control should be re-rendered. This is called in a `requestAnimationFrame`\n * callback.\n * @property {Element|string} [target] Specify a target if you want\n * the control to be rendered outside of the map's viewport.\n */\n\n\n/**\n * @classdesc\n * A control is a visible widget with a DOM element in a fixed position on the\n * screen. They can involve user input (buttons), or be informational only;\n * the position is determined using CSS. By default these are placed in the\n * container with CSS class name `ol-overlaycontainer-stopevent`, but can use\n * any outside DOM element.\n *\n * This is the base class for controls. You can use it for simple custom\n * controls by creating the element with listeners, creating an instance:\n * ```js\n * var myControl = new Control({element: myElement});\n * ```\n * and then adding this to the map.\n *\n * The main advantage of having this as a control rather than a simple separate\n * DOM element is that preventing propagation is handled for you. Controls\n * will also be objects in a {@link module:ol/Collection~Collection}, so you can use their methods.\n *\n * You can also extend this base for your own control class. See\n * examples/custom-controls for an example of how to do this.\n *\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/control/Control~Options} options Control options.\n * @api\n */\nconst Control = function(options) {\n\n  BaseObject.call(this);\n\n  /**\n   * @protected\n   * @type {Element}\n   */\n  this.element = options.element ? options.element : null;\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.target_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/PluggableMap}\n   */\n  this.map_ = null;\n\n  /**\n   * @protected\n   * @type {!Array.<module:ol/events~EventsKey>}\n   */\n  this.listenerKeys = [];\n\n  /**\n   * @type {function(module:ol/MapEvent)}\n   */\n  this.render = options.render ? options.render : UNDEFINED;\n\n  if (options.target) {\n    this.setTarget(options.target);\n  }\n\n};\n\ninherits(Control, BaseObject);\n\n\n/**\n * @inheritDoc\n */\nControl.prototype.disposeInternal = function() {\n  removeNode(this.element);\n  BaseObject.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * Get the map associated with this control.\n * @return {module:ol/PluggableMap} Map.\n * @api\n */\nControl.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * Remove the control from its current map and attach it to the new map.\n * Subclasses may set up event handlers to get notified about changes to\n * the map here.\n * @param {module:ol/PluggableMap} map Map.\n * @api\n */\nControl.prototype.setMap = function(map) {\n  if (this.map_) {\n    removeNode(this.element);\n  }\n  for (let i = 0, ii = this.listenerKeys.length; i < ii; ++i) {\n    unlistenByKey(this.listenerKeys[i]);\n  }\n  this.listenerKeys.length = 0;\n  this.map_ = map;\n  if (this.map_) {\n    const target = this.target_ ?\n      this.target_ : map.getOverlayContainerStopEvent();\n    target.appendChild(this.element);\n    if (this.render !== UNDEFINED) {\n      this.listenerKeys.push(listen(map,\n        MapEventType.POSTRENDER, this.render, this));\n    }\n    map.render();\n  }\n};\n\n\n/**\n * This function is used to set a target element for the control. It has no\n * effect if it is called after the control has been added to the map (i.e.\n * after `setMap` is called on the control). If no `target` is set in the\n * options passed to the control constructor and if `setTarget` is not called\n * then the control is added to the map's overlay container.\n * @param {Element|string} target Target.\n * @api\n */\nControl.prototype.setTarget = function(target) {\n  this.target_ = typeof target === 'string' ?\n    document.getElementById(target) :\n    target;\n};\nexport default Control;\n","/**\n * @module ol/layer/Layer\n */\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getUid, inherits} from '../util.js';\nimport {getChangeEventType} from '../Object.js';\nimport BaseLayer from '../layer/Base.js';\nimport LayerProperty from '../layer/Property.js';\nimport {assign} from '../obj.js';\nimport RenderEventType from '../render/EventType.js';\nimport SourceState from '../source/State.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {module:ol/source/Source} [source] Source for this layer.  If not provided to the constructor,\n * the source can be set by calling {@link module:ol/layer/Layer#setSource layer.setSource(source)} after\n * construction.\n */\n\n\n/**\n * @typedef {Object} State\n * @property {module:ol/layer/Layer} layer\n * @property {number} opacity\n * @property {module:ol/source/Source~State} sourceState\n * @property {boolean} visible\n * @property {boolean} managed\n * @property {module:ol/extent~Extent} [extent]\n * @property {number} zIndex\n * @property {number} maxResolution\n * @property {number} minResolution\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * A visual representation of raster or vector map data.\n * Layers group together those properties that pertain to how the data is to be\n * displayed, irrespective of the source of that data.\n *\n * Layers are usually added to a map with {@link module:ol/Map#addLayer}. Components\n * like {@link module:ol/interaction/Select~Select} use unmanaged layers\n * internally. These unmanaged layers are associated with the map using\n * {@link module:ol/layer/Layer~Layer#setMap} instead.\n *\n * A generic `change` event is fired when the state of the source changes.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/layer/Base}\n * @fires module:ol/render/Event~RenderEvent\n * @param {module:ol/layer/Layer~Options} options Layer options.\n * @api\n */\nconst Layer = function(options) {\n\n  const baseOptions = assign({}, options);\n  delete baseOptions.source;\n\n  BaseLayer.call(this, /** @type {module:ol/layer/Base~Options} */ (baseOptions));\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.mapPrecomposeKey_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.mapRenderKey_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.sourceChangeKey_ = null;\n\n  if (options.map) {\n    this.setMap(options.map);\n  }\n\n  listen(this,\n    getChangeEventType(LayerProperty.SOURCE),\n    this.handleSourcePropertyChange_, this);\n\n  const source = options.source ? options.source : null;\n  this.setSource(source);\n};\n\ninherits(Layer, BaseLayer);\n\n\n/**\n * Return `true` if the layer is visible, and if the passed resolution is\n * between the layer's minResolution and maxResolution. The comparison is\n * inclusive for `minResolution` and exclusive for `maxResolution`.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {number} resolution Resolution.\n * @return {boolean} The layer is visible at the given resolution.\n */\nexport function visibleAtResolution(layerState, resolution) {\n  return layerState.visible && resolution >= layerState.minResolution &&\n      resolution < layerState.maxResolution;\n}\n\n\n/**\n * @inheritDoc\n */\nLayer.prototype.getLayersArray = function(opt_array) {\n  const array = opt_array ? opt_array : [];\n  array.push(this);\n  return array;\n};\n\n\n/**\n * @inheritDoc\n */\nLayer.prototype.getLayerStatesArray = function(opt_states) {\n  const states = opt_states ? opt_states : [];\n  states.push(this.getLayerState());\n  return states;\n};\n\n\n/**\n * Get the layer source.\n * @return {module:ol/source/Source} The layer source (or `null` if not yet set).\n * @observable\n * @api\n */\nLayer.prototype.getSource = function() {\n  const source = this.get(LayerProperty.SOURCE);\n  return (\n    /** @type {module:ol/source/Source} */ (source) || null\n  );\n};\n\n\n/**\n  * @inheritDoc\n  */\nLayer.prototype.getSourceState = function() {\n  const source = this.getSource();\n  return !source ? SourceState.UNDEFINED : source.getState();\n};\n\n\n/**\n * @private\n */\nLayer.prototype.handleSourceChange_ = function() {\n  this.changed();\n};\n\n\n/**\n * @private\n */\nLayer.prototype.handleSourcePropertyChange_ = function() {\n  if (this.sourceChangeKey_) {\n    unlistenByKey(this.sourceChangeKey_);\n    this.sourceChangeKey_ = null;\n  }\n  const source = this.getSource();\n  if (source) {\n    this.sourceChangeKey_ = listen(source,\n      EventType.CHANGE, this.handleSourceChange_, this);\n  }\n  this.changed();\n};\n\n\n/**\n * Sets the layer to be rendered on top of other layers on a map. The map will\n * not manage this layer in its layers collection, and the callback in\n * {@link module:ol/Map#forEachLayerAtPixel} will receive `null` as layer. This\n * is useful for temporary layers. To remove an unmanaged layer from the map,\n * use `#setMap(null)`.\n *\n * To add the layer to a map and have it managed by the map, use\n * {@link module:ol/Map#addLayer} instead.\n * @param {module:ol/PluggableMap} map Map.\n * @api\n */\nLayer.prototype.setMap = function(map) {\n  if (this.mapPrecomposeKey_) {\n    unlistenByKey(this.mapPrecomposeKey_);\n    this.mapPrecomposeKey_ = null;\n  }\n  if (!map) {\n    this.changed();\n  }\n  if (this.mapRenderKey_) {\n    unlistenByKey(this.mapRenderKey_);\n    this.mapRenderKey_ = null;\n  }\n  if (map) {\n    this.mapPrecomposeKey_ = listen(map, RenderEventType.PRECOMPOSE, function(evt) {\n      const layerState = this.getLayerState();\n      layerState.managed = false;\n      layerState.zIndex = Infinity;\n      evt.frameState.layerStatesArray.push(layerState);\n      evt.frameState.layerStates[getUid(this)] = layerState;\n    }, this);\n    this.mapRenderKey_ = listen(this, EventType.CHANGE, map.render, map);\n    this.changed();\n  }\n};\n\n\n/**\n * Set the layer source.\n * @param {module:ol/source/Source} source The layer source.\n * @observable\n * @api\n */\nLayer.prototype.setSource = function(source) {\n  this.set(LayerProperty.SOURCE, source);\n};\nexport default Layer;\n","/**\n * @module ol/control/Attribution\n */\nimport {inherits} from '../util.js';\nimport {equals} from '../array.js';\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE, CLASS_COLLAPSED} from '../css.js';\nimport {removeChildren, replaceNode} from '../dom.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {visibleAtResolution} from '../layer/Layer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-attribution'] CSS class name.\n * @property {Element|string} [target] Specify a target if you\n * want the control to be rendered outside of the map's\n * viewport.\n * @property {boolean} [collapsible=true] Specify if attributions can\n * be collapsed. If you use an OSM source, should be set to `false`  see\n * {@link https://www.openstreetmap.org/copyright OSM Copyright} \n * @property {boolean} [collapsed=true] Specify if attributions should\n * be collapsed at startup.\n * @property {string} [tipLabel='Attributions'] Text label to use for the button tip.\n * @property {string} [label='i'] Text label to use for the\n * collapsed attributions button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string|Element} [collapseLabel=''] Text label to use\n * for the expanded attributions button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {function(module:ol/MapEvent)} [render] Function called when\n * the control should be re-rendered. This is called in a `requestAnimationFrame`\n * callback.\n */\n\n\n/**\n * @classdesc\n * Control to show all the attributions associated with the layer sources\n * in the map. This control is one of the default controls included in maps.\n * By default it will show in the bottom right portion of the map, but this can\n * be changed by using a css selector for `.ol-attribution`.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/Attribution~Options=} opt_options Attribution options.\n * @api\n */\nconst Attribution = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.ulElement_ = document.createElement('UL');\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.collapsed_ = options.collapsed !== undefined ? options.collapsed : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.collapsible_ = options.collapsible !== undefined ?\n    options.collapsible : true;\n\n  if (!this.collapsible_) {\n    this.collapsed_ = false;\n  }\n\n  const className = options.className !== undefined ? options.className : 'ol-attribution';\n\n  const tipLabel = options.tipLabel !== undefined ? options.tipLabel : 'Attributions';\n\n  const collapseLabel = options.collapseLabel !== undefined ? options.collapseLabel : '\\u00BB';\n\n  if (typeof collapseLabel === 'string') {\n    /**\n     * @private\n     * @type {Element}\n     */\n    this.collapseLabel_ = document.createElement('span');\n    this.collapseLabel_.textContent = collapseLabel;\n  } else {\n    this.collapseLabel_ = collapseLabel;\n  }\n\n  const label = options.label !== undefined ? options.label : 'i';\n\n  if (typeof label === 'string') {\n    /**\n     * @private\n     * @type {Element}\n     */\n    this.label_ = document.createElement('span');\n    this.label_.textContent = label;\n  } else {\n    this.label_ = label;\n  }\n\n\n  const activeLabel = (this.collapsible_ && !this.collapsed_) ?\n    this.collapseLabel_ : this.label_;\n  const button = document.createElement('button');\n  button.setAttribute('type', 'button');\n  button.title = tipLabel;\n  button.appendChild(activeLabel);\n\n  listen(button, EventType.CLICK, this.handleClick_, this);\n\n  const cssClasses = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL +\n      (this.collapsed_ && this.collapsible_ ? ' ' + CLASS_COLLAPSED : '') +\n      (this.collapsible_ ? '' : ' ol-uncollapsible');\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(this.ulElement_);\n  element.appendChild(button);\n\n  Control.call(this, {\n    element: element,\n    render: options.render || render,\n    target: options.target\n  });\n\n  /**\n   * A list of currently rendered resolutions.\n   * @type {Array.<string>}\n   * @private\n   */\n  this.renderedAttributions_ = [];\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = true;\n\n};\n\ninherits(Attribution, Control);\n\n\n/**\n * Get a list of visible attributions.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @return {Array.<string>} Attributions.\n * @private\n */\nAttribution.prototype.getSourceAttributions_ = function(frameState) {\n  /**\n   * Used to determine if an attribution already exists.\n   * @type {!Object.<string, boolean>}\n   */\n  const lookup = {};\n\n  /**\n   * A list of visible attributions.\n   * @type {Array.<string>}\n   */\n  const visibleAttributions = [];\n\n  const layerStatesArray = frameState.layerStatesArray;\n  const resolution = frameState.viewState.resolution;\n  for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    const layerState = layerStatesArray[i];\n    if (!visibleAtResolution(layerState, resolution)) {\n      continue;\n    }\n\n    const source = layerState.layer.getSource();\n    if (!source) {\n      continue;\n    }\n\n    const attributionGetter = source.getAttributions();\n    if (!attributionGetter) {\n      continue;\n    }\n\n    const attributions = attributionGetter(frameState);\n    if (!attributions) {\n      continue;\n    }\n\n    if (Array.isArray(attributions)) {\n      for (let j = 0, jj = attributions.length; j < jj; ++j) {\n        if (!(attributions[j] in lookup)) {\n          visibleAttributions.push(attributions[j]);\n          lookup[attributions[j]] = true;\n        }\n      }\n    } else {\n      if (!(attributions in lookup)) {\n        visibleAttributions.push(attributions);\n        lookup[attributions] = true;\n      }\n    }\n  }\n  return visibleAttributions;\n};\n\n\n/**\n * Update the attribution element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/Attribution}\n * @api\n */\nexport function render(mapEvent) {\n  this.updateElement_(mapEvent.frameState);\n}\n\n\n/**\n * @private\n * @param {?module:ol/PluggableMap~FrameState} frameState Frame state.\n */\nAttribution.prototype.updateElement_ = function(frameState) {\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.element.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return;\n  }\n\n  const attributions = this.getSourceAttributions_(frameState);\n\n  const visible = attributions.length > 0;\n  if (this.renderedVisible_ != visible) {\n    this.element.style.display = visible ? '' : 'none';\n    this.renderedVisible_ = visible;\n  }\n\n  if (equals(attributions, this.renderedAttributions_)) {\n    return;\n  }\n\n  removeChildren(this.ulElement_);\n\n  // append the attributions\n  for (let i = 0, ii = attributions.length; i < ii; ++i) {\n    const element = document.createElement('LI');\n    element.innerHTML = attributions[i];\n    this.ulElement_.appendChild(element);\n  }\n\n  this.renderedAttributions_ = attributions;\n};\n\n\n/**\n * @param {Event} event The event to handle\n * @private\n */\nAttribution.prototype.handleClick_ = function(event) {\n  event.preventDefault();\n  this.handleToggle_();\n};\n\n\n/**\n * @private\n */\nAttribution.prototype.handleToggle_ = function() {\n  this.element.classList.toggle(CLASS_COLLAPSED);\n  if (this.collapsed_) {\n    replaceNode(this.collapseLabel_, this.label_);\n  } else {\n    replaceNode(this.label_, this.collapseLabel_);\n  }\n  this.collapsed_ = !this.collapsed_;\n};\n\n\n/**\n * Return `true` if the attribution is collapsible, `false` otherwise.\n * @return {boolean} True if the widget is collapsible.\n * @api\n */\nAttribution.prototype.getCollapsible = function() {\n  return this.collapsible_;\n};\n\n\n/**\n * Set whether the attribution should be collapsible.\n * @param {boolean} collapsible True if the widget is collapsible.\n * @api\n */\nAttribution.prototype.setCollapsible = function(collapsible) {\n  if (this.collapsible_ === collapsible) {\n    return;\n  }\n  this.collapsible_ = collapsible;\n  this.element.classList.toggle('ol-uncollapsible');\n  if (!collapsible && this.collapsed_) {\n    this.handleToggle_();\n  }\n};\n\n\n/**\n * Collapse or expand the attribution according to the passed parameter. Will\n * not do anything if the attribution isn't collapsible or if the current\n * collapsed state is already the one requested.\n * @param {boolean} collapsed True if the widget is collapsed.\n * @api\n */\nAttribution.prototype.setCollapsed = function(collapsed) {\n  if (!this.collapsible_ || this.collapsed_ === collapsed) {\n    return;\n  }\n  this.handleToggle_();\n};\n\n\n/**\n * Return `true` when the attribution is currently collapsed or `false`\n * otherwise.\n * @return {boolean} True if the widget is collapsed.\n * @api\n */\nAttribution.prototype.getCollapsed = function() {\n  return this.collapsed_;\n};\nexport default Attribution;\n","/**\n * @module ol/control/Rotate\n */\n\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_HIDDEN, CLASS_UNSELECTABLE} from '../css.js';\nimport {easeOut} from '../easing.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {inherits} from '../util.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-rotate'] CSS class name.\n * @property {string|Element} [label=''] Text label to use for the rotate button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string} [tipLabel='Reset rotation'] Text label to use for the rotate tip.\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {boolean} [autoHide=true] Hide the control when rotation is 0.\n * @property {function(module:ol/MapEvent)} [render] Function called when the control should\n * be re-rendered. This is called in a `requestAnimationFrame` callback.\n * @property {function()} [resetNorth] Function called when the control is clicked.\n * This will override the default `resetNorth`.\n * @property {Element|string} [target] Specify a target if you want the control to be\n * rendered outside of the map's viewport.\n */\n\n\n/**\n * @classdesc\n * A button control to reset rotation to 0.\n * To style this control use css selector `.ol-rotate`. A `.ol-hidden` css\n * selector is added to the button when the rotation is 0.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/Rotate~Options=} opt_options Rotate options.\n * @api\n */\nconst Rotate = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const className = options.className !== undefined ? options.className : 'ol-rotate';\n\n  const label = options.label !== undefined ? options.label : '\\u21E7';\n\n  /**\n   * @type {Element}\n   * @private\n   */\n  this.label_ = null;\n\n  if (typeof label === 'string') {\n    this.label_ = document.createElement('span');\n    this.label_.className = 'ol-compass';\n    this.label_.textContent = label;\n  } else {\n    this.label_ = label;\n    this.label_.classList.add('ol-compass');\n  }\n\n  const tipLabel = options.tipLabel ? options.tipLabel : 'Reset rotation';\n\n  const button = document.createElement('button');\n  button.className = className + '-reset';\n  button.setAttribute('type', 'button');\n  button.title = tipLabel;\n  button.appendChild(this.label_);\n\n  listen(button, EventType.CLICK,\n    Rotate.prototype.handleClick_, this);\n\n  const cssClasses = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL;\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(button);\n\n  this.callResetNorth_ = options.resetNorth ? options.resetNorth : undefined;\n\n  Control.call(this, {\n    element: element,\n    render: options.render || render,\n    target: options.target\n  });\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.autoHide_ = options.autoHide !== undefined ? options.autoHide : true;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.rotation_ = undefined;\n\n  if (this.autoHide_) {\n    this.element.classList.add(CLASS_HIDDEN);\n  }\n\n};\n\ninherits(Rotate, Control);\n\n\n/**\n * @param {Event} event The event to handle\n * @private\n */\nRotate.prototype.handleClick_ = function(event) {\n  event.preventDefault();\n  if (this.callResetNorth_ !== undefined) {\n    this.callResetNorth_();\n  } else {\n    this.resetNorth_();\n  }\n};\n\n\n/**\n * @private\n */\nRotate.prototype.resetNorth_ = function() {\n  const map = this.getMap();\n  const view = map.getView();\n  if (!view) {\n    // the map does not have a view, so we can't act\n    // upon it\n    return;\n  }\n  if (view.getRotation() !== undefined) {\n    if (this.duration_ > 0) {\n      view.animate({\n        rotation: 0,\n        duration: this.duration_,\n        easing: easeOut\n      });\n    } else {\n      view.setRotation(0);\n    }\n  }\n};\n\n\n/**\n * Update the rotate control element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/Rotate}\n * @api\n */\nexport function render(mapEvent) {\n  const frameState = mapEvent.frameState;\n  if (!frameState) {\n    return;\n  }\n  const rotation = frameState.viewState.rotation;\n  if (rotation != this.rotation_) {\n    const transform = 'rotate(' + rotation + 'rad)';\n    if (this.autoHide_) {\n      const contains = this.element.classList.contains(CLASS_HIDDEN);\n      if (!contains && rotation === 0) {\n        this.element.classList.add(CLASS_HIDDEN);\n      } else if (contains && rotation !== 0) {\n        this.element.classList.remove(CLASS_HIDDEN);\n      }\n    }\n    this.label_.style.msTransform = transform;\n    this.label_.style.webkitTransform = transform;\n    this.label_.style.transform = transform;\n  }\n  this.rotation_ = rotation;\n}\n\nexport default Rotate;\n","/**\n * @module ol/control/Zoom\n */\nimport {inherits} from '../util.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE} from '../css.js';\nimport {easeOut} from '../easing.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {string} [className='ol-zoom'] CSS class name.\n * @property {string|Element} [zoomInLabel='+'] Text label to use for the zoom-in\n * button. Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string|Element} [zoomOutLabel='-'] Text label to use for the zoom-out button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string} [zoomInTipLabel='Zoom in'] Text label to use for the button tip.\n * @property {string} [zoomOutTipLabel='Zoom out'] Text label to use for the button tip.\n * @property {number} [delta=1] The zoom delta applied on each click.\n * @property {Element|string} [target] Specify a target if you want the control to be\n * rendered outside of the map's viewport.\n */\n\n\n/**\n * @classdesc\n * A control with 2 buttons, one for zoom in and one for zoom out.\n * This control is one of the default controls of a map. To style this control\n * use css selectors `.ol-zoom-in` and `.ol-zoom-out`.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/Zoom~Options=} opt_options Zoom options.\n * @api\n */\nconst Zoom = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const className = options.className !== undefined ? options.className : 'ol-zoom';\n\n  const delta = options.delta !== undefined ? options.delta : 1;\n\n  const zoomInLabel = options.zoomInLabel !== undefined ? options.zoomInLabel : '+';\n  const zoomOutLabel = options.zoomOutLabel !== undefined ? options.zoomOutLabel : '\\u2212';\n\n  const zoomInTipLabel = options.zoomInTipLabel !== undefined ?\n    options.zoomInTipLabel : 'Zoom in';\n  const zoomOutTipLabel = options.zoomOutTipLabel !== undefined ?\n    options.zoomOutTipLabel : 'Zoom out';\n\n  const inElement = document.createElement('button');\n  inElement.className = className + '-in';\n  inElement.setAttribute('type', 'button');\n  inElement.title = zoomInTipLabel;\n  inElement.appendChild(\n    typeof zoomInLabel === 'string' ? document.createTextNode(zoomInLabel) : zoomInLabel\n  );\n\n  listen(inElement, EventType.CLICK,\n    Zoom.prototype.handleClick_.bind(this, delta));\n\n  const outElement = document.createElement('button');\n  outElement.className = className + '-out';\n  outElement.setAttribute('type', 'button');\n  outElement.title = zoomOutTipLabel;\n  outElement.appendChild(\n    typeof zoomOutLabel === 'string' ? document.createTextNode(zoomOutLabel) : zoomOutLabel\n  );\n\n  listen(outElement, EventType.CLICK,\n    Zoom.prototype.handleClick_.bind(this, -delta));\n\n  const cssClasses = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL;\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(inElement);\n  element.appendChild(outElement);\n\n  Control.call(this, {\n    element: element,\n    target: options.target\n  });\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n};\n\ninherits(Zoom, Control);\n\n\n/**\n * @param {number} delta Zoom delta.\n * @param {Event} event The event to handle\n * @private\n */\nZoom.prototype.handleClick_ = function(delta, event) {\n  event.preventDefault();\n  this.zoomByDelta_(delta);\n};\n\n\n/**\n * @param {number} delta Zoom delta.\n * @private\n */\nZoom.prototype.zoomByDelta_ = function(delta) {\n  const map = this.getMap();\n  const view = map.getView();\n  if (!view) {\n    // the map does not have a view, so we can't act\n    // upon it\n    return;\n  }\n  const currentResolution = view.getResolution();\n  if (currentResolution) {\n    const newResolution = view.constrainResolution(currentResolution, delta);\n    if (this.duration_ > 0) {\n      if (view.getAnimating()) {\n        view.cancelAnimations();\n      }\n      view.animate({\n        resolution: newResolution,\n        duration: this.duration_,\n        easing: easeOut\n      });\n    } else {\n      view.setResolution(newResolution);\n    }\n  }\n};\nexport default Zoom;\n","/**\n * @module ol/control/util\n */\nimport Collection from '../Collection.js';\nimport Attribution from './Attribution.js';\nimport Rotate from './Rotate.js';\nimport Zoom from './Zoom.js';\n\n\n/**\n * @typedef {Object} DefaultsOptions\n * @property {boolean} [attribution=true] Include\n * {@link module:ol/control/Attribution~Attribution}.\n * @property {module:ol/control/Attribution~Options} [attributionOptions]\n * Options for {@link module:ol/control/Attribution~Attribution}.\n * @property {boolean} [rotate=true] Include\n * {@link module:ol/control/Rotate~Rotate}.\n * @property {module:ol/control/Rotate~Options} [rotateOptions] Options\n * for {@link module:ol/control/Rotate~Rotate}.\n * @property {boolean} [zoom] Include {@link module:ol/control/Zoom~Zoom}.\n * @property {module:ol/control/Zoom~Options} [zoomOptions] Options for\n * {@link module:ol/control/Zoom~Zoom}.\n * @api\n */\n\n\n/**\n * Set of controls included in maps by default. Unless configured otherwise,\n * this returns a collection containing an instance of each of the following\n * controls:\n * * {@link module:ol/control/Zoom~Zoom}\n * * {@link module:ol/control/Rotate~Rotate}\n * * {@link module:ol/control/Attribution~Attribution}\n *\n * @param {module:ol/control/util~DefaultsOptions=} opt_options\n * Defaults options.\n * @return {module:ol/Collection.<module:ol/control/Control>}\n * Controls.\n * @function module:ol/control.defaults\n * @api\n */\nexport function defaults(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const controls = new Collection();\n\n  const zoomControl = options.zoom !== undefined ? options.zoom : true;\n  if (zoomControl) {\n    controls.push(new Zoom(options.zoomOptions));\n  }\n\n  const rotateControl = options.rotate !== undefined ? options.rotate : true;\n  if (rotateControl) {\n    controls.push(new Rotate(options.rotateOptions));\n  }\n\n  const attributionControl = options.attribution !== undefined ?\n    options.attribution : true;\n  if (attributionControl) {\n    controls.push(new Attribution(options.attributionOptions));\n  }\n\n  return controls;\n}\n","/**\n * @module ol/interaction/Property\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  ACTIVE: 'active'\n};\n","/**\n * @module ol/interaction/Interaction\n */\nimport {inherits} from '../util.js';\nimport BaseObject from '../Object.js';\nimport {easeOut, linear} from '../easing.js';\nimport InteractionProperty from '../interaction/Property.js';\nimport {clamp} from '../math.js';\n\n\n/**\n * Object literal with config options for interactions.\n * @typedef {Object} InteractionOptions\n * @property {function(module:ol/MapBrowserEvent):boolean} handleEvent\n * Method called by the map to notify the interaction that a browser event was\n * dispatched to the map. If the function returns a falsy value, propagation of\n * the event to other interactions in the map's interactions chain will be\n * prevented (this includes functions with no explicit return).\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * User actions that change the state of the map. Some are similar to controls,\n * but are not associated with a DOM element.\n * For example, {@link module:ol/interaction/KeyboardZoom~KeyboardZoom} is\n * functionally the same as {@link module:ol/control/Zoom~Zoom}, but triggered\n * by a keyboard event not a button element event.\n * Although interactions do not have a DOM element, some of them do render\n * vectors and so are visible on the screen.\n *\n * @constructor\n * @param {module:ol/interaction/Interaction~InteractionOptions} options Options.\n * @extends {module:ol/Object}\n * @api\n */\nconst Interaction = function(options) {\n\n  BaseObject.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/PluggableMap}\n   */\n  this.map_ = null;\n\n  this.setActive(true);\n\n  /**\n   * @type {function(module:ol/MapBrowserEvent):boolean}\n   */\n  this.handleEvent = options.handleEvent;\n\n};\n\ninherits(Interaction, BaseObject);\n\n\n/**\n * Return whether the interaction is currently active.\n * @return {boolean} `true` if the interaction is active, `false` otherwise.\n * @observable\n * @api\n */\nInteraction.prototype.getActive = function() {\n  return /** @type {boolean} */ (this.get(InteractionProperty.ACTIVE));\n};\n\n\n/**\n * Get the map associated with this interaction.\n * @return {module:ol/PluggableMap} Map.\n * @api\n */\nInteraction.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * Activate or deactivate the interaction.\n * @param {boolean} active Active.\n * @observable\n * @api\n */\nInteraction.prototype.setActive = function(active) {\n  this.set(InteractionProperty.ACTIVE, active);\n};\n\n\n/**\n * Remove the interaction from its current map and attach it to the new map.\n * Subclasses may set up event handlers to get notified about changes to\n * the map here.\n * @param {module:ol/PluggableMap} map Map.\n */\nInteraction.prototype.setMap = function(map) {\n  this.map_ = map;\n};\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {module:ol/coordinate~Coordinate} delta Delta.\n * @param {number=} opt_duration Duration.\n */\nexport function pan(view, delta, opt_duration) {\n  const currentCenter = view.getCenter();\n  if (currentCenter) {\n    const center = view.constrainCenter(\n      [currentCenter[0] + delta[0], currentCenter[1] + delta[1]]);\n    if (opt_duration) {\n      view.animate({\n        duration: opt_duration,\n        easing: linear,\n        center: center\n      });\n    } else {\n      view.setCenter(center);\n    }\n  }\n}\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {number|undefined} rotation Rotation.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor Anchor coordinate.\n * @param {number=} opt_duration Duration.\n */\nexport function rotate(view, rotation, opt_anchor, opt_duration) {\n  rotation = view.constrainRotation(rotation, 0);\n  rotateWithoutConstraints(view, rotation, opt_anchor, opt_duration);\n}\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {number|undefined} rotation Rotation.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor Anchor coordinate.\n * @param {number=} opt_duration Duration.\n */\nexport function rotateWithoutConstraints(view, rotation, opt_anchor, opt_duration) {\n  if (rotation !== undefined) {\n    const currentRotation = view.getRotation();\n    const currentCenter = view.getCenter();\n    if (currentRotation !== undefined && currentCenter && opt_duration > 0) {\n      view.animate({\n        rotation: rotation,\n        anchor: opt_anchor,\n        duration: opt_duration,\n        easing: easeOut\n      });\n    } else {\n      view.rotate(rotation, opt_anchor);\n    }\n  }\n}\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {number|undefined} resolution Resolution to go to.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor Anchor coordinate.\n * @param {number=} opt_duration Duration.\n * @param {number=} opt_direction Zooming direction; > 0 indicates\n *     zooming out, in which case the constraints system will select\n *     the largest nearest resolution; < 0 indicates zooming in, in\n *     which case the constraints system will select the smallest\n *     nearest resolution; == 0 indicates that the zooming direction\n *     is unknown/not relevant, in which case the constraints system\n *     will select the nearest resolution. If not defined 0 is\n *     assumed.\n */\nexport function zoom(view, resolution, opt_anchor, opt_duration, opt_direction) {\n  resolution = view.constrainResolution(resolution, 0, opt_direction);\n  zoomWithoutConstraints(view, resolution, opt_anchor, opt_duration);\n}\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {number} delta Delta from previous zoom level.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor Anchor coordinate.\n * @param {number=} opt_duration Duration.\n */\nexport function zoomByDelta(view, delta, opt_anchor, opt_duration) {\n  const currentResolution = view.getResolution();\n  let resolution = view.constrainResolution(currentResolution, delta, 0);\n\n  if (resolution !== undefined) {\n    const resolutions = view.getResolutions();\n    resolution = clamp(\n      resolution,\n      view.getMinResolution() || resolutions[resolutions.length - 1],\n      view.getMaxResolution() || resolutions[0]);\n  }\n\n  // If we have a constraint on center, we need to change the anchor so that the\n  // new center is within the extent. We first calculate the new center, apply\n  // the constraint to it, and then calculate back the anchor\n  if (opt_anchor && resolution !== undefined && resolution !== currentResolution) {\n    const currentCenter = view.getCenter();\n    let center = view.calculateCenterZoom(resolution, opt_anchor);\n    center = view.constrainCenter(center);\n\n    opt_anchor = [\n      (resolution * currentCenter[0] - currentResolution * center[0]) /\n          (resolution - currentResolution),\n      (resolution * currentCenter[1] - currentResolution * center[1]) /\n          (resolution - currentResolution)\n    ];\n  }\n\n  zoomWithoutConstraints(view, resolution, opt_anchor, opt_duration);\n}\n\n\n/**\n * @param {module:ol/View} view View.\n * @param {number|undefined} resolution Resolution to go to.\n * @param {module:ol/coordinate~Coordinate=} opt_anchor Anchor coordinate.\n * @param {number=} opt_duration Duration.\n */\nexport function zoomWithoutConstraints(view, resolution, opt_anchor, opt_duration) {\n  if (resolution) {\n    const currentResolution = view.getResolution();\n    const currentCenter = view.getCenter();\n    if (currentResolution !== undefined && currentCenter &&\n        resolution !== currentResolution && opt_duration) {\n      view.animate({\n        resolution: resolution,\n        anchor: opt_anchor,\n        duration: opt_duration,\n        easing: easeOut\n      });\n    } else {\n      if (opt_anchor) {\n        const center = view.calculateCenterZoom(resolution, opt_anchor);\n        view.setCenter(center);\n      }\n      view.setResolution(resolution);\n    }\n  }\n}\n\nexport default Interaction;\n","/**\n * @module ol/interaction/DoubleClickZoom\n */\nimport {inherits} from '../util.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport Interaction, {zoomByDelta} from '../interaction/Interaction.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {number} [delta=1] The zoom delta applied on each double click.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom by double-clicking on the map.\n *\n * @constructor\n * @extends {module:ol/interaction/Interaction}\n * @param {module:ol/interaction/DoubleClickZoom~Options=} opt_options Options.\n * @api\n */\nconst DoubleClickZoom = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delta_ = options.delta ? options.delta : 1;\n\n  Interaction.call(this, {\n    handleEvent: handleEvent\n  });\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n};\n\ninherits(DoubleClickZoom, Interaction);\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} (if it was a\n * doubleclick) and eventually zooms the map.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/DoubleClickZoom}\n */\nfunction handleEvent(mapBrowserEvent) {\n  let stopEvent = false;\n  const browserEvent = mapBrowserEvent.originalEvent;\n  if (mapBrowserEvent.type == MapBrowserEventType.DBLCLICK) {\n    const map = mapBrowserEvent.map;\n    const anchor = mapBrowserEvent.coordinate;\n    const delta = browserEvent.shiftKey ? -this.delta_ : this.delta_;\n    const view = map.getView();\n    zoomByDelta(view, delta, anchor, this.duration_);\n    mapBrowserEvent.preventDefault();\n    stopEvent = true;\n  }\n  return !stopEvent;\n}\n\nexport default DoubleClickZoom;\n","/**\n * @module ol/events/condition\n */\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport {assert} from '../asserts.js';\nimport {TRUE, FALSE} from '../functions.js';\nimport {WEBKIT, MAC} from '../has.js';\n\n\n/**\n * A function that takes an {@link module:ol/MapBrowserEvent} and returns a\n * `{boolean}`. If the condition is met, true should be returned.\n *\n * @typedef {function(this: ?, module:ol/MapBrowserEvent): boolean} Condition\n */\n\n\n/**\n * Return `true` if only the alt-key is pressed, `false` otherwise (e.g. when\n * additionally the shift-key is pressed).\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if only the alt key is pressed.\n * @api\n */\nexport const altKeyOnly = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return (\n    originalEvent.altKey &&\n      !(originalEvent.metaKey || originalEvent.ctrlKey) &&\n      !originalEvent.shiftKey);\n};\n\n\n/**\n * Return `true` if only the alt-key and shift-key is pressed, `false` otherwise\n * (e.g. when additionally the platform-modifier-key is pressed).\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if only the alt and shift keys are pressed.\n * @api\n */\nexport const altShiftKeysOnly = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return (\n    originalEvent.altKey &&\n      !(originalEvent.metaKey || originalEvent.ctrlKey) &&\n      originalEvent.shiftKey);\n};\n\n\n/**\n * Return `true` if the map has the focus. This condition requires a map target\n * element with a `tabindex` attribute, e.g. `<div id=\"map\" tabindex=\"1\">`.\n *\n * @param {module:ol/MapBrowserEvent} event Map browser event.\n * @return {boolean} The map has the focus.\n * @api\n */\nexport const focus = function(event) {\n  return event.target.getTargetElement() === document.activeElement;\n};\n\n\n/**\n * Return always true.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True.\n * @function\n * @api\n */\nexport const always = TRUE;\n\n\n/**\n * Return `true` if the event is a `click` event, `false` otherwise.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the event is a map `click` event.\n * @api\n */\nexport const click = function(mapBrowserEvent) {\n  return mapBrowserEvent.type == MapBrowserEventType.CLICK;\n};\n\n\n/**\n * Return `true` if the event has an \"action\"-producing mouse button.\n *\n * By definition, this includes left-click on windows/linux, and left-click\n * without the ctrl key on Macs.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} The result.\n */\nexport const mouseActionButton = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return originalEvent.button == 0 &&\n      !(WEBKIT && MAC && originalEvent.ctrlKey);\n};\n\n\n/**\n * Return always false.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} False.\n * @function\n * @api\n */\nexport const never = FALSE;\n\n\n/**\n * Return `true` if the browser event is a `pointermove` event, `false`\n * otherwise.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the browser event is a `pointermove` event.\n * @api\n */\nexport const pointerMove = function(mapBrowserEvent) {\n  return mapBrowserEvent.type == 'pointermove';\n};\n\n\n/**\n * Return `true` if the event is a map `singleclick` event, `false` otherwise.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the event is a map `singleclick` event.\n * @api\n */\nexport const singleClick = function(mapBrowserEvent) {\n  return mapBrowserEvent.type == MapBrowserEventType.SINGLECLICK;\n};\n\n\n/**\n * Return `true` if the event is a map `dblclick` event, `false` otherwise.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the event is a map `dblclick` event.\n * @api\n */\nexport const doubleClick = function(mapBrowserEvent) {\n  return mapBrowserEvent.type == MapBrowserEventType.DBLCLICK;\n};\n\n\n/**\n * Return `true` if no modifier key (alt-, shift- or platform-modifier-key) is\n * pressed.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True only if there no modifier keys are pressed.\n * @api\n */\nexport const noModifierKeys = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return (\n    !originalEvent.altKey &&\n      !(originalEvent.metaKey || originalEvent.ctrlKey) &&\n      !originalEvent.shiftKey);\n};\n\n\n/**\n * Return `true` if only the platform-modifier-key (the meta-key on Mac,\n * ctrl-key otherwise) is pressed, `false` otherwise (e.g. when additionally\n * the shift-key is pressed).\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if only the platform modifier key is pressed.\n * @api\n */\nexport const platformModifierKeyOnly = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey;\n};\n\n\n/**\n * Return `true` if only the shift-key is pressed, `false` otherwise (e.g. when\n * additionally the alt-key is pressed).\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if only the shift key is pressed.\n * @api\n */\nexport const shiftKeyOnly = function(mapBrowserEvent) {\n  const originalEvent = mapBrowserEvent.originalEvent;\n  return (\n    !originalEvent.altKey &&\n      !(originalEvent.metaKey || originalEvent.ctrlKey) &&\n      originalEvent.shiftKey);\n};\n\n\n/**\n * Return `true` if the target element is not editable, i.e. not a `<input>`-,\n * `<select>`- or `<textarea>`-element, `false` otherwise.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True only if the target element is not editable.\n * @api\n */\nexport const targetNotEditable = function(mapBrowserEvent) {\n  const target = mapBrowserEvent.originalEvent.target;\n  const tagName = target.tagName;\n  return (\n    tagName !== 'INPUT' &&\n      tagName !== 'SELECT' &&\n      tagName !== 'TEXTAREA');\n};\n\n\n/**\n * Return `true` if the event originates from a mouse device.\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the event originates from a mouse device.\n * @api\n */\nexport const mouseOnly = function(mapBrowserEvent) {\n  assert(mapBrowserEvent.pointerEvent, 56); // mapBrowserEvent must originate from a pointer event\n  // see http://www.w3.org/TR/pointerevents/#widl-PointerEvent-pointerType\n  return (\n    /** @type {module:ol/MapBrowserEvent} */ (mapBrowserEvent).pointerEvent.pointerType == 'mouse'\n  );\n};\n\n\n/**\n * Return `true` if the event originates from a primary pointer in\n * contact with the surface or if the left mouse button is pressed.\n * @see http://www.w3.org/TR/pointerevents/#button-states\n *\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} True if the event originates from a primary pointer.\n * @api\n */\nexport const primaryAction = function(mapBrowserEvent) {\n  const pointerEvent = mapBrowserEvent.pointerEvent;\n  return pointerEvent.isPrimary && pointerEvent.button === 0;\n};\n","/**\n * @module ol/interaction/Pointer\n */\nimport {inherits} from '../util.js';\nimport {FALSE, UNDEFINED} from '../functions.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport MapBrowserPointerEvent from '../MapBrowserPointerEvent.js';\nimport Interaction from '../interaction/Interaction.js';\nimport {getValues} from '../obj.js';\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/Pointer}\n */\nconst handleDragEvent = UNDEFINED;\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Capture dragging.\n * @this {module:ol/interaction/Pointer}\n */\nconst handleUpEvent = FALSE;\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Capture dragging.\n * @this {module:ol/interaction/Pointer}\n */\nconst handleDownEvent = FALSE;\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/Pointer}\n */\nconst handleMoveEvent = UNDEFINED;\n\n\n/**\n * @typedef {Object} Options\n * @property {(function(module:ol/MapBrowserPointerEvent):boolean)} [handleDownEvent]\n * Function handling \"down\" events. If the function returns `true` then a drag\n * sequence is started.\n * @property {(function(module:ol/MapBrowserPointerEvent))} [handleDragEvent]\n * Function handling \"drag\" events. This function is called on \"move\" events\n * during a drag sequence.\n * @property {(function(module:ol/MapBrowserEvent):boolean)} [handleEvent]\n * Method called by the map to notify the interaction that a browser event was\n * dispatched to the map. The function may return `false` to prevent the\n * propagation of the event to other interactions in the map's interactions\n * chain.\n * @property {(function(module:ol/MapBrowserPointerEvent))} [handleMoveEvent]\n * Function handling \"move\" events. This function is called on \"move\" events,\n * also during a drag sequence (so during a drag sequence both the\n * `handleDragEvent` function and this function are called).\n * @property {(function(module:ol/MapBrowserPointerEvent):boolean)} [handleUpEvent]\n *  Function handling \"up\" events. If the function returns `false` then the\n * current drag sequence is stopped.\n */\n\n\n/**\n * @classdesc\n * Base class that calls user-defined functions on `down`, `move` and `up`\n * events. This class also manages \"drag sequences\".\n *\n * When the `handleDownEvent` user function returns `true` a drag sequence is\n * started. During a drag sequence the `handleDragEvent` user function is\n * called on `move` events. The drag sequence ends when the `handleUpEvent`\n * user function is called and returns `false`.\n *\n * @constructor\n * @param {module:ol/interaction/Pointer~Options=} opt_options Options.\n * @extends {module:ol/interaction/Interaction}\n * @api\n */\nconst PointerInteraction = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  Interaction.call(this, {\n    handleEvent: options.handleEvent || handleEvent\n  });\n\n  /**\n   * @type {function(module:ol/MapBrowserPointerEvent):boolean}\n   * @private\n   */\n  this.handleDownEvent_ = options.handleDownEvent ?\n    options.handleDownEvent : handleDownEvent;\n\n  /**\n   * @type {function(module:ol/MapBrowserPointerEvent)}\n   * @private\n   */\n  this.handleDragEvent_ = options.handleDragEvent ?\n    options.handleDragEvent : handleDragEvent;\n\n  /**\n   * @type {function(module:ol/MapBrowserPointerEvent)}\n   * @private\n   */\n  this.handleMoveEvent_ = options.handleMoveEvent ?\n    options.handleMoveEvent : handleMoveEvent;\n\n  /**\n   * @type {function(module:ol/MapBrowserPointerEvent):boolean}\n   * @private\n   */\n  this.handleUpEvent_ = options.handleUpEvent ?\n    options.handleUpEvent : handleUpEvent;\n\n  /**\n   * @type {boolean}\n   * @protected\n   */\n  this.handlingDownUpSequence = false;\n\n  /**\n   * @type {!Object.<string, module:ol/pointer/PointerEvent>}\n   * @private\n   */\n  this.trackedPointers_ = {};\n\n  /**\n   * @type {Array.<module:ol/pointer/PointerEvent>}\n   * @protected\n   */\n  this.targetPointers = [];\n\n};\n\ninherits(PointerInteraction, Interaction);\n\n\n/**\n * @param {Array.<module:ol/pointer/PointerEvent>} pointerEvents List of events.\n * @return {module:ol~Pixel} Centroid pixel.\n */\nexport function centroid(pointerEvents) {\n  const length = pointerEvents.length;\n  let clientX = 0;\n  let clientY = 0;\n  for (let i = 0; i < length; i++) {\n    clientX += pointerEvents[i].clientX;\n    clientY += pointerEvents[i].clientY;\n  }\n  return [clientX / length, clientY / length];\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Whether the event is a pointerdown, pointerdrag\n *     or pointerup event.\n */\nfunction isPointerDraggingEvent(mapBrowserEvent) {\n  const type = mapBrowserEvent.type;\n  return type === MapBrowserEventType.POINTERDOWN ||\n    type === MapBrowserEventType.POINTERDRAG ||\n    type === MapBrowserEventType.POINTERUP;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @private\n */\nPointerInteraction.prototype.updateTrackedPointers_ = function(mapBrowserEvent) {\n  if (isPointerDraggingEvent(mapBrowserEvent)) {\n    const event = mapBrowserEvent.pointerEvent;\n\n    const id = event.pointerId.toString();\n    if (mapBrowserEvent.type == MapBrowserEventType.POINTERUP) {\n      delete this.trackedPointers_[id];\n    } else if (mapBrowserEvent.type ==\n        MapBrowserEventType.POINTERDOWN) {\n      this.trackedPointers_[id] = event;\n    } else if (id in this.trackedPointers_) {\n      // update only when there was a pointerdown event for this pointer\n      this.trackedPointers_[id] = event;\n    }\n    this.targetPointers = getValues(this.trackedPointers_);\n  }\n};\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} and may call into\n * other functions, if event sequences like e.g. 'drag' or 'down-up' etc. are\n * detected.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/Pointer}\n * @api\n */\nexport function handleEvent(mapBrowserEvent) {\n  if (!(mapBrowserEvent instanceof MapBrowserPointerEvent)) {\n    return true;\n  }\n\n  let stopEvent = false;\n  this.updateTrackedPointers_(mapBrowserEvent);\n  if (this.handlingDownUpSequence) {\n    if (mapBrowserEvent.type == MapBrowserEventType.POINTERDRAG) {\n      this.handleDragEvent_(mapBrowserEvent);\n    } else if (mapBrowserEvent.type == MapBrowserEventType.POINTERUP) {\n      const handledUp = this.handleUpEvent_(mapBrowserEvent);\n      this.handlingDownUpSequence = handledUp && this.targetPointers.length > 0;\n    }\n  } else {\n    if (mapBrowserEvent.type == MapBrowserEventType.POINTERDOWN) {\n      const handled = this.handleDownEvent_(mapBrowserEvent);\n      this.handlingDownUpSequence = handled;\n      stopEvent = this.shouldStopEvent(handled);\n    } else if (mapBrowserEvent.type == MapBrowserEventType.POINTERMOVE) {\n      this.handleMoveEvent_(mapBrowserEvent);\n    }\n  }\n  return !stopEvent;\n}\n\n\n/**\n * This method is used to determine if \"down\" events should be propagated to\n * other interactions or should be stopped.\n *\n * The method receives the return code of the \"handleDownEvent\" function.\n *\n * By default this function is the \"identity\" function. It's overridden in\n * child classes.\n *\n * @param {boolean} handled Was the event handled by the interaction?\n * @return {boolean} Should the event be stopped?\n * @protected\n */\nPointerInteraction.prototype.shouldStopEvent = function(handled) {\n  return handled;\n};\n\nexport default PointerInteraction;\n","/**\n * @module ol/interaction/DragPan\n */\nimport {inherits} from '../util.js';\nimport ViewHint from '../ViewHint.js';\nimport {scale as scaleCoordinate, rotate as rotateCoordinate, add as addCoordinate} from '../coordinate.js';\nimport {easeOut} from '../easing.js';\nimport {noModifierKeys} from '../events/condition.js';\nimport {FALSE} from '../functions.js';\nimport PointerInteraction, {centroid as centroidFromPointers} from '../interaction/Pointer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a boolean\n * to indicate whether that event should be handled.\n * Default is {@link module:ol/events/condition~noModifierKeys}.\n * @property {module:ol/Kinetic} [kinetic] Kinetic inertia to apply to the pan.\n */\n\n\n/**\n * @classdesc\n * Allows the user to pan the map by dragging the map.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/DragPan~Options=} opt_options Options.\n * @api\n */\nconst DragPan = function(opt_options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {module:ol/Kinetic|undefined}\n   */\n  this.kinetic_ = options.kinetic;\n\n  /**\n   * @type {module:ol~Pixel}\n   */\n  this.lastCentroid = null;\n\n  /**\n   * @type {number}\n   */\n  this.lastPointersCount_;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : noModifierKeys;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.noKinetic_ = false;\n\n};\n\ninherits(DragPan, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/DragPan}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  const targetPointers = this.targetPointers;\n  const centroid = centroidFromPointers(targetPointers);\n  if (targetPointers.length == this.lastPointersCount_) {\n    if (this.kinetic_) {\n      this.kinetic_.update(centroid[0], centroid[1]);\n    }\n    if (this.lastCentroid) {\n      const deltaX = this.lastCentroid[0] - centroid[0];\n      const deltaY = centroid[1] - this.lastCentroid[1];\n      const map = mapBrowserEvent.map;\n      const view = map.getView();\n      let center = [deltaX, deltaY];\n      scaleCoordinate(center, view.getResolution());\n      rotateCoordinate(center, view.getRotation());\n      addCoordinate(center, view.getCenter());\n      center = view.constrainCenter(center);\n      view.setCenter(center);\n    }\n  } else if (this.kinetic_) {\n    // reset so we don't overestimate the kinetic energy after\n    // after one finger down, tiny drag, second finger down\n    this.kinetic_.begin();\n  }\n  this.lastCentroid = centroid;\n  this.lastPointersCount_ = targetPointers.length;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/DragPan}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  if (this.targetPointers.length === 0) {\n    if (!this.noKinetic_ && this.kinetic_ && this.kinetic_.end()) {\n      const distance = this.kinetic_.getDistance();\n      const angle = this.kinetic_.getAngle();\n      const center = /** @type {!module:ol/coordinate~Coordinate} */ (view.getCenter());\n      const centerpx = map.getPixelFromCoordinate(center);\n      const dest = map.getCoordinateFromPixel([\n        centerpx[0] - distance * Math.cos(angle),\n        centerpx[1] - distance * Math.sin(angle)\n      ]);\n      view.animate({\n        center: view.constrainCenter(dest),\n        duration: 500,\n        easing: easeOut\n      });\n    }\n    view.setHint(ViewHint.INTERACTING, -1);\n    return false;\n  } else {\n    if (this.kinetic_) {\n      // reset so we don't overestimate the kinetic energy after\n      // after one finger up, tiny drag, second finger up\n      this.kinetic_.begin();\n    }\n    this.lastCentroid = null;\n    return true;\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/DragPan}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (this.targetPointers.length > 0 && this.condition_(mapBrowserEvent)) {\n    const map = mapBrowserEvent.map;\n    const view = map.getView();\n    this.lastCentroid = null;\n    if (!this.handlingDownUpSequence) {\n      view.setHint(ViewHint.INTERACTING, 1);\n    }\n    // stop any current animation\n    if (view.getAnimating()) {\n      view.setCenter(mapBrowserEvent.frameState.viewState.center);\n    }\n    if (this.kinetic_) {\n      this.kinetic_.begin();\n    }\n    // No kinetic as soon as more than one pointer on the screen is\n    // detected. This is to prevent nasty pans after pinch.\n    this.noKinetic_ = this.targetPointers.length > 1;\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nDragPan.prototype.shouldStopEvent = FALSE;\nexport default DragPan;\n","/**\n * @module ol/interaction/DragRotate\n */\nimport {inherits} from '../util.js';\nimport {disable} from '../rotationconstraint.js';\nimport ViewHint from '../ViewHint.js';\nimport {altShiftKeysOnly, mouseOnly, mouseActionButton} from '../events/condition.js';\nimport {FALSE} from '../functions.js';\nimport {rotate, rotateWithoutConstraints} from '../interaction/Interaction.js';\nimport PointerInteraction from '../interaction/Pointer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that takes an\n * {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a boolean\n * to indicate whether that event should be handled.\n * Default is {@link module:ol/events/condition~altShiftKeysOnly}.\n * @property {number} [duration=250] Animation duration in milliseconds.\n */\n\n\n/**\n * @classdesc\n * Allows the user to rotate the map by clicking and dragging on the map,\n * normally combined with an {@link module:ol/events/condition} that limits\n * it to when the alt and shift keys are held down.\n *\n * This interaction is only supported for mouse devices.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/DragRotate~Options=} opt_options Options.\n * @api\n */\nconst DragRotate = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : altShiftKeysOnly;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lastAngle_ = undefined;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n};\n\ninherits(DragRotate, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/DragRotate}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return;\n  }\n\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  if (view.getConstraints().rotation === disable) {\n    return;\n  }\n  const size = map.getSize();\n  const offset = mapBrowserEvent.pixel;\n  const theta =\n      Math.atan2(size[1] / 2 - offset[1], offset[0] - size[0] / 2);\n  if (this.lastAngle_ !== undefined) {\n    const delta = theta - this.lastAngle_;\n    const rotation = view.getRotation();\n    rotateWithoutConstraints(view, rotation - delta);\n  }\n  this.lastAngle_ = theta;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/DragRotate}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return true;\n  }\n\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  view.setHint(ViewHint.INTERACTING, -1);\n  const rotation = view.getRotation();\n  rotate(view, rotation, undefined, this.duration_);\n  return false;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/DragRotate}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return false;\n  }\n\n  if (mouseActionButton(mapBrowserEvent) && this.condition_(mapBrowserEvent)) {\n    const map = mapBrowserEvent.map;\n    map.getView().setHint(ViewHint.INTERACTING, 1);\n    this.lastAngle_ = undefined;\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nDragRotate.prototype.shouldStopEvent = FALSE;\nexport default DragRotate;\n","/**\n * @module ol/render/Box\n */\n// FIXME add rotation\n\nimport {inherits} from '../util.js';\nimport Disposable from '../Disposable.js';\nimport Polygon from '../geom/Polygon.js';\n\n/**\n * @constructor\n * @extends {module:ol/Disposable}\n * @param {string} className CSS class name.\n */\nconst RenderBox = function(className) {\n\n  /**\n   * @type {module:ol/geom/Polygon}\n   * @private\n   */\n  this.geometry_ = null;\n\n  /**\n   * @type {HTMLDivElement}\n   * @private\n   */\n  this.element_ = /** @type {HTMLDivElement} */ (document.createElement('div'));\n  this.element_.style.position = 'absolute';\n  this.element_.className = 'ol-box ' + className;\n\n  /**\n   * @private\n   * @type {module:ol/PluggableMap}\n   */\n  this.map_ = null;\n\n  /**\n   * @private\n   * @type {module:ol~Pixel}\n   */\n  this.startPixel_ = null;\n\n  /**\n   * @private\n   * @type {module:ol~Pixel}\n   */\n  this.endPixel_ = null;\n\n};\n\ninherits(RenderBox, Disposable);\n\n\n/**\n * @inheritDoc\n */\nRenderBox.prototype.disposeInternal = function() {\n  this.setMap(null);\n};\n\n\n/**\n * @private\n */\nRenderBox.prototype.render_ = function() {\n  const startPixel = this.startPixel_;\n  const endPixel = this.endPixel_;\n  const px = 'px';\n  const style = this.element_.style;\n  style.left = Math.min(startPixel[0], endPixel[0]) + px;\n  style.top = Math.min(startPixel[1], endPixel[1]) + px;\n  style.width = Math.abs(endPixel[0] - startPixel[0]) + px;\n  style.height = Math.abs(endPixel[1] - startPixel[1]) + px;\n};\n\n\n/**\n * @param {module:ol/PluggableMap} map Map.\n */\nRenderBox.prototype.setMap = function(map) {\n  if (this.map_) {\n    this.map_.getOverlayContainer().removeChild(this.element_);\n    const style = this.element_.style;\n    style.left = style.top = style.width = style.height = 'inherit';\n  }\n  this.map_ = map;\n  if (this.map_) {\n    this.map_.getOverlayContainer().appendChild(this.element_);\n  }\n};\n\n\n/**\n * @param {module:ol~Pixel} startPixel Start pixel.\n * @param {module:ol~Pixel} endPixel End pixel.\n */\nRenderBox.prototype.setPixels = function(startPixel, endPixel) {\n  this.startPixel_ = startPixel;\n  this.endPixel_ = endPixel;\n  this.createOrUpdateGeometry();\n  this.render_();\n};\n\n\n/**\n * Creates or updates the cached geometry.\n */\nRenderBox.prototype.createOrUpdateGeometry = function() {\n  const startPixel = this.startPixel_;\n  const endPixel = this.endPixel_;\n  const pixels = [\n    startPixel,\n    [startPixel[0], endPixel[1]],\n    endPixel,\n    [endPixel[0], startPixel[1]]\n  ];\n  const coordinates = pixels.map(this.map_.getCoordinateFromPixel, this.map_);\n  // close the polygon\n  coordinates[4] = coordinates[0].slice();\n  if (!this.geometry_) {\n    this.geometry_ = new Polygon([coordinates]);\n  } else {\n    this.geometry_.setCoordinates([coordinates]);\n  }\n};\n\n\n/**\n * @return {module:ol/geom/Polygon} Geometry.\n */\nRenderBox.prototype.getGeometry = function() {\n  return this.geometry_;\n};\nexport default RenderBox;\n","/**\n * @module ol/interaction/DragBox\n */\n// FIXME draw drag box\nimport Event from '../events/Event.js';\nimport {inherits} from '../util.js';\nimport {always, mouseOnly, mouseActionButton} from '../events/condition.js';\nimport {UNDEFINED} from '../functions.js';\nimport PointerInteraction from '../interaction/Pointer.js';\nimport RenderBox from '../render/Box.js';\n\n\n/**\n * A function that takes a {@link module:ol/MapBrowserEvent} and two\n * {@link module:ol~Pixel}s and returns a `{boolean}`. If the condition is met,\n * true should be returned.\n * @typedef {function(this: ?, module:ol/MapBrowserEvent, module:ol~Pixel, module:ol~Pixel):boolean} EndCondition\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-dragbox'] CSS class name for styling the box.\n * @property {module:ol/events/condition~Condition} [condition] A function that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a boolean\n * to indicate whether that event should be handled.\n * Default is {@link ol/events/condition~always}.\n * @property {number} [minArea=64] The minimum area of the box in pixel, this value is used by the default\n * `boxEndCondition` function.\n * @property {module:ol/interaction/DragBox~EndCondition} [boxEndCondition] A function that takes a {@link module:ol/MapBrowserEvent~MapBrowserEvent} and two\n * {@link module:ol~Pixel}s to indicate whether a `boxend` event should be fired.\n * Default is `true` if the area of the box is bigger than the `minArea` option.\n */\n\n\n/**\n * @enum {string}\n */\nconst DragBoxEventType = {\n  /**\n   * Triggered upon drag box start.\n   * @event module:ol/interaction/DragBox~DragBoxEvent#boxstart\n   * @api\n   */\n  BOXSTART: 'boxstart',\n\n  /**\n   * Triggered on drag when box is active.\n   * @event module:ol/interaction/DragBox~DragBoxEvent#boxdrag\n   * @api\n   */\n  BOXDRAG: 'boxdrag',\n\n  /**\n   * Triggered upon drag box end.\n   * @event module:ol/interaction/DragBox~DragBoxEvent#boxend\n   * @api\n   */\n  BOXEND: 'boxend'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/DragBox~DragBox} instances are instances of\n * this type.\n *\n * @param {string} type The event type.\n * @param {module:ol/coordinate~Coordinate} coordinate The event coordinate.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Originating event.\n * @extends {module:ol/events/Event}\n * @constructor\n */\nconst DragBoxEvent = function(type, coordinate, mapBrowserEvent) {\n  Event.call(this, type);\n\n  /**\n   * The coordinate of the drag event.\n   * @const\n   * @type {module:ol/coordinate~Coordinate}\n   * @api\n   */\n  this.coordinate = coordinate;\n\n  /**\n   * @const\n   * @type {module:ol/MapBrowserEvent}\n   * @api\n   */\n  this.mapBrowserEvent = mapBrowserEvent;\n\n};\n\ninherits(DragBoxEvent, Event);\n\n\n/**\n * @classdesc\n * Allows the user to draw a vector box by clicking and dragging on the map,\n * normally combined with an {@link module:ol/events/condition} that limits\n * it to when the shift or other key is held down. This is used, for example,\n * for zooming to a specific area of the map\n * (see {@link module:ol/interaction/DragZoom~DragZoom} and\n * {@link module:ol/interaction/DragRotateAndZoom}).\n *\n * This interaction is only supported for mouse devices.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @fires module:ol/interaction/DragBox~DragBoxEvent\n * @param {module:ol/interaction/DragBox~Options=} opt_options Options.\n * @api\n */\nconst DragBox = function(opt_options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {module:ol/render/Box}\n   * @private\n   */\n  this.box_ = new RenderBox(options.className || 'ol-dragbox');\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.minArea_ = options.minArea !== undefined ? options.minArea : 64;\n\n  /**\n   * @type {module:ol~Pixel}\n   * @private\n   */\n  this.startPixel_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : always;\n\n  /**\n   * @private\n   * @type {module:ol/interaction/DragBox~EndCondition}\n   */\n  this.boxEndCondition_ = options.boxEndCondition ?\n    options.boxEndCondition : defaultBoxEndCondition;\n};\n\ninherits(DragBox, PointerInteraction);\n\n\n/**\n * The default condition for determining whether the boxend event\n * should fire.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent The originating MapBrowserEvent\n *     leading to the box end.\n * @param {module:ol~Pixel} startPixel The starting pixel of the box.\n * @param {module:ol~Pixel} endPixel The end pixel of the box.\n * @return {boolean} Whether or not the boxend condition should be fired.\n * @this {module:ol/interaction/DragBox}\n */\nfunction defaultBoxEndCondition(mapBrowserEvent, startPixel, endPixel) {\n  const width = endPixel[0] - startPixel[0];\n  const height = endPixel[1] - startPixel[1];\n  return width * width + height * height >= this.minArea_;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/DragBox}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return;\n  }\n\n  this.box_.setPixels(this.startPixel_, mapBrowserEvent.pixel);\n\n  this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,\n    mapBrowserEvent.coordinate, mapBrowserEvent));\n}\n\n\n/**\n * Returns geometry of last drawn box.\n * @return {module:ol/geom/Polygon} Geometry.\n * @api\n */\nDragBox.prototype.getGeometry = function() {\n  return this.box_.getGeometry();\n};\n\n\n/**\n * To be overridden by child classes.\n * FIXME: use constructor option instead of relying on overriding.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @protected\n */\nDragBox.prototype.onBoxEnd = UNDEFINED;\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/DragBox}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return true;\n  }\n\n  this.box_.setMap(null);\n\n  if (this.boxEndCondition_(mapBrowserEvent,\n    this.startPixel_, mapBrowserEvent.pixel)) {\n    this.onBoxEnd(mapBrowserEvent);\n    this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXEND,\n      mapBrowserEvent.coordinate, mapBrowserEvent));\n  }\n  return false;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/DragBox}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return false;\n  }\n\n  if (mouseActionButton(mapBrowserEvent) &&\n      this.condition_(mapBrowserEvent)) {\n    this.startPixel_ = mapBrowserEvent.pixel;\n    this.box_.setMap(mapBrowserEvent.map);\n    this.box_.setPixels(this.startPixel_, this.startPixel_);\n    this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,\n      mapBrowserEvent.coordinate, mapBrowserEvent));\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\nexport default DragBox;\n","/**\n * @module ol/interaction/DragZoom\n */\nimport {inherits} from '../util.js';\nimport {easeOut} from '../easing.js';\nimport {shiftKeyOnly} from '../events/condition.js';\nimport {createOrUpdateFromCoordinates, getBottomLeft, getCenter, getTopRight, scaleFromCenter} from '../extent.js';\nimport DragBox from '../interaction/DragBox.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-dragzoom'] CSS class name for styling the\n * box.\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * Default is {@link module:ol/events/condition~shiftKeyOnly}.\n * @property {number} [duration=200] Animation duration in milliseconds.\n * @property {boolean} [out=false] Use interaction for zooming out.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom the map by clicking and dragging on the map,\n * normally combined with an {@link module:ol/events/condition} that limits\n * it to when a key, shift by default, is held down.\n *\n * To change the style of the box, use CSS and the `.ol-dragzoom` selector, or\n * your custom one configured with `className`.\n *\n * @constructor\n * @extends {module:ol/interaction/DragBox}\n * @param {module:ol/interaction/DragZoom~Options=} opt_options Options.\n * @api\n */\nconst DragZoom = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  const condition = options.condition ? options.condition : shiftKeyOnly;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 200;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.out_ = options.out !== undefined ? options.out : false;\n\n  DragBox.call(this, {\n    condition: condition,\n    className: options.className || 'ol-dragzoom'\n  });\n\n};\n\ninherits(DragZoom, DragBox);\n\n\n/**\n * @inheritDoc\n */\nDragZoom.prototype.onBoxEnd = function() {\n  const map = this.getMap();\n\n  const view = /** @type {!module:ol/View} */ (map.getView());\n\n  const size = /** @type {!module:ol/size~Size} */ (map.getSize());\n\n  let extent = this.getGeometry().getExtent();\n\n  if (this.out_) {\n    const mapExtent = view.calculateExtent(size);\n    const boxPixelExtent = createOrUpdateFromCoordinates([\n      map.getPixelFromCoordinate(getBottomLeft(extent)),\n      map.getPixelFromCoordinate(getTopRight(extent))]);\n    const factor = view.getResolutionForExtent(boxPixelExtent, size);\n\n    scaleFromCenter(mapExtent, 1 / factor);\n    extent = mapExtent;\n  }\n\n  const resolution = view.constrainResolution(\n    view.getResolutionForExtent(extent, size));\n\n  let center = getCenter(extent);\n  center = view.constrainCenter(center);\n\n  view.animate({\n    resolution: resolution,\n    center: center,\n    duration: this.duration_,\n    easing: easeOut\n  });\n\n};\nexport default DragZoom;\n","/**\n * @module ol/events/KeyCode\n */\n\n/**\n * @enum {number}\n * @const\n */\nexport default {\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40\n};\n","/**\n * @module ol/interaction/KeyboardPan\n */\nimport {inherits} from '../util.js';\nimport {rotate as rotateCoordinate} from '../coordinate.js';\nimport EventType from '../events/EventType.js';\nimport KeyCode from '../events/KeyCode.js';\nimport {noModifierKeys, targetNotEditable} from '../events/condition.js';\nimport Interaction, {pan} from '../interaction/Interaction.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. Default is\n * {@link module:ol/events/condition~noModifierKeys} and\n * {@link module:ol/events/condition~targetNotEditable}.\n * @property {number} [duration=100] Animation duration in milliseconds.\n * @property {number} [pixelDelta=128] The amount of pixels to pan on each key\n * press.\n */\n\n\n/**\n * @classdesc\n * Allows the user to pan the map using keyboard arrows.\n * Note that, although this interaction is by default included in maps,\n * the keys can only be used when browser focus is on the element to which\n * the keyboard events are attached. By default, this is the map div,\n * though you can change this with the `keyboardEventTarget` in\n * {@link module:ol/Map~Map}. `document` never loses focus but, for any other\n * element, focus will have to be on, and returned to, this element if the keys\n * are to function.\n * See also {@link module:ol/interaction/KeyboardZoom~KeyboardZoom}.\n *\n * @constructor\n * @extends {module:ol/interaction/Interaction}\n * @param {module:ol/interaction/KeyboardPan~Options=} opt_options Options.\n * @api\n */\nconst KeyboardPan = function(opt_options) {\n\n  Interaction.call(this, {\n    handleEvent: handleEvent\n  });\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @param {module:ol/MapBrowserEvent} mapBrowserEvent Browser event.\n   * @return {boolean} Combined condition result.\n   */\n  this.defaultCondition_ = function(mapBrowserEvent) {\n    return noModifierKeys(mapBrowserEvent) &&\n      targetNotEditable(mapBrowserEvent);\n  };\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition !== undefined ?\n    options.condition : this.defaultCondition_;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 100;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelDelta_ = options.pixelDelta !== undefined ?\n    options.pixelDelta : 128;\n\n};\n\ninherits(KeyboardPan, Interaction);\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} if it was a\n * `KeyEvent`, and decides the direction to pan to (if an arrow key was\n * pressed).\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/KeyboardPan}\n */\nfunction handleEvent(mapBrowserEvent) {\n  let stopEvent = false;\n  if (mapBrowserEvent.type == EventType.KEYDOWN) {\n    const keyEvent = mapBrowserEvent.originalEvent;\n    const keyCode = keyEvent.keyCode;\n    if (this.condition_(mapBrowserEvent) &&\n        (keyCode == KeyCode.DOWN ||\n        keyCode == KeyCode.LEFT ||\n        keyCode == KeyCode.RIGHT ||\n        keyCode == KeyCode.UP)) {\n      const map = mapBrowserEvent.map;\n      const view = map.getView();\n      const mapUnitsDelta = view.getResolution() * this.pixelDelta_;\n      let deltaX = 0, deltaY = 0;\n      if (keyCode == KeyCode.DOWN) {\n        deltaY = -mapUnitsDelta;\n      } else if (keyCode == KeyCode.LEFT) {\n        deltaX = -mapUnitsDelta;\n      } else if (keyCode == KeyCode.RIGHT) {\n        deltaX = mapUnitsDelta;\n      } else {\n        deltaY = mapUnitsDelta;\n      }\n      const delta = [deltaX, deltaY];\n      rotateCoordinate(delta, view.getRotation());\n      pan(view, delta, this.duration_);\n      mapBrowserEvent.preventDefault();\n      stopEvent = true;\n    }\n  }\n  return !stopEvent;\n}\n\nexport default KeyboardPan;\n","/**\n * @module ol/interaction/KeyboardZoom\n */\nimport {inherits} from '../util.js';\nimport EventType from '../events/EventType.js';\nimport {targetNotEditable} from '../events/condition.js';\nimport Interaction, {zoomByDelta} from '../interaction/Interaction.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [duration=100] Animation duration in milliseconds.\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. Default is\n * {@link module:ol/events/condition~targetNotEditable}.\n * @property {number} [delta=1] The zoom level delta on each key press.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom the map using keyboard + and -.\n * Note that, although this interaction is by default included in maps,\n * the keys can only be used when browser focus is on the element to which\n * the keyboard events are attached. By default, this is the map div,\n * though you can change this with the `keyboardEventTarget` in\n * {@link module:ol/Map~Map}. `document` never loses focus but, for any other\n * element, focus will have to be on, and returned to, this element if the keys\n * are to function.\n * See also {@link moudle:ol/interaction/KeyboardPan~KeyboardPan}.\n *\n * @constructor\n * @param {module:ol/interaction/KeyboardZoom~Options=} opt_options Options.\n * @extends {module:ol/interaction/Interaction}\n * @api\n */\nconst KeyboardZoom = function(opt_options) {\n\n  Interaction.call(this, {\n    handleEvent: handleEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : targetNotEditable;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delta_ = options.delta ? options.delta : 1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 100;\n\n};\n\ninherits(KeyboardZoom, Interaction);\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} if it was a\n * `KeyEvent`, and decides whether to zoom in or out (depending on whether the\n * key pressed was '+' or '-').\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/KeyboardZoom}\n */\nfunction handleEvent(mapBrowserEvent) {\n  let stopEvent = false;\n  if (mapBrowserEvent.type == EventType.KEYDOWN ||\n      mapBrowserEvent.type == EventType.KEYPRESS) {\n    const keyEvent = mapBrowserEvent.originalEvent;\n    const charCode = keyEvent.charCode;\n    if (this.condition_(mapBrowserEvent) &&\n        (charCode == '+'.charCodeAt(0) || charCode == '-'.charCodeAt(0))) {\n      const map = mapBrowserEvent.map;\n      const delta = (charCode == '+'.charCodeAt(0)) ? this.delta_ : -this.delta_;\n      const view = map.getView();\n      zoomByDelta(view, delta, undefined, this.duration_);\n      mapBrowserEvent.preventDefault();\n      stopEvent = true;\n    }\n  }\n  return !stopEvent;\n}\n\nexport default KeyboardZoom;\n","/**\n * @module ol/interaction/MouseWheelZoom\n */\nimport {inherits} from '../util.js';\nimport ViewHint from '../ViewHint.js';\nimport {always} from '../events/condition.js';\nimport {easeOut} from '../easing.js';\nimport EventType from '../events/EventType.js';\nimport {DEVICE_PIXEL_RATIO, FIREFOX, SAFARI} from '../has.js';\nimport Interaction, {zoomByDelta} from '../interaction/Interaction.js';\nimport {clamp} from '../math.js';\n\n\n/**\n * Maximum mouse wheel delta.\n * @type {number}\n */\nconst MAX_DELTA = 1;\n\n\n/**\n * @enum {string}\n */\nexport const Mode = {\n  TRACKPAD: 'trackpad',\n  WHEEL: 'wheel'\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. Default is\n * {@link module:ol/events/condition~always}.\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {number} [timeout=80] Mouse wheel timeout duration in milliseconds.\n * @property {boolean} [constrainResolution=false] When using a trackpad or\n * magic mouse, zoom to the closest integer zoom level after the scroll gesture\n * ends.\n * @property {boolean} [useAnchor=true] Enable zooming using the mouse's\n * location as the anchor. When set to `false`, zooming in and out will zoom to\n * the center of the screen instead of zooming on the mouse's location.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom the map by scrolling the mouse wheel.\n *\n * @constructor\n * @extends {module:ol/interaction/Interaction}\n * @param {module:ol/interaction/MouseWheelZoom~Options=} opt_options Options.\n * @api\n */\nconst MouseWheelZoom = function(opt_options) {\n\n  Interaction.call(this, {\n    handleEvent: handleEvent\n  });\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delta_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.timeout_ = options.timeout !== undefined ? options.timeout : 80;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.useAnchor_ = options.useAnchor !== undefined ? options.useAnchor : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.constrainResolution_ = options.constrainResolution || false;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : always;\n\n  /**\n   * @private\n   * @type {?module:ol/coordinate~Coordinate}\n   */\n  this.lastAnchor_ = null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.startTime_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.timeoutId_ = undefined;\n\n  /**\n   * @private\n   * @type {module:ol/interaction/MouseWheelZoom~Mode|undefined}\n   */\n  this.mode_ = undefined;\n\n  /**\n   * Trackpad events separated by this delay will be considered separate\n   * interactions.\n   * @type {number}\n   */\n  this.trackpadEventGap_ = 400;\n\n  /**\n   * @type {number|undefined}\n   */\n  this.trackpadTimeoutId_ = undefined;\n\n  /**\n   * The number of delta values per zoom level\n   * @private\n   * @type {number}\n   */\n  this.trackpadDeltaPerZoom_ = 300;\n\n  /**\n   * The zoom factor by which scroll zooming is allowed to exceed the limits.\n   * @private\n   * @type {number}\n   */\n  this.trackpadZoomBuffer_ = 1.5;\n\n};\n\ninherits(MouseWheelZoom, Interaction);\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} (if it was a\n * mousewheel-event) and eventually zooms the map.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} Allow event propagation.\n * @this {module:ol/interaction/MouseWheelZoom}\n */\nfunction handleEvent(mapBrowserEvent) {\n  if (!this.condition_(mapBrowserEvent)) {\n    return true;\n  }\n  const type = mapBrowserEvent.type;\n  if (type !== EventType.WHEEL && type !== EventType.MOUSEWHEEL) {\n    return true;\n  }\n\n  mapBrowserEvent.preventDefault();\n\n  const map = mapBrowserEvent.map;\n  const wheelEvent = /** @type {WheelEvent} */ (mapBrowserEvent.originalEvent);\n\n  if (this.useAnchor_) {\n    this.lastAnchor_ = mapBrowserEvent.coordinate;\n  }\n\n  // Delta normalisation inspired by\n  // https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\n  let delta;\n  if (mapBrowserEvent.type == EventType.WHEEL) {\n    delta = wheelEvent.deltaY;\n    if (FIREFOX &&\n        wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {\n      delta /= DEVICE_PIXEL_RATIO;\n    }\n    if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_LINE) {\n      delta *= 40;\n    }\n  } else if (mapBrowserEvent.type == EventType.MOUSEWHEEL) {\n    delta = -wheelEvent.wheelDeltaY;\n    if (SAFARI) {\n      delta /= 3;\n    }\n  }\n\n  if (delta === 0) {\n    return false;\n  }\n\n  const now = Date.now();\n\n  if (this.startTime_ === undefined) {\n    this.startTime_ = now;\n  }\n\n  if (!this.mode_ || now - this.startTime_ > this.trackpadEventGap_) {\n    this.mode_ = Math.abs(delta) < 4 ?\n      Mode.TRACKPAD :\n      Mode.WHEEL;\n  }\n\n  if (this.mode_ === Mode.TRACKPAD) {\n    const view = map.getView();\n    if (this.trackpadTimeoutId_) {\n      clearTimeout(this.trackpadTimeoutId_);\n    } else {\n      view.setHint(ViewHint.INTERACTING, 1);\n    }\n    this.trackpadTimeoutId_ = setTimeout(this.decrementInteractingHint_.bind(this), this.trackpadEventGap_);\n    let resolution = view.getResolution() * Math.pow(2, delta / this.trackpadDeltaPerZoom_);\n    const minResolution = view.getMinResolution();\n    const maxResolution = view.getMaxResolution();\n    let rebound = 0;\n    if (resolution < minResolution) {\n      resolution = Math.max(resolution, minResolution / this.trackpadZoomBuffer_);\n      rebound = 1;\n    } else if (resolution > maxResolution) {\n      resolution = Math.min(resolution, maxResolution * this.trackpadZoomBuffer_);\n      rebound = -1;\n    }\n    if (this.lastAnchor_) {\n      const center = view.calculateCenterZoom(resolution, this.lastAnchor_);\n      view.setCenter(view.constrainCenter(center));\n    }\n    view.setResolution(resolution);\n\n    if (rebound === 0 && this.constrainResolution_) {\n      view.animate({\n        resolution: view.constrainResolution(resolution, delta > 0 ? -1 : 1),\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: this.duration_\n      });\n    }\n\n    if (rebound > 0) {\n      view.animate({\n        resolution: minResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    } else if (rebound < 0) {\n      view.animate({\n        resolution: maxResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    }\n    this.startTime_ = now;\n    return false;\n  }\n\n  this.delta_ += delta;\n\n  const timeLeft = Math.max(this.timeout_ - (now - this.startTime_), 0);\n\n  clearTimeout(this.timeoutId_);\n  this.timeoutId_ = setTimeout(this.handleWheelZoom_.bind(this, map), timeLeft);\n\n  return false;\n}\n\n\n/**\n * @private\n */\nMouseWheelZoom.prototype.decrementInteractingHint_ = function() {\n  this.trackpadTimeoutId_ = undefined;\n  const view = this.getMap().getView();\n  view.setHint(ViewHint.INTERACTING, -1);\n};\n\n\n/**\n * @private\n * @param {module:ol/PluggableMap} map Map.\n */\nMouseWheelZoom.prototype.handleWheelZoom_ = function(map) {\n  const view = map.getView();\n  if (view.getAnimating()) {\n    view.cancelAnimations();\n  }\n  const maxDelta = MAX_DELTA;\n  const delta = clamp(this.delta_, -maxDelta, maxDelta);\n  zoomByDelta(view, -delta, this.lastAnchor_, this.duration_);\n  this.mode_ = undefined;\n  this.delta_ = 0;\n  this.lastAnchor_ = null;\n  this.startTime_ = undefined;\n  this.timeoutId_ = undefined;\n};\n\n\n/**\n * Enable or disable using the mouse's location as an anchor when zooming\n * @param {boolean} useAnchor true to zoom to the mouse's location, false\n * to zoom to the center of the map\n * @api\n */\nMouseWheelZoom.prototype.setMouseAnchor = function(useAnchor) {\n  this.useAnchor_ = useAnchor;\n  if (!useAnchor) {\n    this.lastAnchor_ = null;\n  }\n};\n\n\nexport default MouseWheelZoom;\n","/**\n * @module ol/interaction/PinchRotate\n */\nimport {inherits} from '../util.js';\nimport ViewHint from '../ViewHint.js';\nimport {FALSE} from '../functions.js';\nimport {rotate, rotateWithoutConstraints} from '../interaction/Interaction.js';\nimport PointerInteraction, {centroid as centroidFromPointers} from '../interaction/Pointer.js';\nimport {disable} from '../rotationconstraint.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [duration=250] The duration of the animation in\n * milliseconds.\n * @property {number} [threshold=0.3] Minimal angle in radians to start a rotation.\n */\n\n\n/**\n * @classdesc\n * Allows the user to rotate the map by twisting with two fingers\n * on a touch screen.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/PinchRotate~Options=} opt_options Options.\n * @api\n */\nconst PinchRotate = function(opt_options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.anchor_ = null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lastAngle_ = undefined;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.rotating_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.rotationDelta_ = 0.0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.threshold_ = options.threshold !== undefined ? options.threshold : 0.3;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n};\n\ninherits(PinchRotate, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/PinchRotate}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  let rotationDelta = 0.0;\n\n  const touch0 = this.targetPointers[0];\n  const touch1 = this.targetPointers[1];\n\n  // angle between touches\n  const angle = Math.atan2(\n    touch1.clientY - touch0.clientY,\n    touch1.clientX - touch0.clientX);\n\n  if (this.lastAngle_ !== undefined) {\n    const delta = angle - this.lastAngle_;\n    this.rotationDelta_ += delta;\n    if (!this.rotating_ &&\n        Math.abs(this.rotationDelta_) > this.threshold_) {\n      this.rotating_ = true;\n    }\n    rotationDelta = delta;\n  }\n  this.lastAngle_ = angle;\n\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  if (view.getConstraints().rotation === disable) {\n    return;\n  }\n\n  // rotate anchor point.\n  // FIXME: should be the intersection point between the lines:\n  //     touch0,touch1 and previousTouch0,previousTouch1\n  const viewportPosition = map.getViewport().getBoundingClientRect();\n  const centroid = centroidFromPointers(this.targetPointers);\n  centroid[0] -= viewportPosition.left;\n  centroid[1] -= viewportPosition.top;\n  this.anchor_ = map.getCoordinateFromPixel(centroid);\n\n  // rotate\n  if (this.rotating_) {\n    const rotation = view.getRotation();\n    map.render();\n    rotateWithoutConstraints(view, rotation + rotationDelta, this.anchor_);\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/PinchRotate}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  if (this.targetPointers.length < 2) {\n    const map = mapBrowserEvent.map;\n    const view = map.getView();\n    view.setHint(ViewHint.INTERACTING, -1);\n    if (this.rotating_) {\n      const rotation = view.getRotation();\n      rotate(view, rotation, this.anchor_, this.duration_);\n    }\n    return false;\n  } else {\n    return true;\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/PinchRotate}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (this.targetPointers.length >= 2) {\n    const map = mapBrowserEvent.map;\n    this.anchor_ = null;\n    this.lastAngle_ = undefined;\n    this.rotating_ = false;\n    this.rotationDelta_ = 0.0;\n    if (!this.handlingDownUpSequence) {\n      map.getView().setHint(ViewHint.INTERACTING, 1);\n    }\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nPinchRotate.prototype.shouldStopEvent = FALSE;\n\nexport default PinchRotate;\n","/**\n * @module ol/interaction/PinchZoom\n */\nimport {inherits} from '../util.js';\nimport ViewHint from '../ViewHint.js';\nimport {FALSE} from '../functions.js';\nimport {zoom, zoomWithoutConstraints} from '../interaction/Interaction.js';\nimport PointerInteraction, {centroid as centroidFromPointers} from '../interaction/Pointer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [duration=400] Animation duration in milliseconds.\n * @property {boolean} [constrainResolution=false] Zoom to the closest integer\n * zoom level after the pinch gesture ends.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom the map by pinching with two fingers\n * on a touch screen.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/PinchZoom~Options=} opt_options Options.\n * @api\n */\nconst PinchZoom = function(opt_options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.constrainResolution_ = options.constrainResolution || false;\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.anchor_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 400;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lastDistance_ = undefined;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.lastScaleDelta_ = 1;\n\n};\n\ninherits(PinchZoom, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/PinchZoom}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  let scaleDelta = 1.0;\n\n  const touch0 = this.targetPointers[0];\n  const touch1 = this.targetPointers[1];\n  const dx = touch0.clientX - touch1.clientX;\n  const dy = touch0.clientY - touch1.clientY;\n\n  // distance between touches\n  const distance = Math.sqrt(dx * dx + dy * dy);\n\n  if (this.lastDistance_ !== undefined) {\n    scaleDelta = this.lastDistance_ / distance;\n  }\n  this.lastDistance_ = distance;\n\n\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  const resolution = view.getResolution();\n  const maxResolution = view.getMaxResolution();\n  const minResolution = view.getMinResolution();\n  let newResolution = resolution * scaleDelta;\n  if (newResolution > maxResolution) {\n    scaleDelta = maxResolution / resolution;\n    newResolution = maxResolution;\n  } else if (newResolution < minResolution) {\n    scaleDelta = minResolution / resolution;\n    newResolution = minResolution;\n  }\n\n  if (scaleDelta != 1.0) {\n    this.lastScaleDelta_ = scaleDelta;\n  }\n\n  // scale anchor point.\n  const viewportPosition = map.getViewport().getBoundingClientRect();\n  const centroid = centroidFromPointers(this.targetPointers);\n  centroid[0] -= viewportPosition.left;\n  centroid[1] -= viewportPosition.top;\n  this.anchor_ = map.getCoordinateFromPixel(centroid);\n\n  // scale, bypass the resolution constraint\n  map.render();\n  zoomWithoutConstraints(view, newResolution, this.anchor_);\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/PinchZoom}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  if (this.targetPointers.length < 2) {\n    const map = mapBrowserEvent.map;\n    const view = map.getView();\n    view.setHint(ViewHint.INTERACTING, -1);\n    const resolution = view.getResolution();\n    if (this.constrainResolution_ ||\n        resolution < view.getMinResolution() ||\n        resolution > view.getMaxResolution()) {\n      // Zoom to final resolution, with an animation, and provide a\n      // direction not to zoom out/in if user was pinching in/out.\n      // Direction is > 0 if pinching out, and < 0 if pinching in.\n      const direction = this.lastScaleDelta_ - 1;\n      zoom(view, resolution, this.anchor_, this.duration_, direction);\n    }\n    return false;\n  } else {\n    return true;\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/PinchZoom}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (this.targetPointers.length >= 2) {\n    const map = mapBrowserEvent.map;\n    this.anchor_ = null;\n    this.lastDistance_ = undefined;\n    this.lastScaleDelta_ = 1;\n    if (!this.handlingDownUpSequence) {\n      map.getView().setHint(ViewHint.INTERACTING, 1);\n    }\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nPinchZoom.prototype.shouldStopEvent = FALSE;\nexport default PinchZoom;\n","/**\n * @module ol/interaction/DragAndDrop\n */\n// FIXME should handle all geo-referenced data, not just vector data\n\nimport {inherits} from '../util.js';\nimport {TRUE} from '../functions.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport Interaction from '../interaction/Interaction.js';\nimport {get as getProjection} from '../proj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {Array.<function(new: module:ol/format/Feature)>} [formatConstructors] Format constructors.\n * @property {module:ol/source/Vector} [source] Optional vector source where features will be added.  If a source is provided\n * all existing features will be removed and new features will be added when\n * they are dropped on the target.  If you want to add features to a vector\n * source without removing the existing features (append only), instead of\n * providing the source option listen for the \"addfeatures\" event.\n * @property {module:ol/proj~ProjectionLike} [projection] Target projection. By default, the map's view's projection is used.\n * @property {Element} [target] The element that is used as the drop target, default is the viewport element.\n */\n\n\n/**\n * @enum {string}\n */\nconst DragAndDropEventType = {\n  /**\n   * Triggered when features are added\n   * @event module:ol/interaction/DragAndDrop~DragAndDropEvent#addfeatures\n   * @api\n   */\n  ADD_FEATURES: 'addfeatures'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/DragAndDrop~DragAndDrop} instances are instances\n * of this type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {module:ol/interaction/DragAndDrop~DragAndDropEventType} type Type.\n * @param {File} file File.\n * @param {Array.<module:ol/Feature>=} opt_features Features.\n * @param {module:ol/proj/Projection=} opt_projection Projection.\n */\nconst DragAndDropEvent = function(type, file, opt_features, opt_projection) {\n\n  Event.call(this, type);\n\n  /**\n   * The features parsed from dropped data.\n   * @type {Array.<module:ol/Feature>|undefined}\n   * @api\n   */\n  this.features = opt_features;\n\n  /**\n   * The dropped file.\n   * @type {File}\n   * @api\n   */\n  this.file = file;\n\n  /**\n   * The feature projection.\n   * @type {module:ol/proj/Projection|undefined}\n   * @api\n   */\n  this.projection = opt_projection;\n\n};\ninherits(DragAndDropEvent, Event);\n\n\n/**\n * @classdesc\n * Handles input of vector data by drag and drop.\n *\n * @constructor\n * @extends {module:ol/interaction/Interaction}\n * @fires module:ol/interaction/DragAndDrop~DragAndDropEvent\n * @param {module:ol/interaction/DragAndDrop~Options=} opt_options Options.\n * @api\n */\nconst DragAndDrop = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  Interaction.call(this, {\n    handleEvent: TRUE\n  });\n\n  /**\n   * @private\n   * @type {Array.<function(new: module:ol/format/Feature)>}\n   */\n  this.formatConstructors_ = options.formatConstructors ?\n    options.formatConstructors : [];\n\n  /**\n   * @private\n   * @type {module:ol/proj/Projection}\n   */\n  this.projection_ = options.projection ?\n    getProjection(options.projection) : null;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.dropListenKeys_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/source/Vector}\n   */\n  this.source_ = options.source || null;\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.target = options.target ? options.target : null;\n\n};\n\ninherits(DragAndDrop, Interaction);\n\n\n/**\n * @param {DragEvent} event Event.\n * @this {module:ol/interaction/DragAndDrop}\n */\nfunction handleDrop(event) {\n  const files = event.dataTransfer.files;\n  for (let i = 0, ii = files.length; i < ii; ++i) {\n    const file = files.item(i);\n    const reader = new FileReader();\n    reader.addEventListener(EventType.LOAD, this.handleResult_.bind(this, file));\n    reader.readAsText(file);\n  }\n}\n\n\n/**\n * @param {DragEvent} event Event.\n */\nfunction handleStop(event) {\n  event.stopPropagation();\n  event.preventDefault();\n  event.dataTransfer.dropEffect = 'copy';\n}\n\n\n/**\n * @param {File} file File.\n * @param {Event} event Load event.\n * @private\n */\nDragAndDrop.prototype.handleResult_ = function(file, event) {\n  const result = event.target.result;\n  const map = this.getMap();\n  let projection = this.projection_;\n  if (!projection) {\n    const view = map.getView();\n    projection = view.getProjection();\n  }\n\n  const formatConstructors = this.formatConstructors_;\n  let features = [];\n  for (let i = 0, ii = formatConstructors.length; i < ii; ++i) {\n    /**\n     * Avoid \"cannot instantiate abstract class\" error.\n     * @type {Function}\n     */\n    const formatConstructor = formatConstructors[i];\n    /**\n     * @type {module:ol/format/Feature}\n     */\n    const format = new formatConstructor();\n    features = this.tryReadFeatures_(format, result, {\n      featureProjection: projection\n    });\n    if (features && features.length > 0) {\n      break;\n    }\n  }\n  if (this.source_) {\n    this.source_.clear();\n    this.source_.addFeatures(features);\n  }\n  this.dispatchEvent(\n    new DragAndDropEvent(\n      DragAndDropEventType.ADD_FEATURES, file,\n      features, projection));\n};\n\n\n/**\n * @private\n */\nDragAndDrop.prototype.registerListeners_ = function() {\n  const map = this.getMap();\n  if (map) {\n    const dropArea = this.target ? this.target : map.getViewport();\n    this.dropListenKeys_ = [\n      listen(dropArea, EventType.DROP, handleDrop, this),\n      listen(dropArea, EventType.DRAGENTER, handleStop, this),\n      listen(dropArea, EventType.DRAGOVER, handleStop, this),\n      listen(dropArea, EventType.DROP, handleStop, this)\n    ];\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nDragAndDrop.prototype.setActive = function(active) {\n  Interaction.prototype.setActive.call(this, active);\n  if (active) {\n    this.registerListeners_();\n  } else {\n    this.unregisterListeners_();\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nDragAndDrop.prototype.setMap = function(map) {\n  this.unregisterListeners_();\n  Interaction.prototype.setMap.call(this, map);\n  if (this.getActive()) {\n    this.registerListeners_();\n  }\n};\n\n\n/**\n * @param {module:ol/format/Feature} format Format.\n * @param {string} text Text.\n * @param {module:ol/format/Feature~ReadOptions} options Read options.\n * @private\n * @return {Array.<module:ol/Feature>} Features.\n */\nDragAndDrop.prototype.tryReadFeatures_ = function(format, text, options) {\n  try {\n    return format.readFeatures(text, options);\n  } catch (e) {\n    return null;\n  }\n};\n\n\n/**\n * @private\n */\nDragAndDrop.prototype.unregisterListeners_ = function() {\n  if (this.dropListenKeys_) {\n    this.dropListenKeys_.forEach(unlistenByKey);\n    this.dropListenKeys_ = null;\n  }\n};\n\n\nexport default DragAndDrop;\n","/**\n * @module ol/interaction/DragRotateAndZoom\n */\nimport {inherits} from '../util.js';\nimport {disable} from '../rotationconstraint.js';\nimport ViewHint from '../ViewHint.js';\nimport {shiftKeyOnly, mouseOnly} from '../events/condition.js';\nimport {rotate, rotateWithoutConstraints, zoom, zoomWithoutConstraints} from '../interaction/Interaction.js';\nimport PointerInteraction from '../interaction/Pointer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * Default is {@link module:ol/events/condition~shiftKeyOnly}.\n * @property {number} [duration=400] Animation duration in milliseconds.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom and rotate the map by clicking and dragging\n * on the map.  By default, this interaction is limited to when the shift\n * key is held down.\n *\n * This interaction is only supported for mouse devices.\n *\n * And this interaction is not included in the default interactions.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/DragRotateAndZoom~Options=} opt_options Options.\n * @api\n */\nconst DragRotateAndZoom = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : shiftKeyOnly;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lastAngle_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.lastMagnitude_ = undefined;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.lastScaleDelta_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 400;\n\n};\n\ninherits(DragRotateAndZoom, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @this {module:ol/interaction/DragRotateAndZoom}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return;\n  }\n\n  const map = mapBrowserEvent.map;\n  const size = map.getSize();\n  const offset = mapBrowserEvent.pixel;\n  const deltaX = offset[0] - size[0] / 2;\n  const deltaY = size[1] / 2 - offset[1];\n  const theta = Math.atan2(deltaY, deltaX);\n  const magnitude = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n  const view = map.getView();\n  if (view.getConstraints().rotation !== disable && this.lastAngle_ !== undefined) {\n    const angleDelta = theta - this.lastAngle_;\n    rotateWithoutConstraints(view, view.getRotation() - angleDelta);\n  }\n  this.lastAngle_ = theta;\n  if (this.lastMagnitude_ !== undefined) {\n    const resolution = this.lastMagnitude_ * (view.getResolution() / magnitude);\n    zoomWithoutConstraints(view, resolution);\n  }\n  if (this.lastMagnitude_ !== undefined) {\n    this.lastScaleDelta_ = this.lastMagnitude_ / magnitude;\n  }\n  this.lastMagnitude_ = magnitude;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/DragRotateAndZoom}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return true;\n  }\n\n  const map = mapBrowserEvent.map;\n  const view = map.getView();\n  view.setHint(ViewHint.INTERACTING, -1);\n  const direction = this.lastScaleDelta_ - 1;\n  rotate(view, view.getRotation());\n  zoom(view, view.getResolution(), undefined, this.duration_, direction);\n  this.lastScaleDelta_ = 0;\n  return false;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/DragRotateAndZoom}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  if (!mouseOnly(mapBrowserEvent)) {\n    return false;\n  }\n\n  if (this.condition_(mapBrowserEvent)) {\n    mapBrowserEvent.map.getView().setHint(ViewHint.INTERACTING, 1);\n    this.lastAngle_ = undefined;\n    this.lastMagnitude_ = undefined;\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexport default DragRotateAndZoom;\n","/**\n * @module ol/geom/Circle\n */\nimport {inherits} from '../util.js';\nimport {createOrUpdate, forEachCorner, intersects} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {deflateCoordinate} from '../geom/flat/deflate.js';\n\n/**\n * @classdesc\n * Circle geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number=} opt_radius Radius.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst Circle = function(center, opt_radius, opt_layout) {\n  SimpleGeometry.call(this);\n  const radius = opt_radius ? opt_radius : 0;\n  this.setCenterAndRadius(center, radius, opt_layout);\n};\n\ninherits(Circle, SimpleGeometry);\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/Circle} Clone.\n * @override\n * @api\n */\nCircle.prototype.clone = function() {\n  const circle = new Circle(null);\n  circle.setFlatCoordinates(this.layout, this.flatCoordinates.slice());\n  return circle;\n};\n\n\n/**\n * @inheritDoc\n */\nCircle.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  const flatCoordinates = this.flatCoordinates;\n  const dx = x - flatCoordinates[0];\n  const dy = y - flatCoordinates[1];\n  const squaredDistance = dx * dx + dy * dy;\n  if (squaredDistance < minSquaredDistance) {\n    if (squaredDistance === 0) {\n      for (let i = 0; i < this.stride; ++i) {\n        closestPoint[i] = flatCoordinates[i];\n      }\n    } else {\n      const delta = this.getRadius() / Math.sqrt(squaredDistance);\n      closestPoint[0] = flatCoordinates[0] + delta * dx;\n      closestPoint[1] = flatCoordinates[1] + delta * dy;\n      for (let i = 2; i < this.stride; ++i) {\n        closestPoint[i] = flatCoordinates[i];\n      }\n    }\n    closestPoint.length = this.stride;\n    return squaredDistance;\n  } else {\n    return minSquaredDistance;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCircle.prototype.containsXY = function(x, y) {\n  const flatCoordinates = this.flatCoordinates;\n  const dx = x - flatCoordinates[0];\n  const dy = y - flatCoordinates[1];\n  return dx * dx + dy * dy <= this.getRadiusSquared_();\n};\n\n\n/**\n * Return the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n * @return {module:ol/coordinate~Coordinate} Center.\n * @api\n */\nCircle.prototype.getCenter = function() {\n  return this.flatCoordinates.slice(0, this.stride);\n};\n\n\n/**\n * @inheritDoc\n */\nCircle.prototype.computeExtent = function(extent) {\n  const flatCoordinates = this.flatCoordinates;\n  const radius = flatCoordinates[this.stride] - flatCoordinates[0];\n  return createOrUpdate(\n    flatCoordinates[0] - radius, flatCoordinates[1] - radius,\n    flatCoordinates[0] + radius, flatCoordinates[1] + radius,\n    extent);\n};\n\n\n/**\n * Return the radius of the circle.\n * @return {number} Radius.\n * @api\n */\nCircle.prototype.getRadius = function() {\n  return Math.sqrt(this.getRadiusSquared_());\n};\n\n\n/**\n * @private\n * @return {number} Radius squared.\n */\nCircle.prototype.getRadiusSquared_ = function() {\n  const dx = this.flatCoordinates[this.stride] - this.flatCoordinates[0];\n  const dy = this.flatCoordinates[this.stride + 1] - this.flatCoordinates[1];\n  return dx * dx + dy * dy;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nCircle.prototype.getType = function() {\n  return GeometryType.CIRCLE;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nCircle.prototype.intersectsExtent = function(extent) {\n  const circleExtent = this.getExtent();\n  if (intersects(extent, circleExtent)) {\n    const center = this.getCenter();\n\n    if (extent[0] <= center[0] && extent[2] >= center[0]) {\n      return true;\n    }\n    if (extent[1] <= center[1] && extent[3] >= center[1]) {\n      return true;\n    }\n\n    return forEachCorner(extent, this.intersectsCoordinate, this);\n  }\n  return false;\n\n};\n\n\n/**\n * Set the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @api\n */\nCircle.prototype.setCenter = function(center) {\n  const stride = this.stride;\n  const radius = this.flatCoordinates[stride] - this.flatCoordinates[0];\n  const flatCoordinates = center.slice();\n  flatCoordinates[stride] = flatCoordinates[0] + radius;\n  for (let i = 1; i < stride; ++i) {\n    flatCoordinates[stride + i] = center[i];\n  }\n  this.setFlatCoordinates(this.layout, flatCoordinates);\n};\n\n\n/**\n * Set the center (as {@link module:ol/coordinate~Coordinate coordinate}) and the radius (as\n * number) of the circle.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} radius Radius.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nCircle.prototype.setCenterAndRadius = function(center, radius, opt_layout) {\n  if (!center) {\n    this.setFlatCoordinates(GeometryLayout.XY, null);\n  } else {\n    this.setLayout(opt_layout, center, 0);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    /** @type {Array.<number>} */\n    const flatCoordinates = this.flatCoordinates;\n    let offset = deflateCoordinate(\n      flatCoordinates, 0, center, this.stride);\n    flatCoordinates[offset++] = flatCoordinates[0] + radius;\n    for (let i = 1, ii = this.stride; i < ii; ++i) {\n      flatCoordinates[offset++] = flatCoordinates[i];\n    }\n    flatCoordinates.length = offset;\n    this.changed();\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCircle.prototype.getCoordinates = function() {};\n\n\n/**\n * @inheritDoc\n */\nCircle.prototype.setCoordinates = function(coordinates, opt_layout) {};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n */\nCircle.prototype.setFlatCoordinates = function(layout, flatCoordinates) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.changed();\n};\n\n\n/**\n * Set the radius of the circle. The radius is in the units of the projection.\n * @param {number} radius Radius.\n * @api\n */\nCircle.prototype.setRadius = function(radius) {\n  this.flatCoordinates[this.stride] = this.flatCoordinates[0] + radius;\n  this.changed();\n};\n\n\n/**\n * Transform each coordinate of the circle from one coordinate reference system\n * to another. The geometry is modified in place.\n * If you do not want the geometry modified in place, first clone() it and\n * then use this function on the clone.\n *\n * Internally a circle is currently represented by two points: the center of\n * the circle `[cx, cy]`, and the point to the right of the circle\n * `[cx + r, cy]`. This `transform` function just transforms these two points.\n * So the resulting geometry is also a circle, and that circle does not\n * correspond to the shape that would be obtained by transforming every point\n * of the original circle.\n *\n * @param {module:ol/proj~ProjectionLike} source The current projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @param {module:ol/proj~ProjectionLike} destination The desired projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @return {module:ol/geom/Circle} This geometry.  Note that original geometry is\n *     modified in place.\n * @function\n * @api\n */\nCircle.prototype.transform;\nexport default Circle;\n","/**\n * @module ol/geom/MultiLineString\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LineString from '../geom/LineString.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {assignClosestArrayPoint, arrayMaxSquaredDelta} from '../geom/flat/closest.js';\nimport {deflateCoordinatesArray} from '../geom/flat/deflate.js';\nimport {inflateCoordinatesArray} from '../geom/flat/inflate.js';\nimport {interpolatePoint, lineStringsCoordinateAtM} from '../geom/flat/interpolate.js';\nimport {intersectsLineStringArray} from '../geom/flat/intersectsextent.js';\nimport {douglasPeuckerArray} from '../geom/flat/simplify.js';\n\n/**\n * @classdesc\n * Multi-linestring geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst MultiLineString = function(coordinates, opt_layout) {\n\n  SimpleGeometry.call(this);\n\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n  this.ends_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDelta_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDeltaRevision_ = -1;\n\n  this.setCoordinates(coordinates, opt_layout);\n\n};\n\ninherits(MultiLineString, SimpleGeometry);\n\n\n/**\n * Append the passed linestring to the multilinestring.\n * @param {module:ol/geom/LineString} lineString LineString.\n * @api\n */\nMultiLineString.prototype.appendLineString = function(lineString) {\n  if (!this.flatCoordinates) {\n    this.flatCoordinates = lineString.getFlatCoordinates().slice();\n  } else {\n    extend(this.flatCoordinates, lineString.getFlatCoordinates().slice());\n  }\n  this.ends_.push(this.flatCoordinates.length);\n  this.changed();\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/MultiLineString} Clone.\n * @override\n * @api\n */\nMultiLineString.prototype.clone = function() {\n  const multiLineString = new MultiLineString(null);\n  multiLineString.setFlatCoordinates(\n    this.layout, this.flatCoordinates.slice(), this.ends_.slice());\n  return multiLineString;\n};\n\n\n/**\n * @inheritDoc\n */\nMultiLineString.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  if (this.maxDeltaRevision_ != this.getRevision()) {\n    this.maxDelta_ = Math.sqrt(arrayMaxSquaredDelta(\n      this.flatCoordinates, 0, this.ends_, this.stride, 0));\n    this.maxDeltaRevision_ = this.getRevision();\n  }\n  return assignClosestArrayPoint(\n    this.flatCoordinates, 0, this.ends_, this.stride,\n    this.maxDelta_, false, x, y, closestPoint, minSquaredDistance);\n};\n\n\n/**\n * Returns the coordinate at `m` using linear interpolation, or `null` if no\n * such coordinate exists.\n *\n * `opt_extrapolate` controls extrapolation beyond the range of Ms in the\n * MultiLineString. If `opt_extrapolate` is `true` then Ms less than the first\n * M will return the first coordinate and Ms greater than the last M will\n * return the last coordinate.\n *\n * `opt_interpolate` controls interpolation between consecutive LineStrings\n * within the MultiLineString. If `opt_interpolate` is `true` the coordinates\n * will be linearly interpolated between the last coordinate of one LineString\n * and the first coordinate of the next LineString.  If `opt_interpolate` is\n * `false` then the function will return `null` for Ms falling between\n * LineStrings.\n *\n * @param {number} m M.\n * @param {boolean=} opt_extrapolate Extrapolate. Default is `false`.\n * @param {boolean=} opt_interpolate Interpolate. Default is `false`.\n * @return {module:ol/coordinate~Coordinate} Coordinate.\n * @api\n */\nMultiLineString.prototype.getCoordinateAtM = function(m, opt_extrapolate, opt_interpolate) {\n  if ((this.layout != GeometryLayout.XYM &&\n       this.layout != GeometryLayout.XYZM) ||\n      this.flatCoordinates.length === 0) {\n    return null;\n  }\n  const extrapolate = opt_extrapolate !== undefined ? opt_extrapolate : false;\n  const interpolate = opt_interpolate !== undefined ? opt_interpolate : false;\n  return lineStringsCoordinateAtM(this.flatCoordinates, 0,\n    this.ends_, this.stride, m, extrapolate, interpolate);\n};\n\n\n/**\n * Return the coordinates of the multilinestring.\n * @return {Array.<Array.<module:ol/coordinate~Coordinate>>} Coordinates.\n * @override\n * @api\n */\nMultiLineString.prototype.getCoordinates = function() {\n  return inflateCoordinatesArray(\n    this.flatCoordinates, 0, this.ends_, this.stride);\n};\n\n\n/**\n * @return {Array.<number>} Ends.\n */\nMultiLineString.prototype.getEnds = function() {\n  return this.ends_;\n};\n\n\n/**\n * Return the linestring at the specified index.\n * @param {number} index Index.\n * @return {module:ol/geom/LineString} LineString.\n * @api\n */\nMultiLineString.prototype.getLineString = function(index) {\n  if (index < 0 || this.ends_.length <= index) {\n    return null;\n  }\n  const lineString = new LineString(null);\n  lineString.setFlatCoordinates(this.layout, this.flatCoordinates.slice(\n    index === 0 ? 0 : this.ends_[index - 1], this.ends_[index]));\n  return lineString;\n};\n\n\n/**\n * Return the linestrings of this multilinestring.\n * @return {Array.<module:ol/geom/LineString>} LineStrings.\n * @api\n */\nMultiLineString.prototype.getLineStrings = function() {\n  const flatCoordinates = this.flatCoordinates;\n  const ends = this.ends_;\n  const layout = this.layout;\n  /** @type {Array.<module:ol/geom/LineString>} */\n  const lineStrings = [];\n  let offset = 0;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const lineString = new LineString(null);\n    lineString.setFlatCoordinates(layout, flatCoordinates.slice(offset, end));\n    lineStrings.push(lineString);\n    offset = end;\n  }\n  return lineStrings;\n};\n\n\n/**\n * @return {Array.<number>} Flat midpoints.\n */\nMultiLineString.prototype.getFlatMidpoints = function() {\n  const midpoints = [];\n  const flatCoordinates = this.flatCoordinates;\n  let offset = 0;\n  const ends = this.ends_;\n  const stride = this.stride;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const midpoint = interpolatePoint(\n      flatCoordinates, offset, end, stride, 0.5);\n    extend(midpoints, midpoint);\n    offset = end;\n  }\n  return midpoints;\n};\n\n\n/**\n * @inheritDoc\n */\nMultiLineString.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  const simplifiedFlatCoordinates = [];\n  const simplifiedEnds = [];\n  simplifiedFlatCoordinates.length = douglasPeuckerArray(\n    this.flatCoordinates, 0, this.ends_, this.stride, squaredTolerance,\n    simplifiedFlatCoordinates, 0, simplifiedEnds);\n  const simplifiedMultiLineString = new MultiLineString(null);\n  simplifiedMultiLineString.setFlatCoordinates(\n    GeometryLayout.XY, simplifiedFlatCoordinates, simplifiedEnds);\n  return simplifiedMultiLineString;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiLineString.prototype.getType = function() {\n  return GeometryType.MULTI_LINE_STRING;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiLineString.prototype.intersectsExtent = function(extent) {\n  return intersectsLineStringArray(\n    this.flatCoordinates, 0, this.ends_, this.stride, extent);\n};\n\n\n/**\n * Set the coordinates of the multilinestring.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nMultiLineString.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null, this.ends_);\n  } else {\n    this.setLayout(opt_layout, coordinates, 2);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    const ends = deflateCoordinatesArray(\n      this.flatCoordinates, 0, coordinates, this.stride, this.ends_);\n    this.flatCoordinates.length = ends.length === 0 ? 0 : ends[ends.length - 1];\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<number>} ends Ends.\n */\nMultiLineString.prototype.setFlatCoordinates = function(layout, flatCoordinates, ends) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.ends_ = ends;\n  this.changed();\n};\n\n\n/**\n * @param {Array.<module:ol/geom/LineString>} lineStrings LineStrings.\n */\nMultiLineString.prototype.setLineStrings = function(lineStrings) {\n  let layout = this.getLayout();\n  const flatCoordinates = [];\n  const ends = [];\n  for (let i = 0, ii = lineStrings.length; i < ii; ++i) {\n    const lineString = lineStrings[i];\n    if (i === 0) {\n      layout = lineString.getLayout();\n    }\n    extend(flatCoordinates, lineString.getFlatCoordinates());\n    ends.push(flatCoordinates.length);\n  }\n  this.setFlatCoordinates(layout, flatCoordinates, ends);\n};\nexport default MultiLineString;\n","/**\n * @module ol/geom/MultiPoint\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {closestSquaredDistanceXY, containsXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport Point from '../geom/Point.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {deflateCoordinates} from '../geom/flat/deflate.js';\nimport {inflateCoordinates} from '../geom/flat/inflate.js';\nimport {squaredDistance as squaredDx} from '../math.js';\n\n/**\n * @classdesc\n * Multi-point geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst MultiPoint = function(coordinates, opt_layout) {\n  SimpleGeometry.call(this);\n  this.setCoordinates(coordinates, opt_layout);\n};\n\ninherits(MultiPoint, SimpleGeometry);\n\n\n/**\n * Append the passed point to this multipoint.\n * @param {module:ol/geom/Point} point Point.\n * @api\n */\nMultiPoint.prototype.appendPoint = function(point) {\n  if (!this.flatCoordinates) {\n    this.flatCoordinates = point.getFlatCoordinates().slice();\n  } else {\n    extend(this.flatCoordinates, point.getFlatCoordinates());\n  }\n  this.changed();\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/MultiPoint} Clone.\n * @override\n * @api\n */\nMultiPoint.prototype.clone = function() {\n  const multiPoint = new MultiPoint(null);\n  multiPoint.setFlatCoordinates(this.layout, this.flatCoordinates.slice());\n  return multiPoint;\n};\n\n\n/**\n * @inheritDoc\n */\nMultiPoint.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  const flatCoordinates = this.flatCoordinates;\n  const stride = this.stride;\n  for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n    const squaredDistance = squaredDx(\n      x, y, flatCoordinates[i], flatCoordinates[i + 1]);\n    if (squaredDistance < minSquaredDistance) {\n      minSquaredDistance = squaredDistance;\n      for (let j = 0; j < stride; ++j) {\n        closestPoint[j] = flatCoordinates[i + j];\n      }\n      closestPoint.length = stride;\n    }\n  }\n  return minSquaredDistance;\n};\n\n\n/**\n * Return the coordinates of the multipoint.\n * @return {Array.<module:ol/coordinate~Coordinate>} Coordinates.\n * @override\n * @api\n */\nMultiPoint.prototype.getCoordinates = function() {\n  return inflateCoordinates(\n    this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);\n};\n\n\n/**\n * Return the point at the specified index.\n * @param {number} index Index.\n * @return {module:ol/geom/Point} Point.\n * @api\n */\nMultiPoint.prototype.getPoint = function(index) {\n  const n = !this.flatCoordinates ? 0 : this.flatCoordinates.length / this.stride;\n  if (index < 0 || n <= index) {\n    return null;\n  }\n  const point = new Point(null);\n  point.setFlatCoordinates(this.layout, this.flatCoordinates.slice(\n    index * this.stride, (index + 1) * this.stride));\n  return point;\n};\n\n\n/**\n * Return the points of this multipoint.\n * @return {Array.<module:ol/geom/Point>} Points.\n * @api\n */\nMultiPoint.prototype.getPoints = function() {\n  const flatCoordinates = this.flatCoordinates;\n  const layout = this.layout;\n  const stride = this.stride;\n  /** @type {Array.<module:ol/geom/Point>} */\n  const points = [];\n  for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n    const point = new Point(null);\n    point.setFlatCoordinates(layout, flatCoordinates.slice(i, i + stride));\n    points.push(point);\n  }\n  return points;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiPoint.prototype.getType = function() {\n  return GeometryType.MULTI_POINT;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiPoint.prototype.intersectsExtent = function(extent) {\n  const flatCoordinates = this.flatCoordinates;\n  const stride = this.stride;\n  for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n    const x = flatCoordinates[i];\n    const y = flatCoordinates[i + 1];\n    if (containsXY(extent, x, y)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Set the coordinates of the multipoint.\n * @param {Array.<module:ol/coordinate~Coordinate>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nMultiPoint.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null);\n  } else {\n    this.setLayout(opt_layout, coordinates, 1);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinates(\n      this.flatCoordinates, 0, coordinates, this.stride);\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n */\nMultiPoint.prototype.setFlatCoordinates = function(layout, flatCoordinates) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.changed();\n};\nexport default MultiPoint;\n","/**\n * @module ol/geom/flat/center\n */\nimport {createEmpty, createOrUpdateFromFlatCoordinates} from '../../extent.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<Array.<number>>} endss Endss.\n * @param {number} stride Stride.\n * @return {Array.<number>} Flat centers.\n */\nexport function linearRingss(flatCoordinates, offset, endss, stride) {\n  const flatCenters = [];\n  let extent = createEmpty();\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    extent = createOrUpdateFromFlatCoordinates(flatCoordinates, offset, ends[0], stride);\n    flatCenters.push((extent[0] + extent[2]) / 2, (extent[1] + extent[3]) / 2);\n    offset = ends[ends.length - 1];\n  }\n  return flatCenters;\n}\n","/**\n * @module ol/geom/MultiPolygon\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport Polygon from '../geom/Polygon.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\nimport {linearRingss as linearRingssArea} from '../geom/flat/area.js';\nimport {linearRingss as linearRingssCenter} from '../geom/flat/center.js';\nimport {assignClosestMultiArrayPoint, multiArrayMaxSquaredDelta} from '../geom/flat/closest.js';\nimport {linearRingssContainsXY} from '../geom/flat/contains.js';\nimport {deflateMultiCoordinatesArray} from '../geom/flat/deflate.js';\nimport {inflateMultiCoordinatesArray} from '../geom/flat/inflate.js';\nimport {getInteriorPointsOfMultiArray} from '../geom/flat/interiorpoint.js';\nimport {intersectsLinearRingMultiArray} from '../geom/flat/intersectsextent.js';\nimport {linearRingsAreOriented, orientLinearRingsArray} from '../geom/flat/orient.js';\nimport {quantizeMultiArray} from '../geom/flat/simplify.js';\n\n/**\n * @classdesc\n * Multi-polygon geometry.\n *\n * @constructor\n * @extends {module:ol/geom/SimpleGeometry}\n * @param {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @api\n */\nconst MultiPolygon = function(coordinates, opt_layout) {\n\n  SimpleGeometry.call(this);\n\n  /**\n   * @type {Array.<Array.<number>>}\n   * @private\n   */\n  this.endss_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.flatInteriorPointsRevision_ = -1;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.flatInteriorPoints_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDelta_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxDeltaRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.orientedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.orientedFlatCoordinates_ = null;\n\n  this.setCoordinates(coordinates, opt_layout);\n\n};\n\ninherits(MultiPolygon, SimpleGeometry);\n\n\n/**\n * Append the passed polygon to this multipolygon.\n * @param {module:ol/geom/Polygon} polygon Polygon.\n * @api\n */\nMultiPolygon.prototype.appendPolygon = function(polygon) {\n  /** @type {Array.<number>} */\n  let ends;\n  if (!this.flatCoordinates) {\n    this.flatCoordinates = polygon.getFlatCoordinates().slice();\n    ends = polygon.getEnds().slice();\n    this.endss_.push();\n  } else {\n    const offset = this.flatCoordinates.length;\n    extend(this.flatCoordinates, polygon.getFlatCoordinates());\n    ends = polygon.getEnds().slice();\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      ends[i] += offset;\n    }\n  }\n  this.endss_.push(ends);\n  this.changed();\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/MultiPolygon} Clone.\n * @override\n * @api\n */\nMultiPolygon.prototype.clone = function() {\n  const multiPolygon = new MultiPolygon(null);\n\n  const len = this.endss_.length;\n  const newEndss = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    newEndss[i] = this.endss_[i].slice();\n  }\n\n  multiPolygon.setFlatCoordinates(\n    this.layout, this.flatCoordinates.slice(), newEndss);\n  return multiPolygon;\n};\n\n\n/**\n * @inheritDoc\n */\nMultiPolygon.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  if (this.maxDeltaRevision_ != this.getRevision()) {\n    this.maxDelta_ = Math.sqrt(multiArrayMaxSquaredDelta(\n      this.flatCoordinates, 0, this.endss_, this.stride, 0));\n    this.maxDeltaRevision_ = this.getRevision();\n  }\n  return assignClosestMultiArrayPoint(\n    this.getOrientedFlatCoordinates(), 0, this.endss_, this.stride,\n    this.maxDelta_, true, x, y, closestPoint, minSquaredDistance);\n};\n\n\n/**\n * @inheritDoc\n */\nMultiPolygon.prototype.containsXY = function(x, y) {\n  return linearRingssContainsXY(this.getOrientedFlatCoordinates(), 0, this.endss_, this.stride, x, y);\n};\n\n\n/**\n * Return the area of the multipolygon on projected plane.\n * @return {number} Area (on projected plane).\n * @api\n */\nMultiPolygon.prototype.getArea = function() {\n  return linearRingssArea(this.getOrientedFlatCoordinates(), 0, this.endss_, this.stride);\n};\n\n\n/**\n * Get the coordinate array for this geometry.  This array has the structure\n * of a GeoJSON coordinate array for multi-polygons.\n *\n * @param {boolean=} opt_right Orient coordinates according to the right-hand\n *     rule (counter-clockwise for exterior and clockwise for interior rings).\n *     If `false`, coordinates will be oriented according to the left-hand rule\n *     (clockwise for exterior and counter-clockwise for interior rings).\n *     By default, coordinate orientation will depend on how the geometry was\n *     constructed.\n * @return {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>} Coordinates.\n * @override\n * @api\n */\nMultiPolygon.prototype.getCoordinates = function(opt_right) {\n  let flatCoordinates;\n  if (opt_right !== undefined) {\n    flatCoordinates = this.getOrientedFlatCoordinates().slice();\n    orientLinearRingsArray(\n      flatCoordinates, 0, this.endss_, this.stride, opt_right);\n  } else {\n    flatCoordinates = this.flatCoordinates;\n  }\n\n  return inflateMultiCoordinatesArray(\n    flatCoordinates, 0, this.endss_, this.stride);\n};\n\n\n/**\n * @return {Array.<Array.<number>>} Endss.\n */\nMultiPolygon.prototype.getEndss = function() {\n  return this.endss_;\n};\n\n\n/**\n * @return {Array.<number>} Flat interior points.\n */\nMultiPolygon.prototype.getFlatInteriorPoints = function() {\n  if (this.flatInteriorPointsRevision_ != this.getRevision()) {\n    const flatCenters = linearRingssCenter(\n      this.flatCoordinates, 0, this.endss_, this.stride);\n    this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\n      this.getOrientedFlatCoordinates(), 0, this.endss_, this.stride,\n      flatCenters);\n    this.flatInteriorPointsRevision_ = this.getRevision();\n  }\n  return this.flatInteriorPoints_;\n};\n\n\n/**\n * Return the interior points as {@link module:ol/geom/MultiPoint multipoint}.\n * @return {module:ol/geom/MultiPoint} Interior points as XYM coordinates, where M is\n * the length of the horizontal intersection that the point belongs to.\n * @api\n */\nMultiPolygon.prototype.getInteriorPoints = function() {\n  const interiorPoints = new MultiPoint(null);\n  interiorPoints.setFlatCoordinates(GeometryLayout.XYM,\n    this.getFlatInteriorPoints().slice());\n  return interiorPoints;\n};\n\n\n/**\n * @return {Array.<number>} Oriented flat coordinates.\n */\nMultiPolygon.prototype.getOrientedFlatCoordinates = function() {\n  if (this.orientedRevision_ != this.getRevision()) {\n    const flatCoordinates = this.flatCoordinates;\n    if (linearRingsAreOriented(\n      flatCoordinates, 0, this.endss_, this.stride)) {\n      this.orientedFlatCoordinates_ = flatCoordinates;\n    } else {\n      this.orientedFlatCoordinates_ = flatCoordinates.slice();\n      this.orientedFlatCoordinates_.length =\n          orientLinearRingsArray(\n            this.orientedFlatCoordinates_, 0, this.endss_, this.stride);\n    }\n    this.orientedRevision_ = this.getRevision();\n  }\n  return this.orientedFlatCoordinates_;\n};\n\n\n/**\n * @inheritDoc\n */\nMultiPolygon.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {\n  const simplifiedFlatCoordinates = [];\n  const simplifiedEndss = [];\n  simplifiedFlatCoordinates.length = quantizeMultiArray(\n    this.flatCoordinates, 0, this.endss_, this.stride,\n    Math.sqrt(squaredTolerance),\n    simplifiedFlatCoordinates, 0, simplifiedEndss);\n  const simplifiedMultiPolygon = new MultiPolygon(null);\n  simplifiedMultiPolygon.setFlatCoordinates(\n    GeometryLayout.XY, simplifiedFlatCoordinates, simplifiedEndss);\n  return simplifiedMultiPolygon;\n};\n\n\n/**\n * Return the polygon at the specified index.\n * @param {number} index Index.\n * @return {module:ol/geom/Polygon} Polygon.\n * @api\n */\nMultiPolygon.prototype.getPolygon = function(index) {\n  if (index < 0 || this.endss_.length <= index) {\n    return null;\n  }\n  let offset;\n  if (index === 0) {\n    offset = 0;\n  } else {\n    const prevEnds = this.endss_[index - 1];\n    offset = prevEnds[prevEnds.length - 1];\n  }\n  const ends = this.endss_[index].slice();\n  const end = ends[ends.length - 1];\n  if (offset !== 0) {\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      ends[i] -= offset;\n    }\n  }\n  const polygon = new Polygon(null);\n  polygon.setFlatCoordinates(\n    this.layout, this.flatCoordinates.slice(offset, end), ends);\n  return polygon;\n};\n\n\n/**\n * Return the polygons of this multipolygon.\n * @return {Array.<module:ol/geom/Polygon>} Polygons.\n * @api\n */\nMultiPolygon.prototype.getPolygons = function() {\n  const layout = this.layout;\n  const flatCoordinates = this.flatCoordinates;\n  const endss = this.endss_;\n  const polygons = [];\n  let offset = 0;\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i].slice();\n    const end = ends[ends.length - 1];\n    if (offset !== 0) {\n      for (let j = 0, jj = ends.length; j < jj; ++j) {\n        ends[j] -= offset;\n      }\n    }\n    const polygon = new Polygon(null);\n    polygon.setFlatCoordinates(\n      layout, flatCoordinates.slice(offset, end), ends);\n    polygons.push(polygon);\n    offset = end;\n  }\n  return polygons;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiPolygon.prototype.getType = function() {\n  return GeometryType.MULTI_POLYGON;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMultiPolygon.prototype.intersectsExtent = function(extent) {\n  return intersectsLinearRingMultiArray(\n    this.getOrientedFlatCoordinates(), 0, this.endss_, this.stride, extent);\n};\n\n\n/**\n * Set the coordinates of the multipolygon.\n * @param {Array.<Array.<Array.<module:ol/coordinate~Coordinate>>>} coordinates Coordinates.\n * @param {module:ol/geom/GeometryLayout=} opt_layout Layout.\n * @override\n * @api\n */\nMultiPolygon.prototype.setCoordinates = function(coordinates, opt_layout) {\n  if (!coordinates) {\n    this.setFlatCoordinates(GeometryLayout.XY, null, this.endss_);\n  } else {\n    this.setLayout(opt_layout, coordinates, 3);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    const endss = deflateMultiCoordinatesArray(\n      this.flatCoordinates, 0, coordinates, this.stride, this.endss_);\n    if (endss.length === 0) {\n      this.flatCoordinates.length = 0;\n    } else {\n      const lastEnds = endss[endss.length - 1];\n      this.flatCoordinates.length = lastEnds.length === 0 ?\n        0 : lastEnds[lastEnds.length - 1];\n    }\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/geom/GeometryLayout} layout Layout.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} endss Endss.\n */\nMultiPolygon.prototype.setFlatCoordinates = function(layout, flatCoordinates, endss) {\n  this.setFlatCoordinatesInternal(layout, flatCoordinates);\n  this.endss_ = endss;\n  this.changed();\n};\n\n\n/**\n * @param {Array.<module:ol/geom/Polygon>} polygons Polygons.\n */\nMultiPolygon.prototype.setPolygons = function(polygons) {\n  let layout = this.getLayout();\n  const flatCoordinates = [];\n  const endss = [];\n  for (let i = 0, ii = polygons.length; i < ii; ++i) {\n    const polygon = polygons[i];\n    if (i === 0) {\n      layout = polygon.getLayout();\n    }\n    const offset = flatCoordinates.length;\n    const ends = polygon.getEnds();\n    for (let j = 0, jj = ends.length; j < jj; ++j) {\n      ends[j] += offset;\n    }\n    extend(flatCoordinates, polygon.getFlatCoordinates());\n    endss.push(ends);\n  }\n  this.setFlatCoordinates(layout, flatCoordinates, endss);\n};\n\nexport default MultiPolygon;\n","/**\n * @module ol/LayerType\n */\n\n/**\n * A layer type used when creating layer renderers.\n * @enum {string}\n */\nexport default {\n  IMAGE: 'IMAGE',\n  TILE: 'TILE',\n  VECTOR_TILE: 'VECTOR_TILE',\n  VECTOR: 'VECTOR'\n};\n","/**\n * @module ol/layer/VectorRenderType\n */\n\n/**\n * @enum {string}\n * Render mode for vector layers:\n *  * `'image'`: Vector layers are rendered as images. Great performance, but\n *    point symbols and texts are always rotated with the view and pixels are\n *    scaled during zoom animations.\n *  * `'vector'`: Vector layers are rendered as vectors. Most accurate rendering\n *    even during animations, but slower performance.\n * @api\n */\nexport default {\n  IMAGE: 'image',\n  VECTOR: 'vector'\n};\n","/**\n * @module ol/layer/Vector\n */\nimport {inherits} from '../util.js';\nimport LayerType from '../LayerType.js';\nimport Layer from '../layer/Layer.js';\nimport VectorRenderType from '../layer/VectorRenderType.js';\nimport {assign} from '../obj.js';\nimport {createDefaultStyle, toFunction as toStyleFunction} from '../style/Style.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {module:ol/render~OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created. Use\n * `null` to avoid the sort, but get an undefined draw order.\n * @property {number} [renderBuffer=100] The buffer in pixels around the viewport extent used by the\n * renderer when getting features from the vector source for the rendering or hit-detection.\n * Recommended value: the size of the largest symbol, line width or label.\n * @property {module:ol/layer/VectorRenderType|string} [renderMode='vector'] Render mode for vector layers:\n *  * `'image'`: Vector layers are rendered as images. Great performance, but point symbols and\n *    texts are always rotated with the view and pixels are scaled during zoom animations.\n *  * `'vector'`: Vector layers are rendered as vectors. Most accurate rendering even during\n *    animations, but slower performance.\n * @property {module:ol/source/Vector} [source] Source.\n * @property {module:ol/PluggableMap} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map#addLayer}.\n * @property {boolean} [declutter=false] Declutter images and text. Decluttering is applied to all\n * image and text styles, and the priority is defined by the z-index of the style. Lower z-index\n * means higher priority.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [style] Layer style. See\n * {@link module:ol/style} for default style which will be used if this is not defined.\n * @property {boolean} [updateWhileAnimating=false] When set to `true` and `renderMode`\n * is `vector`, feature batches will be recreated during animations. This means that no\n * vectors will be shown clipped, but the setting will have a performance impact for large\n * amounts of vector data. When set to `false`, batches will be recreated when no animation\n * is active.\n * @property {boolean} [updateWhileInteracting=false] When set to `true` and `renderMode`\n * is `vector`, feature batches will be recreated during interactions. See also\n * `updateWhileAnimating`.\n */\n\n\n/**\n * @enum {string}\n * Render mode for vector layers:\n *  * `'image'`: Vector layers are rendered as images. Great performance, but\n *    point symbols and texts are always rotated with the view and pixels are\n *    scaled during zoom animations.\n *  * `'vector'`: Vector layers are rendered as vectors. Most accurate rendering\n *    even during animations, but slower performance.\n * @api\n */\nexport const RenderType = {\n  IMAGE: 'image',\n  VECTOR: 'vector'\n};\n\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  RENDER_ORDER: 'renderOrder'\n};\n\n\n/**\n * @classdesc\n * Vector data that is rendered client-side.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @constructor\n * @extends {module:ol/layer/Layer}\n * @fires module:ol/render/Event~RenderEvent\n * @param {module:ol/layer/Vector~Options=} opt_options Options.\n * @api\n */\nconst VectorLayer = function(opt_options) {\n  const options = opt_options ?\n    opt_options : /** @type {module:ol/layer/Vector~Options} */ ({});\n\n  const baseOptions = assign({}, options);\n\n  delete baseOptions.style;\n  delete baseOptions.renderBuffer;\n  delete baseOptions.updateWhileAnimating;\n  delete baseOptions.updateWhileInteracting;\n  Layer.call(this, /** @type {module:ol/layer/Layer~Options} */ (baseOptions));\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.declutter_ = options.declutter !== undefined ? options.declutter : false;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.renderBuffer_ = options.renderBuffer !== undefined ?\n    options.renderBuffer : 100;\n\n  /**\n   * User provided style.\n   * @type {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction}\n   * @private\n   */\n  this.style_ = null;\n\n  /**\n   * Style function for use within the library.\n   * @type {module:ol/style/Style~StyleFunction|undefined}\n   * @private\n   */\n  this.styleFunction_ = undefined;\n\n  this.setStyle(options.style);\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.updateWhileAnimating_ = options.updateWhileAnimating !== undefined ?\n    options.updateWhileAnimating : false;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.updateWhileInteracting_ = options.updateWhileInteracting !== undefined ?\n    options.updateWhileInteracting : false;\n\n  /**\n   * @private\n   * @type {module:ol/layer/VectorTileRenderType|string}\n   */\n  this.renderMode_ = options.renderMode || VectorRenderType.VECTOR;\n\n  /**\n   * The layer type.\n   * @protected\n   * @type {module:ol/LayerType}\n   */\n  this.type = LayerType.VECTOR;\n\n};\n\ninherits(VectorLayer, Layer);\n\n\n/**\n * @return {boolean} Declutter.\n */\nVectorLayer.prototype.getDeclutter = function() {\n  return this.declutter_;\n};\n\n\n/**\n * @param {boolean} declutter Declutter.\n */\nVectorLayer.prototype.setDeclutter = function(declutter) {\n  this.declutter_ = declutter;\n};\n\n\n/**\n * @return {number|undefined} Render buffer.\n */\nVectorLayer.prototype.getRenderBuffer = function() {\n  return this.renderBuffer_;\n};\n\n\n/**\n * @return {function(module:ol/Feature, module:ol/Feature): number|null|undefined} Render\n *     order.\n */\nVectorLayer.prototype.getRenderOrder = function() {\n  return (\n    /** @type {module:ol/render~OrderFunction|null|undefined} */ (this.get(Property.RENDER_ORDER))\n  );\n};\n\n\n/**\n * Return the associated {@link module:ol/source/Vector vectorsource} of the layer.\n * @function\n * @return {module:ol/source/Vector} Source.\n * @api\n */\nVectorLayer.prototype.getSource;\n\n\n/**\n * Get the style for features.  This returns whatever was passed to the `style`\n * option at construction or to the `setStyle` method.\n * @return {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction}\n *     Layer style.\n * @api\n */\nVectorLayer.prototype.getStyle = function() {\n  return this.style_;\n};\n\n\n/**\n * Get the style function.\n * @return {module:ol/style/Style~StyleFunction|undefined} Layer style function.\n * @api\n */\nVectorLayer.prototype.getStyleFunction = function() {\n  return this.styleFunction_;\n};\n\n\n/**\n * @return {boolean} Whether the rendered layer should be updated while\n *     animating.\n */\nVectorLayer.prototype.getUpdateWhileAnimating = function() {\n  return this.updateWhileAnimating_;\n};\n\n\n/**\n * @return {boolean} Whether the rendered layer should be updated while\n *     interacting.\n */\nVectorLayer.prototype.getUpdateWhileInteracting = function() {\n  return this.updateWhileInteracting_;\n};\n\n\n/**\n * @param {module:ol/render~OrderFunction|null|undefined} renderOrder\n *     Render order.\n */\nVectorLayer.prototype.setRenderOrder = function(renderOrder) {\n  this.set(Property.RENDER_ORDER, renderOrder);\n};\n\n\n/**\n * Set the style for features.  This can be a single style object, an array\n * of styles, or a function that takes a feature and resolution and returns\n * an array of styles. If it is `undefined` the default style is used. If\n * it is `null` the layer has no style (a `null` style), so only features\n * that have their own styles will be rendered in the layer. See\n * {@link module:ol/style} for information on the default style.\n * @param {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction|null|undefined}\n *     style Layer style.\n * @api\n */\nVectorLayer.prototype.setStyle = function(style) {\n  this.style_ = style !== undefined ? style : createDefaultStyle;\n  this.styleFunction_ = style === null ?\n    undefined : toStyleFunction(this.style_);\n  this.changed();\n};\n\n\n/**\n * @return {module:ol/layer/VectorRenderType|string} The render mode.\n */\nVectorLayer.prototype.getRenderMode = function() {\n  return this.renderMode_;\n};\n\n\nexport default VectorLayer;\n","/**\n * @module ol/format/FormatType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  ARRAY_BUFFER: 'arraybuffer',\n  JSON: 'json',\n  TEXT: 'text',\n  XML: 'xml'\n};\n","/**\n * @module ol/featureloader\n */\nimport {UNDEFINED} from './functions.js';\nimport FormatType from './format/FormatType.js';\n\n\n/**\n * {@link module:ol/source/Vector} sources use a function of this type to\n * load features.\n *\n * This function takes an {@link module:ol/extent~Extent} representing the area to be loaded,\n * a `{number}` representing the resolution (map units per pixel) and an\n * {@link module:ol/proj/Projection} for the projection  as\n * arguments. `this` within the function is bound to the\n * {@link module:ol/source/Vector} it's called from.\n *\n * The function is responsible for loading the features and adding them to the\n * source.\n * @typedef {function(this:module:ol/source/Vector, module:ol/extent~Extent, number,\n *                    module:ol/proj/Projection)} FeatureLoader\n * @api\n */\n\n\n/**\n * {@link module:ol/source/Vector} sources use a function of this type to\n * get the url to load features from.\n *\n * This function takes an {@link module:ol/extent~Extent} representing the area\n * to be loaded, a `{number}` representing the resolution (map units per pixel)\n * and an {@link module:ol/proj/Projection} for the projection  as\n * arguments and returns a `{string}` representing the URL.\n * @typedef {function(module:ol/extent~Extent, number, module:ol/proj/Projection): string} FeatureUrlFunction\n * @api\n */\n\n\n/**\n * @param {string|module:ol/featureloader~FeatureUrlFunction} url Feature URL service.\n * @param {module:ol/format/Feature} format Feature format.\n * @param {function(this:module:ol/VectorTile, Array.<module:ol/Feature>, module:ol/proj/Projection, module:ol/extent~Extent)|function(this:module:ol/source/Vector, Array.<module:ol/Feature>)} success\n *     Function called with the loaded features and optionally with the data\n *     projection. Called with the vector tile or source as `this`.\n * @param {function(this:module:ol/VectorTile)|function(this:module:ol/source/Vector)} failure\n *     Function called when loading failed. Called with the vector tile or\n *     source as `this`.\n * @return {module:ol/featureloader~FeatureLoader} The feature loader.\n */\nexport function loadFeaturesXhr(url, format, success, failure) {\n  return (\n    /**\n     * @param {module:ol/extent~Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {module:ol/proj/Projection} projection Projection.\n     * @this {module:ol/source/Vector|module:ol/VectorTile}\n     */\n    function(extent, resolution, projection) {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET',\n        typeof url === 'function' ? url(extent, resolution, projection) : url,\n        true);\n      if (format.getType() == FormatType.ARRAY_BUFFER) {\n        xhr.responseType = 'arraybuffer';\n      }\n      /**\n       * @param {Event} event Event.\n       * @private\n       */\n      xhr.onload = function(event) {\n        // status will be 0 for file:// urls\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          /** @type {Document|Node|Object|string|undefined} */\n          let source;\n          if (type == FormatType.JSON || type == FormatType.TEXT) {\n            source = xhr.responseText;\n          } else if (type == FormatType.XML) {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          } else if (type == FormatType.ARRAY_BUFFER) {\n            source = /** @type {ArrayBuffer} */ (xhr.response);\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source,\n              {featureProjection: projection}),\n            format.readProjection(source), format.getLastExtent());\n          } else {\n            failure.call(this);\n          }\n        } else {\n          failure.call(this);\n        }\n      }.bind(this);\n      /**\n       * @private\n       */\n      xhr.onerror = function() {\n        failure.call(this);\n      }.bind(this);\n      xhr.send();\n    }\n  );\n}\n\n\n/**\n * Create an XHR feature loader for a `url` and `format`. The feature loader\n * loads features (with XHR), parses the features, and adds them to the\n * vector source.\n * @param {string|module:ol/featureloader~FeatureUrlFunction} url Feature URL service.\n * @param {module:ol/format/Feature} format Feature format.\n * @return {module:ol/featureloader~FeatureLoader} The feature loader.\n * @api\n */\nexport function xhr(url, format) {\n  return loadFeaturesXhr(url, format,\n    /**\n     * @param {Array.<module:ol/Feature>} features The loaded features.\n     * @param {module:ol/proj/Projection} dataProjection Data\n     * projection.\n     * @this {module:ol/source/Vector}\n     */\n    function(features, dataProjection) {\n      this.addFeatures(features);\n    }, /* FIXME handle error */ UNDEFINED);\n}\n","/**\n * @module ol/loadingstrategy\n */\n\n\n/**\n * Strategy function for loading all features with a single request.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array.<module:ol/extent~Extent>} Extents.\n * @api\n */\nexport function all(extent, resolution) {\n  return [[-Infinity, -Infinity, Infinity, Infinity]];\n}\n\n\n/**\n * Strategy function for loading features based on the view's extent and\n * resolution.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array.<module:ol/extent~Extent>} Extents.\n * @api\n */\nexport function bbox(extent, resolution) {\n  return [extent];\n}\n\n\n/**\n * Creates a strategy function for loading features based on a tile grid.\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @return {function(module:ol/extent~Extent, number): Array.<module:ol/extent~Extent>} Loading strategy.\n * @api\n */\nexport function tile(tileGrid) {\n  return (\n    /**\n     * @param {module:ol/extent~Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @return {Array.<module:ol/extent~Extent>} Extents.\n     */\n    function(extent, resolution) {\n      const z = tileGrid.getZForResolution(resolution);\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n      /** @type {Array.<module:ol/extent~Extent>} */\n      const extents = [];\n      /** @type {module:ol/tilecoord~TileCoord} */\n      const tileCoord = [z, 0, 0];\n      for (tileCoord[1] = tileRange.minX; tileCoord[1] <= tileRange.maxX; ++tileCoord[1]) {\n        for (tileCoord[2] = tileRange.minY; tileCoord[2] <= tileRange.maxY; ++tileCoord[2]) {\n          extents.push(tileGrid.getTileCoordExtent(tileCoord));\n        }\n      }\n      return extents;\n    }\n  );\n}\n","/**\n * @module ol/source/Source\n */\nimport {inherits} from '../util.js';\nimport {UNDEFINED} from '../functions.js';\nimport BaseObject from '../Object.js';\nimport {get as getProjection} from '../proj.js';\nimport SourceState from '../source/State.js';\n\n\n/**\n * A function that returns a string or an array of strings representing source\n * attributions.\n *\n * @typedef {function(module:ol/PluggableMap~FrameState): (string|Array.<string>)} Attribution\n */\n\n\n/**\n * A type that can be used to provide attribution information for data sources.\n *\n * It represents either\n * * a simple string (e.g. `' Acme Inc.'`)\n * * an array of simple strings (e.g. `[' Acme Inc.', ' Bacme Inc.']`)\n * * a function that returns a string or array of strings (`{@link module:ol/source/Source~Attribution}`)\n *\n * @typedef {string|Array.<string>|module:ol/source/Source~Attribution} AttributionLike\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions]\n * @property {module:ol/proj~ProjectionLike} projection\n * @property {module:ol/source/State} [state]\n * @property {boolean} [wrapX]\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for {@link module:ol/layer/Layer~Layer} sources.\n *\n * A generic `change` event is triggered when the state of the source changes.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/Object}\n * @param {module:ol/source/Source~Options} options Source options.\n * @api\n */\nconst Source = function(options) {\n\n  BaseObject.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/proj/Projection}\n   */\n  this.projection_ = getProjection(options.projection);\n\n  /**\n   * @private\n   * @type {?module:ol/source/Source~Attribution}\n   */\n  this.attributions_ = this.adaptAttributions_(options.attributions);\n\n  /**\n   * @private\n   * @type {module:ol/source/State}\n   */\n  this.state_ = options.state !== undefined ?\n    options.state : SourceState.READY;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.wrapX_ = options.wrapX !== undefined ? options.wrapX : false;\n\n};\n\ninherits(Source, BaseObject);\n\n/**\n * Turns the attributions option into an attributions function.\n * @param {module:ol/source/Source~AttributionLike|undefined} attributionLike The attribution option.\n * @return {?module:ol/source/Source~Attribution} An attribution function (or null).\n */\nSource.prototype.adaptAttributions_ = function(attributionLike) {\n  if (!attributionLike) {\n    return null;\n  }\n  if (Array.isArray(attributionLike)) {\n    return function(frameState) {\n      return attributionLike;\n    };\n  }\n\n  if (typeof attributionLike === 'function') {\n    return attributionLike;\n  }\n\n  return function(frameState) {\n    return [attributionLike];\n  };\n};\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {Object.<string, boolean>} skippedFeatureUids Skipped feature uids.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T} callback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\nSource.prototype.forEachFeatureAtCoordinate = UNDEFINED;\n\n\n/**\n * Get the attribution function for the source.\n * @return {?module:ol/source/Source~Attribution} Attribution function.\n */\nSource.prototype.getAttributions = function() {\n  return this.attributions_;\n};\n\n\n/**\n * Get the projection of the source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nSource.prototype.getProjection = function() {\n  return this.projection_;\n};\n\n\n/**\n * @abstract\n * @return {Array.<number>|undefined} Resolutions.\n */\nSource.prototype.getResolutions = function() {};\n\n\n/**\n * Get the state of the source, see {@link module:ol/source/State~State} for possible states.\n * @return {module:ol/source/State} State.\n * @api\n */\nSource.prototype.getState = function() {\n  return this.state_;\n};\n\n\n/**\n * @return {boolean|undefined} Wrap X.\n */\nSource.prototype.getWrapX = function() {\n  return this.wrapX_;\n};\n\n\n/**\n * Refreshes the source and finally dispatches a 'change' event.\n * @api\n */\nSource.prototype.refresh = function() {\n  this.changed();\n};\n\n\n/**\n * Set the attributions of the source.\n * @param {module:ol/source/Source~AttributionLike|undefined} attributions Attributions.\n *     Can be passed as `string`, `Array<string>`, `{@link module:ol/source/Source~Attribution}`,\n *     or `undefined`.\n * @api\n */\nSource.prototype.setAttributions = function(attributions) {\n  this.attributions_ = this.adaptAttributions_(attributions);\n  this.changed();\n};\n\n\n/**\n * Set the state of the source.\n * @param {module:ol/source/State} state State.\n * @protected\n */\nSource.prototype.setState = function(state) {\n  this.state_ = state;\n  this.changed();\n};\nexport default Source;\n","/**\n * @module ol/source/VectorEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a feature is added to the source.\n   * @event ol/source/Vector~VectorSourceEvent#addfeature\n   * @api\n   */\n  ADDFEATURE: 'addfeature',\n\n  /**\n   * Triggered when a feature is updated.\n   * @event ol/source/Vector~VectorSourceEvent#changefeature\n   * @api\n   */\n  CHANGEFEATURE: 'changefeature',\n\n  /**\n   * Triggered when the clear method is called on the source.\n   * @event ol/source/Vector~VectorSourceEvent#clear\n   * @api\n   */\n  CLEAR: 'clear',\n\n  /**\n   * Triggered when a feature is removed from the source.\n   * See {@link module:ol/source/Vector#clear source.clear()} for exceptions.\n   * @event ol/source/Vector~VectorSourceEvent#removefeature\n   * @api\n   */\n  REMOVEFEATURE: 'removefeature'\n};\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.quickselect = factory());\n}(this, (function () { 'use strict';\n\nfunction quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n}\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nreturn quickselect;\n\n})));\n","'use strict';\n\nmodule.exports = rbush;\nmodule.exports.default = rbush;\n\nvar quickselect = require('quickselect');\n\nfunction rbush(maxEntries, format) {\n    if (!(this instanceof rbush)) return new rbush(maxEntries, format);\n\n    // max entries in a node is 9 by default; min node fill is 40% for best performance\n    this._maxEntries = Math.max(4, maxEntries || 9);\n    this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n\n    if (format) {\n        this._initFormat(format);\n    }\n\n    this.clear();\n}\n\nrbush.prototype = {\n\n    all: function () {\n        return this._all(this.data, []);\n    },\n\n    search: function (bbox) {\n\n        var node = this.data,\n            result = [],\n            toBBox = this.toBBox;\n\n        if (!intersects(bbox, node)) return result;\n\n        var nodesToSearch = [],\n            i, len, child, childBBox;\n\n        while (node) {\n            for (i = 0, len = node.children.length; i < len; i++) {\n\n                child = node.children[i];\n                childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf) result.push(child);\n                    else if (contains(bbox, childBBox)) this._all(child, result);\n                    else nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return result;\n    },\n\n    collides: function (bbox) {\n\n        var node = this.data,\n            toBBox = this.toBBox;\n\n        if (!intersects(bbox, node)) return false;\n\n        var nodesToSearch = [],\n            i, len, child, childBBox;\n\n        while (node) {\n            for (i = 0, len = node.children.length; i < len; i++) {\n\n                child = node.children[i];\n                childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf || contains(bbox, childBBox)) return true;\n                    nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return false;\n    },\n\n    load: function (data) {\n        if (!(data && data.length)) return this;\n\n        if (data.length < this._minEntries) {\n            for (var i = 0, len = data.length; i < len; i++) {\n                this.insert(data[i]);\n            }\n            return this;\n        }\n\n        // recursively build the tree with the given data from scratch using OMT algorithm\n        var node = this._build(data.slice(), 0, data.length - 1, 0);\n\n        if (!this.data.children.length) {\n            // save as is if tree is empty\n            this.data = node;\n\n        } else if (this.data.height === node.height) {\n            // split root if trees have the same height\n            this._splitRoot(this.data, node);\n\n        } else {\n            if (this.data.height < node.height) {\n                // swap trees if inserted one is bigger\n                var tmpNode = this.data;\n                this.data = node;\n                node = tmpNode;\n            }\n\n            // insert the small tree into the large tree at appropriate level\n            this._insert(node, this.data.height - node.height - 1, true);\n        }\n\n        return this;\n    },\n\n    insert: function (item) {\n        if (item) this._insert(item, this.data.height - 1);\n        return this;\n    },\n\n    clear: function () {\n        this.data = createNode([]);\n        return this;\n    },\n\n    remove: function (item, equalsFn) {\n        if (!item) return this;\n\n        var node = this.data,\n            bbox = this.toBBox(item),\n            path = [],\n            indexes = [],\n            i, parent, index, goingUp;\n\n        // depth-first iterative tree traversal\n        while (node || path.length) {\n\n            if (!node) { // go up\n                node = path.pop();\n                parent = path[path.length - 1];\n                i = indexes.pop();\n                goingUp = true;\n            }\n\n            if (node.leaf) { // check current node\n                index = findItem(item, node.children, equalsFn);\n\n                if (index !== -1) {\n                    // item found, remove the item and condense tree upwards\n                    node.children.splice(index, 1);\n                    path.push(node);\n                    this._condense(path);\n                    return this;\n                }\n            }\n\n            if (!goingUp && !node.leaf && contains(node, bbox)) { // go down\n                path.push(node);\n                indexes.push(i);\n                i = 0;\n                parent = node;\n                node = node.children[0];\n\n            } else if (parent) { // go right\n                i++;\n                node = parent.children[i];\n                goingUp = false;\n\n            } else node = null; // nothing found\n        }\n\n        return this;\n    },\n\n    toBBox: function (item) { return item; },\n\n    compareMinX: compareNodeMinX,\n    compareMinY: compareNodeMinY,\n\n    toJSON: function () { return this.data; },\n\n    fromJSON: function (data) {\n        this.data = data;\n        return this;\n    },\n\n    _all: function (node, result) {\n        var nodesToSearch = [];\n        while (node) {\n            if (node.leaf) result.push.apply(result, node.children);\n            else nodesToSearch.push.apply(nodesToSearch, node.children);\n\n            node = nodesToSearch.pop();\n        }\n        return result;\n    },\n\n    _build: function (items, left, right, height) {\n\n        var N = right - left + 1,\n            M = this._maxEntries,\n            node;\n\n        if (N <= M) {\n            // reached leaf level; return leaf\n            node = createNode(items.slice(left, right + 1));\n            calcBBox(node, this.toBBox);\n            return node;\n        }\n\n        if (!height) {\n            // target height of the bulk-loaded tree\n            height = Math.ceil(Math.log(N) / Math.log(M));\n\n            // target number of root entries to maximize storage utilization\n            M = Math.ceil(N / Math.pow(M, height - 1));\n        }\n\n        node = createNode([]);\n        node.leaf = false;\n        node.height = height;\n\n        // split the items into M mostly square tiles\n\n        var N2 = Math.ceil(N / M),\n            N1 = N2 * Math.ceil(Math.sqrt(M)),\n            i, j, right2, right3;\n\n        multiSelect(items, left, right, N1, this.compareMinX);\n\n        for (i = left; i <= right; i += N1) {\n\n            right2 = Math.min(i + N1 - 1, right);\n\n            multiSelect(items, i, right2, N2, this.compareMinY);\n\n            for (j = i; j <= right2; j += N2) {\n\n                right3 = Math.min(j + N2 - 1, right2);\n\n                // pack each entry recursively\n                node.children.push(this._build(items, j, right3, height - 1));\n            }\n        }\n\n        calcBBox(node, this.toBBox);\n\n        return node;\n    },\n\n    _chooseSubtree: function (bbox, node, level, path) {\n\n        var i, len, child, targetNode, area, enlargement, minArea, minEnlargement;\n\n        while (true) {\n            path.push(node);\n\n            if (node.leaf || path.length - 1 === level) break;\n\n            minArea = minEnlargement = Infinity;\n\n            for (i = 0, len = node.children.length; i < len; i++) {\n                child = node.children[i];\n                area = bboxArea(child);\n                enlargement = enlargedArea(bbox, child) - area;\n\n                // choose entry with the least area enlargement\n                if (enlargement < minEnlargement) {\n                    minEnlargement = enlargement;\n                    minArea = area < minArea ? area : minArea;\n                    targetNode = child;\n\n                } else if (enlargement === minEnlargement) {\n                    // otherwise choose one with the smallest area\n                    if (area < minArea) {\n                        minArea = area;\n                        targetNode = child;\n                    }\n                }\n            }\n\n            node = targetNode || node.children[0];\n        }\n\n        return node;\n    },\n\n    _insert: function (item, level, isNode) {\n\n        var toBBox = this.toBBox,\n            bbox = isNode ? item : toBBox(item),\n            insertPath = [];\n\n        // find the best node for accommodating the item, saving all nodes along the path too\n        var node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n        // put the item into the node\n        node.children.push(item);\n        extend(node, bbox);\n\n        // split on node overflow; propagate upwards if necessary\n        while (level >= 0) {\n            if (insertPath[level].children.length > this._maxEntries) {\n                this._split(insertPath, level);\n                level--;\n            } else break;\n        }\n\n        // adjust bboxes along the insertion path\n        this._adjustParentBBoxes(bbox, insertPath, level);\n    },\n\n    // split overflowed node into two\n    _split: function (insertPath, level) {\n\n        var node = insertPath[level],\n            M = node.children.length,\n            m = this._minEntries;\n\n        this._chooseSplitAxis(node, m, M);\n\n        var splitIndex = this._chooseSplitIndex(node, m, M);\n\n        var newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n        newNode.height = node.height;\n        newNode.leaf = node.leaf;\n\n        calcBBox(node, this.toBBox);\n        calcBBox(newNode, this.toBBox);\n\n        if (level) insertPath[level - 1].children.push(newNode);\n        else this._splitRoot(node, newNode);\n    },\n\n    _splitRoot: function (node, newNode) {\n        // split root node\n        this.data = createNode([node, newNode]);\n        this.data.height = node.height + 1;\n        this.data.leaf = false;\n        calcBBox(this.data, this.toBBox);\n    },\n\n    _chooseSplitIndex: function (node, m, M) {\n\n        var i, bbox1, bbox2, overlap, area, minOverlap, minArea, index;\n\n        minOverlap = minArea = Infinity;\n\n        for (i = m; i <= M - m; i++) {\n            bbox1 = distBBox(node, 0, i, this.toBBox);\n            bbox2 = distBBox(node, i, M, this.toBBox);\n\n            overlap = intersectionArea(bbox1, bbox2);\n            area = bboxArea(bbox1) + bboxArea(bbox2);\n\n            // choose distribution with minimum overlap\n            if (overlap < minOverlap) {\n                minOverlap = overlap;\n                index = i;\n\n                minArea = area < minArea ? area : minArea;\n\n            } else if (overlap === minOverlap) {\n                // otherwise choose distribution with minimum area\n                if (area < minArea) {\n                    minArea = area;\n                    index = i;\n                }\n            }\n        }\n\n        return index;\n    },\n\n    // sorts node children by the best axis for split\n    _chooseSplitAxis: function (node, m, M) {\n\n        var compareMinX = node.leaf ? this.compareMinX : compareNodeMinX,\n            compareMinY = node.leaf ? this.compareMinY : compareNodeMinY,\n            xMargin = this._allDistMargin(node, m, M, compareMinX),\n            yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n        // if total distributions margin value is minimal for x, sort by minX,\n        // otherwise it's already sorted by minY\n        if (xMargin < yMargin) node.children.sort(compareMinX);\n    },\n\n    // total margin of all possible split distributions where each node is at least m full\n    _allDistMargin: function (node, m, M, compare) {\n\n        node.children.sort(compare);\n\n        var toBBox = this.toBBox,\n            leftBBox = distBBox(node, 0, m, toBBox),\n            rightBBox = distBBox(node, M - m, M, toBBox),\n            margin = bboxMargin(leftBBox) + bboxMargin(rightBBox),\n            i, child;\n\n        for (i = m; i < M - m; i++) {\n            child = node.children[i];\n            extend(leftBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(leftBBox);\n        }\n\n        for (i = M - m - 1; i >= m; i--) {\n            child = node.children[i];\n            extend(rightBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(rightBBox);\n        }\n\n        return margin;\n    },\n\n    _adjustParentBBoxes: function (bbox, path, level) {\n        // adjust bboxes along the given tree path\n        for (var i = level; i >= 0; i--) {\n            extend(path[i], bbox);\n        }\n    },\n\n    _condense: function (path) {\n        // go through the path, removing empty nodes and updating bboxes\n        for (var i = path.length - 1, siblings; i >= 0; i--) {\n            if (path[i].children.length === 0) {\n                if (i > 0) {\n                    siblings = path[i - 1].children;\n                    siblings.splice(siblings.indexOf(path[i]), 1);\n\n                } else this.clear();\n\n            } else calcBBox(path[i], this.toBBox);\n        }\n    },\n\n    _initFormat: function (format) {\n        // data format (minX, minY, maxX, maxY accessors)\n\n        // uses eval-type function compilation instead of just accepting a toBBox function\n        // because the algorithms are very sensitive to sorting functions performance,\n        // so they should be dead simple and without inner calls\n\n        var compareArr = ['return a', ' - b', ';'];\n\n        this.compareMinX = new Function('a', 'b', compareArr.join(format[0]));\n        this.compareMinY = new Function('a', 'b', compareArr.join(format[1]));\n\n        this.toBBox = new Function('a',\n            'return {minX: a' + format[0] +\n            ', minY: a' + format[1] +\n            ', maxX: a' + format[2] +\n            ', maxY: a' + format[3] + '};');\n    }\n};\n\nfunction findItem(item, items, equalsFn) {\n    if (!equalsFn) return items.indexOf(item);\n\n    for (var i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) return i;\n    }\n    return -1;\n}\n\n// calculate node's bbox from bboxes of its children\nfunction calcBBox(node, toBBox) {\n    distBBox(node, 0, node.children.length, toBBox, node);\n}\n\n// min bounding rectangle of node children from k to p-1\nfunction distBBox(node, k, p, toBBox, destNode) {\n    if (!destNode) destNode = createNode(null);\n    destNode.minX = Infinity;\n    destNode.minY = Infinity;\n    destNode.maxX = -Infinity;\n    destNode.maxY = -Infinity;\n\n    for (var i = k, child; i < p; i++) {\n        child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n    }\n\n    return destNode;\n}\n\nfunction extend(a, b) {\n    a.minX = Math.min(a.minX, b.minX);\n    a.minY = Math.min(a.minY, b.minY);\n    a.maxX = Math.max(a.maxX, b.maxX);\n    a.maxY = Math.max(a.maxY, b.maxY);\n    return a;\n}\n\nfunction compareNodeMinX(a, b) { return a.minX - b.minX; }\nfunction compareNodeMinY(a, b) { return a.minY - b.minY; }\n\nfunction bboxArea(a)   { return (a.maxX - a.minX) * (a.maxY - a.minY); }\nfunction bboxMargin(a) { return (a.maxX - a.minX) + (a.maxY - a.minY); }\n\nfunction enlargedArea(a, b) {\n    return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) *\n           (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n}\n\nfunction intersectionArea(a, b) {\n    var minX = Math.max(a.minX, b.minX),\n        minY = Math.max(a.minY, b.minY),\n        maxX = Math.min(a.maxX, b.maxX),\n        maxY = Math.min(a.maxY, b.maxY);\n\n    return Math.max(0, maxX - minX) *\n           Math.max(0, maxY - minY);\n}\n\nfunction contains(a, b) {\n    return a.minX <= b.minX &&\n           a.minY <= b.minY &&\n           b.maxX <= a.maxX &&\n           b.maxY <= a.maxY;\n}\n\nfunction intersects(a, b) {\n    return b.minX <= a.maxX &&\n           b.minY <= a.maxY &&\n           b.maxX >= a.minX &&\n           b.maxY >= a.minY;\n}\n\nfunction createNode(children) {\n    return {\n        children: children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n}\n\n// sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n// combines selection algorithm with binary divide & conquer approach\n\nfunction multiSelect(arr, left, right, n, compare) {\n    var stack = [left, right],\n        mid;\n\n    while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n\n        if (right - left <= n) continue;\n\n        mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n\n        stack.push(left, mid, mid, right);\n    }\n}\n","/**\n * @module ol/structs/RBush\n */\nimport {getUid} from '../util.js';\nimport rbush from 'rbush';\nimport {createOrUpdate, equals} from '../extent.js';\nimport {isEmpty} from '../obj.js';\n\n/**\n * @typedef {Object} Entry\n * @property {number} minX\n * @property {number} minY\n * @property {number} maxX\n * @property {number} maxY\n * @property {Object} [value]\n */\n\n/**\n * Wrapper around the RBush by Vladimir Agafonkin.\n *\n * @constructor\n * @param {number=} opt_maxEntries Max entries.\n * @see https://github.com/mourner/rbush\n * @struct\n * @template T\n */\nconst RBush = function(opt_maxEntries) {\n\n  /**\n   * @private\n   */\n  this.rbush_ = rbush(opt_maxEntries, undefined);\n\n  /**\n   * A mapping between the objects added to this rbush wrapper\n   * and the objects that are actually added to the internal rbush.\n   * @private\n   * @type {Object.<number, module:ol/structs/RBush~Entry>}\n   */\n  this.items_ = {};\n\n};\n\n\n/**\n * Insert a value into the RBush.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {T} value Value.\n */\nRBush.prototype.insert = function(extent, value) {\n  /** @type {module:ol/structs/RBush~Entry} */\n  const item = {\n    minX: extent[0],\n    minY: extent[1],\n    maxX: extent[2],\n    maxY: extent[3],\n    value: value\n  };\n\n  this.rbush_.insert(item);\n  this.items_[getUid(value)] = item;\n};\n\n\n/**\n * Bulk-insert values into the RBush.\n * @param {Array.<module:ol/extent~Extent>} extents Extents.\n * @param {Array.<T>} values Values.\n */\nRBush.prototype.load = function(extents, values) {\n  const items = new Array(values.length);\n  for (let i = 0, l = values.length; i < l; i++) {\n    const extent = extents[i];\n    const value = values[i];\n\n    /** @type {module:ol/structs/RBush~Entry} */\n    const item = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n      value: value\n    };\n    items[i] = item;\n    this.items_[getUid(value)] = item;\n  }\n  this.rbush_.load(items);\n};\n\n\n/**\n * Remove a value from the RBush.\n * @param {T} value Value.\n * @return {boolean} Removed.\n */\nRBush.prototype.remove = function(value) {\n  const uid = getUid(value);\n\n  // get the object in which the value was wrapped when adding to the\n  // internal rbush. then use that object to do the removal.\n  const item = this.items_[uid];\n  delete this.items_[uid];\n  return this.rbush_.remove(item) !== null;\n};\n\n\n/**\n * Update the extent of a value in the RBush.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {T} value Value.\n */\nRBush.prototype.update = function(extent, value) {\n  const item = this.items_[getUid(value)];\n  const bbox = [item.minX, item.minY, item.maxX, item.maxY];\n  if (!equals(bbox, extent)) {\n    this.remove(value);\n    this.insert(extent, value);\n  }\n};\n\n\n/**\n * Return all values in the RBush.\n * @return {Array.<T>} All.\n */\nRBush.prototype.getAll = function() {\n  const items = this.rbush_.all();\n  return items.map(function(item) {\n    return item.value;\n  });\n};\n\n\n/**\n * Return all values in the given extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {Array.<T>} All in extent.\n */\nRBush.prototype.getInExtent = function(extent) {\n  /** @type {module:ol/structs/RBush~Entry} */\n  const bbox = {\n    minX: extent[0],\n    minY: extent[1],\n    maxX: extent[2],\n    maxY: extent[3]\n  };\n  const items = this.rbush_.search(bbox);\n  return items.map(function(item) {\n    return item.value;\n  });\n};\n\n\n/**\n * Calls a callback function with each value in the tree.\n * If the callback returns a truthy value, this value is returned without\n * checking the rest of the tree.\n * @param {function(this: S, T): *} callback Callback.\n * @param {S=} opt_this The object to use as `this` in `callback`.\n * @return {*} Callback return value.\n * @template S\n */\nRBush.prototype.forEach = function(callback, opt_this) {\n  return this.forEach_(this.getAll(), callback, opt_this);\n};\n\n\n/**\n * Calls a callback function with each value in the provided extent.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {function(this: S, T): *} callback Callback.\n * @param {S=} opt_this The object to use as `this` in `callback`.\n * @return {*} Callback return value.\n * @template S\n */\nRBush.prototype.forEachInExtent = function(extent, callback, opt_this) {\n  return this.forEach_(this.getInExtent(extent), callback, opt_this);\n};\n\n\n/**\n * @param {Array.<T>} values Values.\n * @param {function(this: S, T): *} callback Callback.\n * @param {S=} opt_this The object to use as `this` in `callback`.\n * @private\n * @return {*} Callback return value.\n * @template S\n */\nRBush.prototype.forEach_ = function(values, callback, opt_this) {\n  let result;\n  for (let i = 0, l = values.length; i < l; i++) {\n    result = callback.call(opt_this, values[i]);\n    if (result) {\n      return result;\n    }\n  }\n  return result;\n};\n\n\n/**\n * @return {boolean} Is empty.\n */\nRBush.prototype.isEmpty = function() {\n  return isEmpty(this.items_);\n};\n\n\n/**\n * Remove all values from the RBush.\n */\nRBush.prototype.clear = function() {\n  this.rbush_.clear();\n  this.items_ = {};\n};\n\n\n/**\n * @param {module:ol/extent~Extent=} opt_extent Extent.\n * @return {module:ol/extent~Extent} Extent.\n */\nRBush.prototype.getExtent = function(opt_extent) {\n  // FIXME add getExtent() to rbush\n  const data = this.rbush_.data;\n  return createOrUpdate(data.minX, data.minY, data.maxX, data.maxY, opt_extent);\n};\n\n\n/**\n * @param {module:ol/structs/RBush} rbush R-Tree.\n */\nRBush.prototype.concat = function(rbush) {\n  this.rbush_.load(rbush.rbush_.all());\n  for (const i in rbush.items_) {\n    this.items_[i | 0] = rbush.items_[i | 0];\n  }\n};\nexport default RBush;\n","/**\n * @module ol/source/Vector\n */\n\nimport {getUid, inherits} from '../util.js';\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport {extend} from '../array.js';\nimport {assert} from '../asserts.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {containsExtent, equals} from '../extent.js';\nimport {xhr} from '../featureloader.js';\nimport {TRUE, UNDEFINED} from '../functions.js';\nimport {all as allStrategy} from '../loadingstrategy.js';\nimport {isEmpty, getValues} from '../obj.js';\nimport Source from '../source/Source.js';\nimport SourceState from '../source/State.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport RBush from '../structs/RBush.js';\n\n/**\n * A function that takes an {@link module:ol/extent~Extent} and a resolution as arguments, and\n * returns an array of {@link module:ol/extent~Extent} with the extents to load. Usually this\n * is one of the standard {@link module:ol/loadingstrategy} strategies.\n *\n * @typedef {function(module:ol/extent~Extent, number): Array.<module:ol/extent~Extent>} LoadingStrategy\n * @api\n */\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Vector} instances are instances of this\n * type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type Type.\n * @param {module:ol/Feature=} opt_feature Feature.\n */\nexport const VectorSourceEvent = function(type, opt_feature) {\n\n  Event.call(this, type);\n\n  /**\n   * The feature being added or removed.\n   * @type {module:ol/Feature|undefined}\n   * @api\n   */\n  this.feature = opt_feature;\n\n};\ninherits(VectorSourceEvent, Event);\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {Array.<module:ol/Feature>|module:ol/Collection.<module:ol/Feature>} [features]\n * Features. If provided as {@link module:ol/Collection}, the features in the source\n * and the collection will stay in sync.\n * @property {module:ol/format/Feature} [format] The feature format used by the XHR\n * feature loader when `url` is set. Required if `url` is set, otherwise ignored.\n * @property {module:ol/featureloader~FeatureLoader} [loader]\n * The loader function used to load features, from a remote source for example.\n * If this is not set and `url` is set, the source will create and use an XHR\n * feature loader.\n *\n * Example:\n *\n * ```js\n * import {Vector} from 'ol/source';\n * import {GeoJSON} from 'ol/format';\n * import {bbox} from 'ol/loadingstrategy';\n *\n * var vectorSource = new Vector({\n *   format: new GeoJSON(),\n *   loader: function(extent, resolution, projection) {\n *      var proj = projection.getCode();\n *      var url = 'https://ahocevar.com/geoserver/wfs?service=WFS&' +\n *          'version=1.1.0&request=GetFeature&typename=osm:water_areas&' +\n *          'outputFormat=application/json&srsname=' + proj + '&' +\n *          'bbox=' + extent.join(',') + ',' + proj;\n *      var xhr = new XMLHttpRequest();\n *      xhr.open('GET', url);\n *      var onError = function() {\n *        vectorSource.removeLoadedExtent(extent);\n *      }\n *      xhr.onerror = onError;\n *      xhr.onload = function() {\n *        if (xhr.status == 200) {\n *          vectorSource.addFeatures(\n *              vectorSource.getFormat().readFeatures(xhr.responseText));\n *        } else {\n *          onError();\n *        }\n *      }\n *      xhr.send();\n *    },\n *    strategy: bbox\n *  });\n * ```\n * @property {boolean} [overlaps=true] This source may have overlapping geometries.\n * Setting this to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {module:ol/source/Vector~LoadingStrategy} [strategy] The loading strategy to use.\n * By default an {@link module:ol/loadingstrategy~all}\n * strategy is used, a one-off strategy which loads all features at once.\n * @property {string|module:ol/featureloader~FeatureUrlfunction} [url]\n * Setting this option instructs the source to load features using an XHR loader\n * (see {@link module:ol/featureloader~xhr}). Use a `string` and an\n * {@link module:ol/loadingstrategy~all} for a one-off download of all features from\n * the given URL. Use a {@link module:ol/featureloader~FeatureUrlfunction} to generate the url with\n * other loading strategies.\n * Requires `format` to be set as well.\n * When default XHR feature loader is provided, the features will\n * be transformed from the data projection to the view projection\n * during parsing. If your remote data source does not advertise its projection\n * properly, this transformation will be incorrect. For some formats, the\n * default projection (usually EPSG:4326) can be overridden by setting the\n * dataProjection constructor option on the format.\n * Note that if a source contains non-feature data, such as a GeoJSON geometry\n * or a KML NetworkLink, these will be ignored. Use a custom loader to load these.\n * @property {boolean} [useSpatialIndex=true]\n * By default, an RTree is used as spatial index. When features are removed and\n * added frequently, and the total number of features is low, setting this to\n * `false` may improve performance.\n *\n * Note that\n * {@link module:ol/source/Vector~VectorSource#getFeaturesInExtent},\n * {@link module:ol/source/Vector~VectorSource#getClosestFeatureToCoordinate} and\n * {@link module:ol/source/Vector~VectorSource#getExtent} cannot be used when `useSpatialIndex` is\n * set to `false`, and {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent} will loop\n * through all features.\n *\n * When set to `false`, the features will be maintained in an\n * {@link module:ol/Collection}, which can be retrieved through\n * {@link module:ol/source/Vector~VectorSource#getFeaturesCollection}.\n * @property {boolean} [wrapX=true] Wrap the world horizontally. For vector editing across the\n * -180 and 180 meridians to work properly, this should be set to `false`. The\n * resulting geometry coordinates will then exceed the world bounds.\n */\n\n\n/**\n * @classdesc\n * Provides a source of features for vector layers. Vector features provided\n * by this source are suitable for editing. See {@link module:ol/source/VectorTile~VectorTile} for\n * vector data that is optimized for rendering.\n *\n * @constructor\n * @extends {module:ol/source/Source}\n * @fires ol/source/Vector~VectorSourceEvent\n * @param {module:ol/source/Vector~Options=} opt_options Vector source options.\n * @api\n */\nconst VectorSource = function(opt_options) {\n\n  const options = opt_options || {};\n\n  Source.call(this, {\n    attributions: options.attributions,\n    projection: undefined,\n    state: SourceState.READY,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true\n  });\n\n  /**\n   * @private\n   * @type {module:ol/featureloader~FeatureLoader}\n   */\n  this.loader_ = UNDEFINED;\n\n  /**\n   * @private\n   * @type {module:ol/format/Feature|undefined}\n   */\n  this.format_ = options.format;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.overlaps_ = options.overlaps == undefined ? true : options.overlaps;\n\n  /**\n   * @private\n   * @type {string|module:ol/featureloader~FeatureUrlFunction|undefined}\n   */\n  this.url_ = options.url;\n\n  if (options.loader !== undefined) {\n    this.loader_ = options.loader;\n  } else if (this.url_ !== undefined) {\n    assert(this.format_, 7); // `format` must be set when `url` is set\n    // create a XHR feature loader for \"url\" and \"format\"\n    this.loader_ = xhr(this.url_, /** @type {module:ol/format/Feature} */ (this.format_));\n  }\n\n  /**\n   * @private\n   * @type {module:ol/source/Vector~LoadingStrategy}\n   */\n  this.strategy_ = options.strategy !== undefined ? options.strategy : allStrategy;\n\n  const useSpatialIndex =\n      options.useSpatialIndex !== undefined ? options.useSpatialIndex : true;\n\n  /**\n   * @private\n   * @type {module:ol/structs/RBush.<module:ol/Feature>}\n   */\n  this.featuresRtree_ = useSpatialIndex ? new RBush() : null;\n\n  /**\n   * @private\n   * @type {module:ol/structs/RBush.<{extent: module:ol/extent~Extent}>}\n   */\n  this.loadedExtentsRtree_ = new RBush();\n\n  /**\n   * @private\n   * @type {!Object.<string, module:ol/Feature>}\n   */\n  this.nullGeometryFeatures_ = {};\n\n  /**\n   * A lookup of features by id (the return from feature.getId()).\n   * @private\n   * @type {!Object.<string, module:ol/Feature>}\n   */\n  this.idIndex_ = {};\n\n  /**\n   * A lookup of features without id (keyed by getUid(feature)).\n   * @private\n   * @type {!Object.<string, module:ol/Feature>}\n   */\n  this.undefIdIndex_ = {};\n\n  /**\n   * @private\n   * @type {Object.<string, Array.<module:ol/events~EventsKey>>}\n   */\n  this.featureChangeKeys_ = {};\n\n  /**\n   * @private\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   */\n  this.featuresCollection_ = null;\n\n  let collection, features;\n  if (options.features instanceof Collection) {\n    collection = options.features;\n    features = collection.getArray();\n  } else if (Array.isArray(options.features)) {\n    features = options.features;\n  }\n  if (!useSpatialIndex && collection === undefined) {\n    collection = new Collection(features);\n  }\n  if (features !== undefined) {\n    this.addFeaturesInternal(features);\n  }\n  if (collection !== undefined) {\n    this.bindFeaturesCollection_(collection);\n  }\n\n};\n\ninherits(VectorSource, Source);\n\n\n/**\n * Add a single feature to the source.  If you want to add a batch of features\n * at once, call {@link module:ol/source/Vector~VectorSource#addFeatures #addFeatures()}\n * instead. A feature will not be added to the source if feature with\n * the same id is already there. The reason for this behavior is to avoid\n * feature duplication when using bbox or tile loading strategies.\n * @param {module:ol/Feature} feature Feature to add.\n * @api\n */\nVectorSource.prototype.addFeature = function(feature) {\n  this.addFeatureInternal(feature);\n  this.changed();\n};\n\n\n/**\n * Add a feature without firing a `change` event.\n * @param {module:ol/Feature} feature Feature.\n * @protected\n */\nVectorSource.prototype.addFeatureInternal = function(feature) {\n  const featureKey = getUid(feature).toString();\n\n  if (!this.addToIndex_(featureKey, feature)) {\n    return;\n  }\n\n  this.setupChangeEvents_(featureKey, feature);\n\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    const extent = geometry.getExtent();\n    if (this.featuresRtree_) {\n      this.featuresRtree_.insert(extent, feature);\n    }\n  } else {\n    this.nullGeometryFeatures_[featureKey] = feature;\n  }\n\n  this.dispatchEvent(\n    new VectorSourceEvent(VectorEventType.ADDFEATURE, feature));\n};\n\n\n/**\n * @param {string} featureKey Unique identifier for the feature.\n * @param {module:ol/Feature} feature The feature.\n * @private\n */\nVectorSource.prototype.setupChangeEvents_ = function(featureKey, feature) {\n  this.featureChangeKeys_[featureKey] = [\n    listen(feature, EventType.CHANGE,\n      this.handleFeatureChange_, this),\n    listen(feature, ObjectEventType.PROPERTYCHANGE,\n      this.handleFeatureChange_, this)\n  ];\n};\n\n\n/**\n * @param {string} featureKey Unique identifier for the feature.\n * @param {module:ol/Feature} feature The feature.\n * @return {boolean} The feature is \"valid\", in the sense that it is also a\n *     candidate for insertion into the Rtree.\n * @private\n */\nVectorSource.prototype.addToIndex_ = function(featureKey, feature) {\n  let valid = true;\n  const id = feature.getId();\n  if (id !== undefined) {\n    if (!(id.toString() in this.idIndex_)) {\n      this.idIndex_[id.toString()] = feature;\n    } else {\n      valid = false;\n    }\n  } else {\n    assert(!(featureKey in this.undefIdIndex_),\n      30); // The passed `feature` was already added to the source\n    this.undefIdIndex_[featureKey] = feature;\n  }\n  return valid;\n};\n\n\n/**\n * Add a batch of features to the source.\n * @param {Array.<module:ol/Feature>} features Features to add.\n * @api\n */\nVectorSource.prototype.addFeatures = function(features) {\n  this.addFeaturesInternal(features);\n  this.changed();\n};\n\n\n/**\n * Add features without firing a `change` event.\n * @param {Array.<module:ol/Feature>} features Features.\n * @protected\n */\nVectorSource.prototype.addFeaturesInternal = function(features) {\n  const extents = [];\n  const newFeatures = [];\n  const geometryFeatures = [];\n\n  for (let i = 0, length = features.length; i < length; i++) {\n    const feature = features[i];\n    const featureKey = getUid(feature).toString();\n    if (this.addToIndex_(featureKey, feature)) {\n      newFeatures.push(feature);\n    }\n  }\n\n  for (let i = 0, length = newFeatures.length; i < length; i++) {\n    const feature = newFeatures[i];\n    const featureKey = getUid(feature).toString();\n    this.setupChangeEvents_(featureKey, feature);\n\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const extent = geometry.getExtent();\n      extents.push(extent);\n      geometryFeatures.push(feature);\n    } else {\n      this.nullGeometryFeatures_[featureKey] = feature;\n    }\n  }\n  if (this.featuresRtree_) {\n    this.featuresRtree_.load(extents, geometryFeatures);\n  }\n\n  for (let i = 0, length = newFeatures.length; i < length; i++) {\n    this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE, newFeatures[i]));\n  }\n};\n\n\n/**\n * @param {!module:ol/Collection.<module:ol/Feature>} collection Collection.\n * @private\n */\nVectorSource.prototype.bindFeaturesCollection_ = function(collection) {\n  let modifyingCollection = false;\n  listen(this, VectorEventType.ADDFEATURE,\n    function(evt) {\n      if (!modifyingCollection) {\n        modifyingCollection = true;\n        collection.push(evt.feature);\n        modifyingCollection = false;\n      }\n    });\n  listen(this, VectorEventType.REMOVEFEATURE,\n    function(evt) {\n      if (!modifyingCollection) {\n        modifyingCollection = true;\n        collection.remove(evt.feature);\n        modifyingCollection = false;\n      }\n    });\n  listen(collection, CollectionEventType.ADD,\n    function(evt) {\n      if (!modifyingCollection) {\n        modifyingCollection = true;\n        this.addFeature(/** @type {module:ol/Feature} */ (evt.element));\n        modifyingCollection = false;\n      }\n    }, this);\n  listen(collection, CollectionEventType.REMOVE,\n    function(evt) {\n      if (!modifyingCollection) {\n        modifyingCollection = true;\n        this.removeFeature(/** @type {module:ol/Feature} */ (evt.element));\n        modifyingCollection = false;\n      }\n    }, this);\n  this.featuresCollection_ = collection;\n};\n\n\n/**\n * Remove all features from the source.\n * @param {boolean=} opt_fast Skip dispatching of {@link module:ol/source/Vector~VectorSourceEvent#removefeature} events.\n * @api\n */\nVectorSource.prototype.clear = function(opt_fast) {\n  if (opt_fast) {\n    for (const featureId in this.featureChangeKeys_) {\n      const keys = this.featureChangeKeys_[featureId];\n      keys.forEach(unlistenByKey);\n    }\n    if (!this.featuresCollection_) {\n      this.featureChangeKeys_ = {};\n      this.idIndex_ = {};\n      this.undefIdIndex_ = {};\n    }\n  } else {\n    if (this.featuresRtree_) {\n      this.featuresRtree_.forEach(this.removeFeatureInternal, this);\n      for (const id in this.nullGeometryFeatures_) {\n        this.removeFeatureInternal(this.nullGeometryFeatures_[id]);\n      }\n    }\n  }\n  if (this.featuresCollection_) {\n    this.featuresCollection_.clear();\n  }\n\n  if (this.featuresRtree_) {\n    this.featuresRtree_.clear();\n  }\n  this.loadedExtentsRtree_.clear();\n  this.nullGeometryFeatures_ = {};\n\n  const clearEvent = new VectorSourceEvent(VectorEventType.CLEAR);\n  this.dispatchEvent(clearEvent);\n  this.changed();\n};\n\n\n/**\n * Iterate through all features on the source, calling the provided callback\n * with each one.  If the callback returns any \"truthy\" value, iteration will\n * stop and the function will return the same value.\n * Note: this function only iterate through the feature that have a defined geometry.\n *\n * @param {function(module:ol/Feature): T} callback Called with each feature\n *     on the source.  Return a truthy value to stop iteration.\n * @return {T|undefined} The return value from the last call to the callback.\n * @template T\n * @api\n */\nVectorSource.prototype.forEachFeature = function(callback) {\n  if (this.featuresRtree_) {\n    return this.featuresRtree_.forEach(callback);\n  } else if (this.featuresCollection_) {\n    return this.featuresCollection_.forEach(callback);\n  }\n};\n\n\n/**\n * Iterate through all features whose geometries contain the provided\n * coordinate, calling the callback with each feature.  If the callback returns\n * a \"truthy\" value, iteration will stop and the function will return the same\n * value.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {function(module:ol/Feature): T} callback Called with each feature\n *     whose goemetry contains the provided coordinate.\n * @return {T|undefined} The return value from the last call to the callback.\n * @template T\n */\nVectorSource.prototype.forEachFeatureAtCoordinateDirect = function(coordinate, callback) {\n  const extent = [coordinate[0], coordinate[1], coordinate[0], coordinate[1]];\n  return this.forEachFeatureInExtent(extent, function(feature) {\n    const geometry = feature.getGeometry();\n    if (geometry.intersectsCoordinate(coordinate)) {\n      return callback(feature);\n    } else {\n      return undefined;\n    }\n  });\n};\n\n\n/**\n * Iterate through all features whose bounding box intersects the provided\n * extent (note that the feature's geometry may not intersect the extent),\n * calling the callback with each feature.  If the callback returns a \"truthy\"\n * value, iteration will stop and the function will return the same value.\n *\n * If you are interested in features whose geometry intersects an extent, call\n * the {@link module:ol/source/Vector~VectorSource#forEachFeatureIntersectingExtent #forEachFeatureIntersectingExtent()} method instead.\n *\n * When `useSpatialIndex` is set to false, this method will loop through all\n * features, equivalent to {@link module:ol/source/Vector~VectorSource#forEachFeature #forEachFeature()}.\n *\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {function(module:ol/Feature): T} callback Called with each feature\n *     whose bounding box intersects the provided extent.\n * @return {T|undefined} The return value from the last call to the callback.\n * @template T\n * @api\n */\nVectorSource.prototype.forEachFeatureInExtent = function(extent, callback) {\n  if (this.featuresRtree_) {\n    return this.featuresRtree_.forEachInExtent(extent, callback);\n  } else if (this.featuresCollection_) {\n    return this.featuresCollection_.forEach(callback);\n  }\n};\n\n\n/**\n * Iterate through all features whose geometry intersects the provided extent,\n * calling the callback with each feature.  If the callback returns a \"truthy\"\n * value, iteration will stop and the function will return the same value.\n *\n * If you only want to test for bounding box intersection, call the\n * {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent #forEachFeatureInExtent()} method instead.\n *\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {function(module:ol/Feature): T} callback Called with each feature\n *     whose geometry intersects the provided extent.\n * @return {T|undefined} The return value from the last call to the callback.\n * @template T\n * @api\n */\nVectorSource.prototype.forEachFeatureIntersectingExtent = function(extent, callback) {\n  return this.forEachFeatureInExtent(extent,\n    /**\n     * @param {module:ol/Feature} feature Feature.\n     * @return {T|undefined} The return value from the last call to the callback.\n     * @template T\n     */\n    function(feature) {\n      const geometry = feature.getGeometry();\n      if (geometry.intersectsExtent(extent)) {\n        const result = callback(feature);\n        if (result) {\n          return result;\n        }\n      }\n    });\n};\n\n\n/**\n * Get the features collection associated with this source. Will be `null`\n * unless the source was configured with `useSpatialIndex` set to `false`, or\n * with an {@link module:ol/Collection} as `features`.\n * @return {module:ol/Collection.<module:ol/Feature>} The collection of features.\n * @api\n */\nVectorSource.prototype.getFeaturesCollection = function() {\n  return this.featuresCollection_;\n};\n\n\n/**\n * Get all features on the source in random order.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nVectorSource.prototype.getFeatures = function() {\n  let features;\n  if (this.featuresCollection_) {\n    features = this.featuresCollection_.getArray();\n  } else if (this.featuresRtree_) {\n    features = this.featuresRtree_.getAll();\n    if (!isEmpty(this.nullGeometryFeatures_)) {\n      extend(features, getValues(this.nullGeometryFeatures_));\n    }\n  }\n  return (\n    /** @type {Array.<module:ol/Feature>} */ (features)\n  );\n};\n\n\n/**\n * Get all features whose geometry intersects the provided coordinate.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nVectorSource.prototype.getFeaturesAtCoordinate = function(coordinate) {\n  const features = [];\n  this.forEachFeatureAtCoordinateDirect(coordinate, function(feature) {\n    features.push(feature);\n  });\n  return features;\n};\n\n\n/**\n * Get all features in the provided extent.  Note that this returns an array of\n * all features intersecting the given extent in random order (so it may include\n * features whose geometries do not intersect the extent).\n *\n * This method is not available when the source is configured with\n * `useSpatialIndex` set to `false`.\n * @param {module:ol/extent~Extent} extent Extent.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nVectorSource.prototype.getFeaturesInExtent = function(extent) {\n  return this.featuresRtree_.getInExtent(extent);\n};\n\n\n/**\n * Get the closest feature to the provided coordinate.\n *\n * This method is not available when the source is configured with\n * `useSpatialIndex` set to `false`.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {function(module:ol/Feature):boolean=} opt_filter Feature filter function.\n *     The filter function will receive one argument, the {@link module:ol/Feature feature}\n *     and it should return a boolean value. By default, no filtering is made.\n * @return {module:ol/Feature} Closest feature.\n * @api\n */\nVectorSource.prototype.getClosestFeatureToCoordinate = function(coordinate, opt_filter) {\n  // Find the closest feature using branch and bound.  We start searching an\n  // infinite extent, and find the distance from the first feature found.  This\n  // becomes the closest feature.  We then compute a smaller extent which any\n  // closer feature must intersect.  We continue searching with this smaller\n  // extent, trying to find a closer feature.  Every time we find a closer\n  // feature, we update the extent being searched so that any even closer\n  // feature must intersect it.  We continue until we run out of features.\n  const x = coordinate[0];\n  const y = coordinate[1];\n  let closestFeature = null;\n  const closestPoint = [NaN, NaN];\n  let minSquaredDistance = Infinity;\n  const extent = [-Infinity, -Infinity, Infinity, Infinity];\n  const filter = opt_filter ? opt_filter : TRUE;\n  this.featuresRtree_.forEachInExtent(extent,\n    /**\n     * @param {module:ol/Feature} feature Feature.\n     */\n    function(feature) {\n      if (filter(feature)) {\n        const geometry = feature.getGeometry();\n        const previousMinSquaredDistance = minSquaredDistance;\n        minSquaredDistance = geometry.closestPointXY(\n          x, y, closestPoint, minSquaredDistance);\n        if (minSquaredDistance < previousMinSquaredDistance) {\n          closestFeature = feature;\n          // This is sneaky.  Reduce the extent that it is currently being\n          // searched while the R-Tree traversal using this same extent object\n          // is still in progress.  This is safe because the new extent is\n          // strictly contained by the old extent.\n          const minDistance = Math.sqrt(minSquaredDistance);\n          extent[0] = x - minDistance;\n          extent[1] = y - minDistance;\n          extent[2] = x + minDistance;\n          extent[3] = y + minDistance;\n        }\n      }\n    });\n  return closestFeature;\n};\n\n\n/**\n * Get the extent of the features currently in the source.\n *\n * This method is not available when the source is configured with\n * `useSpatialIndex` set to `false`.\n * @param {module:ol/extent~Extent=} opt_extent Destination extent. If provided, no new extent\n *     will be created. Instead, that extent's coordinates will be overwritten.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nVectorSource.prototype.getExtent = function(opt_extent) {\n  return this.featuresRtree_.getExtent(opt_extent);\n};\n\n\n/**\n * Get a feature by its identifier (the value returned by feature.getId()).\n * Note that the index treats string and numeric identifiers as the same.  So\n * `source.getFeatureById(2)` will return a feature with id `'2'` or `2`.\n *\n * @param {string|number} id Feature identifier.\n * @return {module:ol/Feature} The feature (or `null` if not found).\n * @api\n */\nVectorSource.prototype.getFeatureById = function(id) {\n  const feature = this.idIndex_[id.toString()];\n  return feature !== undefined ? feature : null;\n};\n\n\n/**\n * Get the format associated with this source.\n *\n * @return {module:ol/format/Feature|undefined} The feature format.\n * @api\n */\nVectorSource.prototype.getFormat = function() {\n  return this.format_;\n};\n\n\n/**\n * @return {boolean} The source can have overlapping geometries.\n */\nVectorSource.prototype.getOverlaps = function() {\n  return this.overlaps_;\n};\n\n\n/**\n * @override\n */\nVectorSource.prototype.getResolutions = function() {};\n\n\n/**\n * Get the url associated with this source.\n *\n * @return {string|module:ol/featureloader~FeatureUrlFunction|undefined} The url.\n * @api\n */\nVectorSource.prototype.getUrl = function() {\n  return this.url_;\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n * @private\n */\nVectorSource.prototype.handleFeatureChange_ = function(event) {\n  const feature = /** @type {module:ol/Feature} */ (event.target);\n  const featureKey = getUid(feature).toString();\n  const geometry = feature.getGeometry();\n  if (!geometry) {\n    if (!(featureKey in this.nullGeometryFeatures_)) {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.remove(feature);\n      }\n      this.nullGeometryFeatures_[featureKey] = feature;\n    }\n  } else {\n    const extent = geometry.getExtent();\n    if (featureKey in this.nullGeometryFeatures_) {\n      delete this.nullGeometryFeatures_[featureKey];\n      if (this.featuresRtree_) {\n        this.featuresRtree_.insert(extent, feature);\n      }\n    } else {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.update(extent, feature);\n      }\n    }\n  }\n  const id = feature.getId();\n  if (id !== undefined) {\n    const sid = id.toString();\n    if (featureKey in this.undefIdIndex_) {\n      delete this.undefIdIndex_[featureKey];\n      this.idIndex_[sid] = feature;\n    } else {\n      if (this.idIndex_[sid] !== feature) {\n        this.removeFromIdIndex_(feature);\n        this.idIndex_[sid] = feature;\n      }\n    }\n  } else {\n    if (!(featureKey in this.undefIdIndex_)) {\n      this.removeFromIdIndex_(feature);\n      this.undefIdIndex_[featureKey] = feature;\n    }\n  }\n  this.changed();\n  this.dispatchEvent(new VectorSourceEvent(\n    VectorEventType.CHANGEFEATURE, feature));\n};\n\n/**\n * Returns true if the feature is contained within the source.\n * @param {module:ol/Feature} feature Feature.\n * @return {boolean} Has feature.\n * @api\n */\nVectorSource.prototype.hasFeature = function(feature) {\n  const id = feature.getId();\n  if (id !== undefined) {\n    return id in this.idIndex_;\n  } else {\n    const featureKey = getUid(feature).toString();\n    return featureKey in this.undefIdIndex_;\n  }\n};\n\n/**\n * @return {boolean} Is empty.\n */\nVectorSource.prototype.isEmpty = function() {\n  return this.featuresRtree_.isEmpty() && isEmpty(this.nullGeometryFeatures_);\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {module:ol/proj/Projection} projection Projection.\n */\nVectorSource.prototype.loadFeatures = function(extent, resolution, projection) {\n  const loadedExtentsRtree = this.loadedExtentsRtree_;\n  const extentsToLoad = this.strategy_(extent, resolution);\n  for (let i = 0, ii = extentsToLoad.length; i < ii; ++i) {\n    const extentToLoad = extentsToLoad[i];\n    const alreadyLoaded = loadedExtentsRtree.forEachInExtent(extentToLoad,\n      /**\n       * @param {{extent: module:ol/extent~Extent}} object Object.\n       * @return {boolean} Contains.\n       */\n      function(object) {\n        return containsExtent(object.extent, extentToLoad);\n      });\n    if (!alreadyLoaded) {\n      this.loader_.call(this, extentToLoad, resolution, projection);\n      loadedExtentsRtree.insert(extentToLoad, {extent: extentToLoad.slice()});\n    }\n  }\n};\n\n\n/**\n * Remove an extent from the list of loaded extents.\n * @param {module:ol/extent~Extent} extent Extent.\n * @api\n */\nVectorSource.prototype.removeLoadedExtent = function(extent) {\n  const loadedExtentsRtree = this.loadedExtentsRtree_;\n  let obj;\n  loadedExtentsRtree.forEachInExtent(extent, function(object) {\n    if (equals(object.extent, extent)) {\n      obj = object;\n      return true;\n    }\n  });\n  if (obj) {\n    loadedExtentsRtree.remove(obj);\n  }\n};\n\n\n/**\n * Remove a single feature from the source.  If you want to remove all features\n * at once, use the {@link module:ol/source/Vector~VectorSource#clear #clear()} method\n * instead.\n * @param {module:ol/Feature} feature Feature to remove.\n * @api\n */\nVectorSource.prototype.removeFeature = function(feature) {\n  const featureKey = getUid(feature).toString();\n  if (featureKey in this.nullGeometryFeatures_) {\n    delete this.nullGeometryFeatures_[featureKey];\n  } else {\n    if (this.featuresRtree_) {\n      this.featuresRtree_.remove(feature);\n    }\n  }\n  this.removeFeatureInternal(feature);\n  this.changed();\n};\n\n\n/**\n * Remove feature without firing a `change` event.\n * @param {module:ol/Feature} feature Feature.\n * @protected\n */\nVectorSource.prototype.removeFeatureInternal = function(feature) {\n  const featureKey = getUid(feature).toString();\n  this.featureChangeKeys_[featureKey].forEach(unlistenByKey);\n  delete this.featureChangeKeys_[featureKey];\n  const id = feature.getId();\n  if (id !== undefined) {\n    delete this.idIndex_[id.toString()];\n  } else {\n    delete this.undefIdIndex_[featureKey];\n  }\n  this.dispatchEvent(new VectorSourceEvent(\n    VectorEventType.REMOVEFEATURE, feature));\n};\n\n\n/**\n * Remove a feature from the id index.  Called internally when the feature id\n * may have changed.\n * @param {module:ol/Feature} feature The feature.\n * @return {boolean} Removed the feature from the index.\n * @private\n */\nVectorSource.prototype.removeFromIdIndex_ = function(feature) {\n  let removed = false;\n  for (const id in this.idIndex_) {\n    if (this.idIndex_[id] === feature) {\n      delete this.idIndex_[id];\n      removed = true;\n      break;\n    }\n  }\n  return removed;\n};\n\n\n/**\n * Set the new loader of the source. The next loadFeatures call will use the\n * new loader.\n * @param {module:ol/featureloader~FeatureLoader} loader The loader to set.\n * @api\n */\nVectorSource.prototype.setLoader = function(loader) {\n  this.loader_ = loader;\n};\n\nexport default VectorSource;\n","/**\n * @module ol/interaction/Draw\n */\nimport {inherits} from '../util.js';\nimport EventType from '../events/EventType.js';\nimport Feature from '../Feature.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport MapBrowserPointerEvent from '../MapBrowserPointerEvent.js';\nimport {getChangeEventType} from '../Object.js';\nimport {squaredDistance as squaredCoordinateDistance} from '../coordinate.js';\nimport {listen} from '../events.js';\nimport Event from '../events/Event.js';\nimport {noModifierKeys, always, shiftKeyOnly} from '../events/condition.js';\nimport {boundingExtent, getBottomLeft, getBottomRight, getTopLeft, getTopRight} from '../extent.js';\nimport {TRUE, FALSE} from '../functions.js';\nimport Circle from '../geom/Circle.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport {POINTER_TYPE} from '../pointer/MouseSource.js';\nimport Point from '../geom/Point.js';\nimport Polygon, {fromCircle, makeRegular} from '../geom/Polygon.js';\nimport PointerInteraction, {handleEvent as handlePointerEvent} from '../interaction/Pointer.js';\nimport InteractionProperty from '../interaction/Property.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorSource from '../source/Vector.js';\nimport {createEditingStyle} from '../style/Style.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/geom/GeometryType} type Geometry type of\n * the geometries being drawn with this instance.\n * @property {number} [clickTolerance=6] The maximum distance in pixels between\n * \"down\" and \"up\" for a \"up\" event to be considered a \"click\" event and\n * actually add a point/vertex to the geometry being drawn.  The default of `6`\n * was chosen for the draw interaction to behave correctly on mouse as well as\n * on touch devices.\n * @property {module:ol/Collection.<module:ol/Feature>} [features]\n * Destination collection for the drawn features.\n * @property {module:ol/source/Vector} [source] Destination source for\n * the drawn features.\n * @property {number} [dragVertexDelay=500] Delay in milliseconds after pointerdown\n * before the current vertex can be dragged to its exact position.\n * @property {number} [snapTolerance=12] Pixel distance for snapping to the\n * drawing finish.\n * @property {boolean} [stopClick=false] Stop click, singleclick, and\n * doubleclick events from firing during drawing.\n * @property {number} [maxPoints] The number of points that can be drawn before\n * a polygon ring or line string is finished. By default there is no\n * restriction.\n * @property {number} [minPoints] The number of points that must be drawn\n * before a polygon ring or line string can be finished. Default is `3` for\n * polygon rings and `2` for line strings.\n * @property {module:ol/events/condition~Condition} [finishCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether the drawing can be finished.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [style]\n * Style for sketch features.\n * @property {module:ol/interaction/Draw~GeometryFunction} [geometryFunction]\n * Function that is called when a geometry's coordinates are updated.\n * @property {string} [geometryName] Geometry name to use for features created\n * by the draw interaction.\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default {@link module:ol/events/condition~noModifierKeys}, i.e. a click,\n * adds a vertex or deactivates freehand drawing.\n * @property {boolean} [freehand=false] Operate in freehand mode for lines,\n * polygons, and circles.  This makes the interaction always operate in freehand\n * mode and takes precedence over any `freehandCondition` option.\n * @property {module:ol/events/condition~Condition} [freehandCondition]\n * Condition that activates freehand drawing for lines and polygons. This\n * function takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether that event should be handled. The\n * default is {@link module:ol/events/condition~shiftKeyOnly}, meaning that the\n * Shift key activates freehand drawing.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n */\n\n\n/**\n * Function that takes an array of coordinates and an optional existing geometry as\n * arguments, and returns a geometry. The optional existing geometry is the\n * geometry that is returned when the function is called without a second\n * argument.\n * @typedef {function(!Array.<module:ol/coordinate~Coordinate>, module:ol/geom/SimpleGeometry=):\n *     module:ol/geom/SimpleGeometry} GeometryFunction\n */\n\n\n/**\n * Draw mode.  This collapses multi-part geometry types with their single-part\n * cousins.\n * @enum {string}\n */\nconst Mode = {\n  POINT: 'Point',\n  LINE_STRING: 'LineString',\n  POLYGON: 'Polygon',\n  CIRCLE: 'Circle'\n};\n\n\n/**\n * @enum {string}\n */\nconst DrawEventType = {\n  /**\n   * Triggered upon feature draw start\n   * @event module:ol/interaction/Draw~DrawEvent#drawstart\n   * @api\n   */\n  DRAWSTART: 'drawstart',\n  /**\n   * Triggered upon feature draw end\n   * @event module:ol/interaction/Draw~DrawEvent#drawend\n   * @api\n   */\n  DRAWEND: 'drawend'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Draw~Draw} instances are\n * instances of this type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {module:ol/interaction/Draw~DrawEventType} type Type.\n * @param {module:ol/Feature} feature The feature drawn.\n */\nconst DrawEvent = function(type, feature) {\n\n  Event.call(this, type);\n\n  /**\n   * The feature being drawn.\n   * @type {module:ol/Feature}\n   * @api\n   */\n  this.feature = feature;\n\n};\n\ninherits(DrawEvent, Event);\n\n\n/**\n * @classdesc\n * Interaction for drawing feature geometries.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @fires module:ol/interaction/Draw~DrawEvent\n * @param {module:ol/interaction/Draw~Options} options Options.\n * @api\n */\nconst Draw = function(options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleEvent: handleEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.shouldHandle_ = false;\n\n  /**\n   * @type {module:ol~Pixel}\n   * @private\n   */\n  this.downPx_ = null;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.downTimeout_;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.lastDragTime_;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.freehand_ = false;\n\n  /**\n   * Target source for drawn features.\n   * @type {module:ol/source/Vector}\n   * @private\n   */\n  this.source_ = options.source ? options.source : null;\n\n  /**\n   * Target collection for drawn features.\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @private\n   */\n  this.features_ = options.features ? options.features : null;\n\n  /**\n   * Pixel distance for snapping.\n   * @type {number}\n   * @private\n   */\n  this.snapTolerance_ = options.snapTolerance ? options.snapTolerance : 12;\n\n  /**\n   * Geometry type.\n   * @type {module:ol/geom/GeometryType}\n   * @private\n   */\n  this.type_ = /** @type {module:ol/geom/GeometryType} */ (options.type);\n\n  /**\n   * Drawing mode (derived from geometry type.\n   * @type {module:ol/interaction/Draw~Mode}\n   * @private\n   */\n  this.mode_ = getMode(this.type_);\n\n  /**\n   * Stop click, singleclick, and doubleclick events from firing during drawing.\n   * Default is `false`.\n   * @type {boolean}\n   * @private\n   */\n  this.stopClick_ = !!options.stopClick;\n\n  /**\n   * The number of points that must be drawn before a polygon ring or line\n   * string can be finished.  The default is 3 for polygon rings and 2 for\n   * line strings.\n   * @type {number}\n   * @private\n   */\n  this.minPoints_ = options.minPoints ?\n    options.minPoints :\n    (this.mode_ === Mode.POLYGON ? 3 : 2);\n\n  /**\n   * The number of points that can be drawn before a polygon ring or line string\n   * is finished. The default is no restriction.\n   * @type {number}\n   * @private\n   */\n  this.maxPoints_ = options.maxPoints ? options.maxPoints : Infinity;\n\n  /**\n   * A function to decide if a potential finish coordinate is permissible\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.finishCondition_ = options.finishCondition ? options.finishCondition : TRUE;\n\n  let geometryFunction = options.geometryFunction;\n  if (!geometryFunction) {\n    if (this.type_ === GeometryType.CIRCLE) {\n      /**\n       * @param {!Array.<module:ol/coordinate~Coordinate>} coordinates\n       *     The coordinates.\n       * @param {module:ol/geom/SimpleGeometry=} opt_geometry Optional geometry.\n       * @return {module:ol/geom/SimpleGeometry} A geometry.\n       */\n      geometryFunction = function(coordinates, opt_geometry) {\n        const circle = opt_geometry ? /** @type {module:ol/geom/Circle} */ (opt_geometry) :\n          new Circle([NaN, NaN]);\n        const squaredLength = squaredCoordinateDistance(\n          coordinates[0], coordinates[1]);\n        circle.setCenterAndRadius(coordinates[0], Math.sqrt(squaredLength));\n        return circle;\n      };\n    } else {\n      let Constructor;\n      const mode = this.mode_;\n      if (mode === Mode.POINT) {\n        Constructor = Point;\n      } else if (mode === Mode.LINE_STRING) {\n        Constructor = LineString;\n      } else if (mode === Mode.POLYGON) {\n        Constructor = Polygon;\n      }\n      /**\n       * @param {!Array.<module:ol/coordinate~Coordinate>} coordinates\n       *     The coordinates.\n       * @param {module:ol/geom/SimpleGeometry=} opt_geometry Optional geometry.\n       * @return {module:ol/geom/SimpleGeometry} A geometry.\n       */\n      geometryFunction = function(coordinates, opt_geometry) {\n        let geometry = opt_geometry;\n        if (geometry) {\n          if (mode === Mode.POLYGON) {\n            if (coordinates[0].length) {\n              // Add a closing coordinate to match the first\n              geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\n            } else {\n              geometry.setCoordinates([]);\n            }\n          } else {\n            geometry.setCoordinates(coordinates);\n          }\n        } else {\n          geometry = new Constructor(coordinates);\n        }\n        return geometry;\n      };\n    }\n  }\n\n  /**\n   * @type {module:ol/interaction/Draw~GeometryFunction}\n   * @private\n   */\n  this.geometryFunction_ = geometryFunction;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.dragVertexDelay_ = options.dragVertexDelay !== undefined ? options.dragVertexDelay : 500;\n\n  /**\n   * Finish coordinate for the feature (first point for polygons, last point for\n   * linestrings).\n   * @type {module:ol/coordinate~Coordinate}\n   * @private\n   */\n  this.finishCoordinate_ = null;\n\n  /**\n   * Sketch feature.\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.sketchFeature_ = null;\n\n  /**\n   * Sketch point.\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.sketchPoint_ = null;\n\n  /**\n   * Sketch coordinates. Used when drawing a line or polygon.\n   * @type {module:ol/coordinate~Coordinate|Array.<module:ol/coordinate~Coordinate>|Array.<Array.<module:ol/coordinate~Coordinate>>}\n   * @private\n   */\n  this.sketchCoords_ = null;\n\n  /**\n   * Sketch line. Used when drawing polygon.\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.sketchLine_ = null;\n\n  /**\n   * Sketch line coordinates. Used when drawing a polygon or circle.\n   * @type {Array.<module:ol/coordinate~Coordinate>}\n   * @private\n   */\n  this.sketchLineCoords_ = null;\n\n  /**\n   * Squared tolerance for handling up events.  If the squared distance\n   * between a down and up event is greater than this tolerance, up events\n   * will not be handled.\n   * @type {number}\n   * @private\n   */\n  this.squaredClickTolerance_ = options.clickTolerance ?\n    options.clickTolerance * options.clickTolerance : 36;\n\n  /**\n   * Draw overlay where our sketch features are drawn.\n   * @type {module:ol/layer/Vector}\n   * @private\n   */\n  this.overlay_ = new VectorLayer({\n    source: new VectorSource({\n      useSpatialIndex: false,\n      wrapX: options.wrapX ? options.wrapX : false\n    }),\n    style: options.style ? options.style :\n      getDefaultStyleFunction(),\n    updateWhileInteracting: true\n  });\n\n  /**\n   * Name of the geometry attribute for newly created features.\n   * @type {string|undefined}\n   * @private\n   */\n  this.geometryName_ = options.geometryName;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : noModifierKeys;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.freehandCondition_;\n  if (options.freehand) {\n    this.freehandCondition_ = always;\n  } else {\n    this.freehandCondition_ = options.freehandCondition ?\n      options.freehandCondition : shiftKeyOnly;\n  }\n\n  listen(this,\n    getChangeEventType(InteractionProperty.ACTIVE),\n    this.updateState_, this);\n\n};\n\ninherits(Draw, PointerInteraction);\n\n\n/**\n * @return {module:ol/style/Style~StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const styles = createEditingStyle();\n  return function(feature, resolution) {\n    return styles[feature.getGeometry().getType()];\n  };\n}\n\n\n/**\n * @inheritDoc\n */\nDraw.prototype.setMap = function(map) {\n  PointerInteraction.prototype.setMap.call(this, map);\n  this.updateState_();\n};\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} and may actually\n * draw or finish the drawing.\n * @param {module:ol/MapBrowserEvent} event Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/Draw}\n * @api\n */\nexport function handleEvent(event) {\n  if (event.originalEvent.type === EventType.CONTEXTMENU) {\n    // Avoid context menu for long taps when drawing on mobile\n    event.preventDefault();\n  }\n  this.freehand_ = this.mode_ !== Mode.POINT && this.freehandCondition_(event);\n  let move = event.type === MapBrowserEventType.POINTERMOVE;\n  let pass = true;\n  if (this.lastDragTime_ && event.type === MapBrowserEventType.POINTERDRAG) {\n    const now = Date.now();\n    if (now - this.lastDragTime_ >= this.dragVertexDelay_) {\n      this.downPx_ = event.pixel;\n      this.shouldHandle_ = !this.freehand_;\n      move = true;\n    } else {\n      this.lastDragTime_ = undefined;\n    }\n    if (this.shouldHandle_ && this.downTimeout_) {\n      clearTimeout(this.downTimeout_);\n      this.downTimeout_ = undefined;\n    }\n  }\n  if (this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDRAG &&\n      this.sketchFeature_ !== null) {\n    this.addToDrawing_(event);\n    pass = false;\n  } else if (this.freehand_ &&\n      event.type === MapBrowserEventType.POINTERDOWN) {\n    pass = false;\n  } else if (move) {\n    pass = event.type === MapBrowserEventType.POINTERMOVE;\n    if (pass && this.freehand_) {\n      pass = this.handlePointerMove_(event);\n    } else if (event.pointerEvent.pointerType == POINTER_TYPE ||\n        (event.type === MapBrowserEventType.POINTERDRAG && !this.downTimeout_)) {\n      this.handlePointerMove_(event);\n    }\n  } else if (event.type === MapBrowserEventType.DBLCLICK) {\n    pass = false;\n  }\n\n  return handlePointerEvent.call(this, event) && pass;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} event Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/Draw}\n */\nfunction handleDownEvent(event) {\n  this.shouldHandle_ = !this.freehand_;\n\n  if (this.freehand_) {\n    this.downPx_ = event.pixel;\n    if (!this.finishCoordinate_) {\n      this.startDrawing_(event);\n    }\n    return true;\n  } else if (this.condition_(event)) {\n    this.lastDragTime_ = Date.now();\n    this.downTimeout_ = setTimeout(function() {\n      this.handlePointerMove_(new MapBrowserPointerEvent(\n        MapBrowserEventType.POINTERMOVE, event.map, event.pointerEvent, event.frameState));\n    }.bind(this), this.dragVertexDelay_);\n    this.downPx_ = event.pixel;\n    return true;\n  } else {\n    return false;\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} event Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/Draw}\n */\nfunction handleUpEvent(event) {\n  let pass = true;\n\n  if (this.downTimeout_) {\n    clearTimeout(this.downTimeout_);\n    this.downTimeout_ = undefined;\n  }\n\n  this.handlePointerMove_(event);\n\n  const circleMode = this.mode_ === Mode.CIRCLE;\n\n  if (this.shouldHandle_) {\n    if (!this.finishCoordinate_) {\n      this.startDrawing_(event);\n      if (this.mode_ === Mode.POINT) {\n        this.finishDrawing();\n      }\n    } else if (this.freehand_ || circleMode) {\n      this.finishDrawing();\n    } else if (this.atFinish_(event)) {\n      if (this.finishCondition_(event)) {\n        this.finishDrawing();\n      }\n    } else {\n      this.addToDrawing_(event);\n    }\n    pass = false;\n  } else if (this.freehand_) {\n    this.finishCoordinate_ = null;\n    this.abortDrawing_();\n  }\n  if (!pass && this.stopClick_) {\n    event.stopPropagation();\n  }\n  return pass;\n}\n\n\n/**\n * Handle move events.\n * @param {module:ol/MapBrowserEvent} event A move event.\n * @return {boolean} Pass the event to other interactions.\n * @private\n */\nDraw.prototype.handlePointerMove_ = function(event) {\n  if (this.downPx_ &&\n      ((!this.freehand_ && this.shouldHandle_) ||\n      (this.freehand_ && !this.shouldHandle_))) {\n    const downPx = this.downPx_;\n    const clickPx = event.pixel;\n    const dx = downPx[0] - clickPx[0];\n    const dy = downPx[1] - clickPx[1];\n    const squaredDistance = dx * dx + dy * dy;\n    this.shouldHandle_ = this.freehand_ ?\n      squaredDistance > this.squaredClickTolerance_ :\n      squaredDistance <= this.squaredClickTolerance_;\n    if (!this.shouldHandle_) {\n      return true;\n    }\n  }\n\n  if (this.finishCoordinate_) {\n    this.modifyDrawing_(event);\n  } else {\n    this.createOrUpdateSketchPoint_(event);\n  }\n  return true;\n};\n\n\n/**\n * Determine if an event is within the snapping tolerance of the start coord.\n * @param {module:ol/MapBrowserEvent} event Event.\n * @return {boolean} The event is within the snapping tolerance of the start.\n * @private\n */\nDraw.prototype.atFinish_ = function(event) {\n  let at = false;\n  if (this.sketchFeature_) {\n    let potentiallyDone = false;\n    let potentiallyFinishCoordinates = [this.finishCoordinate_];\n    if (this.mode_ === Mode.LINE_STRING) {\n      potentiallyDone = this.sketchCoords_.length > this.minPoints_;\n    } else if (this.mode_ === Mode.POLYGON) {\n      potentiallyDone = this.sketchCoords_[0].length >\n          this.minPoints_;\n      potentiallyFinishCoordinates = [this.sketchCoords_[0][0],\n        this.sketchCoords_[0][this.sketchCoords_[0].length - 2]];\n    }\n    if (potentiallyDone) {\n      const map = event.map;\n      for (let i = 0, ii = potentiallyFinishCoordinates.length; i < ii; i++) {\n        const finishCoordinate = potentiallyFinishCoordinates[i];\n        const finishPixel = map.getPixelFromCoordinate(finishCoordinate);\n        const pixel = event.pixel;\n        const dx = pixel[0] - finishPixel[0];\n        const dy = pixel[1] - finishPixel[1];\n        const snapTolerance = this.freehand_ ? 1 : this.snapTolerance_;\n        at = Math.sqrt(dx * dx + dy * dy) <= snapTolerance;\n        if (at) {\n          this.finishCoordinate_ = finishCoordinate;\n          break;\n        }\n      }\n    }\n  }\n  return at;\n};\n\n\n/**\n * @param {module:ol/MapBrowserEvent} event Event.\n * @private\n */\nDraw.prototype.createOrUpdateSketchPoint_ = function(event) {\n  const coordinates = event.coordinate.slice();\n  if (!this.sketchPoint_) {\n    this.sketchPoint_ = new Feature(new Point(coordinates));\n    this.updateSketchFeatures_();\n  } else {\n    const sketchPointGeom = /** @type {module:ol/geom/Point} */ (this.sketchPoint_.getGeometry());\n    sketchPointGeom.setCoordinates(coordinates);\n  }\n};\n\n\n/**\n * Start the drawing.\n * @param {module:ol/MapBrowserEvent} event Event.\n * @private\n */\nDraw.prototype.startDrawing_ = function(event) {\n  const start = event.coordinate;\n  this.finishCoordinate_ = start;\n  if (this.mode_ === Mode.POINT) {\n    this.sketchCoords_ = start.slice();\n  } else if (this.mode_ === Mode.POLYGON) {\n    this.sketchCoords_ = [[start.slice(), start.slice()]];\n    this.sketchLineCoords_ = this.sketchCoords_[0];\n  } else {\n    this.sketchCoords_ = [start.slice(), start.slice()];\n  }\n  if (this.sketchLineCoords_) {\n    this.sketchLine_ = new Feature(\n      new LineString(this.sketchLineCoords_));\n  }\n  const geometry = this.geometryFunction_(this.sketchCoords_);\n  this.sketchFeature_ = new Feature();\n  if (this.geometryName_) {\n    this.sketchFeature_.setGeometryName(this.geometryName_);\n  }\n  this.sketchFeature_.setGeometry(geometry);\n  this.updateSketchFeatures_();\n  this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_));\n};\n\n\n/**\n * Modify the drawing.\n * @param {module:ol/MapBrowserEvent} event Event.\n * @private\n */\nDraw.prototype.modifyDrawing_ = function(event) {\n  let coordinate = event.coordinate;\n  const geometry = /** @type {module:ol/geom/SimpleGeometry} */ (this.sketchFeature_.getGeometry());\n  let coordinates, last;\n  if (this.mode_ === Mode.POINT) {\n    last = this.sketchCoords_;\n  } else if (this.mode_ === Mode.POLYGON) {\n    coordinates = this.sketchCoords_[0];\n    last = coordinates[coordinates.length - 1];\n    if (this.atFinish_(event)) {\n      // snap to finish\n      coordinate = this.finishCoordinate_.slice();\n    }\n  } else {\n    coordinates = this.sketchCoords_;\n    last = coordinates[coordinates.length - 1];\n  }\n  last[0] = coordinate[0];\n  last[1] = coordinate[1];\n  this.geometryFunction_(/** @type {!Array.<module:ol/coordinate~Coordinate>} */ (this.sketchCoords_), geometry);\n  if (this.sketchPoint_) {\n    const sketchPointGeom = /** @type {module:ol/geom/Point} */ (this.sketchPoint_.getGeometry());\n    sketchPointGeom.setCoordinates(coordinate);\n  }\n  let sketchLineGeom;\n  if (geometry instanceof Polygon &&\n      this.mode_ !== Mode.POLYGON) {\n    if (!this.sketchLine_) {\n      this.sketchLine_ = new Feature(new LineString(null));\n    }\n    const ring = geometry.getLinearRing(0);\n    sketchLineGeom = /** @type {module:ol/geom/LineString} */ (this.sketchLine_.getGeometry());\n    sketchLineGeom.setFlatCoordinates(\n      ring.getLayout(), ring.getFlatCoordinates());\n  } else if (this.sketchLineCoords_) {\n    sketchLineGeom = /** @type {module:ol/geom/LineString} */ (this.sketchLine_.getGeometry());\n    sketchLineGeom.setCoordinates(this.sketchLineCoords_);\n  }\n  this.updateSketchFeatures_();\n};\n\n\n/**\n * Add a new coordinate to the drawing.\n * @param {module:ol/MapBrowserEvent} event Event.\n * @private\n */\nDraw.prototype.addToDrawing_ = function(event) {\n  const coordinate = event.coordinate;\n  const geometry = /** @type {module:ol/geom/SimpleGeometry} */ (this.sketchFeature_.getGeometry());\n  let done;\n  let coordinates;\n  if (this.mode_ === Mode.LINE_STRING) {\n    this.finishCoordinate_ = coordinate.slice();\n    coordinates = this.sketchCoords_;\n    if (coordinates.length >= this.maxPoints_) {\n      if (this.freehand_) {\n        coordinates.pop();\n      } else {\n        done = true;\n      }\n    }\n    coordinates.push(coordinate.slice());\n    this.geometryFunction_(coordinates, geometry);\n  } else if (this.mode_ === Mode.POLYGON) {\n    coordinates = this.sketchCoords_[0];\n    if (coordinates.length >= this.maxPoints_) {\n      if (this.freehand_) {\n        coordinates.pop();\n      } else {\n        done = true;\n      }\n    }\n    coordinates.push(coordinate.slice());\n    if (done) {\n      this.finishCoordinate_ = coordinates[0];\n    }\n    this.geometryFunction_(this.sketchCoords_, geometry);\n  }\n  this.updateSketchFeatures_();\n  if (done) {\n    this.finishDrawing();\n  }\n};\n\n\n/**\n * Remove last point of the feature currently being drawn.\n * @api\n */\nDraw.prototype.removeLastPoint = function() {\n  if (!this.sketchFeature_) {\n    return;\n  }\n  const geometry = /** @type {module:ol/geom/SimpleGeometry} */ (this.sketchFeature_.getGeometry());\n  let coordinates, sketchLineGeom;\n  if (this.mode_ === Mode.LINE_STRING) {\n    coordinates = this.sketchCoords_;\n    coordinates.splice(-2, 1);\n    this.geometryFunction_(coordinates, geometry);\n    if (coordinates.length >= 2) {\n      this.finishCoordinate_ = coordinates[coordinates.length - 2].slice();\n    }\n  } else if (this.mode_ === Mode.POLYGON) {\n    coordinates = this.sketchCoords_[0];\n    coordinates.splice(-2, 1);\n    sketchLineGeom = /** @type {module:ol/geom/LineString} */ (this.sketchLine_.getGeometry());\n    sketchLineGeom.setCoordinates(coordinates);\n    this.geometryFunction_(this.sketchCoords_, geometry);\n  }\n\n  if (coordinates.length === 0) {\n    this.finishCoordinate_ = null;\n  }\n\n  this.updateSketchFeatures_();\n};\n\n\n/**\n * Stop drawing and add the sketch feature to the target layer.\n * The {@link module:ol/interaction/Draw~DrawEventType.DRAWEND} event is\n * dispatched before inserting the feature.\n * @api\n */\nDraw.prototype.finishDrawing = function() {\n  const sketchFeature = this.abortDrawing_();\n  if (!sketchFeature) {\n    return;\n  }\n  let coordinates = this.sketchCoords_;\n  const geometry = /** @type {module:ol/geom/SimpleGeometry} */ (sketchFeature.getGeometry());\n  if (this.mode_ === Mode.LINE_STRING) {\n    // remove the redundant last point\n    coordinates.pop();\n    this.geometryFunction_(coordinates, geometry);\n  } else if (this.mode_ === Mode.POLYGON) {\n    // remove the redundant last point in ring\n    coordinates[0].pop();\n    this.geometryFunction_(coordinates, geometry);\n    coordinates = geometry.getCoordinates();\n  }\n\n  // cast multi-part geometries\n  if (this.type_ === GeometryType.MULTI_POINT) {\n    sketchFeature.setGeometry(new MultiPoint([coordinates]));\n  } else if (this.type_ === GeometryType.MULTI_LINE_STRING) {\n    sketchFeature.setGeometry(new MultiLineString([coordinates]));\n  } else if (this.type_ === GeometryType.MULTI_POLYGON) {\n    sketchFeature.setGeometry(new MultiPolygon([coordinates]));\n  }\n\n  // First dispatch event to allow full set up of feature\n  this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND, sketchFeature));\n\n  // Then insert feature\n  if (this.features_) {\n    this.features_.push(sketchFeature);\n  }\n  if (this.source_) {\n    this.source_.addFeature(sketchFeature);\n  }\n};\n\n\n/**\n * Stop drawing without adding the sketch feature to the target layer.\n * @return {module:ol/Feature} The sketch feature (or null if none).\n * @private\n */\nDraw.prototype.abortDrawing_ = function() {\n  this.finishCoordinate_ = null;\n  const sketchFeature = this.sketchFeature_;\n  if (sketchFeature) {\n    this.sketchFeature_ = null;\n    this.sketchPoint_ = null;\n    this.sketchLine_ = null;\n    this.overlay_.getSource().clear(true);\n  }\n  return sketchFeature;\n};\n\n\n/**\n * Extend an existing geometry by adding additional points. This only works\n * on features with `LineString` geometries, where the interaction will\n * extend lines by adding points to the end of the coordinates array.\n * @param {!module:ol/Feature} feature Feature to be extended.\n * @api\n */\nDraw.prototype.extend = function(feature) {\n  const geometry = feature.getGeometry();\n  const lineString = /** @type {module:ol/geom/LineString} */ (geometry);\n  this.sketchFeature_ = feature;\n  this.sketchCoords_ = lineString.getCoordinates();\n  const last = this.sketchCoords_[this.sketchCoords_.length - 1];\n  this.finishCoordinate_ = last.slice();\n  this.sketchCoords_.push(last.slice());\n  this.updateSketchFeatures_();\n  this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART, this.sketchFeature_));\n};\n\n\n/**\n * @inheritDoc\n */\nDraw.prototype.shouldStopEvent = FALSE;\n\n\n/**\n * Redraw the sketch features.\n * @private\n */\nDraw.prototype.updateSketchFeatures_ = function() {\n  const sketchFeatures = [];\n  if (this.sketchFeature_) {\n    sketchFeatures.push(this.sketchFeature_);\n  }\n  if (this.sketchLine_) {\n    sketchFeatures.push(this.sketchLine_);\n  }\n  if (this.sketchPoint_) {\n    sketchFeatures.push(this.sketchPoint_);\n  }\n  const overlaySource = this.overlay_.getSource();\n  overlaySource.clear(true);\n  overlaySource.addFeatures(sketchFeatures);\n};\n\n\n/**\n * @private\n */\nDraw.prototype.updateState_ = function() {\n  const map = this.getMap();\n  const active = this.getActive();\n  if (!map || !active) {\n    this.abortDrawing_();\n  }\n  this.overlay_.setMap(active ? map : null);\n};\n\n\n/**\n * Create a `geometryFunction` for `type: 'Circle'` that will create a regular\n * polygon with a user specified number of sides and start angle instead of an\n * `module:ol/geom/Circle~Circle` geometry.\n * @param {number=} opt_sides Number of sides of the regular polygon. Default is\n *     32.\n * @param {number=} opt_angle Angle of the first point in radians. 0 means East.\n *     Default is the angle defined by the heading from the center of the\n *     regular polygon to the current pointer position.\n * @return {module:ol/interaction/Draw~GeometryFunction} Function that draws a\n *     polygon.\n * @api\n */\nexport function createRegularPolygon(opt_sides, opt_angle) {\n  return function(coordinates, opt_geometry) {\n    const center = coordinates[0];\n    const end = coordinates[1];\n    const radius = Math.sqrt(\n      squaredCoordinateDistance(center, end));\n    const geometry = opt_geometry ? /** @type {module:ol/geom/Polygon} */ (opt_geometry) :\n      fromCircle(new Circle(center), opt_sides);\n    const angle = opt_angle ? opt_angle :\n      Math.atan((end[1] - center[1]) / (end[0] - center[0]));\n    makeRegular(geometry, center, radius, angle);\n    return geometry;\n  };\n}\n\n\n/**\n * Create a `geometryFunction` that will create a box-shaped polygon (aligned\n * with the coordinate system axes).  Use this with the draw interaction and\n * `type: 'Circle'` to return a box instead of a circle geometry.\n * @return {module:ol/interaction/Draw~GeometryFunction} Function that draws a box-shaped polygon.\n * @api\n */\nexport function createBox() {\n  return (\n    function(coordinates, opt_geometry) {\n      const extent = boundingExtent(coordinates);\n      const geometry = opt_geometry || new Polygon(null);\n      geometry.setCoordinates([[\n        getBottomLeft(extent),\n        getBottomRight(extent),\n        getTopRight(extent),\n        getTopLeft(extent),\n        getBottomLeft(extent)\n      ]]);\n      return geometry;\n    }\n  );\n}\n\n\n/**\n * Get the drawing mode.  The mode for mult-part geometries is the same as for\n * their single-part cousins.\n * @param {module:ol/geom/GeometryType} type Geometry type.\n * @return {module:ol/interaction/Draw~Mode} Drawing mode.\n */\nfunction getMode(type) {\n  let mode;\n  if (type === GeometryType.POINT ||\n      type === GeometryType.MULTI_POINT) {\n    mode = Mode.POINT;\n  } else if (type === GeometryType.LINE_STRING ||\n      type === GeometryType.MULTI_LINE_STRING) {\n    mode = Mode.LINE_STRING;\n  } else if (type === GeometryType.POLYGON ||\n      type === GeometryType.MULTI_POLYGON) {\n    mode = Mode.POLYGON;\n  } else if (type === GeometryType.CIRCLE) {\n    mode = Mode.CIRCLE;\n  }\n  return (\n    /** @type {!module:ol/interaction/Draw~Mode} */ (mode)\n  );\n}\n\n\nexport default Draw;\n","/**\n * @module ol/interaction/Extent\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport MapBrowserPointerEvent from '../MapBrowserPointerEvent.js';\nimport {squaredDistanceToSegment, closestOnSegment, distance as coordinateDistance, squaredDistance as squaredCoordinateDistance} from '../coordinate.js';\nimport Event from '../events/Event.js';\nimport {boundingExtent, getArea} from '../extent.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport Point from '../geom/Point.js';\nimport {fromExtent as polygonFromExtent} from '../geom/Polygon.js';\nimport PointerInteraction, {handleEvent as handlePointerEvent} from '../interaction/Pointer.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorSource from '../source/Vector.js';\nimport {createEditingStyle} from '../style/Style.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/extent~Extent} [extent] Initial extent. Defaults to no\n * initial extent.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [boxStyle]\n * Style for the drawn extent box. Defaults to\n * {@link module:ol/style/Style~createEditing()['Polygon']}\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the\n * pointer close enough to a segment or vertex for editing.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [pointerStyle]\n * Style for the cursor used to draw the extent. Defaults to\n * {@link module:ol/style/Style~createEditing()['Point']}\n * @property {boolean} [wrapX=false] Wrap the drawn extent across multiple maps\n * in the X direction? Only affects visuals, not functionality.\n */\n\n\n/**\n * @enum {string}\n */\nconst ExtentEventType = {\n  /**\n   * Triggered after the extent is changed\n   * @event module:ol/interaction/Extent~ExtentEventType#extentchanged\n   * @api\n   */\n  EXTENTCHANGED: 'extentchanged'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Extent~Extent} instances are\n * instances of this type.\n *\n * @constructor\n * @param {module:ol/extent~Extent} extent the new extent\n * @extends {module:ol/events/Event}\n */\nconst ExtentInteractionEvent = function(extent) {\n  Event.call(this, ExtentEventType.EXTENTCHANGED);\n\n  /**\n   * The current extent.\n   * @type {module:ol/extent~Extent}\n   * @api\n   */\n  this.extent = extent;\n\n};\ninherits(ExtentInteractionEvent, Event);\n\n\n/**\n * @classdesc\n * Allows the user to draw a vector box by clicking and dragging on the map.\n * Once drawn, the vector box can be modified by dragging its vertices or edges.\n * This interaction is only supported for mouse devices.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @fires module:ol/interaction/Extent~Event\n * @param {module:ol/interaction/Extent~Options=} opt_options Options.\n * @api\n */\nconst ExtentInteraction = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * Extent of the drawn box\n   * @type {module:ol/extent~Extent}\n   * @private\n   */\n  this.extent_ = null;\n\n  /**\n   * Handler for pointer move events\n   * @type {function (module:ol/coordinate~Coordinate): module:ol/extent~Extent|null}\n   * @private\n   */\n  this.pointerHandler_ = null;\n\n  /**\n   * Pixel threshold to snap to extent\n   * @type {number}\n   * @private\n   */\n  this.pixelTolerance_ = options.pixelTolerance !== undefined ?\n    options.pixelTolerance : 10;\n\n  /**\n   * Is the pointer snapped to an extent vertex\n   * @type {boolean}\n   * @private\n   */\n  this.snappedToVertex_ = false;\n\n  /**\n   * Feature for displaying the visible extent\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.extentFeature_ = null;\n\n  /**\n   * Feature for displaying the visible pointer\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.vertexFeature_ = null;\n\n  if (!opt_options) {\n    opt_options = {};\n  }\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleEvent: handleEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  /**\n   * Layer for the extentFeature\n   * @type {module:ol/layer/Vector}\n   * @private\n   */\n  this.extentOverlay_ = new VectorLayer({\n    source: new VectorSource({\n      useSpatialIndex: false,\n      wrapX: !!opt_options.wrapX\n    }),\n    style: opt_options.boxStyle ? opt_options.boxStyle : getDefaultExtentStyleFunction(),\n    updateWhileAnimating: true,\n    updateWhileInteracting: true\n  });\n\n  /**\n   * Layer for the vertexFeature\n   * @type {module:ol/layer/Vector}\n   * @private\n   */\n  this.vertexOverlay_ = new VectorLayer({\n    source: new VectorSource({\n      useSpatialIndex: false,\n      wrapX: !!opt_options.wrapX\n    }),\n    style: opt_options.pointerStyle ? opt_options.pointerStyle : getDefaultPointerStyleFunction(),\n    updateWhileAnimating: true,\n    updateWhileInteracting: true\n  });\n\n  if (opt_options.extent) {\n    this.setExtent(opt_options.extent);\n  }\n};\n\ninherits(ExtentInteraction, PointerInteraction);\n\n/**\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Event.\n * @return {boolean} Propagate event?\n * @this {module:ol/interaction/Extent~Extent}\n */\nfunction handleEvent(mapBrowserEvent) {\n  if (!(mapBrowserEvent instanceof MapBrowserPointerEvent)) {\n    return true;\n  }\n  //display pointer (if not dragging)\n  if (mapBrowserEvent.type == MapBrowserEventType.POINTERMOVE && !this.handlingDownUpSequence) {\n    this.handlePointerMove_(mapBrowserEvent);\n  }\n  //call pointer to determine up/down/drag\n  handlePointerEvent.call(this, mapBrowserEvent);\n  //return false to stop propagation\n  return false;\n}\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Event handled?\n * @this {module:ol/interaction/Extent~Extent}\n */\nfunction handleDownEvent(mapBrowserEvent) {\n  const pixel = mapBrowserEvent.pixel;\n  const map = mapBrowserEvent.map;\n\n  const extent = this.getExtent();\n  let vertex = this.snapToVertex_(pixel, map);\n\n  //find the extent corner opposite the passed corner\n  const getOpposingPoint = function(point) {\n    let x_ = null;\n    let y_ = null;\n    if (point[0] == extent[0]) {\n      x_ = extent[2];\n    } else if (point[0] == extent[2]) {\n      x_ = extent[0];\n    }\n    if (point[1] == extent[1]) {\n      y_ = extent[3];\n    } else if (point[1] == extent[3]) {\n      y_ = extent[1];\n    }\n    if (x_ !== null && y_ !== null) {\n      return [x_, y_];\n    }\n    return null;\n  };\n  if (vertex && extent) {\n    const x = (vertex[0] == extent[0] || vertex[0] == extent[2]) ? vertex[0] : null;\n    const y = (vertex[1] == extent[1] || vertex[1] == extent[3]) ? vertex[1] : null;\n\n    //snap to point\n    if (x !== null && y !== null) {\n      this.pointerHandler_ = getPointHandler(getOpposingPoint(vertex));\n    //snap to edge\n    } else if (x !== null) {\n      this.pointerHandler_ = getEdgeHandler(\n        getOpposingPoint([x, extent[1]]),\n        getOpposingPoint([x, extent[3]])\n      );\n    } else if (y !== null) {\n      this.pointerHandler_ = getEdgeHandler(\n        getOpposingPoint([extent[0], y]),\n        getOpposingPoint([extent[2], y])\n      );\n    }\n  //no snap - new bbox\n  } else {\n    vertex = map.getCoordinateFromPixel(pixel);\n    this.setExtent([vertex[0], vertex[1], vertex[0], vertex[1]]);\n    this.pointerHandler_ = getPointHandler(vertex);\n  }\n  return true; //event handled; start downup sequence\n}\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Event handled?\n * @this {module:ol/interaction/Extent~Extent}\n */\nfunction handleDragEvent(mapBrowserEvent) {\n  if (this.pointerHandler_) {\n    const pixelCoordinate = mapBrowserEvent.coordinate;\n    this.setExtent(this.pointerHandler_(pixelCoordinate));\n    this.createOrUpdatePointerFeature_(pixelCoordinate);\n  }\n  return true;\n}\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/Extent~Extent}\n */\nfunction handleUpEvent(mapBrowserEvent) {\n  this.pointerHandler_ = null;\n  //If bbox is zero area, set to null;\n  const extent = this.getExtent();\n  if (!extent || getArea(extent) === 0) {\n    this.setExtent(null);\n  }\n  return false; //Stop handling downup sequence\n}\n\n/**\n * Returns the default style for the drawn bbox\n *\n * @return {module:ol/style/Style~StyleFunction} Default Extent style\n */\nfunction getDefaultExtentStyleFunction() {\n  const style = createEditingStyle();\n  return function(feature, resolution) {\n    return style[GeometryType.POLYGON];\n  };\n}\n\n/**\n * Returns the default style for the pointer\n *\n * @return {module:ol/style/Style~StyleFunction} Default pointer style\n */\nfunction getDefaultPointerStyleFunction() {\n  const style = createEditingStyle();\n  return function(feature, resolution) {\n    return style[GeometryType.POINT];\n  };\n}\n\n/**\n * @param {module:ol/coordinate~Coordinate} fixedPoint corner that will be unchanged in the new extent\n * @returns {function (module:ol/coordinate~Coordinate): module:ol/extent~Extent} event handler\n */\nfunction getPointHandler(fixedPoint) {\n  return function(point) {\n    return boundingExtent([fixedPoint, point]);\n  };\n}\n\n/**\n * @param {module:ol/coordinate~Coordinate} fixedP1 first corner that will be unchanged in the new extent\n * @param {module:ol/coordinate~Coordinate} fixedP2 second corner that will be unchanged in the new extent\n * @returns {function (module:ol/coordinate~Coordinate): module:ol/extent~Extent|null} event handler\n */\nfunction getEdgeHandler(fixedP1, fixedP2) {\n  if (fixedP1[0] == fixedP2[0]) {\n    return function(point) {\n      return boundingExtent([fixedP1, [point[0], fixedP2[1]]]);\n    };\n  } else if (fixedP1[1] == fixedP2[1]) {\n    return function(point) {\n      return boundingExtent([fixedP1, [fixedP2[0], point[1]]]);\n    };\n  } else {\n    return null;\n  }\n}\n\n/**\n * @param {module:ol/extent~Extent} extent extent\n * @returns {Array<Array<module:ol/coordinate~Coordinate>>} extent line segments\n */\nfunction getSegments(extent) {\n  return [\n    [[extent[0], extent[1]], [extent[0], extent[3]]],\n    [[extent[0], extent[3]], [extent[2], extent[3]]],\n    [[extent[2], extent[3]], [extent[2], extent[1]]],\n    [[extent[2], extent[1]], [extent[0], extent[1]]]\n  ];\n}\n\n/**\n * @param {module:ol~Pixel} pixel cursor location\n * @param {module:ol/PluggableMap} map map\n * @returns {module:ol/coordinate~Coordinate|null} snapped vertex on extent\n * @private\n */\nExtentInteraction.prototype.snapToVertex_ = function(pixel, map) {\n  const pixelCoordinate = map.getCoordinateFromPixel(pixel);\n  const sortByDistance = function(a, b) {\n    return squaredDistanceToSegment(pixelCoordinate, a) -\n        squaredDistanceToSegment(pixelCoordinate, b);\n  };\n  const extent = this.getExtent();\n  if (extent) {\n    //convert extents to line segments and find the segment closest to pixelCoordinate\n    const segments = getSegments(extent);\n    segments.sort(sortByDistance);\n    const closestSegment = segments[0];\n\n    let vertex = (closestOnSegment(pixelCoordinate,\n      closestSegment));\n    const vertexPixel = map.getPixelFromCoordinate(vertex);\n\n    //if the distance is within tolerance, snap to the segment\n    if (coordinateDistance(pixel, vertexPixel) <= this.pixelTolerance_) {\n      //test if we should further snap to a vertex\n      const pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n      const pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n      const squaredDist1 = squaredCoordinateDistance(vertexPixel, pixel1);\n      const squaredDist2 = squaredCoordinateDistance(vertexPixel, pixel2);\n      const dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n      this.snappedToVertex_ = dist <= this.pixelTolerance_;\n      if (this.snappedToVertex_) {\n        vertex = squaredDist1 > squaredDist2 ?\n          closestSegment[1] : closestSegment[0];\n      }\n      return vertex;\n    }\n  }\n  return null;\n};\n\n/**\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent pointer move event\n * @private\n */\nExtentInteraction.prototype.handlePointerMove_ = function(mapBrowserEvent) {\n  const pixel = mapBrowserEvent.pixel;\n  const map = mapBrowserEvent.map;\n\n  let vertex = this.snapToVertex_(pixel, map);\n  if (!vertex) {\n    vertex = map.getCoordinateFromPixel(pixel);\n  }\n  this.createOrUpdatePointerFeature_(vertex);\n};\n\n/**\n * @param {module:ol/extent~Extent} extent extent\n * @returns {module:ol/Feature} extent as featrue\n * @private\n */\nExtentInteraction.prototype.createOrUpdateExtentFeature_ = function(extent) {\n  let extentFeature = this.extentFeature_;\n\n  if (!extentFeature) {\n    if (!extent) {\n      extentFeature = new Feature({});\n    } else {\n      extentFeature = new Feature(polygonFromExtent(extent));\n    }\n    this.extentFeature_ = extentFeature;\n    this.extentOverlay_.getSource().addFeature(extentFeature);\n  } else {\n    if (!extent) {\n      extentFeature.setGeometry(undefined);\n    } else {\n      extentFeature.setGeometry(polygonFromExtent(extent));\n    }\n  }\n  return extentFeature;\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} vertex location of feature\n * @returns {module:ol/Feature} vertex as feature\n * @private\n */\nExtentInteraction.prototype.createOrUpdatePointerFeature_ = function(vertex) {\n  let vertexFeature = this.vertexFeature_;\n  if (!vertexFeature) {\n    vertexFeature = new Feature(new Point(vertex));\n    this.vertexFeature_ = vertexFeature;\n    this.vertexOverlay_.getSource().addFeature(vertexFeature);\n  } else {\n    const geometry = /** @type {module:ol/geom/Point} */ (vertexFeature.getGeometry());\n    geometry.setCoordinates(vertex);\n  }\n  return vertexFeature;\n};\n\n\n/**\n * @inheritDoc\n */\nExtentInteraction.prototype.setMap = function(map) {\n  this.extentOverlay_.setMap(map);\n  this.vertexOverlay_.setMap(map);\n  PointerInteraction.prototype.setMap.call(this, map);\n};\n\n/**\n * Returns the current drawn extent in the view projection\n *\n * @return {module:ol/extent~Extent} Drawn extent in the view projection.\n * @api\n */\nExtentInteraction.prototype.getExtent = function() {\n  return this.extent_;\n};\n\n/**\n * Manually sets the drawn extent, using the view projection.\n *\n * @param {module:ol/extent~Extent} extent Extent\n * @api\n */\nExtentInteraction.prototype.setExtent = function(extent) {\n  //Null extent means no bbox\n  this.extent_ = extent ? extent : null;\n  this.createOrUpdateExtentFeature_(extent);\n  this.dispatchEvent(new ExtentInteractionEvent(this.extent_));\n};\n\n\nexport default ExtentInteraction;\n","/**\n * @module ol/interaction/Modify\n */\nimport {getUid, inherits} from '../util.js';\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Feature from '../Feature.js';\nimport MapBrowserEventType from '../MapBrowserEventType.js';\nimport MapBrowserPointerEvent from '../MapBrowserPointerEvent.js';\nimport {equals} from '../array.js';\nimport {equals as coordinatesEqual, distance as coordinateDistance, squaredDistance as squaredCoordinateDistance, squaredDistanceToSegment, closestOnSegment} from '../coordinate.js';\nimport {listen, unlisten} from '../events.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {always, primaryAction, altKeyOnly, singleClick} from '../events/condition.js';\nimport {boundingExtent, buffer, createOrUpdateFromCoordinate} from '../extent.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport Point from '../geom/Point.js';\nimport PointerInteraction, {handleEvent as handlePointerEvent} from '../interaction/Pointer.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorSource from '../source/Vector.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport RBush from '../structs/RBush.js';\nimport {createEditingStyle} from '../style/Style.js';\n\n\n/**\n * @enum {string}\n */\nconst ModifyEventType = {\n  /**\n   * Triggered upon feature modification start\n   * @event ModifyEvent#modifystart\n   * @api\n   */\n  MODIFYSTART: 'modifystart',\n  /**\n   * Triggered upon feature modification end\n   * @event ModifyEvent#modifyend\n   * @api\n   */\n  MODIFYEND: 'modifyend'\n};\n\n\n/**\n * @typedef {Object} SegmentData\n * @property {Array.<number>} [depth]\n * @property {module:ol/Feature} feature\n * @property {module:ol/geom/SimpleGeometry} geometry\n * @property {number} index\n * @property {Array.<module:ol/extent~Extent>} segment\n * @property {Array.<module:ol/interaction/Modify~SegmentData>} [featureSegments]\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event will be considered to add or move a\n * vertex to the sketch. Default is\n * {@link module:ol/events/condition~primaryAction}.\n * @property {module:ol/events/condition~Condition} [deleteCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. By default,\n * {@link module:ol/events/condition~singleClick} with\n * {@link module:ol/events/condition~altKeyOnly} results in a vertex deletion.\n * @property {module:ol/events/condition~Condition} [insertVertexCondition] A\n * function that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and\n * returns a boolean to indicate whether a new vertex can be added to the sketch\n * features. Default is {@link module:ol/events/condition~always}.\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the\n * pointer close enough to a segment or vertex for editing.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [style]\n * Style used for the features being modified. By default the default edit\n * style is used (see {@link module:ol/style}).\n * @property {module:ol/source/Vector} [source] The vector source with\n * features to modify.  If a vector source is not provided, a feature collection\n * must be provided with the features option.\n * @property {module:ol/Collection.<module:ol/Feature>} [features]\n * The features the interaction works on.  If a feature collection is not\n * provided, a vector source must be provided with the source option.\n * @property {boolean} [wrapX=false] Wrap the world horizontally on the sketch\n * overlay.\n */\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Modify~Modify} instances are\n * instances of this type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {ModifyEventType} type Type.\n * @param {module:ol/Collection.<module:ol/Feature>} features\n * The features modified.\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserPointerEvent\n * Associated {@link module:ol/MapBrowserPointerEvent}.\n */\nexport const ModifyEvent = function(type, features, mapBrowserPointerEvent) {\n\n  Event.call(this, type);\n\n  /**\n   * The features being modified.\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @api\n   */\n  this.features = features;\n\n  /**\n   * Associated {@link module:ol/MapBrowserEvent}.\n   * @type {module:ol/MapBrowserEvent}\n   * @api\n   */\n  this.mapBrowserEvent = mapBrowserPointerEvent;\n};\n\ninherits(ModifyEvent, Event);\n\n\n/**\n * @classdesc\n * Interaction for modifying feature geometries.  To modify features that have\n * been added to an existing source, construct the modify interaction with the\n * `source` option.  If you want to modify features in a collection (for example,\n * the collection used by a select interaction), construct the interaction with\n * the `features` option.  The interaction must be constructed with either a\n * `source` or `features` option.\n *\n * By default, the interaction will allow deletion of vertices when the `alt`\n * key is pressed.  To configure the interaction with a different condition\n * for deletion, use the `deleteCondition` option.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/Modify~Options} options Options.\n * @fires module:ol/interaction/Modify~ModifyEvent\n * @api\n */\nconst Modify = function(options) {\n\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleEvent: handleEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : primaryAction;\n\n\n  /**\n   * @private\n   * @param {module:ol/MapBrowserEvent} mapBrowserEvent Browser event.\n   * @return {boolean} Combined condition result.\n   */\n  this.defaultDeleteCondition_ = function(mapBrowserEvent) {\n    return altKeyOnly(mapBrowserEvent) && singleClick(mapBrowserEvent);\n  };\n\n  /**\n   * @type {module:ol/events/condition~Condition}\n   * @private\n   */\n  this.deleteCondition_ = options.deleteCondition ?\n    options.deleteCondition : this.defaultDeleteCondition_;\n\n  /**\n   * @type {module:ol/events/condition~Condition}\n   * @private\n   */\n  this.insertVertexCondition_ = options.insertVertexCondition ?\n    options.insertVertexCondition : always;\n\n  /**\n   * Editing vertex.\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.vertexFeature_ = null;\n\n  /**\n   * Segments intersecting {@link this.vertexFeature_} by segment uid.\n   * @type {Object.<string, boolean>}\n   * @private\n   */\n  this.vertexSegments_ = null;\n\n  /**\n   * @type {module:ol~Pixel}\n   * @private\n   */\n  this.lastPixel_ = [0, 0];\n\n  /**\n   * Tracks if the next `singleclick` event should be ignored to prevent\n   * accidental deletion right after vertex creation.\n   * @type {boolean}\n   * @private\n   */\n  this.ignoreNextSingleClick_ = false;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.modified_ = false;\n\n  /**\n   * Segment RTree for each layer\n   * @type {module:ol/structs/RBush.<module:ol/interaction/Modify~SegmentData>}\n   * @private\n   */\n  this.rBush_ = new RBush();\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.pixelTolerance_ = options.pixelTolerance !== undefined ?\n    options.pixelTolerance : 10;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.snappedToVertex_ = false;\n\n  /**\n   * Indicate whether the interaction is currently changing a feature's\n   * coordinates.\n   * @type {boolean}\n   * @private\n   */\n  this.changingFeature_ = false;\n\n  /**\n   * @type {Array}\n   * @private\n   */\n  this.dragSegments_ = [];\n\n  /**\n   * Draw overlay where sketch features are drawn.\n   * @type {module:ol/layer/Vector}\n   * @private\n   */\n  this.overlay_ = new VectorLayer({\n    source: new VectorSource({\n      useSpatialIndex: false,\n      wrapX: !!options.wrapX\n    }),\n    style: options.style ? options.style :\n      getDefaultStyleFunction(),\n    updateWhileAnimating: true,\n    updateWhileInteracting: true\n  });\n\n  /**\n   * @const\n   * @private\n   * @type {!Object.<string, function(module:ol/Feature, module:ol/geom/Geometry)>}\n   */\n  this.SEGMENT_WRITERS_ = {\n    'Point': this.writePointGeometry_,\n    'LineString': this.writeLineStringGeometry_,\n    'LinearRing': this.writeLineStringGeometry_,\n    'Polygon': this.writePolygonGeometry_,\n    'MultiPoint': this.writeMultiPointGeometry_,\n    'MultiLineString': this.writeMultiLineStringGeometry_,\n    'MultiPolygon': this.writeMultiPolygonGeometry_,\n    'Circle': this.writeCircleGeometry_,\n    'GeometryCollection': this.writeGeometryCollectionGeometry_\n  };\n\n\n  /**\n   * @type {module:ol/source/Vector}\n   * @private\n   */\n  this.source_ = null;\n\n  let features;\n  if (options.source) {\n    this.source_ = options.source;\n    features = new Collection(this.source_.getFeatures());\n    listen(this.source_, VectorEventType.ADDFEATURE,\n      this.handleSourceAdd_, this);\n    listen(this.source_, VectorEventType.REMOVEFEATURE,\n      this.handleSourceRemove_, this);\n  } else {\n    features = options.features;\n  }\n  if (!features) {\n    throw new Error('The modify interaction requires features or a source');\n  }\n\n  /**\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @private\n   */\n  this.features_ = features;\n\n  this.features_.forEach(this.addFeature_.bind(this));\n  listen(this.features_, CollectionEventType.ADD,\n    this.handleFeatureAdd_, this);\n  listen(this.features_, CollectionEventType.REMOVE,\n    this.handleFeatureRemove_, this);\n\n  /**\n   * @type {module:ol/MapBrowserPointerEvent}\n   * @private\n   */\n  this.lastPointerEvent_ = null;\n\n};\n\ninherits(Modify, PointerInteraction);\n\n\n/**\n * The segment index assigned to a circle's center when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CENTER_INDEX = 0;\n\n/**\n * The segment index assigned to a circle's circumference when\n * breaking up a circle into ModifySegmentDataType segments.\n * @type {number}\n */\nconst CIRCLE_CIRCUMFERENCE_INDEX = 1;\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @private\n */\nModify.prototype.addFeature_ = function(feature) {\n  const geometry = feature.getGeometry();\n  if (geometry && geometry.getType() in this.SEGMENT_WRITERS_) {\n    this.SEGMENT_WRITERS_[geometry.getType()].call(this, feature, geometry);\n  }\n  const map = this.getMap();\n  if (map && map.isRendered() && this.getActive()) {\n    this.handlePointerAtPixel_(this.lastPixel_, map);\n  }\n  listen(feature, EventType.CHANGE,\n    this.handleFeatureChange_, this);\n};\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} evt Map browser event\n * @private\n */\nModify.prototype.willModifyFeatures_ = function(evt) {\n  if (!this.modified_) {\n    this.modified_ = true;\n    this.dispatchEvent(new ModifyEvent(\n      ModifyEventType.MODIFYSTART, this.features_, evt));\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @private\n */\nModify.prototype.removeFeature_ = function(feature) {\n  this.removeFeatureSegmentData_(feature);\n  // Remove the vertex feature if the collection of canditate features\n  // is empty.\n  if (this.vertexFeature_ && this.features_.getLength() === 0) {\n    this.overlay_.getSource().removeFeature(this.vertexFeature_);\n    this.vertexFeature_ = null;\n  }\n  unlisten(feature, EventType.CHANGE,\n    this.handleFeatureChange_, this);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @private\n */\nModify.prototype.removeFeatureSegmentData_ = function(feature) {\n  const rBush = this.rBush_;\n  const /** @type {Array.<module:ol/interaction/Modify~SegmentData>} */ nodesToRemove = [];\n  rBush.forEach(\n    /**\n     * @param {module:ol/interaction/Modify~SegmentData} node RTree node.\n     */\n    function(node) {\n      if (feature === node.feature) {\n        nodesToRemove.push(node);\n      }\n    });\n  for (let i = nodesToRemove.length - 1; i >= 0; --i) {\n    rBush.remove(nodesToRemove[i]);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nModify.prototype.setActive = function(active) {\n  if (this.vertexFeature_ && !active) {\n    this.overlay_.getSource().removeFeature(this.vertexFeature_);\n    this.vertexFeature_ = null;\n  }\n  PointerInteraction.prototype.setActive.call(this, active);\n};\n\n\n/**\n * @inheritDoc\n */\nModify.prototype.setMap = function(map) {\n  this.overlay_.setMap(map);\n  PointerInteraction.prototype.setMap.call(this, map);\n};\n\n\n/**\n * @param {module:ol/source/Vector~VectorSourceEvent} event Event.\n * @private\n */\nModify.prototype.handleSourceAdd_ = function(event) {\n  if (event.feature) {\n    this.features_.push(event.feature);\n  }\n};\n\n\n/**\n * @param {module:ol/source/Vector~VectorSourceEvent} event Event.\n * @private\n */\nModify.prototype.handleSourceRemove_ = function(event) {\n  if (event.feature) {\n    this.features_.remove(event.feature);\n  }\n};\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nModify.prototype.handleFeatureAdd_ = function(evt) {\n  this.addFeature_(/** @type {module:ol/Feature} */ (evt.element));\n};\n\n\n/**\n * @param {module:ol/events/Event} evt Event.\n * @private\n */\nModify.prototype.handleFeatureChange_ = function(evt) {\n  if (!this.changingFeature_) {\n    const feature = /** @type {module:ol/Feature} */ (evt.target);\n    this.removeFeature_(feature);\n    this.addFeature_(feature);\n  }\n};\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nModify.prototype.handleFeatureRemove_ = function(evt) {\n  const feature = /** @type {module:ol/Feature} */ (evt.element);\n  this.removeFeature_(feature);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/Point} geometry Geometry.\n * @private\n */\nModify.prototype.writePointGeometry_ = function(feature, geometry) {\n  const coordinates = geometry.getCoordinates();\n  const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n    feature: feature,\n    geometry: geometry,\n    segment: [coordinates, coordinates]\n  });\n  this.rBush_.insert(geometry.getExtent(), segmentData);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiPoint} geometry Geometry.\n * @private\n */\nModify.prototype.writeMultiPointGeometry_ = function(feature, geometry) {\n  const points = geometry.getCoordinates();\n  for (let i = 0, ii = points.length; i < ii; ++i) {\n    const coordinates = points[i];\n    const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n      feature: feature,\n      geometry: geometry,\n      depth: [i],\n      index: i,\n      segment: [coordinates, coordinates]\n    });\n    this.rBush_.insert(geometry.getExtent(), segmentData);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/LineString} geometry Geometry.\n * @private\n */\nModify.prototype.writeLineStringGeometry_ = function(feature, geometry) {\n  const coordinates = geometry.getCoordinates();\n  for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n    const segment = coordinates.slice(i, i + 2);\n    const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n      feature: feature,\n      geometry: geometry,\n      index: i,\n      segment: segment\n    });\n    this.rBush_.insert(boundingExtent(segment), segmentData);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiLineString} geometry Geometry.\n * @private\n */\nModify.prototype.writeMultiLineStringGeometry_ = function(feature, geometry) {\n  const lines = geometry.getCoordinates();\n  for (let j = 0, jj = lines.length; j < jj; ++j) {\n    const coordinates = lines[j];\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n      const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n        feature: feature,\n        geometry: geometry,\n        depth: [j],\n        index: i,\n        segment: segment\n      });\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/Polygon} geometry Geometry.\n * @private\n */\nModify.prototype.writePolygonGeometry_ = function(feature, geometry) {\n  const rings = geometry.getCoordinates();\n  for (let j = 0, jj = rings.length; j < jj; ++j) {\n    const coordinates = rings[j];\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n      const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n        feature: feature,\n        geometry: geometry,\n        depth: [j],\n        index: i,\n        segment: segment\n      });\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiPolygon} geometry Geometry.\n * @private\n */\nModify.prototype.writeMultiPolygonGeometry_ = function(feature, geometry) {\n  const polygons = geometry.getCoordinates();\n  for (let k = 0, kk = polygons.length; k < kk; ++k) {\n    const rings = polygons[k];\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      const coordinates = rings[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n        const segmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n          feature: feature,\n          geometry: geometry,\n          depth: [j, k],\n          index: i,\n          segment: segment\n        });\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n};\n\n\n/**\n * We convert a circle into two segments.  The segment at index\n * {@link CIRCLE_CENTER_INDEX} is the\n * circle's center (a point).  The segment at index\n * {@link CIRCLE_CIRCUMFERENCE_INDEX} is\n * the circumference, and is not a line segment.\n *\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/geom/Circle} geometry Geometry.\n * @private\n */\nModify.prototype.writeCircleGeometry_ = function(feature, geometry) {\n  const coordinates = geometry.getCenter();\n  const centerSegmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n    feature: feature,\n    geometry: geometry,\n    index: CIRCLE_CENTER_INDEX,\n    segment: [coordinates, coordinates]\n  });\n  const circumferenceSegmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n    feature: feature,\n    geometry: geometry,\n    index: CIRCLE_CIRCUMFERENCE_INDEX,\n    segment: [coordinates, coordinates]\n  });\n  const featureSegments = [centerSegmentData, circumferenceSegmentData];\n  centerSegmentData.featureSegments = circumferenceSegmentData.featureSegments = featureSegments;\n  this.rBush_.insert(createOrUpdateFromCoordinate(coordinates), centerSegmentData);\n  this.rBush_.insert(geometry.getExtent(), circumferenceSegmentData);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/GeometryCollection} geometry Geometry.\n * @private\n */\nModify.prototype.writeGeometryCollectionGeometry_ = function(feature, geometry) {\n  const geometries = geometry.getGeometriesArray();\n  for (let i = 0; i < geometries.length; ++i) {\n    this.SEGMENT_WRITERS_[geometries[i].getType()].call(this, feature, geometries[i]);\n  }\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinates Coordinates.\n * @return {module:ol/Feature} Vertex feature.\n * @private\n */\nModify.prototype.createOrUpdateVertexFeature_ = function(coordinates) {\n  let vertexFeature = this.vertexFeature_;\n  if (!vertexFeature) {\n    vertexFeature = new Feature(new Point(coordinates));\n    this.vertexFeature_ = vertexFeature;\n    this.overlay_.getSource().addFeature(vertexFeature);\n  } else {\n    const geometry = /** @type {module:ol/geom/Point} */ (vertexFeature.getGeometry());\n    geometry.setCoordinates(coordinates);\n  }\n  return vertexFeature;\n};\n\n\n/**\n * @param {module:ol/interaction/Modify~SegmentData} a The first segment data.\n * @param {module:ol/interaction/Modify~SegmentData} b The second segment data.\n * @return {number} The difference in indexes.\n */\nfunction compareIndexes(a, b) {\n  return a.index - b.index;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} evt Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/Modify}\n */\nfunction handleDownEvent(evt) {\n  if (!this.condition_(evt)) {\n    return false;\n  }\n  this.handlePointerAtPixel_(evt.pixel, evt.map);\n  const pixelCoordinate = evt.map.getCoordinateFromPixel(evt.pixel);\n  this.dragSegments_.length = 0;\n  this.modified_ = false;\n  const vertexFeature = this.vertexFeature_;\n  if (vertexFeature) {\n    const insertVertices = [];\n    const geometry = /** @type {module:ol/geom/Point} */ (vertexFeature.getGeometry());\n    const vertex = geometry.getCoordinates();\n    const vertexExtent = boundingExtent([vertex]);\n    const segmentDataMatches = this.rBush_.getInExtent(vertexExtent);\n    const componentSegments = {};\n    segmentDataMatches.sort(compareIndexes);\n    for (let i = 0, ii = segmentDataMatches.length; i < ii; ++i) {\n      const segmentDataMatch = segmentDataMatches[i];\n      const segment = segmentDataMatch.segment;\n      let uid = getUid(segmentDataMatch.feature);\n      const depth = segmentDataMatch.depth;\n      if (depth) {\n        uid += '-' + depth.join('-'); // separate feature components\n      }\n      if (!componentSegments[uid]) {\n        componentSegments[uid] = new Array(2);\n      }\n      if (segmentDataMatch.geometry.getType() === GeometryType.CIRCLE &&\n      segmentDataMatch.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n\n        const closestVertex = closestOnSegmentData(pixelCoordinate, segmentDataMatch);\n        if (coordinatesEqual(closestVertex, vertex) && !componentSegments[uid][0]) {\n          this.dragSegments_.push([segmentDataMatch, 0]);\n          componentSegments[uid][0] = segmentDataMatch;\n        }\n      } else if (coordinatesEqual(segment[0], vertex) &&\n          !componentSegments[uid][0]) {\n        this.dragSegments_.push([segmentDataMatch, 0]);\n        componentSegments[uid][0] = segmentDataMatch;\n      } else if (coordinatesEqual(segment[1], vertex) &&\n          !componentSegments[uid][1]) {\n\n        // prevent dragging closed linestrings by the connecting node\n        if ((segmentDataMatch.geometry.getType() ===\n            GeometryType.LINE_STRING ||\n            segmentDataMatch.geometry.getType() ===\n            GeometryType.MULTI_LINE_STRING) &&\n            componentSegments[uid][0] &&\n            componentSegments[uid][0].index === 0) {\n          continue;\n        }\n\n        this.dragSegments_.push([segmentDataMatch, 1]);\n        componentSegments[uid][1] = segmentDataMatch;\n      } else if (this.insertVertexCondition_(evt) && getUid(segment) in this.vertexSegments_ &&\n          (!componentSegments[uid][0] && !componentSegments[uid][1])) {\n        insertVertices.push([segmentDataMatch, vertex]);\n      }\n    }\n    if (insertVertices.length) {\n      this.willModifyFeatures_(evt);\n    }\n    for (let j = insertVertices.length - 1; j >= 0; --j) {\n      this.insertVertex_.apply(this, insertVertices[j]);\n    }\n  }\n  return !!this.vertexFeature_;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} evt Event.\n * @this {module:ol/interaction/Modify}\n */\nfunction handleDragEvent(evt) {\n  this.ignoreNextSingleClick_ = false;\n  this.willModifyFeatures_(evt);\n\n  const vertex = evt.coordinate;\n  for (let i = 0, ii = this.dragSegments_.length; i < ii; ++i) {\n    const dragSegment = this.dragSegments_[i];\n    const segmentData = dragSegment[0];\n    const depth = segmentData.depth;\n    const geometry = segmentData.geometry;\n    let coordinates;\n    const segment = segmentData.segment;\n    const index = dragSegment[1];\n\n    while (vertex.length < geometry.getStride()) {\n      vertex.push(segment[index][vertex.length]);\n    }\n\n    switch (geometry.getType()) {\n      case GeometryType.POINT:\n        coordinates = vertex;\n        segment[0] = segment[1] = vertex;\n        break;\n      case GeometryType.MULTI_POINT:\n        coordinates = geometry.getCoordinates();\n        coordinates[segmentData.index] = vertex;\n        segment[0] = segment[1] = vertex;\n        break;\n      case GeometryType.LINE_STRING:\n        coordinates = geometry.getCoordinates();\n        coordinates[segmentData.index + index] = vertex;\n        segment[index] = vertex;\n        break;\n      case GeometryType.MULTI_LINE_STRING:\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]][segmentData.index + index] = vertex;\n        segment[index] = vertex;\n        break;\n      case GeometryType.POLYGON:\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[0]][segmentData.index + index] = vertex;\n        segment[index] = vertex;\n        break;\n      case GeometryType.MULTI_POLYGON:\n        coordinates = geometry.getCoordinates();\n        coordinates[depth[1]][depth[0]][segmentData.index + index] = vertex;\n        segment[index] = vertex;\n        break;\n      case GeometryType.CIRCLE:\n        segment[0] = segment[1] = vertex;\n        if (segmentData.index === CIRCLE_CENTER_INDEX) {\n          this.changingFeature_ = true;\n          geometry.setCenter(vertex);\n          this.changingFeature_ = false;\n        } else { // We're dragging the circle's circumference:\n          this.changingFeature_ = true;\n          geometry.setRadius(coordinateDistance(geometry.getCenter(), vertex));\n          this.changingFeature_ = false;\n        }\n        break;\n      default:\n        // pass\n    }\n\n    if (coordinates) {\n      this.setGeometryCoordinates_(geometry, coordinates);\n    }\n  }\n  this.createOrUpdateVertexFeature_(vertex);\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} evt Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/Modify}\n */\nfunction handleUpEvent(evt) {\n  for (let i = this.dragSegments_.length - 1; i >= 0; --i) {\n    const segmentData = this.dragSegments_[i][0];\n    const geometry = segmentData.geometry;\n    if (geometry.getType() === GeometryType.CIRCLE) {\n      // Update a circle object in the R* bush:\n      const coordinates = geometry.getCenter();\n      const centerSegmentData = segmentData.featureSegments[0];\n      const circumferenceSegmentData = segmentData.featureSegments[1];\n      centerSegmentData.segment[0] = centerSegmentData.segment[1] = coordinates;\n      circumferenceSegmentData.segment[0] = circumferenceSegmentData.segment[1] = coordinates;\n      this.rBush_.update(createOrUpdateFromCoordinate(coordinates), centerSegmentData);\n      this.rBush_.update(geometry.getExtent(), circumferenceSegmentData);\n    } else {\n      this.rBush_.update(boundingExtent(segmentData.segment), segmentData);\n    }\n  }\n  if (this.modified_) {\n    this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND, this.features_, evt));\n    this.modified_ = false;\n  }\n  return false;\n}\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} and may modify the\n * geometry.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/Modify}\n */\nfunction handleEvent(mapBrowserEvent) {\n  if (!(mapBrowserEvent instanceof MapBrowserPointerEvent)) {\n    return true;\n  }\n  this.lastPointerEvent_ = mapBrowserEvent;\n\n  let handled;\n  if (!mapBrowserEvent.map.getView().getInteracting() &&\n      mapBrowserEvent.type == MapBrowserEventType.POINTERMOVE &&\n      !this.handlingDownUpSequence) {\n    this.handlePointerMove_(mapBrowserEvent);\n  }\n  if (this.vertexFeature_ && this.deleteCondition_(mapBrowserEvent)) {\n    if (mapBrowserEvent.type != MapBrowserEventType.SINGLECLICK || !this.ignoreNextSingleClick_) {\n      handled = this.removePoint();\n    } else {\n      handled = true;\n    }\n  }\n\n  if (mapBrowserEvent.type == MapBrowserEventType.SINGLECLICK) {\n    this.ignoreNextSingleClick_ = false;\n  }\n\n  return handlePointerEvent.call(this, mapBrowserEvent) && !handled;\n}\n\n\n/**\n * @param {module:ol/MapBrowserEvent} evt Event.\n * @private\n */\nModify.prototype.handlePointerMove_ = function(evt) {\n  this.lastPixel_ = evt.pixel;\n  this.handlePointerAtPixel_(evt.pixel, evt.map);\n};\n\n\n/**\n * @param {module:ol~Pixel} pixel Pixel\n * @param {module:ol/PluggableMap} map Map.\n * @private\n */\nModify.prototype.handlePointerAtPixel_ = function(pixel, map) {\n  const pixelCoordinate = map.getCoordinateFromPixel(pixel);\n  const sortByDistance = function(a, b) {\n    return pointDistanceToSegmentDataSquared(pixelCoordinate, a) -\n        pointDistanceToSegmentDataSquared(pixelCoordinate, b);\n  };\n\n  const box = buffer(createOrUpdateFromCoordinate(pixelCoordinate),\n    map.getView().getResolution() * this.pixelTolerance_);\n\n  const rBush = this.rBush_;\n  const nodes = rBush.getInExtent(box);\n  if (nodes.length > 0) {\n    nodes.sort(sortByDistance);\n    const node = nodes[0];\n    const closestSegment = node.segment;\n    let vertex = closestOnSegmentData(pixelCoordinate, node);\n    const vertexPixel = map.getPixelFromCoordinate(vertex);\n    let dist = coordinateDistance(pixel, vertexPixel);\n    if (dist <= this.pixelTolerance_) {\n      const vertexSegments = {};\n\n      if (node.geometry.getType() === GeometryType.CIRCLE &&\n      node.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n\n        this.snappedToVertex_ = true;\n        this.createOrUpdateVertexFeature_(vertex);\n      } else {\n        const pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n        const pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n        const squaredDist1 = squaredCoordinateDistance(vertexPixel, pixel1);\n        const squaredDist2 = squaredCoordinateDistance(vertexPixel, pixel2);\n        dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n        this.snappedToVertex_ = dist <= this.pixelTolerance_;\n        if (this.snappedToVertex_) {\n          vertex = squaredDist1 > squaredDist2 ? closestSegment[1] : closestSegment[0];\n        }\n        this.createOrUpdateVertexFeature_(vertex);\n        for (let i = 1, ii = nodes.length; i < ii; ++i) {\n          const segment = nodes[i].segment;\n          if ((coordinatesEqual(closestSegment[0], segment[0]) &&\n              coordinatesEqual(closestSegment[1], segment[1]) ||\n              (coordinatesEqual(closestSegment[0], segment[1]) &&\n              coordinatesEqual(closestSegment[1], segment[0])))) {\n            vertexSegments[getUid(segment)] = true;\n          } else {\n            break;\n          }\n        }\n      }\n\n      vertexSegments[getUid(closestSegment)] = true;\n      this.vertexSegments_ = vertexSegments;\n      return;\n    }\n  }\n  if (this.vertexFeature_) {\n    this.overlay_.getSource().removeFeature(this.vertexFeature_);\n    this.vertexFeature_ = null;\n  }\n};\n\n\n/**\n * Returns the distance from a point to a line segment.\n *\n * @param {module:ol/coordinate~Coordinate} pointCoordinates The coordinates of the point from\n *        which to calculate the distance.\n * @param {module:ol/interaction/Modify~SegmentData} segmentData The object describing the line\n *        segment we are calculating the distance to.\n * @return {number} The square of the distance between a point and a line segment.\n */\nfunction pointDistanceToSegmentDataSquared(pointCoordinates, segmentData) {\n  const geometry = segmentData.geometry;\n\n  if (geometry.getType() === GeometryType.CIRCLE) {\n    const circleGeometry = /** @type {module:ol/geom/Circle} */ (geometry);\n\n    if (segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n      const distanceToCenterSquared =\n            squaredCoordinateDistance(circleGeometry.getCenter(), pointCoordinates);\n      const distanceToCircumference =\n            Math.sqrt(distanceToCenterSquared) - circleGeometry.getRadius();\n      return distanceToCircumference * distanceToCircumference;\n    }\n  }\n  return squaredDistanceToSegment(pointCoordinates, segmentData.segment);\n}\n\n/**\n * Returns the point closest to a given line segment.\n *\n * @param {module:ol/coordinate~Coordinate} pointCoordinates The point to which a closest point\n *        should be found.\n * @param {module:ol/interaction/Modify~SegmentData} segmentData The object describing the line\n *        segment which should contain the closest point.\n * @return {module:ol/coordinate~Coordinate} The point closest to the specified line segment.\n */\nfunction closestOnSegmentData(pointCoordinates, segmentData) {\n  const geometry = segmentData.geometry;\n\n  if (geometry.getType() === GeometryType.CIRCLE &&\n  segmentData.index === CIRCLE_CIRCUMFERENCE_INDEX) {\n    return geometry.getClosestPoint(pointCoordinates);\n  }\n  return closestOnSegment(pointCoordinates, segmentData.segment);\n}\n\n\n/**\n * @param {module:ol/interaction/Modify~SegmentData} segmentData Segment data.\n * @param {module:ol/coordinate~Coordinate} vertex Vertex.\n * @private\n */\nModify.prototype.insertVertex_ = function(segmentData, vertex) {\n  const segment = segmentData.segment;\n  const feature = segmentData.feature;\n  const geometry = segmentData.geometry;\n  const depth = segmentData.depth;\n  const index = /** @type {number} */ (segmentData.index);\n  let coordinates;\n\n  while (vertex.length < geometry.getStride()) {\n    vertex.push(0);\n  }\n\n  switch (geometry.getType()) {\n    case GeometryType.MULTI_LINE_STRING:\n      coordinates = geometry.getCoordinates();\n      coordinates[depth[0]].splice(index + 1, 0, vertex);\n      break;\n    case GeometryType.POLYGON:\n      coordinates = geometry.getCoordinates();\n      coordinates[depth[0]].splice(index + 1, 0, vertex);\n      break;\n    case GeometryType.MULTI_POLYGON:\n      coordinates = geometry.getCoordinates();\n      coordinates[depth[1]][depth[0]].splice(index + 1, 0, vertex);\n      break;\n    case GeometryType.LINE_STRING:\n      coordinates = geometry.getCoordinates();\n      coordinates.splice(index + 1, 0, vertex);\n      break;\n    default:\n      return;\n  }\n\n  this.setGeometryCoordinates_(geometry, coordinates);\n  const rTree = this.rBush_;\n  rTree.remove(segmentData);\n  this.updateSegmentIndices_(geometry, index, depth, 1);\n  const newSegmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n    segment: [segment[0], vertex],\n    feature: feature,\n    geometry: geometry,\n    depth: depth,\n    index: index\n  });\n  rTree.insert(boundingExtent(newSegmentData.segment),\n    newSegmentData);\n  this.dragSegments_.push([newSegmentData, 1]);\n\n  const newSegmentData2 = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n    segment: [vertex, segment[1]],\n    feature: feature,\n    geometry: geometry,\n    depth: depth,\n    index: index + 1\n  });\n  rTree.insert(boundingExtent(newSegmentData2.segment), newSegmentData2);\n  this.dragSegments_.push([newSegmentData2, 0]);\n  this.ignoreNextSingleClick_ = true;\n};\n\n/**\n * Removes the vertex currently being pointed.\n * @return {boolean} True when a vertex was removed.\n * @api\n */\nModify.prototype.removePoint = function() {\n  if (this.lastPointerEvent_ && this.lastPointerEvent_.type != MapBrowserEventType.POINTERDRAG) {\n    const evt = this.lastPointerEvent_;\n    this.willModifyFeatures_(evt);\n    this.removeVertex_();\n    this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND, this.features_, evt));\n    this.modified_ = false;\n    return true;\n  }\n  return false;\n};\n\n/**\n * Removes a vertex from all matching features.\n * @return {boolean} True when a vertex was removed.\n * @private\n */\nModify.prototype.removeVertex_ = function() {\n  const dragSegments = this.dragSegments_;\n  const segmentsByFeature = {};\n  let deleted = false;\n  let component, coordinates, dragSegment, geometry, i, index, left;\n  let newIndex, right, segmentData, uid;\n  for (i = dragSegments.length - 1; i >= 0; --i) {\n    dragSegment = dragSegments[i];\n    segmentData = dragSegment[0];\n    uid = getUid(segmentData.feature);\n    if (segmentData.depth) {\n      // separate feature components\n      uid += '-' + segmentData.depth.join('-');\n    }\n    if (!(uid in segmentsByFeature)) {\n      segmentsByFeature[uid] = {};\n    }\n    if (dragSegment[1] === 0) {\n      segmentsByFeature[uid].right = segmentData;\n      segmentsByFeature[uid].index = segmentData.index;\n    } else if (dragSegment[1] == 1) {\n      segmentsByFeature[uid].left = segmentData;\n      segmentsByFeature[uid].index = segmentData.index + 1;\n    }\n\n  }\n  for (uid in segmentsByFeature) {\n    right = segmentsByFeature[uid].right;\n    left = segmentsByFeature[uid].left;\n    index = segmentsByFeature[uid].index;\n    newIndex = index - 1;\n    if (left !== undefined) {\n      segmentData = left;\n    } else {\n      segmentData = right;\n    }\n    if (newIndex < 0) {\n      newIndex = 0;\n    }\n    geometry = segmentData.geometry;\n    coordinates = geometry.getCoordinates();\n    component = coordinates;\n    deleted = false;\n    switch (geometry.getType()) {\n      case GeometryType.MULTI_LINE_STRING:\n        if (coordinates[segmentData.depth[0]].length > 2) {\n          coordinates[segmentData.depth[0]].splice(index, 1);\n          deleted = true;\n        }\n        break;\n      case GeometryType.LINE_STRING:\n        if (coordinates.length > 2) {\n          coordinates.splice(index, 1);\n          deleted = true;\n        }\n        break;\n      case GeometryType.MULTI_POLYGON:\n        component = component[segmentData.depth[1]];\n        /* falls through */\n      case GeometryType.POLYGON:\n        component = component[segmentData.depth[0]];\n        if (component.length > 4) {\n          if (index == component.length - 1) {\n            index = 0;\n          }\n          component.splice(index, 1);\n          deleted = true;\n          if (index === 0) {\n            // close the ring again\n            component.pop();\n            component.push(component[0]);\n            newIndex = component.length - 1;\n          }\n        }\n        break;\n      default:\n        // pass\n    }\n\n    if (deleted) {\n      this.setGeometryCoordinates_(geometry, coordinates);\n      const segments = [];\n      if (left !== undefined) {\n        this.rBush_.remove(left);\n        segments.push(left.segment[0]);\n      }\n      if (right !== undefined) {\n        this.rBush_.remove(right);\n        segments.push(right.segment[1]);\n      }\n      if (left !== undefined && right !== undefined) {\n        const newSegmentData = /** @type {module:ol/interaction/Modify~SegmentData} */ ({\n          depth: segmentData.depth,\n          feature: segmentData.feature,\n          geometry: segmentData.geometry,\n          index: newIndex,\n          segment: segments\n        });\n        this.rBush_.insert(boundingExtent(newSegmentData.segment),\n          newSegmentData);\n      }\n      this.updateSegmentIndices_(geometry, index, segmentData.depth, -1);\n      if (this.vertexFeature_) {\n        this.overlay_.getSource().removeFeature(this.vertexFeature_);\n        this.vertexFeature_ = null;\n      }\n      dragSegments.length = 0;\n    }\n\n  }\n  return deleted;\n};\n\n\n/**\n * @param {module:ol/geom/SimpleGeometry} geometry Geometry.\n * @param {Array} coordinates Coordinates.\n * @private\n */\nModify.prototype.setGeometryCoordinates_ = function(geometry, coordinates) {\n  this.changingFeature_ = true;\n  geometry.setCoordinates(coordinates);\n  this.changingFeature_ = false;\n};\n\n\n/**\n * @param {module:ol/geom/SimpleGeometry} geometry Geometry.\n * @param {number} index Index.\n * @param {Array.<number>|undefined} depth Depth.\n * @param {number} delta Delta (1 or -1).\n * @private\n */\nModify.prototype.updateSegmentIndices_ = function(\n  geometry, index, depth, delta) {\n  this.rBush_.forEachInExtent(geometry.getExtent(), function(segmentDataMatch) {\n    if (segmentDataMatch.geometry === geometry &&\n        (depth === undefined || segmentDataMatch.depth === undefined ||\n        equals(segmentDataMatch.depth, depth)) &&\n        segmentDataMatch.index > index) {\n      segmentDataMatch.index += delta;\n    }\n  });\n};\n\n\n/**\n * @return {module:ol/style/Style~StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const style = createEditingStyle();\n  return function(feature, resolution) {\n    return style[GeometryType.POINT];\n  };\n}\n\n\nexport default Modify;\n","/**\n * @module ol/interaction/Select\n */\nimport {getUid, inherits} from '../util.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport {extend, includes} from '../array.js';\nimport {listen} from '../events.js';\nimport Event from '../events/Event.js';\nimport {singleClick, never, shiftKeyOnly, pointerMove} from '../events/condition.js';\nimport {TRUE} from '../functions.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport Interaction from '../interaction/Interaction.js';\nimport VectorLayer from '../layer/Vector.js';\nimport {clear} from '../obj.js';\nimport VectorSource from '../source/Vector.js';\nimport {createEditingStyle} from '../style/Style.js';\n\n\n/**\n * @enum {string}\n */\nconst SelectEventType = {\n  /**\n   * Triggered when feature(s) has been (de)selected.\n   * @event SelectEvent#select\n   * @api\n   */\n  SELECT: 'select'\n};\n\n\n/**\n * A function that takes an {@link module:ol/Feature} or\n * {@link module:ol/render/Feature} and an\n * {@link module:ol/layer/Layer} and returns `true` if the feature may be\n * selected or `false` otherwise.\n * @typedef {function((module:ol/Feature|module:ol/render/Feature), module:ol/layer/Layer):\n *     boolean} FilterFunction\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [addCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default, this is {@link module:ol/events/condition~never}. Use this if you\n * want to use different events for add and remove instead of `toggle`.\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. This is the event\n * for the selected features as a whole. By default, this is\n * {@link module:ol/events/condition~singleClick}. Clicking on a feature selects that\n * feature and removes any that were in the selection. Clicking outside any\n * feature removes all from the selection.\n * See `toggle`, `add`, `remove` options for adding/removing extra features to/\n * from the selection.\n * @property {Array.<module:ol/layer/Layer>|function(module:ol/layer/Layer): boolean} [layers]\n * A list of layers from which features should be selected. Alternatively, a\n * filter function can be provided. The function will be called for each layer\n * in the map and should return `true` for layers that you want to be\n * selectable. If the option is absent, all visible layers will be considered\n * selectable.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [style]\n * Style for the selected features. By default the default edit style is used\n * (see {@link module:ol/style}).\n * @property {module:ol/events/condition~Condition} [removeCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default, this is {@link module:ol/events/condition~never}. Use this if you\n * want to use different events for add and remove instead of `toggle`.\n * @property {module:ol/events/condition~Condition} [toggleCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. This is in addition\n * to the `condition` event. By default,\n * {@link module:ol/events/condition~shiftKeyOnly}, i.e. pressing `shift` as\n * well as the `condition` event, adds that feature to the current selection if\n * it is not currently selected, and removes it if it is. See `add` and `remove`\n * if you want to use different events instead of a toggle.\n * @property {boolean} [multi=false] A boolean that determines if the default\n * behaviour should select only single features or all (overlapping) features at\n * the clicked map position. The default of `false` means single select.\n * @property {module:ol/Collection.<module:ol/Feature>} [features]\n * Collection where the interaction will place selected features. Optional. If\n * not set the interaction will create a collection. In any case the collection\n * used by the interaction is returned by\n * {@link module:ol/interaction/Select~Select#getFeatures}.\n * @property {module:ol/interaction/Select~FilterFunction} [filter] A function\n * that takes an {@link module:ol/Feature} and an\n * {@link module:ol/layer/Layer} and returns `true` if the feature may be\n * selected or `false` otherwise.\n * @property {boolean} [wrapX=true] Wrap the world horizontally on the selection\n * overlay.\n * @property {number} [hitTolerance=0] Hit-detection tolerance. Pixels inside\n * the radius around the given position will be checked for features. This only\n * works for the canvas renderer and not for WebGL.\n */\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Select~Select} instances are instances of\n * this type.\n *\n * @param {SelectEventType} type The event type.\n * @param {Array.<module:ol/Feature>} selected Selected features.\n * @param {Array.<module:ol/Feature>} deselected Deselected features.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Associated\n *     {@link module:ol/MapBrowserEvent}.\n * @extends {module:ol/events/Event}\n * @constructor\n */\nconst SelectEvent = function(type, selected, deselected, mapBrowserEvent) {\n  Event.call(this, type);\n\n  /**\n   * Selected features array.\n   * @type {Array.<module:ol/Feature>}\n   * @api\n   */\n  this.selected = selected;\n\n  /**\n   * Deselected features array.\n   * @type {Array.<module:ol/Feature>}\n   * @api\n   */\n  this.deselected = deselected;\n\n  /**\n   * Associated {@link module:ol/MapBrowserEvent}.\n   * @type {module:ol/MapBrowserEvent}\n   * @api\n   */\n  this.mapBrowserEvent = mapBrowserEvent;\n};\n\ninherits(SelectEvent, Event);\n\n\n/**\n * @classdesc\n * Interaction for selecting vector features. By default, selected features are\n * styled differently, so this interaction can be used for visual highlighting,\n * as well as selecting features for other actions, such as modification or\n * output. There are three ways of controlling which features are selected:\n * using the browser event as defined by the `condition` and optionally the\n * `toggle`, `add`/`remove`, and `multi` options; a `layers` filter; and a\n * further feature filter using the `filter` option.\n *\n * Selected features are added to an internal unmanaged layer.\n *\n * @constructor\n * @extends {module:ol/interaction/Interaction}\n * @param {module:ol/interaction/Select~Options=} opt_options Options.\n * @fires SelectEvent\n * @api\n */\nconst Select = function(opt_options) {\n\n  Interaction.call(this, {\n    handleEvent: handleEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.condition_ = options.condition ? options.condition : singleClick;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.addCondition_ = options.addCondition ? options.addCondition : never;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.removeCondition_ = options.removeCondition ? options.removeCondition : never;\n\n  /**\n   * @private\n   * @type {module:ol/events/condition~Condition}\n   */\n  this.toggleCondition_ = options.toggleCondition ? options.toggleCondition : shiftKeyOnly;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.multi_ = options.multi ? options.multi : false;\n\n  /**\n   * @private\n   * @type {module:ol/interaction/Select~FilterFunction}\n   */\n  this.filter_ = options.filter ? options.filter : TRUE;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.hitTolerance_ = options.hitTolerance ? options.hitTolerance : 0;\n\n  const featureOverlay = new VectorLayer({\n    source: new VectorSource({\n      useSpatialIndex: false,\n      features: options.features,\n      wrapX: options.wrapX\n    }),\n    style: options.style ? options.style :\n      getDefaultStyleFunction(),\n    updateWhileAnimating: true,\n    updateWhileInteracting: true\n  });\n\n  /**\n   * @private\n   * @type {module:ol/layer/Vector}\n   */\n  this.featureOverlay_ = featureOverlay;\n\n  /** @type {function(module:ol/layer/Layer): boolean} */\n  let layerFilter;\n  if (options.layers) {\n    if (typeof options.layers === 'function') {\n      layerFilter = options.layers;\n    } else {\n      const layers = options.layers;\n      layerFilter = function(layer) {\n        return includes(layers, layer);\n      };\n    }\n  } else {\n    layerFilter = TRUE;\n  }\n\n  /**\n   * @private\n   * @type {function(module:ol/layer/Layer): boolean}\n   */\n  this.layerFilter_ = layerFilter;\n\n  /**\n   * An association between selected feature (key)\n   * and layer (value)\n   * @private\n   * @type {Object.<number, module:ol/layer/Layer>}\n   */\n  this.featureLayerAssociation_ = {};\n\n  const features = this.featureOverlay_.getSource().getFeaturesCollection();\n  listen(features, CollectionEventType.ADD,\n    this.addFeature_, this);\n  listen(features, CollectionEventType.REMOVE,\n    this.removeFeature_, this);\n\n};\n\ninherits(Select, Interaction);\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {module:ol/layer/Layer} layer Layer.\n * @private\n */\nSelect.prototype.addFeatureLayerAssociation_ = function(feature, layer) {\n  const key = getUid(feature);\n  this.featureLayerAssociation_[key] = layer;\n};\n\n\n/**\n * Get the selected features.\n * @return {module:ol/Collection.<module:ol/Feature>} Features collection.\n * @api\n */\nSelect.prototype.getFeatures = function() {\n  return this.featureOverlay_.getSource().getFeaturesCollection();\n};\n\n\n/**\n * Returns the Hit-detection tolerance.\n * @returns {number} Hit tolerance in pixels.\n * @api\n */\nSelect.prototype.getHitTolerance = function() {\n  return this.hitTolerance_;\n};\n\n\n/**\n * Returns the associated {@link module:ol/layer/Vector~Vector vectorlayer} of\n * the (last) selected feature. Note that this will not work with any\n * programmatic method like pushing features to\n * {@link module:ol/interaction/Select~Select#getFeatures collection}.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature\n * @return {module:ol/layer/Vector} Layer.\n * @api\n */\nSelect.prototype.getLayer = function(feature) {\n  const key = getUid(feature);\n  return (\n    /** @type {module:ol/layer/Vector} */ (this.featureLayerAssociation_[key])\n  );\n};\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} and may change the\n * selected state of features.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {module:ol/interaction/Select}\n */\nfunction handleEvent(mapBrowserEvent) {\n  if (!this.condition_(mapBrowserEvent)) {\n    return true;\n  }\n  const add = this.addCondition_(mapBrowserEvent);\n  const remove = this.removeCondition_(mapBrowserEvent);\n  const toggle = this.toggleCondition_(mapBrowserEvent);\n  const set = !add && !remove && !toggle;\n  const map = mapBrowserEvent.map;\n  const features = this.featureOverlay_.getSource().getFeaturesCollection();\n  const deselected = [];\n  const selected = [];\n  if (set) {\n    // Replace the currently selected feature(s) with the feature(s) at the\n    // pixel, or clear the selected feature(s) if there is no feature at\n    // the pixel.\n    clear(this.featureLayerAssociation_);\n    map.forEachFeatureAtPixel(mapBrowserEvent.pixel,\n      (\n        /**\n         * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n         * @param {module:ol/layer/Layer} layer Layer.\n         * @return {boolean|undefined} Continue to iterate over the features.\n         */\n        function(feature, layer) {\n          if (this.filter_(feature, layer)) {\n            selected.push(feature);\n            this.addFeatureLayerAssociation_(feature, layer);\n            return !this.multi_;\n          }\n        }).bind(this), {\n        layerFilter: this.layerFilter_,\n        hitTolerance: this.hitTolerance_\n      });\n    for (let i = features.getLength() - 1; i >= 0; --i) {\n      const feature = features.item(i);\n      const index = selected.indexOf(feature);\n      if (index > -1) {\n        // feature is already selected\n        selected.splice(index, 1);\n      } else {\n        features.remove(feature);\n        deselected.push(feature);\n      }\n    }\n    if (selected.length !== 0) {\n      features.extend(selected);\n    }\n  } else {\n    // Modify the currently selected feature(s).\n    map.forEachFeatureAtPixel(mapBrowserEvent.pixel,\n      (\n        /**\n         * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n         * @param {module:ol/layer/Layer} layer Layer.\n         * @return {boolean|undefined} Continue to iterate over the features.\n         */\n        function(feature, layer) {\n          if (this.filter_(feature, layer)) {\n            if ((add || toggle) && !includes(features.getArray(), feature)) {\n              selected.push(feature);\n              this.addFeatureLayerAssociation_(feature, layer);\n            } else if ((remove || toggle) && includes(features.getArray(), feature)) {\n              deselected.push(feature);\n              this.removeFeatureLayerAssociation_(feature);\n            }\n            return !this.multi_;\n          }\n        }).bind(this), {\n        layerFilter: this.layerFilter_,\n        hitTolerance: this.hitTolerance_\n      });\n    for (let j = deselected.length - 1; j >= 0; --j) {\n      features.remove(deselected[j]);\n    }\n    features.extend(selected);\n  }\n  if (selected.length > 0 || deselected.length > 0) {\n    this.dispatchEvent(\n      new SelectEvent(SelectEventType.SELECT,\n        selected, deselected, mapBrowserEvent));\n  }\n  return pointerMove(mapBrowserEvent);\n}\n\n\n/**\n * Hit-detection tolerance. Pixels inside the radius around the given position\n * will be checked for features. This only works for the canvas renderer and\n * not for WebGL.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @api\n */\nSelect.prototype.setHitTolerance = function(hitTolerance) {\n  this.hitTolerance_ = hitTolerance;\n};\n\n\n/**\n * Remove the interaction from its current map, if any,  and attach it to a new\n * map, if any. Pass `null` to just remove the interaction from the current map.\n * @param {module:ol/PluggableMap} map Map.\n * @override\n * @api\n */\nSelect.prototype.setMap = function(map) {\n  const currentMap = this.getMap();\n  const selectedFeatures =\n      this.featureOverlay_.getSource().getFeaturesCollection();\n  if (currentMap) {\n    selectedFeatures.forEach(currentMap.unskipFeature.bind(currentMap));\n  }\n  Interaction.prototype.setMap.call(this, map);\n  this.featureOverlay_.setMap(map);\n  if (map) {\n    selectedFeatures.forEach(map.skipFeature.bind(map));\n  }\n};\n\n\n/**\n * @return {module:ol/style/Style~StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const styles = createEditingStyle();\n  extend(styles[GeometryType.POLYGON], styles[GeometryType.LINE_STRING]);\n  extend(styles[GeometryType.GEOMETRY_COLLECTION], styles[GeometryType.LINE_STRING]);\n\n  return function(feature, resolution) {\n    if (!feature.getGeometry()) {\n      return null;\n    }\n    return styles[feature.getGeometry().getType()];\n  };\n}\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nSelect.prototype.addFeature_ = function(evt) {\n  const map = this.getMap();\n  if (map) {\n    map.skipFeature(/** @type {module:ol/Feature} */ (evt.element));\n  }\n};\n\n\n/**\n * @param {module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nSelect.prototype.removeFeature_ = function(evt) {\n  const map = this.getMap();\n  if (map) {\n    map.unskipFeature(/** @type {module:ol/Feature} */ (evt.element));\n  }\n};\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @private\n */\nSelect.prototype.removeFeatureLayerAssociation_ = function(feature) {\n  const key = getUid(feature);\n  delete this.featureLayerAssociation_[key];\n};\n\n\nexport default Select;\n","/**\n * @module ol/interaction/Snap\n */\nimport {getUid, inherits} from '../util.js';\nimport {CollectionEvent} from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport {distance as coordinateDistance, squaredDistance as squaredCoordinateDistance, closestOnCircle, closestOnSegment, squaredDistanceToSegment} from '../coordinate.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {boundingExtent, createEmpty} from '../extent.js';\nimport {TRUE, FALSE} from '../functions.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport {fromCircle} from '../geom/Polygon.js';\nimport PointerInteraction, {handleEvent as handlePointerEvent} from '../interaction/Pointer.js';\nimport {getValues} from '../obj.js';\nimport {VectorSourceEvent} from '../source/Vector.js';\nimport VectorEventType from '../source/VectorEventType.js';\nimport RBush from '../structs/RBush.js';\n\n\n/**\n * @typedef {Object} Result\n * @property {boolean} snapped\n * @property {module:ol/coordinate~Coordinate|null} vertex\n * @property {module:ol~Pixel|null} vertexPixel\n */\n\n\n/**\n * @typedef {Object} SegmentData\n * @property {module:ol/Feature} feature\n * @property {Array.<module:ol/coordinate~Coordinate>} segment\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/Collection.<module:ol/Feature>} [features] Snap to these features. Either this option or source should be provided.\n * @property {boolean} [edge=true] Snap to edges.\n * @property {boolean} [vertex=true] Snap to vertices.\n * @property {number} [pixelTolerance=10] Pixel tolerance for considering the pointer close enough to a segment or\n * vertex for snapping.\n * @property {module:ol/source/Vector} [source] Snap to features from this source. Either this option or features should be provided\n */\n\n\n/**\n * @classdesc\n * Handles snapping of vector features while modifying or drawing them.  The\n * features can come from a {@link module:ol/source/Vector} or {@link module:ol/Collection~Collection}\n * Any interaction object that allows the user to interact\n * with the features using the mouse can benefit from the snapping, as long\n * as it is added before.\n *\n * The snap interaction modifies map browser event `coordinate` and `pixel`\n * properties to force the snap to occur to any interaction that them.\n *\n * Example:\n *\n *     import Snap from 'ol/interaction/Snap';\n *\n *     var snap = new Snap({\n *       source: source\n *     });\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @param {module:ol/interaction/Snap~Options=} opt_options Options.\n * @api\n */\nconst Snap = function(opt_options) {\n\n  PointerInteraction.call(this, {\n    handleEvent: handleEvent,\n    handleDownEvent: TRUE,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {module:ol/source/Vector}\n   * @private\n   */\n  this.source_ = options.source ? options.source : null;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.vertex_ = options.vertex !== undefined ? options.vertex : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.edge_ = options.edge !== undefined ? options.edge : true;\n\n  /**\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @private\n   */\n  this.features_ = options.features ? options.features : null;\n\n  /**\n   * @type {Array.<module:ol/events~EventsKey>}\n   * @private\n   */\n  this.featuresListenerKeys_ = [];\n\n  /**\n   * @type {Object.<number, module:ol/events~EventsKey>}\n   * @private\n   */\n  this.featureChangeListenerKeys_ = {};\n\n  /**\n   * Extents are preserved so indexed segment can be quickly removed\n   * when its feature geometry changes\n   * @type {Object.<number, module:ol/extent~Extent>}\n   * @private\n   */\n  this.indexedFeaturesExtents_ = {};\n\n  /**\n   * If a feature geometry changes while a pointer drag|move event occurs, the\n   * feature doesn't get updated right away.  It will be at the next 'pointerup'\n   * event fired.\n   * @type {!Object.<number, module:ol/Feature>}\n   * @private\n   */\n  this.pendingFeatures_ = {};\n\n  /**\n   * Used for distance sorting in sortByDistance_\n   * @type {module:ol/coordinate~Coordinate}\n   * @private\n   */\n  this.pixelCoordinate_ = null;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.pixelTolerance_ = options.pixelTolerance !== undefined ?\n    options.pixelTolerance : 10;\n\n  /**\n   * @type {function(module:ol/interaction/Snap~SegmentData, module:ol/interaction/Snap~SegmentData): number}\n   * @private\n   */\n  this.sortByDistance_ = sortByDistance.bind(this);\n\n\n  /**\n  * Segment RTree for each layer\n  * @type {module:ol/structs/RBush.<module:ol/interaction/Snap~SegmentData>}\n  * @private\n  */\n  this.rBush_ = new RBush();\n\n\n  /**\n  * @const\n  * @private\n  * @type {Object.<string, function(module:ol/Feature, module:ol/geom/Geometry)>}\n  */\n  this.SEGMENT_WRITERS_ = {\n    'Point': this.writePointGeometry_,\n    'LineString': this.writeLineStringGeometry_,\n    'LinearRing': this.writeLineStringGeometry_,\n    'Polygon': this.writePolygonGeometry_,\n    'MultiPoint': this.writeMultiPointGeometry_,\n    'MultiLineString': this.writeMultiLineStringGeometry_,\n    'MultiPolygon': this.writeMultiPolygonGeometry_,\n    'GeometryCollection': this.writeGeometryCollectionGeometry_,\n    'Circle': this.writeCircleGeometry_\n  };\n};\n\ninherits(Snap, PointerInteraction);\n\n\n/**\n * Add a feature to the collection of features that we may snap to.\n * @param {module:ol/Feature} feature Feature.\n * @param {boolean=} opt_listen Whether to listen to the feature change or not\n *     Defaults to `true`.\n * @api\n */\nSnap.prototype.addFeature = function(feature, opt_listen) {\n  const register = opt_listen !== undefined ? opt_listen : true;\n  const feature_uid = getUid(feature);\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    const segmentWriter = this.SEGMENT_WRITERS_[geometry.getType()];\n    if (segmentWriter) {\n      this.indexedFeaturesExtents_[feature_uid] = geometry.getExtent(createEmpty());\n      segmentWriter.call(this, feature, geometry);\n    }\n  }\n\n  if (register) {\n    this.featureChangeListenerKeys_[feature_uid] = listen(\n      feature,\n      EventType.CHANGE,\n      this.handleFeatureChange_, this);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @private\n */\nSnap.prototype.forEachFeatureAdd_ = function(feature) {\n  this.addFeature(feature);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @private\n */\nSnap.prototype.forEachFeatureRemove_ = function(feature) {\n  this.removeFeature(feature);\n};\n\n\n/**\n * @return {module:ol/Collection.<module:ol/Feature>|Array.<module:ol/Feature>} Features.\n * @private\n */\nSnap.prototype.getFeatures_ = function() {\n  let features;\n  if (this.features_) {\n    features = this.features_;\n  } else if (this.source_) {\n    features = this.source_.getFeatures();\n  }\n  return (\n    /** @type {!Array.<module:ol/Feature>|!module:ol/Collection.<module:ol/Feature>} */ (features)\n  );\n};\n\n\n/**\n * @param {module:ol/source/Vector|module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nSnap.prototype.handleFeatureAdd_ = function(evt) {\n  let feature;\n  if (evt instanceof VectorSourceEvent) {\n    feature = evt.feature;\n  } else if (evt instanceof CollectionEvent) {\n    feature = evt.element;\n  }\n  this.addFeature(/** @type {module:ol/Feature} */ (feature));\n};\n\n\n/**\n * @param {module:ol/source/Vector|module:ol/Collection~CollectionEvent} evt Event.\n * @private\n */\nSnap.prototype.handleFeatureRemove_ = function(evt) {\n  let feature;\n  if (evt instanceof VectorSourceEvent) {\n    feature = evt.feature;\n  } else if (evt instanceof CollectionEvent) {\n    feature = evt.element;\n  }\n  this.removeFeature(/** @type {module:ol/Feature} */ (feature));\n};\n\n\n/**\n * @param {module:ol/events/Event} evt Event.\n * @private\n */\nSnap.prototype.handleFeatureChange_ = function(evt) {\n  const feature = /** @type {module:ol/Feature} */ (evt.target);\n  if (this.handlingDownUpSequence) {\n    const uid = getUid(feature);\n    if (!(uid in this.pendingFeatures_)) {\n      this.pendingFeatures_[uid] = feature;\n    }\n  } else {\n    this.updateFeature_(feature);\n  }\n};\n\n\n/**\n * Remove a feature from the collection of features that we may snap to.\n * @param {module:ol/Feature} feature Feature\n * @param {boolean=} opt_unlisten Whether to unlisten to the feature change\n *     or not. Defaults to `true`.\n * @api\n */\nSnap.prototype.removeFeature = function(feature, opt_unlisten) {\n  const unregister = opt_unlisten !== undefined ? opt_unlisten : true;\n  const feature_uid = getUid(feature);\n  const extent = this.indexedFeaturesExtents_[feature_uid];\n  if (extent) {\n    const rBush = this.rBush_;\n    const nodesToRemove = [];\n    rBush.forEachInExtent(extent, function(node) {\n      if (feature === node.feature) {\n        nodesToRemove.push(node);\n      }\n    });\n    for (let i = nodesToRemove.length - 1; i >= 0; --i) {\n      rBush.remove(nodesToRemove[i]);\n    }\n  }\n\n  if (unregister) {\n    unlistenByKey(this.featureChangeListenerKeys_[feature_uid]);\n    delete this.featureChangeListenerKeys_[feature_uid];\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nSnap.prototype.setMap = function(map) {\n  const currentMap = this.getMap();\n  const keys = this.featuresListenerKeys_;\n  const features = this.getFeatures_();\n\n  if (currentMap) {\n    keys.forEach(unlistenByKey);\n    keys.length = 0;\n    features.forEach(this.forEachFeatureRemove_.bind(this));\n  }\n  PointerInteraction.prototype.setMap.call(this, map);\n\n  if (map) {\n    if (this.features_) {\n      keys.push(\n        listen(this.features_, CollectionEventType.ADD,\n          this.handleFeatureAdd_, this),\n        listen(this.features_, CollectionEventType.REMOVE,\n          this.handleFeatureRemove_, this)\n      );\n    } else if (this.source_) {\n      keys.push(\n        listen(this.source_, VectorEventType.ADDFEATURE,\n          this.handleFeatureAdd_, this),\n        listen(this.source_, VectorEventType.REMOVEFEATURE,\n          this.handleFeatureRemove_, this)\n      );\n    }\n    features.forEach(this.forEachFeatureAdd_.bind(this));\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nSnap.prototype.shouldStopEvent = FALSE;\n\n\n/**\n * @param {module:ol~Pixel} pixel Pixel\n * @param {module:ol/coordinate~Coordinate} pixelCoordinate Coordinate\n * @param {module:ol/PluggableMap} map Map.\n * @return {module:ol/interaction/Snap~Result} Snap result\n */\nSnap.prototype.snapTo = function(pixel, pixelCoordinate, map) {\n\n  const lowerLeft = map.getCoordinateFromPixel(\n    [pixel[0] - this.pixelTolerance_, pixel[1] + this.pixelTolerance_]);\n  const upperRight = map.getCoordinateFromPixel(\n    [pixel[0] + this.pixelTolerance_, pixel[1] - this.pixelTolerance_]);\n  const box = boundingExtent([lowerLeft, upperRight]);\n\n  let segments = this.rBush_.getInExtent(box);\n\n  // If snapping on vertices only, don't consider circles\n  if (this.vertex_ && !this.edge_) {\n    segments = segments.filter(function(segment) {\n      return segment.feature.getGeometry().getType() !==\n          GeometryType.CIRCLE;\n    });\n  }\n\n  let snappedToVertex = false;\n  let snapped = false;\n  let vertex = null;\n  let vertexPixel = null;\n  let dist, pixel1, pixel2, squaredDist1, squaredDist2;\n  if (segments.length > 0) {\n    this.pixelCoordinate_ = pixelCoordinate;\n    segments.sort(this.sortByDistance_);\n    const closestSegment = segments[0].segment;\n    const isCircle = segments[0].feature.getGeometry().getType() ===\n        GeometryType.CIRCLE;\n    if (this.vertex_ && !this.edge_) {\n      pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n      pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n      squaredDist1 = squaredCoordinateDistance(pixel, pixel1);\n      squaredDist2 = squaredCoordinateDistance(pixel, pixel2);\n      dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n      snappedToVertex = dist <= this.pixelTolerance_;\n      if (snappedToVertex) {\n        snapped = true;\n        vertex = squaredDist1 > squaredDist2 ? closestSegment[1] : closestSegment[0];\n        vertexPixel = map.getPixelFromCoordinate(vertex);\n      }\n    } else if (this.edge_) {\n      if (isCircle) {\n        vertex = closestOnCircle(pixelCoordinate,\n          /** @type {module:ol/geom/Circle} */ (segments[0].feature.getGeometry()));\n      } else {\n        vertex = closestOnSegment(pixelCoordinate, closestSegment);\n      }\n      vertexPixel = map.getPixelFromCoordinate(vertex);\n      if (coordinateDistance(pixel, vertexPixel) <= this.pixelTolerance_) {\n        snapped = true;\n        if (this.vertex_ && !isCircle) {\n          pixel1 = map.getPixelFromCoordinate(closestSegment[0]);\n          pixel2 = map.getPixelFromCoordinate(closestSegment[1]);\n          squaredDist1 = squaredCoordinateDistance(vertexPixel, pixel1);\n          squaredDist2 = squaredCoordinateDistance(vertexPixel, pixel2);\n          dist = Math.sqrt(Math.min(squaredDist1, squaredDist2));\n          snappedToVertex = dist <= this.pixelTolerance_;\n          if (snappedToVertex) {\n            vertex = squaredDist1 > squaredDist2 ? closestSegment[1] : closestSegment[0];\n            vertexPixel = map.getPixelFromCoordinate(vertex);\n          }\n        }\n      }\n    }\n    if (snapped) {\n      vertexPixel = [Math.round(vertexPixel[0]), Math.round(vertexPixel[1])];\n    }\n  }\n  return (\n    /** @type {module:ol/interaction/Snap~Result} */ ({\n      snapped: snapped,\n      vertex: vertex,\n      vertexPixel: vertexPixel\n    })\n  );\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @private\n */\nSnap.prototype.updateFeature_ = function(feature) {\n  this.removeFeature(feature, false);\n  this.addFeature(feature, false);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/Circle} geometry Geometry.\n * @private\n */\nSnap.prototype.writeCircleGeometry_ = function(feature, geometry) {\n  const polygon = fromCircle(geometry);\n  const coordinates = polygon.getCoordinates()[0];\n  for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n    const segment = coordinates.slice(i, i + 2);\n    const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n      feature: feature,\n      segment: segment\n    });\n    this.rBush_.insert(boundingExtent(segment), segmentData);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/GeometryCollection} geometry Geometry.\n * @private\n */\nSnap.prototype.writeGeometryCollectionGeometry_ = function(feature, geometry) {\n  const geometries = geometry.getGeometriesArray();\n  for (let i = 0; i < geometries.length; ++i) {\n    const segmentWriter = this.SEGMENT_WRITERS_[geometries[i].getType()];\n    if (segmentWriter) {\n      segmentWriter.call(this, feature, geometries[i]);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/LineString} geometry Geometry.\n * @private\n */\nSnap.prototype.writeLineStringGeometry_ = function(feature, geometry) {\n  const coordinates = geometry.getCoordinates();\n  for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n    const segment = coordinates.slice(i, i + 2);\n    const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n      feature: feature,\n      segment: segment\n    });\n    this.rBush_.insert(boundingExtent(segment), segmentData);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiLineString} geometry Geometry.\n * @private\n */\nSnap.prototype.writeMultiLineStringGeometry_ = function(feature, geometry) {\n  const lines = geometry.getCoordinates();\n  for (let j = 0, jj = lines.length; j < jj; ++j) {\n    const coordinates = lines[j];\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n      const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n        feature: feature,\n        segment: segment\n      });\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiPoint} geometry Geometry.\n * @private\n */\nSnap.prototype.writeMultiPointGeometry_ = function(feature, geometry) {\n  const points = geometry.getCoordinates();\n  for (let i = 0, ii = points.length; i < ii; ++i) {\n    const coordinates = points[i];\n    const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n      feature: feature,\n      segment: [coordinates, coordinates]\n    });\n    this.rBush_.insert(geometry.getExtent(), segmentData);\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/MultiPolygon} geometry Geometry.\n * @private\n */\nSnap.prototype.writeMultiPolygonGeometry_ = function(feature, geometry) {\n  const polygons = geometry.getCoordinates();\n  for (let k = 0, kk = polygons.length; k < kk; ++k) {\n    const rings = polygons[k];\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      const coordinates = rings[j];\n      for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n        const segment = coordinates.slice(i, i + 2);\n        const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n          feature: feature,\n          segment: segment\n        });\n        this.rBush_.insert(boundingExtent(segment), segmentData);\n      }\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/Point} geometry Geometry.\n * @private\n */\nSnap.prototype.writePointGeometry_ = function(feature, geometry) {\n  const coordinates = geometry.getCoordinates();\n  const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n    feature: feature,\n    segment: [coordinates, coordinates]\n  });\n  this.rBush_.insert(geometry.getExtent(), segmentData);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature\n * @param {module:ol/geom/Polygon} geometry Geometry.\n * @private\n */\nSnap.prototype.writePolygonGeometry_ = function(feature, geometry) {\n  const rings = geometry.getCoordinates();\n  for (let j = 0, jj = rings.length; j < jj; ++j) {\n    const coordinates = rings[j];\n    for (let i = 0, ii = coordinates.length - 1; i < ii; ++i) {\n      const segment = coordinates.slice(i, i + 2);\n      const segmentData = /** @type {module:ol/interaction/Snap~SegmentData} */ ({\n        feature: feature,\n        segment: segment\n      });\n      this.rBush_.insert(boundingExtent(segment), segmentData);\n    }\n  }\n};\n\n\n/**\n * Handle all pointer events events.\n * @param {module:ol/MapBrowserEvent} evt A move event.\n * @return {boolean} Pass the event to other interactions.\n * @this {module:ol/interaction/Snap}\n */\nexport function handleEvent(evt) {\n  const result = this.snapTo(evt.pixel, evt.coordinate, evt.map);\n  if (result.snapped) {\n    evt.coordinate = result.vertex.slice(0, 2);\n    evt.pixel = result.vertexPixel;\n  }\n  return handlePointerEvent.call(this, evt);\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} evt Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/Snap}\n */\nfunction handleUpEvent(evt) {\n  const featuresToUpdate = getValues(this.pendingFeatures_);\n  if (featuresToUpdate.length) {\n    featuresToUpdate.forEach(this.updateFeature_.bind(this));\n    this.pendingFeatures_ = {};\n  }\n  return false;\n}\n\n\n/**\n * Sort segments by distance, helper function\n * @param {module:ol/interaction/Snap~SegmentData} a The first segment data.\n * @param {module:ol/interaction/Snap~SegmentData} b The second segment data.\n * @return {number} The difference in distance.\n * @this {module:ol/interaction/Snap}\n */\nfunction sortByDistance(a, b) {\n  const deltaA = squaredDistanceToSegment(this.pixelCoordinate_, a.segment);\n  const deltaB = squaredDistanceToSegment(this.pixelCoordinate_, b.segment);\n  return deltaA - deltaB;\n}\n\nexport default Snap;\n","/**\n * @module ol/interaction/Translate\n */\nimport {inherits} from '../util.js';\nimport Collection from '../Collection.js';\nimport {getChangeEventType} from '../Object.js';\nimport {listen} from '../events.js';\nimport Event from '../events/Event.js';\nimport {TRUE} from '../functions.js';\nimport {includes} from '../array.js';\nimport PointerInteraction from '../interaction/Pointer.js';\nimport InteractionProperty from '../interaction/Property.js';\n\n\n/**\n * @enum {string}\n */\nconst TranslateEventType = {\n  /**\n   * Triggered upon feature translation start.\n   * @event TranslateEvent#translatestart\n   * @api\n   */\n  TRANSLATESTART: 'translatestart',\n  /**\n   * Triggered upon feature translation.\n   * @event TranslateEvent#translating\n   * @api\n   */\n  TRANSLATING: 'translating',\n  /**\n   * Triggered upon feature translation end.\n   * @event TranslateEvent#translateend\n   * @api\n   */\n  TRANSLATEEND: 'translateend'\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/Collection.<module:ol/Feature>} [features] Only features contained in this collection will be able to be translated. If\n * not specified, all features on the map will be able to be translated.\n * @property {Array.<module:ol/layer/Layer>|function(module:ol/layer/Layer): boolean} [layers] A list of layers from which features should be\n * translated. Alternatively, a filter function can be provided. The\n * function will be called for each layer in the map and should return\n * `true` for layers that you want to be translatable. If the option is\n * absent, all visible layers will be considered translatable.\n * @property {number} [hitTolerance=0] Hit-detection tolerance. Pixels inside the radius around the given position\n * will be checked for features. This only works for the canvas renderer and\n * not for WebGL.\n */\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Translate~Translate} instances\n * are instances of this type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {module:ol/interaction/Translate~TranslateEventType} type Type.\n * @param {module:ol/Collection.<module:ol/Feature>} features The features translated.\n * @param {module:ol/coordinate~Coordinate} coordinate The event coordinate.\n */\nexport const TranslateEvent = function(type, features, coordinate) {\n\n  Event.call(this, type);\n\n  /**\n   * The features being translated.\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @api\n   */\n  this.features = features;\n\n  /**\n   * The coordinate of the drag event.\n   * @const\n   * @type {module:ol/coordinate~Coordinate}\n   * @api\n   */\n  this.coordinate = coordinate;\n};\n\ninherits(TranslateEvent, Event);\n\n\n/**\n * @classdesc\n * Interaction for translating (moving) features.\n *\n * @constructor\n * @extends {module:ol/interaction/Pointer}\n * @fires module:ol/interaction/Translate~TranslateEvent\n * @param {module:ol/interaction/Translate~Options=} opt_options Options.\n * @api\n */\nconst Translate = function(opt_options) {\n  PointerInteraction.call(this, {\n    handleDownEvent: handleDownEvent,\n    handleDragEvent: handleDragEvent,\n    handleMoveEvent: handleMoveEvent,\n    handleUpEvent: handleUpEvent\n  });\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * The last position we translated to.\n   * @type {module:ol/coordinate~Coordinate}\n   * @private\n   */\n  this.lastCoordinate_ = null;\n\n\n  /**\n   * @type {module:ol/Collection.<module:ol/Feature>}\n   * @private\n   */\n  this.features_ = options.features !== undefined ? options.features : null;\n\n  /** @type {function(module:ol/layer/Layer): boolean} */\n  let layerFilter;\n  if (options.layers) {\n    if (typeof options.layers === 'function') {\n      layerFilter = options.layers;\n    } else {\n      const layers = options.layers;\n      layerFilter = function(layer) {\n        return includes(layers, layer);\n      };\n    }\n  } else {\n    layerFilter = TRUE;\n  }\n\n  /**\n   * @private\n   * @type {function(module:ol/layer/Layer): boolean}\n   */\n  this.layerFilter_ = layerFilter;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.hitTolerance_ = options.hitTolerance ? options.hitTolerance : 0;\n\n  /**\n   * @type {module:ol/Feature}\n   * @private\n   */\n  this.lastFeature_ = null;\n\n  listen(this,\n    getChangeEventType(InteractionProperty.ACTIVE),\n    this.handleActiveChanged_, this);\n\n};\n\ninherits(Translate, PointerInteraction);\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} event Event.\n * @return {boolean} Start drag sequence?\n * @this {module:ol/interaction/Translate}\n */\nfunction handleDownEvent(event) {\n  this.lastFeature_ = this.featuresAtPixel_(event.pixel, event.map);\n  if (!this.lastCoordinate_ && this.lastFeature_) {\n    this.lastCoordinate_ = event.coordinate;\n    handleMoveEvent.call(this, event);\n\n    const features = this.features_ || new Collection([this.lastFeature_]);\n\n    this.dispatchEvent(\n      new TranslateEvent(\n        TranslateEventType.TRANSLATESTART, features,\n        event.coordinate));\n    return true;\n  }\n  return false;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} event Event.\n * @return {boolean} Stop drag sequence?\n * @this {module:ol/interaction/Translate}\n */\nfunction handleUpEvent(event) {\n  if (this.lastCoordinate_) {\n    this.lastCoordinate_ = null;\n    handleMoveEvent.call(this, event);\n\n    const features = this.features_ || new Collection([this.lastFeature_]);\n\n    this.dispatchEvent(\n      new TranslateEvent(\n        TranslateEventType.TRANSLATEEND, features,\n        event.coordinate));\n    return true;\n  }\n  return false;\n}\n\n\n/**\n * @param {module:ol/MapBrowserPointerEvent} event Event.\n * @this {module:ol/interaction/Translate}\n */\nfunction handleDragEvent(event) {\n  if (this.lastCoordinate_) {\n    const newCoordinate = event.coordinate;\n    const deltaX = newCoordinate[0] - this.lastCoordinate_[0];\n    const deltaY = newCoordinate[1] - this.lastCoordinate_[1];\n\n    const features = this.features_ || new Collection([this.lastFeature_]);\n\n    features.forEach(function(feature) {\n      const geom = feature.getGeometry();\n      geom.translate(deltaX, deltaY);\n      feature.setGeometry(geom);\n    });\n\n    this.lastCoordinate_ = newCoordinate;\n    this.dispatchEvent(\n      new TranslateEvent(\n        TranslateEventType.TRANSLATING, features,\n        newCoordinate));\n  }\n}\n\n\n/**\n * @param {module:ol/MapBrowserEvent} event Event.\n * @this {module:ol/interaction/Translate}\n */\nfunction handleMoveEvent(event) {\n  const elem = event.map.getViewport();\n\n  // Change the cursor to grab/grabbing if hovering any of the features managed\n  // by the interaction\n  if (this.featuresAtPixel_(event.pixel, event.map)) {\n    elem.classList.remove(this.lastCoordinate_ ? 'ol-grab' : 'ol-grabbing');\n    elem.classList.add(this.lastCoordinate_ ? 'ol-grabbing' : 'ol-grab');\n  } else {\n    elem.classList.remove('ol-grab', 'ol-grabbing');\n  }\n}\n\n\n/**\n * Tests to see if the given coordinates intersects any of our selected\n * features.\n * @param {module:ol~Pixel} pixel Pixel coordinate to test for intersection.\n * @param {module:ol/PluggableMap} map Map to test the intersection on.\n * @return {module:ol/Feature} Returns the feature found at the specified pixel\n * coordinates.\n * @private\n */\nTranslate.prototype.featuresAtPixel_ = function(pixel, map) {\n  return map.forEachFeatureAtPixel(pixel,\n    function(feature) {\n      if (!this.features_ || includes(this.features_.getArray(), feature)) {\n        return feature;\n      }\n    }.bind(this), {\n      layerFilter: this.layerFilter_,\n      hitTolerance: this.hitTolerance_\n    });\n};\n\n\n/**\n * Returns the Hit-detection tolerance.\n * @returns {number} Hit tolerance in pixels.\n * @api\n */\nTranslate.prototype.getHitTolerance = function() {\n  return this.hitTolerance_;\n};\n\n\n/**\n * Hit-detection tolerance. Pixels inside the radius around the given position\n * will be checked for features. This only works for the canvas renderer and\n * not for WebGL.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @api\n */\nTranslate.prototype.setHitTolerance = function(hitTolerance) {\n  this.hitTolerance_ = hitTolerance;\n};\n\n\n/**\n * @inheritDoc\n */\nTranslate.prototype.setMap = function(map) {\n  const oldMap = this.getMap();\n  PointerInteraction.prototype.setMap.call(this, map);\n  this.updateState_(oldMap);\n};\n\n\n/**\n * @private\n */\nTranslate.prototype.handleActiveChanged_ = function() {\n  this.updateState_(null);\n};\n\n\n/**\n * @param {module:ol/PluggableMap} oldMap Old map.\n * @private\n */\nTranslate.prototype.updateState_ = function(oldMap) {\n  let map = this.getMap();\n  const active = this.getActive();\n  if (!map || !active) {\n    map = map || oldMap;\n    if (map) {\n      const elem = map.getViewport();\n      elem.classList.remove('ol-grab', 'ol-grabbing');\n    }\n  }\n};\n\n\nexport default Translate;\n","/**\n * @module ol/interaction\n */\nimport Collection from './Collection.js';\nimport Kinetic from './Kinetic.js';\nimport DoubleClickZoom from './interaction/DoubleClickZoom.js';\nimport DragPan from './interaction/DragPan.js';\nimport DragRotate from './interaction/DragRotate.js';\nimport DragZoom from './interaction/DragZoom.js';\nimport KeyboardPan from './interaction/KeyboardPan.js';\nimport KeyboardZoom from './interaction/KeyboardZoom.js';\nimport MouseWheelZoom from './interaction/MouseWheelZoom.js';\nimport PinchRotate from './interaction/PinchRotate.js';\nimport PinchZoom from './interaction/PinchZoom.js';\n\nexport {default as DoubleClickZoom} from './interaction/DoubleClickZoom.js';\nexport {default as DragAndDrop} from './interaction/DragAndDrop.js';\nexport {default as DragBox} from './interaction/DragBox.js';\nexport {default as DragPan} from './interaction/DragPan.js';\nexport {default as DragRotate} from './interaction/DragRotate.js';\nexport {default as DragRotateAndZoom} from './interaction/DragRotateAndZoom.js';\nexport {default as DragZoom} from './interaction/DragZoom.js';\nexport {default as Draw} from './interaction/Draw.js';\nexport {default as Extent} from './interaction/Extent.js';\nexport {default as Interaction} from './interaction/Interaction.js';\nexport {default as KeyboardPan} from './interaction/KeyboardPan.js';\nexport {default as KeyboardZoom} from './interaction/KeyboardZoom.js';\nexport {default as Modify} from './interaction/Modify.js';\nexport {default as MouseWheelZoom} from './interaction/MouseWheelZoom.js';\nexport {default as PinchRotate} from './interaction/PinchRotate.js';\nexport {default as PinchZoom} from './interaction/PinchZoom.js';\nexport {default as Pointer} from './interaction/Pointer.js';\nexport {default as Select} from './interaction/Select.js';\nexport {default as Snap} from './interaction/Snap.js';\nexport {default as Translate} from './interaction/Translate.js';\n\n\n/**\n * @typedef {Object} DefaultsOptions\n * @property {boolean} [altShiftDragRotate=true] Whether Alt-Shift-drag rotate is\n * desired.\n * @property {boolean} [constrainResolution=false] Zoom to the closest integer\n * zoom level after the wheel/trackpad or pinch gesture ends.\n * @property {boolean} [doubleClickZoom=true] Whether double click zoom is\n * desired.\n * @property {boolean} [keyboard=true] Whether keyboard interaction is desired.\n * @property {boolean} [mouseWheelZoom=true] Whether mousewheel zoom is desired.\n * @property {boolean} [shiftDragZoom=true] Whether Shift-drag zoom is desired.\n * @property {boolean} [dragPan=true] Whether drag pan is desired.\n * @property {boolean} [pinchRotate=true] Whether pinch rotate is desired.\n * @property {boolean} [pinchZoom=true] Whether pinch zoom is desired.\n * @property {number} [zoomDelta] Zoom level delta when using keyboard or\n * mousewheel zoom.\n * @property {number} [zoomDuration] Duration of the zoom animation in\n * milliseconds.\n */\n\n\n/**\n * Set of interactions included in maps by default. Specific interactions can be\n * excluded by setting the appropriate option to false in the constructor\n * options, but the order of the interactions is fixed.  If you want to specify\n * a different order for interactions, you will need to create your own\n * {@link module:ol/interaction/Interaction} instances and insert\n * them into a {@link module:ol/Collection} in the order you want\n * before creating your {@link module:ol/Map~Map} instance. The default set of\n * interactions, in sequence, is:\n * * {@link module:ol/interaction/DragRotate~DragRotate}\n * * {@link module:ol/interaction/DoubleClickZoom~DoubleClickZoom}\n * * {@link module:ol/interaction/DragPan~DragPan}\n * * {@link module:ol/interaction/PinchRotate~PinchRotate}\n * * {@link module:ol/interaction/PinchZoom~PinchZoom}\n * * {@link module:ol/interaction/KeyboardPan~KeyboardPan}\n * * {@link module:ol/interaction/KeyboardZoom~KeyboardZoom}\n * * {@link module:ol/interaction/MouseWheelZoom~MouseWheelZoom}\n * * {@link module:ol/interaction/DragZoom~DragZoom}\n *\n * @param {module:ol/interaction/Interaction~DefaultsOptions=} opt_options\n * Defaults options.\n * @return {module:ol/Collection.<module:ol/interaction/Interaction>}\n * A collection of interactions to be used with the {@link module:ol/Map~Map}\n * constructor's `interactions` option.\n * @api\n */\nexport function defaults(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const interactions = new Collection();\n\n  const kinetic = new Kinetic(-0.005, 0.05, 100);\n\n  const altShiftDragRotate = options.altShiftDragRotate !== undefined ?\n    options.altShiftDragRotate : true;\n  if (altShiftDragRotate) {\n    interactions.push(new DragRotate());\n  }\n\n  const doubleClickZoom = options.doubleClickZoom !== undefined ?\n    options.doubleClickZoom : true;\n  if (doubleClickZoom) {\n    interactions.push(new DoubleClickZoom({\n      delta: options.zoomDelta,\n      duration: options.zoomDuration\n    }));\n  }\n\n  const dragPan = options.dragPan !== undefined ? options.dragPan : true;\n  if (dragPan) {\n    interactions.push(new DragPan({\n      kinetic: kinetic\n    }));\n  }\n\n  const pinchRotate = options.pinchRotate !== undefined ? options.pinchRotate :\n    true;\n  if (pinchRotate) {\n    interactions.push(new PinchRotate());\n  }\n\n  const pinchZoom = options.pinchZoom !== undefined ? options.pinchZoom : true;\n  if (pinchZoom) {\n    interactions.push(new PinchZoom({\n      constrainResolution: options.constrainResolution,\n      duration: options.zoomDuration\n    }));\n  }\n\n  const keyboard = options.keyboard !== undefined ? options.keyboard : true;\n  if (keyboard) {\n    interactions.push(new KeyboardPan());\n    interactions.push(new KeyboardZoom({\n      delta: options.zoomDelta,\n      duration: options.zoomDuration\n    }));\n  }\n\n  const mouseWheelZoom = options.mouseWheelZoom !== undefined ?\n    options.mouseWheelZoom : true;\n  if (mouseWheelZoom) {\n    interactions.push(new MouseWheelZoom({\n      constrainResolution: options.constrainResolution,\n      duration: options.zoomDuration\n    }));\n  }\n\n  const shiftDragZoom = options.shiftDragZoom !== undefined ?\n    options.shiftDragZoom : true;\n  if (shiftDragZoom) {\n    interactions.push(new DragZoom({\n      duration: options.zoomDuration\n    }));\n  }\n\n  return interactions;\n\n}\n","/**\n * Default maximum allowed threshold  (in pixels) for reprojection\n * triangulation.\n * @type {number}\n */\nexport const ERROR_THRESHOLD = 0.5;\n\n/**\n * Enable automatic reprojection of raster sources. Default is `true`.\n * TODO: decide if we want to expose this as a build flag or remove it\n * @type {boolean}\n */\nexport const ENABLE_RASTER_REPROJECTION = true;\n","/**\n * @module ol/ImageCanvas\n */\nimport {inherits} from './util.js';\nimport ImageBase from './ImageBase.js';\nimport ImageState from './ImageState.js';\n\n\n/**\n * A function that is called to trigger asynchronous canvas drawing.  It is\n * called with a \"done\" callback that should be called when drawing is done.\n * If any error occurs during drawing, the \"done\" callback should be called with\n * that error.\n *\n * @typedef {function(function(Error))} Loader\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/ImageBase}\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {HTMLCanvasElement} canvas Canvas.\n * @param {module:ol/ImageCanvas~Loader=} opt_loader Optional loader function to\n *     support asynchronous canvas drawing.\n */\nconst ImageCanvas = function(extent, resolution, pixelRatio, canvas, opt_loader) {\n\n  /**\n   * Optional canvas loader function.\n   * @type {?module:ol/ImageCanvas~Loader}\n   * @private\n   */\n  this.loader_ = opt_loader !== undefined ? opt_loader : null;\n\n  const state = opt_loader !== undefined ? ImageState.IDLE : ImageState.LOADED;\n\n  ImageBase.call(this, extent, resolution, pixelRatio, state);\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = canvas;\n\n  /**\n   * @private\n   * @type {Error}\n   */\n  this.error_ = null;\n\n};\n\ninherits(ImageCanvas, ImageBase);\n\n\n/**\n * Get any error associated with asynchronous rendering.\n * @return {Error} Any error that occurred during rendering.\n */\nImageCanvas.prototype.getError = function() {\n  return this.error_;\n};\n\n\n/**\n * Handle async drawing complete.\n * @param {Error} err Any error during drawing.\n * @private\n */\nImageCanvas.prototype.handleLoad_ = function(err) {\n  if (err) {\n    this.error_ = err;\n    this.state = ImageState.ERROR;\n  } else {\n    this.state = ImageState.LOADED;\n  }\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n */\nImageCanvas.prototype.load = function() {\n  if (this.state == ImageState.IDLE) {\n    this.state = ImageState.LOADING;\n    this.changed();\n    this.loader_(this.handleLoad_.bind(this));\n  }\n};\n\n\n/**\n * @return {HTMLCanvasElement} Canvas element.\n */\nImageCanvas.prototype.getImage = function() {\n  return this.canvas_;\n};\nexport default ImageCanvas;\n","/**\n * @module ol/render/Event\n */\nimport {inherits} from '../util.js';\nimport Event from '../events/Event.js';\n\n/**\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {module:ol/render/EventType} type Type.\n * @param {module:ol/render/VectorContext=} opt_vectorContext Vector context.\n * @param {module:ol/PluggableMap~FrameState=} opt_frameState Frame state.\n * @param {?CanvasRenderingContext2D=} opt_context Context.\n * @param {?module:ol/webgl/Context=} opt_glContext WebGL Context.\n */\nconst RenderEvent = function(\n  type, opt_vectorContext, opt_frameState, opt_context,\n  opt_glContext) {\n\n  Event.call(this, type);\n\n  /**\n   * For canvas, this is an instance of {@link module:ol/render/canvas/Immediate}.\n   * @type {module:ol/render/VectorContext|undefined}\n   * @api\n   */\n  this.vectorContext = opt_vectorContext;\n\n  /**\n   * An object representing the current render frame state.\n   * @type {module:ol/PluggableMap~FrameState|undefined}\n   * @api\n   */\n  this.frameState = opt_frameState;\n\n  /**\n   * Canvas context. Only available when a Canvas renderer is used, null\n   * otherwise.\n   * @type {CanvasRenderingContext2D|null|undefined}\n   * @api\n   */\n  this.context = opt_context;\n\n  /**\n   * WebGL context. Only available when a WebGL renderer is used, null\n   * otherwise.\n   * @type {module:ol/webgl/Context|null|undefined}\n   * @api\n   */\n  this.glContext = opt_glContext;\n\n};\n\ninherits(RenderEvent, Event);\nexport default RenderEvent;\n","/**\n * @module ol/render/VectorContext\n */\n/**\n * Context for drawing geometries.  A vector context is available on render\n * events and does not need to be constructed directly.\n * @constructor\n * @abstract\n * @struct\n * @api\n */\nconst VectorContext = function() {\n};\n\n\n/**\n * Render a geometry with a custom renderer.\n *\n * @param {module:ol/geom/SimpleGeometry} geometry Geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {Function} renderer Renderer.\n */\nVectorContext.prototype.drawCustom = function(geometry, feature, renderer) {};\n\n\n/**\n * Render a geometry.\n *\n * @param {module:ol/geom/Geometry} geometry The geometry to render.\n */\nVectorContext.prototype.drawGeometry = function(geometry) {};\n\n\n/**\n * Set the rendering style.\n *\n * @param {module:ol/style/Style} style The rendering style.\n */\nVectorContext.prototype.setStyle = function(style) {};\n\n\n/**\n * @param {module:ol/geom/Circle} circleGeometry Circle geometry.\n * @param {module:ol/Feature} feature Feature.\n */\nVectorContext.prototype.drawCircle = function(circleGeometry, feature) {};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/style/Style} style Style.\n */\nVectorContext.prototype.drawFeature = function(feature, style) {};\n\n\n/**\n * @param {module:ol/geom/GeometryCollection} geometryCollectionGeometry Geometry\n *     collection.\n * @param {module:ol/Feature} feature Feature.\n */\nVectorContext.prototype.drawGeometryCollection = function(geometryCollectionGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/LineString|module:ol/render/Feature} lineStringGeometry Line string geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawLineString = function(lineStringGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/MultiLineString|module:ol/render/Feature} multiLineStringGeometry MultiLineString geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/MultiPoint|module:ol/render/Feature} multiPointGeometry MultiPoint geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawMultiPoint = function(multiPointGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/MultiPolygon} multiPolygonGeometry MultiPolygon geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/Point|module:ol/render/Feature} pointGeometry Point geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawPoint = function(pointGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/Polygon|module:ol/render/Feature} polygonGeometry Polygon geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawPolygon = function(polygonGeometry, feature) {};\n\n\n/**\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nVectorContext.prototype.drawText = function(geometry, feature) {};\n\n\n/**\n * @param {module:ol/style/Fill} fillStyle Fill style.\n * @param {module:ol/style/Stroke} strokeStyle Stroke style.\n */\nVectorContext.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {};\n\n\n/**\n * @param {module:ol/style/Image} imageStyle Image style.\n * @param {module:ol/render/canvas~DeclutterGroup=} opt_declutterGroup Declutter.\n */\nVectorContext.prototype.setImageStyle = function(imageStyle, opt_declutterGroup) {};\n\n\n/**\n * @param {module:ol/style/Text} textStyle Text style.\n * @param {module:ol/render/canvas~DeclutterGroup=} opt_declutterGroup Declutter.\n */\nVectorContext.prototype.setTextStyle = function(textStyle, opt_declutterGroup) {};\nexport default VectorContext;\n","/**\n * @module ol/render/canvas/Immediate\n */\n// FIXME test, especially polygons with holes and multipolygons\n// FIXME need to handle large thick features (where pixel size matters)\n// FIXME add offset and end to ol/geom/flat/transform~transform2D?\n\nimport {inherits} from '../../util.js';\nimport {equals} from '../../array.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {intersects} from '../../extent.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport {transformGeom2D} from '../../geom/SimpleGeometry.js';\nimport {transform2D} from '../../geom/flat/transform.js';\nimport {CANVAS_LINE_DASH} from '../../has.js';\nimport VectorContext from '../VectorContext.js';\nimport {defaultTextAlign, defaultFillStyle, defaultLineCap, defaultLineDash, defaultLineDashOffset, defaultLineJoin, defaultLineWidth, defaultMiterLimit, defaultStrokeStyle, defaultTextBaseline, defaultFont} from '../canvas.js';\nimport {create as createTransform, compose as composeTransform} from '../../transform.js';\n\n/**\n * @classdesc\n * A concrete subclass of {@link module:ol/render/VectorContext} that implements\n * direct rendering of features and geometries to an HTML5 Canvas context.\n * Instances of this class are created internally by the library and\n * provided to application code as vectorContext member of the\n * {@link module:ol/render/Event~RenderEvent} object associated with postcompose, precompose and\n * render events emitted by layers and maps.\n *\n * @constructor\n * @extends {module:ol/render/VectorContext}\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {number} viewRotation View rotation.\n * @struct\n */\nconst CanvasImmediateRenderer = function(context, pixelRatio, extent, transform, viewRotation) {\n  VectorContext.call(this);\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context_ = context;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelRatio_ = pixelRatio;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = extent;\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.transform_ = transform;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.viewRotation_ = viewRotation;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~FillState}\n   */\n  this.contextFillState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~StrokeState}\n   */\n  this.contextStrokeState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~TextState}\n   */\n  this.contextTextState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~FillState}\n   */\n  this.fillState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~StrokeState}\n   */\n  this.strokeState_ = null;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement|HTMLVideoElement|Image}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageAnchorX_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageAnchorY_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageHeight_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageOpacity_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageOriginX_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageOriginY_ = 0;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.imageRotateWithView_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageRotation_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageScale_ = 0;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.imageSnapToPixel_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.imageWidth_ = 0;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.text_ = '';\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textOffsetX_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textOffsetY_ = 0;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.textRotateWithView_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textRotation_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textScale_ = 0;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~FillState}\n   */\n  this.textFillState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~StrokeState}\n   */\n  this.textStrokeState_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~TextState}\n   */\n  this.textState_ = null;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.pixelCoordinates_ = [];\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.tmpLocalTransform_ = createTransform();\n\n};\n\ninherits(CanvasImmediateRenderer, VectorContext);\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @private\n */\nCanvasImmediateRenderer.prototype.drawImages_ = function(flatCoordinates, offset, end, stride) {\n  if (!this.image_) {\n    return;\n  }\n  const pixelCoordinates = transform2D(\n    flatCoordinates, offset, end, 2, this.transform_,\n    this.pixelCoordinates_);\n  const context = this.context_;\n  const localTransform = this.tmpLocalTransform_;\n  const alpha = context.globalAlpha;\n  if (this.imageOpacity_ != 1) {\n    context.globalAlpha = alpha * this.imageOpacity_;\n  }\n  let rotation = this.imageRotation_;\n  if (this.imageRotateWithView_) {\n    rotation += this.viewRotation_;\n  }\n  for (let i = 0, ii = pixelCoordinates.length; i < ii; i += 2) {\n    let x = pixelCoordinates[i] - this.imageAnchorX_;\n    let y = pixelCoordinates[i + 1] - this.imageAnchorY_;\n    if (this.imageSnapToPixel_) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n    if (rotation !== 0 || this.imageScale_ != 1) {\n      const centerX = x + this.imageAnchorX_;\n      const centerY = y + this.imageAnchorY_;\n      composeTransform(localTransform,\n        centerX, centerY,\n        this.imageScale_, this.imageScale_,\n        rotation,\n        -centerX, -centerY);\n      context.setTransform.apply(context, localTransform);\n    }\n    context.drawImage(this.image_, this.imageOriginX_, this.imageOriginY_,\n      this.imageWidth_, this.imageHeight_, x, y,\n      this.imageWidth_, this.imageHeight_);\n  }\n  if (rotation !== 0 || this.imageScale_ != 1) {\n    context.setTransform(1, 0, 0, 1, 0, 0);\n  }\n  if (this.imageOpacity_ != 1) {\n    context.globalAlpha = alpha;\n  }\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @private\n */\nCanvasImmediateRenderer.prototype.drawText_ = function(flatCoordinates, offset, end, stride) {\n  if (!this.textState_ || this.text_ === '') {\n    return;\n  }\n  if (this.textFillState_) {\n    this.setContextFillState_(this.textFillState_);\n  }\n  if (this.textStrokeState_) {\n    this.setContextStrokeState_(this.textStrokeState_);\n  }\n  this.setContextTextState_(this.textState_);\n  const pixelCoordinates = transform2D(\n    flatCoordinates, offset, end, stride, this.transform_,\n    this.pixelCoordinates_);\n  const context = this.context_;\n  let rotation = this.textRotation_;\n  if (this.textRotateWithView_) {\n    rotation += this.viewRotation_;\n  }\n  for (; offset < end; offset += stride) {\n    const x = pixelCoordinates[offset] + this.textOffsetX_;\n    const y = pixelCoordinates[offset + 1] + this.textOffsetY_;\n    if (rotation !== 0 || this.textScale_ != 1) {\n      const localTransform = composeTransform(this.tmpLocalTransform_,\n        x, y,\n        this.textScale_, this.textScale_,\n        rotation,\n        -x, -y);\n      context.setTransform.apply(context, localTransform);\n    }\n    if (this.textStrokeState_) {\n      context.strokeText(this.text_, x, y);\n    }\n    if (this.textFillState_) {\n      context.fillText(this.text_, x, y);\n    }\n  }\n  if (rotation !== 0 || this.textScale_ != 1) {\n    context.setTransform(1, 0, 0, 1, 0, 0);\n  }\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {boolean} close Close.\n * @private\n * @return {number} end End.\n */\nCanvasImmediateRenderer.prototype.moveToLineTo_ = function(flatCoordinates, offset, end, stride, close) {\n  const context = this.context_;\n  const pixelCoordinates = transform2D(\n    flatCoordinates, offset, end, stride, this.transform_,\n    this.pixelCoordinates_);\n  context.moveTo(pixelCoordinates[0], pixelCoordinates[1]);\n  let length = pixelCoordinates.length;\n  if (close) {\n    length -= 2;\n  }\n  for (let i = 2; i < length; i += 2) {\n    context.lineTo(pixelCoordinates[i], pixelCoordinates[i + 1]);\n  }\n  if (close) {\n    context.closePath();\n  }\n  return end;\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @private\n * @return {number} End.\n */\nCanvasImmediateRenderer.prototype.drawRings_ = function(flatCoordinates, offset, ends, stride) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    offset = this.moveToLineTo_(flatCoordinates, offset, ends[i], stride, true);\n  }\n  return offset;\n};\n\n\n/**\n * Render a circle geometry into the canvas.  Rendering is immediate and uses\n * the current fill and stroke styles.\n *\n * @param {module:ol/geom/Circle} geometry Circle geometry.\n * @override\n * @api\n */\nCanvasImmediateRenderer.prototype.drawCircle = function(geometry) {\n  if (!intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  if (this.fillState_ || this.strokeState_) {\n    if (this.fillState_) {\n      this.setContextFillState_(this.fillState_);\n    }\n    if (this.strokeState_) {\n      this.setContextStrokeState_(this.strokeState_);\n    }\n    const pixelCoordinates = transformGeom2D(\n      geometry, this.transform_, this.pixelCoordinates_);\n    const dx = pixelCoordinates[2] - pixelCoordinates[0];\n    const dy = pixelCoordinates[3] - pixelCoordinates[1];\n    const radius = Math.sqrt(dx * dx + dy * dy);\n    const context = this.context_;\n    context.beginPath();\n    context.arc(\n      pixelCoordinates[0], pixelCoordinates[1], radius, 0, 2 * Math.PI);\n    if (this.fillState_) {\n      context.fill();\n    }\n    if (this.strokeState_) {\n      context.stroke();\n    }\n  }\n  if (this.text_ !== '') {\n    this.drawText_(geometry.getCenter(), 0, 2, 2);\n  }\n};\n\n\n/**\n * Set the rendering style.  Note that since this is an immediate rendering API,\n * any `zIndex` on the provided style will be ignored.\n *\n * @param {module:ol/style/Style} style The rendering style.\n * @override\n * @api\n */\nCanvasImmediateRenderer.prototype.setStyle = function(style) {\n  this.setFillStrokeStyle(style.getFill(), style.getStroke());\n  this.setImageStyle(style.getImage());\n  this.setTextStyle(style.getText());\n};\n\n\n/**\n * Render a geometry into the canvas.  Call\n * {@link module:ol/render/canvas/Immediate#setStyle} first to set the rendering style.\n *\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry The geometry to render.\n * @override\n * @api\n */\nCanvasImmediateRenderer.prototype.drawGeometry = function(geometry) {\n  const type = geometry.getType();\n  switch (type) {\n    case GeometryType.POINT:\n      this.drawPoint(/** @type {module:ol/geom/Point} */ (geometry));\n      break;\n    case GeometryType.LINE_STRING:\n      this.drawLineString(/** @type {module:ol/geom/LineString} */ (geometry));\n      break;\n    case GeometryType.POLYGON:\n      this.drawPolygon(/** @type {module:ol/geom/Polygon} */ (geometry));\n      break;\n    case GeometryType.MULTI_POINT:\n      this.drawMultiPoint(/** @type {module:ol/geom/MultiPoint} */ (geometry));\n      break;\n    case GeometryType.MULTI_LINE_STRING:\n      this.drawMultiLineString(/** @type {module:ol/geom/MultiLineString} */ (geometry));\n      break;\n    case GeometryType.MULTI_POLYGON:\n      this.drawMultiPolygon(/** @type {module:ol/geom/MultiPolygon} */ (geometry));\n      break;\n    case GeometryType.GEOMETRY_COLLECTION:\n      this.drawGeometryCollection(/** @type {module:ol/geom/GeometryCollection} */ (geometry));\n      break;\n    case GeometryType.CIRCLE:\n      this.drawCircle(/** @type {module:ol/geom/Circle} */ (geometry));\n      break;\n    default:\n  }\n};\n\n\n/**\n * Render a feature into the canvas.  Note that any `zIndex` on the provided\n * style will be ignored - features are rendered immediately in the order that\n * this method is called.  If you need `zIndex` support, you should be using an\n * {@link module:ol/layer/Vector~VectorLayer} instead.\n *\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/style/Style} style Style.\n * @override\n * @api\n */\nCanvasImmediateRenderer.prototype.drawFeature = function(feature, style) {\n  const geometry = style.getGeometryFunction()(feature);\n  if (!geometry || !intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  this.setStyle(style);\n  this.drawGeometry(geometry);\n};\n\n\n/**\n * Render a GeometryCollection to the canvas.  Rendering is immediate and\n * uses the current styles appropriate for each geometry in the collection.\n *\n * @param {module:ol/geom/GeometryCollection} geometry Geometry collection.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawGeometryCollection = function(geometry) {\n  const geometries = geometry.getGeometriesArray();\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    this.drawGeometry(geometries[i]);\n  }\n};\n\n\n/**\n * Render a Point geometry into the canvas.  Rendering is immediate and uses\n * the current style.\n *\n * @param {module:ol/geom/Point|module:ol/render/Feature} geometry Point geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawPoint = function(geometry) {\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  if (this.image_) {\n    this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n  if (this.text_ !== '') {\n    this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n};\n\n\n/**\n * Render a MultiPoint geometry  into the canvas.  Rendering is immediate and\n * uses the current style.\n *\n * @param {module:ol/geom/MultiPoint|module:ol/render/Feature} geometry MultiPoint geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawMultiPoint = function(geometry) {\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  if (this.image_) {\n    this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n  if (this.text_ !== '') {\n    this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n};\n\n\n/**\n * Render a LineString into the canvas.  Rendering is immediate and uses\n * the current style.\n *\n * @param {module:ol/geom/LineString|module:ol/render/Feature} geometry LineString geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawLineString = function(geometry) {\n  if (!intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  if (this.strokeState_) {\n    this.setContextStrokeState_(this.strokeState_);\n    const context = this.context_;\n    const flatCoordinates = geometry.getFlatCoordinates();\n    context.beginPath();\n    this.moveToLineTo_(flatCoordinates, 0, flatCoordinates.length,\n      geometry.getStride(), false);\n    context.stroke();\n  }\n  if (this.text_ !== '') {\n    const flatMidpoint = geometry.getFlatMidpoint();\n    this.drawText_(flatMidpoint, 0, 2, 2);\n  }\n};\n\n\n/**\n * Render a MultiLineString geometry into the canvas.  Rendering is immediate\n * and uses the current style.\n *\n * @param {module:ol/geom/MultiLineString|module:ol/render/Feature} geometry MultiLineString geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawMultiLineString = function(geometry) {\n  const geometryExtent = geometry.getExtent();\n  if (!intersects(this.extent_, geometryExtent)) {\n    return;\n  }\n  if (this.strokeState_) {\n    this.setContextStrokeState_(this.strokeState_);\n    const context = this.context_;\n    const flatCoordinates = geometry.getFlatCoordinates();\n    let offset = 0;\n    const ends = geometry.getEnds();\n    const stride = geometry.getStride();\n    context.beginPath();\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      offset = this.moveToLineTo_(flatCoordinates, offset, ends[i], stride, false);\n    }\n    context.stroke();\n  }\n  if (this.text_ !== '') {\n    const flatMidpoints = geometry.getFlatMidpoints();\n    this.drawText_(flatMidpoints, 0, flatMidpoints.length, 2);\n  }\n};\n\n\n/**\n * Render a Polygon geometry into the canvas.  Rendering is immediate and uses\n * the current style.\n *\n * @param {module:ol/geom/Polygon|module:ol/render/Feature} geometry Polygon geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawPolygon = function(geometry) {\n  if (!intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  if (this.strokeState_ || this.fillState_) {\n    if (this.fillState_) {\n      this.setContextFillState_(this.fillState_);\n    }\n    if (this.strokeState_) {\n      this.setContextStrokeState_(this.strokeState_);\n    }\n    const context = this.context_;\n    context.beginPath();\n    this.drawRings_(geometry.getOrientedFlatCoordinates(),\n      0, geometry.getEnds(), geometry.getStride());\n    if (this.fillState_) {\n      context.fill();\n    }\n    if (this.strokeState_) {\n      context.stroke();\n    }\n  }\n  if (this.text_ !== '') {\n    const flatInteriorPoint = geometry.getFlatInteriorPoint();\n    this.drawText_(flatInteriorPoint, 0, 2, 2);\n  }\n};\n\n\n/**\n * Render MultiPolygon geometry into the canvas.  Rendering is immediate and\n * uses the current style.\n * @param {module:ol/geom/MultiPolygon} geometry MultiPolygon geometry.\n * @override\n */\nCanvasImmediateRenderer.prototype.drawMultiPolygon = function(geometry) {\n  if (!intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  if (this.strokeState_ || this.fillState_) {\n    if (this.fillState_) {\n      this.setContextFillState_(this.fillState_);\n    }\n    if (this.strokeState_) {\n      this.setContextStrokeState_(this.strokeState_);\n    }\n    const context = this.context_;\n    const flatCoordinates = geometry.getOrientedFlatCoordinates();\n    let offset = 0;\n    const endss = geometry.getEndss();\n    const stride = geometry.getStride();\n    context.beginPath();\n    for (let i = 0, ii = endss.length; i < ii; ++i) {\n      const ends = endss[i];\n      offset = this.drawRings_(flatCoordinates, offset, ends, stride);\n    }\n    if (this.fillState_) {\n      context.fill();\n    }\n    if (this.strokeState_) {\n      context.stroke();\n    }\n  }\n  if (this.text_ !== '') {\n    const flatInteriorPoints = geometry.getFlatInteriorPoints();\n    this.drawText_(flatInteriorPoints, 0, flatInteriorPoints.length, 2);\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillState} fillState Fill state.\n * @private\n */\nCanvasImmediateRenderer.prototype.setContextFillState_ = function(fillState) {\n  const context = this.context_;\n  const contextFillState = this.contextFillState_;\n  if (!contextFillState) {\n    context.fillStyle = fillState.fillStyle;\n    this.contextFillState_ = {\n      fillStyle: fillState.fillStyle\n    };\n  } else {\n    if (contextFillState.fillStyle != fillState.fillStyle) {\n      contextFillState.fillStyle = context.fillStyle = fillState.fillStyle;\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~StrokeState} strokeState Stroke state.\n * @private\n */\nCanvasImmediateRenderer.prototype.setContextStrokeState_ = function(strokeState) {\n  const context = this.context_;\n  const contextStrokeState = this.contextStrokeState_;\n  if (!contextStrokeState) {\n    context.lineCap = strokeState.lineCap;\n    if (CANVAS_LINE_DASH) {\n      context.setLineDash(strokeState.lineDash);\n      context.lineDashOffset = strokeState.lineDashOffset;\n    }\n    context.lineJoin = strokeState.lineJoin;\n    context.lineWidth = strokeState.lineWidth;\n    context.miterLimit = strokeState.miterLimit;\n    context.strokeStyle = strokeState.strokeStyle;\n    this.contextStrokeState_ = {\n      lineCap: strokeState.lineCap,\n      lineDash: strokeState.lineDash,\n      lineDashOffset: strokeState.lineDashOffset,\n      lineJoin: strokeState.lineJoin,\n      lineWidth: strokeState.lineWidth,\n      miterLimit: strokeState.miterLimit,\n      strokeStyle: strokeState.strokeStyle\n    };\n  } else {\n    if (contextStrokeState.lineCap != strokeState.lineCap) {\n      contextStrokeState.lineCap = context.lineCap = strokeState.lineCap;\n    }\n    if (CANVAS_LINE_DASH) {\n      if (!equals(contextStrokeState.lineDash, strokeState.lineDash)) {\n        context.setLineDash(contextStrokeState.lineDash = strokeState.lineDash);\n      }\n      if (contextStrokeState.lineDashOffset != strokeState.lineDashOffset) {\n        contextStrokeState.lineDashOffset = context.lineDashOffset =\n            strokeState.lineDashOffset;\n      }\n    }\n    if (contextStrokeState.lineJoin != strokeState.lineJoin) {\n      contextStrokeState.lineJoin = context.lineJoin = strokeState.lineJoin;\n    }\n    if (contextStrokeState.lineWidth != strokeState.lineWidth) {\n      contextStrokeState.lineWidth = context.lineWidth = strokeState.lineWidth;\n    }\n    if (contextStrokeState.miterLimit != strokeState.miterLimit) {\n      contextStrokeState.miterLimit = context.miterLimit =\n          strokeState.miterLimit;\n    }\n    if (contextStrokeState.strokeStyle != strokeState.strokeStyle) {\n      contextStrokeState.strokeStyle = context.strokeStyle =\n          strokeState.strokeStyle;\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~TextState} textState Text state.\n * @private\n */\nCanvasImmediateRenderer.prototype.setContextTextState_ = function(textState) {\n  const context = this.context_;\n  const contextTextState = this.contextTextState_;\n  const textAlign = textState.textAlign ?\n    textState.textAlign : defaultTextAlign;\n  if (!contextTextState) {\n    context.font = textState.font;\n    context.textAlign = textAlign;\n    context.textBaseline = textState.textBaseline;\n    this.contextTextState_ = {\n      font: textState.font,\n      textAlign: textAlign,\n      textBaseline: textState.textBaseline\n    };\n  } else {\n    if (contextTextState.font != textState.font) {\n      contextTextState.font = context.font = textState.font;\n    }\n    if (contextTextState.textAlign != textAlign) {\n      contextTextState.textAlign = context.textAlign = textAlign;\n    }\n    if (contextTextState.textBaseline != textState.textBaseline) {\n      contextTextState.textBaseline = context.textBaseline =\n          textState.textBaseline;\n    }\n  }\n};\n\n\n/**\n * Set the fill and stroke style for subsequent draw operations.  To clear\n * either fill or stroke styles, pass null for the appropriate parameter.\n *\n * @param {module:ol/style/Fill} fillStyle Fill style.\n * @param {module:ol/style/Stroke} strokeStyle Stroke style.\n * @override\n */\nCanvasImmediateRenderer.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  if (!fillStyle) {\n    this.fillState_ = null;\n  } else {\n    const fillStyleColor = fillStyle.getColor();\n    this.fillState_ = {\n      fillStyle: asColorLike(fillStyleColor ?\n        fillStyleColor : defaultFillStyle)\n    };\n  }\n  if (!strokeStyle) {\n    this.strokeState_ = null;\n  } else {\n    const strokeStyleColor = strokeStyle.getColor();\n    const strokeStyleLineCap = strokeStyle.getLineCap();\n    const strokeStyleLineDash = strokeStyle.getLineDash();\n    const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n    const strokeStyleLineJoin = strokeStyle.getLineJoin();\n    const strokeStyleWidth = strokeStyle.getWidth();\n    const strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n    this.strokeState_ = {\n      lineCap: strokeStyleLineCap !== undefined ?\n        strokeStyleLineCap : defaultLineCap,\n      lineDash: strokeStyleLineDash ?\n        strokeStyleLineDash : defaultLineDash,\n      lineDashOffset: strokeStyleLineDashOffset ?\n        strokeStyleLineDashOffset : defaultLineDashOffset,\n      lineJoin: strokeStyleLineJoin !== undefined ?\n        strokeStyleLineJoin : defaultLineJoin,\n      lineWidth: this.pixelRatio_ * (strokeStyleWidth !== undefined ?\n        strokeStyleWidth : defaultLineWidth),\n      miterLimit: strokeStyleMiterLimit !== undefined ?\n        strokeStyleMiterLimit : defaultMiterLimit,\n      strokeStyle: asColorLike(strokeStyleColor ?\n        strokeStyleColor : defaultStrokeStyle)\n    };\n  }\n};\n\n\n/**\n * Set the image style for subsequent draw operations.  Pass null to remove\n * the image style.\n *\n * @param {module:ol/style/Image} imageStyle Image style.\n * @override\n */\nCanvasImmediateRenderer.prototype.setImageStyle = function(imageStyle) {\n  if (!imageStyle) {\n    this.image_ = null;\n  } else {\n    const imageAnchor = imageStyle.getAnchor();\n    // FIXME pixel ratio\n    const imageImage = imageStyle.getImage(1);\n    const imageOrigin = imageStyle.getOrigin();\n    const imageSize = imageStyle.getSize();\n    this.imageAnchorX_ = imageAnchor[0];\n    this.imageAnchorY_ = imageAnchor[1];\n    this.imageHeight_ = imageSize[1];\n    this.image_ = imageImage;\n    this.imageOpacity_ = imageStyle.getOpacity();\n    this.imageOriginX_ = imageOrigin[0];\n    this.imageOriginY_ = imageOrigin[1];\n    this.imageRotateWithView_ = imageStyle.getRotateWithView();\n    this.imageRotation_ = imageStyle.getRotation();\n    this.imageScale_ = imageStyle.getScale() * this.pixelRatio_;\n    this.imageSnapToPixel_ = imageStyle.getSnapToPixel();\n    this.imageWidth_ = imageSize[0];\n  }\n};\n\n\n/**\n * Set the text style for subsequent draw operations.  Pass null to\n * remove the text style.\n *\n * @param {module:ol/style/Text} textStyle Text style.\n * @override\n */\nCanvasImmediateRenderer.prototype.setTextStyle = function(textStyle) {\n  if (!textStyle) {\n    this.text_ = '';\n  } else {\n    const textFillStyle = textStyle.getFill();\n    if (!textFillStyle) {\n      this.textFillState_ = null;\n    } else {\n      const textFillStyleColor = textFillStyle.getColor();\n      this.textFillState_ = {\n        fillStyle: asColorLike(textFillStyleColor ?\n          textFillStyleColor : defaultFillStyle)\n      };\n    }\n    const textStrokeStyle = textStyle.getStroke();\n    if (!textStrokeStyle) {\n      this.textStrokeState_ = null;\n    } else {\n      const textStrokeStyleColor = textStrokeStyle.getColor();\n      const textStrokeStyleLineCap = textStrokeStyle.getLineCap();\n      const textStrokeStyleLineDash = textStrokeStyle.getLineDash();\n      const textStrokeStyleLineDashOffset = textStrokeStyle.getLineDashOffset();\n      const textStrokeStyleLineJoin = textStrokeStyle.getLineJoin();\n      const textStrokeStyleWidth = textStrokeStyle.getWidth();\n      const textStrokeStyleMiterLimit = textStrokeStyle.getMiterLimit();\n      this.textStrokeState_ = {\n        lineCap: textStrokeStyleLineCap !== undefined ?\n          textStrokeStyleLineCap : defaultLineCap,\n        lineDash: textStrokeStyleLineDash ?\n          textStrokeStyleLineDash : defaultLineDash,\n        lineDashOffset: textStrokeStyleLineDashOffset ?\n          textStrokeStyleLineDashOffset : defaultLineDashOffset,\n        lineJoin: textStrokeStyleLineJoin !== undefined ?\n          textStrokeStyleLineJoin : defaultLineJoin,\n        lineWidth: textStrokeStyleWidth !== undefined ?\n          textStrokeStyleWidth : defaultLineWidth,\n        miterLimit: textStrokeStyleMiterLimit !== undefined ?\n          textStrokeStyleMiterLimit : defaultMiterLimit,\n        strokeStyle: asColorLike(textStrokeStyleColor ?\n          textStrokeStyleColor : defaultStrokeStyle)\n      };\n    }\n    const textFont = textStyle.getFont();\n    const textOffsetX = textStyle.getOffsetX();\n    const textOffsetY = textStyle.getOffsetY();\n    const textRotateWithView = textStyle.getRotateWithView();\n    const textRotation = textStyle.getRotation();\n    const textScale = textStyle.getScale();\n    const textText = textStyle.getText();\n    const textTextAlign = textStyle.getTextAlign();\n    const textTextBaseline = textStyle.getTextBaseline();\n    this.textState_ = {\n      font: textFont !== undefined ?\n        textFont : defaultFont,\n      textAlign: textTextAlign !== undefined ?\n        textTextAlign : defaultTextAlign,\n      textBaseline: textTextBaseline !== undefined ?\n        textTextBaseline : defaultTextBaseline\n    };\n    this.text_ = textText !== undefined ? textText : '';\n    this.textOffsetX_ =\n        textOffsetX !== undefined ? (this.pixelRatio_ * textOffsetX) : 0;\n    this.textOffsetY_ =\n        textOffsetY !== undefined ? (this.pixelRatio_ * textOffsetY) : 0;\n    this.textRotateWithView_ = textRotateWithView !== undefined ? textRotateWithView : false;\n    this.textRotation_ = textRotation !== undefined ? textRotation : 0;\n    this.textScale_ = this.pixelRatio_ * (textScale !== undefined ?\n      textScale : 1);\n  }\n};\nexport default CanvasImmediateRenderer;\n","/**\n * @module ol/style/IconImageCache\n */\nimport {asString} from '../color.js';\n\n/**\n * Singleton class. Available through {@link module:ol/style/IconImageCache~shared}.\n * @constructor\n */\nconst IconImageCache = function() {\n\n  /**\n   * @type {!Object.<string, module:ol/style/IconImage>}\n   * @private\n   */\n  this.cache_ = {};\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.cacheSize_ = 0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.maxCacheSize_ = 32;\n};\n\n\n/**\n * @param {string} src Src.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/color~Color} color Color.\n * @return {string} Cache key.\n */\nfunction getKey(src, crossOrigin, color) {\n  const colorString = color ? asString(color) : 'null';\n  return crossOrigin + ':' + src + ':' + colorString;\n}\n\n\n/**\n * FIXME empty description for jsdoc\n */\nIconImageCache.prototype.clear = function() {\n  this.cache_ = {};\n  this.cacheSize_ = 0;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nIconImageCache.prototype.expire = function() {\n  if (this.cacheSize_ > this.maxCacheSize_) {\n    let i = 0;\n    for (const key in this.cache_) {\n      const iconImage = this.cache_[key];\n      if ((i++ & 3) === 0 && !iconImage.hasListener()) {\n        delete this.cache_[key];\n        --this.cacheSize_;\n      }\n    }\n  }\n};\n\n\n/**\n * @param {string} src Src.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/color~Color} color Color.\n * @return {module:ol/style/IconImage} Icon image.\n */\nIconImageCache.prototype.get = function(src, crossOrigin, color) {\n  const key = getKey(src, crossOrigin, color);\n  return key in this.cache_ ? this.cache_[key] : null;\n};\n\n\n/**\n * @param {string} src Src.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/color~Color} color Color.\n * @param {module:ol/style/IconImage} iconImage Icon image.\n */\nIconImageCache.prototype.set = function(src, crossOrigin, color, iconImage) {\n  const key = getKey(src, crossOrigin, color);\n  this.cache_[key] = iconImage;\n  ++this.cacheSize_;\n};\n\n\n/**\n * Set the cache size of the icon cache. Default is `32`. Change this value when\n * your map uses more than 32 different icon images and you are not caching icon\n * styles on the application level.\n * @param {number} maxCacheSize Cache max size.\n * @api\n */\nIconImageCache.prototype.setSize = function(maxCacheSize) {\n  this.maxCacheSize_ = maxCacheSize;\n  this.expire();\n};\nexport default IconImageCache;\n\n\n/**\n * The {@link module:ol/style/IconImageCache~IconImageCache} for\n * {@link module:ol/style/Icon~Icon} images.\n * @api\n */\nexport const shared = new IconImageCache();\n","/**\n * @module ol/renderer/Map\n */\nimport {getUid, inherits} from '../util.js';\nimport Disposable from '../Disposable.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getWidth} from '../extent.js';\nimport {TRUE, UNDEFINED} from '../functions.js';\nimport {visibleAtResolution} from '../layer/Layer.js';\nimport {shared as iconImageCache} from '../style/IconImageCache.js';\nimport {compose as composeTransform, invert as invertTransform, setFromArray as transformSetFromArray} from '../transform.js';\n\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/Disposable}\n * @param {module:ol/PluggableMap} map Map.\n * @struct\n */\nconst MapRenderer = function(map) {\n  Disposable.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/PluggableMap}\n   */\n  this.map_ = map;\n\n  /**\n   * @private\n   * @type {!Object.<string, module:ol/renderer/Layer>}\n   */\n  this.layerRenderers_ = {};\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/events~EventsKey>}\n   */\n  this.layerRendererListeners_ = {};\n\n  /**\n   * @private\n   * @type {Array.<module:ol/renderer/Layer>}\n   */\n  this.layerRendererConstructors_ = [];\n\n};\n\ninherits(MapRenderer, Disposable);\n\n\n/**\n * Register layer renderer constructors.\n * @param {Array.<module:ol/renderer/Layer>} constructors Layer renderers.\n */\nMapRenderer.prototype.registerLayerRenderers = function(constructors) {\n  this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_, constructors);\n};\n\n\n/**\n * Get the registered layer renderer constructors.\n * @return {Array.<module:ol/renderer/Layer>} Registered layer renderers.\n */\nMapRenderer.prototype.getLayerRendererConstructors = function() {\n  return this.layerRendererConstructors_;\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @protected\n */\nMapRenderer.prototype.calculateMatrices2D = function(frameState) {\n  const viewState = frameState.viewState;\n  const coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n  const pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n\n  composeTransform(coordinateToPixelTransform,\n    frameState.size[0] / 2, frameState.size[1] / 2,\n    1 / viewState.resolution, -1 / viewState.resolution,\n    -viewState.rotation,\n    -viewState.center[0], -viewState.center[1]);\n\n  invertTransform(\n    transformSetFromArray(pixelToCoordinateTransform, coordinateToPixelTransform));\n};\n\n\n/**\n * Removes all layer renderers.\n */\nMapRenderer.prototype.removeLayerRenderers = function() {\n  for (const key in this.layerRenderers_) {\n    this.removeLayerRendererByKey_(key).dispose();\n  }\n};\n\n\n/**\n * @param {module:ol/PluggableMap} map Map.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n */\nfunction expireIconCache(map, frameState) {\n  iconImageCache.expire();\n}\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, (module:ol/Feature|module:ol/render/Feature),\n *     module:ol/layer/Layer): T} callback Feature callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, module:ol/layer/Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\nMapRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg,\n  layerFilter, thisArg2) {\n  let result;\n  const viewState = frameState.viewState;\n  const viewResolution = viewState.resolution;\n\n  /**\n   * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n   * @param {module:ol/layer/Layer} layer Layer.\n   * @return {?} Callback result.\n   */\n  function forEachFeatureAtCoordinate(feature, layer) {\n    const key = getUid(feature).toString();\n    const managed = frameState.layerStates[getUid(layer)].managed;\n    if (!(key in frameState.skippedFeatureUids && !managed)) {\n      return callback.call(thisArg, feature, managed ? layer : null);\n    }\n  }\n\n  const projection = viewState.projection;\n\n  let translatedCoordinate = coordinate;\n  if (projection.canWrapX()) {\n    const projectionExtent = projection.getExtent();\n    const worldWidth = getWidth(projectionExtent);\n    const x = coordinate[0];\n    if (x < projectionExtent[0] || x > projectionExtent[2]) {\n      const worldsAway = Math.ceil((projectionExtent[0] - x) / worldWidth);\n      translatedCoordinate = [x + worldWidth * worldsAway, coordinate[1]];\n    }\n  }\n\n  const layerStates = frameState.layerStatesArray;\n  const numLayers = layerStates.length;\n  let i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    const layerState = layerStates[i];\n    const layer = layerState.layer;\n    if (visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {\n      const layerRenderer = this.getLayerRenderer(layer);\n      if (layer.getSource()) {\n        result = layerRenderer.forEachFeatureAtCoordinate(\n          layer.getSource().getWrapX() ? translatedCoordinate : coordinate,\n          frameState, hitTolerance, forEachFeatureAtCoordinate, thisArg);\n      }\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @abstract\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, module:ol/layer/Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, module:ol/layer/Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\nMapRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, hitTolerance, callback, thisArg,\n  layerFilter, thisArg2) {};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: U, module:ol/layer/Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n * @return {boolean} Is there a feature at the given coordinate?\n * @template U\n */\nMapRenderer.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  const hasFeature = this.forEachFeatureAtCoordinate(\n    coordinate, frameState, hitTolerance, TRUE, this, layerFilter, thisArg);\n\n  return hasFeature !== undefined;\n};\n\n\n/**\n * @param {module:ol/layer/Layer} layer Layer.\n * @protected\n * @return {module:ol/renderer/Layer} Layer renderer.\n */\nMapRenderer.prototype.getLayerRenderer = function(layer) {\n  const layerKey = getUid(layer).toString();\n  if (layerKey in this.layerRenderers_) {\n    return this.layerRenderers_[layerKey];\n  } else {\n    let renderer;\n    for (let i = 0, ii = this.layerRendererConstructors_.length; i < ii; ++i) {\n      const candidate = this.layerRendererConstructors_[i];\n      if (candidate['handles'](layer)) {\n        renderer = candidate['create'](this, layer);\n        break;\n      }\n    }\n    if (renderer) {\n      this.layerRenderers_[layerKey] = renderer;\n      this.layerRendererListeners_[layerKey] = listen(renderer,\n        EventType.CHANGE, this.handleLayerRendererChange_, this);\n    } else {\n      throw new Error('Unable to create renderer for layer: ' + layer.getType());\n    }\n    return renderer;\n  }\n};\n\n\n/**\n * @param {string} layerKey Layer key.\n * @protected\n * @return {module:ol/renderer/Layer} Layer renderer.\n */\nMapRenderer.prototype.getLayerRendererByKey = function(layerKey) {\n  return this.layerRenderers_[layerKey];\n};\n\n\n/**\n * @protected\n * @return {Object.<string, module:ol/renderer/Layer>} Layer renderers.\n */\nMapRenderer.prototype.getLayerRenderers = function() {\n  return this.layerRenderers_;\n};\n\n\n/**\n * @return {module:ol/PluggableMap} Map.\n */\nMapRenderer.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * Handle changes in a layer renderer.\n * @private\n */\nMapRenderer.prototype.handleLayerRendererChange_ = function() {\n  this.map_.render();\n};\n\n\n/**\n * @param {string} layerKey Layer key.\n * @return {module:ol/renderer/Layer} Layer renderer.\n * @private\n */\nMapRenderer.prototype.removeLayerRendererByKey_ = function(layerKey) {\n  const layerRenderer = this.layerRenderers_[layerKey];\n  delete this.layerRenderers_[layerKey];\n\n  unlistenByKey(this.layerRendererListeners_[layerKey]);\n  delete this.layerRendererListeners_[layerKey];\n\n  return layerRenderer;\n};\n\n\n/**\n * Render.\n * @param {?module:ol/PluggableMap~FrameState} frameState Frame state.\n */\nMapRenderer.prototype.renderFrame = UNDEFINED;\n\n\n/**\n * @param {module:ol/PluggableMap} map Map.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @private\n */\nMapRenderer.prototype.removeUnusedLayerRenderers_ = function(map, frameState) {\n  for (const layerKey in this.layerRenderers_) {\n    if (!frameState || !(layerKey in frameState.layerStates)) {\n      this.removeLayerRendererByKey_(layerKey).dispose();\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @protected\n */\nMapRenderer.prototype.scheduleExpireIconCache = function(frameState) {\n  frameState.postRenderFunctions.push(/** @type {module:ol/PluggableMap~PostRenderFunction} */ (expireIconCache));\n};\n\n\n/**\n * @param {!module:ol/PluggableMap~FrameState} frameState Frame state.\n * @protected\n */\nMapRenderer.prototype.scheduleRemoveUnusedLayerRenderers = function(frameState) {\n  for (const layerKey in this.layerRenderers_) {\n    if (!(layerKey in frameState.layerStates)) {\n      frameState.postRenderFunctions.push(\n        /** @type {module:ol/PluggableMap~PostRenderFunction} */ (this.removeUnusedLayerRenderers_.bind(this))\n      );\n      return;\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/layer/Layer~State} state1 First layer state.\n * @param {module:ol/layer/Layer~State} state2 Second layer state.\n * @return {number} The zIndex difference.\n */\nexport function sortByZIndex(state1, state2) {\n  return state1.zIndex - state2.zIndex;\n}\nexport default MapRenderer;\n","/**\n * @module ol/renderer/canvas/Map\n */\nimport {create as createTransform, apply as applyTransform, compose as composeTransform} from '../../transform.js';\nimport {inherits} from '../../util.js';\nimport {includes, stableSort} from '../../array.js';\nimport {CLASS_UNSELECTABLE} from '../../css.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {visibleAtResolution} from '../../layer/Layer.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport {rotateAtOffset} from '../../render/canvas.js';\nimport CanvasImmediateRenderer from '../../render/canvas/Immediate.js';\nimport MapRenderer, {sortByZIndex} from '../Map.js';\nimport SourceState from '../../source/State.js';\n\n\n/**\n * @type {Array.<module:ol/renderer/Layer>}\n */\nexport const layerRendererConstructors = [];\n\n\n/**\n * @constructor\n * @extends {module:ol/renderer/Map}\n * @param {module:ol/PluggableMap} map Map.\n * @api\n */\nconst CanvasMapRenderer = function(map) {\n  MapRenderer.call(this, map);\n\n  const container = map.getViewport();\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context_ = createCanvasContext2D();\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = this.context_.canvas;\n\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = true;\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.transform_ = createTransform();\n\n};\n\ninherits(CanvasMapRenderer, MapRenderer);\n\n\n/**\n * @param {module:ol/render/EventType} type Event type.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @private\n */\nCanvasMapRenderer.prototype.dispatchComposeEvent_ = function(type, frameState) {\n  const map = this.getMap();\n  const context = this.context_;\n  if (map.hasListener(type)) {\n    const extent = frameState.extent;\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const rotation = viewState.rotation;\n\n    const transform = this.getTransform(frameState);\n\n    const vectorContext = new CanvasImmediateRenderer(context, pixelRatio,\n      extent, transform, rotation);\n    const composeEvent = new RenderEvent(type, vectorContext,\n      frameState, context, null);\n    map.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @protected\n * @return {!module:ol/transform~Transform} Transform.\n */\nCanvasMapRenderer.prototype.getTransform = function(frameState) {\n  const viewState = frameState.viewState;\n  const dx1 = this.canvas_.width / 2;\n  const dy1 = this.canvas_.height / 2;\n  const sx = frameState.pixelRatio / viewState.resolution;\n  const sy = -sx;\n  const angle = -viewState.rotation;\n  const dx2 = -viewState.center[0];\n  const dy2 = -viewState.center[1];\n  return composeTransform(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasMapRenderer.prototype.renderFrame = function(frameState) {\n\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return;\n  }\n\n  const context = this.context_;\n  const pixelRatio = frameState.pixelRatio;\n  const width = Math.round(frameState.size[0] * pixelRatio);\n  const height = Math.round(frameState.size[1] * pixelRatio);\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  } else {\n    context.clearRect(0, 0, width, height);\n  }\n\n  const rotation = frameState.viewState.rotation;\n\n  this.calculateMatrices2D(frameState);\n\n  this.dispatchComposeEvent_(RenderEventType.PRECOMPOSE, frameState);\n\n  const layerStatesArray = frameState.layerStatesArray;\n  stableSort(layerStatesArray, sortByZIndex);\n\n  if (rotation) {\n    context.save();\n    rotateAtOffset(context, rotation, width / 2, height / 2);\n  }\n\n  const viewResolution = frameState.viewState.resolution;\n  let i, ii, layer, layerRenderer, layerState;\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n    layer = layerState.layer;\n    layerRenderer = /** @type {module:ol/renderer/canvas/Layer} */ (this.getLayerRenderer(layer));\n    if (!visibleAtResolution(layerState, viewResolution) ||\n        layerState.sourceState != SourceState.READY) {\n      continue;\n    }\n    if (layerRenderer.prepareFrame(frameState, layerState)) {\n      layerRenderer.composeFrame(frameState, layerState, context);\n    }\n  }\n\n  if (rotation) {\n    context.restore();\n  }\n\n  this.dispatchComposeEvent_(RenderEventType.POSTCOMPOSE, frameState);\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasMapRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, hitTolerance, callback, thisArg,\n  layerFilter, thisArg2) {\n  let result;\n  const viewState = frameState.viewState;\n  const viewResolution = viewState.resolution;\n\n  const layerStates = frameState.layerStatesArray;\n  const numLayers = layerStates.length;\n\n  const coordinate = applyTransform(\n    frameState.pixelToCoordinateTransform, pixel.slice());\n\n  let i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    const layerState = layerStates[i];\n    const layer = layerState.layer;\n    if (visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {\n      const layerRenderer = /** @type {module:ol/renderer/canvas/Layer} */ (this.getLayerRenderer(layer));\n      result = layerRenderer.forEachLayerAtCoordinate(\n        coordinate, frameState, hitTolerance, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasMapRenderer.prototype.registerLayerRenderers = function(constructors) {\n  MapRenderer.prototype.registerLayerRenderers.call(this, constructors);\n  for (let i = 0, ii = constructors.length; i < ii; ++i) {\n    const ctor = constructors[i];\n    if (!includes(layerRendererConstructors, ctor)) {\n      layerRendererConstructors.push(ctor);\n    }\n  }\n};\n\nexport default CanvasMapRenderer;\n","/**\n * @module ol/renderer/Layer\n */\nimport {getUid, inherits} from '../util.js';\nimport ImageState from '../ImageState.js';\nimport Observable from '../Observable.js';\nimport TileState from '../TileState.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {FALSE, UNDEFINED} from '../functions.js';\nimport SourceState from '../source/State.js';\n\n/**\n * @constructor\n * @extends {module:ol/Observable}\n * @param {module:ol/layer/Layer} layer Layer.\n * @struct\n */\nconst LayerRenderer = function(layer) {\n\n  Observable.call(this);\n\n  /**\n   * @private\n   * @type {module:ol/layer/Layer}\n   */\n  this.layer_ = layer;\n\n\n};\n\ninherits(LayerRenderer, Observable);\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, (module:ol/Feature|module:ol/render/Feature), module:ol/layer/Layer): T}\n *     callback Feature callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @return {T|undefined} Callback result.\n * @template S,T\n */\nLayerRenderer.prototype.forEachFeatureAtCoordinate = UNDEFINED;\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @return {boolean} Is there a feature at the given coordinate?\n */\nLayerRenderer.prototype.hasFeatureAtCoordinate = FALSE;\n\n\n/**\n * Create a function that adds loaded tiles to the tile lookup.\n * @param {module:ol/source/Tile} source Tile source.\n * @param {module:ol/proj/Projection} projection Projection of the tiles.\n * @param {Object.<number, Object.<string, module:ol/Tile>>} tiles Lookup of loaded tiles by zoom level.\n * @return {function(number, module:ol/TileRange):boolean} A function that can be\n *     called with a zoom level and a tile range to add loaded tiles to the lookup.\n * @protected\n */\nLayerRenderer.prototype.createLoadedTileFinder = function(source, projection, tiles) {\n  return (\n    /**\n     * @param {number} zoom Zoom level.\n     * @param {module:ol/TileRange} tileRange Tile range.\n     * @return {boolean} The tile range is fully loaded.\n     */\n    function(zoom, tileRange) {\n      function callback(tile) {\n        if (!tiles[zoom]) {\n          tiles[zoom] = {};\n        }\n        tiles[zoom][tile.tileCoord.toString()] = tile;\n      }\n      return source.forEachLoadedTile(projection, zoom, tileRange, callback);\n    }\n  );\n};\n\n\n/**\n * @return {module:ol/layer/Layer} Layer.\n */\nLayerRenderer.prototype.getLayer = function() {\n  return this.layer_;\n};\n\n\n/**\n * Handle changes in image state.\n * @param {module:ol/events/Event} event Image change event.\n * @private\n */\nLayerRenderer.prototype.handleImageChange_ = function(event) {\n  const image = /** @type {module:ol/Image} */ (event.target);\n  if (image.getState() === ImageState.LOADED) {\n    this.renderIfReadyAndVisible();\n  }\n};\n\n\n/**\n * Load the image if not already loaded, and register the image change\n * listener if needed.\n * @param {module:ol/ImageBase} image Image.\n * @return {boolean} `true` if the image is already loaded, `false` otherwise.\n * @protected\n */\nLayerRenderer.prototype.loadImage = function(image) {\n  let imageState = image.getState();\n  if (imageState != ImageState.LOADED && imageState != ImageState.ERROR) {\n    listen(image, EventType.CHANGE, this.handleImageChange_, this);\n  }\n  if (imageState == ImageState.IDLE) {\n    image.load();\n    imageState = image.getState();\n  }\n  return imageState == ImageState.LOADED;\n};\n\n\n/**\n * @protected\n */\nLayerRenderer.prototype.renderIfReadyAndVisible = function() {\n  const layer = this.getLayer();\n  if (layer.getVisible() && layer.getSourceState() == SourceState.READY) {\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/source/Tile} tileSource Tile source.\n * @protected\n */\nLayerRenderer.prototype.scheduleExpireCache = function(frameState, tileSource) {\n  if (tileSource.canExpireCache()) {\n    /**\n     * @param {module:ol/source/Tile} tileSource Tile source.\n     * @param {module:ol/PluggableMap} map Map.\n     * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n     */\n    const postRenderFunction = function(tileSource, map, frameState) {\n      const tileSourceKey = getUid(tileSource).toString();\n      if (tileSourceKey in frameState.usedTiles) {\n        tileSource.expireCache(frameState.viewState.projection,\n          frameState.usedTiles[tileSourceKey]);\n      }\n    }.bind(null, tileSource);\n\n    frameState.postRenderFunctions.push(\n      /** @type {module:ol/PluggableMap~PostRenderFunction} */ (postRenderFunction)\n    );\n  }\n};\n\n\n/**\n * @param {!Object.<string, !Object.<string, module:ol/TileRange>>} usedTiles Used tiles.\n * @param {module:ol/source/Tile} tileSource Tile source.\n * @param {number} z Z.\n * @param {module:ol/TileRange} tileRange Tile range.\n * @protected\n */\nLayerRenderer.prototype.updateUsedTiles = function(usedTiles, tileSource, z, tileRange) {\n  // FIXME should we use tilesToDrawByZ instead?\n  const tileSourceKey = getUid(tileSource).toString();\n  const zKey = z.toString();\n  if (tileSourceKey in usedTiles) {\n    if (zKey in usedTiles[tileSourceKey]) {\n      usedTiles[tileSourceKey][zKey].extend(tileRange);\n    } else {\n      usedTiles[tileSourceKey][zKey] = tileRange;\n    }\n  } else {\n    usedTiles[tileSourceKey] = {};\n    usedTiles[tileSourceKey][zKey] = tileRange;\n  }\n};\n\n\n/**\n * Manage tile pyramid.\n * This function performs a number of functions related to the tiles at the\n * current zoom and lower zoom levels:\n * - registers idle tiles in frameState.wantedTiles so that they are not\n *   discarded by the tile queue\n * - enqueues missing tiles\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/source/Tile} tileSource Tile source.\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} currentZ Current Z.\n * @param {number} preload Load low resolution tiles up to 'preload' levels.\n * @param {function(this: T, module:ol/Tile)=} opt_tileCallback Tile callback.\n * @param {T=} opt_this Object to use as `this` in `opt_tileCallback`.\n * @protected\n * @template T\n */\nLayerRenderer.prototype.manageTilePyramid = function(\n  frameState, tileSource, tileGrid, pixelRatio, projection, extent,\n  currentZ, preload, opt_tileCallback, opt_this) {\n  const tileSourceKey = getUid(tileSource).toString();\n  if (!(tileSourceKey in frameState.wantedTiles)) {\n    frameState.wantedTiles[tileSourceKey] = {};\n  }\n  const wantedTiles = frameState.wantedTiles[tileSourceKey];\n  const tileQueue = frameState.tileQueue;\n  const minZoom = tileGrid.getMinZoom();\n  let tile, tileRange, tileResolution, x, y, z;\n  for (z = minZoom; z <= currentZ; ++z) {\n    tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z, tileRange);\n    tileResolution = tileGrid.getResolution(z);\n    for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\n      for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\n        if (currentZ - z <= preload) {\n          tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n          if (tile.getState() == TileState.IDLE) {\n            wantedTiles[tile.getKey()] = true;\n            if (!tileQueue.isKeyQueued(tile.getKey())) {\n              tileQueue.enqueue([tile, tileSourceKey,\n                tileGrid.getTileCoordCenter(tile.tileCoord), tileResolution]);\n            }\n          }\n          if (opt_tileCallback !== undefined) {\n            opt_tileCallback.call(opt_this, tile);\n          }\n        } else {\n          tileSource.useTile(z, x, y, projection);\n        }\n      }\n    }\n  }\n};\nexport default LayerRenderer;\n","/**\n * @module ol/renderer/canvas/Layer\n */\nimport {inherits} from '../../util.js';\nimport {getBottomLeft, getBottomRight, getTopLeft, getTopRight} from '../../extent.js';\nimport {TRUE} from '../../functions.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport {rotateAtOffset} from '../../render/canvas.js';\nimport CanvasImmediateRenderer from '../../render/canvas/Immediate.js';\nimport LayerRenderer from '../Layer.js';\nimport {create as createTransform, apply as applyTransform, compose as composeTransform} from '../../transform.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/renderer/Layer}\n * @param {module:ol/layer/Layer} layer Layer.\n */\nconst CanvasLayerRenderer = function(layer) {\n\n  LayerRenderer.call(this, layer);\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.renderedResolution;\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.transform_ = createTransform();\n\n};\n\ninherits(CanvasLayerRenderer, LayerRenderer);\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/extent~Extent} extent Clip extent.\n * @protected\n */\nCanvasLayerRenderer.prototype.clip = function(context, frameState, extent) {\n  const pixelRatio = frameState.pixelRatio;\n  const width = frameState.size[0] * pixelRatio;\n  const height = frameState.size[1] * pixelRatio;\n  const rotation = frameState.viewState.rotation;\n  const topLeft = getTopLeft(/** @type {module:ol/extent~Extent} */ (extent));\n  const topRight = getTopRight(/** @type {module:ol/extent~Extent} */ (extent));\n  const bottomRight = getBottomRight(/** @type {module:ol/extent~Extent} */ (extent));\n  const bottomLeft = getBottomLeft(/** @type {module:ol/extent~Extent} */ (extent));\n\n  applyTransform(frameState.coordinateToPixelTransform, topLeft);\n  applyTransform(frameState.coordinateToPixelTransform, topRight);\n  applyTransform(frameState.coordinateToPixelTransform, bottomRight);\n  applyTransform(frameState.coordinateToPixelTransform, bottomLeft);\n\n  context.save();\n  rotateAtOffset(context, -rotation, width / 2, height / 2);\n  context.beginPath();\n  context.moveTo(topLeft[0] * pixelRatio, topLeft[1] * pixelRatio);\n  context.lineTo(topRight[0] * pixelRatio, topRight[1] * pixelRatio);\n  context.lineTo(bottomRight[0] * pixelRatio, bottomRight[1] * pixelRatio);\n  context.lineTo(bottomLeft[0] * pixelRatio, bottomLeft[1] * pixelRatio);\n  context.clip();\n  rotateAtOffset(context, rotation, width / 2, height / 2);\n};\n\n\n/**\n * @param {module:ol/render/EventType} type Event type.\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/transform~Transform=} opt_transform Transform.\n * @private\n */\nCanvasLayerRenderer.prototype.dispatchComposeEvent_ = function(type, context, frameState, opt_transform) {\n  const layer = this.getLayer();\n  if (layer.hasListener(type)) {\n    const width = frameState.size[0] * frameState.pixelRatio;\n    const height = frameState.size[1] * frameState.pixelRatio;\n    const rotation = frameState.viewState.rotation;\n    rotateAtOffset(context, -rotation, width / 2, height / 2);\n    const transform = opt_transform !== undefined ?\n      opt_transform : this.getTransform(frameState, 0);\n    const render = new CanvasImmediateRenderer(\n      context, frameState.pixelRatio, frameState.extent, transform,\n      frameState.viewState.rotation);\n    const composeEvent = new RenderEvent(type, render, frameState,\n      context, null);\n    layer.dispatchEvent(composeEvent);\n    rotateAtOffset(context, rotation, width / 2, height / 2);\n  }\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, module:ol/layer/Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\nCanvasLayerRenderer.prototype.forEachLayerAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  const hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, TRUE, this);\n\n  if (hasFeature) {\n    return callback.call(thisArg, this.getLayer(), null);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {module:ol/transform~Transform=} opt_transform Transform.\n * @protected\n */\nCanvasLayerRenderer.prototype.postCompose = function(context, frameState, layerState, opt_transform) {\n  this.dispatchComposeEvent_(RenderEventType.POSTCOMPOSE, context, frameState, opt_transform);\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/transform~Transform=} opt_transform Transform.\n * @protected\n */\nCanvasLayerRenderer.prototype.preCompose = function(context, frameState, opt_transform) {\n  this.dispatchComposeEvent_(RenderEventType.PRECOMPOSE, context, frameState, opt_transform);\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/transform~Transform=} opt_transform Transform.\n * @protected\n */\nCanvasLayerRenderer.prototype.dispatchRenderEvent = function(context, frameState, opt_transform) {\n  this.dispatchComposeEvent_(RenderEventType.RENDER, context, frameState, opt_transform);\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {number} offsetX Offset on the x-axis in view coordinates.\n * @protected\n * @return {!module:ol/transform~Transform} Transform.\n */\nCanvasLayerRenderer.prototype.getTransform = function(frameState, offsetX) {\n  const viewState = frameState.viewState;\n  const pixelRatio = frameState.pixelRatio;\n  const dx1 = pixelRatio * frameState.size[0] / 2;\n  const dy1 = pixelRatio * frameState.size[1] / 2;\n  const sx = pixelRatio / viewState.resolution;\n  const sy = -sx;\n  const angle = -viewState.rotation;\n  const dx2 = -viewState.center[0] + offsetX;\n  const dy2 = -viewState.center[1];\n  return composeTransform(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);\n};\n\n\n/**\n * @abstract\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {CanvasRenderingContext2D} context Context.\n */\nCanvasLayerRenderer.prototype.composeFrame = function(frameState, layerState, context) {};\n\n/**\n * @abstract\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @return {boolean} whether composeFrame should be called.\n */\nCanvasLayerRenderer.prototype.prepareFrame = function(frameState, layerState) {};\nexport default CanvasLayerRenderer;\n","/**\n * @module ol/renderer/canvas/IntermediateCanvas\n */\nimport {inherits} from '../../util.js';\nimport {scale as scaleCoordinate} from '../../coordinate.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {containsExtent, intersects} from '../../extent.js';\nimport {UNDEFINED} from '../../functions.js';\nimport CanvasLayerRenderer from '../canvas/Layer.js';\nimport {create as createTransform, apply as applyTransform} from '../../transform.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/renderer/canvas/Layer}\n * @param {module:ol/layer/Layer} layer Layer.\n */\nconst IntermediateCanvasRenderer = function(layer) {\n\n  CanvasLayerRenderer.call(this, layer);\n\n  /**\n   * @protected\n   * @type {module:ol/transform~Transform}\n   */\n  this.coordinateToCanvasPixelTransform = createTransform();\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.hitCanvasContext_ = null;\n\n};\n\ninherits(IntermediateCanvasRenderer, CanvasLayerRenderer);\n\n\n/**\n * @inheritDoc\n */\nIntermediateCanvasRenderer.prototype.composeFrame = function(frameState, layerState, context) {\n\n  this.preCompose(context, frameState);\n\n  const image = this.getImage();\n  if (image) {\n\n    // clipped rendering if layer extent is set\n    const extent = layerState.extent;\n    const clipped = extent !== undefined &&\n        !containsExtent(extent, frameState.extent) &&\n        intersects(extent, frameState.extent);\n    if (clipped) {\n      this.clip(context, frameState, /** @type {module:ol/extent~Extent} */ (extent));\n    }\n\n    const imageTransform = this.getImageTransform();\n    // for performance reasons, context.save / context.restore is not used\n    // to save and restore the transformation matrix and the opacity.\n    // see http://jsperf.com/context-save-restore-versus-variable\n    const alpha = context.globalAlpha;\n    context.globalAlpha = layerState.opacity;\n\n    // for performance reasons, context.setTransform is only used\n    // when the view is rotated. see http://jsperf.com/canvas-transform\n    const dx = imageTransform[4];\n    const dy = imageTransform[5];\n    const dw = image.width * imageTransform[0];\n    const dh = image.height * imageTransform[3];\n    context.drawImage(image, 0, 0, +image.width, +image.height,\n      Math.round(dx), Math.round(dy), Math.round(dw), Math.round(dh));\n    context.globalAlpha = alpha;\n\n    if (clipped) {\n      context.restore();\n    }\n  }\n\n  this.postCompose(context, frameState, layerState);\n};\n\n\n/**\n * @abstract\n * @return {HTMLCanvasElement|HTMLVideoElement|Image} Canvas.\n */\nIntermediateCanvasRenderer.prototype.getImage = function() {};\n\n\n/**\n * @abstract\n * @return {!module:ol/transform~Transform} Image transform.\n */\nIntermediateCanvasRenderer.prototype.getImageTransform = function() {};\n\n\n/**\n * @inheritDoc\n */\nIntermediateCanvasRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  const layer = this.getLayer();\n  const source = layer.getSource();\n  const resolution = frameState.viewState.resolution;\n  const rotation = frameState.viewState.rotation;\n  const skippedFeatureUids = frameState.skippedFeatureUids;\n  return source.forEachFeatureAtCoordinate(\n    coordinate, resolution, rotation, hitTolerance, skippedFeatureUids,\n    /**\n     * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n     * @return {?} Callback result.\n     */\n    function(feature) {\n      return callback.call(thisArg, feature, layer);\n    });\n};\n\n\n/**\n * @inheritDoc\n */\nIntermediateCanvasRenderer.prototype.forEachLayerAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (!this.getImage()) {\n    return undefined;\n  }\n\n  if (this.getLayer().getSource().forEachFeatureAtCoordinate !== UNDEFINED) {\n    // for ImageCanvas sources use the original hit-detection logic,\n    // so that for example also transparent polygons are detected\n    return CanvasLayerRenderer.prototype.forEachLayerAtCoordinate.apply(this, arguments);\n  } else {\n    const pixel = applyTransform(this.coordinateToCanvasPixelTransform, coordinate.slice());\n    scaleCoordinate(pixel, frameState.viewState.resolution / this.renderedResolution);\n\n    if (!this.hitCanvasContext_) {\n      this.hitCanvasContext_ = createCanvasContext2D(1, 1);\n    }\n\n    this.hitCanvasContext_.clearRect(0, 0, 1, 1);\n    this.hitCanvasContext_.drawImage(this.getImage(), pixel[0], pixel[1], 1, 1, 0, 0, 1, 1);\n\n    const imageData = this.hitCanvasContext_.getImageData(0, 0, 1, 1).data;\n    if (imageData[3] > 0) {\n      return callback.call(thisArg, this.getLayer(),  imageData);\n    } else {\n      return undefined;\n    }\n  }\n};\n\nexport default IntermediateCanvasRenderer;\n","/**\n * @module ol/renderer/canvas/ImageLayer\n */\nimport {ENABLE_RASTER_REPROJECTION} from '../../reproj/common.js';\nimport {inherits} from '../../util.js';\nimport ImageCanvas from '../../ImageCanvas.js';\nimport LayerType from '../../LayerType.js';\nimport ViewHint from '../../ViewHint.js';\nimport {equals} from '../../array.js';\nimport {getHeight, getIntersection, getWidth, isEmpty} from '../../extent.js';\nimport VectorRenderType from '../../layer/VectorRenderType.js';\nimport {assign} from '../../obj.js';\nimport {layerRendererConstructors} from './Map.js';\nimport IntermediateCanvasRenderer from '../canvas/IntermediateCanvas.js';\nimport {create as createTransform, compose as composeTransform} from '../../transform.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/canvas/IntermediateCanvas}\n * @param {module:ol/layer/Image|module:ol/layer/Vector} imageLayer Image or vector layer.\n * @api\n */\nconst CanvasImageLayerRenderer = function(imageLayer) {\n\n  IntermediateCanvasRenderer.call(this, imageLayer);\n\n  /**\n   * @private\n   * @type {?module:ol/ImageBase}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.imageTransform_ = createTransform();\n\n  /**\n   * @type {!Array.<string>}\n   */\n  this.skippedFeatures_ = [];\n\n  /**\n   * @private\n   * @type {module:ol/renderer/canvas/VectorLayer}\n   */\n  this.vectorRenderer_ = null;\n\n  if (imageLayer.getType() === LayerType.VECTOR) {\n    for (let i = 0, ii = layerRendererConstructors.length; i < ii; ++i) {\n      const ctor = layerRendererConstructors[i];\n      if (ctor !== CanvasImageLayerRenderer && ctor['handles'](imageLayer)) {\n        this.vectorRenderer_ = new ctor(imageLayer);\n        break;\n      }\n    }\n  }\n\n};\n\ninherits(CanvasImageLayerRenderer, IntermediateCanvasRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nCanvasImageLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.IMAGE ||\n    layer.getType() === LayerType.VECTOR &&\n    /** @type {module:ol/layer/Vector} */ (layer).getRenderMode() === VectorRenderType.IMAGE;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/canvas/ImageLayer} The layer renderer.\n */\nCanvasImageLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new CanvasImageLayerRenderer(/** @type {module:ol/layer/Image} */ (layer));\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageLayerRenderer.prototype.disposeInternal = function() {\n  if (this.vectorRenderer_) {\n    this.vectorRenderer_.dispose();\n  }\n  IntermediateCanvasRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageLayerRenderer.prototype.getImage = function() {\n  return !this.image_ ? null : this.image_.getImage();\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageLayerRenderer.prototype.getImageTransform = function() {\n  return this.imageTransform_;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageLayerRenderer.prototype.prepareFrame = function(frameState, layerState) {\n\n  const pixelRatio = frameState.pixelRatio;\n  const size = frameState.size;\n  const viewState = frameState.viewState;\n  const viewCenter = viewState.center;\n  const viewResolution = viewState.resolution;\n\n  let image;\n  const imageLayer = /** @type {module:ol/layer/Image} */ (this.getLayer());\n  const imageSource = imageLayer.getSource();\n\n  const hints = frameState.viewHints;\n\n  const vectorRenderer = this.vectorRenderer_;\n  let renderedExtent = frameState.extent;\n  if (!vectorRenderer && layerState.extent !== undefined) {\n    renderedExtent = getIntersection(renderedExtent, layerState.extent);\n  }\n\n  if (!hints[ViewHint.ANIMATING] && !hints[ViewHint.INTERACTING] &&\n      !isEmpty(renderedExtent)) {\n    let projection = viewState.projection;\n    if (!ENABLE_RASTER_REPROJECTION) {\n      const sourceProjection = imageSource.getProjection();\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n    }\n    let skippedFeatures = this.skippedFeatures_;\n    if (vectorRenderer) {\n      const context = vectorRenderer.context;\n      const imageFrameState = /** @type {module:ol/PluggableMap~FrameState} */ (assign({}, frameState, {\n        size: [\n          getWidth(renderedExtent) / viewResolution,\n          getHeight(renderedExtent) / viewResolution\n        ],\n        viewState: /** @type {module:ol/View~State} */ (assign({}, frameState.viewState, {\n          rotation: 0\n        }))\n      }));\n      const newSkippedFeatures = Object.keys(imageFrameState.skippedFeatureUids).sort();\n      image = new ImageCanvas(renderedExtent, viewResolution, pixelRatio, context.canvas, function(callback) {\n        if (vectorRenderer.prepareFrame(imageFrameState, layerState) &&\n            (vectorRenderer.replayGroupChanged ||\n            !equals(skippedFeatures, newSkippedFeatures))) {\n          context.canvas.width = imageFrameState.size[0] * pixelRatio;\n          context.canvas.height = imageFrameState.size[1] * pixelRatio;\n          vectorRenderer.compose(context, imageFrameState, layerState);\n          skippedFeatures = newSkippedFeatures;\n          callback();\n        }\n      });\n    } else {\n      image = imageSource.getImage(\n        renderedExtent, viewResolution, pixelRatio, projection);\n    }\n    if (image && this.loadImage(image)) {\n      this.image_ = image;\n      this.skippedFeatures_ = skippedFeatures;\n    }\n  }\n\n  if (this.image_) {\n    image = this.image_;\n    const imageExtent = image.getExtent();\n    const imageResolution = image.getResolution();\n    const imagePixelRatio = image.getPixelRatio();\n    const scale = pixelRatio * imageResolution /\n        (viewResolution * imagePixelRatio);\n    const transform = composeTransform(this.imageTransform_,\n      pixelRatio * size[0] / 2, pixelRatio * size[1] / 2,\n      scale, scale,\n      0,\n      imagePixelRatio * (imageExtent[0] - viewCenter[0]) / imageResolution,\n      imagePixelRatio * (viewCenter[1] - imageExtent[3]) / imageResolution);\n    composeTransform(this.coordinateToCanvasPixelTransform,\n      pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5],\n      pixelRatio / viewResolution, -pixelRatio / viewResolution,\n      0,\n      -viewCenter[0], -viewCenter[1]);\n\n    this.renderedResolution = imageResolution * pixelRatio / imagePixelRatio;\n  }\n\n  return !!this.image_;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageLayerRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (this.vectorRenderer_) {\n    return this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);\n  } else {\n    return IntermediateCanvasRenderer.prototype.forEachFeatureAtCoordinate.call(this, coordinate, frameState, hitTolerance, callback, thisArg);\n  }\n};\n\n\nexport default CanvasImageLayerRenderer;\n","/**\n * @module ol/TileRange\n */\n/**\n * A representation of a contiguous block of tiles.  A tile range is specified\n * by its min/max tile coordinates and is inclusive of coordinates.\n *\n * @constructor\n * @param {number} minX Minimum X.\n * @param {number} maxX Maximum X.\n * @param {number} minY Minimum Y.\n * @param {number} maxY Maximum Y.\n * @struct\n */\nconst TileRange = function(minX, maxX, minY, maxY) {\n\n  /**\n   * @type {number}\n   */\n  this.minX = minX;\n\n  /**\n   * @type {number}\n   */\n  this.maxX = maxX;\n\n  /**\n   * @type {number}\n   */\n  this.minY = minY;\n\n  /**\n   * @type {number}\n   */\n  this.maxY = maxY;\n\n};\n\n\n/**\n * @param {number} minX Minimum X.\n * @param {number} maxX Maximum X.\n * @param {number} minY Minimum Y.\n * @param {number} maxY Maximum Y.\n * @param {module:ol/TileRange=} tileRange TileRange.\n * @return {module:ol/TileRange} Tile range.\n */\nexport function createOrUpdate(minX, maxX, minY, maxY, tileRange) {\n  if (tileRange !== undefined) {\n    tileRange.minX = minX;\n    tileRange.maxX = maxX;\n    tileRange.minY = minY;\n    tileRange.maxY = maxY;\n    return tileRange;\n  } else {\n    return new TileRange(minX, maxX, minY, maxY);\n  }\n}\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @return {boolean} Contains tile coordinate.\n */\nTileRange.prototype.contains = function(tileCoord) {\n  return this.containsXY(tileCoord[1], tileCoord[2]);\n};\n\n\n/**\n * @param {module:ol/TileRange} tileRange Tile range.\n * @return {boolean} Contains.\n */\nTileRange.prototype.containsTileRange = function(tileRange) {\n  return this.minX <= tileRange.minX && tileRange.maxX <= this.maxX &&\n      this.minY <= tileRange.minY && tileRange.maxY <= this.maxY;\n};\n\n\n/**\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @return {boolean} Contains coordinate.\n */\nTileRange.prototype.containsXY = function(x, y) {\n  return this.minX <= x && x <= this.maxX && this.minY <= y && y <= this.maxY;\n};\n\n\n/**\n * @param {module:ol/TileRange} tileRange Tile range.\n * @return {boolean} Equals.\n */\nTileRange.prototype.equals = function(tileRange) {\n  return this.minX == tileRange.minX && this.minY == tileRange.minY &&\n      this.maxX == tileRange.maxX && this.maxY == tileRange.maxY;\n};\n\n\n/**\n * @param {module:ol/TileRange} tileRange Tile range.\n */\nTileRange.prototype.extend = function(tileRange) {\n  if (tileRange.minX < this.minX) {\n    this.minX = tileRange.minX;\n  }\n  if (tileRange.maxX > this.maxX) {\n    this.maxX = tileRange.maxX;\n  }\n  if (tileRange.minY < this.minY) {\n    this.minY = tileRange.minY;\n  }\n  if (tileRange.maxY > this.maxY) {\n    this.maxY = tileRange.maxY;\n  }\n};\n\n\n/**\n * @return {number} Height.\n */\nTileRange.prototype.getHeight = function() {\n  return this.maxY - this.minY + 1;\n};\n\n\n/**\n * @return {module:ol/size~Size} Size.\n */\nTileRange.prototype.getSize = function() {\n  return [this.getWidth(), this.getHeight()];\n};\n\n\n/**\n * @return {number} Width.\n */\nTileRange.prototype.getWidth = function() {\n  return this.maxX - this.minX + 1;\n};\n\n\n/**\n * @param {module:ol/TileRange} tileRange Tile range.\n * @return {boolean} Intersects.\n */\nTileRange.prototype.intersects = function(tileRange) {\n  return this.minX <= tileRange.maxX &&\n      this.maxX >= tileRange.minX &&\n      this.minY <= tileRange.maxY &&\n      this.maxY >= tileRange.minY;\n};\nexport default TileRange;\n","/**\n * @module ol/renderer/canvas/TileLayer\n */\nimport {getUid, inherits} from '../../util.js';\nimport LayerType from '../../LayerType.js';\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport ViewHint from '../../ViewHint.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {containsExtent, createEmpty, equals, getIntersection, isEmpty} from '../../extent.js';\nimport IntermediateCanvasRenderer from '../canvas/IntermediateCanvas.js';\nimport {create as createTransform, compose as composeTransform} from '../../transform.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/canvas/IntermediateCanvas}\n * @param {module:ol/layer/Tile|module:ol/layer/VectorTile} tileLayer Tile layer.\n * @api\n */\nconst CanvasTileLayerRenderer = function(tileLayer) {\n\n  IntermediateCanvasRenderer.call(this, tileLayer);\n\n  /**\n   * @protected\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context = this.context === null ? null : createCanvasContext2D();\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.oversampling_;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.renderedExtent_ = null;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.renderedRevision;\n\n  /**\n   * @protected\n   * @type {!Array.<module:ol/Tile>}\n   */\n  this.renderedTiles = [];\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.newTiles_ = false;\n\n  /**\n   * @protected\n   * @type {module:ol/extent~Extent}\n   */\n  this.tmpExtent = createEmpty();\n\n  /**\n   * @private\n   * @type {module:ol/TileRange}\n   */\n  this.tmpTileRange_ = new TileRange(0, 0, 0, 0);\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.imageTransform_ = createTransform();\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.zDirection = 0;\n\n};\n\ninherits(CanvasTileLayerRenderer, IntermediateCanvasRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nCanvasTileLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.TILE;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/canvas/TileLayer} The layer renderer.\n */\nCanvasTileLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new CanvasTileLayerRenderer(/** @type {module:ol/layer/Tile} */ (layer));\n};\n\n\n/**\n * @private\n * @param {module:ol/Tile} tile Tile.\n * @return {boolean} Tile is drawable.\n */\nCanvasTileLayerRenderer.prototype.isDrawableTile_ = function(tile) {\n  const tileState = tile.getState();\n  const useInterimTilesOnError = this.getLayer().getUseInterimTilesOnError();\n  return tileState == TileState.LOADED ||\n      tileState == TileState.EMPTY ||\n      tileState == TileState.ERROR && !useInterimTilesOnError;\n};\n\n\n/**\n * @param {number} z Tile coordinate z.\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {!module:ol/Tile} Tile.\n */\nCanvasTileLayerRenderer.prototype.getTile = function(z, x, y, pixelRatio, projection) {\n  const layer = this.getLayer();\n  const source = /** @type {module:ol/source/Tile} */ (layer.getSource());\n  let tile = source.getTile(z, x, y, pixelRatio, projection);\n  if (tile.getState() == TileState.ERROR) {\n    if (!layer.getUseInterimTilesOnError()) {\n      // When useInterimTilesOnError is false, we consider the error tile as loaded.\n      tile.setState(TileState.LOADED);\n    } else if (layer.getPreload() > 0) {\n      // Preloaded tiles for lower resolutions might have finished loading.\n      this.newTiles_ = true;\n    }\n  }\n  if (!this.isDrawableTile_(tile)) {\n    tile = tile.getInterimTile();\n  }\n  return tile;\n};\n\n/**\n * @inheritDoc\n */\nCanvasTileLayerRenderer.prototype.prepareFrame = function(frameState, layerState) {\n\n  const pixelRatio = frameState.pixelRatio;\n  const size = frameState.size;\n  const viewState = frameState.viewState;\n  const projection = viewState.projection;\n  const viewResolution = viewState.resolution;\n  const viewCenter = viewState.center;\n\n  const tileLayer = this.getLayer();\n  const tileSource = /** @type {module:ol/source/Tile} */ (tileLayer.getSource());\n  const sourceRevision = tileSource.getRevision();\n  const tileGrid = tileSource.getTileGridForProjection(projection);\n  const z = tileGrid.getZForResolution(viewResolution, this.zDirection);\n  const tileResolution = tileGrid.getResolution(z);\n  let oversampling = Math.round(viewResolution / tileResolution) || 1;\n  let extent = frameState.extent;\n\n  if (layerState.extent !== undefined) {\n    extent = getIntersection(extent, layerState.extent);\n  }\n  if (isEmpty(extent)) {\n    // Return false to prevent the rendering of the layer.\n    return false;\n  }\n\n  const tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n  const imageExtent = tileGrid.getTileRangeExtent(z, tileRange);\n\n  const tilePixelRatio = tileSource.getTilePixelRatio(pixelRatio);\n\n  /**\n   * @type {Object.<number, Object.<string, module:ol/Tile>>}\n   */\n  const tilesToDrawByZ = {};\n  tilesToDrawByZ[z] = {};\n\n  const findLoadedTiles = this.createLoadedTileFinder(\n    tileSource, projection, tilesToDrawByZ);\n\n  const hints = frameState.viewHints;\n  const animatingOrInteracting = hints[ViewHint.ANIMATING] || hints[ViewHint.INTERACTING];\n\n  const tmpExtent = this.tmpExtent;\n  const tmpTileRange = this.tmpTileRange_;\n  this.newTiles_ = false;\n  let tile, x, y;\n  for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\n    for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\n      if (Date.now() - frameState.time > 16 && animatingOrInteracting) {\n        continue;\n      }\n      tile = this.getTile(z, x, y, pixelRatio, projection);\n      if (this.isDrawableTile_(tile)) {\n        const uid = getUid(this);\n        if (tile.getState() == TileState.LOADED) {\n          tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;\n          const inTransition = tile.inTransition(uid);\n          if (!this.newTiles_ && (inTransition || this.renderedTiles.indexOf(tile) === -1)) {\n            this.newTiles_ = true;\n          }\n        }\n        if (tile.getAlpha(uid, frameState.time) === 1) {\n          // don't look for alt tiles if alpha is 1\n          continue;\n        }\n      }\n\n      const childTileRange = tileGrid.getTileCoordChildTileRange(\n        tile.tileCoord, tmpTileRange, tmpExtent);\n      let covered = false;\n      if (childTileRange) {\n        covered = findLoadedTiles(z + 1, childTileRange);\n      }\n      if (!covered) {\n        tileGrid.forEachTileCoordParentTileRange(\n          tile.tileCoord, findLoadedTiles, null, tmpTileRange, tmpExtent);\n      }\n\n    }\n  }\n\n  const renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;\n  if (!(this.renderedResolution && Date.now() - frameState.time > 16 && animatingOrInteracting) && (\n    this.newTiles_ ||\n        !(this.renderedExtent_ && containsExtent(this.renderedExtent_, extent)) ||\n        this.renderedRevision != sourceRevision ||\n        oversampling != this.oversampling_ ||\n        !animatingOrInteracting && renderedResolution != this.renderedResolution\n  )) {\n\n    const context = this.context;\n    if (context) {\n      const tilePixelSize = tileSource.getTilePixelSize(z, pixelRatio, projection);\n      const width = Math.round(tileRange.getWidth() * tilePixelSize[0] / oversampling);\n      const height = Math.round(tileRange.getHeight() * tilePixelSize[1] / oversampling);\n      const canvas = context.canvas;\n      if (canvas.width != width || canvas.height != height) {\n        this.oversampling_ = oversampling;\n        canvas.width = width;\n        canvas.height = height;\n      } else {\n        if (this.renderedExtent_ && !equals(imageExtent, this.renderedExtent_)) {\n          context.clearRect(0, 0, width, height);\n        }\n        oversampling = this.oversampling_;\n      }\n    }\n\n    this.renderedTiles.length = 0;\n    /** @type {Array.<number>} */\n    const zs = Object.keys(tilesToDrawByZ).map(Number);\n    zs.sort(function(a, b) {\n      if (a === z) {\n        return 1;\n      } else if (b === z) {\n        return -1;\n      } else {\n        return a > b ? 1 : a < b ? -1 : 0;\n      }\n    });\n    let currentResolution, currentScale, currentTilePixelSize, currentZ, i, ii;\n    let tileExtent, tileGutter, tilesToDraw, w, h;\n    for (i = 0, ii = zs.length; i < ii; ++i) {\n      currentZ = zs[i];\n      currentTilePixelSize = tileSource.getTilePixelSize(currentZ, pixelRatio, projection);\n      currentResolution = tileGrid.getResolution(currentZ);\n      currentScale = currentResolution / tileResolution;\n      tileGutter = tilePixelRatio * tileSource.getGutter(projection);\n      tilesToDraw = tilesToDrawByZ[currentZ];\n      for (const tileCoordKey in tilesToDraw) {\n        tile = tilesToDraw[tileCoordKey];\n        tileExtent = tileGrid.getTileCoordExtent(tile.getTileCoord(), tmpExtent);\n        x = (tileExtent[0] - imageExtent[0]) / tileResolution * tilePixelRatio / oversampling;\n        y = (imageExtent[3] - tileExtent[3]) / tileResolution * tilePixelRatio / oversampling;\n        w = currentTilePixelSize[0] * currentScale / oversampling;\n        h = currentTilePixelSize[1] * currentScale / oversampling;\n        this.drawTileImage(tile, frameState, layerState, x, y, w, h, tileGutter, z === currentZ);\n        this.renderedTiles.push(tile);\n      }\n    }\n\n    this.renderedRevision = sourceRevision;\n    this.renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;\n    this.renderedExtent_ = imageExtent;\n  }\n\n  const scale = this.renderedResolution / viewResolution;\n  const transform = composeTransform(this.imageTransform_,\n    pixelRatio * size[0] / 2, pixelRatio * size[1] / 2,\n    scale, scale,\n    0,\n    (this.renderedExtent_[0] - viewCenter[0]) / this.renderedResolution * pixelRatio,\n    (viewCenter[1] - this.renderedExtent_[3]) / this.renderedResolution * pixelRatio);\n  composeTransform(this.coordinateToCanvasPixelTransform,\n    pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5],\n    pixelRatio / viewResolution, -pixelRatio / viewResolution,\n    0,\n    -viewCenter[0], -viewCenter[1]);\n\n\n  this.updateUsedTiles(frameState.usedTiles, tileSource, z, tileRange);\n  this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio,\n    projection, extent, z, tileLayer.getPreload());\n  this.scheduleExpireCache(frameState, tileSource);\n\n  return this.renderedTiles.length > 0;\n};\n\n\n/**\n * @param {module:ol/Tile} tile Tile.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {number} x Left of the tile.\n * @param {number} y Top of the tile.\n * @param {number} w Width of the tile.\n * @param {number} h Height of the tile.\n * @param {number} gutter Tile gutter.\n * @param {boolean} transition Apply an alpha transition.\n */\nCanvasTileLayerRenderer.prototype.drawTileImage = function(tile, frameState, layerState, x, y, w, h, gutter, transition) {\n  const image = tile.getImage(this.getLayer());\n  if (!image) {\n    return;\n  }\n  const uid = getUid(this);\n  const alpha = transition ? tile.getAlpha(uid, frameState.time) : 1;\n  if (alpha === 1 && !this.getLayer().getSource().getOpaque(frameState.viewState.projection)) {\n    this.context.clearRect(x, y, w, h);\n  }\n  const alphaChanged = alpha !== this.context.globalAlpha;\n  if (alphaChanged) {\n    this.context.save();\n    this.context.globalAlpha = alpha;\n  }\n  this.context.drawImage(image, gutter, gutter,\n    image.width - 2 * gutter, image.height - 2 * gutter, x, y, w, h);\n\n  if (alphaChanged) {\n    this.context.restore();\n  }\n  if (alpha !== 1) {\n    frameState.animate = true;\n  } else if (transition) {\n    tile.endTransition(uid);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasTileLayerRenderer.prototype.getImage = function() {\n  const context = this.context;\n  return context ? context.canvas : null;\n};\n\n\n/**\n * @function\n * @return {module:ol/layer/Tile|module:ol/layer/VectorTile}\n */\nCanvasTileLayerRenderer.prototype.getLayer;\n\n\n/**\n * @inheritDoc\n */\nCanvasTileLayerRenderer.prototype.getImageTransform = function() {\n  return this.imageTransform_;\n};\nexport default CanvasTileLayerRenderer;\n","/**\n * @module ol/render/ReplayGroup\n */\n/**\n * Base class for replay groups.\n * @constructor\n * @abstract\n */\nconst ReplayGroup = function() {};\n\n\n/**\n * @abstract\n * @param {number|undefined} zIndex Z index.\n * @param {module:ol/render/ReplayType} replayType Replay type.\n * @return {module:ol/render/VectorContext} Replay.\n */\nReplayGroup.prototype.getReplay = function(zIndex, replayType) {};\n\n\n/**\n * @abstract\n * @return {boolean} Is empty.\n */\nReplayGroup.prototype.isEmpty = function() {};\nexport default ReplayGroup;\n","/**\n * @module ol/render/ReplayType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  CIRCLE: 'Circle',\n  DEFAULT: 'Default',\n  IMAGE: 'Image',\n  LINE_STRING: 'LineString',\n  POLYGON: 'Polygon',\n  TEXT: 'Text'\n};\n","/**\n * @module ol/geom/flat/textpath\n */\nimport {lerp} from '../../math.js';\n\n\n/**\n * @param {Array.<number>} flatCoordinates Path to put text on.\n * @param {number} offset Start offset of the `flatCoordinates`.\n * @param {number} end End offset of the `flatCoordinates`.\n * @param {number} stride Stride.\n * @param {string} text Text to place on the path.\n * @param {function(string):number} measure Measure function returning the\n * width of the character passed as 1st argument.\n * @param {number} startM m along the path where the text starts.\n * @param {number} maxAngle Max angle between adjacent chars in radians.\n * @return {Array.<Array.<*>>} The result array of null if `maxAngle` was\n * exceeded. Entries of the array are x, y, anchorX, angle, chunk.\n */\nexport function drawTextOnPath(\n  flatCoordinates, offset, end, stride, text, measure, startM, maxAngle) {\n  const result = [];\n\n  // Keep text upright\n  const reverse = flatCoordinates[offset] > flatCoordinates[end - stride];\n\n  const numChars = text.length;\n\n  let x1 = flatCoordinates[offset];\n  let y1 = flatCoordinates[offset + 1];\n  offset += stride;\n  let x2 = flatCoordinates[offset];\n  let y2 = flatCoordinates[offset + 1];\n  let segmentM = 0;\n  let segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\n  let chunk = '';\n  let chunkLength = 0;\n  let data, index, previousAngle;\n  for (let i = 0; i < numChars; ++i) {\n    index = reverse ? numChars - i - 1 : i;\n    const char = text.charAt(index);\n    chunk = reverse ? char + chunk : chunk + char;\n    const charLength = measure(chunk) - chunkLength;\n    chunkLength += charLength;\n    const charM = startM + charLength / 2;\n    while (offset < end - stride && segmentM + segmentLength < charM) {\n      x1 = x2;\n      y1 = y2;\n      offset += stride;\n      x2 = flatCoordinates[offset];\n      y2 = flatCoordinates[offset + 1];\n      segmentM += segmentLength;\n      segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n    }\n    const segmentPos = charM - segmentM;\n    let angle = Math.atan2(y2 - y1, x2 - x1);\n    if (reverse) {\n      angle += angle > 0 ? -Math.PI : Math.PI;\n    }\n    if (previousAngle !== undefined) {\n      let delta = angle - previousAngle;\n      delta += (delta > Math.PI) ? -2 * Math.PI : (delta < -Math.PI) ? 2 * Math.PI : 0;\n      if (Math.abs(delta) > maxAngle) {\n        return null;\n      }\n    }\n    const interpolate = segmentPos / segmentLength;\n    const x = lerp(x1, x2, interpolate);\n    const y = lerp(y1, y2, interpolate);\n    if (previousAngle == angle) {\n      if (reverse) {\n        data[0] = x;\n        data[1] = y;\n        data[2] = charLength / 2;\n      }\n      data[4] = chunk;\n    } else {\n      chunk = char;\n      chunkLength = charLength;\n      data = [x, y, charLength / 2, angle, chunk];\n      if (reverse) {\n        result.unshift(data);\n      } else {\n        result.push(data);\n      }\n      previousAngle = angle;\n    }\n    startM += charLength;\n  }\n  return result;\n}\n","/**\n * @module ol/render/canvas/Instruction\n */\n\n/**\n * @enum {number}\n */\nconst Instruction = {\n  BEGIN_GEOMETRY: 0,\n  BEGIN_PATH: 1,\n  CIRCLE: 2,\n  CLOSE_PATH: 3,\n  CUSTOM: 4,\n  DRAW_CHARS: 5,\n  DRAW_IMAGE: 6,\n  END_GEOMETRY: 7,\n  FILL: 8,\n  MOVE_TO_LINE_TO: 9,\n  SET_FILL_STYLE: 10,\n  SET_STROKE_STYLE: 11,\n  STROKE: 12\n};\n\n\n/**\n * @type {Array.<Instruction>}\n */\nexport const fillInstruction = [Instruction.FILL];\n\n\n/**\n * @type {Array.<Instruction>}\n */\nexport const strokeInstruction = [Instruction.STROKE];\n\n\n/**\n * @type {Array.<Instruction>}\n */\nexport const beginPathInstruction = [Instruction.BEGIN_PATH];\n\n\n/**\n * @type {Array.<Instruction>}\n */\nexport const closePathInstruction = [Instruction.CLOSE_PATH];\n\n\nexport default Instruction;\n","/**\n * @module ol/render/replay\n */\nimport ReplayType from '../render/ReplayType.js';\n\n\n/**\n * @const\n * @type {Array.<module:ol/render/ReplayType>}\n */\nexport const ORDER = [\n  ReplayType.POLYGON,\n  ReplayType.CIRCLE,\n  ReplayType.LINE_STRING,\n  ReplayType.IMAGE,\n  ReplayType.TEXT,\n  ReplayType.DEFAULT\n];\n\n/**\n * @const\n * @enum {number}\n */\nexport const TEXT_ALIGN = {};\nTEXT_ALIGN['left'] = 0;\nTEXT_ALIGN['end'] = 0;\nTEXT_ALIGN['center'] = 0.5;\nTEXT_ALIGN['right'] = 1;\nTEXT_ALIGN['start'] = 1;\nTEXT_ALIGN['top'] = 0;\nTEXT_ALIGN['middle'] = 0.5;\nTEXT_ALIGN['hanging'] = 0.2;\nTEXT_ALIGN['alphabetic'] = 0.8;\nTEXT_ALIGN['ideographic'] = 0.8;\nTEXT_ALIGN['bottom'] = 1;\n","/**\n * @module ol/render/canvas/Replay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {UNDEFINED} from '../../functions.js';\nimport {equals, reverseSubArray} from '../../array.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {buffer, clone, coordinateRelationship, createEmpty, createOrUpdate,\n  createOrUpdateEmpty, extend, extendCoordinate, intersects} from '../../extent.js';\nimport Relationship from '../../extent/Relationship.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport {inflateCoordinates, inflateCoordinatesArray, inflateMultiCoordinatesArray} from '../../geom/flat/inflate.js';\nimport {lineStringLength} from '../../geom/flat/length.js';\nimport {drawTextOnPath} from '../../geom/flat/textpath.js';\nimport {transform2D} from '../../geom/flat/transform.js';\nimport {CANVAS_LINE_DASH} from '../../has.js';\nimport {isEmpty} from '../../obj.js';\nimport VectorContext from '../VectorContext.js';\nimport {drawImage, resetTransform, defaultPadding, defaultFillStyle, defaultStrokeStyle,\n  defaultMiterLimit, defaultLineWidth, defaultLineJoin, defaultLineDashOffset,\n  defaultLineDash, defaultLineCap} from '../canvas.js';\nimport CanvasInstruction from '../canvas/Instruction.js';\nimport {TEXT_ALIGN} from '../replay.js';\nimport {\n  create as createTransform,\n  compose as composeTransform,\n  apply as applyTransform,\n  setFromArray as transformSetFromArray\n} from '../../transform.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/VectorContext}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Maximum extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay can have overlapping geometries.\n * @param {?} declutterTree Declutter tree.\n * @struct\n */\nconst CanvasReplay = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\n  VectorContext.call(this);\n\n  /**\n   * @type {?}\n   */\n  this.declutterTree = declutterTree;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.tolerance = tolerance;\n\n  /**\n   * @protected\n   * @const\n   * @type {module:ol/extent~Extent}\n   */\n  this.maxExtent = maxExtent;\n\n  /**\n   * @protected\n   * @type {boolean}\n   */\n  this.overlaps = overlaps;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.pixelRatio = pixelRatio;\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.maxLineWidth = 0;\n\n  /**\n   * @protected\n   * @const\n   * @type {number}\n   */\n  this.resolution = resolution;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.alignFill_;\n\n  /**\n   * @private\n   * @type {Array.<*>}\n   */\n  this.beginGeometryInstruction1_ = null;\n\n  /**\n   * @private\n   * @type {Array.<*>}\n   */\n  this.beginGeometryInstruction2_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.bufferedMaxExtent_ = null;\n\n  /**\n   * @protected\n   * @type {Array.<*>}\n   */\n  this.instructions = [];\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.coordinates = [];\n\n  /**\n   * @private\n   * @type {!Object.<number,module:ol/coordinate~Coordinate|Array.<module:ol/coordinate~Coordinate>|Array.<Array.<module:ol/coordinate~Coordinate>>>}\n   */\n  this.coordinateCache_ = {};\n\n  /**\n   * @private\n   * @type {!module:ol/transform~Transform}\n   */\n  this.renderedTransform_ = createTransform();\n\n  /**\n   * @protected\n   * @type {Array.<*>}\n   */\n  this.hitDetectionInstructions = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.pixelCoordinates_ = null;\n\n  /**\n   * @protected\n   * @type {module:ol/render/canvas~FillStrokeState}\n   */\n  this.state = /** @type {module:ol/render/canvas~FillStrokeState} */ ({});\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.viewRotation_ = 0;\n\n};\n\ninherits(CanvasReplay, VectorContext);\n\n\n/**\n * @type {module:ol/extent~Extent}\n */\nconst tmpExtent = createEmpty();\n\n\n/**\n * @type {!module:ol/transform~Transform}\n */\nconst tmpTransform = createTransform();\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/coordinate~Coordinate} p1 1st point of the background box.\n * @param {module:ol/coordinate~Coordinate} p2 2nd point of the background box.\n * @param {module:ol/coordinate~Coordinate} p3 3rd point of the background box.\n * @param {module:ol/coordinate~Coordinate} p4 4th point of the background box.\n * @param {Array.<*>} fillInstruction Fill instruction.\n * @param {Array.<*>} strokeInstruction Stroke instruction.\n */\nCanvasReplay.prototype.replayTextBackground_ = function(context, p1, p2, p3, p4,\n  fillInstruction, strokeInstruction) {\n  context.beginPath();\n  context.moveTo.apply(context, p1);\n  context.lineTo.apply(context, p2);\n  context.lineTo.apply(context, p3);\n  context.lineTo.apply(context, p4);\n  context.lineTo.apply(context, p1);\n  if (fillInstruction) {\n    this.alignFill_ = /** @type {boolean} */ (fillInstruction[2]);\n    this.fill_(context);\n  }\n  if (strokeInstruction) {\n    this.setStrokeStyle_(context, /** @type {Array.<*>} */ (strokeInstruction));\n    context.stroke();\n  }\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} image Image.\n * @param {number} anchorX Anchor X.\n * @param {number} anchorY Anchor Y.\n * @param {module:ol/render/canvas~DeclutterGroup} declutterGroup Declutter group.\n * @param {number} height Height.\n * @param {number} opacity Opacity.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} rotation Rotation.\n * @param {number} scale Scale.\n * @param {boolean} snapToPixel Snap to pixel.\n * @param {number} width Width.\n * @param {Array.<number>} padding Padding.\n * @param {Array.<*>} fillInstruction Fill instruction.\n * @param {Array.<*>} strokeInstruction Stroke instruction.\n */\nCanvasReplay.prototype.replayImage_ = function(context, x, y, image,\n  anchorX, anchorY, declutterGroup, height, opacity, originX, originY,\n  rotation, scale, snapToPixel, width, padding, fillInstruction, strokeInstruction) {\n  const fillStroke = fillInstruction || strokeInstruction;\n  anchorX *= scale;\n  anchorY *= scale;\n  x -= anchorX;\n  y -= anchorY;\n\n  const w = (width + originX > image.width) ? image.width - originX : width;\n  const h = (height + originY > image.height) ? image.height - originY : height;\n  const boxW = padding[3] + w * scale + padding[1];\n  const boxH = padding[0] + h * scale + padding[2];\n  const boxX = x - padding[3];\n  const boxY = y - padding[0];\n\n  /** @type {module:ol/coordinate~Coordinate} */\n  let p1;\n  /** @type {module:ol/coordinate~Coordinate} */\n  let p2;\n  /** @type {module:ol/coordinate~Coordinate} */\n  let p3;\n  /** @type {module:ol/coordinate~Coordinate} */\n  let p4;\n  if (fillStroke || rotation !== 0) {\n    p1 = [boxX, boxY];\n    p2 = [boxX + boxW, boxY];\n    p3 = [boxX + boxW, boxY + boxH];\n    p4 = [boxX, boxY + boxH];\n  }\n\n  let transform = null;\n  if (rotation !== 0) {\n    const centerX = x + anchorX;\n    const centerY = y + anchorY;\n    transform = composeTransform(tmpTransform, centerX, centerY, 1, 1, rotation, -centerX, -centerY);\n\n    createOrUpdateEmpty(tmpExtent);\n    extendCoordinate(tmpExtent, applyTransform(tmpTransform, p1));\n    extendCoordinate(tmpExtent, applyTransform(tmpTransform, p2));\n    extendCoordinate(tmpExtent, applyTransform(tmpTransform, p3));\n    extendCoordinate(tmpExtent, applyTransform(tmpTransform, p4));\n  } else {\n    createOrUpdate(boxX, boxY, boxX + boxW, boxY + boxH, tmpExtent);\n  }\n  const canvas = context.canvas;\n  const strokePadding = strokeInstruction ? (strokeInstruction[2] * scale / 2) : 0;\n  const intersects =\n      tmpExtent[0] - strokePadding <= canvas.width && tmpExtent[2] + strokePadding >= 0 &&\n      tmpExtent[1] - strokePadding <= canvas.height && tmpExtent[3] + strokePadding >= 0;\n\n  if (snapToPixel) {\n    x = Math.round(x);\n    y = Math.round(y);\n  }\n\n  if (declutterGroup) {\n    if (!intersects && declutterGroup[4] == 1) {\n      return;\n    }\n    extend(declutterGroup, tmpExtent);\n    const declutterArgs = intersects ?\n      [context, transform ? transform.slice(0) : null, opacity, image, originX, originY, w, h, x, y, scale] :\n      null;\n    if (declutterArgs && fillStroke) {\n      declutterArgs.push(fillInstruction, strokeInstruction, p1, p2, p3, p4);\n    }\n    declutterGroup.push(declutterArgs);\n  } else if (intersects) {\n    if (fillStroke) {\n      this.replayTextBackground_(context, p1, p2, p3, p4,\n        /** @type {Array.<*>} */ (fillInstruction),\n        /** @type {Array.<*>} */ (strokeInstruction));\n    }\n    drawImage(context, transform, opacity, image, originX, originY, w, h, x, y, scale);\n  }\n};\n\n\n/**\n * @protected\n * @param {Array.<number>} dashArray Dash array.\n * @return {Array.<number>} Dash array with pixel ratio applied\n */\nCanvasReplay.prototype.applyPixelRatio = function(dashArray) {\n  const pixelRatio = this.pixelRatio;\n  return pixelRatio == 1 ? dashArray : dashArray.map(function(dash) {\n    return dash * pixelRatio;\n  });\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {boolean} closed Last input coordinate equals first.\n * @param {boolean} skipFirst Skip first coordinate.\n * @protected\n * @return {number} My end.\n */\nCanvasReplay.prototype.appendFlatCoordinates = function(flatCoordinates, offset, end, stride, closed, skipFirst) {\n\n  let myEnd = this.coordinates.length;\n  const extent = this.getBufferedMaxExtent();\n  if (skipFirst) {\n    offset += stride;\n  }\n  const lastCoord = [flatCoordinates[offset], flatCoordinates[offset + 1]];\n  const nextCoord = [NaN, NaN];\n  let skipped = true;\n\n  let i, lastRel, nextRel;\n  for (i = offset + stride; i < end; i += stride) {\n    nextCoord[0] = flatCoordinates[i];\n    nextCoord[1] = flatCoordinates[i + 1];\n    nextRel = coordinateRelationship(extent, nextCoord);\n    if (nextRel !== lastRel) {\n      if (skipped) {\n        this.coordinates[myEnd++] = lastCoord[0];\n        this.coordinates[myEnd++] = lastCoord[1];\n      }\n      this.coordinates[myEnd++] = nextCoord[0];\n      this.coordinates[myEnd++] = nextCoord[1];\n      skipped = false;\n    } else if (nextRel === Relationship.INTERSECTING) {\n      this.coordinates[myEnd++] = nextCoord[0];\n      this.coordinates[myEnd++] = nextCoord[1];\n      skipped = false;\n    } else {\n      skipped = true;\n    }\n    lastCoord[0] = nextCoord[0];\n    lastCoord[1] = nextCoord[1];\n    lastRel = nextRel;\n  }\n\n  // Last coordinate equals first or only one point to append:\n  if ((closed && skipped) || i === offset + stride) {\n    this.coordinates[myEnd++] = lastCoord[0];\n    this.coordinates[myEnd++] = lastCoord[1];\n  }\n  return myEnd;\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {Array.<number>} replayEnds Replay ends.\n * @return {number} Offset.\n */\nCanvasReplay.prototype.drawCustomCoordinates_ = function(flatCoordinates, offset, ends, stride, replayEnds) {\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    const replayEnd = this.appendFlatCoordinates(flatCoordinates, offset, end, stride, false, false);\n    replayEnds.push(replayEnd);\n    offset = end;\n  }\n  return offset;\n};\n\n\n/**\n * @inheritDoc.\n */\nCanvasReplay.prototype.drawCustom = function(geometry, feature, renderer) {\n  this.beginGeometry(geometry, feature);\n  const type = geometry.getType();\n  const stride = geometry.getStride();\n  const replayBegin = this.coordinates.length;\n  let flatCoordinates, replayEnd, replayEnds, replayEndss;\n  let offset;\n  if (type == GeometryType.MULTI_POLYGON) {\n    geometry = /** @type {module:ol/geom/MultiPolygon} */ (geometry);\n    flatCoordinates = geometry.getOrientedFlatCoordinates();\n    replayEndss = [];\n    const endss = geometry.getEndss();\n    offset = 0;\n    for (let i = 0, ii = endss.length; i < ii; ++i) {\n      const myEnds = [];\n      offset = this.drawCustomCoordinates_(flatCoordinates, offset, endss[i], stride, myEnds);\n      replayEndss.push(myEnds);\n    }\n    this.instructions.push([CanvasInstruction.CUSTOM,\n      replayBegin, replayEndss, geometry, renderer, inflateMultiCoordinatesArray]);\n  } else if (type == GeometryType.POLYGON || type == GeometryType.MULTI_LINE_STRING) {\n    replayEnds = [];\n    flatCoordinates = (type == GeometryType.POLYGON) ?\n      /** @type {module:ol/geom/Polygon} */ (geometry).getOrientedFlatCoordinates() :\n      geometry.getFlatCoordinates();\n    offset = this.drawCustomCoordinates_(flatCoordinates, 0,\n      /** @type {module:ol/geom/Polygon|module:ol/geom/MultiLineString} */ (geometry).getEnds(),\n      stride, replayEnds);\n    this.instructions.push([CanvasInstruction.CUSTOM,\n      replayBegin, replayEnds, geometry, renderer, inflateCoordinatesArray]);\n  } else if (type == GeometryType.LINE_STRING || type == GeometryType.MULTI_POINT) {\n    flatCoordinates = geometry.getFlatCoordinates();\n    replayEnd = this.appendFlatCoordinates(\n      flatCoordinates, 0, flatCoordinates.length, stride, false, false);\n    this.instructions.push([CanvasInstruction.CUSTOM,\n      replayBegin, replayEnd, geometry, renderer, inflateCoordinates]);\n  } else if (type == GeometryType.POINT) {\n    flatCoordinates = geometry.getFlatCoordinates();\n    this.coordinates.push(flatCoordinates[0], flatCoordinates[1]);\n    replayEnd = this.coordinates.length;\n    this.instructions.push([CanvasInstruction.CUSTOM,\n      replayBegin, replayEnd, geometry, renderer]);\n  }\n  this.endGeometry(geometry, feature);\n};\n\n\n/**\n * @protected\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nCanvasReplay.prototype.beginGeometry = function(geometry, feature) {\n  this.beginGeometryInstruction1_ = [CanvasInstruction.BEGIN_GEOMETRY, feature, 0];\n  this.instructions.push(this.beginGeometryInstruction1_);\n  this.beginGeometryInstruction2_ = [CanvasInstruction.BEGIN_GEOMETRY, feature, 0];\n  this.hitDetectionInstructions.push(this.beginGeometryInstruction2_);\n};\n\n\n/**\n * @private\n * @param {CanvasRenderingContext2D} context Context.\n */\nCanvasReplay.prototype.fill_ = function(context) {\n  if (this.alignFill_) {\n    const origin = applyTransform(this.renderedTransform_, [0, 0]);\n    const repeatSize = 512 * this.pixelRatio;\n    context.translate(origin[0] % repeatSize, origin[1] % repeatSize);\n    context.rotate(this.viewRotation_);\n  }\n  context.fill();\n  if (this.alignFill_) {\n    context.setTransform.apply(context, resetTransform);\n  }\n};\n\n\n/**\n * @private\n * @param {CanvasRenderingContext2D} context Context.\n * @param {Array.<*>} instruction Instruction.\n */\nCanvasReplay.prototype.setStrokeStyle_ = function(context, instruction) {\n  context.strokeStyle = /** @type {module:ol/colorlike~ColorLike} */ (instruction[1]);\n  context.lineWidth = /** @type {number} */ (instruction[2]);\n  context.lineCap = /** @type {string} */ (instruction[3]);\n  context.lineJoin = /** @type {string} */ (instruction[4]);\n  context.miterLimit = /** @type {number} */ (instruction[5]);\n  if (CANVAS_LINE_DASH) {\n    context.lineDashOffset = /** @type {number} */ (instruction[7]);\n    context.setLineDash(/** @type {Array.<number>} */ (instruction[6]));\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~DeclutterGroup} declutterGroup Declutter group.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nCanvasReplay.prototype.renderDeclutter_ = function(declutterGroup, feature) {\n  if (declutterGroup && declutterGroup.length > 5) {\n    const groupCount = declutterGroup[4];\n    if (groupCount == 1 || groupCount == declutterGroup.length - 5) {\n      /** @type {module:ol/structs/RBush~Entry} */\n      const box = {\n        minX: /** @type {number} */ (declutterGroup[0]),\n        minY: /** @type {number} */ (declutterGroup[1]),\n        maxX: /** @type {number} */ (declutterGroup[2]),\n        maxY: /** @type {number} */ (declutterGroup[3]),\n        value: feature\n      };\n      if (!this.declutterTree.collides(box)) {\n        this.declutterTree.insert(box);\n        for (let j = 5, jj = declutterGroup.length; j < jj; ++j) {\n          const declutterData = /** @type {Array} */ (declutterGroup[j]);\n          if (declutterData) {\n            if (declutterData.length > 11) {\n              this.replayTextBackground_(declutterData[0],\n                declutterData[13], declutterData[14], declutterData[15], declutterData[16],\n                declutterData[11], declutterData[12]);\n            }\n            drawImage.apply(undefined, declutterData);\n          }\n        }\n      }\n      declutterGroup.length = 5;\n      createOrUpdateEmpty(declutterGroup);\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *     to skip.\n * @param {Array.<*>} instructions Instructions array.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined}\n *     featureCallback Feature callback.\n * @param {module:ol/extent~Extent=} opt_hitExtent Only check features that intersect this\n *     extent.\n * @return {T|undefined} Callback result.\n * @template T\n */\nCanvasReplay.prototype.replay_ = function(\n  context, transform, skippedFeaturesHash,\n  instructions, featureCallback, opt_hitExtent) {\n  /** @type {Array.<number>} */\n  let pixelCoordinates;\n  if (this.pixelCoordinates_ && equals(transform, this.renderedTransform_)) {\n    pixelCoordinates = this.pixelCoordinates_;\n  } else {\n    if (!this.pixelCoordinates_) {\n      this.pixelCoordinates_ = [];\n    }\n    pixelCoordinates = transform2D(\n      this.coordinates, 0, this.coordinates.length, 2,\n      transform, this.pixelCoordinates_);\n    transformSetFromArray(this.renderedTransform_, transform);\n  }\n  const skipFeatures = !isEmpty(skippedFeaturesHash);\n  let i = 0; // instruction index\n  const ii = instructions.length; // end of instructions\n  let d = 0; // data index\n  let dd; // end of per-instruction data\n  let anchorX, anchorY, prevX, prevY, roundX, roundY, declutterGroup, image;\n  let pendingFill = 0;\n  let pendingStroke = 0;\n  let lastFillInstruction = null;\n  let lastStrokeInstruction = null;\n  const coordinateCache = this.coordinateCache_;\n  const viewRotation = this.viewRotation_;\n\n  const state = /** @type {module:ol/render~State} */ ({\n    context: context,\n    pixelRatio: this.pixelRatio,\n    resolution: this.resolution,\n    rotation: viewRotation\n  });\n\n  // When the batch size gets too big, performance decreases. 200 is a good\n  // balance between batch size and number of fill/stroke instructions.\n  const batchSize = this.instructions != instructions || this.overlaps ? 0 : 200;\n  let /** @type {module:ol/Feature|module:ol/render/Feature} */ feature;\n  let x, y;\n  while (i < ii) {\n    const instruction = instructions[i];\n    const type = /** @type {module:ol/render/canvas/Instruction} */ (instruction[0]);\n    switch (type) {\n      case CanvasInstruction.BEGIN_GEOMETRY:\n        feature = /** @type {module:ol/Feature|module:ol/render/Feature} */ (instruction[1]);\n        if ((skipFeatures &&\n            skippedFeaturesHash[getUid(feature).toString()]) ||\n            !feature.getGeometry()) {\n          i = /** @type {number} */ (instruction[2]);\n        } else if (opt_hitExtent !== undefined && !intersects(\n          opt_hitExtent, feature.getGeometry().getExtent())) {\n          i = /** @type {number} */ (instruction[2]) + 1;\n        } else {\n          ++i;\n        }\n        break;\n      case CanvasInstruction.BEGIN_PATH:\n        if (pendingFill > batchSize) {\n          this.fill_(context);\n          pendingFill = 0;\n        }\n        if (pendingStroke > batchSize) {\n          context.stroke();\n          pendingStroke = 0;\n        }\n        if (!pendingFill && !pendingStroke) {\n          context.beginPath();\n          prevX = prevY = NaN;\n        }\n        ++i;\n        break;\n      case CanvasInstruction.CIRCLE:\n        d = /** @type {number} */ (instruction[1]);\n        const x1 = pixelCoordinates[d];\n        const y1 = pixelCoordinates[d + 1];\n        const x2 = pixelCoordinates[d + 2];\n        const y2 = pixelCoordinates[d + 3];\n        const dx = x2 - x1;\n        const dy = y2 - y1;\n        const r = Math.sqrt(dx * dx + dy * dy);\n        context.moveTo(x1 + r, y1);\n        context.arc(x1, y1, r, 0, 2 * Math.PI, true);\n        ++i;\n        break;\n      case CanvasInstruction.CLOSE_PATH:\n        context.closePath();\n        ++i;\n        break;\n      case CanvasInstruction.CUSTOM:\n        d = /** @type {number} */ (instruction[1]);\n        dd = instruction[2];\n        const geometry = /** @type {module:ol/geom/SimpleGeometry} */ (instruction[3]);\n        const renderer = instruction[4];\n        const fn = instruction.length == 6 ? instruction[5] : undefined;\n        state.geometry = geometry;\n        state.feature = feature;\n        if (!(i in coordinateCache)) {\n          coordinateCache[i] = [];\n        }\n        const coords = coordinateCache[i];\n        if (fn) {\n          fn(pixelCoordinates, d, dd, 2, coords);\n        } else {\n          coords[0] = pixelCoordinates[d];\n          coords[1] = pixelCoordinates[d + 1];\n          coords.length = 2;\n        }\n        renderer(coords, state);\n        ++i;\n        break;\n      case CanvasInstruction.DRAW_IMAGE:\n        d = /** @type {number} */ (instruction[1]);\n        dd = /** @type {number} */ (instruction[2]);\n        image =  /** @type {HTMLCanvasElement|HTMLVideoElement|Image} */\n            (instruction[3]);\n        // Remaining arguments in DRAW_IMAGE are in alphabetical order\n        anchorX = /** @type {number} */ (instruction[4]);\n        anchorY = /** @type {number} */ (instruction[5]);\n        declutterGroup = featureCallback ? null : /** @type {module:ol/render/canvas~DeclutterGroup} */ (instruction[6]);\n        const height = /** @type {number} */ (instruction[7]);\n        const opacity = /** @type {number} */ (instruction[8]);\n        const originX = /** @type {number} */ (instruction[9]);\n        const originY = /** @type {number} */ (instruction[10]);\n        const rotateWithView = /** @type {boolean} */ (instruction[11]);\n        let rotation = /** @type {number} */ (instruction[12]);\n        const scale = /** @type {number} */ (instruction[13]);\n        const snapToPixel = /** @type {boolean} */ (instruction[14]);\n        const width = /** @type {number} */ (instruction[15]);\n\n        let padding, backgroundFill, backgroundStroke;\n        if (instruction.length > 16) {\n          padding = /** @type {Array.<number>} */ (instruction[16]);\n          backgroundFill = /** @type {boolean} */ (instruction[17]);\n          backgroundStroke = /** @type {boolean} */ (instruction[18]);\n        } else {\n          padding = defaultPadding;\n          backgroundFill = backgroundStroke = false;\n        }\n\n        if (rotateWithView) {\n          rotation += viewRotation;\n        }\n        for (; d < dd; d += 2) {\n          this.replayImage_(context,\n            pixelCoordinates[d], pixelCoordinates[d + 1], image, anchorX, anchorY,\n            declutterGroup, height, opacity, originX, originY, rotation, scale,\n            snapToPixel, width, padding,\n            backgroundFill ? /** @type {Array.<*>} */ (lastFillInstruction) : null,\n            backgroundStroke ? /** @type {Array.<*>} */ (lastStrokeInstruction) : null);\n        }\n        this.renderDeclutter_(declutterGroup, feature);\n        ++i;\n        break;\n      case CanvasInstruction.DRAW_CHARS:\n        const begin = /** @type {number} */ (instruction[1]);\n        const end = /** @type {number} */ (instruction[2]);\n        const baseline = /** @type {number} */ (instruction[3]);\n        declutterGroup = featureCallback ? null : /** @type {module:ol/render/canvas~DeclutterGroup} */ (instruction[4]);\n        const overflow = /** @type {number} */ (instruction[5]);\n        const fillKey = /** @type {string} */ (instruction[6]);\n        const maxAngle = /** @type {number} */ (instruction[7]);\n        const measure = /** @type {function(string):number} */ (instruction[8]);\n        const offsetY = /** @type {number} */ (instruction[9]);\n        const strokeKey = /** @type {string} */ (instruction[10]);\n        const strokeWidth =  /** @type {number} */ (instruction[11]);\n        const text = /** @type {string} */ (instruction[12]);\n        const textKey = /** @type {string} */ (instruction[13]);\n        const textScale = /** @type {number} */ (instruction[14]);\n\n        const pathLength = lineStringLength(pixelCoordinates, begin, end, 2);\n        const textLength = measure(text);\n        if (overflow || textLength <= pathLength) {\n          const textAlign = /** @type {module:ol~render} */ (this).textStates[textKey].textAlign;\n          const startM = (pathLength - textLength) * TEXT_ALIGN[textAlign];\n          const parts = drawTextOnPath(\n            pixelCoordinates, begin, end, 2, text, measure, startM, maxAngle);\n          if (parts) {\n            let c, cc, chars, label, part;\n            if (strokeKey) {\n              for (c = 0, cc = parts.length; c < cc; ++c) {\n                part = parts[c]; // x, y, anchorX, rotation, chunk\n                chars = /** @type {string} */ (part[4]);\n                label = /** @type {module:ol~render} */ (this).getImage(chars, textKey, '', strokeKey);\n                anchorX = /** @type {number} */ (part[2]) + strokeWidth;\n                anchorY = baseline * label.height + (0.5 - baseline) * 2 * strokeWidth - offsetY;\n                this.replayImage_(context,\n                  /** @type {number} */ (part[0]), /** @type {number} */ (part[1]), label,\n                  anchorX, anchorY, declutterGroup, label.height, 1, 0, 0,\n                  /** @type {number} */ (part[3]), textScale, false, label.width,\n                  defaultPadding, null, null);\n              }\n            }\n            if (fillKey) {\n              for (c = 0, cc = parts.length; c < cc; ++c) {\n                part = parts[c]; // x, y, anchorX, rotation, chunk\n                chars = /** @type {string} */ (part[4]);\n                label = /** @type {module:ol~render} */ (this).getImage(chars, textKey, fillKey, '');\n                anchorX = /** @type {number} */ (part[2]);\n                anchorY = baseline * label.height - offsetY;\n                this.replayImage_(context,\n                  /** @type {number} */ (part[0]), /** @type {number} */ (part[1]), label,\n                  anchorX, anchorY, declutterGroup, label.height, 1, 0, 0,\n                  /** @type {number} */ (part[3]), textScale, false, label.width,\n                  defaultPadding, null, null);\n              }\n            }\n          }\n        }\n        this.renderDeclutter_(declutterGroup, feature);\n        ++i;\n        break;\n      case CanvasInstruction.END_GEOMETRY:\n        if (featureCallback !== undefined) {\n          feature = /** @type {module:ol/Feature|module:ol/render/Feature} */ (instruction[1]);\n          const result = featureCallback(feature);\n          if (result) {\n            return result;\n          }\n        }\n        ++i;\n        break;\n      case CanvasInstruction.FILL:\n        if (batchSize) {\n          pendingFill++;\n        } else {\n          this.fill_(context);\n        }\n        ++i;\n        break;\n      case CanvasInstruction.MOVE_TO_LINE_TO:\n        d = /** @type {number} */ (instruction[1]);\n        dd = /** @type {number} */ (instruction[2]);\n        x = pixelCoordinates[d];\n        y = pixelCoordinates[d + 1];\n        roundX = (x + 0.5) | 0;\n        roundY = (y + 0.5) | 0;\n        if (roundX !== prevX || roundY !== prevY) {\n          context.moveTo(x, y);\n          prevX = roundX;\n          prevY = roundY;\n        }\n        for (d += 2; d < dd; d += 2) {\n          x = pixelCoordinates[d];\n          y = pixelCoordinates[d + 1];\n          roundX = (x + 0.5) | 0;\n          roundY = (y + 0.5) | 0;\n          if (d == dd - 2 || roundX !== prevX || roundY !== prevY) {\n            context.lineTo(x, y);\n            prevX = roundX;\n            prevY = roundY;\n          }\n        }\n        ++i;\n        break;\n      case CanvasInstruction.SET_FILL_STYLE:\n        lastFillInstruction = instruction;\n        this.alignFill_ = instruction[2];\n\n        if (pendingFill) {\n          this.fill_(context);\n          pendingFill = 0;\n          if (pendingStroke) {\n            context.stroke();\n            pendingStroke = 0;\n          }\n        }\n\n        context.fillStyle = /** @type {module:ol/colorlike~ColorLike} */ (instruction[1]);\n        ++i;\n        break;\n      case CanvasInstruction.SET_STROKE_STYLE:\n        lastStrokeInstruction = instruction;\n        if (pendingStroke) {\n          context.stroke();\n          pendingStroke = 0;\n        }\n        this.setStrokeStyle_(context, /** @type {Array.<*>} */ (instruction));\n        ++i;\n        break;\n      case CanvasInstruction.STROKE:\n        if (batchSize) {\n          pendingStroke++;\n        } else {\n          context.stroke();\n        }\n        ++i;\n        break;\n      default:\n        ++i; // consume the instruction anyway, to avoid an infinite loop\n        break;\n    }\n  }\n  if (pendingFill) {\n    this.fill_(context);\n  }\n  if (pendingStroke) {\n    context.stroke();\n  }\n  return undefined;\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {number} viewRotation View rotation.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *     to skip.\n */\nCanvasReplay.prototype.replay = function(\n  context, transform, viewRotation, skippedFeaturesHash) {\n  this.viewRotation_ = viewRotation;\n  this.replay_(context, transform,\n    skippedFeaturesHash, this.instructions, undefined, undefined);\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {number} viewRotation View rotation.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *     to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T=} opt_featureCallback\n *     Feature callback.\n * @param {module:ol/extent~Extent=} opt_hitExtent Only check features that intersect this\n *     extent.\n * @return {T|undefined} Callback result.\n * @template T\n */\nCanvasReplay.prototype.replayHitDetection = function(\n  context, transform, viewRotation, skippedFeaturesHash,\n  opt_featureCallback, opt_hitExtent) {\n  this.viewRotation_ = viewRotation;\n  return this.replay_(context, transform, skippedFeaturesHash,\n    this.hitDetectionInstructions, opt_featureCallback, opt_hitExtent);\n};\n\n\n/**\n * Reverse the hit detection instructions.\n */\nCanvasReplay.prototype.reverseHitDetectionInstructions = function() {\n  const hitDetectionInstructions = this.hitDetectionInstructions;\n  // step 1 - reverse array\n  hitDetectionInstructions.reverse();\n  // step 2 - reverse instructions within geometry blocks\n  let i;\n  const n = hitDetectionInstructions.length;\n  let instruction;\n  let type;\n  let begin = -1;\n  for (i = 0; i < n; ++i) {\n    instruction = hitDetectionInstructions[i];\n    type = /** @type {module:ol/render/canvas/Instruction} */ (instruction[0]);\n    if (type == CanvasInstruction.END_GEOMETRY) {\n      begin = i;\n    } else if (type == CanvasInstruction.BEGIN_GEOMETRY) {\n      instruction[2] = i;\n      reverseSubArray(this.hitDetectionInstructions, begin, i);\n      begin = -1;\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasReplay.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  const state = this.state;\n  if (fillStyle) {\n    const fillStyleColor = fillStyle.getColor();\n    state.fillStyle = asColorLike(fillStyleColor ?\n      fillStyleColor : defaultFillStyle);\n  } else {\n    state.fillStyle = undefined;\n  }\n  if (strokeStyle) {\n    const strokeStyleColor = strokeStyle.getColor();\n    state.strokeStyle = asColorLike(strokeStyleColor ?\n      strokeStyleColor : defaultStrokeStyle);\n    const strokeStyleLineCap = strokeStyle.getLineCap();\n    state.lineCap = strokeStyleLineCap !== undefined ?\n      strokeStyleLineCap : defaultLineCap;\n    const strokeStyleLineDash = strokeStyle.getLineDash();\n    state.lineDash = strokeStyleLineDash ?\n      strokeStyleLineDash.slice() : defaultLineDash;\n    const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n    state.lineDashOffset = strokeStyleLineDashOffset ?\n      strokeStyleLineDashOffset : defaultLineDashOffset;\n    const strokeStyleLineJoin = strokeStyle.getLineJoin();\n    state.lineJoin = strokeStyleLineJoin !== undefined ?\n      strokeStyleLineJoin : defaultLineJoin;\n    const strokeStyleWidth = strokeStyle.getWidth();\n    state.lineWidth = strokeStyleWidth !== undefined ?\n      strokeStyleWidth : defaultLineWidth;\n    const strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n    state.miterLimit = strokeStyleMiterLimit !== undefined ?\n      strokeStyleMiterLimit : defaultMiterLimit;\n\n    if (state.lineWidth > this.maxLineWidth) {\n      this.maxLineWidth = state.lineWidth;\n      // invalidate the buffered max extent cache\n      this.bufferedMaxExtent_ = null;\n    }\n  } else {\n    state.strokeStyle = undefined;\n    state.lineCap = undefined;\n    state.lineDash = null;\n    state.lineDashOffset = undefined;\n    state.lineJoin = undefined;\n    state.lineWidth = undefined;\n    state.miterLimit = undefined;\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillStrokeState} state State.\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n * @return {Array.<*>} Fill instruction.\n */\nCanvasReplay.prototype.createFill = function(state, geometry) {\n  const fillStyle = state.fillStyle;\n  const fillInstruction = [CanvasInstruction.SET_FILL_STYLE, fillStyle];\n  if (typeof fillStyle !== 'string') {\n    // Fill is a pattern or gradient - align it!\n    fillInstruction.push(true);\n  }\n  return fillInstruction;\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillStrokeState} state State.\n */\nCanvasReplay.prototype.applyStroke = function(state) {\n  this.instructions.push(this.createStroke(state));\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillStrokeState} state State.\n * @return {Array.<*>} Stroke instruction.\n */\nCanvasReplay.prototype.createStroke = function(state) {\n  return [\n    CanvasInstruction.SET_STROKE_STYLE,\n    state.strokeStyle, state.lineWidth * this.pixelRatio, state.lineCap,\n    state.lineJoin, state.miterLimit,\n    this.applyPixelRatio(state.lineDash), state.lineDashOffset * this.pixelRatio\n  ];\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillStrokeState} state State.\n * @param {function(this:module:ol/render/canvas/Replay, module:ol/render/canvas~FillStrokeState, (module:ol/geom/Geometry|module:ol/render/Feature)):Array.<*>} createFill Create fill.\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n */\nCanvasReplay.prototype.updateFillStyle = function(state, createFill, geometry) {\n  const fillStyle = state.fillStyle;\n  if (typeof fillStyle !== 'string' || state.currentFillStyle != fillStyle) {\n    if (fillStyle !== undefined) {\n      this.instructions.push(createFill.call(this, state, geometry));\n    }\n    state.currentFillStyle = fillStyle;\n  }\n};\n\n\n/**\n * @param {module:ol/render/canvas~FillStrokeState} state State.\n * @param {function(this:module:ol/render/canvas/Replay, module:ol/render/canvas~FillStrokeState)} applyStroke Apply stroke.\n */\nCanvasReplay.prototype.updateStrokeStyle = function(state, applyStroke) {\n  const strokeStyle = state.strokeStyle;\n  const lineCap = state.lineCap;\n  const lineDash = state.lineDash;\n  const lineDashOffset = state.lineDashOffset;\n  const lineJoin = state.lineJoin;\n  const lineWidth = state.lineWidth;\n  const miterLimit = state.miterLimit;\n  if (state.currentStrokeStyle != strokeStyle ||\n      state.currentLineCap != lineCap ||\n      (lineDash != state.currentLineDash && !equals(state.currentLineDash, lineDash)) ||\n      state.currentLineDashOffset != lineDashOffset ||\n      state.currentLineJoin != lineJoin ||\n      state.currentLineWidth != lineWidth ||\n      state.currentMiterLimit != miterLimit) {\n    if (strokeStyle !== undefined) {\n      applyStroke.call(this, state);\n    }\n    state.currentStrokeStyle = strokeStyle;\n    state.currentLineCap = lineCap;\n    state.currentLineDash = lineDash;\n    state.currentLineDashOffset = lineDashOffset;\n    state.currentLineJoin = lineJoin;\n    state.currentLineWidth = lineWidth;\n    state.currentMiterLimit = miterLimit;\n  }\n};\n\n\n/**\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nCanvasReplay.prototype.endGeometry = function(geometry, feature) {\n  this.beginGeometryInstruction1_[2] = this.instructions.length;\n  this.beginGeometryInstruction1_ = null;\n  this.beginGeometryInstruction2_[2] = this.hitDetectionInstructions.length;\n  this.beginGeometryInstruction2_ = null;\n  const endGeometryInstruction = [CanvasInstruction.END_GEOMETRY, feature];\n  this.instructions.push(endGeometryInstruction);\n  this.hitDetectionInstructions.push(endGeometryInstruction);\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nCanvasReplay.prototype.finish = UNDEFINED;\n\n\n/**\n * Get the buffered rendering extent.  Rendering will be clipped to the extent\n * provided to the constructor.  To account for symbolizers that may intersect\n * this extent, we calculate a buffered extent (e.g. based on stroke width).\n * @return {module:ol/extent~Extent} The buffered rendering extent.\n * @protected\n */\nCanvasReplay.prototype.getBufferedMaxExtent = function() {\n  if (!this.bufferedMaxExtent_) {\n    this.bufferedMaxExtent_ = clone(this.maxExtent);\n    if (this.maxLineWidth > 0) {\n      const width = this.resolution * (this.maxLineWidth + 1) / 2;\n      buffer(this.bufferedMaxExtent_, width, this.bufferedMaxExtent_);\n    }\n  }\n  return this.bufferedMaxExtent_;\n};\nexport default CanvasReplay;\n","/**\n * @module ol/render/canvas/ImageReplay\n */\nimport {inherits} from '../../util.js';\nimport CanvasInstruction from '../canvas/Instruction.js';\nimport CanvasReplay from '../canvas/Replay.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/canvas/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Maximum extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay can have overlapping geometries.\n * @param {?} declutterTree Declutter tree.\n * @struct\n */\nconst CanvasImageReplay = function(\n  tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\n  CanvasReplay.call(this,\n    tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);\n\n  /**\n   * @private\n   * @type {module:ol/render/canvas~DeclutterGroup}\n   */\n  this.declutterGroup_ = null;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement|HTMLVideoElement|Image}\n   */\n  this.hitDetectionImage_ = null;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement|HTMLVideoElement|Image}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.anchorX_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.anchorY_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.height_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.opacity_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.originX_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.originY_ = undefined;\n\n  /**\n   * @private\n   * @type {boolean|undefined}\n   */\n  this.rotateWithView_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.rotation_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.scale_ = undefined;\n\n  /**\n   * @private\n   * @type {boolean|undefined}\n   */\n  this.snapToPixel_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.width_ = undefined;\n\n};\n\ninherits(CanvasImageReplay, CanvasReplay);\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @private\n * @return {number} My end.\n */\nCanvasImageReplay.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {\n  return this.appendFlatCoordinates(flatCoordinates, offset, end, stride, false, false);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageReplay.prototype.drawPoint = function(pointGeometry, feature) {\n  if (!this.image_) {\n    return;\n  }\n  this.beginGeometry(pointGeometry, feature);\n  const flatCoordinates = pointGeometry.getFlatCoordinates();\n  const stride = pointGeometry.getStride();\n  const myBegin = this.coordinates.length;\n  const myEnd = this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n  this.instructions.push([\n    CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.image_,\n    // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_,\n    this.originX_, this.originY_, this.rotateWithView_, this.rotation_,\n    this.scale_ * this.pixelRatio, this.snapToPixel_, this.width_\n  ]);\n  this.hitDetectionInstructions.push([\n    CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_,\n    // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_,\n    this.originX_, this.originY_, this.rotateWithView_, this.rotation_,\n    this.scale_, this.snapToPixel_, this.width_\n  ]);\n  this.endGeometry(pointGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageReplay.prototype.drawMultiPoint = function(multiPointGeometry, feature) {\n  if (!this.image_) {\n    return;\n  }\n  this.beginGeometry(multiPointGeometry, feature);\n  const flatCoordinates = multiPointGeometry.getFlatCoordinates();\n  const stride = multiPointGeometry.getStride();\n  const myBegin = this.coordinates.length;\n  const myEnd = this.drawCoordinates_(\n    flatCoordinates, 0, flatCoordinates.length, stride);\n  this.instructions.push([\n    CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.image_,\n    // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_,\n    this.originX_, this.originY_, this.rotateWithView_, this.rotation_,\n    this.scale_ * this.pixelRatio, this.snapToPixel_, this.width_\n  ]);\n  this.hitDetectionInstructions.push([\n    CanvasInstruction.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_,\n    // Remaining arguments to DRAW_IMAGE are in alphabetical order\n    this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_,\n    this.originX_, this.originY_, this.rotateWithView_, this.rotation_,\n    this.scale_, this.snapToPixel_, this.width_\n  ]);\n  this.endGeometry(multiPointGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageReplay.prototype.finish = function() {\n  this.reverseHitDetectionInstructions();\n  // FIXME this doesn't really protect us against further calls to draw*Geometry\n  this.anchorX_ = undefined;\n  this.anchorY_ = undefined;\n  this.hitDetectionImage_ = null;\n  this.image_ = null;\n  this.height_ = undefined;\n  this.scale_ = undefined;\n  this.opacity_ = undefined;\n  this.originX_ = undefined;\n  this.originY_ = undefined;\n  this.rotateWithView_ = undefined;\n  this.rotation_ = undefined;\n  this.snapToPixel_ = undefined;\n  this.width_ = undefined;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasImageReplay.prototype.setImageStyle = function(imageStyle, declutterGroup) {\n  const anchor = imageStyle.getAnchor();\n  const size = imageStyle.getSize();\n  const hitDetectionImage = imageStyle.getHitDetectionImage(1);\n  const image = imageStyle.getImage(1);\n  const origin = imageStyle.getOrigin();\n  this.anchorX_ = anchor[0];\n  this.anchorY_ = anchor[1];\n  this.declutterGroup_ = /** @type {module:ol/render/canvas~DeclutterGroup} */ (declutterGroup);\n  this.hitDetectionImage_ = hitDetectionImage;\n  this.image_ = image;\n  this.height_ = size[1];\n  this.opacity_ = imageStyle.getOpacity();\n  this.originX_ = origin[0];\n  this.originY_ = origin[1];\n  this.rotateWithView_ = imageStyle.getRotateWithView();\n  this.rotation_ = imageStyle.getRotation();\n  this.scale_ = imageStyle.getScale();\n  this.snapToPixel_ = imageStyle.getSnapToPixel();\n  this.width_ = size[0];\n};\nexport default CanvasImageReplay;\n","/**\n * @module ol/render/canvas/LineStringReplay\n */\nimport {inherits} from '../../util.js';\nimport CanvasInstruction, {strokeInstruction, beginPathInstruction} from '../canvas/Instruction.js';\nimport CanvasReplay from '../canvas/Replay.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/canvas/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Maximum extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay can have overlapping geometries.\n * @param {?} declutterTree Declutter tree.\n * @struct\n */\nconst CanvasLineStringReplay = function(\n  tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\n  CanvasReplay.call(this,\n    tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);\n};\n\ninherits(CanvasLineStringReplay, CanvasReplay);\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @private\n * @return {number} end.\n */\nCanvasLineStringReplay.prototype.drawFlatCoordinates_ = function(flatCoordinates, offset, end, stride) {\n  const myBegin = this.coordinates.length;\n  const myEnd = this.appendFlatCoordinates(\n    flatCoordinates, offset, end, stride, false, false);\n  const moveToLineToInstruction = [CanvasInstruction.MOVE_TO_LINE_TO, myBegin, myEnd];\n  this.instructions.push(moveToLineToInstruction);\n  this.hitDetectionInstructions.push(moveToLineToInstruction);\n  return end;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasLineStringReplay.prototype.drawLineString = function(lineStringGeometry, feature) {\n  const state = this.state;\n  const strokeStyle = state.strokeStyle;\n  const lineWidth = state.lineWidth;\n  if (strokeStyle === undefined || lineWidth === undefined) {\n    return;\n  }\n  this.updateStrokeStyle(state, this.applyStroke);\n  this.beginGeometry(lineStringGeometry, feature);\n  this.hitDetectionInstructions.push([\n    CanvasInstruction.SET_STROKE_STYLE,\n    state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\n    state.miterLimit, state.lineDash, state.lineDashOffset\n  ], beginPathInstruction);\n  const flatCoordinates = lineStringGeometry.getFlatCoordinates();\n  const stride = lineStringGeometry.getStride();\n  this.drawFlatCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n  this.hitDetectionInstructions.push(strokeInstruction);\n  this.endGeometry(lineStringGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasLineStringReplay.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {\n  const state = this.state;\n  const strokeStyle = state.strokeStyle;\n  const lineWidth = state.lineWidth;\n  if (strokeStyle === undefined || lineWidth === undefined) {\n    return;\n  }\n  this.updateStrokeStyle(state, this.applyStroke);\n  this.beginGeometry(multiLineStringGeometry, feature);\n  this.hitDetectionInstructions.push([\n    CanvasInstruction.SET_STROKE_STYLE,\n    state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\n    state.miterLimit, state.lineDash, state.lineDashOffset\n  ], beginPathInstruction);\n  const ends = multiLineStringGeometry.getEnds();\n  const flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\n  const stride = multiLineStringGeometry.getStride();\n  let offset = 0;\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    offset = this.drawFlatCoordinates_(flatCoordinates, offset, ends[i], stride);\n  }\n  this.hitDetectionInstructions.push(strokeInstruction);\n  this.endGeometry(multiLineStringGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasLineStringReplay.prototype.finish = function() {\n  const state = this.state;\n  if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {\n    this.instructions.push(strokeInstruction);\n  }\n  this.reverseHitDetectionInstructions();\n  this.state = null;\n};\n\n\n/**\n * @inheritDoc.\n */\nCanvasLineStringReplay.prototype.applyStroke = function(state) {\n  if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {\n    this.instructions.push(strokeInstruction);\n    state.lastStroke = this.coordinates.length;\n  }\n  state.lastStroke = 0;\n  CanvasReplay.prototype.applyStroke.call(this, state);\n  this.instructions.push(beginPathInstruction);\n};\nexport default CanvasLineStringReplay;\n","/**\n * @module ol/render/canvas/PolygonReplay\n */\nimport {inherits} from '../../util.js';\nimport {asString} from '../../color.js';\nimport {snap} from '../../geom/flat/simplify.js';\nimport {defaultFillStyle} from '../canvas.js';\nimport CanvasInstruction, {\n  fillInstruction, strokeInstruction, beginPathInstruction, closePathInstruction\n} from '../canvas/Instruction.js';\nimport CanvasReplay from '../canvas/Replay.js';\n\n\n/**\n * @constructor\n * @extends {module:ol/render/canvas/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Maximum extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay can have overlapping geometries.\n * @param {?} declutterTree Declutter tree.\n * @struct\n */\nconst CanvasPolygonReplay = function(\n  tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\n  CanvasReplay.call(this,\n    tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);\n};\n\ninherits(CanvasPolygonReplay, CanvasReplay);\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {number} stride Stride.\n * @private\n * @return {number} End.\n */\nCanvasPolygonReplay.prototype.drawFlatCoordinatess_ = function(flatCoordinates, offset, ends, stride) {\n  const state = this.state;\n  const fill = state.fillStyle !== undefined;\n  const stroke = state.strokeStyle != undefined;\n  const numEnds = ends.length;\n  this.instructions.push(beginPathInstruction);\n  this.hitDetectionInstructions.push(beginPathInstruction);\n  for (let i = 0; i < numEnds; ++i) {\n    const end = ends[i];\n    const myBegin = this.coordinates.length;\n    const myEnd = this.appendFlatCoordinates(flatCoordinates, offset, end, stride, true, !stroke);\n    const moveToLineToInstruction = [CanvasInstruction.MOVE_TO_LINE_TO, myBegin, myEnd];\n    this.instructions.push(moveToLineToInstruction);\n    this.hitDetectionInstructions.push(moveToLineToInstruction);\n    if (stroke) {\n      // Performance optimization: only call closePath() when we have a stroke.\n      // Otherwise the ring is closed already (see appendFlatCoordinates above).\n      this.instructions.push(closePathInstruction);\n      this.hitDetectionInstructions.push(closePathInstruction);\n    }\n    offset = end;\n  }\n  if (fill) {\n    this.instructions.push(fillInstruction);\n    this.hitDetectionInstructions.push(fillInstruction);\n  }\n  if (stroke) {\n    this.instructions.push(strokeInstruction);\n    this.hitDetectionInstructions.push(strokeInstruction);\n  }\n  return offset;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasPolygonReplay.prototype.drawCircle = function(circleGeometry, feature) {\n  const state = this.state;\n  const fillStyle = state.fillStyle;\n  const strokeStyle = state.strokeStyle;\n  if (fillStyle === undefined && strokeStyle === undefined) {\n    return;\n  }\n  this.setFillStrokeStyles_(circleGeometry);\n  this.beginGeometry(circleGeometry, feature);\n  if (state.fillStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_FILL_STYLE,\n      asString(defaultFillStyle)\n    ]);\n  }\n  if (state.strokeStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_STROKE_STYLE,\n      state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\n      state.miterLimit, state.lineDash, state.lineDashOffset\n    ]);\n  }\n  const flatCoordinates = circleGeometry.getFlatCoordinates();\n  const stride = circleGeometry.getStride();\n  const myBegin = this.coordinates.length;\n  this.appendFlatCoordinates(\n    flatCoordinates, 0, flatCoordinates.length, stride, false, false);\n  const circleInstruction = [CanvasInstruction.CIRCLE, myBegin];\n  this.instructions.push(beginPathInstruction, circleInstruction);\n  this.hitDetectionInstructions.push(beginPathInstruction, circleInstruction);\n  this.hitDetectionInstructions.push(fillInstruction);\n  if (state.fillStyle !== undefined) {\n    this.instructions.push(fillInstruction);\n  }\n  if (state.strokeStyle !== undefined) {\n    this.instructions.push(strokeInstruction);\n    this.hitDetectionInstructions.push(strokeInstruction);\n  }\n  this.endGeometry(circleGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasPolygonReplay.prototype.drawPolygon = function(polygonGeometry, feature) {\n  const state = this.state;\n  const fillStyle = state.fillStyle;\n  const strokeStyle = state.strokeStyle;\n  if (fillStyle === undefined && strokeStyle === undefined) {\n    return;\n  }\n  this.setFillStrokeStyles_(polygonGeometry);\n  this.beginGeometry(polygonGeometry, feature);\n  if (state.fillStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_FILL_STYLE,\n      asString(defaultFillStyle)\n    ]);\n  }\n  if (state.strokeStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_STROKE_STYLE,\n      state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\n      state.miterLimit, state.lineDash, state.lineDashOffset\n    ]);\n  }\n  const ends = polygonGeometry.getEnds();\n  const flatCoordinates = polygonGeometry.getOrientedFlatCoordinates();\n  const stride = polygonGeometry.getStride();\n  this.drawFlatCoordinatess_(flatCoordinates, 0, ends, stride);\n  this.endGeometry(polygonGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasPolygonReplay.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {\n  const state = this.state;\n  const fillStyle = state.fillStyle;\n  const strokeStyle = state.strokeStyle;\n  if (fillStyle === undefined && strokeStyle === undefined) {\n    return;\n  }\n  this.setFillStrokeStyles_(multiPolygonGeometry);\n  this.beginGeometry(multiPolygonGeometry, feature);\n  if (state.fillStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_FILL_STYLE,\n      asString(defaultFillStyle)\n    ]);\n  }\n  if (state.strokeStyle !== undefined) {\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.SET_STROKE_STYLE,\n      state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\n      state.miterLimit, state.lineDash, state.lineDashOffset\n    ]);\n  }\n  const endss = multiPolygonGeometry.getEndss();\n  const flatCoordinates = multiPolygonGeometry.getOrientedFlatCoordinates();\n  const stride = multiPolygonGeometry.getStride();\n  let offset = 0;\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    offset = this.drawFlatCoordinatess_(flatCoordinates, offset, endss[i], stride);\n  }\n  this.endGeometry(multiPolygonGeometry, feature);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasPolygonReplay.prototype.finish = function() {\n  this.reverseHitDetectionInstructions();\n  this.state = null;\n  // We want to preserve topology when drawing polygons.  Polygons are\n  // simplified using quantization and point elimination. However, we might\n  // have received a mix of quantized and non-quantized geometries, so ensure\n  // that all are quantized by quantizing all coordinates in the batch.\n  const tolerance = this.tolerance;\n  if (tolerance !== 0) {\n    const coordinates = this.coordinates;\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      coordinates[i] = snap(coordinates[i], tolerance);\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n */\nCanvasPolygonReplay.prototype.setFillStrokeStyles_ = function(geometry) {\n  const state = this.state;\n  const fillStyle = state.fillStyle;\n  if (fillStyle !== undefined) {\n    this.updateFillStyle(state, this.createFill, geometry);\n  }\n  if (state.strokeStyle !== undefined) {\n    this.updateStrokeStyle(state, this.applyStroke);\n  }\n};\nexport default CanvasPolygonReplay;\n","/**\n * @module ol/geom/flat/straightchunk\n */\n\n\n/**\n * @param {number} maxAngle Maximum acceptable angle delta between segments.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {Array.<number>} Start and end of the first suitable chunk of the\n * given `flatCoordinates`.\n */\nexport function matchingChunk(maxAngle, flatCoordinates, offset, end, stride) {\n  let chunkStart = offset;\n  let chunkEnd = offset;\n  let chunkM = 0;\n  let m = 0;\n  let start = offset;\n  let acos, i, m12, m23, x1, y1, x12, y12, x23, y23;\n  for (i = offset; i < end; i += stride) {\n    const x2 = flatCoordinates[i];\n    const y2 = flatCoordinates[i + 1];\n    if (x1 !== undefined) {\n      x23 = x2 - x1;\n      y23 = y2 - y1;\n      m23 = Math.sqrt(x23 * x23 + y23 * y23);\n      if (x12 !== undefined) {\n        m += m12;\n        acos = Math.acos((x12 * x23 + y12 * y23) / (m12 * m23));\n        if (acos > maxAngle) {\n          if (m > chunkM) {\n            chunkM = m;\n            chunkStart = start;\n            chunkEnd = i;\n          }\n          m = 0;\n          start = i - stride;\n        }\n      }\n      m12 = m23;\n      x12 = x23;\n      y12 = y23;\n    }\n    x1 = x2;\n    y1 = y2;\n  }\n  m += m23;\n  return m > chunkM ? [start, i] : [chunkStart, chunkEnd];\n}\n","/**\n * @module ol/render/canvas/TextReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {intersects} from '../../extent.js';\nimport {matchingChunk} from '../../geom/flat/straightchunk.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport {CANVAS_LINE_DASH} from '../../has.js';\nimport {labelCache, measureTextWidth, defaultTextAlign, measureTextHeight, defaultPadding, defaultLineCap, defaultLineDashOffset, defaultLineDash, defaultLineJoin, defaultFillStyle, checkFont, defaultFont, defaultLineWidth, defaultMiterLimit, defaultStrokeStyle, defaultTextBaseline} from '../canvas.js';\nimport CanvasInstruction from '../canvas/Instruction.js';\nimport CanvasReplay from '../canvas/Replay.js';\nimport {TEXT_ALIGN} from '../replay.js';\nimport TextPlacement from '../../style/TextPlacement.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/canvas/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Maximum extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay can have overlapping geometries.\n * @param {?} declutterTree Declutter tree.\n * @struct\n */\nconst CanvasTextReplay = function(\n  tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\n  CanvasReplay.call(this,\n    tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);\n\n  /**\n   * @private\n   * @type {module:ol/render/canvas~DeclutterGroup}\n   */\n  this.declutterGroup_;\n\n  /**\n   * @private\n   * @type {Array.<HTMLCanvasElement>}\n   */\n  this.labels_ = null;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.text_ = '';\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textOffsetX_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textOffsetY_ = 0;\n\n  /**\n   * @private\n   * @type {boolean|undefined}\n   */\n  this.textRotateWithView_ = undefined;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textRotation_ = 0;\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~FillState}\n   */\n  this.textFillState_ = null;\n\n  /**\n   * @type {!Object.<string, module:ol/render/canvas~FillState>}\n   */\n  this.fillStates = {};\n\n  /**\n   * @private\n   * @type {?module:ol/render/canvas~StrokeState}\n   */\n  this.textStrokeState_ = null;\n\n  /**\n   * @type {!Object.<string, module:ol/render/canvas~StrokeState>}\n   */\n  this.strokeStates = {};\n\n  /**\n   * @private\n   * @type {module:ol/render/canvas~TextState}\n   */\n  this.textState_ = /** @type {module:ol/render/canvas~TextState} */ ({});\n\n  /**\n   * @type {!Object.<string, module:ol/render/canvas~TextState>}\n   */\n  this.textStates = {};\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.textKey_ = '';\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.fillKey_ = '';\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.strokeKey_ = '';\n\n  /**\n   * @private\n   * @type {Object.<string, Object.<string, number>>}\n   */\n  this.widths_ = {};\n\n  labelCache.prune();\n\n};\n\ninherits(CanvasTextReplay, CanvasReplay);\n\n\n/**\n * @param {string} font Font to use for measuring.\n * @param {Array.<string>} lines Lines to measure.\n * @param {Array.<number>} widths Array will be populated with the widths of\n * each line.\n * @return {number} Width of the whole text.\n */\nexport function measureTextWidths(font, lines, widths) {\n  const numLines = lines.length;\n  let width = 0;\n  for (let i = 0; i < numLines; ++i) {\n    const currentWidth = measureTextWidth(font, lines[i]);\n    width = Math.max(width, currentWidth);\n    widths.push(currentWidth);\n  }\n  return width;\n}\n\n\n/**\n * @inheritDoc\n */\nCanvasTextReplay.prototype.drawText = function(geometry, feature) {\n  const fillState = this.textFillState_;\n  const strokeState = this.textStrokeState_;\n  const textState = this.textState_;\n  if (this.text_ === '' || !textState || (!fillState && !strokeState)) {\n    return;\n  }\n\n  let begin = this.coordinates.length;\n\n  const geometryType = geometry.getType();\n  let flatCoordinates = null;\n  let end = 2;\n  let stride = 2;\n  let i, ii;\n\n  if (textState.placement === TextPlacement.LINE) {\n    if (!intersects(this.getBufferedMaxExtent(), geometry.getExtent())) {\n      return;\n    }\n    let ends;\n    flatCoordinates = geometry.getFlatCoordinates();\n    stride = geometry.getStride();\n    if (geometryType == GeometryType.LINE_STRING) {\n      ends = [flatCoordinates.length];\n    } else if (geometryType == GeometryType.MULTI_LINE_STRING) {\n      ends = geometry.getEnds();\n    } else if (geometryType == GeometryType.POLYGON) {\n      ends = geometry.getEnds().slice(0, 1);\n    } else if (geometryType == GeometryType.MULTI_POLYGON) {\n      const endss = geometry.getEndss();\n      ends = [];\n      for (i = 0, ii = endss.length; i < ii; ++i) {\n        ends.push(endss[i][0]);\n      }\n    }\n    this.beginGeometry(geometry, feature);\n    const textAlign = textState.textAlign;\n    let flatOffset = 0;\n    let flatEnd;\n    for (let o = 0, oo = ends.length; o < oo; ++o) {\n      if (textAlign == undefined) {\n        const range = matchingChunk(textState.maxAngle, flatCoordinates, flatOffset, ends[o], stride);\n        flatOffset = range[0];\n        flatEnd = range[1];\n      } else {\n        flatEnd = ends[o];\n      }\n      for (i = flatOffset; i < flatEnd; i += stride) {\n        this.coordinates.push(flatCoordinates[i], flatCoordinates[i + 1]);\n      }\n      end = this.coordinates.length;\n      flatOffset = ends[o];\n      this.drawChars_(begin, end, this.declutterGroup_);\n      begin = end;\n    }\n    this.endGeometry(geometry, feature);\n\n  } else {\n    const label = this.getImage(this.text_, this.textKey_, this.fillKey_, this.strokeKey_);\n    const width = label.width / this.pixelRatio;\n    switch (geometryType) {\n      case GeometryType.POINT:\n      case GeometryType.MULTI_POINT:\n        flatCoordinates = geometry.getFlatCoordinates();\n        end = flatCoordinates.length;\n        break;\n      case GeometryType.LINE_STRING:\n        flatCoordinates = /** @type {module:ol/geom/LineString} */ (geometry).getFlatMidpoint();\n        break;\n      case GeometryType.CIRCLE:\n        flatCoordinates = /** @type {module:ol/geom/Circle} */ (geometry).getCenter();\n        break;\n      case GeometryType.MULTI_LINE_STRING:\n        flatCoordinates = /** @type {module:ol/geom/MultiLineString} */ (geometry).getFlatMidpoints();\n        end = flatCoordinates.length;\n        break;\n      case GeometryType.POLYGON:\n        flatCoordinates = /** @type {module:ol/geom/Polygon} */ (geometry).getFlatInteriorPoint();\n        if (!textState.overflow && flatCoordinates[2] / this.resolution < width) {\n          return;\n        }\n        stride = 3;\n        break;\n      case GeometryType.MULTI_POLYGON:\n        const interiorPoints = /** @type {module:ol/geom/MultiPolygon} */ (geometry).getFlatInteriorPoints();\n        flatCoordinates = [];\n        for (i = 0, ii = interiorPoints.length; i < ii; i += 3) {\n          if (textState.overflow || interiorPoints[i + 2] / this.resolution >= width) {\n            flatCoordinates.push(interiorPoints[i], interiorPoints[i + 1]);\n          }\n        }\n        end = flatCoordinates.length;\n        if (end == 0) {\n          return;\n        }\n        break;\n      default:\n    }\n    end = this.appendFlatCoordinates(flatCoordinates, 0, end, stride, false, false);\n    if (textState.backgroundFill || textState.backgroundStroke) {\n      this.setFillStrokeStyle(textState.backgroundFill, textState.backgroundStroke);\n      if (textState.backgroundFill) {\n        this.updateFillStyle(this.state, this.createFill, geometry);\n        this.hitDetectionInstructions.push(this.createFill(this.state, geometry));\n      }\n      if (textState.backgroundStroke) {\n        this.updateStrokeStyle(this.state, this.applyStroke);\n        this.hitDetectionInstructions.push(this.createStroke(this.state));\n      }\n    }\n    this.beginGeometry(geometry, feature);\n    this.drawTextImage_(label, begin, end);\n    this.endGeometry(geometry, feature);\n  }\n};\n\n\n/**\n * @param {string} text Text.\n * @param {string} textKey Text style key.\n * @param {string} fillKey Fill style key.\n * @param {string} strokeKey Stroke style key.\n * @return {HTMLCanvasElement} Image.\n */\nCanvasTextReplay.prototype.getImage = function(text, textKey, fillKey, strokeKey) {\n  let label;\n  const key = strokeKey + textKey + text + fillKey + this.pixelRatio;\n\n  if (!labelCache.containsKey(key)) {\n    const strokeState = strokeKey ? this.strokeStates[strokeKey] || this.textStrokeState_ : null;\n    const fillState = fillKey ? this.fillStates[fillKey] || this.textFillState_ : null;\n    const textState = this.textStates[textKey] || this.textState_;\n    const pixelRatio = this.pixelRatio;\n    const scale = textState.scale * pixelRatio;\n    const align =  TEXT_ALIGN[textState.textAlign || defaultTextAlign];\n    const strokeWidth = strokeKey && strokeState.lineWidth ? strokeState.lineWidth : 0;\n\n    const lines = text.split('\\n');\n    const numLines = lines.length;\n    const widths = [];\n    const width = measureTextWidths(textState.font, lines, widths);\n    const lineHeight = measureTextHeight(textState.font);\n    const height = lineHeight * numLines;\n    const renderWidth = (width + strokeWidth);\n    const context = createCanvasContext2D(\n      Math.ceil(renderWidth * scale),\n      Math.ceil((height + strokeWidth) * scale));\n    label = context.canvas;\n    labelCache.set(key, label);\n    if (scale != 1) {\n      context.scale(scale, scale);\n    }\n    context.font = textState.font;\n    if (strokeKey) {\n      context.strokeStyle = strokeState.strokeStyle;\n      context.lineWidth = strokeWidth;\n      context.lineCap = strokeState.lineCap;\n      context.lineJoin = strokeState.lineJoin;\n      context.miterLimit = strokeState.miterLimit;\n      if (CANVAS_LINE_DASH && strokeState.lineDash.length) {\n        context.setLineDash(strokeState.lineDash);\n        context.lineDashOffset = strokeState.lineDashOffset;\n      }\n    }\n    if (fillKey) {\n      context.fillStyle = fillState.fillStyle;\n    }\n    context.textBaseline = 'middle';\n    context.textAlign = 'center';\n    const leftRight = (0.5 - align);\n    const x = align * label.width / scale + leftRight * strokeWidth;\n    let i;\n    if (strokeKey) {\n      for (i = 0; i < numLines; ++i) {\n        context.strokeText(lines[i], x + leftRight * widths[i], 0.5 * (strokeWidth + lineHeight) + i * lineHeight);\n      }\n    }\n    if (fillKey) {\n      for (i = 0; i < numLines; ++i) {\n        context.fillText(lines[i], x + leftRight * widths[i], 0.5 * (strokeWidth + lineHeight) + i * lineHeight);\n      }\n    }\n  }\n  return labelCache.get(key);\n};\n\n\n/**\n * @private\n * @param {HTMLCanvasElement} label Label.\n * @param {number} begin Begin.\n * @param {number} end End.\n */\nCanvasTextReplay.prototype.drawTextImage_ = function(label, begin, end) {\n  const textState = this.textState_;\n  const strokeState = this.textStrokeState_;\n  const pixelRatio = this.pixelRatio;\n  const align = TEXT_ALIGN[textState.textAlign || defaultTextAlign];\n  const baseline = TEXT_ALIGN[textState.textBaseline];\n  const strokeWidth = strokeState && strokeState.lineWidth ? strokeState.lineWidth : 0;\n\n  const anchorX = align * label.width / pixelRatio + 2 * (0.5 - align) * strokeWidth;\n  const anchorY = baseline * label.height / pixelRatio + 2 * (0.5 - baseline) * strokeWidth;\n  this.instructions.push([CanvasInstruction.DRAW_IMAGE, begin, end,\n    label, (anchorX - this.textOffsetX_) * pixelRatio, (anchorY - this.textOffsetY_) * pixelRatio,\n    this.declutterGroup_, label.height, 1, 0, 0, this.textRotateWithView_, this.textRotation_,\n    1, true, label.width,\n    textState.padding == defaultPadding ?\n      defaultPadding : textState.padding.map(function(p) {\n        return p * pixelRatio;\n      }),\n    !!textState.backgroundFill, !!textState.backgroundStroke\n  ]);\n  this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE, begin, end,\n    label, (anchorX - this.textOffsetX_) * pixelRatio, (anchorY - this.textOffsetY_) * pixelRatio,\n    this.declutterGroup_, label.height, 1, 0, 0, this.textRotateWithView_, this.textRotation_,\n    1 / pixelRatio, true, label.width, textState.padding,\n    !!textState.backgroundFill, !!textState.backgroundStroke\n  ]);\n};\n\n\n/**\n * @private\n * @param {number} begin Begin.\n * @param {number} end End.\n * @param {module:ol/render/canvas~DeclutterGroup} declutterGroup Declutter group.\n */\nCanvasTextReplay.prototype.drawChars_ = function(begin, end, declutterGroup) {\n  const strokeState = this.textStrokeState_;\n  const textState = this.textState_;\n  const fillState = this.textFillState_;\n\n  const strokeKey = this.strokeKey_;\n  if (strokeState) {\n    if (!(strokeKey in this.strokeStates)) {\n      this.strokeStates[strokeKey] = /** @type {module:ol/render/canvas~StrokeState} */ ({\n        strokeStyle: strokeState.strokeStyle,\n        lineCap: strokeState.lineCap,\n        lineDashOffset: strokeState.lineDashOffset,\n        lineWidth: strokeState.lineWidth,\n        lineJoin: strokeState.lineJoin,\n        miterLimit: strokeState.miterLimit,\n        lineDash: strokeState.lineDash\n      });\n    }\n  }\n  const textKey = this.textKey_;\n  if (!(this.textKey_ in this.textStates)) {\n    this.textStates[this.textKey_] = /** @type {module:ol/render/canvas~TextState} */ ({\n      font: textState.font,\n      textAlign: textState.textAlign || defaultTextAlign,\n      scale: textState.scale\n    });\n  }\n  const fillKey = this.fillKey_;\n  if (fillState) {\n    if (!(fillKey in this.fillStates)) {\n      this.fillStates[fillKey] = /** @type {module:ol/render/canvas~FillState} */ ({\n        fillStyle: fillState.fillStyle\n      });\n    }\n  }\n\n  const pixelRatio = this.pixelRatio;\n  const baseline = TEXT_ALIGN[textState.textBaseline];\n\n  const offsetY = this.textOffsetY_ * pixelRatio;\n  const text = this.text_;\n  const font = textState.font;\n  const textScale = textState.scale;\n  const strokeWidth = strokeState ? strokeState.lineWidth * textScale / 2 : 0;\n  let widths = this.widths_[font];\n  if (!widths) {\n    this.widths_[font] = widths = {};\n  }\n  this.instructions.push([CanvasInstruction.DRAW_CHARS,\n    begin, end, baseline, declutterGroup,\n    textState.overflow, fillKey, textState.maxAngle,\n    function(text) {\n      let width = widths[text];\n      if (!width) {\n        width = widths[text] = measureTextWidth(font, text);\n      }\n      return width * textScale * pixelRatio;\n    },\n    offsetY, strokeKey, strokeWidth * pixelRatio, text, textKey, 1\n  ]);\n  this.hitDetectionInstructions.push([CanvasInstruction.DRAW_CHARS,\n    begin, end, baseline, declutterGroup,\n    textState.overflow, fillKey, textState.maxAngle,\n    function(text) {\n      let width = widths[text];\n      if (!width) {\n        width = widths[text] = measureTextWidth(font, text);\n      }\n      return width * textScale;\n    },\n    offsetY, strokeKey, strokeWidth, text, textKey, 1 / pixelRatio\n  ]);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasTextReplay.prototype.setTextStyle = function(textStyle, declutterGroup) {\n  let textState, fillState, strokeState;\n  if (!textStyle) {\n    this.text_ = '';\n  } else {\n    this.declutterGroup_ = /** @type {module:ol/render/canvas~DeclutterGroup} */ (declutterGroup);\n\n    const textFillStyle = textStyle.getFill();\n    if (!textFillStyle) {\n      fillState = this.textFillState_ = null;\n    } else {\n      fillState = this.textFillState_;\n      if (!fillState) {\n        fillState = this.textFillState_ = /** @type {module:ol/render/canvas~FillState} */ ({});\n      }\n      fillState.fillStyle = asColorLike(\n        textFillStyle.getColor() || defaultFillStyle);\n    }\n\n    const textStrokeStyle = textStyle.getStroke();\n    if (!textStrokeStyle) {\n      strokeState = this.textStrokeState_ = null;\n    } else {\n      strokeState = this.textStrokeState_;\n      if (!strokeState) {\n        strokeState = this.textStrokeState_ = /** @type {module:ol/render/canvas~StrokeState} */ ({});\n      }\n      const lineDash = textStrokeStyle.getLineDash();\n      const lineDashOffset = textStrokeStyle.getLineDashOffset();\n      const lineWidth = textStrokeStyle.getWidth();\n      const miterLimit = textStrokeStyle.getMiterLimit();\n      strokeState.lineCap = textStrokeStyle.getLineCap() || defaultLineCap;\n      strokeState.lineDash = lineDash ? lineDash.slice() : defaultLineDash;\n      strokeState.lineDashOffset =\n          lineDashOffset === undefined ? defaultLineDashOffset : lineDashOffset;\n      strokeState.lineJoin = textStrokeStyle.getLineJoin() || defaultLineJoin;\n      strokeState.lineWidth =\n          lineWidth === undefined ? defaultLineWidth : lineWidth;\n      strokeState.miterLimit =\n          miterLimit === undefined ? defaultMiterLimit : miterLimit;\n      strokeState.strokeStyle = asColorLike(\n        textStrokeStyle.getColor() || defaultStrokeStyle);\n    }\n\n    textState = this.textState_;\n    const font = textStyle.getFont() || defaultFont;\n    checkFont(font);\n    const textScale = textStyle.getScale();\n    textState.overflow = textStyle.getOverflow();\n    textState.font = font;\n    textState.maxAngle = textStyle.getMaxAngle();\n    textState.placement = textStyle.getPlacement();\n    textState.textAlign = textStyle.getTextAlign();\n    textState.textBaseline = textStyle.getTextBaseline() || defaultTextBaseline;\n    textState.backgroundFill = textStyle.getBackgroundFill();\n    textState.backgroundStroke = textStyle.getBackgroundStroke();\n    textState.padding = textStyle.getPadding() || defaultPadding;\n    textState.scale = textScale === undefined ? 1 : textScale;\n\n    const textOffsetX = textStyle.getOffsetX();\n    const textOffsetY = textStyle.getOffsetY();\n    const textRotateWithView = textStyle.getRotateWithView();\n    const textRotation = textStyle.getRotation();\n    this.text_ = textStyle.getText() || '';\n    this.textOffsetX_ = textOffsetX === undefined ? 0 : textOffsetX;\n    this.textOffsetY_ = textOffsetY === undefined ? 0 : textOffsetY;\n    this.textRotateWithView_ = textRotateWithView === undefined ? false : textRotateWithView;\n    this.textRotation_ = textRotation === undefined ? 0 : textRotation;\n\n    this.strokeKey_ = strokeState ?\n      (typeof strokeState.strokeStyle == 'string' ? strokeState.strokeStyle : getUid(strokeState.strokeStyle)) +\n      strokeState.lineCap + strokeState.lineDashOffset + '|' + strokeState.lineWidth +\n      strokeState.lineJoin + strokeState.miterLimit + '[' + strokeState.lineDash.join() + ']' :\n      '';\n    this.textKey_ = textState.font + textState.scale + (textState.textAlign || '?');\n    this.fillKey_ = fillState ?\n      (typeof fillState.fillStyle == 'string' ? fillState.fillStyle : ('|' + getUid(fillState.fillStyle))) :\n      '';\n  }\n};\nexport default CanvasTextReplay;\n","/**\n * @module ol/render/canvas/ReplayGroup\n */\nimport {inherits} from '../../util.js';\nimport {numberSafeCompareFunction} from '../../array.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {buffer, createEmpty, extendCoordinate} from '../../extent.js';\nimport {transform2D} from '../../geom/flat/transform.js';\nimport {isEmpty} from '../../obj.js';\nimport ReplayGroup from '../ReplayGroup.js';\nimport ReplayType from '../ReplayType.js';\nimport CanvasReplay from '../canvas/Replay.js';\nimport CanvasImageReplay from '../canvas/ImageReplay.js';\nimport CanvasLineStringReplay from '../canvas/LineStringReplay.js';\nimport CanvasPolygonReplay from '../canvas/PolygonReplay.js';\nimport CanvasTextReplay from '../canvas/TextReplay.js';\nimport {ORDER} from '../replay.js';\nimport {create as createTransform, compose as composeTransform} from '../../transform.js';\n\n\n/**\n * @type {Object.<module:ol/render/ReplayType,\n *                function(new: module:ol/render/canvas/Replay, number, module:ol/extent~Extent,\n *                number, number, boolean, Array.<module:ol/render/canvas~DeclutterGroup>)>}\n */\nconst BATCH_CONSTRUCTORS = {\n  'Circle': CanvasPolygonReplay,\n  'Default': CanvasReplay,\n  'Image': CanvasImageReplay,\n  'LineString': CanvasLineStringReplay,\n  'Polygon': CanvasPolygonReplay,\n  'Text': CanvasTextReplay\n};\n\n\n/**\n * @constructor\n * @extends {module:ol/render/ReplayGroup}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {boolean} overlaps The replay group can have overlapping geometries.\n * @param {?} declutterTree Declutter tree\n * for declutter processing in postrender.\n * @param {number=} opt_renderBuffer Optional rendering buffer.\n * @struct\n */\nconst CanvasReplayGroup = function(\n  tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree, opt_renderBuffer) {\n  ReplayGroup.call(this);\n\n  /**\n   * Declutter tree.\n   * @private\n   */\n  this.declutterTree_ = declutterTree;\n\n  /**\n   * @type {module:ol/render/canvas~DeclutterGroup}\n   * @private\n   */\n  this.declutterGroup_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.tolerance_ = tolerance;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.maxExtent_ = maxExtent;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.overlaps_ = overlaps;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelRatio_ = pixelRatio;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.resolution_ = resolution;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.renderBuffer_ = opt_renderBuffer;\n\n  /**\n   * @private\n   * @type {!Object.<string, !Object.<module:ol/render/ReplayType, module:ol/render/canvas/Replay>>}\n   */\n  this.replaysByZIndex_ = {};\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.hitDetectionContext_ = createCanvasContext2D(1, 1);\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.hitDetectionTransform_ = createTransform();\n};\n\ninherits(CanvasReplayGroup, ReplayGroup);\n\n\n/**\n * This cache is used for storing calculated pixel circles for increasing performance.\n * It is a static property to allow each Replaygroup to access it.\n * @type {Object.<number, Array.<Array.<(boolean|undefined)>>>}\n */\nconst circleArrayCache = {\n  0: [[true]]\n};\n\n\n/**\n * This method fills a row in the array from the given coordinate to the\n * middle with `true`.\n * @param {Array.<Array.<(boolean|undefined)>>} array The array that will be altered.\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n */\nfunction fillCircleArrayRowToMiddle(array, x, y) {\n  let i;\n  const radius = Math.floor(array.length / 2);\n  if (x >= radius) {\n    for (i = radius; i < x; i++) {\n      array[i][y] = true;\n    }\n  } else if (x < radius) {\n    for (i = x + 1; i < radius; i++) {\n      array[i][y] = true;\n    }\n  }\n}\n\n\n/**\n * This methods creates a circle inside a fitting array. Points inside the\n * circle are marked by true, points on the outside are undefined.\n * It uses the midpoint circle algorithm.\n * A cache is used to increase performance.\n * @param {number} radius Radius.\n * @returns {Array.<Array.<(boolean|undefined)>>} An array with marked circle points.\n */\nexport function getCircleArray(radius) {\n  if (circleArrayCache[radius] !== undefined) {\n    return circleArrayCache[radius];\n  }\n\n  const arraySize = radius * 2 + 1;\n  const arr = new Array(arraySize);\n  for (let i = 0; i < arraySize; i++) {\n    arr[i] = new Array(arraySize);\n  }\n\n  let x = radius;\n  let y = 0;\n  let error = 0;\n\n  while (x >= y) {\n    fillCircleArrayRowToMiddle(arr, radius + x, radius + y);\n    fillCircleArrayRowToMiddle(arr, radius + y, radius + x);\n    fillCircleArrayRowToMiddle(arr, radius - y, radius + x);\n    fillCircleArrayRowToMiddle(arr, radius - x, radius + y);\n    fillCircleArrayRowToMiddle(arr, radius - x, radius - y);\n    fillCircleArrayRowToMiddle(arr, radius - y, radius - x);\n    fillCircleArrayRowToMiddle(arr, radius + y, radius - x);\n    fillCircleArrayRowToMiddle(arr, radius + x, radius - y);\n\n    y++;\n    error += 1 + 2 * y;\n    if (2 * (error - x) + 1 > 0) {\n      x -= 1;\n      error += 1 - 2 * x;\n    }\n  }\n\n  circleArrayCache[radius] = arr;\n  return arr;\n}\n\n\n/**\n * @param {!Object.<string, Array.<*>>} declutterReplays Declutter replays.\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n */\nexport function replayDeclutter(declutterReplays, context, rotation) {\n  const zs = Object.keys(declutterReplays).map(Number).sort(numberSafeCompareFunction);\n  const skippedFeatureUids = {};\n  for (let z = 0, zz = zs.length; z < zz; ++z) {\n    const replayData = declutterReplays[zs[z].toString()];\n    for (let i = 0, ii = replayData.length; i < ii;) {\n      const replay = replayData[i++];\n      const transform = replayData[i++];\n      replay.replay(context, transform, rotation, skippedFeatureUids);\n    }\n  }\n}\n\n\n/**\n * @param {boolean} group Group with previous replay.\n * @return {module:ol/render/canvas~DeclutterGroup} Declutter instruction group.\n */\nCanvasReplayGroup.prototype.addDeclutter = function(group) {\n  let declutter = null;\n  if (this.declutterTree_) {\n    if (group) {\n      declutter = this.declutterGroup_;\n      /** @type {number} */ (declutter[4])++;\n    } else {\n      declutter = this.declutterGroup_ = createEmpty();\n      declutter.push(1);\n    }\n  }\n  return declutter;\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform} transform Transform.\n */\nCanvasReplayGroup.prototype.clip = function(context, transform) {\n  const flatClipCoords = this.getClipCoords(transform);\n  context.beginPath();\n  context.moveTo(flatClipCoords[0], flatClipCoords[1]);\n  context.lineTo(flatClipCoords[2], flatClipCoords[3]);\n  context.lineTo(flatClipCoords[4], flatClipCoords[5]);\n  context.lineTo(flatClipCoords[6], flatClipCoords[7]);\n  context.clip();\n};\n\n\n/**\n * @param {Array.<module:ol/render/ReplayType>} replays Replays.\n * @return {boolean} Has replays of the provided types.\n */\nCanvasReplayGroup.prototype.hasReplays = function(replays) {\n  for (const zIndex in this.replaysByZIndex_) {\n    const candidates = this.replaysByZIndex_[zIndex];\n    for (let i = 0, ii = replays.length; i < ii; ++i) {\n      if (replays[i] in candidates) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nCanvasReplayGroup.prototype.finish = function() {\n  for (const zKey in this.replaysByZIndex_) {\n    const replays = this.replaysByZIndex_[zKey];\n    for (const replayKey in replays) {\n      replays[replayKey].finish();\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T} callback Feature callback.\n * @param {Object.<string, module:ol/render/canvas~DeclutterGroup>} declutterReplays Declutter replays.\n * @return {T|undefined} Callback result.\n * @template T\n */\nCanvasReplayGroup.prototype.forEachFeatureAtCoordinate = function(\n  coordinate, resolution, rotation, hitTolerance, skippedFeaturesHash, callback, declutterReplays) {\n\n  hitTolerance = Math.round(hitTolerance);\n  const contextSize = hitTolerance * 2 + 1;\n  const transform = composeTransform(this.hitDetectionTransform_,\n    hitTolerance + 0.5, hitTolerance + 0.5,\n    1 / resolution, -1 / resolution,\n    -rotation,\n    -coordinate[0], -coordinate[1]);\n  const context = this.hitDetectionContext_;\n\n  if (context.canvas.width !== contextSize || context.canvas.height !== contextSize) {\n    context.canvas.width = contextSize;\n    context.canvas.height = contextSize;\n  } else {\n    context.clearRect(0, 0, contextSize, contextSize);\n  }\n\n  /**\n   * @type {module:ol/extent~Extent}\n   */\n  let hitExtent;\n  if (this.renderBuffer_ !== undefined) {\n    hitExtent = createEmpty();\n    extendCoordinate(hitExtent, coordinate);\n    buffer(hitExtent, resolution * (this.renderBuffer_ + hitTolerance), hitExtent);\n  }\n\n  const mask = getCircleArray(hitTolerance);\n  let declutteredFeatures;\n  if (this.declutterTree_) {\n    declutteredFeatures = this.declutterTree_.all().map(function(entry) {\n      return entry.value;\n    });\n  }\n\n  let replayType;\n\n  /**\n   * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n   * @return {?} Callback result.\n   */\n  function featureCallback(feature) {\n    const imageData = context.getImageData(0, 0, contextSize, contextSize).data;\n    for (let i = 0; i < contextSize; i++) {\n      for (let j = 0; j < contextSize; j++) {\n        if (mask[i][j]) {\n          if (imageData[(j * contextSize + i) * 4 + 3] > 0) {\n            let result;\n            if (!(declutteredFeatures && (replayType == ReplayType.IMAGE || replayType == ReplayType.TEXT)) ||\n                declutteredFeatures.indexOf(feature) !== -1) {\n              result = callback(feature);\n            }\n            if (result) {\n              return result;\n            } else {\n              context.clearRect(0, 0, contextSize, contextSize);\n              return undefined;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /** @type {Array.<number>} */\n  const zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(numberSafeCompareFunction);\n\n  let i, j, replays, replay, result;\n  for (i = zs.length - 1; i >= 0; --i) {\n    const zIndexKey = zs[i].toString();\n    replays = this.replaysByZIndex_[zIndexKey];\n    for (j = ORDER.length - 1; j >= 0; --j) {\n      replayType = ORDER[j];\n      replay = replays[replayType];\n      if (replay !== undefined) {\n        if (declutterReplays &&\n            (replayType == ReplayType.IMAGE || replayType == ReplayType.TEXT)) {\n          const declutter = declutterReplays[zIndexKey];\n          if (!declutter) {\n            declutterReplays[zIndexKey] = [replay, transform.slice(0)];\n          } else {\n            declutter.push(replay, transform.slice(0));\n          }\n        } else {\n          result = replay.replayHitDetection(context, transform, rotation,\n            skippedFeaturesHash, featureCallback, hitExtent);\n          if (result) {\n            return result;\n          }\n        }\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @param {module:ol/transform~Transform} transform Transform.\n * @return {Array.<number>} Clip coordinates.\n */\nCanvasReplayGroup.prototype.getClipCoords = function(transform) {\n  const maxExtent = this.maxExtent_;\n  const minX = maxExtent[0];\n  const minY = maxExtent[1];\n  const maxX = maxExtent[2];\n  const maxY = maxExtent[3];\n  const flatClipCoords = [minX, minY, minX, maxY, maxX, maxY, maxX, minY];\n  transform2D(\n    flatClipCoords, 0, 8, 2, transform, flatClipCoords);\n  return flatClipCoords;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasReplayGroup.prototype.getReplay = function(zIndex, replayType) {\n  const zIndexKey = zIndex !== undefined ? zIndex.toString() : '0';\n  let replays = this.replaysByZIndex_[zIndexKey];\n  if (replays === undefined) {\n    replays = {};\n    this.replaysByZIndex_[zIndexKey] = replays;\n  }\n  let replay = replays[replayType];\n  if (replay === undefined) {\n    const Constructor = BATCH_CONSTRUCTORS[replayType];\n    replay = new Constructor(this.tolerance_, this.maxExtent_,\n      this.resolution_, this.pixelRatio_, this.overlaps_, this.declutterTree_);\n    replays[replayType] = replay;\n  }\n  return replay;\n};\n\n\n/**\n * @return {Object.<string, Object.<module:ol/render/ReplayType, module:ol/render/canvas/Replay>>} Replays.\n */\nCanvasReplayGroup.prototype.getReplays = function() {\n  return this.replaysByZIndex_;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasReplayGroup.prototype.isEmpty = function() {\n  return isEmpty(this.replaysByZIndex_);\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/transform~Transform} transform Transform.\n * @param {number} viewRotation View rotation.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {Array.<module:ol/render/ReplayType>=} opt_replayTypes Ordered replay types to replay.\n *     Default is {@link module:ol/render/replay~ORDER}\n * @param {Object.<string, module:ol/render/canvas~DeclutterGroup>=} opt_declutterReplays Declutter replays.\n */\nCanvasReplayGroup.prototype.replay = function(context,\n  transform, viewRotation, skippedFeaturesHash, opt_replayTypes, opt_declutterReplays) {\n\n  /** @type {Array.<number>} */\n  const zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(numberSafeCompareFunction);\n\n  // setup clipping so that the parts of over-simplified geometries are not\n  // visible outside the current extent when panning\n  context.save();\n  this.clip(context, transform);\n\n  const replayTypes = opt_replayTypes ? opt_replayTypes : ORDER;\n  let i, ii, j, jj, replays, replay;\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    const zIndexKey = zs[i].toString();\n    replays = this.replaysByZIndex_[zIndexKey];\n    for (j = 0, jj = replayTypes.length; j < jj; ++j) {\n      const replayType = replayTypes[j];\n      replay = replays[replayType];\n      if (replay !== undefined) {\n        if (opt_declutterReplays &&\n            (replayType == ReplayType.IMAGE || replayType == ReplayType.TEXT)) {\n          const declutter = opt_declutterReplays[zIndexKey];\n          if (!declutter) {\n            opt_declutterReplays[zIndexKey] = [replay, transform.slice(0)];\n          } else {\n            declutter.push(replay, transform.slice(0));\n          }\n        } else {\n          replay.replay(context, transform, viewRotation, skippedFeaturesHash);\n        }\n      }\n    }\n  }\n\n  context.restore();\n};\n\nexport default CanvasReplayGroup;\n","/**\n * @module ol/renderer/vector\n */\nimport {getUid} from '../util.js';\nimport ImageState from '../ImageState.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport ReplayType from '../render/ReplayType.js';\n\n\n/**\n * Tolerance for geometry simplification in device pixels.\n * @type {number}\n */\nconst SIMPLIFY_TOLERANCE = 0.5;\n\n\n/**\n * @const\n * @type {Object.<module:ol/geom/GeometryType,\n *                function(module:ol/render/ReplayGroup, module:ol/geom/Geometry,\n *                         module:ol/style/Style, Object)>}\n */\nconst GEOMETRY_RENDERERS = {\n  'Point': renderPointGeometry,\n  'LineString': renderLineStringGeometry,\n  'Polygon': renderPolygonGeometry,\n  'MultiPoint': renderMultiPointGeometry,\n  'MultiLineString': renderMultiLineStringGeometry,\n  'MultiPolygon': renderMultiPolygonGeometry,\n  'GeometryCollection': renderGeometryCollectionGeometry,\n  'Circle': renderCircleGeometry\n};\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature1 Feature 1.\n * @param {module:ol/Feature|module:ol/render/Feature} feature2 Feature 2.\n * @return {number} Order.\n */\nexport function defaultOrder(feature1, feature2) {\n  return getUid(feature1) - getUid(feature2);\n}\n\n\n/**\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @return {number} Squared pixel tolerance.\n */\nexport function getSquaredTolerance(resolution, pixelRatio) {\n  const tolerance = getTolerance(resolution, pixelRatio);\n  return tolerance * tolerance;\n}\n\n\n/**\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @return {number} Pixel tolerance.\n */\nexport function getTolerance(resolution, pixelRatio) {\n  return SIMPLIFY_TOLERANCE * resolution / pixelRatio;\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/Circle} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature} feature Feature.\n */\nfunction renderCircleGeometry(replayGroup, geometry, style, feature) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (fillStyle || strokeStyle) {\n    const circleReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.CIRCLE);\n    circleReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    circleReplay.drawCircle(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {module:ol/style/Style} style Style.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {function(this: T, module:ol/events/Event)} listener Listener function.\n * @param {T} thisArg Value to use as `this` when executing `listener`.\n * @return {boolean} `true` if style is loading.\n * @template T\n */\nexport function renderFeature(replayGroup, feature, style, squaredTolerance, listener, thisArg) {\n  let loading = false;\n  const imageStyle = style.getImage();\n  if (imageStyle) {\n    let imageState = imageStyle.getImageState();\n    if (imageState == ImageState.LOADED || imageState == ImageState.ERROR) {\n      imageStyle.unlistenImageChange(listener, thisArg);\n    } else {\n      if (imageState == ImageState.IDLE) {\n        imageStyle.load();\n      }\n      imageState = imageStyle.getImageState();\n      imageStyle.listenImageChange(listener, thisArg);\n      loading = true;\n    }\n  }\n  renderFeatureInternal(replayGroup, feature, style, squaredTolerance);\n\n  return loading;\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {module:ol/style/Style} style Style.\n * @param {number} squaredTolerance Squared tolerance.\n */\nfunction renderFeatureInternal(replayGroup, feature, style, squaredTolerance) {\n  const geometry = style.getGeometryFunction()(feature);\n  if (!geometry) {\n    return;\n  }\n  const simplifiedGeometry = geometry.getSimplifiedGeometry(squaredTolerance);\n  const renderer = style.getRenderer();\n  if (renderer) {\n    renderGeometry(replayGroup, simplifiedGeometry, style, feature);\n  } else {\n    const geometryRenderer = GEOMETRY_RENDERERS[simplifiedGeometry.getType()];\n    geometryRenderer(replayGroup, simplifiedGeometry, style, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderGeometry(replayGroup, geometry, style, feature) {\n  if (geometry.getType() == GeometryType.GEOMETRY_COLLECTION) {\n    const geometries = /** @type {module:ol/geom/GeometryCollection} */ (geometry).getGeometries();\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      renderGeometry(replayGroup, geometries[i], style, feature);\n    }\n    return;\n  }\n  const replay = replayGroup.getReplay(style.getZIndex(), ReplayType.DEFAULT);\n  replay.drawCustom(/** @type {module:ol/geom/SimpleGeometry} */ (geometry), feature, style.getRenderer());\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/GeometryCollection} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature} feature Feature.\n */\nfunction renderGeometryCollectionGeometry(replayGroup, geometry, style, feature) {\n  const geometries = geometry.getGeometriesArray();\n  let i, ii;\n  for (i = 0, ii = geometries.length; i < ii; ++i) {\n    const geometryRenderer =\n        GEOMETRY_RENDERERS[geometries[i].getType()];\n    geometryRenderer(replayGroup, geometries[i], style, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/LineString|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderLineStringGeometry(replayGroup, geometry, style, feature) {\n  const strokeStyle = style.getStroke();\n  if (strokeStyle) {\n    const lineStringReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.LINE_STRING);\n    lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n    lineStringReplay.drawLineString(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/MultiLineString|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderMultiLineStringGeometry(replayGroup, geometry, style, feature) {\n  const strokeStyle = style.getStroke();\n  if (strokeStyle) {\n    const lineStringReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.LINE_STRING);\n    lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n    lineStringReplay.drawMultiLineString(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/MultiPolygon} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature} feature Feature.\n */\nfunction renderMultiPolygonGeometry(replayGroup, geometry, style, feature) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (strokeStyle || fillStyle) {\n    const polygonReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.POLYGON);\n    polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    polygonReplay.drawMultiPolygon(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/Point|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderPointGeometry(replayGroup, geometry, style, feature) {\n  const imageStyle = style.getImage();\n  if (imageStyle) {\n    if (imageStyle.getImageState() != ImageState.LOADED) {\n      return;\n    }\n    const imageReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.IMAGE);\n    imageReplay.setImageStyle(imageStyle, replayGroup.addDeclutter(false));\n    imageReplay.drawPoint(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(!!imageStyle));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/MultiPoint|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderMultiPointGeometry(replayGroup, geometry, style, feature) {\n  const imageStyle = style.getImage();\n  if (imageStyle) {\n    if (imageStyle.getImageState() != ImageState.LOADED) {\n      return;\n    }\n    const imageReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.IMAGE);\n    imageReplay.setImageStyle(imageStyle, replayGroup.addDeclutter(false));\n    imageReplay.drawMultiPoint(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(!!imageStyle));\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n\n/**\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/Polygon|module:ol/render/Feature} geometry Geometry.\n * @param {module:ol/style/Style} style Style.\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n */\nfunction renderPolygonGeometry(replayGroup, geometry, style, feature) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (fillStyle || strokeStyle) {\n    const polygonReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.POLYGON);\n    polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    polygonReplay.drawPolygon(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle) {\n    const textReplay = replayGroup.getReplay(style.getZIndex(), ReplayType.TEXT);\n    textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));\n    textReplay.drawText(geometry, feature);\n  }\n}\n","/**\n * @module ol/renderer/canvas/VectorLayer\n */\nimport {getUid, inherits} from '../../util.js';\nimport LayerType from '../../LayerType.js';\nimport ViewHint from '../../ViewHint.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {listen, unlisten} from '../../events.js';\nimport EventType from '../../events/EventType.js';\nimport rbush from 'rbush';\nimport {buffer, createEmpty, containsExtent, getWidth} from '../../extent.js';\nimport RenderEventType from '../../render/EventType.js';\nimport {labelCache, rotateAtOffset} from '../../render/canvas.js';\nimport CanvasReplayGroup from '../../render/canvas/ReplayGroup.js';\nimport CanvasLayerRenderer from '../canvas/Layer.js';\nimport {defaultOrder as defaultRenderOrder, getTolerance as getRenderTolerance, getSquaredTolerance as getSquaredRenderTolerance, renderFeature} from '../vector.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/canvas/Layer}\n * @param {module:ol/layer/Vector} vectorLayer Vector layer.\n * @api\n */\nconst CanvasVectorLayerRenderer = function(vectorLayer) {\n\n  CanvasLayerRenderer.call(this, vectorLayer);\n\n  /**\n   * Declutter tree.\n   * @private\n   */\n  this.declutterTree_ = vectorLayer.getDeclutter() ? rbush(9, undefined) : null;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.dirty_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedResolution_ = NaN;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.renderedExtent_ = createEmpty();\n\n  /**\n   * @private\n   * @type {function(module:ol/Feature, module:ol/Feature): number|null}\n   */\n  this.renderedRenderOrder_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/render/canvas/ReplayGroup}\n   */\n  this.replayGroup_ = null;\n\n  /**\n   * A new replay group had to be created by `prepareFrame()`\n   * @type {boolean}\n   */\n  this.replayGroupChanged = true;\n\n  /**\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context = createCanvasContext2D();\n\n  listen(labelCache, EventType.CLEAR, this.handleFontsChanged_, this);\n\n};\n\ninherits(CanvasVectorLayerRenderer, CanvasLayerRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nCanvasVectorLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.VECTOR;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/canvas/VectorLayer} The layer renderer.\n */\nCanvasVectorLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new CanvasVectorLayerRenderer(/** @type {module:ol/layer/Vector} */ (layer));\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorLayerRenderer.prototype.disposeInternal = function() {\n  unlisten(labelCache, EventType.CLEAR, this.handleFontsChanged_, this);\n  CanvasLayerRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n */\nCanvasVectorLayerRenderer.prototype.compose = function(context, frameState, layerState) {\n  const extent = frameState.extent;\n  const pixelRatio = frameState.pixelRatio;\n  const skippedFeatureUids = layerState.managed ?\n    frameState.skippedFeatureUids : {};\n  const viewState = frameState.viewState;\n  const projection = viewState.projection;\n  const rotation = viewState.rotation;\n  const projectionExtent = projection.getExtent();\n  const vectorSource = /** @type {module:ol/source/Vector} */ (this.getLayer().getSource());\n\n  let transform = this.getTransform(frameState, 0);\n\n  // clipped rendering if layer extent is set\n  const clipExtent = layerState.extent;\n  const clipped = clipExtent !== undefined;\n  if (clipped) {\n    this.clip(context, frameState,  /** @type {module:ol/extent~Extent} */ (clipExtent));\n  }\n  const replayGroup = this.replayGroup_;\n  if (replayGroup && !replayGroup.isEmpty()) {\n    if (this.declutterTree_) {\n      this.declutterTree_.clear();\n    }\n    const layer = /** @type {module:ol/layer/Vector} */ (this.getLayer());\n    let drawOffsetX = 0;\n    let drawOffsetY = 0;\n    let replayContext;\n    const transparentLayer = layerState.opacity !== 1;\n    const hasRenderListeners = layer.hasListener(RenderEventType.RENDER);\n    if (transparentLayer || hasRenderListeners) {\n      let drawWidth = context.canvas.width;\n      let drawHeight = context.canvas.height;\n      if (rotation) {\n        const drawSize = Math.round(Math.sqrt(drawWidth * drawWidth + drawHeight * drawHeight));\n        drawOffsetX = (drawSize - drawWidth) / 2;\n        drawOffsetY = (drawSize - drawHeight) / 2;\n        drawWidth = drawHeight = drawSize;\n      }\n      // resize and clear\n      this.context.canvas.width = drawWidth;\n      this.context.canvas.height = drawHeight;\n      replayContext = this.context;\n    } else {\n      replayContext = context;\n    }\n\n    const alpha = replayContext.globalAlpha;\n    if (!transparentLayer) {\n      // for performance reasons, context.save / context.restore is not used\n      // to save and restore the transformation matrix and the opacity.\n      // see http://jsperf.com/context-save-restore-versus-variable\n      replayContext.globalAlpha = layerState.opacity;\n    }\n\n    if (replayContext != context) {\n      replayContext.translate(drawOffsetX, drawOffsetY);\n    }\n\n    const width = frameState.size[0] * pixelRatio;\n    const height = frameState.size[1] * pixelRatio;\n    rotateAtOffset(replayContext, -rotation,\n      width / 2, height / 2);\n    replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);\n    if (vectorSource.getWrapX() && projection.canWrapX() &&\n        !containsExtent(projectionExtent, extent)) {\n      let startX = extent[0];\n      const worldWidth = getWidth(projectionExtent);\n      let world = 0;\n      let offsetX;\n      while (startX < projectionExtent[0]) {\n        --world;\n        offsetX = worldWidth * world;\n        transform = this.getTransform(frameState, offsetX);\n        replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);\n        startX += worldWidth;\n      }\n      world = 0;\n      startX = extent[2];\n      while (startX > projectionExtent[2]) {\n        ++world;\n        offsetX = worldWidth * world;\n        transform = this.getTransform(frameState, offsetX);\n        replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);\n        startX -= worldWidth;\n      }\n    }\n    rotateAtOffset(replayContext, rotation,\n      width / 2, height / 2);\n\n    if (replayContext != context) {\n      if (hasRenderListeners) {\n        this.dispatchRenderEvent(replayContext, frameState, transform);\n      }\n      if (transparentLayer) {\n        const mainContextAlpha = context.globalAlpha;\n        context.globalAlpha = layerState.opacity;\n        context.drawImage(replayContext.canvas, -drawOffsetX, -drawOffsetY);\n        context.globalAlpha = mainContextAlpha;\n      } else {\n        context.drawImage(replayContext.canvas, -drawOffsetX, -drawOffsetY);\n      }\n      replayContext.translate(-drawOffsetX, -drawOffsetY);\n    }\n\n    if (!transparentLayer) {\n      replayContext.globalAlpha = alpha;\n    }\n  }\n\n  if (clipped) {\n    context.restore();\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorLayerRenderer.prototype.composeFrame = function(frameState, layerState, context) {\n  const transform = this.getTransform(frameState, 0);\n  this.preCompose(context, frameState, transform);\n  this.compose(context, frameState, layerState);\n  this.postCompose(context, frameState, layerState, transform);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (!this.replayGroup_) {\n    return undefined;\n  } else {\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    const layer = /** @type {module:ol/layer/Vector} */ (this.getLayer());\n    /** @type {!Object.<string, boolean>} */\n    const features = {};\n    const result = this.replayGroup_.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, {},\n      /**\n       * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n       * @return {?} Callback result.\n       */\n      function(feature) {\n        const key = getUid(feature).toString();\n        if (!(key in features)) {\n          features[key] = true;\n          return callback.call(thisArg, feature, layer);\n        }\n      }, null);\n    return result;\n  }\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n */\nCanvasVectorLayerRenderer.prototype.handleFontsChanged_ = function(event) {\n  const layer = this.getLayer();\n  if (layer.getVisible() && this.replayGroup_) {\n    layer.changed();\n  }\n};\n\n\n/**\n * Handle changes in image style state.\n * @param {module:ol/events/Event} event Image style change event.\n * @private\n */\nCanvasVectorLayerRenderer.prototype.handleStyleImageChange_ = function(event) {\n  this.renderIfReadyAndVisible();\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorLayerRenderer.prototype.prepareFrame = function(frameState, layerState) {\n  const vectorLayer = /** @type {module:ol/layer/Vector} */ (this.getLayer());\n  const vectorSource = vectorLayer.getSource();\n\n  const animating = frameState.viewHints[ViewHint.ANIMATING];\n  const interacting = frameState.viewHints[ViewHint.INTERACTING];\n  const updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n  const updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n  if (!this.dirty_ && (!updateWhileAnimating && animating) ||\n      (!updateWhileInteracting && interacting)) {\n    return true;\n  }\n\n  const frameStateExtent = frameState.extent;\n  const viewState = frameState.viewState;\n  const projection = viewState.projection;\n  const resolution = viewState.resolution;\n  const pixelRatio = frameState.pixelRatio;\n  const vectorLayerRevision = vectorLayer.getRevision();\n  const vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n  let vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n  if (vectorLayerRenderOrder === undefined) {\n    vectorLayerRenderOrder = defaultRenderOrder;\n  }\n\n  const extent = buffer(frameStateExtent,\n    vectorLayerRenderBuffer * resolution);\n  const projectionExtent = viewState.projection.getExtent();\n\n  if (vectorSource.getWrapX() && viewState.projection.canWrapX() &&\n      !containsExtent(projectionExtent, frameState.extent)) {\n    // For the replay group, we need an extent that intersects the real world\n    // (-180 to +180). To support geometries in a coordinate range from -540\n    // to +540, we add at least 1 world width on each side of the projection\n    // extent. If the viewport is wider than the world, we need to add half of\n    // the viewport width to make sure we cover the whole viewport.\n    const worldWidth = getWidth(projectionExtent);\n    const gutter = Math.max(getWidth(extent) / 2, worldWidth);\n    extent[0] = projectionExtent[0] - gutter;\n    extent[2] = projectionExtent[2] + gutter;\n  }\n\n  if (!this.dirty_ &&\n      this.renderedResolution_ == resolution &&\n      this.renderedRevision_ == vectorLayerRevision &&\n      this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n      containsExtent(this.renderedExtent_, extent)) {\n    this.replayGroupChanged = false;\n    return true;\n  }\n\n  this.replayGroup_ = null;\n\n  this.dirty_ = false;\n\n  const replayGroup = new CanvasReplayGroup(\n    getRenderTolerance(resolution, pixelRatio), extent, resolution,\n    pixelRatio, vectorSource.getOverlaps(), this.declutterTree_, vectorLayer.getRenderBuffer());\n  vectorSource.loadFeatures(extent, resolution, projection);\n  /**\n   * @param {module:ol/Feature} feature Feature.\n   * @this {module:ol/renderer/canvas/VectorLayer}\n   */\n  const render = function(feature) {\n    let styles;\n    const styleFunction = feature.getStyleFunction() || vectorLayer.getStyleFunction();\n    if (styleFunction) {\n      styles = styleFunction(feature, resolution);\n    }\n    if (styles) {\n      const dirty = this.renderFeature(\n        feature, resolution, pixelRatio, styles, replayGroup);\n      this.dirty_ = this.dirty_ || dirty;\n    }\n  }.bind(this);\n  if (vectorLayerRenderOrder) {\n    /** @type {Array.<module:ol/Feature>} */\n    const features = [];\n    vectorSource.forEachFeatureInExtent(extent,\n      /**\n       * @param {module:ol/Feature} feature Feature.\n       */\n      function(feature) {\n        features.push(feature);\n      }, this);\n    features.sort(vectorLayerRenderOrder);\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      render(features[i]);\n    }\n  } else {\n    vectorSource.forEachFeatureInExtent(extent, render, this);\n  }\n  replayGroup.finish();\n\n  this.renderedResolution_ = resolution;\n  this.renderedRevision_ = vectorLayerRevision;\n  this.renderedRenderOrder_ = vectorLayerRenderOrder;\n  this.renderedExtent_ = extent;\n  this.replayGroup_ = replayGroup;\n\n  this.replayGroupChanged = true;\n  return true;\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {(module:ol/style/Style|Array.<module:ol/style/Style>)} styles The style or array of styles.\n * @param {module:ol/render/canvas/ReplayGroup} replayGroup Replay group.\n * @return {boolean} `true` if an image is loading.\n */\nCanvasVectorLayerRenderer.prototype.renderFeature = function(feature, resolution, pixelRatio, styles, replayGroup) {\n  if (!styles) {\n    return false;\n  }\n  let loading = false;\n  if (Array.isArray(styles)) {\n    for (let i = 0, ii = styles.length; i < ii; ++i) {\n      loading = renderFeature(\n        replayGroup, feature, styles[i],\n        getSquaredRenderTolerance(resolution, pixelRatio),\n        this.handleStyleImageChange_, this) || loading;\n    }\n  } else {\n    loading = renderFeature(\n      replayGroup, feature, styles,\n      getSquaredRenderTolerance(resolution, pixelRatio),\n      this.handleStyleImageChange_, this);\n  }\n  return loading;\n};\nexport default CanvasVectorLayerRenderer;\n","/**\n * @module ol/layer/VectorTileRenderType\n */\n\n/**\n * @enum {string}\n * Render mode for vector tiles:\n *  * `'image'`: Vector tiles are rendered as images. Great performance, but\n *    point symbols and texts are always rotated with the view and pixels are\n *    scaled during zoom animations.\n *  * `'hybrid'`: Polygon and line elements are rendered as images, so pixels\n *    are scaled during zoom animations. Point symbols and texts are accurately\n *    rendered as vectors and can stay upright on rotated views.\n *  * `'vector'`: Vector tiles are rendered as vectors. Most accurate rendering\n *    even during animations, but slower performance than the other options.\n * @api\n */\nexport default {\n  IMAGE: 'image',\n  HYBRID: 'hybrid',\n  VECTOR: 'vector'\n};\n","/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\nimport {getUid, inherits} from '../../util.js';\nimport LayerType from '../../LayerType.js';\nimport TileState from '../../TileState.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {listen, unlisten} from '../../events.js';\nimport EventType from '../../events/EventType.js';\nimport rbush from 'rbush';\nimport {buffer, containsCoordinate, equals, getIntersection, getTopLeft, intersects} from '../../extent.js';\nimport VectorTileRenderType from '../../layer/VectorTileRenderType.js';\nimport {equivalent as equivalentProjection} from '../../proj.js';\nimport Units from '../../proj/Units.js';\nimport ReplayType from '../../render/ReplayType.js';\nimport {labelCache, rotateAtOffset} from '../../render/canvas.js';\nimport CanvasReplayGroup, {replayDeclutter} from '../../render/canvas/ReplayGroup.js';\nimport {ORDER} from '../../render/replay.js';\nimport CanvasTileLayerRenderer from '../canvas/TileLayer.js';\nimport {getSquaredTolerance as getSquaredRenderTolerance, renderFeature} from '../vector.js';\nimport {\n  create as createTransform,\n  compose as composeTransform,\n  reset as resetTransform,\n  scale as scaleTransform,\n  translate as translateTransform\n} from '../../transform.js';\n\n\n/**\n * @type {!Object.<string, Array.<module:ol/render/ReplayType>>}\n */\nconst IMAGE_REPLAYS = {\n  'image': [ReplayType.POLYGON, ReplayType.CIRCLE,\n    ReplayType.LINE_STRING, ReplayType.IMAGE, ReplayType.TEXT],\n  'hybrid': [ReplayType.POLYGON, ReplayType.LINE_STRING]\n};\n\n\n/**\n * @type {!Object.<string, Array.<module:ol/render/ReplayType>>}\n */\nconst VECTOR_REPLAYS = {\n  'image': [ReplayType.DEFAULT],\n  'hybrid': [ReplayType.IMAGE, ReplayType.TEXT, ReplayType.DEFAULT],\n  'vector': ORDER\n};\n\n\n/**\n * @constructor\n * @extends {module:ol/renderer/canvas/TileLayer}\n * @param {module:ol/layer/VectorTile} layer VectorTile layer.\n * @api\n */\nconst CanvasVectorTileLayerRenderer = function(layer) {\n\n  /**\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context = null;\n\n  CanvasTileLayerRenderer.call(this, layer);\n\n  /**\n   * Declutter tree.\n   * @private\n   */\n  this.declutterTree_ = layer.getDeclutter() ? rbush(9, undefined) : null;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.dirty_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedLayerRevision_;\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.tmpTransform_ = createTransform();\n\n  // Use lower resolution for pure vector rendering. Closest resolution otherwise.\n  this.zDirection = layer.getRenderMode() == VectorTileRenderType.VECTOR ? 1 : 0;\n\n  listen(labelCache, EventType.CLEAR, this.handleFontsChanged_, this);\n\n};\n\ninherits(CanvasVectorTileLayerRenderer, CanvasTileLayerRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nCanvasVectorTileLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.VECTOR_TILE;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/canvas/VectorTileLayer} The layer renderer.\n */\nCanvasVectorTileLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new CanvasVectorTileLayerRenderer(/** @type {module:ol/layer/VectorTile} */ (layer));\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorTileLayerRenderer.prototype.disposeInternal = function() {\n  unlisten(labelCache, EventType.CLEAR, this.handleFontsChanged_, this);\n  CanvasTileLayerRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorTileLayerRenderer.prototype.getTile = function(z, x, y, pixelRatio, projection) {\n  const tile = CanvasTileLayerRenderer.prototype.getTile.call(this, z, x, y, pixelRatio, projection);\n  if (tile.getState() === TileState.LOADED) {\n    this.createReplayGroup_(tile, pixelRatio, projection);\n    if (this.context) {\n      this.renderTileImage_(tile, pixelRatio, projection);\n    }\n  }\n  return tile;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorTileLayerRenderer.prototype.prepareFrame = function(frameState, layerState) {\n  const layer = this.getLayer();\n  const layerRevision = layer.getRevision();\n  if (this.renderedLayerRevision_ != layerRevision) {\n    this.renderedTiles.length = 0;\n    const renderMode = layer.getRenderMode();\n    if (!this.context && renderMode != VectorTileRenderType.VECTOR) {\n      this.context = createCanvasContext2D();\n    }\n    if (this.context && renderMode == VectorTileRenderType.VECTOR) {\n      this.context = null;\n    }\n  }\n  this.renderedLayerRevision_ = layerRevision;\n  return CanvasTileLayerRenderer.prototype.prepareFrame.apply(this, arguments);\n};\n\n\n/**\n * @param {module:ol/VectorImageTile} tile Tile.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @private\n */\nCanvasVectorTileLayerRenderer.prototype.createReplayGroup_ = function(tile, pixelRatio, projection) {\n  const layer = this.getLayer();\n  const revision = layer.getRevision();\n  const renderOrder = /** @type {module:ol/render~OrderFunction} */ (layer.getRenderOrder()) || null;\n\n  const replayState = tile.getReplayState(layer);\n  if (!replayState.dirty && replayState.renderedRevision == revision &&\n      replayState.renderedRenderOrder == renderOrder) {\n    return;\n  }\n\n  const source = /** @type {module:ol/source/VectorTile} */ (layer.getSource());\n  const sourceTileGrid = source.getTileGrid();\n  const tileGrid = source.getTileGridForProjection(projection);\n  const resolution = tileGrid.getResolution(tile.tileCoord[0]);\n  const tileExtent = tile.extent;\n\n  const zIndexKeys = {};\n  for (let t = 0, tt = tile.tileKeys.length; t < tt; ++t) {\n    const sourceTile = tile.getTile(tile.tileKeys[t]);\n    if (sourceTile.getState() != TileState.LOADED) {\n      continue;\n    }\n\n    const sourceTileCoord = sourceTile.tileCoord;\n    const sourceTileExtent = sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n    const sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n    const bufferedExtent = equals(sourceTileExtent, sharedExtent) ? null :\n      buffer(sharedExtent, layer.getRenderBuffer() * resolution, this.tmpExtent);\n    const tileProjection = sourceTile.getProjection();\n    let reproject = false;\n    if (!equivalentProjection(projection, tileProjection)) {\n      reproject = true;\n      sourceTile.setProjection(projection);\n    }\n    replayState.dirty = false;\n    const replayGroup = new CanvasReplayGroup(0, sharedExtent, resolution,\n      pixelRatio, source.getOverlaps(), this.declutterTree_, layer.getRenderBuffer());\n    const squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n\n    /**\n     * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n     * @this {module:ol/renderer/canvas/VectorTileLayer}\n     */\n    const render = function(feature) {\n      let styles;\n      const styleFunction = feature.getStyleFunction() || layer.getStyleFunction();\n      if (styleFunction) {\n        styles = styleFunction(feature, resolution);\n      }\n      if (styles) {\n        const dirty = this.renderFeature(feature, squaredTolerance, styles, replayGroup);\n        this.dirty_ = this.dirty_ || dirty;\n        replayState.dirty = replayState.dirty || dirty;\n      }\n    };\n\n    const features = sourceTile.getFeatures();\n    if (renderOrder && renderOrder !== replayState.renderedRenderOrder) {\n      features.sort(renderOrder);\n    }\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      const feature = features[i];\n      if (reproject) {\n        if (tileProjection.getUnits() == Units.TILE_PIXELS) {\n          // projected tile extent\n          tileProjection.setWorldExtent(sourceTileExtent);\n          // tile extent in tile pixel space\n          tileProjection.setExtent(sourceTile.getExtent());\n        }\n        feature.getGeometry().transform(tileProjection, projection);\n      }\n      if (!bufferedExtent || intersects(bufferedExtent, feature.getGeometry().getExtent())) {\n        render.call(this, feature);\n      }\n    }\n    replayGroup.finish();\n    for (const r in replayGroup.getReplays()) {\n      zIndexKeys[r] = true;\n    }\n    sourceTile.setReplayGroup(layer, tile.tileCoord.toString(), replayGroup);\n  }\n  replayState.renderedRevision = revision;\n  replayState.renderedRenderOrder = renderOrder;\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  const resolution = frameState.viewState.resolution;\n  const rotation = frameState.viewState.rotation;\n  hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n  const layer = this.getLayer();\n  /** @type {!Object.<string, boolean>} */\n  const features = {};\n\n  /** @type {Array.<module:ol/VectorImageTile>} */\n  const renderedTiles = this.renderedTiles;\n\n  let bufferedExtent, found;\n  let i, ii, replayGroup;\n  for (i = 0, ii = renderedTiles.length; i < ii; ++i) {\n    const tile = renderedTiles[i];\n    bufferedExtent = buffer(tile.extent, hitTolerance * resolution, bufferedExtent);\n    if (!containsCoordinate(bufferedExtent, coordinate)) {\n      continue;\n    }\n    for (let t = 0, tt = tile.tileKeys.length; t < tt; ++t) {\n      const sourceTile = tile.getTile(tile.tileKeys[t]);\n      if (sourceTile.getState() != TileState.LOADED) {\n        continue;\n      }\n      replayGroup = sourceTile.getReplayGroup(layer, tile.tileCoord.toString());\n      found = found || replayGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, {},\n        /**\n         * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n         * @return {?} Callback result.\n         */\n        function(feature) {\n          const key = getUid(feature).toString();\n          if (!(key in features)) {\n            features[key] = true;\n            return callback.call(thisArg, feature, layer);\n          }\n        }, null);\n    }\n  }\n  return found;\n};\n\n\n/**\n * @param {module:ol/VectorTile} tile Tile.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @return {module:ol/transform~Transform} transform Transform.\n * @private\n */\nCanvasVectorTileLayerRenderer.prototype.getReplayTransform_ = function(tile, frameState) {\n  const layer = this.getLayer();\n  const source = /** @type {module:ol/source/VectorTile} */ (layer.getSource());\n  const tileGrid = source.getTileGrid();\n  const tileCoord = tile.tileCoord;\n  const tileResolution = tileGrid.getResolution(tileCoord[0]);\n  const viewState = frameState.viewState;\n  const pixelRatio = frameState.pixelRatio;\n  const renderResolution = viewState.resolution / pixelRatio;\n  const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n  const center = viewState.center;\n  const origin = getTopLeft(tileExtent);\n  const size = frameState.size;\n  const offsetX = Math.round(pixelRatio * size[0] / 2);\n  const offsetY = Math.round(pixelRatio * size[1] / 2);\n  return composeTransform(this.tmpTransform_,\n    offsetX, offsetY,\n    tileResolution / renderResolution, tileResolution / renderResolution,\n    viewState.rotation,\n    (origin[0] - center[0]) / tileResolution,\n    (center[1] - origin[1]) / tileResolution);\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n */\nCanvasVectorTileLayerRenderer.prototype.handleFontsChanged_ = function(event) {\n  const layer = this.getLayer();\n  if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n    layer.changed();\n  }\n};\n\n\n/**\n * Handle changes in image style state.\n * @param {module:ol/events/Event} event Image style change event.\n * @private\n */\nCanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_ = function(event) {\n  this.renderIfReadyAndVisible();\n};\n\n\n/**\n * @inheritDoc\n */\nCanvasVectorTileLayerRenderer.prototype.postCompose = function(context, frameState, layerState) {\n  const layer = this.getLayer();\n  const renderMode = layer.getRenderMode();\n  if (renderMode != VectorTileRenderType.IMAGE) {\n    const declutterReplays = layer.getDeclutter() ? {} : null;\n    const source = /** @type {module:ol/source/VectorTile} */ (layer.getSource());\n    const replayTypes = VECTOR_REPLAYS[renderMode];\n    const pixelRatio = frameState.pixelRatio;\n    const rotation = frameState.viewState.rotation;\n    const size = frameState.size;\n    let offsetX, offsetY;\n    if (rotation) {\n      offsetX = Math.round(pixelRatio * size[0] / 2);\n      offsetY = Math.round(pixelRatio * size[1] / 2);\n      rotateAtOffset(context, -rotation, offsetX, offsetY);\n    }\n    if (declutterReplays) {\n      this.declutterTree_.clear();\n    }\n    const tiles = this.renderedTiles;\n    const tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n    const clips = [];\n    const zs = [];\n    for (let i = tiles.length - 1; i >= 0; --i) {\n      const tile = /** @type {module:ol/VectorImageTile} */ (tiles[i]);\n      if (tile.getState() == TileState.ABORT) {\n        continue;\n      }\n      const tileCoord = tile.tileCoord;\n      const worldOffset = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent)[0] - tile.extent[0];\n      let transform = undefined;\n      for (let t = 0, tt = tile.tileKeys.length; t < tt; ++t) {\n        const sourceTile = tile.getTile(tile.tileKeys[t]);\n        if (sourceTile.getState() != TileState.LOADED) {\n          continue;\n        }\n        const replayGroup = sourceTile.getReplayGroup(layer, tileCoord.toString());\n        if (renderMode != VectorTileRenderType.VECTOR && !replayGroup.hasReplays(replayTypes)) {\n          continue;\n        }\n        if (!transform) {\n          transform = this.getTransform(frameState, worldOffset);\n        }\n        const currentZ = sourceTile.tileCoord[0];\n        const currentClip = replayGroup.getClipCoords(transform);\n        context.save();\n        context.globalAlpha = layerState.opacity;\n        // Create a clip mask for regions in this low resolution tile that are\n        // already filled by a higher resolution tile\n        for (let j = 0, jj = clips.length; j < jj; ++j) {\n          const clip = clips[j];\n          if (currentZ < zs[j]) {\n            context.beginPath();\n            // counter-clockwise (outer ring) for current tile\n            context.moveTo(currentClip[0], currentClip[1]);\n            context.lineTo(currentClip[2], currentClip[3]);\n            context.lineTo(currentClip[4], currentClip[5]);\n            context.lineTo(currentClip[6], currentClip[7]);\n            // clockwise (inner ring) for higher resolution tile\n            context.moveTo(clip[6], clip[7]);\n            context.lineTo(clip[4], clip[5]);\n            context.lineTo(clip[2], clip[3]);\n            context.lineTo(clip[0], clip[1]);\n            context.clip();\n          }\n        }\n        replayGroup.replay(context, transform, rotation, {}, replayTypes, declutterReplays);\n        context.restore();\n        clips.push(currentClip);\n        zs.push(currentZ);\n      }\n    }\n    if (declutterReplays) {\n      replayDeclutter(declutterReplays, context, rotation);\n    }\n    if (rotation) {\n      rotateAtOffset(context, rotation,\n        /** @type {number} */ (offsetX), /** @type {number} */ (offsetY));\n    }\n  }\n  CanvasTileLayerRenderer.prototype.postCompose.apply(this, arguments);\n};\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {(module:ol/style/Style|Array.<module:ol/style/Style>)} styles The style or array of styles.\n * @param {module:ol/render/canvas/ReplayGroup} replayGroup Replay group.\n * @return {boolean} `true` if an image is loading.\n */\nCanvasVectorTileLayerRenderer.prototype.renderFeature = function(feature, squaredTolerance, styles, replayGroup) {\n  if (!styles) {\n    return false;\n  }\n  let loading = false;\n  if (Array.isArray(styles)) {\n    for (let i = 0, ii = styles.length; i < ii; ++i) {\n      loading = renderFeature(\n        replayGroup, feature, styles[i], squaredTolerance,\n        this.handleStyleImageChange_, this) || loading;\n    }\n  } else {\n    loading = renderFeature(\n      replayGroup, feature, styles, squaredTolerance,\n      this.handleStyleImageChange_, this);\n  }\n  return loading;\n};\n\n\n/**\n * @param {module:ol/VectorImageTile} tile Tile.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @private\n */\nCanvasVectorTileLayerRenderer.prototype.renderTileImage_ = function(\n  tile, pixelRatio, projection) {\n  const layer = this.getLayer();\n  const replayState = tile.getReplayState(layer);\n  const revision = layer.getRevision();\n  const replays = IMAGE_REPLAYS[layer.getRenderMode()];\n  if (replays && replayState.renderedTileRevision !== revision) {\n    replayState.renderedTileRevision = revision;\n    const tileCoord = tile.wrappedTileCoord;\n    const z = tileCoord[0];\n    const source = /** @type {module:ol/source/VectorTile} */ (layer.getSource());\n    const tileGrid = source.getTileGridForProjection(projection);\n    const resolution = tileGrid.getResolution(z);\n    const context = tile.getContext(layer);\n    const size = source.getTilePixelSize(z, pixelRatio, projection);\n    context.canvas.width = size[0];\n    context.canvas.height = size[1];\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n    for (let i = 0, ii = tile.tileKeys.length; i < ii; ++i) {\n      const sourceTile = tile.getTile(tile.tileKeys[i]);\n      if (sourceTile.getState() != TileState.LOADED) {\n        continue;\n      }\n      const pixelScale = pixelRatio / resolution;\n      const transform = resetTransform(this.tmpTransform_);\n      scaleTransform(transform, pixelScale, -pixelScale);\n      translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n      const replayGroup = sourceTile.getReplayGroup(layer, tile.tileCoord.toString());\n      replayGroup.replay(context, transform, 0, {}, replays);\n    }\n  }\n};\n\nexport default CanvasVectorTileLayerRenderer;\n","/**\n * @module ol/Map\n */\nimport {inherits} from './util.js';\nimport PluggableMap from './PluggableMap.js';\nimport {defaults as defaultControls} from './control/util.js';\nimport {defaults as defaultInteractions} from './interaction.js';\nimport {assign} from './obj.js';\nimport CanvasImageLayerRenderer from './renderer/canvas/ImageLayer.js';\nimport CanvasMapRenderer from './renderer/canvas/Map.js';\nimport CanvasTileLayerRenderer from './renderer/canvas/TileLayer.js';\nimport CanvasVectorLayerRenderer from './renderer/canvas/VectorLayer.js';\nimport CanvasVectorTileLayerRenderer from './renderer/canvas/VectorTileLayer.js';\n\n/**\n * @classdesc\n * The map is the core component of OpenLayers. For a map to render, a view,\n * one or more layers, and a target container are needed:\n *\n *     import Map from 'ol/Map';\n *     import View from 'ol/View';\n *     import TileLayer from 'ol/layer/Tile';\n *     import OSM from 'ol/source/OSM';\n *\n *     var map = new Map({\n *       view: new View({\n *         center: [0, 0],\n *         zoom: 1\n *       }),\n *       layers: [\n *         new TileLayer({\n *           source: new OSM()\n *         })\n *       ],\n *       target: 'map'\n *     });\n *\n * The above snippet creates a map using a {@link module:ol/layer/Tile} to\n * display {@link module:ol/source/OSM~OSM} OSM data and render it to a DOM\n * element with the id `map`.\n *\n * The constructor places a viewport container (with CSS class name\n * `ol-viewport`) in the target element (see `getViewport()`), and then two\n * further elements within the viewport: one with CSS class name\n * `ol-overlaycontainer-stopevent` for controls and some overlays, and one with\n * CSS class name `ol-overlaycontainer` for other overlays (see the `stopEvent`\n * option of {@link module:ol/Overlay~Overlay} for the difference). The map\n * itself is placed in a further element within the viewport.\n *\n * Layers are stored as a {@link module:ol/Collection~Collection} in\n * layerGroups. A top-level group is provided by the library. This is what is\n * accessed by `getLayerGroup` and `setLayerGroup`. Layers entered in the\n * options are added to this group, and `addLayer` and `removeLayer` change the\n * layer collection in the group. `getLayers` is a convenience function for\n * `getLayerGroup().getLayers()`. Note that {@link module:ol/layer/Group~Group}\n * is a subclass of {@link module:ol/layer/Base}, so layers entered in the\n * options or added with `addLayer` can be groups, which can contain further\n * groups, and so on.\n *\n * @constructor\n * @extends {module:ol/PluggableMap}\n * @param {module:ol/PluggableMap~MapOptions} options Map options.\n * @fires module:ol/MapBrowserEvent~MapBrowserEvent\n * @fires module:ol/MapEvent~MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @api\n */\nconst Map = function(options) {\n  options = assign({}, options);\n  if (!options.controls) {\n    options.controls = defaultControls();\n  }\n  if (!options.interactions) {\n    options.interactions = defaultInteractions();\n  }\n\n  PluggableMap.call(this, options);\n};\n\ninherits(Map, PluggableMap);\n\nMap.prototype.createRenderer = function() {\n  const renderer = new CanvasMapRenderer(this);\n  renderer.registerLayerRenderers([\n    CanvasImageLayerRenderer,\n    CanvasTileLayerRenderer,\n    CanvasVectorLayerRenderer,\n    CanvasVectorTileLayerRenderer\n  ]);\n  return renderer;\n};\n\nexport default Map;\n","/**\n * @module ol/OverlayPositioning\n */\n\n/**\n * Overlay position: `'bottom-left'`, `'bottom-center'`,  `'bottom-right'`,\n * `'center-left'`, `'center-center'`, `'center-right'`, `'top-left'`,\n * `'top-center'`, `'top-right'`\n * @enum {string}\n */\nexport default {\n  BOTTOM_LEFT: 'bottom-left',\n  BOTTOM_CENTER: 'bottom-center',\n  BOTTOM_RIGHT: 'bottom-right',\n  CENTER_LEFT: 'center-left',\n  CENTER_CENTER: 'center-center',\n  CENTER_RIGHT: 'center-right',\n  TOP_LEFT: 'top-left',\n  TOP_CENTER: 'top-center',\n  TOP_RIGHT: 'top-right'\n};\n","/**\n * @module ol/Overlay\n */\nimport {inherits} from './util.js';\nimport MapEventType from './MapEventType.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport OverlayPositioning from './OverlayPositioning.js';\nimport {CLASS_SELECTABLE} from './css.js';\nimport {removeNode, removeChildren, outerWidth, outerHeight} from './dom.js';\nimport {listen, unlistenByKey} from './events.js';\nimport {containsExtent} from './extent.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number|string} [id] Set the overlay id. The overlay id can be used\n * with the {@link module:ol/Map~Map#getOverlayById} method.\n * @property {Element} [element] The overlay element.\n * @property {Array.<number>} [offset=[0, 0]] Offsets in pixels used when positioning\n * the overlay. The first element in the\n * array is the horizontal offset. A positive value shifts the overlay right.\n * The second element in the array is the vertical offset. A positive value\n * shifts the overlay down.\n * @property {module:ol/coordinate~Coordinate} [position] The overlay position\n * in map projection.\n * @property {module:ol/OverlayPositioning} [positioning='top-left'] Defines how\n * the overlay is actually positioned with respect to its `position` property.\n * Possible values are `'bottom-left'`, `'bottom-center'`, `'bottom-right'`,\n * `'center-left'`, `'center-center'`, `'center-right'`, `'top-left'`,\n * `'top-center'`, and `'top-right'`.\n * @property {boolean} [stopEvent=true] Whether event propagation to the map\n * viewport should be stopped. If `true` the overlay is placed in the same\n * container as that of the controls (CSS class name\n * `ol-overlaycontainer-stopevent`); if `false` it is placed in the container\n * with CSS class name specified by the `className` property.\n * @property {boolean} [insertFirst=true] Whether the overlay is inserted first\n * in the overlay container, or appended. If the overlay is placed in the same\n * container as that of the controls (see the `stopEvent` option) you will\n * probably set `insertFirst` to `true` so the overlay is displayed below the\n * controls.\n * @property {boolean} [autoPan=false] If set to `true` the map is panned when\n * calling `setPosition`, so that the overlay is entirely visible in the current\n * viewport.\n * @property {module:ol/Overlay~PanOptions} [autoPanAnimation] The\n * animation options used to pan the overlay into view. This animation is only\n * used when `autoPan` is enabled. A `duration` and `easing` may be provided to\n * customize the animation.\n * @property {number} [autoPanMargin=20] The margin (in pixels) between the\n * overlay and the borders of the map when autopanning.\n * @property {string} [className='ol-overlay-container ol-selectable'] CSS class\n * name.\n */\n\n\n/**\n * @typedef {Object} PanOptions\n * @property {number} [duration=1000] The duration of the animation in\n * milliseconds.\n * @property {function(number):number} [easing] The easing function to use. Can\n * be one from {@link module:ol/easing} or a custom function.\n * Default is {@link module:ol/easing~inAndOut}.\n */\n\n\n/**\n * @enum {string}\n * @protected\n */\nconst Property = {\n  ELEMENT: 'element',\n  MAP: 'map',\n  OFFSET: 'offset',\n  POSITION: 'position',\n  POSITIONING: 'positioning'\n};\n\n\n/**\n * @classdesc\n * An element to be displayed over the map and attached to a single map\n * location.  Like {@link module:ol/control/Control~Control}, Overlays are\n * visible widgets. Unlike Controls, they are not in a fixed position on the\n * screen, but are tied to a geographical coordinate, so panning the map will\n * move an Overlay but not a Control.\n *\n * Example:\n *\n *     import Overlay from 'ol/Overlay';\n *\n *     var popup = new Overlay({\n *       element: document.getElementById('popup')\n *     });\n *     popup.setPosition(coordinate);\n *     map.addOverlay(popup);\n *\n * @constructor\n * @extends {module:ol/Object}\n * @param {module:ol/Overlay~Options} options Overlay options.\n * @api\n */\nconst Overlay = function(options) {\n\n  BaseObject.call(this);\n\n  /**\n   * @protected\n   * @type {module:ol/Overlay~Options}\n   */\n  this.options = options;\n\n  /**\n   * @protected\n   * @type {number|string|undefined}\n   */\n  this.id = options.id;\n\n  /**\n   * @protected\n   * @type {boolean}\n   */\n  this.insertFirst = options.insertFirst !== undefined ?\n    options.insertFirst : true;\n\n  /**\n   * @protected\n   * @type {boolean}\n   */\n  this.stopEvent = options.stopEvent !== undefined ? options.stopEvent : true;\n\n  /**\n   * @protected\n   * @type {Element}\n   */\n  this.element = document.createElement('DIV');\n  this.element.className = options.className !== undefined ?\n    options.className : 'ol-overlay-container ' + CLASS_SELECTABLE;\n  this.element.style.position = 'absolute';\n\n  /**\n   * @protected\n   * @type {boolean}\n   */\n  this.autoPan = options.autoPan !== undefined ? options.autoPan : false;\n\n  /**\n   * @protected\n   * @type {module:ol/Overlay~PanOptions}\n   */\n  this.autoPanAnimation = options.autoPanAnimation || /** @type {module:ol/Overlay~PanOptions} */ ({});\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.autoPanMargin = options.autoPanMargin !== undefined ?\n    options.autoPanMargin : 20;\n\n  /**\n   * @protected\n   * @type {{bottom_: string,\n   *         left_: string,\n   *         right_: string,\n   *         top_: string,\n   *         visible: boolean}}\n   */\n  this.rendered = {\n    bottom_: '',\n    left_: '',\n    right_: '',\n    top_: '',\n    visible: true\n  };\n\n  /**\n   * @protected\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.mapPostrenderListenerKey = null;\n\n  listen(\n    this, getChangeEventType(Property.ELEMENT),\n    this.handleElementChanged, this);\n\n  listen(\n    this, getChangeEventType(Property.MAP),\n    this.handleMapChanged, this);\n\n  listen(\n    this, getChangeEventType(Property.OFFSET),\n    this.handleOffsetChanged, this);\n\n  listen(\n    this, getChangeEventType(Property.POSITION),\n    this.handlePositionChanged, this);\n\n  listen(\n    this, getChangeEventType(Property.POSITIONING),\n    this.handlePositioningChanged, this);\n\n  if (options.element !== undefined) {\n    this.setElement(options.element);\n  }\n\n  this.setOffset(options.offset !== undefined ? options.offset : [0, 0]);\n\n  this.setPositioning(options.positioning !== undefined ?\n    /** @type {module:ol/OverlayPositioning} */ (options.positioning) :\n    OverlayPositioning.TOP_LEFT);\n\n  if (options.position !== undefined) {\n    this.setPosition(options.position);\n  }\n\n};\n\ninherits(Overlay, BaseObject);\n\n\n/**\n * Get the DOM element of this overlay.\n * @return {Element|undefined} The Element containing the overlay.\n * @observable\n * @api\n */\nOverlay.prototype.getElement = function() {\n  return /** @type {Element|undefined} */ (this.get(Property.ELEMENT));\n};\n\n\n/**\n * Get the overlay identifier which is set on constructor.\n * @return {number|string|undefined} Id.\n * @api\n */\nOverlay.prototype.getId = function() {\n  return this.id;\n};\n\n\n/**\n * Get the map associated with this overlay.\n * @return {module:ol/PluggableMap|undefined} The map that the\n * overlay is part of.\n * @observable\n * @api\n */\nOverlay.prototype.getMap = function() {\n  return (\n    /** @type {module:ol/PluggableMap|undefined} */ (this.get(Property.MAP))\n  );\n};\n\n\n/**\n * Get the offset of this overlay.\n * @return {Array.<number>} The offset.\n * @observable\n * @api\n */\nOverlay.prototype.getOffset = function() {\n  return /** @type {Array.<number>} */ (this.get(Property.OFFSET));\n};\n\n\n/**\n * Get the current position of this overlay.\n * @return {module:ol/coordinate~Coordinate|undefined} The spatial point that the overlay is\n *     anchored at.\n * @observable\n * @api\n */\nOverlay.prototype.getPosition = function() {\n  return (\n    /** @type {module:ol/coordinate~Coordinate|undefined} */ (this.get(Property.POSITION))\n  );\n};\n\n\n/**\n * Get the current positioning of this overlay.\n * @return {module:ol/OverlayPositioning} How the overlay is positioned\n *     relative to its point on the map.\n * @observable\n * @api\n */\nOverlay.prototype.getPositioning = function() {\n  return (\n    /** @type {module:ol/OverlayPositioning} */ (this.get(Property.POSITIONING))\n  );\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.handleElementChanged = function() {\n  removeChildren(this.element);\n  const element = this.getElement();\n  if (element) {\n    this.element.appendChild(element);\n  }\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.handleMapChanged = function() {\n  if (this.mapPostrenderListenerKey) {\n    removeNode(this.element);\n    unlistenByKey(this.mapPostrenderListenerKey);\n    this.mapPostrenderListenerKey = null;\n  }\n  const map = this.getMap();\n  if (map) {\n    this.mapPostrenderListenerKey = listen(map,\n      MapEventType.POSTRENDER, this.render, this);\n    this.updatePixelPosition();\n    const container = this.stopEvent ?\n      map.getOverlayContainerStopEvent() : map.getOverlayContainer();\n    if (this.insertFirst) {\n      container.insertBefore(this.element, container.childNodes[0] || null);\n    } else {\n      container.appendChild(this.element);\n    }\n  }\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.render = function() {\n  this.updatePixelPosition();\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.handleOffsetChanged = function() {\n  this.updatePixelPosition();\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.handlePositionChanged = function() {\n  this.updatePixelPosition();\n  if (this.get(Property.POSITION) && this.autoPan) {\n    this.panIntoView();\n  }\n};\n\n\n/**\n * @protected\n */\nOverlay.prototype.handlePositioningChanged = function() {\n  this.updatePixelPosition();\n};\n\n\n/**\n * Set the DOM element to be associated with this overlay.\n * @param {Element|undefined} element The Element containing the overlay.\n * @observable\n * @api\n */\nOverlay.prototype.setElement = function(element) {\n  this.set(Property.ELEMENT, element);\n};\n\n\n/**\n * Set the map to be associated with this overlay.\n * @param {module:ol/PluggableMap|undefined} map The map that the\n * overlay is part of.\n * @observable\n * @api\n */\nOverlay.prototype.setMap = function(map) {\n  this.set(Property.MAP, map);\n};\n\n\n/**\n * Set the offset for this overlay.\n * @param {Array.<number>} offset Offset.\n * @observable\n * @api\n */\nOverlay.prototype.setOffset = function(offset) {\n  this.set(Property.OFFSET, offset);\n};\n\n\n/**\n * Set the position for this overlay. If the position is `undefined` the\n * overlay is hidden.\n * @param {module:ol/coordinate~Coordinate|undefined} position The spatial point that the overlay\n *     is anchored at.\n * @observable\n * @api\n */\nOverlay.prototype.setPosition = function(position) {\n  this.set(Property.POSITION, position);\n};\n\n\n/**\n * Pan the map so that the overlay is entirely visible in the current viewport\n * (if necessary).\n * @protected\n */\nOverlay.prototype.panIntoView = function() {\n  const map = this.getMap();\n\n  if (!map || !map.getTargetElement()) {\n    return;\n  }\n\n  const mapRect = this.getRect(map.getTargetElement(), map.getSize());\n  const element = /** @type {!Element} */ (this.getElement());\n  const overlayRect = this.getRect(element, [outerWidth(element), outerHeight(element)]);\n\n  const margin = this.autoPanMargin;\n  if (!containsExtent(mapRect, overlayRect)) {\n    // the overlay is not completely inside the viewport, so pan the map\n    const offsetLeft = overlayRect[0] - mapRect[0];\n    const offsetRight = mapRect[2] - overlayRect[2];\n    const offsetTop = overlayRect[1] - mapRect[1];\n    const offsetBottom = mapRect[3] - overlayRect[3];\n\n    const delta = [0, 0];\n    if (offsetLeft < 0) {\n      // move map to the left\n      delta[0] = offsetLeft - margin;\n    } else if (offsetRight < 0) {\n      // move map to the right\n      delta[0] = Math.abs(offsetRight) + margin;\n    }\n    if (offsetTop < 0) {\n      // move map up\n      delta[1] = offsetTop - margin;\n    } else if (offsetBottom < 0) {\n      // move map down\n      delta[1] = Math.abs(offsetBottom) + margin;\n    }\n\n    if (delta[0] !== 0 || delta[1] !== 0) {\n      const center = /** @type {module:ol/coordinate~Coordinate} */ (map.getView().getCenter());\n      const centerPx = map.getPixelFromCoordinate(center);\n      const newCenterPx = [\n        centerPx[0] + delta[0],\n        centerPx[1] + delta[1]\n      ];\n\n      map.getView().animate({\n        center: map.getCoordinateFromPixel(newCenterPx),\n        duration: this.autoPanAnimation.duration,\n        easing: this.autoPanAnimation.easing\n      });\n    }\n  }\n};\n\n\n/**\n * Get the extent of an element relative to the document\n * @param {Element|undefined} element The element.\n * @param {module:ol/size~Size|undefined} size The size of the element.\n * @return {module:ol/extent~Extent} The extent.\n * @protected\n */\nOverlay.prototype.getRect = function(element, size) {\n  const box = element.getBoundingClientRect();\n  const offsetX = box.left + window.pageXOffset;\n  const offsetY = box.top + window.pageYOffset;\n  return [\n    offsetX,\n    offsetY,\n    offsetX + size[0],\n    offsetY + size[1]\n  ];\n};\n\n\n/**\n * Set the positioning for this overlay.\n * @param {module:ol/OverlayPositioning} positioning how the overlay is\n *     positioned relative to its point on the map.\n * @observable\n * @api\n */\nOverlay.prototype.setPositioning = function(positioning) {\n  this.set(Property.POSITIONING, positioning);\n};\n\n\n/**\n * Modify the visibility of the element.\n * @param {boolean} visible Element visibility.\n * @protected\n */\nOverlay.prototype.setVisible = function(visible) {\n  if (this.rendered.visible !== visible) {\n    this.element.style.display = visible ? '' : 'none';\n    this.rendered.visible = visible;\n  }\n};\n\n\n/**\n * Update pixel position.\n * @protected\n */\nOverlay.prototype.updatePixelPosition = function() {\n  const map = this.getMap();\n  const position = this.getPosition();\n  if (!map || !map.isRendered() || !position) {\n    this.setVisible(false);\n    return;\n  }\n\n  const pixel = map.getPixelFromCoordinate(position);\n  const mapSize = map.getSize();\n  this.updateRenderedPosition(pixel, mapSize);\n};\n\n\n/**\n * @param {module:ol~Pixel} pixel The pixel location.\n * @param {module:ol/size~Size|undefined} mapSize The map size.\n * @protected\n */\nOverlay.prototype.updateRenderedPosition = function(pixel, mapSize) {\n  const style = this.element.style;\n  const offset = this.getOffset();\n\n  const positioning = this.getPositioning();\n\n  this.setVisible(true);\n\n  let offsetX = offset[0];\n  let offsetY = offset[1];\n  if (positioning == OverlayPositioning.BOTTOM_RIGHT ||\n      positioning == OverlayPositioning.CENTER_RIGHT ||\n      positioning == OverlayPositioning.TOP_RIGHT) {\n    if (this.rendered.left_ !== '') {\n      this.rendered.left_ = style.left = '';\n    }\n    const right = Math.round(mapSize[0] - pixel[0] - offsetX) + 'px';\n    if (this.rendered.right_ != right) {\n      this.rendered.right_ = style.right = right;\n    }\n  } else {\n    if (this.rendered.right_ !== '') {\n      this.rendered.right_ = style.right = '';\n    }\n    if (positioning == OverlayPositioning.BOTTOM_CENTER ||\n        positioning == OverlayPositioning.CENTER_CENTER ||\n        positioning == OverlayPositioning.TOP_CENTER) {\n      offsetX -= this.element.offsetWidth / 2;\n    }\n    const left = Math.round(pixel[0] + offsetX) + 'px';\n    if (this.rendered.left_ != left) {\n      this.rendered.left_ = style.left = left;\n    }\n  }\n  if (positioning == OverlayPositioning.BOTTOM_LEFT ||\n      positioning == OverlayPositioning.BOTTOM_CENTER ||\n      positioning == OverlayPositioning.BOTTOM_RIGHT) {\n    if (this.rendered.top_ !== '') {\n      this.rendered.top_ = style.top = '';\n    }\n    const bottom = Math.round(mapSize[1] - pixel[1] - offsetY) + 'px';\n    if (this.rendered.bottom_ != bottom) {\n      this.rendered.bottom_ = style.bottom = bottom;\n    }\n  } else {\n    if (this.rendered.bottom_ !== '') {\n      this.rendered.bottom_ = style.bottom = '';\n    }\n    if (positioning == OverlayPositioning.CENTER_LEFT ||\n        positioning == OverlayPositioning.CENTER_CENTER ||\n        positioning == OverlayPositioning.CENTER_RIGHT) {\n      offsetY -= this.element.offsetHeight / 2;\n    }\n    const top = Math.round(pixel[1] + offsetY) + 'px';\n    if (this.rendered.top_ != top) {\n      this.rendered.top_ = style.top = top;\n    }\n  }\n};\n\n\n/**\n * returns the options this Overlay has been created with\n * @return {module:ol/Overlay~Options} overlay options\n */\nOverlay.prototype.getOptions = function() {\n  return this.options;\n};\n\nexport default Overlay;\n","/**\n * @module ol/VectorTile\n */\nimport {getUid, inherits} from './util.js';\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\n\n/**\n * @typedef {function(new: module:ol/VectorTile, module:ol/tilecoord~TileCoord,\n * module:ol/TileState, string, ?string, module:ol/Tile~LoadFunction)} TileClass\n * @api\n */\n\n/**\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {string} src Data source url.\n * @param {module:ol/format/Feature} format Feature format.\n * @param {module:ol/Tile~LoadFunction} tileLoadFunction Tile load function.\n * @param {module:ol/Tile~Options=} opt_options Tile options.\n */\nconst VectorTile = function(tileCoord, state, src, format, tileLoadFunction, opt_options) {\n\n  Tile.call(this, tileCoord, state, opt_options);\n\n  /**\n   * @type {number}\n   */\n  this.consumers = 0;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/format/Feature}\n   */\n  this.format_ = format;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/Feature>}\n   */\n  this.features_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/featureloader~FeatureLoader}\n   */\n  this.loader_;\n\n  /**\n   * Data projection\n   * @private\n   * @type {module:ol/proj/Projection}\n   */\n  this.projection_ = null;\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/render/ReplayGroup>}\n   */\n  this.replayGroups_ = {};\n\n  /**\n   * @private\n   * @type {module:ol/Tile~LoadFunction}\n   */\n  this.tileLoadFunction_ = tileLoadFunction;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.url_ = src;\n\n};\n\ninherits(VectorTile, Tile);\n\n/**\n * @const\n * @type {module:ol/extent~Extent}\n */\nconst DEFAULT_EXTENT = [0, 0, 4096, 4096];\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.disposeInternal = function() {\n  this.features_ = null;\n  this.replayGroups_ = {};\n  this.state = TileState.ABORT;\n  this.changed();\n  Tile.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * Gets the extent of the vector tile.\n * @return {module:ol/extent~Extent} The extent.\n * @api\n */\nVectorTile.prototype.getExtent = function() {\n  return this.extent_ || DEFAULT_EXTENT;\n};\n\n\n/**\n * Get the feature format assigned for reading this tile's features.\n * @return {module:ol/format/Feature} Feature format.\n * @api\n */\nVectorTile.prototype.getFormat = function() {\n  return this.format_;\n};\n\n\n/**\n * Get the features for this tile. Geometries will be in the projection returned\n * by {@link module:ol/VectorTile~VectorTile#getProjection}.\n * @return {Array.<module:ol/Feature|module:ol/render/Feature>} Features.\n * @api\n */\nVectorTile.prototype.getFeatures = function() {\n  return this.features_;\n};\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.getKey = function() {\n  return this.url_;\n};\n\n\n/**\n * Get the feature projection of features returned by\n * {@link module:ol/VectorTile~VectorTile#getFeatures}.\n * @return {module:ol/proj/Projection} Feature projection.\n * @api\n */\nVectorTile.prototype.getProjection = function() {\n  return this.projection_;\n};\n\n\n/**\n * @param {module:ol/layer/Layer} layer Layer.\n * @param {string} key Key.\n * @return {module:ol/render/ReplayGroup} Replay group.\n */\nVectorTile.prototype.getReplayGroup = function(layer, key) {\n  return this.replayGroups_[getUid(layer) + ',' + key];\n};\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.load = function() {\n  if (this.state == TileState.IDLE) {\n    this.setState(TileState.LOADING);\n    this.tileLoadFunction_(this, this.url_);\n    this.loader_(null, NaN, null);\n  }\n};\n\n\n/**\n * Handler for successful tile load.\n * @param {Array.<module:ol/Feature>} features The loaded features.\n * @param {module:ol/proj/Projection} dataProjection Data projection.\n * @param {module:ol/extent~Extent} extent Extent.\n */\nVectorTile.prototype.onLoad = function(features, dataProjection, extent) {\n  this.setProjection(dataProjection);\n  this.setFeatures(features);\n  this.setExtent(extent);\n};\n\n\n/**\n * Handler for tile load errors.\n */\nVectorTile.prototype.onError = function() {\n  this.setState(TileState.ERROR);\n};\n\n\n/**\n * Function for use in an {@link module:ol/source/VectorTile~VectorTile}'s\n * `tileLoadFunction`. Sets the extent of the vector tile. This is only required\n * for tiles in projections with `tile-pixels` as units. The extent should be\n * set to `[0, 0, tilePixelSize, tilePixelSize]`, where `tilePixelSize` is\n * calculated by multiplying the tile size with the tile pixel ratio. For\n * sources using {@link module:ol/format/MVT~MVT} as feature format, the\n * {@link module:ol/format/MVT~MVT#getLastExtent} method will return the correct\n * extent. The default is `[0, 0, 4096, 4096]`.\n * @param {module:ol/extent~Extent} extent The extent.\n * @api\n */\nVectorTile.prototype.setExtent = function(extent) {\n  this.extent_ = extent;\n};\n\n\n/**\n * Function for use in an {@link module:ol/source/VectorTile~VectorTile}'s `tileLoadFunction`.\n * Sets the features for the tile.\n * @param {Array.<module:ol/Feature>} features Features.\n * @api\n */\nVectorTile.prototype.setFeatures = function(features) {\n  this.features_ = features;\n  this.setState(TileState.LOADED);\n};\n\n\n/**\n * Function for use in an {@link module:ol/source/VectorTile~VectorTile}'s `tileLoadFunction`.\n * Sets the projection of the features that were added with\n * {@link module:ol/VectorTile~VectorTile#setFeatures}.\n * @param {module:ol/proj/Projection} projection Feature projection.\n * @api\n */\nVectorTile.prototype.setProjection = function(projection) {\n  this.projection_ = projection;\n};\n\n\n/**\n * @param {module:ol/layer/Layer} layer Layer.\n * @param {string} key Key.\n * @param {module:ol/render/ReplayGroup} replayGroup Replay group.\n */\nVectorTile.prototype.setReplayGroup = function(layer, key, replayGroup) {\n  this.replayGroups_[getUid(layer) + ',' + key] = replayGroup;\n};\n\n\n/**\n * Set the feature loader for reading this tile's features.\n * @param {module:ol/featureloader~FeatureLoader} loader Feature loader.\n * @api\n */\nVectorTile.prototype.setLoader = function(loader) {\n  this.loader_ = loader;\n};\n\nexport default VectorTile;\n","/**\n * @module ol/control/FullScreen\n */\nimport {inherits} from '../util.js';\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE, CLASS_UNSUPPORTED} from '../css.js';\nimport {replaceNode} from '../dom.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\n\n\n/**\n * @return {string} Change type.\n */\nconst getChangeType = (function() {\n  let changeType;\n  return function() {\n    if (!changeType) {\n      const body = document.body;\n      if (body.webkitRequestFullscreen) {\n        changeType = 'webkitfullscreenchange';\n      } else if (body.mozRequestFullScreen) {\n        changeType = 'mozfullscreenchange';\n      } else if (body.msRequestFullscreen) {\n        changeType = 'MSFullscreenChange';\n      } else if (body.requestFullscreen) {\n        changeType = 'fullscreenchange';\n      }\n    }\n    return changeType;\n  };\n})();\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-full-screen'] CSS class name.\n * @property {string|Element} [label='\\u2922'] Text label to use for the button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string|Element} [labelActive='\\u00d7'] Text label to use for the\n * button when full-screen is active.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string} [tipLabel='Toggle full-screen'] Text label to use for the button tip.\n * @property {boolean} [keys=false] Full keyboard access.\n * @property {Element|string} [target] Specify a target if you want the\n * control to be rendered outside of the map's viewport.\n * @property {Element|string} [source] The element to be displayed\n * fullscreen. When not provided, the element containing the map viewport will\n * be displayed fullscreen.\n */\n\n\n/**\n * @classdesc\n * Provides a button that when clicked fills up the full screen with the map.\n * The full screen source element is by default the element containing the map viewport unless\n * overridden by providing the `source` option. In which case, the dom\n * element introduced using this parameter will be displayed in full screen.\n *\n * When in full screen mode, a close button is shown to exit full screen mode.\n * The [Fullscreen API](http://www.w3.org/TR/fullscreen/) is used to\n * toggle the map in full screen mode.\n *\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/FullScreen~Options=} opt_options Options.\n * @api\n */\nconst FullScreen = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.cssClassName_ = options.className !== undefined ? options.className :\n    'ol-full-screen';\n\n  const label = options.label !== undefined ? options.label : '\\u2922';\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.labelNode_ = typeof label === 'string' ?\n    document.createTextNode(label) : label;\n\n  const labelActive = options.labelActive !== undefined ? options.labelActive : '\\u00d7';\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.labelActiveNode_ = typeof labelActive === 'string' ?\n    document.createTextNode(labelActive) : labelActive;\n\n  const tipLabel = options.tipLabel ? options.tipLabel : 'Toggle full-screen';\n  const button = document.createElement('button');\n  button.className = this.cssClassName_ + '-' + isFullScreen();\n  button.setAttribute('type', 'button');\n  button.title = tipLabel;\n  button.appendChild(this.labelNode_);\n\n  listen(button, EventType.CLICK,\n    this.handleClick_, this);\n\n  const cssClasses = this.cssClassName_ + ' ' + CLASS_UNSELECTABLE +\n      ' ' + CLASS_CONTROL + ' ' +\n      (!isFullScreenSupported() ? CLASS_UNSUPPORTED : '');\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(button);\n\n  Control.call(this, {\n    element: element,\n    target: options.target\n  });\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.keys_ = options.keys !== undefined ? options.keys : false;\n\n  /**\n   * @private\n   * @type {Element|string|undefined}\n   */\n  this.source_ = options.source;\n\n};\n\ninherits(FullScreen, Control);\n\n\n/**\n * @param {Event} event The event to handle\n * @private\n */\nFullScreen.prototype.handleClick_ = function(event) {\n  event.preventDefault();\n  this.handleFullScreen_();\n};\n\n\n/**\n * @private\n */\nFullScreen.prototype.handleFullScreen_ = function() {\n  if (!isFullScreenSupported()) {\n    return;\n  }\n  const map = this.getMap();\n  if (!map) {\n    return;\n  }\n  if (isFullScreen()) {\n    exitFullScreen();\n  } else {\n    let element;\n    if (this.source_) {\n      element = typeof this.source_ === 'string' ?\n        document.getElementById(this.source_) :\n        this.source_;\n    } else {\n      element = map.getTargetElement();\n    }\n    if (this.keys_) {\n      requestFullScreenWithKeys(element);\n\n    } else {\n      requestFullScreen(element);\n    }\n  }\n};\n\n\n/**\n * @private\n */\nFullScreen.prototype.handleFullScreenChange_ = function() {\n  const button = this.element.firstElementChild;\n  const map = this.getMap();\n  if (isFullScreen()) {\n    button.className = this.cssClassName_ + '-true';\n    replaceNode(this.labelActiveNode_, this.labelNode_);\n  } else {\n    button.className = this.cssClassName_ + '-false';\n    replaceNode(this.labelNode_, this.labelActiveNode_);\n  }\n  if (map) {\n    map.updateSize();\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nFullScreen.prototype.setMap = function(map) {\n  Control.prototype.setMap.call(this, map);\n  if (map) {\n    this.listenerKeys.push(listen(document,\n      getChangeType(),\n      this.handleFullScreenChange_, this)\n    );\n  }\n};\n\n/**\n * @return {boolean} Fullscreen is supported by the current platform.\n */\nfunction isFullScreenSupported() {\n  const body = document.body;\n  return !!(\n    body.webkitRequestFullscreen ||\n    (body.mozRequestFullScreen && document.mozFullScreenEnabled) ||\n    (body.msRequestFullscreen && document.msFullscreenEnabled) ||\n    (body.requestFullscreen && document.fullscreenEnabled)\n  );\n}\n\n/**\n * @return {boolean} Element is currently in fullscreen.\n */\nfunction isFullScreen() {\n  return !!(\n    document.webkitIsFullScreen || document.mozFullScreen ||\n    document.msFullscreenElement || document.fullscreenElement\n  );\n}\n\n/**\n * Request to fullscreen an element.\n * @param {Element} element Element to request fullscreen\n */\nfunction requestFullScreen(element) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  }\n}\n\n/**\n * Request to fullscreen an element with keyboard input.\n * @param {Element} element Element to request fullscreen\n */\nfunction requestFullScreenWithKeys(element) {\n  if (element.mozRequestFullScreenWithKeys) {\n    element.mozRequestFullScreenWithKeys();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n  } else {\n    requestFullScreen(element);\n  }\n}\n\n/**\n * Exit fullscreen.\n */\nfunction exitFullScreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.msExitFullscreen) {\n    document.msExitFullscreen();\n  } else if (document.mozCancelFullScreen) {\n    document.mozCancelFullScreen();\n  } else if (document.webkitExitFullscreen) {\n    document.webkitExitFullscreen();\n  }\n}\n\nexport default FullScreen;\n","/**\n * @module ol/control/OverviewMap\n */\nimport {inherits} from '../util.js';\nimport Collection from '../Collection.js';\nimport Map from '../Map.js';\nimport MapEventType from '../MapEventType.js';\nimport MapProperty from '../MapProperty.js';\nimport {getChangeEventType} from '../Object.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport Overlay from '../Overlay.js';\nimport OverlayPositioning from '../OverlayPositioning.js';\nimport ViewProperty from '../ViewProperty.js';\nimport Control from '../control/Control.js';\nimport {rotate as rotateCoordinate, add as addCoordinate} from '../coordinate.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE, CLASS_COLLAPSED} from '../css.js';\nimport {replaceNode} from '../dom.js';\nimport {listen, listenOnce, unlisten} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {containsExtent, getBottomLeft, getBottomRight, getTopLeft, getTopRight, scaleFromCenter} from '../extent.js';\n\n\n/**\n * Maximum width and/or height extent ratio that determines when the overview\n * map should be zoomed out.\n * @type {number}\n */\nconst MAX_RATIO = 0.75;\n\n\n/**\n * Minimum width and/or height extent ratio that determines when the overview\n * map should be zoomed in.\n * @type {number}\n */\nconst MIN_RATIO = 0.1;\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-overviewmap'] CSS class name.\n * @property {boolean} [collapsed=true] Whether the control should start collapsed or not (expanded).\n * @property {string|Element} [collapseLabel=''] Text label to use for the\n * expanded overviewmap button. Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {boolean} [collapsible=true] Whether the control can be collapsed or not.\n * @property {string|Element} [label=''] Text label to use for the collapsed\n * overviewmap button. Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {Array.<module:ol/layer/Layer>|module:ol/Collection.<module:ol/layer/Layer>} [layers]\n * Layers for the overview map. If not set, then all main map layers are used\n * instead.\n * @property {function(module:ol/MapEvent)} [render] Function called when the control\n * should be re-rendered. This is called in a `requestAnimationFrame` callback.\n * @property {Element|string} [target] Specify a target if you want the control\n * to be rendered outside of the map's viewport.\n * @property {string} [tipLabel='Overview map'] Text label to use for the button tip.\n * @property {module:ol/View} [view] Custom view for the overview map. If not provided,\n * a default view with an EPSG:3857 projection will be used.\n */\n\n\n/**\n * Create a new control with a map acting as an overview map for an other\n * defined map.\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/OverviewMap~Options=} opt_options OverviewMap options.\n * @api\n */\nconst OverviewMap = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.collapsed_ = options.collapsed !== undefined ? options.collapsed : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.collapsible_ = options.collapsible !== undefined ?\n    options.collapsible : true;\n\n  if (!this.collapsible_) {\n    this.collapsed_ = false;\n  }\n\n  const className = options.className !== undefined ? options.className : 'ol-overviewmap';\n\n  const tipLabel = options.tipLabel !== undefined ? options.tipLabel : 'Overview map';\n\n  const collapseLabel = options.collapseLabel !== undefined ? options.collapseLabel : '\\u00AB';\n\n  if (typeof collapseLabel === 'string') {\n    /**\n     * @private\n     * @type {Element}\n     */\n    this.collapseLabel_ = document.createElement('span');\n    this.collapseLabel_.textContent = collapseLabel;\n  } else {\n    this.collapseLabel_ = collapseLabel;\n  }\n\n  const label = options.label !== undefined ? options.label : '\\u00BB';\n\n\n  if (typeof label === 'string') {\n    /**\n     * @private\n     * @type {Element}\n     */\n    this.label_ = document.createElement('span');\n    this.label_.textContent = label;\n  } else {\n    this.label_ = label;\n  }\n\n  const activeLabel = (this.collapsible_ && !this.collapsed_) ?\n    this.collapseLabel_ : this.label_;\n  const button = document.createElement('button');\n  button.setAttribute('type', 'button');\n  button.title = tipLabel;\n  button.appendChild(activeLabel);\n\n  listen(button, EventType.CLICK,\n    this.handleClick_, this);\n\n  /**\n   * @type {Element}\n   * @private\n   */\n  this.ovmapDiv_ = document.createElement('DIV');\n  this.ovmapDiv_.className = 'ol-overviewmap-map';\n\n  /**\n   * @type {module:ol/Map}\n   * @private\n   */\n  this.ovmap_ = new Map({\n    controls: new Collection(),\n    interactions: new Collection(),\n    view: options.view\n  });\n  const ovmap = this.ovmap_;\n\n  if (options.layers) {\n    options.layers.forEach(\n      /**\n       * @param {module:ol/layer/Layer} layer Layer.\n       */\n      (function(layer) {\n        ovmap.addLayer(layer);\n      }).bind(this));\n  }\n\n  const box = document.createElement('DIV');\n  box.className = 'ol-overviewmap-box';\n  box.style.boxSizing = 'border-box';\n\n  /**\n   * @type {module:ol/Overlay}\n   * @private\n   */\n  this.boxOverlay_ = new Overlay({\n    position: [0, 0],\n    positioning: OverlayPositioning.BOTTOM_LEFT,\n    element: box\n  });\n  this.ovmap_.addOverlay(this.boxOverlay_);\n\n  const cssClasses = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL +\n      (this.collapsed_ && this.collapsible_ ? ' ' + CLASS_COLLAPSED : '') +\n      (this.collapsible_ ? '' : ' ol-uncollapsible');\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(this.ovmapDiv_);\n  element.appendChild(button);\n\n  Control.call(this, {\n    element: element,\n    render: options.render || render,\n    target: options.target\n  });\n\n  /* Interactive map */\n\n  const scope = this;\n\n  const overlay = this.boxOverlay_;\n  const overlayBox = this.boxOverlay_.getElement();\n\n  /* Functions definition */\n\n  const computeDesiredMousePosition = function(mousePosition) {\n    return {\n      clientX: mousePosition.clientX - (overlayBox.offsetWidth / 2),\n      clientY: mousePosition.clientY + (overlayBox.offsetHeight / 2)\n    };\n  };\n\n  const move = function(event) {\n    const coordinates = ovmap.getEventCoordinate(computeDesiredMousePosition(event));\n\n    overlay.setPosition(coordinates);\n  };\n\n  const endMoving = function(event) {\n    const coordinates = ovmap.getEventCoordinate(event);\n\n    scope.getMap().getView().setCenter(coordinates);\n\n    window.removeEventListener('mousemove', move);\n    window.removeEventListener('mouseup', endMoving);\n  };\n\n  /* Binding */\n\n  overlayBox.addEventListener('mousedown', function() {\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', endMoving);\n  });\n};\n\ninherits(OverviewMap, Control);\n\n\n/**\n * @inheritDoc\n * @api\n */\nOverviewMap.prototype.setMap = function(map) {\n  const oldMap = this.getMap();\n  if (map === oldMap) {\n    return;\n  }\n  if (oldMap) {\n    const oldView = oldMap.getView();\n    if (oldView) {\n      this.unbindView_(oldView);\n    }\n    this.ovmap_.setTarget(null);\n  }\n  Control.prototype.setMap.call(this, map);\n\n  if (map) {\n    this.ovmap_.setTarget(this.ovmapDiv_);\n    this.listenerKeys.push(listen(\n      map, ObjectEventType.PROPERTYCHANGE,\n      this.handleMapPropertyChange_, this));\n\n    // TODO: to really support map switching, this would need to be reworked\n    if (this.ovmap_.getLayers().getLength() === 0) {\n      this.ovmap_.setLayerGroup(map.getLayerGroup());\n    }\n\n    const view = map.getView();\n    if (view) {\n      this.bindView_(view);\n      if (view.isDef()) {\n        this.ovmap_.updateSize();\n        this.resetExtent_();\n      }\n    }\n  }\n};\n\n\n/**\n * Handle map property changes.  This only deals with changes to the map's view.\n * @param {module:ol/Object~ObjectEvent} event The propertychange event.\n * @private\n */\nOverviewMap.prototype.handleMapPropertyChange_ = function(event) {\n  if (event.key === MapProperty.VIEW) {\n    const oldView = /** @type {module:ol/View} */ (event.oldValue);\n    if (oldView) {\n      this.unbindView_(oldView);\n    }\n    const newView = this.getMap().getView();\n    this.bindView_(newView);\n  }\n};\n\n\n/**\n * Register listeners for view property changes.\n * @param {module:ol/View} view The view.\n * @private\n */\nOverviewMap.prototype.bindView_ = function(view) {\n  listen(view,\n    getChangeEventType(ViewProperty.ROTATION),\n    this.handleRotationChanged_, this);\n};\n\n\n/**\n * Unregister listeners for view property changes.\n * @param {module:ol/View} view The view.\n * @private\n */\nOverviewMap.prototype.unbindView_ = function(view) {\n  unlisten(view,\n    getChangeEventType(ViewProperty.ROTATION),\n    this.handleRotationChanged_, this);\n};\n\n\n/**\n * Handle rotation changes to the main map.\n * TODO: This should rotate the extent rectrangle instead of the\n * overview map's view.\n * @private\n */\nOverviewMap.prototype.handleRotationChanged_ = function() {\n  this.ovmap_.getView().setRotation(this.getMap().getView().getRotation());\n};\n\n\n/**\n * Update the overview map element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/OverviewMap}\n * @api\n */\nexport function render(mapEvent) {\n  this.validateExtent_();\n  this.updateBox_();\n}\n\n\n/**\n * Reset the overview map extent if the box size (width or\n * height) is less than the size of the overview map size times minRatio\n * or is greater than the size of the overview size times maxRatio.\n *\n * If the map extent was not reset, the box size can fits in the defined\n * ratio sizes. This method then checks if is contained inside the overview\n * map current extent. If not, recenter the overview map to the current\n * main map center location.\n * @private\n */\nOverviewMap.prototype.validateExtent_ = function() {\n  const map = this.getMap();\n  const ovmap = this.ovmap_;\n\n  if (!map.isRendered() || !ovmap.isRendered()) {\n    return;\n  }\n\n  const mapSize = /** @type {module:ol/size~Size} */ (map.getSize());\n\n  const view = map.getView();\n  const extent = view.calculateExtent(mapSize);\n\n  const ovmapSize = /** @type {module:ol/size~Size} */ (ovmap.getSize());\n\n  const ovview = ovmap.getView();\n  const ovextent = ovview.calculateExtent(ovmapSize);\n\n  const topLeftPixel =\n      ovmap.getPixelFromCoordinate(getTopLeft(extent));\n  const bottomRightPixel =\n      ovmap.getPixelFromCoordinate(getBottomRight(extent));\n\n  const boxWidth = Math.abs(topLeftPixel[0] - bottomRightPixel[0]);\n  const boxHeight = Math.abs(topLeftPixel[1] - bottomRightPixel[1]);\n\n  const ovmapWidth = ovmapSize[0];\n  const ovmapHeight = ovmapSize[1];\n\n  if (boxWidth < ovmapWidth * MIN_RATIO ||\n      boxHeight < ovmapHeight * MIN_RATIO ||\n      boxWidth > ovmapWidth * MAX_RATIO ||\n      boxHeight > ovmapHeight * MAX_RATIO) {\n    this.resetExtent_();\n  } else if (!containsExtent(ovextent, extent)) {\n    this.recenter_();\n  }\n};\n\n\n/**\n * Reset the overview map extent to half calculated min and max ratio times\n * the extent of the main map.\n * @private\n */\nOverviewMap.prototype.resetExtent_ = function() {\n  if (MAX_RATIO === 0 || MIN_RATIO === 0) {\n    return;\n  }\n\n  const map = this.getMap();\n  const ovmap = this.ovmap_;\n\n  const mapSize = /** @type {module:ol/size~Size} */ (map.getSize());\n\n  const view = map.getView();\n  const extent = view.calculateExtent(mapSize);\n\n  const ovview = ovmap.getView();\n\n  // get how many times the current map overview could hold different\n  // box sizes using the min and max ratio, pick the step in the middle used\n  // to calculate the extent from the main map to set it to the overview map,\n  const steps = Math.log(\n    MAX_RATIO / MIN_RATIO) / Math.LN2;\n  const ratio = 1 / (Math.pow(2, steps / 2) * MIN_RATIO);\n  scaleFromCenter(extent, ratio);\n  ovview.fit(extent);\n};\n\n\n/**\n * Set the center of the overview map to the map center without changing its\n * resolution.\n * @private\n */\nOverviewMap.prototype.recenter_ = function() {\n  const map = this.getMap();\n  const ovmap = this.ovmap_;\n\n  const view = map.getView();\n\n  const ovview = ovmap.getView();\n\n  ovview.setCenter(view.getCenter());\n};\n\n\n/**\n * Update the box using the main map extent\n * @private\n */\nOverviewMap.prototype.updateBox_ = function() {\n  const map = this.getMap();\n  const ovmap = this.ovmap_;\n\n  if (!map.isRendered() || !ovmap.isRendered()) {\n    return;\n  }\n\n  const mapSize = /** @type {module:ol/size~Size} */ (map.getSize());\n\n  const view = map.getView();\n\n  const ovview = ovmap.getView();\n\n  const rotation = view.getRotation();\n\n  const overlay = this.boxOverlay_;\n  const box = this.boxOverlay_.getElement();\n  const extent = view.calculateExtent(mapSize);\n  const ovresolution = ovview.getResolution();\n  const bottomLeft = getBottomLeft(extent);\n  const topRight = getTopRight(extent);\n\n  // set position using bottom left coordinates\n  const rotateBottomLeft = this.calculateCoordinateRotate_(rotation, bottomLeft);\n  overlay.setPosition(rotateBottomLeft);\n\n  // set box size calculated from map extent size and overview map resolution\n  if (box) {\n    box.style.width = Math.abs((bottomLeft[0] - topRight[0]) / ovresolution) + 'px';\n    box.style.height = Math.abs((topRight[1] - bottomLeft[1]) / ovresolution) + 'px';\n  }\n};\n\n\n/**\n * @param {number} rotation Target rotation.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @return {module:ol/coordinate~Coordinate|undefined} Coordinate for rotation and center anchor.\n * @private\n */\nOverviewMap.prototype.calculateCoordinateRotate_ = function(\n  rotation, coordinate) {\n  let coordinateRotate;\n\n  const map = this.getMap();\n  const view = map.getView();\n\n  const currentCenter = view.getCenter();\n\n  if (currentCenter) {\n    coordinateRotate = [\n      coordinate[0] - currentCenter[0],\n      coordinate[1] - currentCenter[1]\n    ];\n    rotateCoordinate(coordinateRotate, rotation);\n    addCoordinate(coordinateRotate, currentCenter);\n  }\n  return coordinateRotate;\n};\n\n\n/**\n * @param {Event} event The event to handle\n * @private\n */\nOverviewMap.prototype.handleClick_ = function(event) {\n  event.preventDefault();\n  this.handleToggle_();\n};\n\n\n/**\n * @private\n */\nOverviewMap.prototype.handleToggle_ = function() {\n  this.element.classList.toggle(CLASS_COLLAPSED);\n  if (this.collapsed_) {\n    replaceNode(this.collapseLabel_, this.label_);\n  } else {\n    replaceNode(this.label_, this.collapseLabel_);\n  }\n  this.collapsed_ = !this.collapsed_;\n\n  // manage overview map if it had not been rendered before and control\n  // is expanded\n  const ovmap = this.ovmap_;\n  if (!this.collapsed_ && !ovmap.isRendered()) {\n    ovmap.updateSize();\n    this.resetExtent_();\n    listenOnce(ovmap, MapEventType.POSTRENDER,\n      function(event) {\n        this.updateBox_();\n      },\n      this);\n  }\n};\n\n\n/**\n * Return `true` if the overview map is collapsible, `false` otherwise.\n * @return {boolean} True if the widget is collapsible.\n * @api\n */\nOverviewMap.prototype.getCollapsible = function() {\n  return this.collapsible_;\n};\n\n\n/**\n * Set whether the overview map should be collapsible.\n * @param {boolean} collapsible True if the widget is collapsible.\n * @api\n */\nOverviewMap.prototype.setCollapsible = function(collapsible) {\n  if (this.collapsible_ === collapsible) {\n    return;\n  }\n  this.collapsible_ = collapsible;\n  this.element.classList.toggle('ol-uncollapsible');\n  if (!collapsible && this.collapsed_) {\n    this.handleToggle_();\n  }\n};\n\n\n/**\n * Collapse or expand the overview map according to the passed parameter. Will\n * not do anything if the overview map isn't collapsible or if the current\n * collapsed state is already the one requested.\n * @param {boolean} collapsed True if the widget is collapsed.\n * @api\n */\nOverviewMap.prototype.setCollapsed = function(collapsed) {\n  if (!this.collapsible_ || this.collapsed_ === collapsed) {\n    return;\n  }\n  this.handleToggle_();\n};\n\n\n/**\n * Determine if the overview map is collapsed.\n * @return {boolean} The overview map is collapsed.\n * @api\n */\nOverviewMap.prototype.getCollapsed = function() {\n  return this.collapsed_;\n};\n\n\n/**\n * Return the overview map.\n * @return {module:ol/PluggableMap} Overview map.\n * @api\n */\nOverviewMap.prototype.getOverviewMap = function() {\n  return this.ovmap_;\n};\nexport default OverviewMap;\n","/**\n * @module ol/control/ScaleLine\n */\nimport {inherits} from '../util.js';\nimport {getChangeEventType} from '../Object.js';\nimport {assert} from '../asserts.js';\nimport Control from '../control/Control.js';\nimport {CLASS_UNSELECTABLE} from '../css.js';\nimport {listen} from '../events.js';\nimport {getPointResolution, METERS_PER_UNIT} from '../proj.js';\nimport ProjUnits from '../proj/Units.js';\n\n\n/**\n * @type {string}\n */\nconst UNITS_PROP = 'units';\n\n/**\n * Units for the scale line. Supported values are `'degrees'`, `'imperial'`,\n * `'nautical'`, `'metric'`, `'us'`.\n * @enum {string}\n */\nexport const Units = {\n  DEGREES: 'degrees',\n  IMPERIAL: 'imperial',\n  NAUTICAL: 'nautical',\n  METRIC: 'metric',\n  US: 'us'\n};\n\n\n/**\n * @const\n * @type {Array.<number>}\n */\nconst LEADING_DIGITS = [1, 2, 5];\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-scale-line'] CSS Class name.\n * @property {number} [minWidth=64] Minimum width in pixels.\n * @property {function(module:ol/MapEvent)} [render] Function called when the control\n * should be re-rendered. This is called in a `requestAnimationFrame` callback.\n * @property {Element|string} [target] Specify a target if you want the control\n * to be rendered outside of the map's viewport.\n * @property {module:ol/control/ScaleLine~Units|string} [units='metric'] Units.\n */\n\n\n/**\n * @classdesc\n * A control displaying rough y-axis distances, calculated for the center of the\n * viewport. For conformal projections (e.g. EPSG:3857, the default view\n * projection in OpenLayers), the scale is valid for all directions.\n * No scale line will be shown when the y-axis distance of a pixel at the\n * viewport center cannot be calculated in the view projection.\n * By default the scale line will show in the bottom left portion of the map,\n * but this can be changed by using the css selector `.ol-scale-line`.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/ScaleLine~Options=} opt_options Scale line options.\n * @api\n */\nconst ScaleLine = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const className = options.className !== undefined ? options.className : 'ol-scale-line';\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.innerElement_ = document.createElement('DIV');\n  this.innerElement_.className = className + '-inner';\n\n  /**\n   * @private\n   * @type {Element}\n   */\n  this.element_ = document.createElement('DIV');\n  this.element_.className = className + ' ' + CLASS_UNSELECTABLE;\n  this.element_.appendChild(this.innerElement_);\n\n  /**\n   * @private\n   * @type {?module:ol/View~State}\n   */\n  this.viewState_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minWidth_ = options.minWidth !== undefined ? options.minWidth : 64;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = false;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.renderedWidth_ = undefined;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.renderedHTML_ = '';\n\n  Control.call(this, {\n    element: this.element_,\n    render: options.render || render,\n    target: options.target\n  });\n\n  listen(\n    this, getChangeEventType(UNITS_PROP),\n    this.handleUnitsChanged_, this);\n\n  this.setUnits(/** @type {module:ol/control/ScaleLine~Units} */ (options.units) ||\n      Units.METRIC);\n\n};\n\ninherits(ScaleLine, Control);\n\n\n/**\n * Return the units to use in the scale line.\n * @return {module:ol/control/ScaleLine~Units|undefined} The units\n * to use in the scale line.\n * @observable\n * @api\n */\nScaleLine.prototype.getUnits = function() {\n  return (\n    /** @type {module:ol/control/ScaleLine~Units|undefined} */ (this.get(UNITS_PROP))\n  );\n};\n\n\n/**\n * Update the scale line element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/ScaleLine}\n * @api\n */\nexport function render(mapEvent) {\n  const frameState = mapEvent.frameState;\n  if (!frameState) {\n    this.viewState_ = null;\n  } else {\n    this.viewState_ = frameState.viewState;\n  }\n  this.updateElement_();\n}\n\n\n/**\n * @private\n */\nScaleLine.prototype.handleUnitsChanged_ = function() {\n  this.updateElement_();\n};\n\n\n/**\n * Set the units to use in the scale line.\n * @param {module:ol/control/ScaleLine~Units} units The units to use in the scale line.\n * @observable\n * @api\n */\nScaleLine.prototype.setUnits = function(units) {\n  this.set(UNITS_PROP, units);\n};\n\n\n/**\n * @private\n */\nScaleLine.prototype.updateElement_ = function() {\n  const viewState = this.viewState_;\n\n  if (!viewState) {\n    if (this.renderedVisible_) {\n      this.element_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return;\n  }\n\n  const center = viewState.center;\n  const projection = viewState.projection;\n  const units = this.getUnits();\n  const pointResolutionUnits = units == Units.DEGREES ?\n    ProjUnits.DEGREES :\n    ProjUnits.METERS;\n  let pointResolution =\n      getPointResolution(projection, viewState.resolution, center, pointResolutionUnits);\n  if (projection.getUnits() != ProjUnits.DEGREES && projection.getMetersPerUnit()\n    && pointResolutionUnits == ProjUnits.METERS) {\n    pointResolution *= projection.getMetersPerUnit();\n  }\n\n  let nominalCount = this.minWidth_ * pointResolution;\n  let suffix = '';\n  if (units == Units.DEGREES) {\n    const metersPerDegree = METERS_PER_UNIT[ProjUnits.DEGREES];\n    if (projection.getUnits() == ProjUnits.DEGREES) {\n      nominalCount *= metersPerDegree;\n    } else {\n      pointResolution /= metersPerDegree;\n    }\n    if (nominalCount < metersPerDegree / 60) {\n      suffix = '\\u2033'; // seconds\n      pointResolution *= 3600;\n    } else if (nominalCount < metersPerDegree) {\n      suffix = '\\u2032'; // minutes\n      pointResolution *= 60;\n    } else {\n      suffix = '\\u00b0'; // degrees\n    }\n  } else if (units == Units.IMPERIAL) {\n    if (nominalCount < 0.9144) {\n      suffix = 'in';\n      pointResolution /= 0.0254;\n    } else if (nominalCount < 1609.344) {\n      suffix = 'ft';\n      pointResolution /= 0.3048;\n    } else {\n      suffix = 'mi';\n      pointResolution /= 1609.344;\n    }\n  } else if (units == Units.NAUTICAL) {\n    pointResolution /= 1852;\n    suffix = 'nm';\n  } else if (units == Units.METRIC) {\n    if (nominalCount < 0.001) {\n      suffix = 'm';\n      pointResolution *= 1000000;\n    } else if (nominalCount < 1) {\n      suffix = 'mm';\n      pointResolution *= 1000;\n    } else if (nominalCount < 1000) {\n      suffix = 'm';\n    } else {\n      suffix = 'km';\n      pointResolution /= 1000;\n    }\n  } else if (units == Units.US) {\n    if (nominalCount < 0.9144) {\n      suffix = 'in';\n      pointResolution *= 39.37;\n    } else if (nominalCount < 1609.344) {\n      suffix = 'ft';\n      pointResolution /= 0.30480061;\n    } else {\n      suffix = 'mi';\n      pointResolution /= 1609.3472;\n    }\n  } else {\n    assert(false, 33); // Invalid units\n  }\n\n  let i = 3 * Math.floor(\n    Math.log(this.minWidth_ * pointResolution) / Math.log(10));\n  let count, width;\n  while (true) {\n    count = LEADING_DIGITS[((i % 3) + 3) % 3] *\n        Math.pow(10, Math.floor(i / 3));\n    width = Math.round(count / pointResolution);\n    if (isNaN(width)) {\n      this.element_.style.display = 'none';\n      this.renderedVisible_ = false;\n      return;\n    } else if (width >= this.minWidth_) {\n      break;\n    }\n    ++i;\n  }\n\n  const html = count + ' ' + suffix;\n  if (this.renderedHTML_ != html) {\n    this.innerElement_.innerHTML = html;\n    this.renderedHTML_ = html;\n  }\n\n  if (this.renderedWidth_ != width) {\n    this.innerElement_.style.width = width + 'px';\n    this.renderedWidth_ = width;\n  }\n\n  if (!this.renderedVisible_) {\n    this.element_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n};\n\nexport default ScaleLine;\n","/**\n * @module ol/control/ZoomSlider\n */\nimport {inherits} from '../util.js';\nimport ViewHint from '../ViewHint.js';\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE} from '../css.js';\nimport {easeOut} from '../easing.js';\nimport {listen} from '../events.js';\nimport {stopPropagation} from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {clamp} from '../math.js';\nimport PointerEventType from '../pointer/EventType.js';\nimport PointerEventHandler from '../pointer/PointerEventHandler.js';\n\n\n/**\n * The enum for available directions.\n *\n * @enum {number}\n */\nconst Direction = {\n  VERTICAL: 0,\n  HORIZONTAL: 1\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-zoomslider'] CSS class name.\n * @property {number} [duration=200] Animation duration in milliseconds.\n * @property {function(module:ol/MapEvent)} [render] Function called when the control\n * should be re-rendered. This is called in a `requestAnimationFrame` callback.\n */\n\n\n/**\n * @classdesc\n * A slider type of control for zooming.\n *\n * Example:\n *\n *     map.addControl(new ZoomSlider());\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/ZoomSlider~Options=} opt_options Zoom slider options.\n * @api\n */\nconst ZoomSlider = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * Will hold the current resolution of the view.\n   *\n   * @type {number|undefined}\n   * @private\n   */\n  this.currentResolution_ = undefined;\n\n  /**\n   * The direction of the slider. Will be determined from actual display of the\n   * container and defaults to Direction.VERTICAL.\n   *\n   * @type {Direction}\n   * @private\n   */\n  this.direction_ = Direction.VERTICAL;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.dragging_;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.heightLimit_ = 0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.widthLimit_ = 0;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.previousX_;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.previousY_;\n\n  /**\n   * The calculated thumb size (border box plus margins).  Set when initSlider_\n   * is called.\n   * @type {module:ol/size~Size}\n   * @private\n   */\n  this.thumbSize_ = null;\n\n  /**\n   * Whether the slider is initialized.\n   * @type {boolean}\n   * @private\n   */\n  this.sliderInitialized_ = false;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.duration_ = options.duration !== undefined ? options.duration : 200;\n\n  const className = options.className !== undefined ? options.className : 'ol-zoomslider';\n  const thumbElement = document.createElement('button');\n  thumbElement.setAttribute('type', 'button');\n  thumbElement.className = className + '-thumb ' + CLASS_UNSELECTABLE;\n  const containerElement = document.createElement('div');\n  containerElement.className = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL;\n  containerElement.appendChild(thumbElement);\n  /**\n   * @type {module:ol/pointer/PointerEventHandler}\n   * @private\n   */\n  this.dragger_ = new PointerEventHandler(containerElement);\n\n  listen(this.dragger_, PointerEventType.POINTERDOWN,\n    this.handleDraggerStart_, this);\n  listen(this.dragger_, PointerEventType.POINTERMOVE,\n    this.handleDraggerDrag_, this);\n  listen(this.dragger_, PointerEventType.POINTERUP,\n    this.handleDraggerEnd_, this);\n\n  listen(containerElement, EventType.CLICK, this.handleContainerClick_, this);\n  listen(thumbElement, EventType.CLICK, stopPropagation);\n\n  Control.call(this, {\n    element: containerElement,\n    render: options.render || render\n  });\n};\n\ninherits(ZoomSlider, Control);\n\n\n/**\n * @inheritDoc\n */\nZoomSlider.prototype.disposeInternal = function() {\n  this.dragger_.dispose();\n  Control.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nZoomSlider.prototype.setMap = function(map) {\n  Control.prototype.setMap.call(this, map);\n  if (map) {\n    map.render();\n  }\n};\n\n\n/**\n * Initializes the slider element. This will determine and set this controls\n * direction_ and also constrain the dragging of the thumb to always be within\n * the bounds of the container.\n *\n * @private\n */\nZoomSlider.prototype.initSlider_ = function() {\n  const container = this.element;\n  const containerSize = {\n    width: container.offsetWidth, height: container.offsetHeight\n  };\n\n  const thumb = container.firstElementChild;\n  const computedStyle = getComputedStyle(thumb);\n  const thumbWidth = thumb.offsetWidth +\n      parseFloat(computedStyle['marginRight']) +\n      parseFloat(computedStyle['marginLeft']);\n  const thumbHeight = thumb.offsetHeight +\n      parseFloat(computedStyle['marginTop']) +\n      parseFloat(computedStyle['marginBottom']);\n  this.thumbSize_ = [thumbWidth, thumbHeight];\n\n  if (containerSize.width > containerSize.height) {\n    this.direction_ = Direction.HORIZONTAL;\n    this.widthLimit_ = containerSize.width - thumbWidth;\n  } else {\n    this.direction_ = Direction.VERTICAL;\n    this.heightLimit_ = containerSize.height - thumbHeight;\n  }\n  this.sliderInitialized_ = true;\n};\n\n\n/**\n * Update the zoomslider element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/ZoomSlider}\n * @api\n */\nexport function render(mapEvent) {\n  if (!mapEvent.frameState) {\n    return;\n  }\n  if (!this.sliderInitialized_) {\n    this.initSlider_();\n  }\n  const res = mapEvent.frameState.viewState.resolution;\n  if (res !== this.currentResolution_) {\n    this.currentResolution_ = res;\n    this.setThumbPosition_(res);\n  }\n}\n\n\n/**\n * @param {Event} event The browser event to handle.\n * @private\n */\nZoomSlider.prototype.handleContainerClick_ = function(event) {\n  const view = this.getMap().getView();\n\n  const relativePosition = this.getRelativePosition_(\n    event.offsetX - this.thumbSize_[0] / 2,\n    event.offsetY - this.thumbSize_[1] / 2);\n\n  const resolution = this.getResolutionForPosition_(relativePosition);\n\n  view.animate({\n    resolution: view.constrainResolution(resolution),\n    duration: this.duration_,\n    easing: easeOut\n  });\n};\n\n\n/**\n * Handle dragger start events.\n * @param {module:ol/pointer/PointerEvent} event The drag event.\n * @private\n */\nZoomSlider.prototype.handleDraggerStart_ = function(event) {\n  if (!this.dragging_ && event.originalEvent.target === this.element.firstElementChild) {\n    this.getMap().getView().setHint(ViewHint.INTERACTING, 1);\n    this.previousX_ = event.clientX;\n    this.previousY_ = event.clientY;\n    this.dragging_ = true;\n  }\n};\n\n\n/**\n * Handle dragger drag events.\n *\n * @param {module:ol/pointer/PointerEvent|Event} event The drag event.\n * @private\n */\nZoomSlider.prototype.handleDraggerDrag_ = function(event) {\n  if (this.dragging_) {\n    const element = this.element.firstElementChild;\n    const deltaX = event.clientX - this.previousX_ + parseInt(element.style.left, 10);\n    const deltaY = event.clientY - this.previousY_ + parseInt(element.style.top, 10);\n    const relativePosition = this.getRelativePosition_(deltaX, deltaY);\n    this.currentResolution_ = this.getResolutionForPosition_(relativePosition);\n    this.getMap().getView().setResolution(this.currentResolution_);\n    this.setThumbPosition_(this.currentResolution_);\n    this.previousX_ = event.clientX;\n    this.previousY_ = event.clientY;\n  }\n};\n\n\n/**\n * Handle dragger end events.\n * @param {module:ol/pointer/PointerEvent|Event} event The drag event.\n * @private\n */\nZoomSlider.prototype.handleDraggerEnd_ = function(event) {\n  if (this.dragging_) {\n    const view = this.getMap().getView();\n    view.setHint(ViewHint.INTERACTING, -1);\n\n    view.animate({\n      resolution: view.constrainResolution(this.currentResolution_),\n      duration: this.duration_,\n      easing: easeOut\n    });\n\n    this.dragging_ = false;\n    this.previousX_ = undefined;\n    this.previousY_ = undefined;\n  }\n};\n\n\n/**\n * Positions the thumb inside its container according to the given resolution.\n *\n * @param {number} res The res.\n * @private\n */\nZoomSlider.prototype.setThumbPosition_ = function(res) {\n  const position = this.getPositionForResolution_(res);\n  const thumb = this.element.firstElementChild;\n\n  if (this.direction_ == Direction.HORIZONTAL) {\n    thumb.style.left = this.widthLimit_ * position + 'px';\n  } else {\n    thumb.style.top = this.heightLimit_ * position + 'px';\n  }\n};\n\n\n/**\n * Calculates the relative position of the thumb given x and y offsets.  The\n * relative position scales from 0 to 1.  The x and y offsets are assumed to be\n * in pixel units within the dragger limits.\n *\n * @param {number} x Pixel position relative to the left of the slider.\n * @param {number} y Pixel position relative to the top of the slider.\n * @return {number} The relative position of the thumb.\n * @private\n */\nZoomSlider.prototype.getRelativePosition_ = function(x, y) {\n  let amount;\n  if (this.direction_ === Direction.HORIZONTAL) {\n    amount = x / this.widthLimit_;\n  } else {\n    amount = y / this.heightLimit_;\n  }\n  return clamp(amount, 0, 1);\n};\n\n\n/**\n * Calculates the corresponding resolution of the thumb given its relative\n * position (where 0 is the minimum and 1 is the maximum).\n *\n * @param {number} position The relative position of the thumb.\n * @return {number} The corresponding resolution.\n * @private\n */\nZoomSlider.prototype.getResolutionForPosition_ = function(position) {\n  const fn = this.getMap().getView().getResolutionForValueFunction();\n  return fn(1 - position);\n};\n\n\n/**\n * Determines the relative position of the slider for the given resolution.  A\n * relative position of 0 corresponds to the minimum view resolution.  A\n * relative position of 1 corresponds to the maximum view resolution.\n *\n * @param {number} res The resolution.\n * @return {number} The relative position value (between 0 and 1).\n * @private\n */\nZoomSlider.prototype.getPositionForResolution_ = function(res) {\n  const fn = this.getMap().getView().getValueForResolutionFunction();\n  return 1 - fn(res);\n};\n\nexport default ZoomSlider;\n","/**\n * @module ol/control/ZoomToExtent\n */\nimport {inherits} from '../util.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport Control from '../control/Control.js';\nimport {CLASS_CONTROL, CLASS_UNSELECTABLE} from '../css.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-zoom-extent'] Class name.\n * @property {Element|string} [target] Specify a target if you want the control\n * to be rendered outside of the map's viewport.\n * @property {string|Element} [label='E'] Text label to use for the button.\n * Instead of text, also an element (e.g. a `span` element) can be used.\n * @property {string} [tipLabel='Fit to extent'] Text label to use for the button tip.\n * @property {module:ol/extent~Extent} [extent] The extent to zoom to. If undefined the validity\n * extent of the view projection is used.\n */\n\n\n/**\n * @classdesc\n * A button control which, when pressed, changes the map view to a specific\n * extent. To style this control use the css selector `.ol-zoom-extent`.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/ZoomToExtent~Options=} opt_options Options.\n * @api\n */\nconst ZoomToExtent = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {module:ol/extent~Extent}\n   * @protected\n   */\n  this.extent = options.extent ? options.extent : null;\n\n  const className = options.className !== undefined ? options.className : 'ol-zoom-extent';\n\n  const label = options.label !== undefined ? options.label : 'E';\n  const tipLabel = options.tipLabel !== undefined ? options.tipLabel : 'Fit to extent';\n  const button = document.createElement('button');\n  button.setAttribute('type', 'button');\n  button.title = tipLabel;\n  button.appendChild(\n    typeof label === 'string' ? document.createTextNode(label) : label\n  );\n\n  listen(button, EventType.CLICK, this.handleClick_, this);\n\n  const cssClasses = className + ' ' + CLASS_UNSELECTABLE + ' ' + CLASS_CONTROL;\n  const element = document.createElement('div');\n  element.className = cssClasses;\n  element.appendChild(button);\n\n  Control.call(this, {\n    element: element,\n    target: options.target\n  });\n};\n\ninherits(ZoomToExtent, Control);\n\n\n/**\n * @param {Event} event The event to handle\n * @private\n */\nZoomToExtent.prototype.handleClick_ = function(event) {\n  event.preventDefault();\n  this.handleZoomToExtent();\n};\n\n\n/**\n * @protected\n */\nZoomToExtent.prototype.handleZoomToExtent = function() {\n  const map = this.getMap();\n  const view = map.getView();\n  const extent = !this.extent ? view.getProjection().getExtent() : this.extent;\n  view.fit(extent);\n};\nexport default ZoomToExtent;\n","/**\n * @module ol/webgl/Shader\n */\nimport {FALSE} from '../functions.js';\n\n/**\n * @constructor\n * @abstract\n * @param {string} source Source.\n * @struct\n */\nconst WebGLShader = function(source) {\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.source_ = source;\n\n};\n\n\n/**\n * @abstract\n * @return {number} Type.\n */\nWebGLShader.prototype.getType = function() {};\n\n\n/**\n * @return {string} Source.\n */\nWebGLShader.prototype.getSource = function() {\n  return this.source_;\n};\n\n\n/**\n * @return {boolean} Is animated?\n */\nWebGLShader.prototype.isAnimated = FALSE;\nexport default WebGLShader;\n","/**\n * @module ol/webgl/Fragment\n */\nimport {inherits} from '../util.js';\nimport {FRAGMENT_SHADER} from '../webgl.js';\nimport WebGLShader from '../webgl/Shader.js';\n\n/**\n * @constructor\n * @extends {module:ol/webgl/Shader}\n * @param {string} source Source.\n * @struct\n */\nconst WebGLFragment = function(source) {\n  WebGLShader.call(this, source);\n};\n\ninherits(WebGLFragment, WebGLShader);\n\n\n/**\n * @inheritDoc\n */\nWebGLFragment.prototype.getType = function() {\n  return FRAGMENT_SHADER;\n};\nexport default WebGLFragment;\n","/**\n * @module ol/webgl/Vertex\n */\nimport {inherits} from '../util.js';\nimport {VERTEX_SHADER} from '../webgl.js';\nimport WebGLShader from '../webgl/Shader.js';\n\n/**\n * @constructor\n * @extends {module:ol/webgl/Shader}\n * @param {string} source Source.\n * @struct\n */\nconst WebGLVertex = function(source) {\n  WebGLShader.call(this, source);\n};\n\ninherits(WebGLVertex, WebGLShader);\n\n\n/**\n * @inheritDoc\n */\nWebGLVertex.prototype.getType = function() {\n  return VERTEX_SHADER;\n};\nexport default WebGLVertex;\n","/**\n * @module ol/render/webgl/circlereplay/defaultshader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\nimport WebGLFragment from '../../../webgl/Fragment.js';\nimport WebGLVertex from '../../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\nvarying vec2 v_center;\\nvarying vec2 v_offset;\\nvarying float v_halfWidth;\\nvarying float v_pixelRatio;\\n\\n\\n\\nuniform float u_opacity;\\nuniform vec4 u_fillColor;\\nuniform vec4 u_strokeColor;\\nuniform vec2 u_size;\\n\\nvoid main(void) {\\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\\n  float radius = length(windowCenter - windowOffset);\\n  float dist = length(windowCenter - gl_FragCoord.xy);\\n  if (dist > radius + v_halfWidth) {\\n    if (u_strokeColor.a == 0.0) {\\n      gl_FragColor = u_fillColor;\\n    } else {\\n      gl_FragColor = u_strokeColor;\\n    }\\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\\n  } else if (u_fillColor.a == 0.0) {\\n    // Hooray, no fill, just stroke. We can use real antialiasing.\\n    gl_FragColor = u_strokeColor;\\n    if (dist < radius - v_halfWidth) {\\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\\n    }\\n  } else {\\n    gl_FragColor = u_fillColor;\\n    float strokeDist = radius - v_halfWidth;\\n    float antialias = 2.0 * v_pixelRatio;\\n    if (dist > strokeDist) {\\n      gl_FragColor = u_strokeColor;\\n    } else if (dist >= strokeDist - antialias) {\\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\\n    }\\n  }\\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\\n  if (gl_FragColor.a <= 0.0) {\\n    discard;\\n  }\\n}\\n' :\n  'precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  'varying vec2 v_center;\\nvarying vec2 v_offset;\\nvarying float v_halfWidth;\\nvarying float v_pixelRatio;\\n\\n\\nattribute vec2 a_position;\\nattribute float a_instruction;\\nattribute float a_radius;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_lineWidth;\\nuniform float u_pixelRatio;\\n\\nvoid main(void) {\\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\\n  v_pixelRatio = u_pixelRatio;\\n  float lineWidth = u_lineWidth * u_pixelRatio;\\n  v_halfWidth = lineWidth / 2.0;\\n  if (lineWidth == 0.0) {\\n    lineWidth = 2.0 * u_pixelRatio;\\n  }\\n  vec2 offset;\\n  // Radius with anitaliasing (roughly).\\n  float radius = a_radius + 3.0 * u_pixelRatio;\\n  // Until we get gl_VertexID in WebGL, we store an instruction.\\n  if (a_instruction == 0.0) {\\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\\n    offset = vec2(-1.0, 1.0);\\n  } else if (a_instruction == 1.0) {\\n    offset = vec2(-1.0, -1.0);\\n  } else if (a_instruction == 2.0) {\\n    offset = vec2(1.0, -1.0);\\n  } else {\\n    offset = vec2(1.0, 1.0);\\n  }\\n\\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\\n      0.0, 1.0)).xy;\\n\\n  if (distance(v_center, v_offset) > 20000.0) {\\n    gl_Position = vec4(v_center, 0.0, 1.0);\\n  }\\n}\\n\\n\\n' :\n  'varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;if(f==0.0){offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}');\n","/**\n * @module ol/render/webgl/circlereplay/defaultshader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_projectionMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_projectionMatrix' : 'h');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetScaleMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetScaleMatrix' : 'i');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetRotateMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetRotateMatrix' : 'j');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_lineWidth = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_lineWidth' : 'k');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_pixelRatio = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_pixelRatio' : 'l');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_opacity = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_opacity' : 'm');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_fillColor = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_fillColor' : 'n');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_strokeColor = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_strokeColor' : 'o');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_size = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_size' : 'p');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'e');\n\n  /**\n   * @type {number}\n   */\n  this.a_instruction = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_instruction' : 'f');\n\n  /**\n   * @type {number}\n   */\n  this.a_radius = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_radius' : 'g');\n};\n\nexport default Locations;\n","/**\n * @module ol/vec/mat4\n */\n\n\n/**\n * @return {Array.<number>} 4x4 matrix representing a 3D identity transform.\n */\nexport function create() {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\n\n/**\n * @param {Array.<number>} mat4 Flattened 4x4 matrix receiving the result.\n * @param {module:ol/transform~Transform} transform Transformation matrix.\n * @return {Array.<number>} 2D transformation matrix as flattened 4x4 matrix.\n */\nexport function fromTransform(mat4, transform) {\n  mat4[0] = transform[0];\n  mat4[1] = transform[1];\n  mat4[4] = transform[2];\n  mat4[5] = transform[3];\n  mat4[12] = transform[4];\n  mat4[13] = transform[5];\n  return mat4;\n}\n","/**\n * @module ol/render/webgl/Replay\n */\nimport {inherits} from '../../util.js';\nimport {getCenter} from '../../extent.js';\nimport VectorContext from '../VectorContext.js';\nimport {\n  create as createTransform,\n  reset as resetTransform,\n  rotate as rotateTransform,\n  scale as scaleTransform,\n  translate as translateTransform\n} from '../../transform.js';\nimport {create, fromTransform} from '../../vec/mat4.js';\nimport {ARRAY_BUFFER, ELEMENT_ARRAY_BUFFER, TRIANGLES,\n  UNSIGNED_INT, UNSIGNED_SHORT} from '../../webgl.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/render/VectorContext}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLReplay = function(tolerance, maxExtent) {\n  VectorContext.call(this);\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.tolerance = tolerance;\n\n  /**\n   * @protected\n   * @const\n   * @type {module:ol/extent~Extent}\n   */\n  this.maxExtent = maxExtent;\n\n  /**\n   * The origin of the coordinate system for the point coordinates sent to\n   * the GPU. To eliminate jitter caused by precision problems in the GPU\n   * we use the \"Rendering Relative to Eye\" technique described in the \"3D\n   * Engine Design for Virtual Globes\" book.\n   * @protected\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.origin = getCenter(maxExtent);\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.projectionMatrix_ = createTransform();\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.offsetRotateMatrix_ = createTransform();\n\n  /**\n   * @private\n   * @type {module:ol/transform~Transform}\n   */\n  this.offsetScaleMatrix_ = createTransform();\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.tmpMat4_ = create();\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.indices = [];\n\n  /**\n   * @protected\n   * @type {?module:ol/webgl/Buffer}\n   */\n  this.indicesBuffer = null;\n\n  /**\n   * Start index per feature (the index).\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.startIndices = [];\n\n  /**\n   * Start index per feature (the feature).\n   * @protected\n   * @type {Array.<module:ol/Feature|module:ol/render/Feature>}\n   */\n  this.startIndicesFeature = [];\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.vertices = [];\n\n  /**\n   * @protected\n   * @type {?module:ol/webgl/Buffer}\n   */\n  this.verticesBuffer = null;\n\n  /**\n   * Optional parameter for PolygonReplay instances.\n   * @protected\n   * @type {module:ol/render/webgl/LineStringReplay|undefined}\n   */\n  this.lineStringReplay = undefined;\n\n};\n\ninherits(WebGLReplay, VectorContext);\n\n\n/**\n * @abstract\n * @param {module:ol/webgl/Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\nWebGLReplay.prototype.getDeleteResourcesFunction = function(context) {};\n\n\n/**\n * @abstract\n * @param {module:ol/webgl/Context} context Context.\n */\nWebGLReplay.prototype.finish = function(context) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @return {module:ol/render/webgl/circlereplay/defaultshader/Locations|\n            module:ol/render/webgl/linestringreplay/defaultshader/Locations|\n            module:ol/render/webgl/polygonreplay/defaultshader/Locations|\n            module:ol/render/webgl/texturereplay/defaultshader/Locations} Locations.\n */\nWebGLReplay.prototype.setUpProgram = function(gl, context, size, pixelRatio) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/render/webgl/circlereplay/defaultshader/Locations|\n           module:ol/render/webgl/linestringreplay/defaultshader/Locations|\n           module:ol/render/webgl/polygonreplay/defaultshader/Locations|\n           module:ol/render/webgl/texturereplay/defaultshader/Locations} locations Locations.\n */\nWebGLReplay.prototype.shutDownProgram = function(gl, locations) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {boolean} hitDetection Hit detection mode.\n */\nWebGLReplay.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\n * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplay.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {};\n\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplay.prototype.drawHitDetectionReplay = function(gl, context, skippedFeaturesHash,\n  featureCallback, oneByOne, opt_hitExtent) {\n  if (!oneByOne) {\n    // draw all hit-detection features in \"once\" (by texture group)\n    return this.drawHitDetectionReplayAll(gl, context,\n      skippedFeaturesHash, featureCallback);\n  } else {\n    // draw hit-detection features one by one\n    return this.drawHitDetectionReplayOneByOne(gl, context,\n      skippedFeaturesHash, featureCallback, opt_hitExtent);\n  }\n};\n\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplay.prototype.drawHitDetectionReplayAll = function(gl, context, skippedFeaturesHash,\n  featureCallback) {\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  this.drawReplay(gl, context, skippedFeaturesHash, true);\n\n  const result = featureCallback(null);\n  if (result) {\n    return result;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplay.prototype.replay = function(context,\n  center, resolution, rotation, size, pixelRatio,\n  opacity, skippedFeaturesHash,\n  featureCallback, oneByOne, opt_hitExtent) {\n  const gl = context.getGL();\n  let tmpStencil, tmpStencilFunc, tmpStencilMaskVal, tmpStencilRef, tmpStencilMask,\n      tmpStencilOpFail, tmpStencilOpPass, tmpStencilOpZFail;\n\n  if (this.lineStringReplay) {\n    tmpStencil = gl.isEnabled(gl.STENCIL_TEST);\n    tmpStencilFunc = gl.getParameter(gl.STENCIL_FUNC);\n    tmpStencilMaskVal = gl.getParameter(gl.STENCIL_VALUE_MASK);\n    tmpStencilRef = gl.getParameter(gl.STENCIL_REF);\n    tmpStencilMask = gl.getParameter(gl.STENCIL_WRITEMASK);\n    tmpStencilOpFail = gl.getParameter(gl.STENCIL_FAIL);\n    tmpStencilOpPass = gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS);\n    tmpStencilOpZFail = gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL);\n\n    gl.enable(gl.STENCIL_TEST);\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilMask(255);\n    gl.stencilFunc(gl.ALWAYS, 1, 255);\n    gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\n\n    this.lineStringReplay.replay(context,\n      center, resolution, rotation, size, pixelRatio,\n      opacity, skippedFeaturesHash,\n      featureCallback, oneByOne, opt_hitExtent);\n\n    gl.stencilMask(0);\n    gl.stencilFunc(gl.NOTEQUAL, 1, 255);\n  }\n\n  context.bindBuffer(ARRAY_BUFFER, this.verticesBuffer);\n\n  context.bindBuffer(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n\n  const locations = this.setUpProgram(gl, context, size, pixelRatio);\n\n  // set the \"uniform\" values\n  const projectionMatrix = resetTransform(this.projectionMatrix_);\n  scaleTransform(projectionMatrix, 2 / (resolution * size[0]), 2 / (resolution * size[1]));\n  rotateTransform(projectionMatrix, -rotation);\n  translateTransform(projectionMatrix, -(center[0] - this.origin[0]), -(center[1] - this.origin[1]));\n\n  const offsetScaleMatrix = resetTransform(this.offsetScaleMatrix_);\n  scaleTransform(offsetScaleMatrix, 2 / size[0], 2 / size[1]);\n\n  const offsetRotateMatrix = resetTransform(this.offsetRotateMatrix_);\n  if (rotation !== 0) {\n    rotateTransform(offsetRotateMatrix, -rotation);\n  }\n\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false,\n    fromTransform(this.tmpMat4_, projectionMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetScaleMatrix, false,\n    fromTransform(this.tmpMat4_, offsetScaleMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetRotateMatrix, false,\n    fromTransform(this.tmpMat4_, offsetRotateMatrix));\n  gl.uniform1f(locations.u_opacity, opacity);\n\n  // draw!\n  let result;\n  if (featureCallback === undefined) {\n    this.drawReplay(gl, context, skippedFeaturesHash, false);\n  } else {\n    // draw feature by feature for the hit-detection\n    result = this.drawHitDetectionReplay(gl, context, skippedFeaturesHash,\n      featureCallback, oneByOne, opt_hitExtent);\n  }\n\n  // disable the vertex attrib arrays\n  this.shutDownProgram(gl, locations);\n\n  if (this.lineStringReplay) {\n    if (!tmpStencil) {\n      gl.disable(gl.STENCIL_TEST);\n    }\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilFunc(/** @type {number} */ (tmpStencilFunc),\n      /** @type {number} */ (tmpStencilRef), /** @type {number} */ (tmpStencilMaskVal));\n    gl.stencilMask(/** @type {number} */ (tmpStencilMask));\n    gl.stencilOp(/** @type {number} */ (tmpStencilOpFail),\n      /** @type {number} */ (tmpStencilOpZFail), /** @type {number} */ (tmpStencilOpPass));\n  }\n\n  return result;\n};\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {number} start Start index.\n * @param {number} end End index.\n */\nWebGLReplay.prototype.drawElements = function(\n  gl, context, start, end) {\n  const elementType = context.hasOESElementIndexUint ?\n    UNSIGNED_INT : UNSIGNED_SHORT;\n  const elementSize = context.hasOESElementIndexUint ? 4 : 2;\n\n  const numItems = end - start;\n  const offsetInBytes = start * elementSize;\n  gl.drawElements(TRIANGLES, numItems, elementType, offsetInBytes);\n};\nexport default WebGLReplay;\n","/**\n * @module ol/render/webgl\n */\n\n\n/**\n * @const\n * @type {string}\n */\nexport const DEFAULT_FONT = '10px sans-serif';\n\n\n/**\n * @const\n * @type {module:ol/color~Color}\n */\nexport const DEFAULT_FILLSTYLE = [0.0, 0.0, 0.0, 1.0];\n\n\n/**\n * @const\n * @type {string}\n */\nexport const DEFAULT_LINECAP = 'round';\n\n\n/**\n * @const\n * @type {Array.<number>}\n */\nexport const DEFAULT_LINEDASH = [];\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEFAULT_LINEDASHOFFSET = 0;\n\n\n/**\n * @const\n * @type {string}\n */\nexport const DEFAULT_LINEJOIN = 'round';\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEFAULT_MITERLIMIT = 10;\n\n/**\n * @const\n * @type {module:ol/color~Color}\n */\nexport const DEFAULT_STROKESTYLE = [0.0, 0.0, 0.0, 1.0];\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEFAULT_TEXTALIGN = 0.5;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEFAULT_TEXTBASELINE = 0.5;\n\n\n/**\n * @const\n * @type {number}\n */\nexport const DEFAULT_LINEWIDTH = 1;\n\n/**\n * @const\n * @type {number}\n */\nexport const EPSILON = Number.EPSILON || 2.220446049250313e-16;\n\n/**\n * Calculates the orientation of a triangle based on the determinant method.\n * @param {number} x1 First X coordinate.\n * @param {number} y1 First Y coordinate.\n * @param {number} x2 Second X coordinate.\n * @param {number} y2 Second Y coordinate.\n * @param {number} x3 Third X coordinate.\n * @param {number} y3 Third Y coordinate.\n * @return {boolean|undefined} Triangle is clockwise.\n */\nexport const triangleIsCounterClockwise = function(x1, y1, x2, y2, x3, y3) {\n  const area = (x2 - x1) * (y3 - y1) - (x3 - x1) * (y2 - y1);\n  return (area <= EPSILON && area >= -EPSILON) ?\n    undefined : area > 0;\n};\n\n","/**\n * @module ol/webgl/Buffer\n */\nimport {STATIC_DRAW, STREAM_DRAW, DYNAMIC_DRAW} from '../webgl.js';\n\n/**\n * @enum {number}\n */\nconst BufferUsage = {\n  STATIC_DRAW: STATIC_DRAW,\n  STREAM_DRAW: STREAM_DRAW,\n  DYNAMIC_DRAW: DYNAMIC_DRAW\n};\n\n/**\n * @constructor\n * @param {Array.<number>=} opt_arr Array.\n * @param {number=} opt_usage Usage.\n * @struct\n */\nconst WebGLBuffer = function(opt_arr, opt_usage) {\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.arr_ = opt_arr !== undefined ? opt_arr : [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.usage_ = opt_usage !== undefined ? opt_usage : BufferUsage.STATIC_DRAW;\n\n};\n\n\n/**\n * @return {Array.<number>} Array.\n */\nWebGLBuffer.prototype.getArray = function() {\n  return this.arr_;\n};\n\n\n/**\n * @return {number} Usage.\n */\nWebGLBuffer.prototype.getUsage = function() {\n  return this.usage_;\n};\n\nexport default WebGLBuffer;\n","/**\n * @module ol/render/webgl/CircleReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {equals} from '../../array.js';\nimport {asArray} from '../../color.js';\nimport {intersects} from '../../extent.js';\nimport {isEmpty} from '../../obj.js';\nimport {translate} from '../../geom/flat/transform.js';\nimport {fragment, vertex} from '../webgl/circlereplay/defaultshader.js';\nimport Locations from '../webgl/circlereplay/defaultshader/Locations.js';\nimport WebGLReplay from '../webgl/Replay.js';\nimport {DEFAULT_LINEDASH, DEFAULT_LINEDASHOFFSET, DEFAULT_STROKESTYLE,\n  DEFAULT_FILLSTYLE, DEFAULT_LINEWIDTH} from '../webgl.js';\nimport {FLOAT} from '../../webgl.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/webgl/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLCircleReplay = function(tolerance, maxExtent) {\n  WebGLReplay.call(this, tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {module:ol/render/webgl/circlereplay/defaultshader/Locations}\n   */\n  this.defaultLocations_ = null;\n\n  /**\n   * @private\n   * @type {Array.<Array.<Array.<number>|number>>}\n   */\n  this.styles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.styleIndices_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.radius_ = 0;\n\n  /**\n   * @private\n   * @type {{fillColor: (Array.<number>|null),\n   *         strokeColor: (Array.<number>|null),\n   *         lineDash: Array.<number>,\n   *         lineDashOffset: (number|undefined),\n   *         lineWidth: (number|undefined),\n   *         changed: boolean}|null}\n   */\n  this.state_ = {\n    fillColor: null,\n    strokeColor: null,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineWidth: undefined,\n    changed: false\n  };\n\n};\n\ninherits(WebGLCircleReplay, WebGLReplay);\n\n\n/**\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\nWebGLCircleReplay.prototype.drawCoordinates_ = function(\n  flatCoordinates, offset, end, stride) {\n  let numVertices = this.vertices.length;\n  let numIndices = this.indices.length;\n  let n = numVertices / 4;\n  let i, ii;\n  for (i = offset, ii = end; i < ii; i += stride) {\n    this.vertices[numVertices++] = flatCoordinates[i];\n    this.vertices[numVertices++] = flatCoordinates[i + 1];\n    this.vertices[numVertices++] = 0;\n    this.vertices[numVertices++] = this.radius_;\n\n    this.vertices[numVertices++] = flatCoordinates[i];\n    this.vertices[numVertices++] = flatCoordinates[i + 1];\n    this.vertices[numVertices++] = 1;\n    this.vertices[numVertices++] = this.radius_;\n\n    this.vertices[numVertices++] = flatCoordinates[i];\n    this.vertices[numVertices++] = flatCoordinates[i + 1];\n    this.vertices[numVertices++] = 2;\n    this.vertices[numVertices++] = this.radius_;\n\n    this.vertices[numVertices++] = flatCoordinates[i];\n    this.vertices[numVertices++] = flatCoordinates[i + 1];\n    this.vertices[numVertices++] = 3;\n    this.vertices[numVertices++] = this.radius_;\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 1;\n    this.indices[numIndices++] = n + 2;\n\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n + 3;\n    this.indices[numIndices++] = n;\n\n    n += 4;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.drawCircle = function(circleGeometry, feature) {\n  const radius = circleGeometry.getRadius();\n  const stride = circleGeometry.getStride();\n  if (radius) {\n    this.startIndices.push(this.indices.length);\n    this.startIndicesFeature.push(feature);\n    if (this.state_.changed) {\n      this.styleIndices_.push(this.indices.length);\n      this.state_.changed = false;\n    }\n\n    this.radius_ = radius;\n    let flatCoordinates = circleGeometry.getFlatCoordinates();\n    flatCoordinates = translate(flatCoordinates, 0, 2,\n      stride, -this.origin[0], -this.origin[1]);\n    this.drawCoordinates_(flatCoordinates, 0, 2, stride);\n  } else {\n    if (this.state_.changed) {\n      this.styles_.pop();\n      if (this.styles_.length) {\n        const lastState = this.styles_[this.styles_.length - 1];\n        this.state_.fillColor =  /** @type {Array.<number>} */ (lastState[0]);\n        this.state_.strokeColor = /** @type {Array.<number>} */ (lastState[1]);\n        this.state_.lineWidth = /** @type {number} */ (lastState[2]);\n        this.state_.changed = false;\n      }\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n **/\nWebGLCircleReplay.prototype.finish = function(context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new WebGLBuffer(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new WebGLBuffer(this.indices);\n\n  this.startIndices.push(this.indices.length);\n\n  //Clean up, if there is nothing to draw\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.getDeleteResourcesFunction = function(context) {\n  // We only delete our stuff here. The shaders and the program may\n  // be used by other CircleReplay instances (for other layers). And\n  // they will be deleted when disposing of the module:ol/webgl/Context~WebGLContext\n  // object.\n  const verticesBuffer = this.verticesBuffer;\n  const indicesBuffer = this.indicesBuffer;\n  return function() {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n  };\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  const program = context.getProgram(fragment, vertex);\n\n  // get the locations\n  let locations;\n  if (!this.defaultLocations_) {\n    locations = new Locations(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\n    false, 16, 0);\n\n  gl.enableVertexAttribArray(locations.a_instruction);\n  gl.vertexAttribPointer(locations.a_instruction, 1, FLOAT,\n    false, 16, 8);\n\n  gl.enableVertexAttribArray(locations.a_radius);\n  gl.vertexAttribPointer(locations.a_radius, 1, FLOAT,\n    false, 16, 12);\n\n  // Enable renderer specific uniforms.\n  gl.uniform2fv(locations.u_size, size);\n  gl.uniform1f(locations.u_pixelRatio, pixelRatio);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_position);\n  gl.disableVertexAttribArray(locations.a_instruction);\n  gl.disableVertexAttribArray(locations.a_radius);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  if (!isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    let i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\n      this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\n        /** @type {number} */ (nextStyle[2]));\n      this.drawElements(gl, context, start, end);\n      end = start;\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n  featureCallback, opt_hitExtent) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\n    this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\n      /** @type {number} */ (nextStyle[2]));\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || intersects(\n            /** @type {Array<number>} */ (opt_hitExtent),\n            feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        const result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n\n      }\n      featureIndex--;\n      end = start;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\nWebGLCircleReplay.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\n    this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\n      /** @type {number} */ (nextStyle[2]));\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n        }\n        end = featureStart;\n      }\n      featureIndex--;\n      start = featureStart;\n    }\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n    }\n    start = end = groupStart;\n  }\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n */\nWebGLCircleReplay.prototype.setFillStyle_ = function(gl, color) {\n  gl.uniform4fv(this.defaultLocations_.u_fillColor, color);\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n * @param {number} lineWidth Line width.\n */\nWebGLCircleReplay.prototype.setStrokeStyle_ = function(gl, color, lineWidth) {\n  gl.uniform4fv(this.defaultLocations_.u_strokeColor, color);\n  gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLCircleReplay.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  let strokeStyleColor, strokeStyleWidth;\n  if (strokeStyle) {\n    const strokeStyleLineDash = strokeStyle.getLineDash();\n    this.state_.lineDash = strokeStyleLineDash ?\n      strokeStyleLineDash : DEFAULT_LINEDASH;\n    const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n    this.state_.lineDashOffset = strokeStyleLineDashOffset ?\n      strokeStyleLineDashOffset : DEFAULT_LINEDASHOFFSET;\n    strokeStyleColor = strokeStyle.getColor();\n    if (!(strokeStyleColor instanceof CanvasGradient) &&\n        !(strokeStyleColor instanceof CanvasPattern)) {\n      strokeStyleColor = asArray(strokeStyleColor).map(function(c, i) {\n        return i != 3 ? c / 255 : c;\n      }) || DEFAULT_STROKESTYLE;\n    } else {\n      strokeStyleColor = DEFAULT_STROKESTYLE;\n    }\n    strokeStyleWidth = strokeStyle.getWidth();\n    strokeStyleWidth = strokeStyleWidth !== undefined ?\n      strokeStyleWidth : DEFAULT_LINEWIDTH;\n  } else {\n    strokeStyleColor = [0, 0, 0, 0];\n    strokeStyleWidth = 0;\n  }\n  let fillStyleColor = fillStyle ? fillStyle.getColor() : [0, 0, 0, 0];\n  if (!(fillStyleColor instanceof CanvasGradient) &&\n      !(fillStyleColor instanceof CanvasPattern)) {\n    fillStyleColor = asArray(fillStyleColor).map(function(c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || DEFAULT_FILLSTYLE;\n  } else {\n    fillStyleColor = DEFAULT_FILLSTYLE;\n  }\n  if (!this.state_.strokeColor || !equals(this.state_.strokeColor, strokeStyleColor) ||\n      !this.state_.fillColor || !equals(this.state_.fillColor, fillStyleColor) ||\n      this.state_.lineWidth !== strokeStyleWidth) {\n    this.state_.changed = true;\n    this.state_.fillColor = fillStyleColor;\n    this.state_.strokeColor = strokeStyleColor;\n    this.state_.lineWidth = strokeStyleWidth;\n    this.styles_.push([fillStyleColor, strokeStyleColor, strokeStyleWidth]);\n  }\n};\nexport default WebGLCircleReplay;\n","/**\n * @module ol/render/webgl/texturereplay/defaultshader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\nimport WebGLFragment from '../../../webgl/Fragment.js';\nimport WebGLVertex from '../../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\nvarying vec2 v_texCoord;\\nvarying float v_opacity;\\n\\nuniform float u_opacity;\\nuniform sampler2D u_image;\\n\\nvoid main(void) {\\n  vec4 texColor = texture2D(u_image, v_texCoord);\\n  gl_FragColor.rgb = texColor.rgb;\\n  float alpha = texColor.a * v_opacity * u_opacity;\\n  if (alpha == 0.0) {\\n    discard;\\n  }\\n  gl_FragColor.a = alpha;\\n}\\n' :\n  'precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  'varying vec2 v_texCoord;\\nvarying float v_opacity;\\n\\nattribute vec2 a_position;\\nattribute vec2 a_texCoord;\\nattribute vec2 a_offsets;\\nattribute float a_opacity;\\nattribute float a_rotateWithView;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\n\\nvoid main(void) {\\n  mat4 offsetMatrix = u_offsetScaleMatrix;\\n  if (a_rotateWithView == 1.0) {\\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\\n  }\\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n  v_texCoord = a_texCoord;\\n  v_opacity = a_opacity;\\n}\\n\\n\\n' :\n  'varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}');\n","/**\n * @module ol/render/webgl/texturereplay/defaultshader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_projectionMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_projectionMatrix' : 'h');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetScaleMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetScaleMatrix' : 'i');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetRotateMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetRotateMatrix' : 'j');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_opacity = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_opacity' : 'k');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_image = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_image' : 'l');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'c');\n\n  /**\n   * @type {number}\n   */\n  this.a_texCoord = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_texCoord' : 'd');\n\n  /**\n   * @type {number}\n   */\n  this.a_offsets = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_offsets' : 'e');\n\n  /**\n   * @type {number}\n   */\n  this.a_opacity = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_opacity' : 'f');\n\n  /**\n   * @type {number}\n   */\n  this.a_rotateWithView = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_rotateWithView' : 'g');\n};\n\nexport default Locations;\n","/**\n * @module ol/webgl/ContextEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  LOST: 'webglcontextlost',\n  RESTORED: 'webglcontextrestored'\n};\n","/**\n * @module ol/webgl/Context\n */\nimport {getUid, inherits} from '../util.js';\nimport {EXTENSIONS as WEBGL_EXTENSIONS} from '../webgl.js';\nimport Disposable from '../Disposable.js';\nimport {includes} from '../array.js';\nimport {listen, unlistenAll} from '../events.js';\nimport {clear} from '../obj.js';\nimport {ARRAY_BUFFER, ELEMENT_ARRAY_BUFFER, TEXTURE_2D, TEXTURE_WRAP_S, TEXTURE_WRAP_T} from '../webgl.js';\nimport ContextEventType from '../webgl/ContextEventType.js';\n\n\n/**\n * @typedef {Object} BufferCacheEntry\n * @property {module:ol/webgl/Buffer} buf\n * @property {WebGLBuffer} buffer\n */\n\n\n/**\n * @classdesc\n * A WebGL context for accessing low-level WebGL capabilities.\n *\n * @constructor\n * @extends {module:ol/Disposable}\n * @param {HTMLCanvasElement} canvas Canvas.\n * @param {WebGLRenderingContext} gl GL.\n */\nconst WebGLContext = function(canvas, gl) {\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = canvas;\n\n  /**\n   * @private\n   * @type {WebGLRenderingContext}\n   */\n  this.gl_ = gl;\n\n  /**\n   * @private\n   * @type {!Object.<string, module:ol/webgl/Context~BufferCacheEntry>}\n   */\n  this.bufferCache_ = {};\n\n  /**\n   * @private\n   * @type {!Object.<string, WebGLShader>}\n   */\n  this.shaderCache_ = {};\n\n  /**\n   * @private\n   * @type {!Object.<string, WebGLProgram>}\n   */\n  this.programCache_ = {};\n\n  /**\n   * @private\n   * @type {WebGLProgram}\n   */\n  this.currentProgram_ = null;\n\n  /**\n   * @private\n   * @type {WebGLFramebuffer}\n   */\n  this.hitDetectionFramebuffer_ = null;\n\n  /**\n   * @private\n   * @type {WebGLTexture}\n   */\n  this.hitDetectionTexture_ = null;\n\n  /**\n   * @private\n   * @type {WebGLRenderbuffer}\n   */\n  this.hitDetectionRenderbuffer_ = null;\n\n  /**\n   * @type {boolean}\n   */\n  this.hasOESElementIndexUint = includes(WEBGL_EXTENSIONS, 'OES_element_index_uint');\n\n  // use the OES_element_index_uint extension if available\n  if (this.hasOESElementIndexUint) {\n    gl.getExtension('OES_element_index_uint');\n  }\n\n  listen(this.canvas_, ContextEventType.LOST,\n    this.handleWebGLContextLost, this);\n  listen(this.canvas_, ContextEventType.RESTORED,\n    this.handleWebGLContextRestored, this);\n\n};\n\ninherits(WebGLContext, Disposable);\n\n\n/**\n * Just bind the buffer if it's in the cache. Otherwise create\n * the WebGL buffer, bind it, populate it, and add an entry to\n * the cache.\n * @param {number} target Target.\n * @param {module:ol/webgl/Buffer} buf Buffer.\n */\nWebGLContext.prototype.bindBuffer = function(target, buf) {\n  const gl = this.getGL();\n  const arr = buf.getArray();\n  const bufferKey = String(getUid(buf));\n  if (bufferKey in this.bufferCache_) {\n    const bufferCacheEntry = this.bufferCache_[bufferKey];\n    gl.bindBuffer(target, bufferCacheEntry.buffer);\n  } else {\n    const buffer = gl.createBuffer();\n    gl.bindBuffer(target, buffer);\n    let /** @type {ArrayBufferView} */ arrayBuffer;\n    if (target == ARRAY_BUFFER) {\n      arrayBuffer = new Float32Array(arr);\n    } else if (target == ELEMENT_ARRAY_BUFFER) {\n      arrayBuffer = this.hasOESElementIndexUint ?\n        new Uint32Array(arr) : new Uint16Array(arr);\n    }\n    gl.bufferData(target, arrayBuffer, buf.getUsage());\n    this.bufferCache_[bufferKey] = {\n      buf: buf,\n      buffer: buffer\n    };\n  }\n};\n\n\n/**\n * @param {module:ol/webgl/Buffer} buf Buffer.\n */\nWebGLContext.prototype.deleteBuffer = function(buf) {\n  const gl = this.getGL();\n  const bufferKey = String(getUid(buf));\n  const bufferCacheEntry = this.bufferCache_[bufferKey];\n  if (!gl.isContextLost()) {\n    gl.deleteBuffer(bufferCacheEntry.buffer);\n  }\n  delete this.bufferCache_[bufferKey];\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLContext.prototype.disposeInternal = function() {\n  unlistenAll(this.canvas_);\n  const gl = this.getGL();\n  if (!gl.isContextLost()) {\n    for (const key in this.bufferCache_) {\n      gl.deleteBuffer(this.bufferCache_[key].buffer);\n    }\n    for (const key in this.programCache_) {\n      gl.deleteProgram(this.programCache_[key]);\n    }\n    for (const key in this.shaderCache_) {\n      gl.deleteShader(this.shaderCache_[key]);\n    }\n    // delete objects for hit-detection\n    gl.deleteFramebuffer(this.hitDetectionFramebuffer_);\n    gl.deleteRenderbuffer(this.hitDetectionRenderbuffer_);\n    gl.deleteTexture(this.hitDetectionTexture_);\n  }\n};\n\n\n/**\n * @return {HTMLCanvasElement} Canvas.\n */\nWebGLContext.prototype.getCanvas = function() {\n  return this.canvas_;\n};\n\n\n/**\n * Get the WebGL rendering context\n * @return {WebGLRenderingContext} The rendering context.\n * @api\n */\nWebGLContext.prototype.getGL = function() {\n  return this.gl_;\n};\n\n\n/**\n * Get the frame buffer for hit detection.\n * @return {WebGLFramebuffer} The hit detection frame buffer.\n */\nWebGLContext.prototype.getHitDetectionFramebuffer = function() {\n  if (!this.hitDetectionFramebuffer_) {\n    this.initHitDetectionFramebuffer_();\n  }\n  return this.hitDetectionFramebuffer_;\n};\n\n\n/**\n * Get shader from the cache if it's in the cache. Otherwise, create\n * the WebGL shader, compile it, and add entry to cache.\n * @param {module:ol/webgl/Shader} shaderObject Shader object.\n * @return {WebGLShader} Shader.\n */\nWebGLContext.prototype.getShader = function(shaderObject) {\n  const shaderKey = String(getUid(shaderObject));\n  if (shaderKey in this.shaderCache_) {\n    return this.shaderCache_[shaderKey];\n  } else {\n    const gl = this.getGL();\n    const shader = gl.createShader(shaderObject.getType());\n    gl.shaderSource(shader, shaderObject.getSource());\n    gl.compileShader(shader);\n    this.shaderCache_[shaderKey] = shader;\n    return shader;\n  }\n};\n\n\n/**\n * Get the program from the cache if it's in the cache. Otherwise create\n * the WebGL program, attach the shaders to it, and add an entry to the\n * cache.\n * @param {module:ol/webgl/Fragment} fragmentShaderObject Fragment shader.\n * @param {module:ol/webgl/Vertex} vertexShaderObject Vertex shader.\n * @return {WebGLProgram} Program.\n */\nWebGLContext.prototype.getProgram = function(fragmentShaderObject, vertexShaderObject) {\n  const programKey = getUid(fragmentShaderObject) + '/' + getUid(vertexShaderObject);\n  if (programKey in this.programCache_) {\n    return this.programCache_[programKey];\n  } else {\n    const gl = this.getGL();\n    const program = gl.createProgram();\n    gl.attachShader(program, this.getShader(fragmentShaderObject));\n    gl.attachShader(program, this.getShader(vertexShaderObject));\n    gl.linkProgram(program);\n    this.programCache_[programKey] = program;\n    return program;\n  }\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nWebGLContext.prototype.handleWebGLContextLost = function() {\n  clear(this.bufferCache_);\n  clear(this.shaderCache_);\n  clear(this.programCache_);\n  this.currentProgram_ = null;\n  this.hitDetectionFramebuffer_ = null;\n  this.hitDetectionTexture_ = null;\n  this.hitDetectionRenderbuffer_ = null;\n};\n\n\n/**\n * FIXME empty description for jsdoc\n */\nWebGLContext.prototype.handleWebGLContextRestored = function() {\n};\n\n\n/**\n * Creates a 1x1 pixel framebuffer for the hit-detection.\n * @private\n */\nWebGLContext.prototype.initHitDetectionFramebuffer_ = function() {\n  const gl = this.gl_;\n  const framebuffer = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\n  const texture = createEmptyTexture(gl, 1, 1);\n  const renderbuffer = gl.createRenderbuffer();\n  gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\n  gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, 1, 1);\n  gl.framebufferTexture2D(\n    gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT,\n    gl.RENDERBUFFER, renderbuffer);\n\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n  this.hitDetectionFramebuffer_ = framebuffer;\n  this.hitDetectionTexture_ = texture;\n  this.hitDetectionRenderbuffer_ = renderbuffer;\n};\n\n\n/**\n * Use a program.  If the program is already in use, this will return `false`.\n * @param {WebGLProgram} program Program.\n * @return {boolean} Changed.\n * @api\n */\nWebGLContext.prototype.useProgram = function(program) {\n  if (program == this.currentProgram_) {\n    return false;\n  } else {\n    const gl = this.getGL();\n    gl.useProgram(program);\n    this.currentProgram_ = program;\n    return true;\n  }\n};\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nfunction createTextureInternal(gl, opt_wrapS, opt_wrapT) {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n  if (opt_wrapS !== undefined) {\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_WRAP_S, opt_wrapS);\n  }\n  if (opt_wrapT !== undefined) {\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_WRAP_T, opt_wrapT);\n  }\n\n  return texture;\n}\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {number} width Width.\n * @param {number} height Height.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nexport function createEmptyTexture(gl, width, height, opt_wrapS, opt_wrapT) {\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n  return texture;\n}\n\n\n/**\n * @param {WebGLRenderingContext} gl WebGL rendering context.\n * @param {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} image Image.\n * @param {number=} opt_wrapS wrapS.\n * @param {number=} opt_wrapT wrapT.\n * @return {WebGLTexture} The texture.\n */\nexport function createTexture(gl, image, opt_wrapS, opt_wrapT) {\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  return texture;\n}\n\nexport default WebGLContext;\n","/**\n * @module ol/render/webgl/TextureReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {intersects} from '../../extent.js';\nimport {isEmpty} from '../../obj.js';\nimport {fragment, vertex} from '../webgl/texturereplay/defaultshader.js';\nimport Locations from '../webgl/texturereplay/defaultshader/Locations.js';\nimport WebGLReplay from '../webgl/Replay.js';\nimport {CLAMP_TO_EDGE, FLOAT, TEXTURE_2D} from '../../webgl.js';\nimport {createTexture} from '../../webgl/Context.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/render/webgl/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLTextureReplay = function(tolerance, maxExtent) {\n  WebGLReplay.call(this, tolerance, maxExtent);\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.anchorX = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.anchorY = undefined;\n\n  /**\n   * @type {Array.<number>}\n   * @protected\n   */\n  this.groupIndices = [];\n\n  /**\n   * @type {Array.<number>}\n   * @protected\n   */\n  this.hitDetectionGroupIndices = [];\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.height = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.imageHeight = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.imageWidth = undefined;\n\n  /**\n   * @protected\n   * @type {module:ol/render/webgl/texturereplay/defaultshader/Locations}\n   */\n  this.defaultLocations = null;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.opacity = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.originX = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.originY = undefined;\n\n  /**\n   * @protected\n   * @type {boolean|undefined}\n   */\n  this.rotateWithView = undefined;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.rotation = undefined;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.scale = undefined;\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.width = undefined;\n};\n\ninherits(WebGLTextureReplay, WebGLReplay);\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.getDeleteResourcesFunction = function(context) {\n  const verticesBuffer = this.verticesBuffer;\n  const indicesBuffer = this.indicesBuffer;\n  const textures = this.getTextures(true);\n  const gl = context.getGL();\n  return function() {\n    if (!gl.isContextLost()) {\n      let i, ii;\n      for (i = 0, ii = textures.length; i < ii; ++i) {\n        gl.deleteTexture(textures[i]);\n      }\n    }\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n  };\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} My end.\n * @protected\n */\nWebGLTextureReplay.prototype.drawCoordinates = function(flatCoordinates, offset, end, stride) {\n  const anchorX = /** @type {number} */ (this.anchorX);\n  const anchorY = /** @type {number} */ (this.anchorY);\n  const height = /** @type {number} */ (this.height);\n  const imageHeight = /** @type {number} */ (this.imageHeight);\n  const imageWidth = /** @type {number} */ (this.imageWidth);\n  const opacity = /** @type {number} */ (this.opacity);\n  const originX = /** @type {number} */ (this.originX);\n  const originY = /** @type {number} */ (this.originY);\n  const rotateWithView = this.rotateWithView ? 1.0 : 0.0;\n  // this.rotation_ is anti-clockwise, but rotation is clockwise\n  const rotation = /** @type {number} */ (-this.rotation);\n  const scale = /** @type {number} */ (this.scale);\n  const width = /** @type {number} */ (this.width);\n  const cos = Math.cos(rotation);\n  const sin = Math.sin(rotation);\n  let numIndices = this.indices.length;\n  let numVertices = this.vertices.length;\n  let i, n, offsetX, offsetY, x, y;\n  for (i = offset; i < end; i += stride) {\n    x = flatCoordinates[i] - this.origin[0];\n    y = flatCoordinates[i + 1] - this.origin[1];\n\n    // There are 4 vertices per [x, y] point, one for each corner of the\n    // rectangle we're going to draw. We'd use 1 vertex per [x, y] point if\n    // WebGL supported Geometry Shaders (which can emit new vertices), but that\n    // is not currently the case.\n    //\n    // And each vertex includes 8 values: the x and y coordinates, the x and\n    // y offsets used to calculate the position of the corner, the u and\n    // v texture coordinates for the corner, the opacity, and whether the\n    // the image should be rotated with the view (rotateWithView).\n\n    n = numVertices / 8;\n\n    // bottom-left corner\n    offsetX = -scale * anchorX;\n    offsetY = -scale * (height - anchorY);\n    this.vertices[numVertices++] = x;\n    this.vertices[numVertices++] = y;\n    this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n    this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n    this.vertices[numVertices++] = originX / imageWidth;\n    this.vertices[numVertices++] = (originY + height) / imageHeight;\n    this.vertices[numVertices++] = opacity;\n    this.vertices[numVertices++] = rotateWithView;\n\n    // bottom-right corner\n    offsetX = scale * (width - anchorX);\n    offsetY = -scale * (height - anchorY);\n    this.vertices[numVertices++] = x;\n    this.vertices[numVertices++] = y;\n    this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n    this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n    this.vertices[numVertices++] = (originX + width) / imageWidth;\n    this.vertices[numVertices++] = (originY + height) / imageHeight;\n    this.vertices[numVertices++] = opacity;\n    this.vertices[numVertices++] = rotateWithView;\n\n    // top-right corner\n    offsetX = scale * (width - anchorX);\n    offsetY = scale * anchorY;\n    this.vertices[numVertices++] = x;\n    this.vertices[numVertices++] = y;\n    this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n    this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n    this.vertices[numVertices++] = (originX + width) / imageWidth;\n    this.vertices[numVertices++] = originY / imageHeight;\n    this.vertices[numVertices++] = opacity;\n    this.vertices[numVertices++] = rotateWithView;\n\n    // top-left corner\n    offsetX = -scale * anchorX;\n    offsetY = scale * anchorY;\n    this.vertices[numVertices++] = x;\n    this.vertices[numVertices++] = y;\n    this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\n    this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\n    this.vertices[numVertices++] = originX / imageWidth;\n    this.vertices[numVertices++] = originY / imageHeight;\n    this.vertices[numVertices++] = opacity;\n    this.vertices[numVertices++] = rotateWithView;\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 1;\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n + 3;\n  }\n\n  return numVertices;\n};\n\n\n/**\n * @protected\n * @param {Array.<WebGLTexture>} textures Textures.\n * @param {Array.<HTMLCanvasElement|HTMLImageElement|HTMLVideoElement>} images Images.\n * @param {!Object.<string, WebGLTexture>} texturePerImage Texture cache.\n * @param {WebGLRenderingContext} gl Gl.\n */\nWebGLTextureReplay.prototype.createTextures = function(textures, images, texturePerImage, gl) {\n  let texture, image, uid, i;\n  const ii = images.length;\n  for (i = 0; i < ii; ++i) {\n    image = images[i];\n\n    uid = getUid(image).toString();\n    if (uid in texturePerImage) {\n      texture = texturePerImage[uid];\n    } else {\n      texture = createTexture(\n        gl, image, CLAMP_TO_EDGE, CLAMP_TO_EDGE);\n      texturePerImage[uid] = texture;\n    }\n    textures[i] = texture;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  const program = context.getProgram(fragment, vertex);\n\n  // get the locations\n  let locations;\n  if (!this.defaultLocations) {\n    locations = new Locations(gl, program);\n    this.defaultLocations = locations;\n  } else {\n    locations = this.defaultLocations;\n  }\n\n  // use the program (FIXME: use the return value)\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\n    false, 32, 0);\n\n  gl.enableVertexAttribArray(locations.a_offsets);\n  gl.vertexAttribPointer(locations.a_offsets, 2, FLOAT,\n    false, 32, 8);\n\n  gl.enableVertexAttribArray(locations.a_texCoord);\n  gl.vertexAttribPointer(locations.a_texCoord, 2, FLOAT,\n    false, 32, 16);\n\n  gl.enableVertexAttribArray(locations.a_opacity);\n  gl.vertexAttribPointer(locations.a_opacity, 1, FLOAT,\n    false, 32, 24);\n\n  gl.enableVertexAttribArray(locations.a_rotateWithView);\n  gl.vertexAttribPointer(locations.a_rotateWithView, 1, FLOAT,\n    false, 32, 28);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_position);\n  gl.disableVertexAttribArray(locations.a_offsets);\n  gl.disableVertexAttribArray(locations.a_texCoord);\n  gl.disableVertexAttribArray(locations.a_opacity);\n  gl.disableVertexAttribArray(locations.a_rotateWithView);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  const textures = hitDetection ? this.getHitDetectionTextures() : this.getTextures();\n  const groupIndices = hitDetection ? this.hitDetectionGroupIndices : this.groupIndices;\n\n  if (!isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices);\n  } else {\n    let i, ii, start;\n    for (i = 0, ii = textures.length, start = 0; i < ii; ++i) {\n      gl.bindTexture(TEXTURE_2D, textures[i]);\n      const end = groupIndices[i];\n      this.drawElements(gl, context, start, end);\n      start = end;\n    }\n  }\n};\n\n\n/**\n * Draw the replay while paying attention to skipped features.\n *\n * This functions creates groups of features that can be drawn to together,\n * so that the number of `drawElements` calls is minimized.\n *\n * For example given the following texture groups:\n *\n *    Group 1: A B C\n *    Group 2: D [E] F G\n *\n * If feature E should be skipped, the following `drawElements` calls will be\n * made:\n *\n *    drawElements with feature A, B and C\n *    drawElements with feature D\n *    drawElements with feature F and G\n *\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {Array.<WebGLTexture>} textures Textures.\n * @param {Array.<number>} groupIndices Texture group indices.\n */\nWebGLTextureReplay.prototype.drawReplaySkipping = function(gl, context, skippedFeaturesHash, textures,\n  groupIndices) {\n  let featureIndex = 0;\n\n  let i, ii;\n  for (i = 0, ii = textures.length; i < ii; ++i) {\n    gl.bindTexture(TEXTURE_2D, textures[i]);\n    const groupStart = (i > 0) ? groupIndices[i - 1] : 0;\n    const groupEnd = groupIndices[i];\n\n    let start = groupStart;\n    let end = groupStart;\n    while (featureIndex < this.startIndices.length &&\n        this.startIndices[featureIndex] <= groupEnd) {\n      const feature = this.startIndicesFeature[featureIndex];\n\n      const featureUid = getUid(feature).toString();\n      if (skippedFeaturesHash[featureUid] !== undefined) {\n        // feature should be skipped\n        if (start !== end) {\n          // draw the features so far\n          this.drawElements(gl, context, start, end);\n        }\n        // continue with the next feature\n        start = (featureIndex === this.startIndices.length - 1) ?\n          groupEnd : this.startIndices[featureIndex + 1];\n        end = start;\n      } else {\n        // the feature is not skipped, augment the end index\n        end = (featureIndex === this.startIndices.length - 1) ?\n          groupEnd : this.startIndices[featureIndex + 1];\n      }\n      featureIndex++;\n    }\n\n    if (start !== end) {\n      // draw the remaining features (in case there was no skipped feature\n      // in this texture group, all features of a group are drawn together)\n      this.drawElements(gl, context, start, end);\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n  featureCallback, opt_hitExtent) {\n  let i, groupStart, start, end, feature, featureUid;\n  let featureIndex = this.startIndices.length - 1;\n  const hitDetectionTextures = this.getHitDetectionTextures();\n  for (i = hitDetectionTextures.length - 1; i >= 0; --i) {\n    gl.bindTexture(TEXTURE_2D, hitDetectionTextures[i]);\n    groupStart = (i > 0) ? this.hitDetectionGroupIndices[i - 1] : 0;\n    end = this.hitDetectionGroupIndices[i];\n\n    // draw all features for this texture group\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || intersects(\n            /** @type {Array<number>} */ (opt_hitExtent),\n            feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        const result = featureCallback(feature);\n        if (result) {\n          return result;\n        }\n      }\n\n      end = start;\n      featureIndex--;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextureReplay.prototype.finish = function(context) {\n  this.anchorX = undefined;\n  this.anchorY = undefined;\n  this.height = undefined;\n  this.imageHeight = undefined;\n  this.imageWidth = undefined;\n  this.indices = null;\n  this.opacity = undefined;\n  this.originX = undefined;\n  this.originY = undefined;\n  this.rotateWithView = undefined;\n  this.rotation = undefined;\n  this.scale = undefined;\n  this.vertices = null;\n  this.width = undefined;\n};\n\n\n/**\n * @abstract\n * @protected\n * @param {boolean=} opt_all Return hit detection textures with regular ones.\n * @returns {Array.<WebGLTexture>} Textures.\n */\nWebGLTextureReplay.prototype.getTextures = function(opt_all) {};\n\n\n/**\n * @abstract\n * @protected\n * @returns {Array.<WebGLTexture>} Textures.\n */\nWebGLTextureReplay.prototype.getHitDetectionTextures = function() {};\nexport default WebGLTextureReplay;\n","/**\n * @module ol/render/webgl/ImageReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport WebGLTextureReplay from '../webgl/TextureReplay.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/webgl/TextureReplay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLImageReplay = function(tolerance, maxExtent) {\n  WebGLTextureReplay.call(this, tolerance, maxExtent);\n\n  /**\n   * @type {Array.<HTMLCanvasElement|HTMLImageElement|HTMLVideoElement>}\n   * @protected\n   */\n  this.images_ = [];\n\n  /**\n   * @type {Array.<HTMLCanvasElement|HTMLImageElement|HTMLVideoElement>}\n   * @protected\n   */\n  this.hitDetectionImages_ = [];\n\n  /**\n   * @type {Array.<WebGLTexture>}\n   * @private\n   */\n  this.textures_ = [];\n\n  /**\n   * @type {Array.<WebGLTexture>}\n   * @private\n   */\n  this.hitDetectionTextures_ = [];\n\n};\n\ninherits(WebGLImageReplay, WebGLTextureReplay);\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.drawMultiPoint = function(multiPointGeometry, feature) {\n  this.startIndices.push(this.indices.length);\n  this.startIndicesFeature.push(feature);\n  const flatCoordinates = multiPointGeometry.getFlatCoordinates();\n  const stride = multiPointGeometry.getStride();\n  this.drawCoordinates(\n    flatCoordinates, 0, flatCoordinates.length, stride);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.drawPoint = function(pointGeometry, feature) {\n  this.startIndices.push(this.indices.length);\n  this.startIndicesFeature.push(feature);\n  const flatCoordinates = pointGeometry.getFlatCoordinates();\n  const stride = pointGeometry.getStride();\n  this.drawCoordinates(\n    flatCoordinates, 0, flatCoordinates.length, stride);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.finish = function(context) {\n  const gl = context.getGL();\n\n  this.groupIndices.push(this.indices.length);\n  this.hitDetectionGroupIndices.push(this.indices.length);\n\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new WebGLBuffer(this.vertices);\n\n  const indices = this.indices;\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new WebGLBuffer(indices);\n\n  // create textures\n  /** @type {Object.<string, WebGLTexture>} */\n  const texturePerImage = {};\n\n  this.createTextures(this.textures_, this.images_, texturePerImage, gl);\n\n  this.createTextures(this.hitDetectionTextures_, this.hitDetectionImages_,\n    texturePerImage, gl);\n\n  this.images_ = null;\n  this.hitDetectionImages_ = null;\n  WebGLTextureReplay.prototype.finish.call(this, context);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.setImageStyle = function(imageStyle) {\n  const anchor = imageStyle.getAnchor();\n  const image = imageStyle.getImage(1);\n  const imageSize = imageStyle.getImageSize();\n  const hitDetectionImage = imageStyle.getHitDetectionImage(1);\n  const opacity = imageStyle.getOpacity();\n  const origin = imageStyle.getOrigin();\n  const rotateWithView = imageStyle.getRotateWithView();\n  const rotation = imageStyle.getRotation();\n  const size = imageStyle.getSize();\n  const scale = imageStyle.getScale();\n\n  let currentImage;\n  if (this.images_.length === 0) {\n    this.images_.push(image);\n  } else {\n    currentImage = this.images_[this.images_.length - 1];\n    if (getUid(currentImage) != getUid(image)) {\n      this.groupIndices.push(this.indices.length);\n      this.images_.push(image);\n    }\n  }\n\n  if (this.hitDetectionImages_.length === 0) {\n    this.hitDetectionImages_.push(hitDetectionImage);\n  } else {\n    currentImage =\n        this.hitDetectionImages_[this.hitDetectionImages_.length - 1];\n    if (getUid(currentImage) != getUid(hitDetectionImage)) {\n      this.hitDetectionGroupIndices.push(this.indices.length);\n      this.hitDetectionImages_.push(hitDetectionImage);\n    }\n  }\n\n  this.anchorX = anchor[0];\n  this.anchorY = anchor[1];\n  this.height = size[1];\n  this.imageHeight = imageSize[1];\n  this.imageWidth = imageSize[0];\n  this.opacity = opacity;\n  this.originX = origin[0];\n  this.originY = origin[1];\n  this.rotation = rotation;\n  this.rotateWithView = rotateWithView;\n  this.scale = scale;\n  this.width = size[0];\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.getTextures = function(opt_all) {\n  return opt_all ? this.textures_.concat(this.hitDetectionTextures_) : this.textures_;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageReplay.prototype.getHitDetectionTextures = function() {\n  return this.hitDetectionTextures_;\n};\nexport default WebGLImageReplay;\n","/**\n * @module ol/geom/flat/topology\n */\nimport {linearRing as linearRingArea} from '../flat/area.js';\n\n/**\n * Check if the linestring is a boundary.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {boolean} The linestring is a boundary.\n */\nexport function lineStringIsClosed(flatCoordinates, offset, end, stride) {\n  const lastCoord = end - stride;\n  if (flatCoordinates[offset] === flatCoordinates[lastCoord] &&\n      flatCoordinates[offset + 1] === flatCoordinates[lastCoord + 1] && (end - offset) / stride > 3) {\n    return !!linearRingArea(flatCoordinates, offset, end, stride);\n  }\n  return false;\n}\n","/**\n * @module ol/render/webgl/linestringreplay/defaultshader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\nimport WebGLFragment from '../../../webgl/Fragment.js';\nimport WebGLVertex from '../../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\nvarying float v_round;\\nvarying vec2 v_roundVertex;\\nvarying float v_halfWidth;\\n\\n\\n\\nuniform float u_opacity;\\nuniform vec4 u_color;\\nuniform vec2 u_size;\\nuniform float u_pixelRatio;\\n\\nvoid main(void) {\\n  if (v_round > 0.0) {\\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\\n      discard;\\n    }\\n  }\\n  gl_FragColor = u_color;\\n  float alpha = u_color.a * u_opacity;\\n  if (alpha == 0.0) {\\n    discard;\\n  }\\n  gl_FragColor.a = alpha;\\n}\\n' :\n  'precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  'varying float v_round;\\nvarying vec2 v_roundVertex;\\nvarying float v_halfWidth;\\n\\n\\nattribute vec2 a_lastPos;\\nattribute vec2 a_position;\\nattribute vec2 a_nextPos;\\nattribute float a_direction;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_lineWidth;\\nuniform float u_miterLimit;\\n\\nbool nearlyEquals(in float value, in float ref) {\\n  float epsilon = 0.000000000001;\\n  return value >= ref - epsilon && value <= ref + epsilon;\\n}\\n\\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\\n  vec2 dirVect = nextP - a_position;\\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\\n  offset = u_lineWidth / 2.0 * normal * direction;\\n}\\n\\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\\n  float halfWidth = u_lineWidth / 2.0;\\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\\n  vec2 normal = vec2(-tangent.y, tangent.x);\\n  vec2 dirVect = a_nextPos - a_position;\\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\\n  offset = normal * direction * miterLength;\\n  round = 0.0;\\n  if (isRound) {\\n    round = 1.0;\\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\\n    offset = halfWidth * tmpNormal * direction;\\n  }\\n}\\n\\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\\n  bool degenerate = false;\\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\\n  vec2 normal = vec2(-tangent.y, tangent.x);\\n  vec2 dirVect = a_lastPos - a_position;\\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\\n  vec2 longOffset, shortOffset, longVertex;\\n  vec4 shortProjVertex;\\n  float halfWidth = u_lineWidth / 2.0;\\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\\n    longOffset = tmpNormal * direction * halfWidth;\\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\\n    longVertex = a_nextPos;\\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\\n  } else {\\n    shortOffset = tmpNormal * direction * halfWidth;\\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\\n    longVertex = a_lastPos;\\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\\n  }\\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\\n  float epsilon = 0.000000000001;\\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\\n    offset = shortProjVertex.xy;\\n    degenerate = true;\\n  } else {\\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\\n    offset = normal * direction * miterLength;\\n  }\\n  return degenerate;\\n}\\n\\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\\n    in float turnDir, in float direction) {\\n  round = 0.0;\\n  vec2 dirVect = a_position - nextP;\\n  vec2 firstNormal = normalize(dirVect);\\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\\n  offset = normal * length;\\n  if (isRound) {\\n    round = 1.0;\\n  }\\n}\\n\\nvoid main(void) {\\n  bool degenerate = false;\\n  float direction = float(sign(a_direction));\\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\\n  vec2 offset;\\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\\n\\n  v_round = 0.0;\\n  v_halfWidth = u_lineWidth / 2.0;\\n  v_roundVertex = projPos.xy;\\n\\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\\n    alongNormal(offset, a_nextPos, 1.0, direction);\\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\\n    alongNormal(offset, a_lastPos, -1.0, direction);\\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\\n    miterUp(offset, v_round, round, direction);\\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\\n  }\\n  if (!degenerate) {\\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\\n    gl_Position = projPos + offsets;\\n  } else {\\n    gl_Position = vec4(offset, 0.0, 1.0);\\n  }\\n}\\n\\n\\n' :\n  'varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}');\n","/**\n * @module ol/render/webgl/linestringreplay/defaultshader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_projectionMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_projectionMatrix' : 'h');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetScaleMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetScaleMatrix' : 'i');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetRotateMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetRotateMatrix' : 'j');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_lineWidth = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_lineWidth' : 'k');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_miterLimit = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_miterLimit' : 'l');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_opacity = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_opacity' : 'm');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_color = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_color' : 'n');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_size = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_size' : 'o');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_pixelRatio = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_pixelRatio' : 'p');\n\n  /**\n   * @type {number}\n   */\n  this.a_lastPos = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_lastPos' : 'd');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'e');\n\n  /**\n   * @type {number}\n   */\n  this.a_nextPos = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_nextPos' : 'f');\n\n  /**\n   * @type {number}\n   */\n  this.a_direction = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_direction' : 'g');\n};\n\nexport default Locations;\n","/**\n * @module ol/render/webgl/LineStringReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {equals} from '../../array.js';\nimport {asArray} from '../../color.js';\nimport {intersects} from '../../extent.js';\nimport {linearRingIsClockwise} from '../../geom/flat/orient.js';\nimport {translate} from '../../geom/flat/transform.js';\nimport {lineStringIsClosed} from '../../geom/flat/topology.js';\nimport {isEmpty} from '../../obj.js';\nimport {DEFAULT_LINECAP, DEFAULT_LINEDASH, DEFAULT_LINEDASHOFFSET,\n  DEFAULT_LINEJOIN, DEFAULT_LINEWIDTH, DEFAULT_MITERLIMIT, DEFAULT_STROKESTYLE,\n  triangleIsCounterClockwise} from '../webgl.js';\nimport WebGLReplay from '../webgl/Replay.js';\nimport {fragment, vertex} from '../webgl/linestringreplay/defaultshader.js';\nimport Locations from '../webgl/linestringreplay/defaultshader/Locations.js';\nimport {FLOAT} from '../../webgl.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n\n/**\n * @enum {number}\n */\nconst Instruction = {\n  ROUND: 2,\n  BEGIN_LINE: 3,\n  END_LINE: 5,\n  BEGIN_LINE_CAP: 7,\n  END_LINE_CAP: 11,\n  BEVEL_FIRST: 13,\n  BEVEL_SECOND: 17,\n  MITER_BOTTOM: 19,\n  MITER_TOP: 23\n};\n\n\n/**\n * @constructor\n * @extends {module:ol/render/webgl/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLLineStringReplay = function(tolerance, maxExtent) {\n  WebGLReplay.call(this, tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {module:ol/render/webgl/linestringreplay/defaultshader/Locations}\n   */\n  this.defaultLocations_ = null;\n\n  /**\n   * @private\n   * @type {Array.<Array.<?>>}\n   */\n  this.styles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.styleIndices_ = [];\n\n  /**\n   * @private\n   * @type {{strokeColor: (Array.<number>|null),\n   *         lineCap: (string|undefined),\n   *         lineDash: Array.<number>,\n   *         lineDashOffset: (number|undefined),\n   *         lineJoin: (string|undefined),\n   *         lineWidth: (number|undefined),\n   *         miterLimit: (number|undefined),\n   *         changed: boolean}|null}\n   */\n  this.state_ = {\n    strokeColor: null,\n    lineCap: undefined,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineJoin: undefined,\n    lineWidth: undefined,\n    miterLimit: undefined,\n    changed: false\n  };\n\n};\n\ninherits(WebGLLineStringReplay, WebGLReplay);\n\n\n/**\n * Draw one segment.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\nWebGLLineStringReplay.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {\n\n  let i, ii;\n  let numVertices = this.vertices.length;\n  let numIndices = this.indices.length;\n  //To save a vertex, the direction of a point is a product of the sign (1 or -1), a prime from\n  //Instruction, and a rounding factor (1 or 2). If the product is even,\n  //we round it. If it is odd, we don't.\n  const lineJoin = this.state_.lineJoin === 'bevel' ? 0 :\n    this.state_.lineJoin === 'miter' ? 1 : 2;\n  const lineCap = this.state_.lineCap === 'butt' ? 0 :\n    this.state_.lineCap === 'square' ? 1 : 2;\n  const closed = lineStringIsClosed(flatCoordinates, offset, end, stride);\n  let startCoords, sign, n;\n  let lastIndex = numIndices;\n  let lastSign = 1;\n  //We need the adjacent vertices to define normals in joins. p0 = last, p1 = current, p2 = next.\n  let p0, p1, p2;\n\n  for (i = offset, ii = end; i < ii; i += stride) {\n\n    n = numVertices / 7;\n\n    p0 = p1;\n    p1 = p2 || [flatCoordinates[i], flatCoordinates[i + 1]];\n    //First vertex.\n    if (i === offset) {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n      if (end - offset === stride * 2 && equals(p1, p2)) {\n        break;\n      }\n      if (closed) {\n        //A closed line! Complete the circle.\n        p0 = [flatCoordinates[end - stride * 2],\n          flatCoordinates[end - stride * 2 + 1]];\n\n        startCoords = p2;\n      } else {\n        //Add the first two/four vertices.\n\n        if (lineCap) {\n          numVertices = this.addVertices_([0, 0], p1, p2,\n            lastSign * Instruction.BEGIN_LINE_CAP * lineCap, numVertices);\n\n          numVertices = this.addVertices_([0, 0], p1, p2,\n            -lastSign * Instruction.BEGIN_LINE_CAP * lineCap, numVertices);\n\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n\n        }\n\n        numVertices = this.addVertices_([0, 0], p1, p2,\n          lastSign * Instruction.BEGIN_LINE * (lineCap || 1), numVertices);\n\n        numVertices = this.addVertices_([0, 0], p1, p2,\n          -lastSign * Instruction.BEGIN_LINE * (lineCap || 1), numVertices);\n\n        lastIndex = numVertices / 7 - 1;\n\n        continue;\n      }\n    } else if (i === end - stride) {\n      //Last vertex.\n      if (closed) {\n        //Same as the first vertex.\n        p2 = startCoords;\n        break;\n      } else {\n        p0 = p0 || [0, 0];\n\n        numVertices = this.addVertices_(p0, p1, [0, 0],\n          lastSign * Instruction.END_LINE * (lineCap || 1), numVertices);\n\n        numVertices = this.addVertices_(p0, p1, [0, 0],\n          -lastSign * Instruction.END_LINE * (lineCap || 1), numVertices);\n\n        this.indices[numIndices++] = n;\n        this.indices[numIndices++] = lastIndex - 1;\n        this.indices[numIndices++] = lastIndex;\n\n        this.indices[numIndices++] = lastIndex;\n        this.indices[numIndices++] = n + 1;\n        this.indices[numIndices++] = n;\n\n        if (lineCap) {\n          numVertices = this.addVertices_(p0, p1, [0, 0],\n            lastSign * Instruction.END_LINE_CAP * lineCap, numVertices);\n\n          numVertices = this.addVertices_(p0, p1, [0, 0],\n            -lastSign * Instruction.END_LINE_CAP * lineCap, numVertices);\n\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n\n        }\n\n        break;\n      }\n    } else {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n    }\n\n    // We group CW and straight lines, thus the not so inituitive CCW checking function.\n    sign = triangleIsCounterClockwise(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1])\n      ? -1 : 1;\n\n    numVertices = this.addVertices_(p0, p1, p2,\n      sign * Instruction.BEVEL_FIRST * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n      sign * Instruction.BEVEL_SECOND * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n      -sign * Instruction.MITER_BOTTOM * (lineJoin || 1), numVertices);\n\n    if (i > offset) {\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastIndex - 1;\n      this.indices[numIndices++] = lastIndex;\n\n      this.indices[numIndices++] = n + 2;\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n    }\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n + 1;\n\n    lastIndex = n + 2;\n    lastSign = sign;\n\n    //Add miter\n    if (lineJoin) {\n      numVertices = this.addVertices_(p0, p1, p2,\n        sign * Instruction.MITER_TOP * lineJoin, numVertices);\n\n      this.indices[numIndices++] = n + 1;\n      this.indices[numIndices++] = n + 3;\n      this.indices[numIndices++] = n;\n    }\n  }\n\n  if (closed) {\n    n = n || numVertices / 7;\n    sign = linearRingIsClockwise([p0[0], p0[1], p1[0], p1[1], p2[0], p2[1]], 0, 6, 2)\n      ? 1 : -1;\n\n    numVertices = this.addVertices_(p0, p1, p2,\n      sign * Instruction.BEVEL_FIRST * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n      -sign * Instruction.MITER_BOTTOM * (lineJoin || 1), numVertices);\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastIndex - 1;\n    this.indices[numIndices++] = lastIndex;\n\n    this.indices[numIndices++] = n + 1;\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n  }\n};\n\n/**\n * @param {Array.<number>} p0 Last coordinates.\n * @param {Array.<number>} p1 Current coordinates.\n * @param {Array.<number>} p2 Next coordinates.\n * @param {number} product Sign, instruction, and rounding product.\n * @param {number} numVertices Vertex counter.\n * @return {number} Vertex counter.\n * @private\n */\nWebGLLineStringReplay.prototype.addVertices_ = function(p0, p1, p2, product, numVertices) {\n  this.vertices[numVertices++] = p0[0];\n  this.vertices[numVertices++] = p0[1];\n  this.vertices[numVertices++] = p1[0];\n  this.vertices[numVertices++] = p1[1];\n  this.vertices[numVertices++] = p2[0];\n  this.vertices[numVertices++] = p2[1];\n  this.vertices[numVertices++] = product;\n\n  return numVertices;\n};\n\n/**\n * Check if the linestring can be drawn (i. e. valid).\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {boolean} The linestring can be drawn.\n * @private\n */\nWebGLLineStringReplay.prototype.isValid_ = function(flatCoordinates, offset, end, stride) {\n  const range = end - offset;\n  if (range < stride * 2) {\n    return false;\n  } else if (range === stride * 2) {\n    const firstP = [flatCoordinates[offset], flatCoordinates[offset + 1]];\n    const lastP = [flatCoordinates[offset + stride], flatCoordinates[offset + stride + 1]];\n    return !equals(firstP, lastP);\n  }\n\n  return true;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.drawLineString = function(lineStringGeometry, feature) {\n  let flatCoordinates = lineStringGeometry.getFlatCoordinates();\n  const stride = lineStringGeometry.getStride();\n  if (this.isValid_(flatCoordinates, 0, flatCoordinates.length, stride)) {\n    flatCoordinates = translate(flatCoordinates, 0, flatCoordinates.length,\n      stride, -this.origin[0], -this.origin[1]);\n    if (this.state_.changed) {\n      this.styleIndices_.push(this.indices.length);\n      this.state_.changed = false;\n    }\n    this.startIndices.push(this.indices.length);\n    this.startIndicesFeature.push(feature);\n    this.drawCoordinates_(\n      flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {\n  const indexCount = this.indices.length;\n  const ends = multiLineStringGeometry.getEnds();\n  ends.unshift(0);\n  const flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\n  const stride = multiLineStringGeometry.getStride();\n  let i, ii;\n  if (ends.length > 1) {\n    for (i = 1, ii = ends.length; i < ii; ++i) {\n      if (this.isValid_(flatCoordinates, ends[i - 1], ends[i], stride)) {\n        const lineString = translate(flatCoordinates, ends[i - 1], ends[i],\n          stride, -this.origin[0], -this.origin[1]);\n        this.drawCoordinates_(\n          lineString, 0, lineString.length, stride);\n      }\n    }\n  }\n  if (this.indices.length > indexCount) {\n    this.startIndices.push(indexCount);\n    this.startIndicesFeature.push(feature);\n    if (this.state_.changed) {\n      this.styleIndices_.push(indexCount);\n      this.state_.changed = false;\n    }\n  }\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n */\nWebGLLineStringReplay.prototype.drawPolygonCoordinates = function(\n  flatCoordinates, holeFlatCoordinates, stride) {\n  if (!lineStringIsClosed(flatCoordinates, 0, flatCoordinates.length, stride)) {\n    flatCoordinates.push(flatCoordinates[0]);\n    flatCoordinates.push(flatCoordinates[1]);\n  }\n  this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n  if (holeFlatCoordinates.length) {\n    let i, ii;\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      if (!lineStringIsClosed(holeFlatCoordinates[i], 0, holeFlatCoordinates[i].length, stride)) {\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][0]);\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][1]);\n      }\n      this.drawCoordinates_(holeFlatCoordinates[i], 0,\n        holeFlatCoordinates[i].length, stride);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n * @param {number=} opt_index Index count.\n */\nWebGLLineStringReplay.prototype.setPolygonStyle = function(feature, opt_index) {\n  const index = opt_index === undefined ? this.indices.length : opt_index;\n  this.startIndices.push(index);\n  this.startIndicesFeature.push(feature);\n  if (this.state_.changed) {\n    this.styleIndices_.push(index);\n    this.state_.changed = false;\n  }\n};\n\n\n/**\n * @return {number} Current index.\n */\nWebGLLineStringReplay.prototype.getCurrentIndex = function() {\n  return this.indices.length;\n};\n\n\n/**\n * @inheritDoc\n **/\nWebGLLineStringReplay.prototype.finish = function(context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new WebGLBuffer(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new WebGLBuffer(this.indices);\n\n  this.startIndices.push(this.indices.length);\n\n  //Clean up, if there is nothing to draw\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.getDeleteResourcesFunction = function(context) {\n  const verticesBuffer = this.verticesBuffer;\n  const indicesBuffer = this.indicesBuffer;\n  return function() {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n  };\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  const program = context.getProgram(fragment, vertex);\n\n  // get the locations\n  let locations;\n  if (!this.defaultLocations_) {\n    locations = new Locations(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_lastPos);\n  gl.vertexAttribPointer(locations.a_lastPos, 2, FLOAT,\n    false, 28, 0);\n\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\n    false, 28, 8);\n\n  gl.enableVertexAttribArray(locations.a_nextPos);\n  gl.vertexAttribPointer(locations.a_nextPos, 2, FLOAT,\n    false, 28, 16);\n\n  gl.enableVertexAttribArray(locations.a_direction);\n  gl.vertexAttribPointer(locations.a_direction, 1, FLOAT,\n    false, 28, 24);\n\n  // Enable renderer specific uniforms.\n  gl.uniform2fv(locations.u_size, size);\n  gl.uniform1f(locations.u_pixelRatio, pixelRatio);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_lastPos);\n  gl.disableVertexAttribArray(locations.a_position);\n  gl.disableVertexAttribArray(locations.a_nextPos);\n  gl.disableVertexAttribArray(locations.a_direction);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  const tmpDepthFunc = /** @type {number} */ (gl.getParameter(gl.DEPTH_FUNC));\n  const tmpDepthMask = /** @type {boolean} */ (gl.getParameter(gl.DEPTH_WRITEMASK));\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    let i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      end = start;\n    }\n  }\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT);\n    //Restore GL parameters.\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\nWebGLLineStringReplay.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        end = featureStart;\n      }\n      featureIndex--;\n      start = featureStart;\n    }\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n    start = end = groupStart;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n  featureCallback, opt_hitExtent) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || intersects(\n            /** @type {Array<number>} */ (opt_hitExtent),\n            feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        const result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n\n      }\n      featureIndex--;\n      end = start;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n * @param {number} lineWidth Line width.\n * @param {number} miterLimit Miter limit.\n */\nWebGLLineStringReplay.prototype.setStrokeStyle_ = function(gl, color, lineWidth, miterLimit) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n  gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);\n  gl.uniform1f(this.defaultLocations_.u_miterLimit, miterLimit);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLLineStringReplay.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  const strokeStyleLineCap = strokeStyle.getLineCap();\n  this.state_.lineCap = strokeStyleLineCap !== undefined ?\n    strokeStyleLineCap : DEFAULT_LINECAP;\n  const strokeStyleLineDash = strokeStyle.getLineDash();\n  this.state_.lineDash = strokeStyleLineDash ?\n    strokeStyleLineDash : DEFAULT_LINEDASH;\n  const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n  this.state_.lineDashOffset = strokeStyleLineDashOffset ?\n    strokeStyleLineDashOffset : DEFAULT_LINEDASHOFFSET;\n  const strokeStyleLineJoin = strokeStyle.getLineJoin();\n  this.state_.lineJoin = strokeStyleLineJoin !== undefined ?\n    strokeStyleLineJoin : DEFAULT_LINEJOIN;\n  let strokeStyleColor = strokeStyle.getColor();\n  if (!(strokeStyleColor instanceof CanvasGradient) &&\n      !(strokeStyleColor instanceof CanvasPattern)) {\n    strokeStyleColor = asArray(strokeStyleColor).map(function(c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || DEFAULT_STROKESTYLE;\n  } else {\n    strokeStyleColor = DEFAULT_STROKESTYLE;\n  }\n  let strokeStyleWidth = strokeStyle.getWidth();\n  strokeStyleWidth = strokeStyleWidth !== undefined ?\n    strokeStyleWidth : DEFAULT_LINEWIDTH;\n  let strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n  strokeStyleMiterLimit = strokeStyleMiterLimit !== undefined ?\n    strokeStyleMiterLimit : DEFAULT_MITERLIMIT;\n  if (!this.state_.strokeColor || !equals(this.state_.strokeColor, strokeStyleColor) ||\n      this.state_.lineWidth !== strokeStyleWidth || this.state_.miterLimit !== strokeStyleMiterLimit) {\n    this.state_.changed = true;\n    this.state_.strokeColor = strokeStyleColor;\n    this.state_.lineWidth = strokeStyleWidth;\n    this.state_.miterLimit = strokeStyleMiterLimit;\n    this.styles_.push([strokeStyleColor, strokeStyleWidth, strokeStyleMiterLimit]);\n  }\n};\n\nexport default WebGLLineStringReplay;\n","/**\n * @module ol/render/webgl/polygonreplay/defaultshader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\nimport WebGLFragment from '../../../webgl/Fragment.js';\nimport WebGLVertex from '../../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\n\\n\\n\\nuniform vec4 u_color;\\nuniform float u_opacity;\\n\\nvoid main(void) {\\n  gl_FragColor = u_color;\\n  float alpha = u_color.a * u_opacity;\\n  if (alpha == 0.0) {\\n    discard;\\n  }\\n  gl_FragColor.a = alpha;\\n}\\n' :\n  'precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  '\\n\\nattribute vec2 a_position;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\n\\nvoid main(void) {\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\\n}\\n\\n\\n' :\n  'attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}');\n","/**\n * @module ol/render/webgl/polygonreplay/defaultshader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_projectionMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_projectionMatrix' : 'b');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetScaleMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetScaleMatrix' : 'c');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_offsetRotateMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_offsetRotateMatrix' : 'd');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_color = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_color' : 'e');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_opacity = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_opacity' : 'f');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'a');\n};\n\nexport default Locations;\n","/**\n * @module ol/structs/LinkedList\n */\n\n\n/**\n * @typedef {Object} Item\n * @property {module:ol/structs/LinkedList~Item} [prev]\n * @property {module:ol/structs/LinkedList~Item} [next]\n * @property {?} data\n */\n\n\n/**\n * Creates an empty linked list structure.\n *\n * @constructor\n * @struct\n * @param {boolean=} opt_circular The last item is connected to the first one,\n * and the first item to the last one. Default is true.\n */\nconst LinkedList = function(opt_circular) {\n\n  /**\n   * @private\n   * @type {module:ol/structs/LinkedList~Item|undefined}\n   */\n  this.first_;\n\n  /**\n   * @private\n   * @type {module:ol/structs/LinkedList~Item|undefined}\n   */\n  this.last_;\n\n  /**\n   * @private\n   * @type {module:ol/structs/LinkedList~Item|undefined}\n   */\n  this.head_;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.circular_ = opt_circular === undefined ? true : opt_circular;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.length_ = 0;\n};\n\n/**\n * Inserts an item into the linked list right after the current one.\n *\n * @param {?} data Item data.\n */\nLinkedList.prototype.insertItem = function(data) {\n\n  /** @type {module:ol/structs/LinkedList~Item} */\n  const item = {\n    prev: undefined,\n    next: undefined,\n    data: data\n  };\n\n  const head = this.head_;\n\n  //Initialize the list.\n  if (!head) {\n    this.first_ = item;\n    this.last_ = item;\n    if (this.circular_) {\n      item.next = item;\n      item.prev = item;\n    }\n  } else {\n    //Link the new item to the adjacent ones.\n    const next = head.next;\n    item.prev = head;\n    item.next = next;\n    head.next = item;\n    if (next) {\n      next.prev = item;\n    }\n\n    if (head === this.last_) {\n      this.last_ = item;\n    }\n  }\n  this.head_ = item;\n  this.length_++;\n};\n\n/**\n * Removes the current item from the list. Sets the cursor to the next item,\n * if possible.\n */\nLinkedList.prototype.removeItem = function() {\n  const head = this.head_;\n  if (head) {\n    const next = head.next;\n    const prev = head.prev;\n    if (next) {\n      next.prev = prev;\n    }\n    if (prev) {\n      prev.next = next;\n    }\n    this.head_ = next || prev;\n\n    if (this.first_ === this.last_) {\n      this.head_ = undefined;\n      this.first_ = undefined;\n      this.last_ = undefined;\n    } else if (this.first_ === head) {\n      this.first_ = this.head_;\n    } else if (this.last_ === head) {\n      this.last_ = prev ? this.head_.prev : this.head_;\n    }\n    this.length_--;\n  }\n};\n\n/**\n * Sets the cursor to the first item, and returns the associated data.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.firstItem = function() {\n  this.head_ = this.first_;\n  if (this.head_) {\n    return this.head_.data;\n  }\n  return undefined;\n};\n\n/**\n* Sets the cursor to the last item, and returns the associated data.\n*\n* @return {?} Item data.\n*/\nLinkedList.prototype.lastItem = function() {\n  this.head_ = this.last_;\n  if (this.head_) {\n    return this.head_.data;\n  }\n  return undefined;\n};\n\n/**\n * Sets the cursor to the next item, and returns the associated data.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.nextItem = function() {\n  if (this.head_ && this.head_.next) {\n    this.head_ = this.head_.next;\n    return this.head_.data;\n  }\n  return undefined;\n};\n\n/**\n * Returns the next item's data without moving the cursor.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.getNextItem = function() {\n  if (this.head_ && this.head_.next) {\n    return this.head_.next.data;\n  }\n  return undefined;\n};\n\n/**\n * Sets the cursor to the previous item, and returns the associated data.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.prevItem = function() {\n  if (this.head_ && this.head_.prev) {\n    this.head_ = this.head_.prev;\n    return this.head_.data;\n  }\n  return undefined;\n};\n\n/**\n * Returns the previous item's data without moving the cursor.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.getPrevItem = function() {\n  if (this.head_ && this.head_.prev) {\n    return this.head_.prev.data;\n  }\n  return undefined;\n};\n\n/**\n * Returns the current item's data.\n *\n * @return {?} Item data.\n */\nLinkedList.prototype.getCurrItem = function() {\n  if (this.head_) {\n    return this.head_.data;\n  }\n  return undefined;\n};\n\n/**\n * Sets the first item of the list. This only works for circular lists, and sets\n * the last item accordingly.\n */\nLinkedList.prototype.setFirstItem = function() {\n  if (this.circular_ && this.head_) {\n    this.first_ = this.head_;\n    this.last_ = this.head_.prev;\n  }\n};\n\n/**\n * Concatenates two lists.\n * @param {module:ol/structs/LinkedList} list List to merge into the current list.\n */\nLinkedList.prototype.concat = function(list) {\n  if (list.head_) {\n    if (this.head_) {\n      const end = this.head_.next;\n      this.head_.next = list.first_;\n      list.first_.prev = this.head_;\n      end.prev = list.last_;\n      list.last_.next = end;\n      this.length_ += list.length_;\n    } else {\n      this.head_ = list.head_;\n      this.first_ = list.first_;\n      this.last_ = list.last_;\n      this.length_ = list.length_;\n    }\n    list.head_ = undefined;\n    list.first_ = undefined;\n    list.last_ = undefined;\n    list.length_ = 0;\n  }\n};\n\n/**\n * Returns the current length of the list.\n *\n * @return {number} Length.\n */\nLinkedList.prototype.getLength = function() {\n  return this.length_;\n};\nexport default LinkedList;\n","/**\n * @module ol/render/webgl/PolygonReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {equals} from '../../array.js';\nimport {asArray} from '../../color.js';\nimport {intersects} from '../../extent.js';\nimport {isEmpty} from '../../obj.js';\nimport {linearRingContainsXY} from '../../geom/flat/contains.js';\nimport {linearRingIsClockwise} from '../../geom/flat/orient.js';\nimport {translate} from '../../geom/flat/transform.js';\nimport {fragment, vertex} from '../webgl/polygonreplay/defaultshader.js';\nimport Locations from '../webgl/polygonreplay/defaultshader/Locations.js';\nimport WebGLLineStringReplay from '../webgl/LineStringReplay.js';\nimport WebGLReplay from '../webgl/Replay.js';\nimport {triangleIsCounterClockwise, EPSILON, DEFAULT_FILLSTYLE} from '../webgl.js';\nimport Stroke from '../../style/Stroke.js';\nimport LinkedList from '../../structs/LinkedList.js';\nimport RBush from '../../structs/RBush.js';\nimport {FLOAT} from '../../webgl.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n\n/**\n * @typedef {Object} PolygonVertex\n * @property {number} x\n * @property {number} y\n * @property {number} i\n * @property {boolean} [reflex]\n */\n\n/**\n * @typedef {Object} PolygonSegment\n * @property {module:ol/render/webgl/PolygonReplay~PolygonVertex} p0\n * @property {module:ol/render/webgl/PolygonReplay~PolygonVertex} p1\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/render/webgl/Replay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLPolygonReplay = function(tolerance, maxExtent) {\n  WebGLReplay.call(this, tolerance, maxExtent);\n\n  this.lineStringReplay = new WebGLLineStringReplay(\n    tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {module:ol/render/webgl/polygonreplay/defaultshader/Locations}\n   */\n  this.defaultLocations_ = null;\n\n  /**\n   * @private\n   * @type {Array.<Array.<number>>}\n   */\n  this.styles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.styleIndices_ = [];\n\n  /**\n   * @private\n   * @type {{fillColor: (Array.<number>|null),\n   *         changed: boolean}|null}\n   */\n  this.state_ = {\n    fillColor: null,\n    changed: false\n  };\n\n};\n\ninherits(WebGLPolygonReplay, WebGLReplay);\n\n\n/**\n * Draw one polygon.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n * @private\n */\nWebGLPolygonReplay.prototype.drawCoordinates_ = function(\n  flatCoordinates, holeFlatCoordinates, stride) {\n  // Triangulate the polygon\n  const outerRing = new LinkedList();\n  const rtree = new RBush();\n  // Initialize the outer ring\n  this.processFlatCoordinates_(flatCoordinates, stride, outerRing, rtree, true);\n  const maxCoords = this.getMaxCoords_(outerRing);\n\n  // Eliminate holes, if there are any\n  if (holeFlatCoordinates.length) {\n    let i, ii;\n    const holeLists = [];\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      const holeList = {\n        list: new LinkedList(),\n        maxCoords: undefined,\n        rtree: new RBush()\n      };\n      holeLists.push(holeList);\n      this.processFlatCoordinates_(holeFlatCoordinates[i],\n        stride, holeList.list, holeList.rtree, false);\n      this.classifyPoints_(holeList.list, holeList.rtree, true);\n      holeList.maxCoords = this.getMaxCoords_(holeList.list);\n    }\n    holeLists.sort(function(a, b) {\n      return b.maxCoords[0] === a.maxCoords[0] ?\n        a.maxCoords[1] - b.maxCoords[1] : b.maxCoords[0] - a.maxCoords[0];\n    });\n    for (i = 0; i < holeLists.length; ++i) {\n      const currList = holeLists[i].list;\n      const start = currList.firstItem();\n      let currItem = start;\n      let intersection;\n      do {\n        //TODO: Triangulate holes when they intersect the outer ring.\n        if (this.getIntersections_(currItem, rtree).length) {\n          intersection = true;\n          break;\n        }\n        currItem = currList.nextItem();\n      } while (start !== currItem);\n      if (!intersection) {\n        if (this.bridgeHole_(currList, holeLists[i].maxCoords[0], outerRing, maxCoords[0], rtree)) {\n          rtree.concat(holeLists[i].rtree);\n          this.classifyPoints_(outerRing, rtree, false);\n        }\n      }\n    }\n  } else {\n    this.classifyPoints_(outerRing, rtree, false);\n  }\n  this.triangulate_(outerRing, rtree);\n};\n\n\n/**\n * Inserts flat coordinates in a linked list and adds them to the vertex buffer.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {module:ol/structs/LinkedList} list Linked list.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean} clockwise Coordinate order should be clockwise.\n */\nWebGLPolygonReplay.prototype.processFlatCoordinates_ = function(\n  flatCoordinates, stride, list, rtree, clockwise) {\n  const isClockwise = linearRingIsClockwise(flatCoordinates,\n    0, flatCoordinates.length, stride);\n  let i, ii;\n  let n = this.vertices.length / 2;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  let start;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  let p0;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  let p1;\n  const extents = [];\n  const segments = [];\n  if (clockwise === isClockwise) {\n    start = this.createPoint_(flatCoordinates[0], flatCoordinates[1], n++);\n    p0 = start;\n    for (i = stride, ii = flatCoordinates.length; i < ii; i += stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n        Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n      Math.max(p0.y, p1.y)]);\n  } else {\n    const end = flatCoordinates.length - stride;\n    start = this.createPoint_(flatCoordinates[end], flatCoordinates[end + 1], n++);\n    p0 = start;\n    for (i = end - stride, ii = 0; i >= ii; i -= stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n        Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n      Math.max(p0.y, p1.y)]);\n  }\n  rtree.load(extents, segments);\n};\n\n\n/**\n * Returns the rightmost coordinates of a polygon on the X axis.\n * @private\n * @param {module:ol/structs/LinkedList} list Polygons ring.\n * @return {Array.<number>} Max X coordinates.\n */\nWebGLPolygonReplay.prototype.getMaxCoords_ = function(list) {\n  const start = list.firstItem();\n  let seg = start;\n  let maxCoords = [seg.p0.x, seg.p0.y];\n\n  do {\n    seg = list.nextItem();\n    if (seg.p0.x > maxCoords[0]) {\n      maxCoords = [seg.p0.x, seg.p0.y];\n    }\n  } while (seg !== start);\n\n  return maxCoords;\n};\n\n\n/**\n * Classifies the points of a polygon list as convex, reflex. Removes collinear vertices.\n * @private\n * @param {module:ol/structs/LinkedList} list Polygon ring.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean} ccw The orientation of the polygon is counter-clockwise.\n * @return {boolean} There were reclassified points.\n */\nWebGLPolygonReplay.prototype.classifyPoints_ = function(list, rtree, ccw) {\n  let start = list.firstItem();\n  let s0 = start;\n  let s1 = list.nextItem();\n  let pointsReclassified = false;\n  do {\n    const reflex = ccw ? triangleIsCounterClockwise(s1.p1.x,\n      s1.p1.y, s0.p1.x, s0.p1.y, s0.p0.x, s0.p0.y) :\n      triangleIsCounterClockwise(s0.p0.x, s0.p0.y, s0.p1.x,\n        s0.p1.y, s1.p1.x, s1.p1.y);\n    if (reflex === undefined) {\n      this.removeItem_(s0, s1, list, rtree);\n      pointsReclassified = true;\n      if (s1 === start) {\n        start = list.getNextItem();\n      }\n      s1 = s0;\n      list.prevItem();\n    } else if (s0.p1.reflex !== reflex) {\n      s0.p1.reflex = reflex;\n      pointsReclassified = true;\n    }\n    s0 = s1;\n    s1 = list.nextItem();\n  } while (s0 !== start);\n  return pointsReclassified;\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} hole Linked list of the hole.\n * @param {number} holeMaxX Maximum X value of the hole.\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {number} listMaxX Maximum X value of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @return {boolean} Bridging was successful.\n */\nWebGLPolygonReplay.prototype.bridgeHole_ = function(hole, holeMaxX,\n  list, listMaxX, rtree) {\n  let seg = hole.firstItem();\n  while (seg.p1.x !== holeMaxX) {\n    seg = hole.nextItem();\n  }\n\n  const p1 = seg.p1;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  const p2 = {x: listMaxX, y: p1.y, i: -1};\n  let minDist = Infinity;\n  let i, ii, bestPoint;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  let p5;\n\n  const intersectingSegments = this.getIntersections_({p0: p1, p1: p2}, rtree, true);\n  for (i = 0, ii = intersectingSegments.length; i < ii; ++i) {\n    const currSeg = intersectingSegments[i];\n    const intersection = this.calculateIntersection_(p1, p2, currSeg.p0,\n      currSeg.p1, true);\n    const dist = Math.abs(p1.x - intersection[0]);\n    if (dist < minDist && triangleIsCounterClockwise(p1.x, p1.y,\n      currSeg.p0.x, currSeg.p0.y, currSeg.p1.x, currSeg.p1.y) !== undefined) {\n      minDist = dist;\n      p5 = {x: intersection[0], y: intersection[1], i: -1};\n      seg = currSeg;\n    }\n  }\n  if (minDist === Infinity) {\n    return false;\n  }\n  bestPoint = seg.p1;\n\n  if (minDist > 0) {\n    const pointsInTriangle = this.getPointsInTriangle_(p1, p5, seg.p1, rtree);\n    if (pointsInTriangle.length) {\n      let theta = Infinity;\n      for (i = 0, ii = pointsInTriangle.length; i < ii; ++i) {\n        const currPoint = pointsInTriangle[i];\n        const currTheta = Math.atan2(p1.y - currPoint.y, p2.x - currPoint.x);\n        if (currTheta < theta || (currTheta === theta && currPoint.x < bestPoint.x)) {\n          theta = currTheta;\n          bestPoint = currPoint;\n        }\n      }\n    }\n  }\n\n  seg = list.firstItem();\n  while (seg.p1.x !== bestPoint.x || seg.p1.y !== bestPoint.y) {\n    seg = list.nextItem();\n  }\n\n  //We clone the bridge points as they can have different convexity.\n  const p0Bridge = {x: p1.x, y: p1.y, i: p1.i, reflex: undefined};\n  const p1Bridge = {x: seg.p1.x, y: seg.p1.y, i: seg.p1.i, reflex: undefined};\n\n  hole.getNextItem().p0 = p0Bridge;\n  this.insertItem_(p1, seg.p1, hole, rtree);\n  this.insertItem_(p1Bridge, p0Bridge, hole, rtree);\n  seg.p1 = p1Bridge;\n  hole.setFirstItem();\n  list.concat(hole);\n\n  return true;\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n */\nWebGLPolygonReplay.prototype.triangulate_ = function(list, rtree) {\n  let ccw = false;\n  let simple = this.isSimple_(list, rtree);\n\n  // Start clipping ears\n  while (list.getLength() > 3) {\n    if (simple) {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // Due to the behavior of OL's PIP algorithm, the ear clipping cannot\n          // introduce touching segments. However, the original data may have some.\n          if (!this.resolveSelfIntersections_(list, rtree, true)) {\n            break;\n          }\n        }\n      }\n    } else {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        // We ran out of ears, try to reclassify.\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // We have a bad polygon, try to resolve local self-intersections.\n          if (!this.resolveSelfIntersections_(list, rtree)) {\n            simple = this.isSimple_(list, rtree);\n            if (!simple) {\n              // We have a really bad polygon, try more time consuming methods.\n              this.splitPolygon_(list, rtree);\n              break;\n            } else {\n              ccw = !this.isClockwise_(list);\n              this.classifyPoints_(list, rtree, ccw);\n            }\n          }\n        }\n      }\n    }\n  }\n  if (list.getLength() === 3) {\n    let numIndices = this.indices.length;\n    this.indices[numIndices++] = list.getPrevItem().p0.i;\n    this.indices[numIndices++] = list.getCurrItem().p0.i;\n    this.indices[numIndices++] = list.getNextItem().p0.i;\n  }\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean} simple The polygon is simple.\n * @param {boolean} ccw Orientation of the polygon is counter-clockwise.\n * @return {boolean} There were processed ears.\n */\nWebGLPolygonReplay.prototype.clipEars_ = function(list, rtree, simple, ccw) {\n  let numIndices = this.indices.length;\n  let start = list.firstItem();\n  let s0 = list.getPrevItem();\n  let s1 = start;\n  let s2 = list.nextItem();\n  let s3 = list.getNextItem();\n  let p0, p1, p2;\n  let processedEars = false;\n  do {\n    p0 = s1.p0;\n    p1 = s1.p1;\n    p2 = s2.p1;\n    if (p1.reflex === false) {\n      // We might have a valid ear\n      let variableCriterion;\n      if (simple) {\n        variableCriterion = this.getPointsInTriangle_(p0, p1, p2, rtree, true).length === 0;\n      } else {\n        variableCriterion = ccw ? this.diagonalIsInside_(s3.p1, p2, p1, p0,\n          s0.p0) : this.diagonalIsInside_(s0.p0, p0, p1, p2, s3.p1);\n      }\n      if ((simple || this.getIntersections_({p0: p0, p1: p2}, rtree).length === 0) &&\n          variableCriterion) {\n        //The diagonal is completely inside the polygon\n        if (simple || p0.reflex === false || p2.reflex === false ||\n            linearRingIsClockwise([s0.p0.x, s0.p0.y, p0.x,\n              p0.y, p1.x, p1.y, p2.x, p2.y, s3.p1.x, s3.p1.y], 0, 10, 2) === !ccw) {\n          //The diagonal is persumably valid, we have an ear\n          this.indices[numIndices++] = p0.i;\n          this.indices[numIndices++] = p1.i;\n          this.indices[numIndices++] = p2.i;\n          this.removeItem_(s1, s2, list, rtree);\n          if (s2 === start) {\n            start = s3;\n          }\n          processedEars = true;\n        }\n      }\n    }\n    // Else we have a reflex point.\n    s0 = list.getPrevItem();\n    s1 = list.getCurrItem();\n    s2 = list.nextItem();\n    s3 = list.getNextItem();\n  } while (s1 !== start && list.getLength() > 3);\n\n  return processedEars;\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Resolve touching segments.\n * @return {boolean} There were resolved intersections.\n*/\nWebGLPolygonReplay.prototype.resolveSelfIntersections_ = function(\n  list, rtree, opt_touch) {\n  const start = list.firstItem();\n  list.nextItem();\n  let s0 = start;\n  let s1 = list.nextItem();\n  let resolvedIntersections = false;\n\n  do {\n    const intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1,\n      opt_touch);\n    if (intersection) {\n      let breakCond = false;\n      const numVertices = this.vertices.length;\n      let numIndices = this.indices.length;\n      const n = numVertices / 2;\n      const seg = list.prevItem();\n      list.removeItem();\n      rtree.remove(seg);\n      breakCond = (seg === start);\n      let p;\n      if (opt_touch) {\n        if (intersection[0] === s0.p0.x && intersection[1] === s0.p0.y) {\n          list.prevItem();\n          p = s0.p0;\n          s1.p0 = p;\n          rtree.remove(s0);\n          breakCond = breakCond || (s0 === start);\n        } else {\n          p = s1.p1;\n          s0.p1 = p;\n          rtree.remove(s1);\n          breakCond = breakCond || (s1 === start);\n        }\n        list.removeItem();\n      } else {\n        p = this.createPoint_(intersection[0], intersection[1], n);\n        s0.p1 = p;\n        s1.p0 = p;\n        rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y),\n          Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n        rtree.update([Math.min(s1.p0.x, s1.p1.x), Math.min(s1.p0.y, s1.p1.y),\n          Math.max(s1.p0.x, s1.p1.x), Math.max(s1.p0.y, s1.p1.y)], s1);\n      }\n\n      this.indices[numIndices++] = seg.p0.i;\n      this.indices[numIndices++] = seg.p1.i;\n      this.indices[numIndices++] = p.i;\n\n      resolvedIntersections = true;\n      if (breakCond) {\n        break;\n      }\n    }\n\n    s0 = list.getPrevItem();\n    s1 = list.nextItem();\n  } while (s0 !== start);\n  return resolvedIntersections;\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @return {boolean} The polygon is simple.\n */\nWebGLPolygonReplay.prototype.isSimple_ = function(list, rtree) {\n  const start = list.firstItem();\n  let seg = start;\n  do {\n    if (this.getIntersections_(seg, rtree).length) {\n      return false;\n    }\n    seg = list.nextItem();\n  } while (seg !== start);\n  return true;\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @return {boolean} Orientation is clockwise.\n */\nWebGLPolygonReplay.prototype.isClockwise_ = function(list) {\n  const length = list.getLength() * 2;\n  const flatCoordinates = new Array(length);\n  const start = list.firstItem();\n  let seg = start;\n  let i = 0;\n  do {\n    flatCoordinates[i++] = seg.p0.x;\n    flatCoordinates[i++] = seg.p0.y;\n    seg = list.nextItem();\n  } while (seg !== start);\n  return linearRingIsClockwise(flatCoordinates, 0, length, 2);\n};\n\n\n/**\n * @private\n * @param {module:ol/structs/LinkedList} list Linked list of the polygon.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n */\nWebGLPolygonReplay.prototype.splitPolygon_ = function(list, rtree) {\n  const start = list.firstItem();\n  let s0 = start;\n  do {\n    const intersections = this.getIntersections_(s0, rtree);\n    if (intersections.length) {\n      const s1 = intersections[0];\n      const n = this.vertices.length / 2;\n      const intersection = this.calculateIntersection_(s0.p0,\n        s0.p1, s1.p0, s1.p1);\n      const p = this.createPoint_(intersection[0], intersection[1], n);\n      const newPolygon = new LinkedList();\n      const newRtree = new RBush();\n      this.insertItem_(p, s0.p1, newPolygon, newRtree);\n      s0.p1 = p;\n      rtree.update([Math.min(s0.p0.x, p.x), Math.min(s0.p0.y, p.y),\n        Math.max(s0.p0.x, p.x), Math.max(s0.p0.y, p.y)], s0);\n      let currItem = list.nextItem();\n      while (currItem !== s1) {\n        this.insertItem_(currItem.p0, currItem.p1, newPolygon, newRtree);\n        rtree.remove(currItem);\n        list.removeItem();\n        currItem = list.getCurrItem();\n      }\n      this.insertItem_(s1.p0, p, newPolygon, newRtree);\n      s1.p0 = p;\n      rtree.update([Math.min(s1.p1.x, p.x), Math.min(s1.p1.y, p.y),\n        Math.max(s1.p1.x, p.x), Math.max(s1.p1.y, p.y)], s1);\n      this.classifyPoints_(list, rtree, false);\n      this.triangulate_(list, rtree);\n      this.classifyPoints_(newPolygon, newRtree, false);\n      this.triangulate_(newPolygon, newRtree);\n      break;\n    }\n    s0 = list.nextItem();\n  } while (s0 !== start);\n};\n\n\n/**\n * @private\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n * @param {number} i Index.\n * @return {module:ol/render/webgl/PolygonReplay~PolygonVertex} List item.\n */\nWebGLPolygonReplay.prototype.createPoint_ = function(x, y, i) {\n  let numVertices = this.vertices.length;\n  this.vertices[numVertices++] = x;\n  this.vertices[numVertices++] = y;\n  /** @type {module:ol/render/webgl/PolygonReplay~PolygonVertex} */\n  const p = {\n    x: x,\n    y: y,\n    i: i,\n    reflex: undefined\n  };\n  return p;\n};\n\n\n/**\n * @private\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p0 First point of segment.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p1 Second point of segment.\n * @param {module:ol/structs/LinkedList} list Polygon ring.\n * @param {module:ol/structs/RBush=} opt_rtree Insert the segment into the R-Tree.\n * @return {module:ol/render/webgl/PolygonReplay~PolygonSegment} segment.\n */\nWebGLPolygonReplay.prototype.insertItem_ = function(p0, p1, list, opt_rtree) {\n  const seg = {\n    p0: p0,\n    p1: p1\n  };\n  list.insertItem(seg);\n  if (opt_rtree) {\n    opt_rtree.insert([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y),\n      Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)], seg);\n  }\n  return seg;\n};\n\n\n/**\n  * @private\n  * @param {module:ol/render/webgl/PolygonReplay~PolygonSegment} s0 Segment before the remove candidate.\n  * @param {module:ol/render/webgl/PolygonReplay~PolygonSegment} s1 Remove candidate segment.\n  * @param {module:ol/structs/LinkedList} list Polygon ring.\n  * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n  */\nWebGLPolygonReplay.prototype.removeItem_ = function(s0, s1, list, rtree) {\n  if (list.getCurrItem() === s1) {\n    list.removeItem();\n    s0.p1 = s1.p1;\n    rtree.remove(s1);\n    rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y),\n      Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n  }\n};\n\n\n/**\n * @private\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p0 First point.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p1 Second point.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p2 Third point.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_reflex Only include reflex points.\n * @return {Array.<module:ol/render/webgl/PolygonReplay~PolygonVertex>} Points in the triangle.\n */\nWebGLPolygonReplay.prototype.getPointsInTriangle_ = function(p0, p1, p2, rtree, opt_reflex) {\n  const result = [];\n  const segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x, p2.x),\n    Math.min(p0.y, p1.y, p2.y), Math.max(p0.x, p1.x, p2.x), Math.max(p0.y,\n      p1.y, p2.y)]);\n  for (let i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    for (const j in segmentsInExtent[i]) {\n      const p = segmentsInExtent[i][j];\n      if (typeof p === 'object' && (!opt_reflex || p.reflex)) {\n        if ((p.x !== p0.x || p.y !== p0.y) && (p.x !== p1.x || p.y !== p1.y) &&\n            (p.x !== p2.x || p.y !== p2.y) && result.indexOf(p) === -1 &&\n            linearRingContainsXY([p0.x, p0.y, p1.x, p1.y, p2.x, p2.y], 0, 6, 2, p.x, p.y)) {\n          result.push(p);\n        }\n      }\n    }\n  }\n  return result;\n};\n\n\n/**\n * @private\n * @param {module:ol/render/webgl/PolygonReplay~PolygonSegment} segment Segment.\n * @param {module:ol/structs/RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<module:ol/render/webgl/PolygonReplay~PolygonSegment>} Intersecting segments.\n */\nWebGLPolygonReplay.prototype.getIntersections_ = function(segment, rtree, opt_touch) {\n  const p0 = segment.p0;\n  const p1 = segment.p1;\n  const segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x),\n    Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n  const result = [];\n  for (let i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    const currSeg = segmentsInExtent[i];\n    if (segment !== currSeg && (opt_touch || currSeg.p0 !== p1 || currSeg.p1 !== p0) &&\n        this.calculateIntersection_(p0, p1, currSeg.p0, currSeg.p1, opt_touch)) {\n      result.push(currSeg);\n    }\n  }\n  return result;\n};\n\n\n/**\n * Line intersection algorithm by Paul Bourke.\n * @see http://paulbourke.net/geometry/pointlineplane/\n *\n * @private\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p0 First point.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p1 Second point.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p2 Third point.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p3 Fourth point.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<number>|undefined} Intersection coordinates.\n */\nWebGLPolygonReplay.prototype.calculateIntersection_ = function(p0, p1, p2, p3, opt_touch) {\n  const denom = (p3.y - p2.y) * (p1.x - p0.x) - (p3.x - p2.x) * (p1.y - p0.y);\n  if (denom !== 0) {\n    const ua = ((p3.x - p2.x) * (p0.y - p2.y) - (p3.y - p2.y) * (p0.x - p2.x)) / denom;\n    const ub = ((p1.x - p0.x) * (p0.y - p2.y) - (p1.y - p0.y) * (p0.x - p2.x)) / denom;\n    if ((!opt_touch && ua > EPSILON && ua < 1 - EPSILON &&\n        ub > EPSILON && ub < 1 - EPSILON) || (opt_touch &&\n        ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1)) {\n      return [p0.x + ua * (p1.x - p0.x), p0.y + ua * (p1.y - p0.y)];\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p0 Point before the start of the diagonal.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p1 Start point of the diagonal.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p2 Ear candidate.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p3 End point of the diagonal.\n * @param {module:ol/render/webgl/PolygonReplay~PolygonVertex} p4 Point after the end of the diagonal.\n * @return {boolean} Diagonal is inside the polygon.\n */\nWebGLPolygonReplay.prototype.diagonalIsInside_ = function(p0, p1, p2, p3, p4) {\n  if (p1.reflex === undefined || p3.reflex === undefined) {\n    return false;\n  }\n  const p1IsLeftOf = (p2.x - p3.x) * (p1.y - p3.y) > (p2.y - p3.y) * (p1.x - p3.x);\n  const p1IsRightOf = (p4.x - p3.x) * (p1.y - p3.y) < (p4.y - p3.y) * (p1.x - p3.x);\n  const p3IsLeftOf = (p0.x - p1.x) * (p3.y - p1.y) > (p0.y - p1.y) * (p3.x - p1.x);\n  const p3IsRightOf = (p2.x - p1.x) * (p3.y - p1.y) < (p2.y - p1.y) * (p3.x - p1.x);\n  const p1InCone = p3.reflex ? p1IsRightOf || p1IsLeftOf : p1IsRightOf && p1IsLeftOf;\n  const p3InCone = p1.reflex ? p3IsRightOf || p3IsLeftOf : p3IsRightOf && p3IsLeftOf;\n  return p1InCone && p3InCone;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {\n  const endss = multiPolygonGeometry.getEndss();\n  const stride = multiPolygonGeometry.getStride();\n  const currIndex = this.indices.length;\n  const currLineIndex = this.lineStringReplay.getCurrentIndex();\n  const flatCoordinates = multiPolygonGeometry.getFlatCoordinates();\n  let i, ii, j, jj;\n  let start = 0;\n  for (i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    if (ends.length > 0) {\n      const outerRing = translate(flatCoordinates, start, ends[0],\n        stride, -this.origin[0], -this.origin[1]);\n      if (outerRing.length) {\n        const holes = [];\n        let holeFlatCoords;\n        for (j = 1, jj = ends.length; j < jj; ++j) {\n          if (ends[j] !== ends[j - 1]) {\n            holeFlatCoords = translate(flatCoordinates, ends[j - 1],\n              ends[j], stride, -this.origin[0], -this.origin[1]);\n            holes.push(holeFlatCoords);\n          }\n        }\n        this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n        this.drawCoordinates_(outerRing, holes, stride);\n      }\n    }\n    start = ends[ends.length - 1];\n  }\n  if (this.indices.length > currIndex) {\n    this.startIndices.push(currIndex);\n    this.startIndicesFeature.push(feature);\n    if (this.state_.changed) {\n      this.styleIndices_.push(currIndex);\n      this.state_.changed = false;\n    }\n  }\n  if (this.lineStringReplay.getCurrentIndex() > currLineIndex) {\n    this.lineStringReplay.setPolygonStyle(feature, currLineIndex);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.drawPolygon = function(polygonGeometry, feature) {\n  const ends = polygonGeometry.getEnds();\n  const stride = polygonGeometry.getStride();\n  if (ends.length > 0) {\n    const flatCoordinates = polygonGeometry.getFlatCoordinates().map(Number);\n    const outerRing = translate(flatCoordinates, 0, ends[0],\n      stride, -this.origin[0], -this.origin[1]);\n    if (outerRing.length) {\n      const holes = [];\n      let i, ii, holeFlatCoords;\n      for (i = 1, ii = ends.length; i < ii; ++i) {\n        if (ends[i] !== ends[i - 1]) {\n          holeFlatCoords = translate(flatCoordinates, ends[i - 1],\n            ends[i], stride, -this.origin[0], -this.origin[1]);\n          holes.push(holeFlatCoords);\n        }\n      }\n\n      this.startIndices.push(this.indices.length);\n      this.startIndicesFeature.push(feature);\n      if (this.state_.changed) {\n        this.styleIndices_.push(this.indices.length);\n        this.state_.changed = false;\n      }\n      this.lineStringReplay.setPolygonStyle(feature);\n\n      this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n      this.drawCoordinates_(outerRing, holes, stride);\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n **/\nWebGLPolygonReplay.prototype.finish = function(context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new WebGLBuffer(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new WebGLBuffer(this.indices);\n\n  this.startIndices.push(this.indices.length);\n\n  this.lineStringReplay.finish(context);\n\n  //Clean up, if there is nothing to draw\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.getDeleteResourcesFunction = function(context) {\n  const verticesBuffer = this.verticesBuffer;\n  const indicesBuffer = this.indicesBuffer;\n  const lineDeleter = this.lineStringReplay.getDeleteResourcesFunction(context);\n  return function() {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n    lineDeleter();\n  };\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  const program = context.getProgram(fragment, vertex);\n\n  // get the locations\n  let locations;\n  if (!this.defaultLocations_) {\n    locations = new Locations(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\n    false, 8, 0);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_position);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  const tmpDepthFunc = /** @type {number} */ (gl.getParameter(gl.DEPTH_FUNC));\n  const tmpDepthMask = /** @type {boolean} */ (gl.getParameter(gl.DEPTH_WRITEMASK));\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    let i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setFillStyle_(gl, nextStyle);\n      this.drawElements(gl, context, start, end);\n      end = start;\n    }\n  }\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT);\n    //Restore GL parameters.\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n  featureCallback, opt_hitExtent) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || intersects(\n            /** @type {Array<number>} */ (opt_hitExtent),\n            feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        const result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n\n      }\n      featureIndex--;\n      end = start;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {module:ol/webgl/Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\nWebGLPolygonReplay.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {\n  let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        end = featureStart;\n      }\n      featureIndex--;\n      start = featureStart;\n    }\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n    start = end = groupStart;\n  }\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n */\nWebGLPolygonReplay.prototype.setFillStyle_ = function(gl, color) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLPolygonReplay.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  let fillStyleColor = fillStyle ? fillStyle.getColor() : [0, 0, 0, 0];\n  if (!(fillStyleColor instanceof CanvasGradient) &&\n      !(fillStyleColor instanceof CanvasPattern)) {\n    fillStyleColor = asArray(fillStyleColor).map(function(c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || DEFAULT_FILLSTYLE;\n  } else {\n    fillStyleColor = DEFAULT_FILLSTYLE;\n  }\n  if (!this.state_.fillColor || !equals(fillStyleColor, this.state_.fillColor)) {\n    this.state_.fillColor = fillStyleColor;\n    this.state_.changed = true;\n    this.styles_.push(fillStyleColor);\n  }\n  //Provide a null stroke style, if no strokeStyle is provided. Required for the draw interaction to work.\n  if (strokeStyle) {\n    this.lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n  } else {\n    const nullStrokeStyle = new Stroke({\n      color: [0, 0, 0, 0],\n      lineWidth: 0\n    });\n    this.lineStringReplay.setFillStrokeStyle(null, nullStrokeStyle);\n  }\n};\nexport default WebGLPolygonReplay;\n","/**\n * @module ol/style/Atlas\n */\nimport {createCanvasContext2D} from '../dom.js';\n\n\n/**\n * @typedef {Object} AtlasBlock\n * @property {number} x\n * @property {number} y\n * @property {number} width\n * @property {number} height\n */\n\n/**\n * Provides information for an image inside an atlas.\n * `offsetX` and `offsetY` are the position of the image inside the atlas image `image`.\n * @typedef {Object} AtlasInfo\n * @property {number} offsetX\n * @property {number} offsetY\n * @property {HTMLCanvasElement} image\n */\n\n/**\n * This class facilitates the creation of image atlases.\n *\n * Images added to an atlas will be rendered onto a single\n * atlas canvas. The distribution of images on the canvas is\n * managed with the bin packing algorithm described in:\n * http://www.blackpawn.com/texts/lightmaps/\n *\n * @constructor\n * @struct\n * @param {number} size The size in pixels of the sprite image.\n * @param {number} space The space in pixels between images.\n *    Because texture coordinates are float values, the edges of\n *    images might not be completely correct (in a way that the\n *    edges overlap when being rendered). To avoid this we add a\n *    padding around each image.\n */\nconst Atlas = function(size, space) {\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.space_ = space;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/style/Atlas~AtlasBlock>}\n   */\n  this.emptyBlocks_ = [{x: 0, y: 0, width: size, height: size}];\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/style/Atlas~AtlasInfo>}\n   */\n  this.entries_ = {};\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context_ = createCanvasContext2D(size, size);\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = this.context_.canvas;\n};\n\n\n/**\n * @param {string} id The identifier of the entry to check.\n * @return {?module:ol/style/Atlas~AtlasInfo} The atlas info.\n */\nAtlas.prototype.get = function(id) {\n  return this.entries_[id] || null;\n};\n\n\n/**\n * @param {string} id The identifier of the entry to add.\n * @param {number} width The width.\n * @param {number} height The height.\n * @param {function(CanvasRenderingContext2D, number, number)} renderCallback\n *    Called to render the new image onto an atlas image.\n * @param {Object=} opt_this Value to use as `this` when executing\n *    `renderCallback`.\n * @return {?module:ol/style/Atlas~AtlasInfo} The position and atlas image for the entry.\n */\nAtlas.prototype.add = function(id, width, height, renderCallback, opt_this) {\n  for (let i = 0, ii = this.emptyBlocks_.length; i < ii; ++i) {\n    const block = this.emptyBlocks_[i];\n    if (block.width >= width + this.space_ &&\n        block.height >= height + this.space_) {\n      // we found a block that is big enough for our entry\n      const entry = {\n        offsetX: block.x + this.space_,\n        offsetY: block.y + this.space_,\n        image: this.canvas_\n      };\n      this.entries_[id] = entry;\n\n      // render the image on the atlas image\n      renderCallback.call(opt_this, this.context_,\n        block.x + this.space_, block.y + this.space_);\n\n      // split the block after the insertion, either horizontally or vertically\n      this.split_(i, block, width + this.space_, height + this.space_);\n\n      return entry;\n    }\n  }\n\n  // there is no space for the new entry in this atlas\n  return null;\n};\n\n\n/**\n * @private\n * @param {number} index The index of the block.\n * @param {module:ol/style/Atlas~AtlasBlock} block The block to split.\n * @param {number} width The width of the entry to insert.\n * @param {number} height The height of the entry to insert.\n */\nAtlas.prototype.split_ = function(index, block, width, height) {\n  const deltaWidth = block.width - width;\n  const deltaHeight = block.height - height;\n\n  /** @type {module:ol/style/Atlas~AtlasBlock} */\n  let newBlock1;\n  /** @type {module:ol/style/Atlas~AtlasBlock} */\n  let newBlock2;\n\n  if (deltaWidth > deltaHeight) {\n    // split vertically\n    // block right of the inserted entry\n    newBlock1 = {\n      x: block.x + width,\n      y: block.y,\n      width: block.width - width,\n      height: block.height\n    };\n\n    // block below the inserted entry\n    newBlock2 = {\n      x: block.x,\n      y: block.y + height,\n      width: width,\n      height: block.height - height\n    };\n    this.updateBlocks_(index, newBlock1, newBlock2);\n  } else {\n    // split horizontally\n    // block right of the inserted entry\n    newBlock1 = {\n      x: block.x + width,\n      y: block.y,\n      width: block.width - width,\n      height: height\n    };\n\n    // block below the inserted entry\n    newBlock2 = {\n      x: block.x,\n      y: block.y + height,\n      width: block.width,\n      height: block.height - height\n    };\n    this.updateBlocks_(index, newBlock1, newBlock2);\n  }\n};\n\n\n/**\n * Remove the old block and insert new blocks at the same array position.\n * The new blocks are inserted at the same position, so that splitted\n * blocks (that are potentially smaller) are filled first.\n * @private\n * @param {number} index The index of the block to remove.\n * @param {module:ol/style/Atlas~AtlasBlock} newBlock1 The 1st block to add.\n * @param {module:ol/style/Atlas~AtlasBlock} newBlock2 The 2nd block to add.\n */\nAtlas.prototype.updateBlocks_ = function(index, newBlock1, newBlock2) {\n  const args = [index, 1];\n  if (newBlock1.width > 0 && newBlock1.height > 0) {\n    args.push(newBlock1);\n  }\n  if (newBlock2.width > 0 && newBlock2.height > 0) {\n    args.push(newBlock2);\n  }\n  this.emptyBlocks_.splice.apply(this.emptyBlocks_, args);\n};\nexport default Atlas;\n","/**\n * @module ol/style/AtlasManager\n */\nimport {MAX_TEXTURE_SIZE as WEBGL_MAX_TEXTURE_SIZE} from '../webgl.js';\nimport {UNDEFINED} from '../functions.js';\nimport Atlas from '../style/Atlas.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [initialSize=256] The size in pixels of the first atlas image.\n * @property {number} [maxSize] The maximum size in pixels of atlas images. Default is\n * `webgl/MAX_TEXTURE_SIZE` or 2048 if WebGL is not supported.\n * @property {number} [space=1] The space in pixels between images.\n */\n\n\n/**\n * Provides information for an image inside an atlas manager.\n * `offsetX` and `offsetY` is the position of the image inside\n * the atlas image `image` and the position of the hit-detection image\n * inside the hit-detection atlas image `hitImage`.\n * @typedef {Object} AtlasManagerInfo\n * @property {number} offsetX\n * @property {number} offsetY\n * @property {HTMLCanvasElement} image\n * @property {HTMLCanvasElement} hitImage\n */\n\n\n/**\n * The size in pixels of the first atlas image.\n * @type {number}\n */\nconst INITIAL_ATLAS_SIZE = 256;\n\n/**\n * The maximum size in pixels of atlas images.\n * @type {number}\n */\nconst MAX_ATLAS_SIZE = -1;\n\n\n/**\n * Manages the creation of image atlases.\n *\n * Images added to this manager will be inserted into an atlas, which\n * will be used for rendering.\n * The `size` given in the constructor is the size for the first\n * atlas. After that, when new atlases are created, they will have\n * twice the size as the latest atlas (until `maxSize` is reached).\n *\n * If an application uses many images or very large images, it is recommended\n * to set a higher `size` value to avoid the creation of too many atlases.\n *\n * @constructor\n * @struct\n * @api\n * @param {module:ol/style/AtlasManager~Options=} opt_options Options.\n */\nconst AtlasManager = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * The size in pixels of the latest atlas image.\n   * @private\n   * @type {number}\n   */\n  this.currentSize_ = options.initialSize !== undefined ?\n    options.initialSize : INITIAL_ATLAS_SIZE;\n\n  /**\n   * The maximum size in pixels of atlas images.\n   * @private\n   * @type {number}\n   */\n  this.maxSize_ = options.maxSize !== undefined ?\n    options.maxSize : MAX_ATLAS_SIZE != -1 ?\n      MAX_ATLAS_SIZE : WEBGL_MAX_TEXTURE_SIZE !== undefined ?\n        WEBGL_MAX_TEXTURE_SIZE : 2048;\n\n  /**\n   * The size in pixels between images.\n   * @private\n   * @type {number}\n   */\n  this.space_ = options.space !== undefined ? options.space : 1;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/style/Atlas>}\n   */\n  this.atlases_ = [new Atlas(this.currentSize_, this.space_)];\n\n  /**\n   * The size in pixels of the latest atlas image for hit-detection images.\n   * @private\n   * @type {number}\n   */\n  this.currentHitSize_ = this.currentSize_;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/style/Atlas>}\n   */\n  this.hitAtlases_ = [new Atlas(this.currentHitSize_, this.space_)];\n};\n\n\n/**\n * @param {string} id The identifier of the entry to check.\n * @return {?module:ol/style/AtlasManager~AtlasManagerInfo} The position and atlas image for the\n *    entry, or `null` if the entry is not part of the atlas manager.\n */\nAtlasManager.prototype.getInfo = function(id) {\n  /** @type {?module:ol/style/Atlas~AtlasInfo} */\n  const info = this.getInfo_(this.atlases_, id);\n\n  if (!info) {\n    return null;\n  }\n  const hitInfo = /** @type {module:ol/style/Atlas~AtlasInfo} */ (this.getInfo_(this.hitAtlases_, id));\n\n  return this.mergeInfos_(info, hitInfo);\n};\n\n\n/**\n * @private\n * @param {Array.<module:ol/style/Atlas>} atlases The atlases to search.\n * @param {string} id The identifier of the entry to check.\n * @return {?module:ol/style/Atlas~AtlasInfo} The position and atlas image for the entry,\n *    or `null` if the entry is not part of the atlases.\n */\nAtlasManager.prototype.getInfo_ = function(atlases, id) {\n  for (let i = 0, ii = atlases.length; i < ii; ++i) {\n    const atlas = atlases[i];\n    const info = atlas.get(id);\n    if (info) {\n      return info;\n    }\n  }\n  return null;\n};\n\n\n/**\n * @private\n * @param {module:ol/style/Atlas~AtlasInfo} info The info for the real image.\n * @param {module:ol/style/Atlas~AtlasInfo} hitInfo The info for the hit-detection\n *    image.\n * @return {?module:ol/style/AtlasManager~AtlasManagerInfo} The position and atlas image for the\n *    entry, or `null` if the entry is not part of the atlases.\n */\nAtlasManager.prototype.mergeInfos_ = function(info, hitInfo) {\n  return (\n    /** @type {module:ol/style/AtlasManager~AtlasManagerInfo} */ ({\n      offsetX: info.offsetX,\n      offsetY: info.offsetY,\n      image: info.image,\n      hitImage: hitInfo.image\n    })\n  );\n};\n\n\n/**\n * Add an image to the atlas manager.\n *\n * If an entry for the given id already exists, the entry will\n * be overridden (but the space on the atlas graphic will not be freed).\n *\n * If `renderHitCallback` is provided, the image (or the hit-detection version\n * of the image) will be rendered into a separate hit-detection atlas image.\n *\n * @param {string} id The identifier of the entry to add.\n * @param {number} width The width.\n * @param {number} height The height.\n * @param {function(CanvasRenderingContext2D, number, number)} renderCallback\n *    Called to render the new image onto an atlas image.\n * @param {function(CanvasRenderingContext2D, number, number)=}\n *    opt_renderHitCallback Called to render a hit-detection image onto a hit\n *    detection atlas image.\n * @param {Object=} opt_this Value to use as `this` when executing\n *    `renderCallback` and `renderHitCallback`.\n * @return {?module:ol/style/AtlasManager~AtlasManagerInfo}  The position and atlas image for the\n *    entry, or `null` if the image is too big.\n */\nAtlasManager.prototype.add = function(id, width, height,\n  renderCallback, opt_renderHitCallback, opt_this) {\n  if (width + this.space_ > this.maxSize_ ||\n      height + this.space_ > this.maxSize_) {\n    return null;\n  }\n\n  /** @type {?module:ol/style/Atlas~AtlasInfo} */\n  const info = this.add_(false, id, width, height, renderCallback, opt_this);\n  if (!info) {\n    return null;\n  }\n\n  // even if no hit-detection entry is requested, we insert a fake entry into\n  // the hit-detection atlas, to make sure that the offset is the same for\n  // the original image and the hit-detection image.\n  const renderHitCallback = opt_renderHitCallback !== undefined ?\n    opt_renderHitCallback : UNDEFINED;\n\n  const hitInfo = /** @type {module:ol/style/Atlas~AtlasInfo} */ (this.add_(true,\n    id, width, height, renderHitCallback, opt_this));\n\n  return this.mergeInfos_(info, hitInfo);\n};\n\n\n/**\n * @private\n * @param {boolean} isHitAtlas If the hit-detection atlases are used.\n * @param {string} id The identifier of the entry to add.\n * @param {number} width The width.\n * @param {number} height The height.\n * @param {function(CanvasRenderingContext2D, number, number)} renderCallback\n *    Called to render the new image onto an atlas image.\n * @param {Object=} opt_this Value to use as `this` when executing\n *    `renderCallback` and `renderHitCallback`.\n * @return {?module:ol/style/Atlas~AtlasInfo}  The position and atlas image for the entry,\n *    or `null` if the image is too big.\n */\nAtlasManager.prototype.add_ = function(isHitAtlas, id, width, height, renderCallback, opt_this) {\n  const atlases = (isHitAtlas) ? this.hitAtlases_ : this.atlases_;\n  let atlas, info, i, ii;\n  for (i = 0, ii = atlases.length; i < ii; ++i) {\n    atlas = atlases[i];\n    info = atlas.add(id, width, height, renderCallback, opt_this);\n    if (info) {\n      return info;\n    } else if (!info && i === ii - 1) {\n      // the entry could not be added to one of the existing atlases,\n      // create a new atlas that is twice as big and try to add to this one.\n      let size;\n      if (isHitAtlas) {\n        size = Math.min(this.currentHitSize_ * 2, this.maxSize_);\n        this.currentHitSize_ = size;\n      } else {\n        size = Math.min(this.currentSize_ * 2, this.maxSize_);\n        this.currentSize_ = size;\n      }\n      atlas = new Atlas(size, this.space_);\n      atlases.push(atlas);\n      // run the loop another time\n      ++ii;\n    }\n  }\n  return null;\n};\nexport default AtlasManager;\n","/**\n * @module ol/render/webgl/TextReplay\n */\nimport {getUid, inherits} from '../../util.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport {CANVAS_LINE_DASH} from '../../has.js';\nimport {TEXT_ALIGN} from '../replay.js';\nimport {DEFAULT_FILLSTYLE, DEFAULT_FONT, DEFAULT_LINECAP, DEFAULT_LINEDASH,\n  DEFAULT_LINEDASHOFFSET, DEFAULT_LINEJOIN, DEFAULT_LINEWIDTH, DEFAULT_MITERLIMIT,\n  DEFAULT_STROKESTYLE, DEFAULT_TEXTALIGN, DEFAULT_TEXTBASELINE} from '../webgl.js';\nimport WebGLTextureReplay from '../webgl/TextureReplay.js';\nimport AtlasManager from '../../style/AtlasManager.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n/**\n * @typedef {Object} GlyphAtlas\n * @property {module:ol/style/AtlasManager} atlas\n * @property {Object.<string, number>} width\n * @property {number} height\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/render/webgl/TextureReplay}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @struct\n */\nconst WebGLTextReplay = function(tolerance, maxExtent) {\n  WebGLTextureReplay.call(this, tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {Array.<HTMLCanvasElement>}\n   */\n  this.images_ = [];\n\n  /**\n   * @private\n   * @type {Array.<WebGLTexture>}\n   */\n  this.textures_ = [];\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.measureCanvas_ = createCanvasContext2D(0, 0).canvas;\n\n  /**\n   * @private\n   * @type {{strokeColor: (module:ol/colorlike~ColorLike|null),\n   *         lineCap: (string|undefined),\n   *         lineDash: Array.<number>,\n   *         lineDashOffset: (number|undefined),\n   *         lineJoin: (string|undefined),\n   *         lineWidth: number,\n   *         miterLimit: (number|undefined),\n   *         fillColor: (module:ol/colorlike~ColorLike|null),\n   *         font: (string|undefined),\n   *         scale: (number|undefined)}}\n   */\n  this.state_ = {\n    strokeColor: null,\n    lineCap: undefined,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineJoin: undefined,\n    lineWidth: 0,\n    miterLimit: undefined,\n    fillColor: null,\n    font: undefined,\n    scale: undefined\n  };\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.text_ = '';\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.textAlign_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.textBaseline_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.offsetX_ = undefined;\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.offsetY_ = undefined;\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/render/webgl/TextReplay~GlyphAtlas>}\n   */\n  this.atlases_ = {};\n\n  /**\n   * @private\n   * @type {module:ol/render/webgl/TextReplay~GlyphAtlas|undefined}\n   */\n  this.currAtlas_ = undefined;\n\n  this.scale = 1;\n\n  this.opacity = 1;\n\n};\n\ninherits(WebGLTextReplay, WebGLTextureReplay);\n\n\n/**\n * @inheritDoc\n */\nWebGLTextReplay.prototype.drawText = function(geometry, feature) {\n  if (this.text_) {\n    let flatCoordinates = null;\n    const offset = 0;\n    let end = 2;\n    let stride = 2;\n    switch (geometry.getType()) {\n      case GeometryType.POINT:\n      case GeometryType.MULTI_POINT:\n        flatCoordinates = geometry.getFlatCoordinates();\n        end = flatCoordinates.length;\n        stride = geometry.getStride();\n        break;\n      case GeometryType.CIRCLE:\n        flatCoordinates = /** @type {module:ol/geom/Circle} */ (geometry).getCenter();\n        break;\n      case GeometryType.LINE_STRING:\n        flatCoordinates = /** @type {module:ol/geom/LineString} */ (geometry).getFlatMidpoint();\n        break;\n      case GeometryType.MULTI_LINE_STRING:\n        flatCoordinates = /** @type {module:ol/geom/MultiLineString} */ (geometry).getFlatMidpoints();\n        end = flatCoordinates.length;\n        break;\n      case GeometryType.POLYGON:\n        flatCoordinates = /** @type {module:ol/geom/Polygon} */ (geometry).getFlatInteriorPoint();\n        break;\n      case GeometryType.MULTI_POLYGON:\n        flatCoordinates = /** @type {module:ol/geom/MultiPolygon} */ (geometry).getFlatInteriorPoints();\n        end = flatCoordinates.length;\n        break;\n      default:\n    }\n    this.startIndices.push(this.indices.length);\n    this.startIndicesFeature.push(feature);\n\n    const glyphAtlas = this.currAtlas_;\n    const lines = this.text_.split('\\n');\n    const textSize = this.getTextSize_(lines);\n    let i, ii, j, jj, currX, currY, charArr, charInfo;\n    const anchorX = Math.round(textSize[0] * this.textAlign_ - this.offsetX_);\n    const anchorY = Math.round(textSize[1] * this.textBaseline_ - this.offsetY_);\n    const lineWidth = (this.state_.lineWidth / 2) * this.state_.scale;\n\n    for (i = 0, ii = lines.length; i < ii; ++i) {\n      currX = 0;\n      currY = glyphAtlas.height * i;\n      charArr = lines[i].split('');\n\n      for (j = 0, jj = charArr.length; j < jj; ++j) {\n        charInfo = glyphAtlas.atlas.getInfo(charArr[j]);\n\n        if (charInfo) {\n          const image = charInfo.image;\n\n          this.anchorX = anchorX - currX;\n          this.anchorY = anchorY - currY;\n          this.originX = j === 0 ? charInfo.offsetX - lineWidth : charInfo.offsetX;\n          this.originY = charInfo.offsetY;\n          this.height = glyphAtlas.height;\n          this.width = j === 0 || j === charArr.length - 1 ?\n            glyphAtlas.width[charArr[j]] + lineWidth : glyphAtlas.width[charArr[j]];\n          this.imageHeight = image.height;\n          this.imageWidth = image.width;\n\n          if (this.images_.length === 0) {\n            this.images_.push(image);\n          } else {\n            const currentImage = this.images_[this.images_.length - 1];\n            if (getUid(currentImage) != getUid(image)) {\n              this.groupIndices.push(this.indices.length);\n              this.images_.push(image);\n            }\n          }\n\n          this.drawText_(flatCoordinates, offset, end, stride);\n        }\n        currX += this.width;\n      }\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {Array.<string>} lines Label to draw split to lines.\n * @return {Array.<number>} Size of the label in pixels.\n */\nWebGLTextReplay.prototype.getTextSize_ = function(lines) {\n  const self = this;\n  const glyphAtlas = this.currAtlas_;\n  const textHeight = lines.length * glyphAtlas.height;\n  //Split every line to an array of chars, sum up their width, and select the longest.\n  const textWidth = lines.map(function(str) {\n    let sum = 0;\n    for (let i = 0, ii = str.length; i < ii; ++i) {\n      const curr = str[i];\n      if (!glyphAtlas.width[curr]) {\n        self.addCharToAtlas_(curr);\n      }\n      sum += glyphAtlas.width[curr] ? glyphAtlas.width[curr] : 0;\n    }\n    return sum;\n  }).reduce(function(max, curr) {\n    return Math.max(max, curr);\n  });\n\n  return [textWidth, textHeight];\n};\n\n\n/**\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\nWebGLTextReplay.prototype.drawText_ = function(flatCoordinates, offset, end, stride) {\n  for (let i = offset, ii = end; i < ii; i += stride) {\n    this.drawCoordinates(flatCoordinates, offset, end, stride);\n  }\n};\n\n\n/**\n * @private\n * @param {string} char Character.\n */\nWebGLTextReplay.prototype.addCharToAtlas_ = function(char) {\n  if (char.length === 1) {\n    const glyphAtlas = this.currAtlas_;\n    const state = this.state_;\n    const mCtx = this.measureCanvas_.getContext('2d');\n    mCtx.font = state.font;\n    const width = Math.ceil(mCtx.measureText(char).width * state.scale);\n\n    const info = glyphAtlas.atlas.add(char, width, glyphAtlas.height,\n      function(ctx, x, y) {\n        //Parameterize the canvas\n        ctx.font = /** @type {string} */ (state.font);\n        ctx.fillStyle = state.fillColor;\n        ctx.strokeStyle = state.strokeColor;\n        ctx.lineWidth = state.lineWidth;\n        ctx.lineCap = /*** @type {string} */ (state.lineCap);\n        ctx.lineJoin = /** @type {string} */ (state.lineJoin);\n        ctx.miterLimit = /** @type {number} */ (state.miterLimit);\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'top';\n        if (CANVAS_LINE_DASH && state.lineDash) {\n          //FIXME: use pixelRatio\n          ctx.setLineDash(state.lineDash);\n          ctx.lineDashOffset = /** @type {number} */ (state.lineDashOffset);\n        }\n        if (state.scale !== 1) {\n          //FIXME: use pixelRatio\n          ctx.setTransform(/** @type {number} */ (state.scale), 0, 0,\n            /** @type {number} */ (state.scale), 0, 0);\n        }\n\n        //Draw the character on the canvas\n        if (state.strokeColor) {\n          ctx.strokeText(char, x, y);\n        }\n        if (state.fillColor) {\n          ctx.fillText(char, x, y);\n        }\n      });\n\n    if (info) {\n      glyphAtlas.width[char] = width;\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextReplay.prototype.finish = function(context) {\n  const gl = context.getGL();\n\n  this.groupIndices.push(this.indices.length);\n  this.hitDetectionGroupIndices = this.groupIndices;\n\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new WebGLBuffer(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new WebGLBuffer(this.indices);\n\n  // create textures\n  /** @type {Object.<string, WebGLTexture>} */\n  const texturePerImage = {};\n\n  this.createTextures(this.textures_, this.images_, texturePerImage, gl);\n\n  this.state_ = {\n    strokeColor: null,\n    lineCap: undefined,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineJoin: undefined,\n    lineWidth: 0,\n    miterLimit: undefined,\n    fillColor: null,\n    font: undefined,\n    scale: undefined\n  };\n  this.text_ = '';\n  this.textAlign_ = undefined;\n  this.textBaseline_ = undefined;\n  this.offsetX_ = undefined;\n  this.offsetY_ = undefined;\n  this.images_ = null;\n  this.atlases_ = {};\n  this.currAtlas_ = undefined;\n  WebGLTextureReplay.prototype.finish.call(this, context);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextReplay.prototype.setTextStyle = function(textStyle) {\n  const state = this.state_;\n  const textFillStyle = textStyle.getFill();\n  const textStrokeStyle = textStyle.getStroke();\n  if (!textStyle || !textStyle.getText() || (!textFillStyle && !textStrokeStyle)) {\n    this.text_ = '';\n  } else {\n    if (!textFillStyle) {\n      state.fillColor = null;\n    } else {\n      const textFillStyleColor = textFillStyle.getColor();\n      state.fillColor = asColorLike(textFillStyleColor ?\n        textFillStyleColor : DEFAULT_FILLSTYLE);\n    }\n    if (!textStrokeStyle) {\n      state.strokeColor = null;\n      state.lineWidth = 0;\n    } else {\n      const textStrokeStyleColor = textStrokeStyle.getColor();\n      state.strokeColor = asColorLike(textStrokeStyleColor ?\n        textStrokeStyleColor : DEFAULT_STROKESTYLE);\n      state.lineWidth = textStrokeStyle.getWidth() || DEFAULT_LINEWIDTH;\n      state.lineCap = textStrokeStyle.getLineCap() || DEFAULT_LINECAP;\n      state.lineDashOffset = textStrokeStyle.getLineDashOffset() || DEFAULT_LINEDASHOFFSET;\n      state.lineJoin = textStrokeStyle.getLineJoin() || DEFAULT_LINEJOIN;\n      state.miterLimit = textStrokeStyle.getMiterLimit() || DEFAULT_MITERLIMIT;\n      const lineDash = textStrokeStyle.getLineDash();\n      state.lineDash = lineDash ? lineDash.slice() : DEFAULT_LINEDASH;\n    }\n    state.font = textStyle.getFont() || DEFAULT_FONT;\n    state.scale = textStyle.getScale() || 1;\n    this.text_ = /** @type {string} */ (textStyle.getText());\n    const textAlign = TEXT_ALIGN[textStyle.getTextAlign()];\n    const textBaseline = TEXT_ALIGN[textStyle.getTextBaseline()];\n    this.textAlign_ = textAlign === undefined ?\n      DEFAULT_TEXTALIGN : textAlign;\n    this.textBaseline_ = textBaseline === undefined ?\n      DEFAULT_TEXTBASELINE : textBaseline;\n    this.offsetX_ = textStyle.getOffsetX() || 0;\n    this.offsetY_ = textStyle.getOffsetY() || 0;\n    this.rotateWithView = !!textStyle.getRotateWithView();\n    this.rotation = textStyle.getRotation() || 0;\n\n    this.currAtlas_ = this.getAtlas_(state);\n  }\n};\n\n\n/**\n * @private\n * @param {Object} state Font attributes.\n * @return {module:ol/render/webgl/TextReplay~GlyphAtlas} Glyph atlas.\n */\nWebGLTextReplay.prototype.getAtlas_ = function(state) {\n  let params = [];\n  for (const i in state) {\n    if (state[i] || state[i] === 0) {\n      if (Array.isArray(state[i])) {\n        params = params.concat(state[i]);\n      } else {\n        params.push(state[i]);\n      }\n    }\n  }\n  const hash = this.calculateHash_(params);\n  if (!this.atlases_[hash]) {\n    const mCtx = this.measureCanvas_.getContext('2d');\n    mCtx.font = state.font;\n    const height = Math.ceil((mCtx.measureText('M').width * 1.5 +\n        state.lineWidth / 2) * state.scale);\n\n    this.atlases_[hash] = {\n      atlas: new AtlasManager({\n        space: state.lineWidth + 1\n      }),\n      width: {},\n      height: height\n    };\n  }\n  return this.atlases_[hash];\n};\n\n\n/**\n * @private\n * @param {Array.<string|number>} params Array of parameters.\n * @return {string} Hash string.\n */\nWebGLTextReplay.prototype.calculateHash_ = function(params) {\n  //TODO: Create a more performant, reliable, general hash function.\n  let hash = '';\n  for (let i = 0, ii = params.length; i < ii; ++i) {\n    hash += params[i];\n  }\n  return hash;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextReplay.prototype.getTextures = function(opt_all) {\n  return this.textures_;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTextReplay.prototype.getHitDetectionTextures = function() {\n  return this.textures_;\n};\nexport default WebGLTextReplay;\n","/**\n * @module ol/render/webgl/ReplayGroup\n */\nimport {inherits} from '../../util.js';\nimport {numberSafeCompareFunction} from '../../array.js';\nimport {buffer, createOrUpdateFromCoordinate} from '../../extent.js';\nimport {isEmpty} from '../../obj.js';\nimport {ORDER} from '../replay.js';\nimport ReplayGroup from '../ReplayGroup.js';\nimport WebGLCircleReplay from '../webgl/CircleReplay.js';\nimport WebGLImageReplay from '../webgl/ImageReplay.js';\nimport WebGLLineStringReplay from '../webgl/LineStringReplay.js';\nimport WebGLPolygonReplay from '../webgl/PolygonReplay.js';\nimport WebGLTextReplay from '../webgl/TextReplay.js';\n\n/**\n * @type {Array.<number>}\n */\nconst HIT_DETECTION_SIZE = [1, 1];\n\n/**\n * @type {Object.<module:ol/render/ReplayType,\n *                function(new: module:ol/render/webgl/Replay, number,\n *                module:ol/extent~Extent)>}\n */\nconst BATCH_CONSTRUCTORS = {\n  'Circle': WebGLCircleReplay,\n  'Image': WebGLImageReplay,\n  'LineString': WebGLLineStringReplay,\n  'Polygon': WebGLPolygonReplay,\n  'Text': WebGLTextReplay\n};\n\n\n/**\n * @constructor\n * @extends {module:ol/render/ReplayGroup}\n * @param {number} tolerance Tolerance.\n * @param {module:ol/extent~Extent} maxExtent Max extent.\n * @param {number=} opt_renderBuffer Render buffer.\n * @struct\n */\nconst WebGLReplayGroup = function(tolerance, maxExtent, opt_renderBuffer) {\n  ReplayGroup.call(this);\n\n  /**\n   * @type {module:ol/extent~Extent}\n   * @private\n   */\n  this.maxExtent_ = maxExtent;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.tolerance_ = tolerance;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.renderBuffer_ = opt_renderBuffer;\n\n  /**\n   * @private\n   * @type {!Object.<string,\n   *        Object.<module:ol/render/ReplayType, module:ol/render/webgl/Replay>>}\n   */\n  this.replaysByZIndex_ = {};\n\n};\n\ninherits(WebGLReplayGroup, ReplayGroup);\n\n\n/**\n * @param {module:ol/style/Style} style Style.\n * @param {boolean} group Group with previous replay.\n */\nWebGLReplayGroup.prototype.addDeclutter = function(style, group) {};\n\n\n/**\n * @param {module:ol/webgl/Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\nWebGLReplayGroup.prototype.getDeleteResourcesFunction = function(context) {\n  const functions = [];\n  let zKey;\n  for (zKey in this.replaysByZIndex_) {\n    const replays = this.replaysByZIndex_[zKey];\n    for (const replayKey in replays) {\n      functions.push(\n        replays[replayKey].getDeleteResourcesFunction(context));\n    }\n  }\n  return function() {\n    const length = functions.length;\n    let result;\n    for (let i = 0; i < length; i++) {\n      result = functions[i].apply(this, arguments);\n    }\n    return result;\n  };\n};\n\n\n/**\n * @param {module:ol/webgl/Context} context Context.\n */\nWebGLReplayGroup.prototype.finish = function(context) {\n  let zKey;\n  for (zKey in this.replaysByZIndex_) {\n    const replays = this.replaysByZIndex_[zKey];\n    for (const replayKey in replays) {\n      replays[replayKey].finish(context);\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLReplayGroup.prototype.getReplay = function(zIndex, replayType) {\n  const zIndexKey = zIndex !== undefined ? zIndex.toString() : '0';\n  let replays = this.replaysByZIndex_[zIndexKey];\n  if (replays === undefined) {\n    replays = {};\n    this.replaysByZIndex_[zIndexKey] = replays;\n  }\n  let replay = replays[replayType];\n  if (replay === undefined) {\n    /**\n     * @type {Function}\n     */\n    const Constructor = BATCH_CONSTRUCTORS[replayType];\n    replay = new Constructor(this.tolerance_, this.maxExtent_);\n    replays[replayType] = replay;\n  }\n  return replay;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLReplayGroup.prototype.isEmpty = function() {\n  return isEmpty(this.replaysByZIndex_);\n};\n\n\n/**\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n */\nWebGLReplayGroup.prototype.replay = function(context,\n  center, resolution, rotation, size, pixelRatio,\n  opacity, skippedFeaturesHash) {\n  /** @type {Array.<number>} */\n  const zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(numberSafeCompareFunction);\n\n  let i, ii, j, jj, replays, replay;\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n    for (j = 0, jj = ORDER.length; j < jj; ++j) {\n      replay = replays[ORDER[j]];\n      if (replay !== undefined) {\n        replay.replay(context,\n          center, resolution, rotation, size, pixelRatio,\n          opacity, skippedFeaturesHash,\n          undefined, false);\n      }\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplayGroup.prototype.replayHitDetection_ = function(context,\n  center, resolution, rotation, size, pixelRatio, opacity,\n  skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\n  /** @type {Array.<number>} */\n  const zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(function(a, b) {\n    return b - a;\n  });\n\n  let i, ii, j, replays, replay, result;\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n    for (j = ORDER.length - 1; j >= 0; --j) {\n      replay = replays[ORDER[j]];\n      if (replay !== undefined) {\n        result = replay.replay(context,\n          center, resolution, rotation, size, pixelRatio, opacity,\n          skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);\n        if (result) {\n          return result;\n        }\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} callback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\nWebGLReplayGroup.prototype.forEachFeatureAtCoordinate = function(\n  coordinate, context, center, resolution, rotation, size, pixelRatio,\n  opacity, skippedFeaturesHash,\n  callback) {\n  const gl = context.getGL();\n  gl.bindFramebuffer(\n    gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n\n\n  /**\n   * @type {module:ol/extent~Extent}\n   */\n  let hitExtent;\n  if (this.renderBuffer_ !== undefined) {\n    // build an extent around the coordinate, so that only features that\n    // intersect this extent are checked\n    hitExtent = buffer(createOrUpdateFromCoordinate(coordinate), resolution * this.renderBuffer_);\n  }\n\n  return this.replayHitDetection_(context,\n    coordinate, resolution, rotation, HIT_DETECTION_SIZE,\n    pixelRatio, opacity, skippedFeaturesHash,\n    /**\n     * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n     * @return {?} Callback result.\n     */\n    function(feature) {\n      const imageData = new Uint8Array(4);\n      gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n\n      if (imageData[3] > 0) {\n        const result = callback(feature);\n        if (result) {\n          return result;\n        }\n      }\n    }, true, hitExtent);\n};\n\n\n/**\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\n * @return {boolean} Is there a feature at the given coordinate?\n */\nWebGLReplayGroup.prototype.hasFeatureAtCoordinate = function(\n  coordinate, context, center, resolution, rotation, size, pixelRatio,\n  opacity, skippedFeaturesHash) {\n  const gl = context.getGL();\n  gl.bindFramebuffer(\n    gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n\n  const hasFeature = this.replayHitDetection_(context,\n    coordinate, resolution, rotation, HIT_DETECTION_SIZE,\n    pixelRatio, opacity, skippedFeaturesHash,\n    /**\n     * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n     * @return {boolean} Is there a feature?\n     */\n    function(feature) {\n      const imageData = new Uint8Array(4);\n      gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n      return imageData[3] > 0;\n    }, false);\n\n  return hasFeature !== undefined;\n};\n\nexport default WebGLReplayGroup;\n","/**\n * @module ol/render/webgl/Immediate\n */\nimport {inherits} from '../../util.js';\nimport {intersects} from '../../extent.js';\nimport GeometryType from '../../geom/GeometryType.js';\nimport ReplayType from '../ReplayType.js';\nimport VectorContext from '../VectorContext.js';\nimport WebGLReplayGroup from '../webgl/ReplayGroup.js';\n\n/**\n * @constructor\n * @extends {module:ol/render/VectorContext}\n * @param {module:ol/webgl/Context} context Context.\n * @param {module:ol/coordinate~Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {module:ol/size~Size} size Size.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} pixelRatio Pixel ratio.\n * @struct\n */\nconst WebGLImmediateRenderer = function(context, center, resolution, rotation, size, extent, pixelRatio) {\n  VectorContext.call(this);\n\n  /**\n   * @private\n   */\n  this.context_ = context;\n\n  /**\n   * @private\n   */\n  this.center_ = center;\n\n  /**\n   * @private\n   */\n  this.extent_ = extent;\n\n  /**\n   * @private\n   */\n  this.pixelRatio_ = pixelRatio;\n\n  /**\n   * @private\n   */\n  this.size_ = size;\n\n  /**\n   * @private\n   */\n  this.rotation_ = rotation;\n\n  /**\n   * @private\n   */\n  this.resolution_ = resolution;\n\n  /**\n   * @private\n   * @type {module:ol/style/Image}\n   */\n  this.imageStyle_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Fill}\n   */\n  this.fillStyle_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Stroke}\n   */\n  this.strokeStyle_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/Text}\n   */\n  this.textStyle_ = null;\n\n};\n\ninherits(WebGLImmediateRenderer, VectorContext);\n\n\n/**\n * @param {module:ol/render/webgl/ReplayGroup} replayGroup Replay group.\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry Geometry.\n * @private\n */\nWebGLImmediateRenderer.prototype.drawText_ = function(replayGroup, geometry) {\n  const context = this.context_;\n  const replay = /** @type {module:ol/render/webgl/TextReplay} */ (\n    replayGroup.getReplay(0, ReplayType.TEXT));\n  replay.setTextStyle(this.textStyle_);\n  replay.drawText(geometry, null);\n  replay.finish(context);\n  // default colors\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n};\n\n\n/**\n * Set the rendering style.  Note that since this is an immediate rendering API,\n * any `zIndex` on the provided style will be ignored.\n *\n * @param {module:ol/style/Style} style The rendering style.\n * @override\n * @api\n */\nWebGLImmediateRenderer.prototype.setStyle = function(style) {\n  this.setFillStrokeStyle(style.getFill(), style.getStroke());\n  this.setImageStyle(style.getImage());\n  this.setTextStyle(style.getText());\n};\n\n\n/**\n * Render a geometry into the canvas.  Call\n * {@link ol/render/webgl/Immediate#setStyle} first to set the rendering style.\n *\n * @param {module:ol/geom/Geometry|module:ol/render/Feature} geometry The geometry to render.\n * @override\n * @api\n */\nWebGLImmediateRenderer.prototype.drawGeometry = function(geometry) {\n  const type = geometry.getType();\n  switch (type) {\n    case GeometryType.POINT:\n      this.drawPoint(/** @type {module:ol/geom/Point} */ (geometry), null);\n      break;\n    case GeometryType.LINE_STRING:\n      this.drawLineString(/** @type {module:ol/geom/LineString} */ (geometry), null);\n      break;\n    case GeometryType.POLYGON:\n      this.drawPolygon(/** @type {module:ol/geom/Polygon} */ (geometry), null);\n      break;\n    case GeometryType.MULTI_POINT:\n      this.drawMultiPoint(/** @type {module:ol/geom/MultiPoint} */ (geometry), null);\n      break;\n    case GeometryType.MULTI_LINE_STRING:\n      this.drawMultiLineString(/** @type {module:ol/geom/MultiLineString} */ (geometry), null);\n      break;\n    case GeometryType.MULTI_POLYGON:\n      this.drawMultiPolygon(/** @type {module:ol/geom/MultiPolygon} */ (geometry), null);\n      break;\n    case GeometryType.GEOMETRY_COLLECTION:\n      this.drawGeometryCollection(/** @type {module:ol/geom/GeometryCollection} */ (geometry), null);\n      break;\n    case GeometryType.CIRCLE:\n      this.drawCircle(/** @type {module:ol/geom/Circle} */ (geometry), null);\n      break;\n    default:\n      // pass\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nWebGLImmediateRenderer.prototype.drawFeature = function(feature, style) {\n  const geometry = style.getGeometryFunction()(feature);\n  if (!geometry || !intersects(this.extent_, geometry.getExtent())) {\n    return;\n  }\n  this.setStyle(style);\n  this.drawGeometry(geometry);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawGeometryCollection = function(geometry, data) {\n  const geometries = geometry.getGeometriesArray();\n  let i, ii;\n  for (i = 0, ii = geometries.length; i < ii; ++i) {\n    this.drawGeometry(geometries[i]);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawPoint = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/ImageReplay} */ (\n    replayGroup.getReplay(0, ReplayType.IMAGE));\n  replay.setImageStyle(this.imageStyle_);\n  replay.drawPoint(geometry, data);\n  replay.finish(context);\n  // default colors\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawMultiPoint = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/ImageReplay} */ (\n    replayGroup.getReplay(0, ReplayType.IMAGE));\n  replay.setImageStyle(this.imageStyle_);\n  replay.drawMultiPoint(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawLineString = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/LineStringReplay} */ (\n    replayGroup.getReplay(0, ReplayType.LINE_STRING));\n  replay.setFillStrokeStyle(null, this.strokeStyle_);\n  replay.drawLineString(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawMultiLineString = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/LineStringReplay} */ (\n    replayGroup.getReplay(0, ReplayType.LINE_STRING));\n  replay.setFillStrokeStyle(null, this.strokeStyle_);\n  replay.drawMultiLineString(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawPolygon = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/PolygonReplay} */ (\n    replayGroup.getReplay(0, ReplayType.POLYGON));\n  replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);\n  replay.drawPolygon(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawMultiPolygon = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/PolygonReplay} */ (\n    replayGroup.getReplay(0, ReplayType.POLYGON));\n  replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);\n  replay.drawMultiPolygon(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.drawCircle = function(geometry, data) {\n  const context = this.context_;\n  const replayGroup = new WebGLReplayGroup(1, this.extent_);\n  const replay = /** @type {module:ol/render/webgl/CircleReplay} */ (\n    replayGroup.getReplay(0, ReplayType.CIRCLE));\n  replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);\n  replay.drawCircle(geometry, data);\n  replay.finish(context);\n  const opacity = 1;\n  const skippedFeatures = {};\n  let featureCallback;\n  const oneByOne = false;\n  replay.replay(this.context_, this.center_, this.resolution_, this.rotation_,\n    this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback,\n    oneByOne);\n  replay.getDeleteResourcesFunction(context)();\n\n  if (this.textStyle_) {\n    this.drawText_(replayGroup, geometry);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.setImageStyle = function(imageStyle) {\n  this.imageStyle_ = imageStyle;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  this.fillStyle_ = fillStyle;\n  this.strokeStyle_ = strokeStyle;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImmediateRenderer.prototype.setTextStyle = function(textStyle) {\n  this.textStyle_ = textStyle;\n};\nexport default WebGLImmediateRenderer;\n","/**\n * @module ol/renderer/webgl/defaultmapshader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../webgl.js';\nimport WebGLFragment from '../../webgl/Fragment.js';\nimport WebGLVertex from '../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\nvarying vec2 v_texCoord;\\n\\n\\nuniform float u_opacity;\\nuniform sampler2D u_texture;\\n\\nvoid main(void) {\\n  vec4 texColor = texture2D(u_texture, v_texCoord);\\n  gl_FragColor.rgb = texColor.rgb;\\n  gl_FragColor.a = texColor.a * u_opacity;\\n}\\n' :\n  'precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  'varying vec2 v_texCoord;\\n\\n\\nattribute vec2 a_position;\\nattribute vec2 a_texCoord;\\n\\nuniform mat4 u_texCoordMatrix;\\nuniform mat4 u_projectionMatrix;\\n\\nvoid main(void) {\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\\n}\\n\\n\\n' :\n  'varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}');\n","/**\n * @module ol/renderer/webgl/defaultmapshader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_texCoordMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_texCoordMatrix' : 'd');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_projectionMatrix = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_projectionMatrix' : 'e');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_opacity = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_opacity' : 'f');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_texture = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_texture' : 'g');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'b');\n\n  /**\n   * @type {number}\n   */\n  this.a_texCoord = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_texCoord' : 'c');\n};\n\nexport default Locations;\n","/**\n * @module ol/renderer/webgl/Layer\n */\nimport {inherits} from '../../util.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport WebGLImmediateRenderer from '../../render/webgl/Immediate.js';\nimport LayerRenderer from '../Layer.js';\nimport {fragment, vertex} from '../webgl/defaultmapshader.js';\nimport Locations from '../webgl/defaultmapshader/Locations.js';\nimport {create as createTransform} from '../../transform.js';\nimport {create, fromTransform} from '../../vec/mat4.js';\nimport {ARRAY_BUFFER, FRAMEBUFFER, FLOAT, TEXTURE_2D,\n  TRIANGLE_STRIP, COLOR_ATTACHMENT0} from '../../webgl.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\nimport {createEmptyTexture} from '../../webgl/Context.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {module:ol/renderer/Layer}\n * @param {module:ol/renderer/webgl/Map} mapRenderer Map renderer.\n * @param {module:ol/layer/Layer} layer Layer.\n */\nconst WebGLLayerRenderer = function(mapRenderer, layer) {\n\n  LayerRenderer.call(this, layer);\n\n  /**\n   * @protected\n   * @type {module:ol/renderer/webgl/Map}\n   */\n  this.mapRenderer = mapRenderer;\n\n  /**\n   * @private\n   * @type {module:ol/webgl/Buffer}\n   */\n  this.arrayBuffer_ = new WebGLBuffer([\n    -1, -1, 0, 0,\n    1, -1, 1, 0,\n    -1, 1, 0, 1,\n    1, 1, 1, 1\n  ]);\n\n  /**\n   * @protected\n   * @type {WebGLTexture}\n   */\n  this.texture = null;\n\n  /**\n   * @protected\n   * @type {WebGLFramebuffer}\n   */\n  this.framebuffer = null;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.framebufferDimension = undefined;\n\n  /**\n   * @protected\n   * @type {module:ol/transform~Transform}\n   */\n  this.texCoordMatrix = createTransform();\n\n  /**\n   * @protected\n   * @type {module:ol/transform~Transform}\n   */\n  this.projectionMatrix = createTransform();\n\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n  this.tmpMat4_ = create();\n\n  /**\n   * @private\n   * @type {module:ol/renderer/webgl/defaultmapshader/Locations}\n   */\n  this.defaultLocations_ = null;\n\n};\n\ninherits(WebGLLayerRenderer, LayerRenderer);\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {number} framebufferDimension Framebuffer dimension.\n * @protected\n */\nWebGLLayerRenderer.prototype.bindFramebuffer = function(frameState, framebufferDimension) {\n\n  const gl = this.mapRenderer.getGL();\n\n  if (this.framebufferDimension === undefined ||\n      this.framebufferDimension != framebufferDimension) {\n    /**\n     * @param {WebGLRenderingContext} gl GL.\n     * @param {WebGLFramebuffer} framebuffer Framebuffer.\n     * @param {WebGLTexture} texture Texture.\n     */\n    const postRenderFunction = function(gl, framebuffer, texture) {\n      if (!gl.isContextLost()) {\n        gl.deleteFramebuffer(framebuffer);\n        gl.deleteTexture(texture);\n      }\n    }.bind(null, gl, this.framebuffer, this.texture);\n\n    frameState.postRenderFunctions.push(\n      /** @type {module:ol/PluggableMap~PostRenderFunction} */ (postRenderFunction)\n    );\n\n    const texture = createEmptyTexture(\n      gl, framebufferDimension, framebufferDimension);\n\n    const framebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(FRAMEBUFFER,\n      COLOR_ATTACHMENT0, TEXTURE_2D, texture, 0);\n\n    this.texture = texture;\n    this.framebuffer = framebuffer;\n    this.framebufferDimension = framebufferDimension;\n\n  } else {\n    gl.bindFramebuffer(FRAMEBUFFER, this.framebuffer);\n  }\n\n};\n\n\n/**\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {module:ol/webgl/Context} context Context.\n */\nWebGLLayerRenderer.prototype.composeFrame = function(frameState, layerState, context) {\n\n  this.dispatchComposeEvent_(RenderEventType.PRECOMPOSE, context, frameState);\n\n  context.bindBuffer(ARRAY_BUFFER, this.arrayBuffer_);\n\n  const gl = context.getGL();\n\n  const program = context.getProgram(fragment, vertex);\n\n  let locations;\n  if (!this.defaultLocations_) {\n    locations = new Locations(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  if (context.useProgram(program)) {\n    gl.enableVertexAttribArray(locations.a_position);\n    gl.vertexAttribPointer(\n      locations.a_position, 2, FLOAT, false, 16, 0);\n    gl.enableVertexAttribArray(locations.a_texCoord);\n    gl.vertexAttribPointer(\n      locations.a_texCoord, 2, FLOAT, false, 16, 8);\n    gl.uniform1i(locations.u_texture, 0);\n  }\n\n  gl.uniformMatrix4fv(locations.u_texCoordMatrix, false,\n    fromTransform(this.tmpMat4_, this.getTexCoordMatrix()));\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false,\n    fromTransform(this.tmpMat4_, this.getProjectionMatrix()));\n  gl.uniform1f(locations.u_opacity, layerState.opacity);\n  gl.bindTexture(TEXTURE_2D, this.getTexture());\n  gl.drawArrays(TRIANGLE_STRIP, 0, 4);\n\n  this.dispatchComposeEvent_(RenderEventType.POSTCOMPOSE, context, frameState);\n};\n\n\n/**\n * @param {module:ol/render/EventType} type Event type.\n * @param {module:ol/webgl/Context} context WebGL context.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @private\n */\nWebGLLayerRenderer.prototype.dispatchComposeEvent_ = function(type, context, frameState) {\n  const layer = this.getLayer();\n  if (layer.hasListener(type)) {\n    const viewState = frameState.viewState;\n    const resolution = viewState.resolution;\n    const pixelRatio = frameState.pixelRatio;\n    const extent = frameState.extent;\n    const center = viewState.center;\n    const rotation = viewState.rotation;\n    const size = frameState.size;\n\n    const render = new WebGLImmediateRenderer(\n      context, center, resolution, rotation, size, extent, pixelRatio);\n    const composeEvent = new RenderEvent(\n      type, render, frameState, null, context);\n    layer.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @return {!module:ol/transform~Transform} Matrix.\n */\nWebGLLayerRenderer.prototype.getTexCoordMatrix = function() {\n  return this.texCoordMatrix;\n};\n\n\n/**\n * @return {WebGLTexture} Texture.\n */\nWebGLLayerRenderer.prototype.getTexture = function() {\n  return this.texture;\n};\n\n\n/**\n * @return {!module:ol/transform~Transform} Matrix.\n */\nWebGLLayerRenderer.prototype.getProjectionMatrix = function() {\n  return this.projectionMatrix;\n};\n\n\n/**\n * Handle webglcontextlost.\n */\nWebGLLayerRenderer.prototype.handleWebGLContextLost = function() {\n  this.texture = null;\n  this.framebuffer = null;\n  this.framebufferDimension = undefined;\n};\n\n\n/**\n * @abstract\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @param {module:ol/layer/Layer~State} layerState Layer state.\n * @param {module:ol/webgl/Context} context Context.\n * @return {boolean} whether composeFrame should be called.\n */\nWebGLLayerRenderer.prototype.prepareFrame = function(frameState, layerState, context) {};\n\n\n/**\n * @abstract\n * @param {module:ol~Pixel} pixel Pixel.\n * @param {module:ol/PluggableMap~FrameState} frameState FrameState.\n * @param {function(this: S, module:ol/layer/Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\nWebGLLayerRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {};\nexport default WebGLLayerRenderer;\n","/**\n * @module ol/renderer/webgl/ImageLayer\n */\nimport {ENABLE_RASTER_REPROJECTION} from '../../reproj/common.js';\nimport {inherits} from '../../util.js';\nimport {TRUE, UNDEFINED} from '../../functions.js';\nimport LayerType from '../../LayerType.js';\nimport ViewHint from '../../ViewHint.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {getIntersection, isEmpty} from '../../extent.js';\nimport WebGLLayerRenderer from '../webgl/Layer.js';\nimport {\n  create as createTransform,\n  rotate as rotateTransform,\n  translate as translateTransform,\n  scale as scaleTransform,\n  reset as resetTransform,\n  apply as applyTransform,\n  invert as invertTransform,\n  multiply as multiplyTransform\n} from '../../transform.js';\nimport {CLAMP_TO_EDGE} from '../../webgl.js';\nimport {createTexture} from '../../webgl/Context.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/webgl/Layer}\n * @param {module:ol/renderer/webgl/Map} mapRenderer Map renderer.\n * @param {module:ol/layer/Image} imageLayer Tile layer.\n * @api\n */\nconst WebGLImageLayerRenderer = function(mapRenderer, imageLayer) {\n\n  WebGLLayerRenderer.call(this, mapRenderer, imageLayer);\n\n  /**\n   * The last rendered image.\n   * @private\n   * @type {?module:ol/ImageBase}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.hitCanvasContext_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/transform~Transform}\n   */\n  this.hitTransformationMatrix_ = null;\n\n};\n\ninherits(WebGLImageLayerRenderer, WebGLLayerRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nWebGLImageLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.IMAGE;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/webgl/ImageLayer} The layer renderer.\n */\nWebGLImageLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new WebGLImageLayerRenderer(\n    /** @type {module:ol/renderer/webgl/Map} */ (mapRenderer),\n    /** @type {module:ol/layer/Image} */ (layer)\n  );\n};\n\n\n/**\n * @param {module:ol/ImageBase} image Image.\n * @private\n * @return {WebGLTexture} Texture.\n */\nWebGLImageLayerRenderer.prototype.createTexture_ = function(image) {\n\n  // We meet the conditions to work with non-power of two textures.\n  // http://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\n  // http://learningwebgl.com/blog/?p=2101\n\n  const imageElement = image.getImage();\n  const gl = this.mapRenderer.getGL();\n\n  return createTexture(\n    gl, imageElement, CLAMP_TO_EDGE, CLAMP_TO_EDGE);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageLayerRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  const layer = this.getLayer();\n  const source = layer.getSource();\n  const resolution = frameState.viewState.resolution;\n  const rotation = frameState.viewState.rotation;\n  const skippedFeatureUids = frameState.skippedFeatureUids;\n  return source.forEachFeatureAtCoordinate(\n    coordinate, resolution, rotation, hitTolerance, skippedFeatureUids,\n\n    /**\n     * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n     * @return {?} Callback result.\n     */\n    function(feature) {\n      return callback.call(thisArg, feature, layer);\n    });\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageLayerRenderer.prototype.prepareFrame = function(frameState, layerState, context) {\n\n  const gl = this.mapRenderer.getGL();\n\n  const pixelRatio = frameState.pixelRatio;\n  const viewState = frameState.viewState;\n  const viewCenter = viewState.center;\n  const viewResolution = viewState.resolution;\n  const viewRotation = viewState.rotation;\n\n  let image = this.image_;\n  let texture = this.texture;\n  const imageLayer = /** @type {module:ol/layer/Image} */ (this.getLayer());\n  const imageSource = imageLayer.getSource();\n\n  const hints = frameState.viewHints;\n\n  let renderedExtent = frameState.extent;\n  if (layerState.extent !== undefined) {\n    renderedExtent = getIntersection(renderedExtent, layerState.extent);\n  }\n  if (!hints[ViewHint.ANIMATING] && !hints[ViewHint.INTERACTING] &&\n      !isEmpty(renderedExtent)) {\n    let projection = viewState.projection;\n    if (!ENABLE_RASTER_REPROJECTION) {\n      const sourceProjection = imageSource.getProjection();\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n    }\n    const image_ = imageSource.getImage(renderedExtent, viewResolution,\n      pixelRatio, projection);\n    if (image_) {\n      const loaded = this.loadImage(image_);\n      if (loaded) {\n        image = image_;\n        texture = this.createTexture_(image_);\n        if (this.texture) {\n          /**\n           * @param {WebGLRenderingContext} gl GL.\n           * @param {WebGLTexture} texture Texture.\n           */\n          const postRenderFunction = function(gl, texture) {\n            if (!gl.isContextLost()) {\n              gl.deleteTexture(texture);\n            }\n          }.bind(null, gl, this.texture);\n          frameState.postRenderFunctions.push(\n            /** @type {module:ol/PluggableMap~PostRenderFunction} */ (postRenderFunction)\n          );\n        }\n      }\n    }\n  }\n\n  if (image) {\n    const canvas = this.mapRenderer.getContext().getCanvas();\n\n    this.updateProjectionMatrix_(canvas.width, canvas.height,\n      pixelRatio, viewCenter, viewResolution, viewRotation,\n      image.getExtent());\n    this.hitTransformationMatrix_ = null;\n\n    // Translate and scale to flip the Y coord.\n    const texCoordMatrix = this.texCoordMatrix;\n    resetTransform(texCoordMatrix);\n    scaleTransform(texCoordMatrix, 1, -1);\n    translateTransform(texCoordMatrix, 0, -1);\n\n    this.image_ = image;\n    this.texture = texture;\n  }\n\n  return !!image;\n};\n\n\n/**\n * @param {number} canvasWidth Canvas width.\n * @param {number} canvasHeight Canvas height.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/coordinate~Coordinate} viewCenter View center.\n * @param {number} viewResolution View resolution.\n * @param {number} viewRotation View rotation.\n * @param {module:ol/extent~Extent} imageExtent Image extent.\n * @private\n */\nWebGLImageLayerRenderer.prototype.updateProjectionMatrix_ = function(canvasWidth, canvasHeight, pixelRatio,\n  viewCenter, viewResolution, viewRotation, imageExtent) {\n\n  const canvasExtentWidth = canvasWidth * viewResolution;\n  const canvasExtentHeight = canvasHeight * viewResolution;\n\n  const projectionMatrix = this.projectionMatrix;\n  resetTransform(projectionMatrix);\n  scaleTransform(projectionMatrix,\n    pixelRatio * 2 / canvasExtentWidth,\n    pixelRatio * 2 / canvasExtentHeight);\n  rotateTransform(projectionMatrix, -viewRotation);\n  translateTransform(projectionMatrix,\n    imageExtent[0] - viewCenter[0],\n    imageExtent[1] - viewCenter[1]);\n  scaleTransform(projectionMatrix,\n    (imageExtent[2] - imageExtent[0]) / 2,\n    (imageExtent[3] - imageExtent[1]) / 2);\n  translateTransform(projectionMatrix, 1, 1);\n\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageLayerRenderer.prototype.hasFeatureAtCoordinate = function(coordinate, frameState) {\n  const hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, 0, TRUE, this);\n  return hasFeature !== undefined;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLImageLayerRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {\n  if (!this.image_ || !this.image_.getImage()) {\n    return undefined;\n  }\n\n  if (this.getLayer().getSource().forEachFeatureAtCoordinate !== UNDEFINED) {\n    // for ImageCanvas sources use the original hit-detection logic,\n    // so that for example also transparent polygons are detected\n    const coordinate = applyTransform(\n      frameState.pixelToCoordinateTransform, pixel.slice());\n    const hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, 0, TRUE, this);\n\n    if (hasFeature) {\n      return callback.call(thisArg, this.getLayer(), null);\n    } else {\n      return undefined;\n    }\n  } else {\n    const imageSize =\n        [this.image_.getImage().width, this.image_.getImage().height];\n\n    if (!this.hitTransformationMatrix_) {\n      this.hitTransformationMatrix_ = this.getHitTransformationMatrix_(\n        frameState.size, imageSize);\n    }\n\n    const pixelOnFrameBuffer = applyTransform(\n      this.hitTransformationMatrix_, pixel.slice());\n\n    if (pixelOnFrameBuffer[0] < 0 || pixelOnFrameBuffer[0] > imageSize[0] ||\n        pixelOnFrameBuffer[1] < 0 || pixelOnFrameBuffer[1] > imageSize[1]) {\n      // outside the image, no need to check\n      return undefined;\n    }\n\n    if (!this.hitCanvasContext_) {\n      this.hitCanvasContext_ = createCanvasContext2D(1, 1);\n    }\n\n    this.hitCanvasContext_.clearRect(0, 0, 1, 1);\n    this.hitCanvasContext_.drawImage(this.image_.getImage(),\n      pixelOnFrameBuffer[0], pixelOnFrameBuffer[1], 1, 1, 0, 0, 1, 1);\n\n    const imageData = this.hitCanvasContext_.getImageData(0, 0, 1, 1).data;\n    if (imageData[3] > 0) {\n      return callback.call(thisArg, this.getLayer(),  imageData);\n    } else {\n      return undefined;\n    }\n  }\n};\n\n\n/**\n * The transformation matrix to get the pixel on the image for a\n * pixel on the map.\n * @param {module:ol/size~Size} mapSize The map size.\n * @param {module:ol/size~Size} imageSize The image size.\n * @return {module:ol/transform~Transform} The transformation matrix.\n * @private\n */\nWebGLImageLayerRenderer.prototype.getHitTransformationMatrix_ = function(mapSize, imageSize) {\n  // the first matrix takes a map pixel, flips the y-axis and scales to\n  // a range between -1 ... 1\n  const mapCoordTransform = createTransform();\n  translateTransform(mapCoordTransform, -1, -1);\n  scaleTransform(mapCoordTransform, 2 / mapSize[0], 2 / mapSize[1]);\n  translateTransform(mapCoordTransform, 0, mapSize[1]);\n  scaleTransform(mapCoordTransform, 1, -1);\n\n  // the second matrix is the inverse of the projection matrix used in the\n  // shader for drawing\n  const projectionMatrixInv = invertTransform(this.projectionMatrix.slice());\n\n  // the third matrix scales to the image dimensions and flips the y-axis again\n  const transform = createTransform();\n  translateTransform(transform, 0, imageSize[1]);\n  scaleTransform(transform, 1, -1);\n  scaleTransform(transform, imageSize[0] / 2, imageSize[1] / 2);\n  translateTransform(transform, 1, 1);\n\n  multiplyTransform(transform, projectionMatrixInv);\n  multiplyTransform(transform, mapCoordTransform);\n\n  return transform;\n};\nexport default WebGLImageLayerRenderer;\n","/**\n * @module ol/renderer/webgl/Map\n */\n\nimport {inherits} from '../../util.js';\nimport {stableSort} from '../../array.js';\nimport {CLASS_UNSELECTABLE} from '../../css.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {listen} from '../../events.js';\nimport {visibleAtResolution} from '../../layer/Layer.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport WebGLImmediateRenderer from '../../render/webgl/Immediate.js';\nimport MapRenderer, {sortByZIndex} from '../Map.js';\nimport SourceState from '../../source/State.js';\nimport LRUCache from '../../structs/LRUCache.js';\nimport PriorityQueue from '../../structs/PriorityQueue.js';\nimport {BLEND, CLAMP_TO_EDGE, COLOR_BUFFER_BIT, CULL_FACE, DEPTH_TEST, FRAMEBUFFER,\n  getContext, LINEAR, ONE, ONE_MINUS_SRC_ALPHA, RGBA, SCISSOR_TEST, SRC_ALPHA,\n  STENCIL_TEST, TEXTURE0, TEXTURE_2D, TEXTURE_MAG_FILTER, TEXTURE_MIN_FILTER,\n  TEXTURE_WRAP_S, TEXTURE_WRAP_T, UNSIGNED_BYTE} from '../../webgl.js';\nimport WebGLContext from '../../webgl/Context.js';\nimport ContextEventType from '../../webgl/ContextEventType.js';\n\n\n/**\n * @typedef {Object} TextureCacheEntry\n * @property {number} magFilter\n * @property {number} minFilter\n * @property {WebGLTexture} texture\n */\n\n\n/**\n * Texture cache high water mark.\n * @type {number}\n */\nconst WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK = 1024;\n\n\n/**\n * @constructor\n * @extends {module:ol/renderer/Map}\n * @param {module:ol/PluggableMap} map Map.\n * @api\n */\nconst WebGLMapRenderer = function(map) {\n  MapRenderer.call(this, map);\n\n  const container = map.getViewport();\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = /** @type {HTMLCanvasElement} */\n    (document.createElement('CANVAS'));\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.clipTileCanvasWidth_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.clipTileCanvasHeight_ = 0;\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.clipTileContext_ = createCanvasContext2D();\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = true;\n\n  /**\n   * @private\n   * @type {WebGLRenderingContext}\n   */\n  this.gl_ = getContext(this.canvas_, {\n    antialias: true,\n    depth: true,\n    failIfMajorPerformanceCaveat: true,\n    preserveDrawingBuffer: false,\n    stencil: true\n  });\n\n  /**\n   * @private\n   * @type {module:ol/webgl/Context}\n   */\n  this.context_ = new WebGLContext(this.canvas_, this.gl_);\n\n  listen(this.canvas_, ContextEventType.LOST,\n    this.handleWebGLContextLost, this);\n  listen(this.canvas_, ContextEventType.RESTORED,\n    this.handleWebGLContextRestored, this);\n\n  /**\n   * @private\n   * @type {module:ol/structs/LRUCache.<module:ol/renderer/webgl/Map~TextureCacheEntry|null>}\n   */\n  this.textureCache_ = new LRUCache();\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.focus_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/structs/PriorityQueue.<Array>}\n   */\n  this.tileTextureQueue_ = new PriorityQueue(\n    /**\n     * @param {Array.<*>} element Element.\n     * @return {number} Priority.\n     * @this {module:ol/renderer/webgl/Map}\n     */\n    (function(element) {\n      const tileCenter = /** @type {module:ol/coordinate~Coordinate} */ (element[1]);\n      const tileResolution = /** @type {number} */ (element[2]);\n      const deltaX = tileCenter[0] - this.focus_[0];\n      const deltaY = tileCenter[1] - this.focus_[1];\n      return 65536 * Math.log(tileResolution) +\n            Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n    }).bind(this),\n    /**\n     * @param {Array.<*>} element Element.\n     * @return {string} Key.\n     */\n    function(element) {\n      return (\n        /** @type {module:ol/Tile} */ (element[0]).getKey()\n      );\n    });\n\n\n  /**\n   * @param {module:ol/PluggableMap} map Map.\n   * @param {?module:ol/PluggableMap~FrameState} frameState Frame state.\n   * @return {boolean} false.\n   * @this {module:ol/renderer/webgl/Map}\n   */\n  this.loadNextTileTexture_ =\n      function(map, frameState) {\n        if (!this.tileTextureQueue_.isEmpty()) {\n          this.tileTextureQueue_.reprioritize();\n          const element = this.tileTextureQueue_.dequeue();\n          const tile = /** @type {module:ol/Tile} */ (element[0]);\n          const tileSize = /** @type {module:ol/size~Size} */ (element[3]);\n          const tileGutter = /** @type {number} */ (element[4]);\n          this.bindTileTexture(\n            tile, tileSize, tileGutter, LINEAR, LINEAR);\n        }\n        return false;\n      }.bind(this);\n\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textureCacheFrameMarkerCount_ = 0;\n\n  this.initializeGL_();\n};\n\ninherits(WebGLMapRenderer, MapRenderer);\n\n\n/**\n * @param {module:ol/Tile} tile Tile.\n * @param {module:ol/size~Size} tileSize Tile size.\n * @param {number} tileGutter Tile gutter.\n * @param {number} magFilter Mag filter.\n * @param {number} minFilter Min filter.\n */\nWebGLMapRenderer.prototype.bindTileTexture = function(tile, tileSize, tileGutter, magFilter, minFilter) {\n  const gl = this.getGL();\n  const tileKey = tile.getKey();\n  if (this.textureCache_.containsKey(tileKey)) {\n    const textureCacheEntry = this.textureCache_.get(tileKey);\n    gl.bindTexture(TEXTURE_2D, textureCacheEntry.texture);\n    if (textureCacheEntry.magFilter != magFilter) {\n      gl.texParameteri(\n        TEXTURE_2D, TEXTURE_MAG_FILTER, magFilter);\n      textureCacheEntry.magFilter = magFilter;\n    }\n    if (textureCacheEntry.minFilter != minFilter) {\n      gl.texParameteri(\n        TEXTURE_2D, TEXTURE_MIN_FILTER, minFilter);\n      textureCacheEntry.minFilter = minFilter;\n    }\n  } else {\n    const texture = gl.createTexture();\n    gl.bindTexture(TEXTURE_2D, texture);\n    if (tileGutter > 0) {\n      const clipTileCanvas = this.clipTileContext_.canvas;\n      const clipTileContext = this.clipTileContext_;\n      if (this.clipTileCanvasWidth_ !== tileSize[0] ||\n          this.clipTileCanvasHeight_ !== tileSize[1]) {\n        clipTileCanvas.width = tileSize[0];\n        clipTileCanvas.height = tileSize[1];\n        this.clipTileCanvasWidth_ = tileSize[0];\n        this.clipTileCanvasHeight_ = tileSize[1];\n      } else {\n        clipTileContext.clearRect(0, 0, tileSize[0], tileSize[1]);\n      }\n      clipTileContext.drawImage(tile.getImage(), tileGutter, tileGutter,\n        tileSize[0], tileSize[1], 0, 0, tileSize[0], tileSize[1]);\n      gl.texImage2D(TEXTURE_2D, 0,\n        RGBA, RGBA,\n        UNSIGNED_BYTE, clipTileCanvas);\n    } else {\n      gl.texImage2D(TEXTURE_2D, 0,\n        RGBA, RGBA,\n        UNSIGNED_BYTE, tile.getImage());\n    }\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_MAG_FILTER, magFilter);\n    gl.texParameteri(\n      TEXTURE_2D, TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(TEXTURE_2D, TEXTURE_WRAP_S,\n      CLAMP_TO_EDGE);\n    gl.texParameteri(TEXTURE_2D, TEXTURE_WRAP_T,\n      CLAMP_TO_EDGE);\n    this.textureCache_.set(tileKey, {\n      texture: texture,\n      magFilter: magFilter,\n      minFilter: minFilter\n    });\n  }\n};\n\n\n/**\n * @param {module:ol/render/EventType} type Event type.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @private\n */\nWebGLMapRenderer.prototype.dispatchComposeEvent_ = function(type, frameState) {\n  const map = this.getMap();\n  if (map.hasListener(type)) {\n    const context = this.context_;\n\n    const extent = frameState.extent;\n    const size = frameState.size;\n    const viewState = frameState.viewState;\n    const pixelRatio = frameState.pixelRatio;\n\n    const resolution = viewState.resolution;\n    const center = viewState.center;\n    const rotation = viewState.rotation;\n\n    const vectorContext = new WebGLImmediateRenderer(context,\n      center, resolution, rotation, size, extent, pixelRatio);\n    const composeEvent = new RenderEvent(type, vectorContext,\n      frameState, null, context);\n    map.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLMapRenderer.prototype.disposeInternal = function() {\n  const gl = this.getGL();\n  if (!gl.isContextLost()) {\n    this.textureCache_.forEach(\n      /**\n       * @param {?module:ol/renderer/webgl/Map~TextureCacheEntry} textureCacheEntry\n       *     Texture cache entry.\n       */\n      function(textureCacheEntry) {\n        if (textureCacheEntry) {\n          gl.deleteTexture(textureCacheEntry.texture);\n        }\n      });\n  }\n  this.context_.dispose();\n  MapRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @param {module:ol/PluggableMap} map Map.\n * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\n * @private\n */\nWebGLMapRenderer.prototype.expireCache_ = function(map, frameState) {\n  const gl = this.getGL();\n  let textureCacheEntry;\n  while (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ >\n      WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    textureCacheEntry = this.textureCache_.peekLast();\n    if (!textureCacheEntry) {\n      if (+this.textureCache_.peekLastKey() == frameState.index) {\n        break;\n      } else {\n        --this.textureCacheFrameMarkerCount_;\n      }\n    } else {\n      gl.deleteTexture(textureCacheEntry.texture);\n    }\n    this.textureCache_.pop();\n  }\n};\n\n\n/**\n * @return {module:ol/webgl/Context} The context.\n */\nWebGLMapRenderer.prototype.getContext = function() {\n  return this.context_;\n};\n\n\n/**\n * @return {WebGLRenderingContext} GL.\n */\nWebGLMapRenderer.prototype.getGL = function() {\n  return this.gl_;\n};\n\n\n/**\n * @return {module:ol/structs/PriorityQueue.<Array>} Tile texture queue.\n */\nWebGLMapRenderer.prototype.getTileTextureQueue = function() {\n  return this.tileTextureQueue_;\n};\n\n\n/**\n * @param {module:ol/events/Event} event Event.\n * @protected\n */\nWebGLMapRenderer.prototype.handleWebGLContextLost = function(event) {\n  event.preventDefault();\n  this.textureCache_.clear();\n  this.textureCacheFrameMarkerCount_ = 0;\n\n  const renderers = this.getLayerRenderers();\n  for (const id in renderers) {\n    const renderer = /** @type {module:ol/renderer/webgl/Layer} */ (renderers[id]);\n    renderer.handleWebGLContextLost();\n  }\n};\n\n\n/**\n * @protected\n */\nWebGLMapRenderer.prototype.handleWebGLContextRestored = function() {\n  this.initializeGL_();\n  this.getMap().render();\n};\n\n\n/**\n * @private\n */\nWebGLMapRenderer.prototype.initializeGL_ = function() {\n  const gl = this.gl_;\n  gl.activeTexture(TEXTURE0);\n  gl.blendFuncSeparate(\n    SRC_ALPHA, ONE_MINUS_SRC_ALPHA,\n    ONE, ONE_MINUS_SRC_ALPHA);\n  gl.disable(CULL_FACE);\n  gl.disable(DEPTH_TEST);\n  gl.disable(SCISSOR_TEST);\n  gl.disable(STENCIL_TEST);\n};\n\n\n/**\n * @param {module:ol/Tile} tile Tile.\n * @return {boolean} Is tile texture loaded.\n */\nWebGLMapRenderer.prototype.isTileTextureLoaded = function(tile) {\n  return this.textureCache_.containsKey(tile.getKey());\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLMapRenderer.prototype.renderFrame = function(frameState) {\n\n  const context = this.getContext();\n  const gl = this.getGL();\n\n  if (gl.isContextLost()) {\n    return false;\n  }\n\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return false;\n  }\n\n  this.focus_ = frameState.focus;\n\n  this.textureCache_.set((-frameState.index).toString(), null);\n  ++this.textureCacheFrameMarkerCount_;\n\n  this.dispatchComposeEvent_(RenderEventType.PRECOMPOSE, frameState);\n\n  /** @type {Array.<module:ol/layer/Layer~State>} */\n  const layerStatesToDraw = [];\n  const layerStatesArray = frameState.layerStatesArray;\n  stableSort(layerStatesArray, sortByZIndex);\n\n  const viewResolution = frameState.viewState.resolution;\n  let i, ii, layerRenderer, layerState;\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n    if (visibleAtResolution(layerState, viewResolution) &&\n        layerState.sourceState == SourceState.READY) {\n      layerRenderer = /** @type {module:ol/renderer/webgl/Layer} */ (this.getLayerRenderer(layerState.layer));\n      if (layerRenderer.prepareFrame(frameState, layerState, context)) {\n        layerStatesToDraw.push(layerState);\n      }\n    }\n  }\n\n  const width = frameState.size[0] * frameState.pixelRatio;\n  const height = frameState.size[1] * frameState.pixelRatio;\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  }\n\n  gl.bindFramebuffer(FRAMEBUFFER, null);\n\n  gl.clearColor(0, 0, 0, 0);\n  gl.clear(COLOR_BUFFER_BIT);\n  gl.enable(BLEND);\n  gl.viewport(0, 0, this.canvas_.width, this.canvas_.height);\n\n  for (i = 0, ii = layerStatesToDraw.length; i < ii; ++i) {\n    layerState = layerStatesToDraw[i];\n    layerRenderer = /** @type {module:ol/renderer/webgl/Layer} */ (this.getLayerRenderer(layerState.layer));\n    layerRenderer.composeFrame(frameState, layerState, context);\n  }\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.calculateMatrices2D(frameState);\n\n  if (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ >\n      WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    frameState.postRenderFunctions.push(\n      /** @type {module:ol/PluggableMap~PostRenderFunction} */ (this.expireCache_.bind(this))\n    );\n  }\n\n  if (!this.tileTextureQueue_.isEmpty()) {\n    frameState.postRenderFunctions.push(this.loadNextTileTexture_);\n    frameState.animate = true;\n  }\n\n  this.dispatchComposeEvent_(RenderEventType.POSTCOMPOSE, frameState);\n\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLMapRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg,\n  layerFilter, thisArg2) {\n  let result;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  const viewState = frameState.viewState;\n\n  const layerStates = frameState.layerStatesArray;\n  const numLayers = layerStates.length;\n  let i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    const layerState = layerStates[i];\n    const layer = layerState.layer;\n    if (visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg2, layer)) {\n      const layerRenderer = this.getLayerRenderer(layer);\n      result = layerRenderer.forEachFeatureAtCoordinate(\n        coordinate, frameState, hitTolerance, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLMapRenderer.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  let hasFeature = false;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  const viewState = frameState.viewState;\n\n  const layerStates = frameState.layerStatesArray;\n  const numLayers = layerStates.length;\n  let i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    const layerState = layerStates[i];\n    const layer = layerState.layer;\n    if (visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg, layer)) {\n      const layerRenderer = this.getLayerRenderer(layer);\n      hasFeature =\n          layerRenderer.hasFeatureAtCoordinate(coordinate, frameState);\n      if (hasFeature) {\n        return true;\n      }\n    }\n  }\n  return hasFeature;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLMapRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, hitTolerance, callback, thisArg,\n  layerFilter, thisArg2) {\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  const viewState = frameState.viewState;\n  let result;\n\n  const layerStates = frameState.layerStatesArray;\n  const numLayers = layerStates.length;\n  let i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    const layerState = layerStates[i];\n    const layer = layerState.layer;\n    if (visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg, layer)) {\n      const layerRenderer = /** @type {module:ol/renderer/webgl/Layer} */ (this.getLayerRenderer(layer));\n      result = layerRenderer.forEachLayerAtPixel(\n        pixel, frameState, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\nexport default WebGLMapRenderer;\n","/**\n * @module ol/renderer/webgl/tilelayershader\n */\n// This file is automatically generated, do not edit.\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../webgl.js';\nimport WebGLFragment from '../../webgl/Fragment.js';\nimport WebGLVertex from '../../webgl/Vertex.js';\n\nexport const fragment = new WebGLFragment(DEBUG_WEBGL ?\n  'precision mediump float;\\nvarying vec2 v_texCoord;\\n\\n\\nuniform sampler2D u_texture;\\n\\nvoid main(void) {\\n  gl_FragColor = texture2D(u_texture, v_texCoord);\\n}\\n' :\n  'precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}');\n\nexport const vertex = new WebGLVertex(DEBUG_WEBGL ?\n  'varying vec2 v_texCoord;\\n\\n\\nattribute vec2 a_position;\\nattribute vec2 a_texCoord;\\nuniform vec4 u_tileOffset;\\n\\nvoid main(void) {\\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\\n  v_texCoord = a_texCoord;\\n}\\n\\n\\n' :\n  'varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}');\n","/**\n * @module ol/renderer/webgl/tilelayershader/Locations\n */\n// This file is automatically generated, do not edit\n// Run `make shaders` to generate, and commit the result.\n\nimport {DEBUG as DEBUG_WEBGL} from '../../../webgl.js';\n\n/**\n * @constructor\n * @param {WebGLRenderingContext} gl GL.\n * @param {WebGLProgram} program Program.\n * @struct\n */\nconst Locations = function(gl, program) {\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_tileOffset = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_tileOffset' : 'd');\n\n  /**\n   * @type {WebGLUniformLocation}\n   */\n  this.u_texture = gl.getUniformLocation(\n    program, DEBUG_WEBGL ? 'u_texture' : 'e');\n\n  /**\n   * @type {number}\n   */\n  this.a_position = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_position' : 'b');\n\n  /**\n   * @type {number}\n   */\n  this.a_texCoord = gl.getAttribLocation(\n    program, DEBUG_WEBGL ? 'a_texCoord' : 'c');\n};\n\nexport default Locations;\n","/**\n * @module ol/renderer/webgl/TileLayer\n */\n// FIXME large resolutions lead to too large framebuffers :-(\n// FIXME animated shaders! check in redraw\n\nimport {inherits} from '../../util.js';\nimport LayerType from '../../LayerType.js';\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport {numberSafeCompareFunction} from '../../array.js';\nimport {createEmpty, intersects} from '../../extent.js';\nimport {roundUpToPowerOfTwo} from '../../math.js';\nimport WebGLLayerRenderer from '../webgl/Layer.js';\nimport {fragment, vertex} from '../webgl/tilelayershader.js';\nimport Locations from '../webgl/tilelayershader/Locations.js';\nimport {toSize} from '../../size.js';\nimport {\n  reset as resetTransform,\n  rotate as rotateTransform,\n  scale as scaleTransform,\n  translate as translateTransform,\n  apply as applyTransform\n} from '../../transform.js';\nimport {COLOR_BUFFER_BIT, BLEND, ARRAY_BUFFER, FLOAT, LINEAR, TRIANGLE_STRIP} from '../../webgl.js';\nimport WebGLBuffer from '../../webgl/Buffer.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/webgl/Layer}\n * @param {module:ol/renderer/webgl/Map} mapRenderer Map renderer.\n * @param {module:ol/layer/Tile} tileLayer Tile layer.\n * @api\n */\nconst WebGLTileLayerRenderer = function(mapRenderer, tileLayer) {\n\n  WebGLLayerRenderer.call(this, mapRenderer, tileLayer);\n\n  /**\n   * @private\n   * @type {module:ol/webgl/Fragment}\n   */\n  this.fragmentShader_ = fragment;\n\n  /**\n   * @private\n   * @type {module:ol/webgl/Vertex}\n   */\n  this.vertexShader_ = vertex;\n\n  /**\n   * @private\n   * @type {module:ol/renderer/webgl/tilelayershader/Locations}\n   */\n  this.locations_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/webgl/Buffer}\n   */\n  this.renderArrayBuffer_ = new WebGLBuffer([\n    0, 0, 0, 1,\n    1, 0, 1, 1,\n    0, 1, 0, 0,\n    1, 1, 1, 0\n  ]);\n\n  /**\n   * @private\n   * @type {module:ol/TileRange}\n   */\n  this.renderedTileRange_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.renderedFramebufferExtent_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.tmpSize_ = [0, 0];\n\n};\n\ninherits(WebGLTileLayerRenderer, WebGLLayerRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nWebGLTileLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.TILE;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/webgl/TileLayer} The layer renderer.\n */\nWebGLTileLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new WebGLTileLayerRenderer(\n    /** @type {module:ol/renderer/webgl/Map} */ (mapRenderer),\n    /** @type {module:ol/layer/Tile} */ (layer)\n  );\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTileLayerRenderer.prototype.disposeInternal = function() {\n  const context = this.mapRenderer.getContext();\n  context.deleteBuffer(this.renderArrayBuffer_);\n  WebGLLayerRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTileLayerRenderer.prototype.createLoadedTileFinder = function(source, projection, tiles) {\n  const mapRenderer = this.mapRenderer;\n\n  return (\n    /**\n     * @param {number} zoom Zoom level.\n     * @param {module:ol/TileRange} tileRange Tile range.\n     * @return {boolean} The tile range is fully loaded.\n     */\n    function(zoom, tileRange) {\n      function callback(tile) {\n        const loaded = mapRenderer.isTileTextureLoaded(tile);\n        if (loaded) {\n          if (!tiles[zoom]) {\n            tiles[zoom] = {};\n          }\n          tiles[zoom][tile.tileCoord.toString()] = tile;\n        }\n        return loaded;\n      }\n      return source.forEachLoadedTile(projection, zoom, tileRange, callback);\n    }\n  );\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTileLayerRenderer.prototype.handleWebGLContextLost = function() {\n  WebGLLayerRenderer.prototype.handleWebGLContextLost.call(this);\n  this.locations_ = null;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTileLayerRenderer.prototype.prepareFrame = function(frameState, layerState, context) {\n\n  const mapRenderer = this.mapRenderer;\n  const gl = context.getGL();\n\n  const viewState = frameState.viewState;\n  const projection = viewState.projection;\n\n  const tileLayer = /** @type {module:ol/layer/Tile} */ (this.getLayer());\n  const tileSource = tileLayer.getSource();\n  const tileGrid = tileSource.getTileGridForProjection(projection);\n  const z = tileGrid.getZForResolution(viewState.resolution);\n  const tileResolution = tileGrid.getResolution(z);\n\n  const tilePixelSize =\n      tileSource.getTilePixelSize(z, frameState.pixelRatio, projection);\n  const pixelRatio = tilePixelSize[0] /\n      toSize(tileGrid.getTileSize(z), this.tmpSize_)[0];\n  const tilePixelResolution = tileResolution / pixelRatio;\n  const tileGutter = tileSource.getTilePixelRatio(pixelRatio) * tileSource.getGutter(projection);\n\n  const center = viewState.center;\n  const extent = frameState.extent;\n  const tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n\n  let framebufferExtent;\n  if (this.renderedTileRange_ &&\n      this.renderedTileRange_.equals(tileRange) &&\n      this.renderedRevision_ == tileSource.getRevision()) {\n    framebufferExtent = this.renderedFramebufferExtent_;\n  } else {\n\n    const tileRangeSize = tileRange.getSize();\n\n    const maxDimension = Math.max(\n      tileRangeSize[0] * tilePixelSize[0],\n      tileRangeSize[1] * tilePixelSize[1]);\n    const framebufferDimension = roundUpToPowerOfTwo(maxDimension);\n    const framebufferExtentDimension = tilePixelResolution * framebufferDimension;\n    const origin = tileGrid.getOrigin(z);\n    const minX = origin[0] +\n        tileRange.minX * tilePixelSize[0] * tilePixelResolution;\n    const minY = origin[1] +\n        tileRange.minY * tilePixelSize[1] * tilePixelResolution;\n    framebufferExtent = [\n      minX, minY,\n      minX + framebufferExtentDimension, minY + framebufferExtentDimension\n    ];\n\n    this.bindFramebuffer(frameState, framebufferDimension);\n    gl.viewport(0, 0, framebufferDimension, framebufferDimension);\n\n    gl.clearColor(0, 0, 0, 0);\n    gl.clear(COLOR_BUFFER_BIT);\n    gl.disable(BLEND);\n\n    const program = context.getProgram(this.fragmentShader_, this.vertexShader_);\n    context.useProgram(program);\n    if (!this.locations_) {\n      this.locations_ = new Locations(gl, program);\n    }\n\n    context.bindBuffer(ARRAY_BUFFER, this.renderArrayBuffer_);\n    gl.enableVertexAttribArray(this.locations_.a_position);\n    gl.vertexAttribPointer(\n      this.locations_.a_position, 2, FLOAT, false, 16, 0);\n    gl.enableVertexAttribArray(this.locations_.a_texCoord);\n    gl.vertexAttribPointer(\n      this.locations_.a_texCoord, 2, FLOAT, false, 16, 8);\n    gl.uniform1i(this.locations_.u_texture, 0);\n\n    /**\n     * @type {Object.<number, Object.<string, module:ol/Tile>>}\n     */\n    const tilesToDrawByZ = {};\n    tilesToDrawByZ[z] = {};\n\n    const findLoadedTiles = this.createLoadedTileFinder(\n      tileSource, projection, tilesToDrawByZ);\n\n    const useInterimTilesOnError = tileLayer.getUseInterimTilesOnError();\n    let allTilesLoaded = true;\n    const tmpExtent = createEmpty();\n    const tmpTileRange = new TileRange(0, 0, 0, 0);\n    let childTileRange, drawable, fullyLoaded, tile, tileState;\n    let x, y, tileExtent;\n    for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\n      for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\n\n        tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n        if (layerState.extent !== undefined) {\n          // ignore tiles outside layer extent\n          tileExtent = tileGrid.getTileCoordExtent(tile.tileCoord, tmpExtent);\n          if (!intersects(tileExtent, layerState.extent)) {\n            continue;\n          }\n        }\n        tileState = tile.getState();\n        drawable = tileState == TileState.LOADED ||\n            tileState == TileState.EMPTY ||\n            tileState == TileState.ERROR && !useInterimTilesOnError;\n        if (!drawable) {\n          tile = tile.getInterimTile();\n        }\n        tileState = tile.getState();\n        if (tileState == TileState.LOADED) {\n          if (mapRenderer.isTileTextureLoaded(tile)) {\n            tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;\n            continue;\n          }\n        } else if (tileState == TileState.EMPTY ||\n                   (tileState == TileState.ERROR &&\n                    !useInterimTilesOnError)) {\n          continue;\n        }\n\n        allTilesLoaded = false;\n        fullyLoaded = tileGrid.forEachTileCoordParentTileRange(\n          tile.tileCoord, findLoadedTiles, null, tmpTileRange, tmpExtent);\n        if (!fullyLoaded) {\n          childTileRange = tileGrid.getTileCoordChildTileRange(\n            tile.tileCoord, tmpTileRange, tmpExtent);\n          if (childTileRange) {\n            findLoadedTiles(z + 1, childTileRange);\n          }\n        }\n\n      }\n\n    }\n\n    /** @type {Array.<number>} */\n    const zs = Object.keys(tilesToDrawByZ).map(Number);\n    zs.sort(numberSafeCompareFunction);\n    const u_tileOffset = new Float32Array(4);\n    for (let i = 0, ii = zs.length; i < ii; ++i) {\n      const tilesToDraw = tilesToDrawByZ[zs[i]];\n      for (const tileKey in tilesToDraw) {\n        tile = tilesToDraw[tileKey];\n        tileExtent = tileGrid.getTileCoordExtent(tile.tileCoord, tmpExtent);\n        u_tileOffset[0] = 2 * (tileExtent[2] - tileExtent[0]) /\n            framebufferExtentDimension;\n        u_tileOffset[1] = 2 * (tileExtent[3] - tileExtent[1]) /\n            framebufferExtentDimension;\n        u_tileOffset[2] = 2 * (tileExtent[0] - framebufferExtent[0]) /\n            framebufferExtentDimension - 1;\n        u_tileOffset[3] = 2 * (tileExtent[1] - framebufferExtent[1]) /\n            framebufferExtentDimension - 1;\n        gl.uniform4fv(this.locations_.u_tileOffset, u_tileOffset);\n        mapRenderer.bindTileTexture(tile, tilePixelSize,\n          tileGutter * pixelRatio, LINEAR, LINEAR);\n        gl.drawArrays(TRIANGLE_STRIP, 0, 4);\n      }\n    }\n\n    if (allTilesLoaded) {\n      this.renderedTileRange_ = tileRange;\n      this.renderedFramebufferExtent_ = framebufferExtent;\n      this.renderedRevision_ = tileSource.getRevision();\n    } else {\n      this.renderedTileRange_ = null;\n      this.renderedFramebufferExtent_ = null;\n      this.renderedRevision_ = -1;\n      frameState.animate = true;\n    }\n\n  }\n\n  this.updateUsedTiles(frameState.usedTiles, tileSource, z, tileRange);\n  const tileTextureQueue = mapRenderer.getTileTextureQueue();\n  this.manageTilePyramid(\n    frameState, tileSource, tileGrid, pixelRatio, projection, extent, z,\n    tileLayer.getPreload(),\n    /**\n     * @param {module:ol/Tile} tile Tile.\n     */\n    function(tile) {\n      if (tile.getState() == TileState.LOADED &&\n            !mapRenderer.isTileTextureLoaded(tile) &&\n            !tileTextureQueue.isKeyQueued(tile.getKey())) {\n        tileTextureQueue.enqueue([\n          tile,\n          tileGrid.getTileCoordCenter(tile.tileCoord),\n          tileGrid.getResolution(tile.tileCoord[0]),\n          tilePixelSize, tileGutter * pixelRatio\n        ]);\n      }\n    }, this);\n  this.scheduleExpireCache(frameState, tileSource);\n\n  const texCoordMatrix = this.texCoordMatrix;\n  resetTransform(texCoordMatrix);\n  translateTransform(texCoordMatrix,\n    (Math.round(center[0] / tileResolution) * tileResolution - framebufferExtent[0]) /\n          (framebufferExtent[2] - framebufferExtent[0]),\n    (Math.round(center[1] / tileResolution) * tileResolution - framebufferExtent[1]) /\n          (framebufferExtent[3] - framebufferExtent[1]));\n  if (viewState.rotation !== 0) {\n    rotateTransform(texCoordMatrix, viewState.rotation);\n  }\n  scaleTransform(texCoordMatrix,\n    frameState.size[0] * viewState.resolution /\n          (framebufferExtent[2] - framebufferExtent[0]),\n    frameState.size[1] * viewState.resolution /\n          (framebufferExtent[3] - framebufferExtent[1]));\n  translateTransform(texCoordMatrix, -0.5, -0.5);\n\n  return true;\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLTileLayerRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {\n  if (!this.framebuffer) {\n    return undefined;\n  }\n\n  const pixelOnMapScaled = [\n    pixel[0] / frameState.size[0],\n    (frameState.size[1] - pixel[1]) / frameState.size[1]];\n\n  const pixelOnFrameBufferScaled = applyTransform(\n    this.texCoordMatrix, pixelOnMapScaled.slice());\n  const pixelOnFrameBuffer = [\n    pixelOnFrameBufferScaled[0] * this.framebufferDimension,\n    pixelOnFrameBufferScaled[1] * this.framebufferDimension];\n\n  const gl = this.mapRenderer.getContext().getGL();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n  const imageData = new Uint8Array(4);\n  gl.readPixels(pixelOnFrameBuffer[0], pixelOnFrameBuffer[1], 1, 1,\n    gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n\n  if (imageData[3] > 0) {\n    return callback.call(thisArg, this.getLayer(), imageData);\n  } else {\n    return undefined;\n  }\n};\nexport default WebGLTileLayerRenderer;\n","/**\n * @module ol/renderer/webgl/VectorLayer\n */\nimport {getUid, inherits} from '../../util.js';\nimport LayerType from '../../LayerType.js';\nimport ViewHint from '../../ViewHint.js';\nimport {buffer, containsExtent, createEmpty} from '../../extent.js';\nimport WebGLReplayGroup from '../../render/webgl/ReplayGroup.js';\nimport {defaultOrder as defaultRenderOrder, getTolerance as getRenderTolerance, getSquaredTolerance as getSquaredRenderTolerance, renderFeature} from '../vector.js';\nimport WebGLLayerRenderer from '../webgl/Layer.js';\nimport {apply as applyTransform} from '../../transform.js';\n\n/**\n * @constructor\n * @extends {module:ol/renderer/webgl/Layer}\n * @param {module:ol/renderer/webgl/Map} mapRenderer Map renderer.\n * @param {module:ol/layer/Vector} vectorLayer Vector layer.\n * @api\n */\nconst WebGLVectorLayerRenderer = function(mapRenderer, vectorLayer) {\n\n  WebGLLayerRenderer.call(this, mapRenderer, vectorLayer);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.dirty_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedResolution_ = NaN;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.renderedExtent_ = createEmpty();\n\n  /**\n   * @private\n   * @type {function(module:ol/Feature, module:ol/Feature): number|null}\n   */\n  this.renderedRenderOrder_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/render/webgl/ReplayGroup}\n   */\n  this.replayGroup_ = null;\n\n  /**\n   * The last layer state.\n   * @private\n   * @type {?module:ol/layer/Layer~State}\n   */\n  this.layerState_ = null;\n\n};\n\ninherits(WebGLVectorLayerRenderer, WebGLLayerRenderer);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {module:ol/layer/Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\nWebGLVectorLayerRenderer['handles'] = function(layer) {\n  return layer.getType() === LayerType.VECTOR;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\n * @return {module:ol/renderer/webgl/VectorLayer} The layer renderer.\n */\nWebGLVectorLayerRenderer['create'] = function(mapRenderer, layer) {\n  return new WebGLVectorLayerRenderer(\n    /** @type {module:ol/renderer/webgl/Map} */ (mapRenderer),\n    /** @type {module:ol/layer/Vector} */ (layer)\n  );\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.composeFrame = function(frameState, layerState, context) {\n  this.layerState_ = layerState;\n  const viewState = frameState.viewState;\n  const replayGroup = this.replayGroup_;\n  const size = frameState.size;\n  const pixelRatio = frameState.pixelRatio;\n  const gl = this.mapRenderer.getGL();\n  if (replayGroup && !replayGroup.isEmpty()) {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(0, 0, size[0] * pixelRatio, size[1] * pixelRatio);\n    replayGroup.replay(context,\n      viewState.center, viewState.resolution, viewState.rotation,\n      size, pixelRatio, layerState.opacity,\n      layerState.managed ? frameState.skippedFeatureUids : {});\n    gl.disable(gl.SCISSOR_TEST);\n  }\n\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.disposeInternal = function() {\n  const replayGroup = this.replayGroup_;\n  if (replayGroup) {\n    const context = this.mapRenderer.getContext();\n    replayGroup.getDeleteResourcesFunction(context)();\n    this.replayGroup_ = null;\n  }\n  WebGLLayerRenderer.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return undefined;\n  } else {\n    const context = this.mapRenderer.getContext();\n    const viewState = frameState.viewState;\n    const layer = this.getLayer();\n    const layerState = this.layerState_;\n    /** @type {!Object.<string, boolean>} */\n    const features = {};\n    return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,\n      context, viewState.center, viewState.resolution, viewState.rotation,\n      frameState.size, frameState.pixelRatio, layerState.opacity,\n      {},\n      /**\n       * @param {module:ol/Feature|module:ol/render/Feature} feature Feature.\n       * @return {?} Callback result.\n       */\n      function(feature) {\n        const key = getUid(feature).toString();\n        if (!(key in features)) {\n          features[key] = true;\n          return callback.call(thisArg, feature, layer);\n        }\n      });\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.hasFeatureAtCoordinate = function(coordinate, frameState) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return false;\n  } else {\n    const context = this.mapRenderer.getContext();\n    const viewState = frameState.viewState;\n    const layerState = this.layerState_;\n    return this.replayGroup_.hasFeatureAtCoordinate(coordinate,\n      context, viewState.center, viewState.resolution, viewState.rotation,\n      frameState.size, frameState.pixelRatio, layerState.opacity,\n      frameState.skippedFeatureUids);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {\n  const coordinate = applyTransform(\n    frameState.pixelToCoordinateTransform, pixel.slice());\n  const hasFeature = this.hasFeatureAtCoordinate(coordinate, frameState);\n\n  if (hasFeature) {\n    return callback.call(thisArg, this.getLayer(), null);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * Handle changes in image style state.\n * @param {module:ol/events/Event} event Image style change event.\n * @private\n */\nWebGLVectorLayerRenderer.prototype.handleStyleImageChange_ = function(event) {\n  this.renderIfReadyAndVisible();\n};\n\n\n/**\n * @inheritDoc\n */\nWebGLVectorLayerRenderer.prototype.prepareFrame = function(frameState, layerState, context) {\n  const vectorLayer = /** @type {module:ol/layer/Vector} */ (this.getLayer());\n  const vectorSource = vectorLayer.getSource();\n\n  const animating = frameState.viewHints[ViewHint.ANIMATING];\n  const interacting = frameState.viewHints[ViewHint.INTERACTING];\n  const updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n  const updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n  if (!this.dirty_ && (!updateWhileAnimating && animating) ||\n      (!updateWhileInteracting && interacting)) {\n    return true;\n  }\n\n  const frameStateExtent = frameState.extent;\n  const viewState = frameState.viewState;\n  const projection = viewState.projection;\n  const resolution = viewState.resolution;\n  const pixelRatio = frameState.pixelRatio;\n  const vectorLayerRevision = vectorLayer.getRevision();\n  const vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n  let vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n  if (vectorLayerRenderOrder === undefined) {\n    vectorLayerRenderOrder = defaultRenderOrder;\n  }\n\n  const extent = buffer(frameStateExtent,\n    vectorLayerRenderBuffer * resolution);\n\n  if (!this.dirty_ &&\n      this.renderedResolution_ == resolution &&\n      this.renderedRevision_ == vectorLayerRevision &&\n      this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n      containsExtent(this.renderedExtent_, extent)) {\n    return true;\n  }\n\n  if (this.replayGroup_) {\n    frameState.postRenderFunctions.push(\n      this.replayGroup_.getDeleteResourcesFunction(context));\n  }\n\n  this.dirty_ = false;\n\n  const replayGroup = new WebGLReplayGroup(\n    getRenderTolerance(resolution, pixelRatio),\n    extent, vectorLayer.getRenderBuffer());\n  vectorSource.loadFeatures(extent, resolution, projection);\n  /**\n   * @param {module:ol/Feature} feature Feature.\n   * @this {module:ol/renderer/webgl/VectorLayer}\n   */\n  const render = function(feature) {\n    let styles;\n    const styleFunction = feature.getStyleFunction() || vectorLayer.getStyleFunction();\n    if (styleFunction) {\n      styles = styleFunction(feature, resolution);\n    }\n    if (styles) {\n      const dirty = this.renderFeature(\n        feature, resolution, pixelRatio, styles, replayGroup);\n      this.dirty_ = this.dirty_ || dirty;\n    }\n  };\n  if (vectorLayerRenderOrder) {\n    /** @type {Array.<module:ol/Feature>} */\n    const features = [];\n    vectorSource.forEachFeatureInExtent(extent,\n      /**\n       * @param {module:ol/Feature} feature Feature.\n       */\n      function(feature) {\n        features.push(feature);\n      }, this);\n    features.sort(vectorLayerRenderOrder);\n    features.forEach(render.bind(this));\n  } else {\n    vectorSource.forEachFeatureInExtent(extent, render, this);\n  }\n  replayGroup.finish(context);\n\n  this.renderedResolution_ = resolution;\n  this.renderedRevision_ = vectorLayerRevision;\n  this.renderedRenderOrder_ = vectorLayerRenderOrder;\n  this.renderedExtent_ = extent;\n  this.replayGroup_ = replayGroup;\n\n  return true;\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {(module:ol/style/Style|Array.<module:ol/style/Style>)} styles The style or array of\n *     styles.\n * @param {module:ol/render/webgl/ReplayGroup} replayGroup Replay group.\n * @return {boolean} `true` if an image is loading.\n */\nWebGLVectorLayerRenderer.prototype.renderFeature = function(feature, resolution, pixelRatio, styles, replayGroup) {\n  if (!styles) {\n    return false;\n  }\n  let loading = false;\n  if (Array.isArray(styles)) {\n    for (let i = styles.length - 1, ii = 0; i >= ii; --i) {\n      loading = renderFeature(\n        replayGroup, feature, styles[i],\n        getSquaredRenderTolerance(resolution, pixelRatio),\n        this.handleStyleImageChange_, this) || loading;\n    }\n  } else {\n    loading = renderFeature(\n      replayGroup, feature, styles,\n      getSquaredRenderTolerance(resolution, pixelRatio),\n      this.handleStyleImageChange_, this) || loading;\n  }\n  return loading;\n};\nexport default WebGLVectorLayerRenderer;\n","/**\n * @module ol/WebGLMap\n */\nimport {inherits} from './util.js';\nimport PluggableMap from './PluggableMap.js';\nimport {defaults as defaultControls} from './control.js';\nimport {defaults as defaultInteractions} from './interaction.js';\nimport {assign} from './obj.js';\nimport WebGLImageLayerRenderer from './renderer/webgl/ImageLayer.js';\nimport WebGLMapRenderer from './renderer/webgl/Map.js';\nimport WebGLTileLayerRenderer from './renderer/webgl/TileLayer.js';\nimport WebGLVectorLayerRenderer from './renderer/webgl/VectorLayer.js';\n\n\n/**\n * @classdesc\n * The WebGLMap uses WebGL for rendering map layers.  This renderer has limited\n * support for vector data and no support for vector tiles.\n *\n *     import WebGLMap from 'ol/WebGLMap';\n *     import TileLayer from 'ol/layer/Tile';\n *     import OSM from 'ol/source/OSM';\n *     import View from 'ol/View';\n *\n *     var map = new WebGLMap({\n *       view: new View({\n *         center: [0, 0],\n *         zoom: 1\n *       }),\n *       layers: [\n *         new TileLayer({\n *           source: new OSM()\n *         })\n *       ],\n *       target: 'map'\n *     });\n *\n * The above snippet creates a map using a {@link module:ol/layer/Tile~Tile} to\n * display {@link module:ol/source/OSM~OSM} OSM data and render it to a DOM\n * element with the id `map`.\n *\n * The constructor places a viewport container (with CSS class name\n * `ol-viewport`) in the target element (see `getViewport()`), and then two\n * further elements within the viewport: one with CSS class name\n * `ol-overlaycontainer-stopevent` for controls and some overlays, and one with\n * CSS class name `ol-overlaycontainer` for other overlays (see the `stopEvent`\n * option of {@link module:ol/Overlay~Overlay} for the difference). The map\n * itself is placed in a further element within the viewport.\n *\n * Layers are stored as a {@link module:ol/Collection~Collection} in\n * layerGroups. A top-level group is provided by the library. This is what is\n * accessed by `getLayerGroup` and `setLayerGroup`. Layers entered in the\n * options are added to this group, and `addLayer` and `removeLayer` change the\n * layer collection in the group. `getLayers` is a convenience function for\n * `getLayerGroup().getLayers()`.\n * Note that {@link module:ol/layer/Group~Group} is a subclass of\n * {@link module:ol/layer/Base}, so layers entered in the options or added\n * with `addLayer` can be groups, which can contain further groups, and so on.\n *\n * @constructor\n * @extends {module:ol/PluggableMap}\n * @param {module:ol/PluggableMap~MapOptions} options Map options.\n * @fires module:ol/MapBrowserEvent~MapBrowserEvent\n * @fires module:ol/MapEvent~MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @api\n */\nconst WebGLMap = function(options) {\n  options = assign({}, options);\n  if (!options.controls) {\n    options.controls = defaultControls();\n  }\n  if (!options.interactions) {\n    options.interactions = defaultInteractions();\n  }\n\n  PluggableMap.call(this, options);\n};\n\ninherits(WebGLMap, PluggableMap);\n\n\nWebGLMap.prototype.createRenderer = function() {\n  const renderer = new WebGLMapRenderer(this);\n  renderer.registerLayerRenderers([\n    WebGLImageLayerRenderer,\n    WebGLTileLayerRenderer,\n    WebGLVectorLayerRenderer\n  ]);\n  return renderer;\n};\n\nexport default WebGLMap;\n","/**\n * @module ol/control/MousePosition\n */\n\nimport {inherits} from '../util.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getChangeEventType} from '../Object.js';\nimport Control from '../control/Control.js';\nimport {getTransformFromProjections, identityTransform, get as getProjection} from '../proj.js';\n\n\n/**\n * @type {string}\n */\nconst PROJECTION = 'projection';\n\n/**\n * @type {string}\n */\nconst COORDINATE_FORMAT = 'coordinateFormat';\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-mouse-position'] CSS class name.\n * @property {module:ol/coordinate~CoordinateFormat} [coordinateFormat] Coordinate format.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {function(module:ol/MapEvent)} [render] Function called when the\n * control should be re-rendered. This is called in a `requestAnimationFrame`\n * callback.\n * @property {Element|string} [target] Specify a target if you want the\n * control to be rendered outside of the map's viewport.\n * @property {string} [undefinedHTML='&nbsp;'] Markup to show when coordinates are not\n * available (e.g. when the pointer leaves the map viewport).  By default, the last position\n * will be replaced with `'&nbsp;'` when the pointer leaves the viewport.  To\n * retain the last rendered position, set this option to something falsey (like an empty\n * string `''`).\n */\n\n\n/**\n * @classdesc\n * A control to show the 2D coordinates of the mouse cursor. By default, these\n * are in the view projection, but can be in any supported projection.\n * By default the control is shown in the top right corner of the map, but this\n * can be changed by using the css selector `.ol-mouse-position`.\n *\n * @constructor\n * @extends {module:ol/control/Control}\n * @param {module:ol/control/MousePosition~Options=} opt_options Mouse position\n *     options.\n * @api\n */\nconst MousePosition = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  const element = document.createElement('DIV');\n  element.className = options.className !== undefined ? options.className : 'ol-mouse-position';\n\n  Control.call(this, {\n    element: element,\n    render: options.render || render,\n    target: options.target\n  });\n\n  listen(this,\n    getChangeEventType(PROJECTION),\n    this.handleProjectionChanged_, this);\n\n  if (options.coordinateFormat) {\n    this.setCoordinateFormat(options.coordinateFormat);\n  }\n  if (options.projection) {\n    this.setProjection(options.projection);\n  }\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.undefinedHTML_ = 'undefinedHTML' in options ? options.undefinedHTML : '&nbsp;';\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderOnMouseOut_ = !!this.undefinedHTML_;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.renderedHTML_ = element.innerHTML;\n\n  /**\n   * @private\n   * @type {module:ol/proj/Projection}\n   */\n  this.mapProjection_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/proj~TransformFunction}\n   */\n  this.transform_ = null;\n\n  /**\n   * @private\n   * @type {module:ol~Pixel}\n   */\n  this.lastMouseMovePixel_ = null;\n\n};\n\ninherits(MousePosition, Control);\n\n\n/**\n * Update the mouseposition element.\n * @param {module:ol/MapEvent} mapEvent Map event.\n * @this {module:ol/control/MousePosition}\n * @api\n */\nexport function render(mapEvent) {\n  const frameState = mapEvent.frameState;\n  if (!frameState) {\n    this.mapProjection_ = null;\n  } else {\n    if (this.mapProjection_ != frameState.viewState.projection) {\n      this.mapProjection_ = frameState.viewState.projection;\n      this.transform_ = null;\n    }\n  }\n  this.updateHTML_(this.lastMouseMovePixel_);\n}\n\n\n/**\n * @private\n */\nMousePosition.prototype.handleProjectionChanged_ = function() {\n  this.transform_ = null;\n};\n\n\n/**\n * Return the coordinate format type used to render the current position or\n * undefined.\n * @return {module:ol/coordinate~CoordinateFormat|undefined} The format to render the current\n *     position in.\n * @observable\n * @api\n */\nMousePosition.prototype.getCoordinateFormat = function() {\n  return (\n    /** @type {module:ol/coordinate~CoordinateFormat|undefined} */ (this.get(COORDINATE_FORMAT))\n  );\n};\n\n\n/**\n * Return the projection that is used to report the mouse position.\n * @return {module:ol/proj/Projection|undefined} The projection to report mouse\n *     position in.\n * @observable\n * @api\n */\nMousePosition.prototype.getProjection = function() {\n  return (\n    /** @type {module:ol/proj/Projection|undefined} */ (this.get(PROJECTION))\n  );\n};\n\n\n/**\n * @param {Event} event Browser event.\n * @protected\n */\nMousePosition.prototype.handleMouseMove = function(event) {\n  const map = this.getMap();\n  this.lastMouseMovePixel_ = map.getEventPixel(event);\n  this.updateHTML_(this.lastMouseMovePixel_);\n};\n\n\n/**\n * @param {Event} event Browser event.\n * @protected\n */\nMousePosition.prototype.handleMouseOut = function(event) {\n  this.updateHTML_(null);\n  this.lastMouseMovePixel_ = null;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMousePosition.prototype.setMap = function(map) {\n  Control.prototype.setMap.call(this, map);\n  if (map) {\n    const viewport = map.getViewport();\n    this.listenerKeys.push(\n      listen(viewport, EventType.MOUSEMOVE, this.handleMouseMove, this)\n    );\n    if (this.renderOnMouseOut_) {\n      this.listenerKeys.push(\n        listen(viewport, EventType.MOUSEOUT, this.handleMouseOut, this)\n      );\n    }\n  }\n};\n\n\n/**\n * Set the coordinate format type used to render the current position.\n * @param {module:ol/coordinate~CoordinateFormat} format The format to render the current\n *     position in.\n * @observable\n * @api\n */\nMousePosition.prototype.setCoordinateFormat = function(format) {\n  this.set(COORDINATE_FORMAT, format);\n};\n\n\n/**\n * Set the projection that is used to report the mouse position.\n * @param {module:ol/proj~ProjectionLike} projection The projection to report mouse\n *     position in.\n * @observable\n * @api\n */\nMousePosition.prototype.setProjection = function(projection) {\n  this.set(PROJECTION, getProjection(projection));\n};\n\n\n/**\n * @param {?module:ol~Pixel} pixel Pixel.\n * @private\n */\nMousePosition.prototype.updateHTML_ = function(pixel) {\n  let html = this.undefinedHTML_;\n  if (pixel && this.mapProjection_) {\n    if (!this.transform_) {\n      const projection = this.getProjection();\n      if (projection) {\n        this.transform_ = getTransformFromProjections(\n          this.mapProjection_, projection);\n      } else {\n        this.transform_ = identityTransform;\n      }\n    }\n    const map = this.getMap();\n    const coordinate = map.getCoordinateFromPixel(pixel);\n    if (coordinate) {\n      this.transform_(coordinate, coordinate);\n      const coordinateFormat = this.getCoordinateFormat();\n      if (coordinateFormat) {\n        html = coordinateFormat(coordinate);\n      } else {\n        html = coordinate.toString();\n      }\n    }\n  }\n  if (!this.renderedHTML_ || html !== this.renderedHTML_) {\n    this.element.innerHTML = html;\n    this.renderedHTML_ = html;\n  }\n};\n\n\nexport default MousePosition;\n","/**\n * @module ol/format/Feature\n */\nimport Geometry from '../geom/Geometry.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection, equivalent as equivalentProjection, transformExtent} from '../proj.js';\n\n\n/**\n * @typedef {Object} ReadOptions\n * @property {module:ol/proj~ProjectionLike} dataProjection Projection of the data we are reading.\n * If not provided, the projection will be derived from the data (where possible) or\n * the `dataProjection` of the format is assigned (where set). If the projection\n * can not be derived from the data and if no `dataProjection` is set for a format,\n * the features will not be reprojected.\n * @property {module:ol/extent~Extent} extent Tile extent of the tile being read. This is only used and\n * required for {@link module:ol/format/MVT}.\n * @property {module:ol/proj~ProjectionLike} featureProjection Projection of the feature geometries\n * created by the format reader. If not provided, features will be returned in the\n * `dataProjection`.\n */\n\n\n/**\n * @typedef {Object} WriteOptions\n * @property {module:ol/proj~ProjectionLike} dataProjection Projection of the data we are writing.\n * If not provided, the `dataProjection` of the format is assigned (where set).\n * If no `dataProjection` is set for a format, the features will be returned\n * in the `featureProjection`.\n * @property {module:ol/proj~ProjectionLike} featureProjection Projection of the feature geometries\n * that will be serialized by the format writer. If not provided, geometries are assumed\n * to be in the `dataProjection` if that is set; in other words, they are not transformed.\n * @property {boolean} [rightHanded] When writing geometries, follow the right-hand\n * rule for linear ring orientation.  This means that polygons will have counter-clockwise\n * exterior rings and clockwise interior rings.  By default, coordinates are serialized\n * as they are provided at construction.  If `true`, the right-hand rule will\n * be applied.  If `false`, the left-hand rule will be applied (clockwise for\n * exterior and counter-clockwise for interior rings).  Note that not all\n * formats support this.  The GeoJSON format does use this property when writing\n * geometries.\n * @property {number} [decimals] Maximum number of decimal places for coordinates.\n * Coordinates are stored internally as floats, but floating-point arithmetic can create\n * coordinates with a large number of decimal places, not generally wanted on output.\n * Set a number here to round coordinates. Can also be used to ensure that\n * coordinates read in can be written back out with the same number of decimals.\n * Default is no rounding.\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for feature formats.\n * {module:ol/format/Feature~FeatureFormat} subclasses provide the ability to decode and encode\n * {@link module:ol/Feature~Feature} objects from a variety of commonly used geospatial\n * file formats.  See the documentation for each format for more details.\n *\n * @constructor\n * @abstract\n * @api\n */\nconst FeatureFormat = function() {\n\n  /**\n   * @protected\n   * @type {module:ol/proj/Projection}\n   */\n  this.dataProjection = null;\n\n  /**\n   * @protected\n   * @type {module:ol/proj/Projection}\n   */\n  this.defaultFeatureProjection = null;\n\n};\n\n\n/**\n * Adds the data projection to the read options.\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @return {module:ol/format/Feature~ReadOptions|undefined} Options.\n * @protected\n */\nFeatureFormat.prototype.getReadOptions = function(source, opt_options) {\n  let options;\n  if (opt_options) {\n    options = {\n      dataProjection: opt_options.dataProjection ?\n        opt_options.dataProjection : this.readProjection(source),\n      featureProjection: opt_options.featureProjection\n    };\n  }\n  return this.adaptOptions(options);\n};\n\n\n/**\n * Sets the `dataProjection` on the options, if no `dataProjection`\n * is set.\n * @param {module:ol/format/Feature~WriteOptions|module:ol/format/Feature~ReadOptions|undefined} options\n *     Options.\n * @protected\n * @return {module:ol/format/Feature~WriteOptions|module:ol/format/Feature~ReadOptions|undefined}\n *     Updated options.\n */\nFeatureFormat.prototype.adaptOptions = function(options) {\n  return assign({\n    dataProjection: this.dataProjection,\n    featureProjection: this.defaultFeatureProjection\n  }, options);\n};\n\n\n/**\n * Get the extent from the source of the last {@link readFeatures} call.\n * @return {module:ol/extent~Extent} Tile extent.\n */\nFeatureFormat.prototype.getLastExtent = function() {\n  return null;\n};\n\n\n/**\n * @abstract\n * @return {module:ol/format/FormatType} Format.\n */\nFeatureFormat.prototype.getType = function() {};\n\n\n/**\n * Read a single feature from a source.\n *\n * @abstract\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n */\nFeatureFormat.prototype.readFeature = function(source, opt_options) {};\n\n\n/**\n * Read all features from a source.\n *\n * @abstract\n * @param {Document|Node|ArrayBuffer|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n */\nFeatureFormat.prototype.readFeatures = function(source, opt_options) {};\n\n\n/**\n * Read a single geometry from a source.\n *\n * @abstract\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n */\nFeatureFormat.prototype.readGeometry = function(source, opt_options) {};\n\n\n/**\n * Read the projection from a source.\n *\n * @abstract\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n */\nFeatureFormat.prototype.readProjection = function(source) {};\n\n\n/**\n * Encode a feature in this format.\n *\n * @abstract\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} Result.\n */\nFeatureFormat.prototype.writeFeature = function(feature, opt_options) {};\n\n\n/**\n * Encode an array of features in this format.\n *\n * @abstract\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} Result.\n */\nFeatureFormat.prototype.writeFeatures = function(features, opt_options) {};\n\n\n/**\n * Write a single geometry in this format.\n *\n * @abstract\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} Result.\n */\nFeatureFormat.prototype.writeGeometry = function(geometry, opt_options) {};\n\nexport default FeatureFormat;\n\n/**\n * @param {module:ol/geom/Geometry|module:ol/extent~Extent} geometry Geometry.\n * @param {boolean} write Set to true for writing, false for reading.\n * @param {(module:ol/format/Feature~WriteOptions|module:ol/format/Feature~ReadOptions)=} opt_options\n *     Options.\n * @return {module:ol/geom/Geometry|module:ol/extent~Extent} Transformed geometry.\n */\nexport function transformWithOptions(geometry, write, opt_options) {\n  const featureProjection = opt_options ?\n    getProjection(opt_options.featureProjection) : null;\n  const dataProjection = opt_options ?\n    getProjection(opt_options.dataProjection) : null;\n  /**\n   * @type {module:ol/geom/Geometry|module:ol/extent~Extent}\n   */\n  let transformed;\n  if (featureProjection && dataProjection &&\n      !equivalentProjection(featureProjection, dataProjection)) {\n    if (geometry instanceof Geometry) {\n      transformed = (write ? geometry.clone() : geometry).transform(\n        write ? featureProjection : dataProjection,\n        write ? dataProjection : featureProjection);\n    } else {\n      // FIXME this is necessary because GML treats extents\n      // as geometries\n      transformed = transformExtent(\n        geometry,\n        dataProjection,\n        featureProjection);\n    }\n  } else {\n    transformed = geometry;\n  }\n  if (write && opt_options && opt_options.decimals !== undefined) {\n    const power = Math.pow(10, opt_options.decimals);\n    // if decimals option on write, round each coordinate appropriately\n    /**\n     * @param {Array.<number>} coordinates Coordinates.\n     * @return {Array.<number>} Transformed coordinates.\n     */\n    const transform = function(coordinates) {\n      for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n        coordinates[i] = Math.round(coordinates[i] * power) / power;\n      }\n      return coordinates;\n    };\n    if (transformed === geometry) {\n      transformed = transformed.clone();\n    }\n    transformed.applyTransform(transform);\n  }\n  return transformed;\n}\n","/**\n * @module ol/format/JSONFeature\n */\nimport {inherits} from '../util.js';\nimport FeatureFormat from '../format/Feature.js';\nimport FormatType from '../format/FormatType.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for JSON feature formats.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/format/Feature}\n */\nconst JSONFeature = function() {\n  FeatureFormat.call(this);\n};\n\ninherits(JSONFeature, FeatureFormat);\n\n\n/**\n * @param {Document|Node|Object|string} source Source.\n * @return {Object} Object.\n */\nfunction getObject(source) {\n  if (typeof source === 'string') {\n    const object = JSON.parse(source);\n    return object ? /** @type {Object} */ (object) : null;\n  } else if (source !== null) {\n    return source;\n  } else {\n    return null;\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.getType = function() {\n  return FormatType.JSON;\n};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.readFeature = function(source, opt_options) {\n  return this.readFeatureFromObject(\n    getObject(source), this.getReadOptions(source, opt_options));\n};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.readFeatures = function(source, opt_options) {\n  return this.readFeaturesFromObject(\n    getObject(source), this.getReadOptions(source, opt_options));\n};\n\n\n/**\n * @abstract\n * @param {Object} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {module:ol/Feature} Feature.\n */\nJSONFeature.prototype.readFeatureFromObject = function(object, opt_options) {};\n\n\n/**\n * @abstract\n * @param {Object} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {Array.<module:ol/Feature>} Features.\n */\nJSONFeature.prototype.readFeaturesFromObject = function(object, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.readGeometry = function(source, opt_options) {\n  return this.readGeometryFromObject(\n    getObject(source), this.getReadOptions(source, opt_options));\n};\n\n\n/**\n * @abstract\n * @param {Object} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {module:ol/geom/Geometry} Geometry.\n */\nJSONFeature.prototype.readGeometryFromObject = function(object, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.readProjection = function(source) {\n  return this.readProjectionFromObject(getObject(source));\n};\n\n\n/**\n * @abstract\n * @param {Object} object Object.\n * @protected\n * @return {module:ol/proj/Projection} Projection.\n */\nJSONFeature.prototype.readProjectionFromObject = function(object) {};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.writeFeature = function(feature, opt_options) {\n  return JSON.stringify(this.writeFeatureObject(feature, opt_options));\n};\n\n\n/**\n * @abstract\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {Object} Object.\n */\nJSONFeature.prototype.writeFeatureObject = function(feature, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.writeFeatures = function(features, opt_options) {\n  return JSON.stringify(this.writeFeaturesObject(features, opt_options));\n};\n\n\n/**\n * @abstract\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {Object} Object.\n */\nJSONFeature.prototype.writeFeaturesObject = function(features, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nJSONFeature.prototype.writeGeometry = function(geometry, opt_options) {\n  return JSON.stringify(this.writeGeometryObject(geometry, opt_options));\n};\n\n\n/**\n * @abstract\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {Object} Object.\n */\nJSONFeature.prototype.writeGeometryObject = function(geometry, opt_options) {};\nexport default JSONFeature;\n","/**\n * @module ol/format/EsriJSON\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {assert} from '../asserts.js';\nimport {containsExtent} from '../extent.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport JSONFeature from '../format/JSONFeature.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LineString from '../geom/LineString.js';\nimport LinearRing from '../geom/LinearRing.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {deflateCoordinates} from '../geom/flat/deflate.js';\nimport {linearRingIsClockwise} from '../geom/flat/orient.js';\nimport {assign, isEmpty} from '../obj.js';\nimport {get as getProjection} from '../proj.js';\n\n\n/**\n * @const\n * @type {Object.<module:ol/geom/GeometryType, function(EsriJSONGeometry): module:ol/geom/Geometry>}\n */\nconst GEOMETRY_READERS = {};\nGEOMETRY_READERS[GeometryType.POINT] = readPointGeometry;\nGEOMETRY_READERS[GeometryType.LINE_STRING] = readLineStringGeometry;\nGEOMETRY_READERS[GeometryType.POLYGON] = readPolygonGeometry;\nGEOMETRY_READERS[GeometryType.MULTI_POINT] = readMultiPointGeometry;\nGEOMETRY_READERS[GeometryType.MULTI_LINE_STRING] = readMultiLineStringGeometry;\nGEOMETRY_READERS[GeometryType.MULTI_POLYGON] = readMultiPolygonGeometry;\n\n\n/**\n * @const\n * @type {Object.<string, function(module:ol/geom/Geometry, module:ol/format/Feature~WriteOptions=): (EsriJSONGeometry)>}\n */\nconst GEOMETRY_WRITERS = {};\nGEOMETRY_WRITERS[GeometryType.POINT] = writePointGeometry;\nGEOMETRY_WRITERS[GeometryType.LINE_STRING] = writeLineStringGeometry;\nGEOMETRY_WRITERS[GeometryType.POLYGON] = writePolygonGeometry;\nGEOMETRY_WRITERS[GeometryType.MULTI_POINT] = writeMultiPointGeometry;\nGEOMETRY_WRITERS[GeometryType.MULTI_LINE_STRING] = writeMultiLineStringGeometry;\nGEOMETRY_WRITERS[GeometryType.MULTI_POLYGON] = writeMultiPolygonGeometry;\n\n\n/**\n * @typedef {Object} Options\n * @property {string} [geometryName] Geometry name to use when creating features.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the EsriJSON format.\n *\n * @constructor\n * @extends {module:ol/format/JSONFeature}\n * @param {module:ol/format/EsriJSON~Options=} opt_options Options.\n * @api\n */\nconst EsriJSON = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  JSONFeature.call(this);\n\n  /**\n   * Name of the geometry attribute for features.\n   * @type {string|undefined}\n   * @private\n   */\n  this.geometryName_ = options.geometryName;\n\n};\n\ninherits(EsriJSON, JSONFeature);\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n */\nfunction readGeometry(object, opt_options) {\n  if (!object) {\n    return null;\n  }\n  /** @type {module:ol/geom/GeometryType} */\n  let type;\n  if (typeof object.x === 'number' && typeof object.y === 'number') {\n    type = GeometryType.POINT;\n  } else if (object.points) {\n    type = GeometryType.MULTI_POINT;\n  } else if (object.paths) {\n    if (object.paths.length === 1) {\n      type = GeometryType.LINE_STRING;\n    } else {\n      type = GeometryType.MULTI_LINE_STRING;\n    }\n  } else if (object.rings) {\n    const layout = getGeometryLayout(object);\n    const rings = convertRings(object.rings, layout);\n    object = /** @type {EsriJSONGeometry} */(assign({}, object));\n    if (rings.length === 1) {\n      type = GeometryType.POLYGON;\n      object.rings = rings[0];\n    } else {\n      type = GeometryType.MULTI_POLYGON;\n      object.rings = rings;\n    }\n  }\n  const geometryReader = GEOMETRY_READERS[type];\n  return (\n    /** @type {module:ol/geom/Geometry} */ (transformWithOptions(geometryReader(object), false, opt_options))\n  );\n}\n\n\n/**\n * Determines inner and outer rings.\n * Checks if any polygons in this array contain any other polygons in this\n * array. It is used for checking for holes.\n * Logic inspired by: https://github.com/Esri/terraformer-arcgis-parser\n * @param {Array.<!Array.<!Array.<number>>>} rings Rings.\n * @param {module:ol/geom/GeometryLayout} layout Geometry layout.\n * @return {Array.<!Array.<!Array.<number>>>} Transformed rings.\n */\nfunction convertRings(rings, layout) {\n  const flatRing = [];\n  const outerRings = [];\n  const holes = [];\n  let i, ii;\n  for (i = 0, ii = rings.length; i < ii; ++i) {\n    flatRing.length = 0;\n    deflateCoordinates(flatRing, 0, rings[i], layout.length);\n    // is this ring an outer ring? is it clockwise?\n    const clockwise = linearRingIsClockwise(flatRing, 0,\n      flatRing.length, layout.length);\n    if (clockwise) {\n      outerRings.push([rings[i]]);\n    } else {\n      holes.push(rings[i]);\n    }\n  }\n  while (holes.length) {\n    const hole = holes.shift();\n    let matched = false;\n    // loop over all outer rings and see if they contain our hole.\n    for (i = outerRings.length - 1; i >= 0; i--) {\n      const outerRing = outerRings[i][0];\n      const containsHole = containsExtent(\n        new LinearRing(outerRing).getExtent(),\n        new LinearRing(hole).getExtent()\n      );\n      if (containsHole) {\n        // the hole is contained push it into our polygon\n        outerRings[i].push(hole);\n        matched = true;\n        break;\n      }\n    }\n    if (!matched) {\n      // no outer rings contain this hole turn it into and outer\n      // ring (reverse it)\n      outerRings.push([hole.reverse()]);\n    }\n  }\n  return outerRings;\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} Point.\n */\nfunction readPointGeometry(object) {\n  let point;\n  if (object.m !== undefined && object.z !== undefined) {\n    point = new Point([object.x, object.y, object.z, object.m],\n      GeometryLayout.XYZM);\n  } else if (object.z !== undefined) {\n    point = new Point([object.x, object.y, object.z],\n      GeometryLayout.XYZ);\n  } else if (object.m !== undefined) {\n    point = new Point([object.x, object.y, object.m],\n      GeometryLayout.XYM);\n  } else {\n    point = new Point([object.x, object.y]);\n  }\n  return point;\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} LineString.\n */\nfunction readLineStringGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new LineString(object.paths[0], layout);\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} MultiLineString.\n */\nfunction readMultiLineStringGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiLineString(object.paths, layout);\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/GeometryLayout} The geometry layout to use.\n */\nfunction getGeometryLayout(object) {\n  let layout = GeometryLayout.XY;\n  if (object.hasZ === true && object.hasM === true) {\n    layout = GeometryLayout.XYZM;\n  } else if (object.hasZ === true) {\n    layout = GeometryLayout.XYZ;\n  } else if (object.hasM === true) {\n    layout = GeometryLayout.XYM;\n  }\n  return layout;\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} MultiPoint.\n */\nfunction readMultiPointGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiPoint(object.points, layout);\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} MultiPolygon.\n */\nfunction readMultiPolygonGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiPolygon(\n    /** @type {Array.<Array.<Array.<Array.<number>>>>} */(object.rings),\n    layout);\n}\n\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @return {module:ol/geom/Geometry} Polygon.\n */\nfunction readPolygonGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new Polygon(object.rings, layout);\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONGeometry} EsriJSON geometry.\n */\nfunction writePointGeometry(geometry, opt_options) {\n  const coordinates = /** @type {module:ol/geom/Point} */ (geometry).getCoordinates();\n  let esriJSON;\n  const layout = /** @type {module:ol/geom/Point} */ (geometry).getLayout();\n  if (layout === GeometryLayout.XYZ) {\n    esriJSON = /** @type {EsriJSONPoint} */ ({\n      x: coordinates[0],\n      y: coordinates[1],\n      z: coordinates[2]\n    });\n  } else if (layout === GeometryLayout.XYM) {\n    esriJSON = /** @type {EsriJSONPoint} */ ({\n      x: coordinates[0],\n      y: coordinates[1],\n      m: coordinates[2]\n    });\n  } else if (layout === GeometryLayout.XYZM) {\n    esriJSON = /** @type {EsriJSONPoint} */ ({\n      x: coordinates[0],\n      y: coordinates[1],\n      z: coordinates[2],\n      m: coordinates[3]\n    });\n  } else if (layout === GeometryLayout.XY) {\n    esriJSON = /** @type {EsriJSONPoint} */ ({\n      x: coordinates[0],\n      y: coordinates[1]\n    });\n  } else {\n    assert(false, 34); // Invalid geometry layout\n  }\n  return /** @type {EsriJSONGeometry} */ (esriJSON);\n}\n\n\n/**\n * @param {module:ol/geom/SimpleGeometry} geometry Geometry.\n * @return {Object} Object with boolean hasZ and hasM keys.\n */\nfunction getHasZM(geometry) {\n  const layout = geometry.getLayout();\n  return {\n    hasZ: (layout === GeometryLayout.XYZ ||\n      layout === GeometryLayout.XYZM),\n    hasM: (layout === GeometryLayout.XYM ||\n      layout === GeometryLayout.XYZM)\n  };\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONPolyline} EsriJSON geometry.\n */\nfunction writeLineStringGeometry(geometry, opt_options) {\n  const hasZM = getHasZM(/** @type {module:ol/geom/LineString} */(geometry));\n  return (\n    /** @type {EsriJSONPolyline} */ {\n      hasZ: hasZM.hasZ,\n      hasM: hasZM.hasM,\n      paths: [\n        /** @type {module:ol/geom/LineString} */ (geometry).getCoordinates()\n      ]\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONPolygon} EsriJSON geometry.\n */\nfunction writePolygonGeometry(geometry, opt_options) {\n  // Esri geometries use the left-hand rule\n  const hasZM = getHasZM(/** @type {module:ol/geom/Polygon} */(geometry));\n  return (\n    /** @type {EsriJSONPolygon} */ {\n      hasZ: hasZM.hasZ,\n      hasM: hasZM.hasM,\n      rings: /** @type {module:ol/geom/Polygon} */ (geometry).getCoordinates(false)\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONPolyline} EsriJSON geometry.\n */\nfunction writeMultiLineStringGeometry(geometry, opt_options) {\n  const hasZM = getHasZM(/** @type {module:ol/geom/MultiLineString} */(geometry));\n  return (\n    /** @type {EsriJSONPolyline} */ {\n      hasZ: hasZM.hasZ,\n      hasM: hasZM.hasM,\n      paths: /** @type {module:ol/geom/MultiLineString} */ (geometry).getCoordinates()\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONMultipoint} EsriJSON geometry.\n */\nfunction writeMultiPointGeometry(geometry, opt_options) {\n  const hasZM = getHasZM(/** @type {module:ol/geom/MultiPoint} */(geometry));\n  return (\n    /** @type {EsriJSONMultipoint} */ {\n      hasZ: hasZM.hasZ,\n      hasM: hasZM.hasM,\n      points: /** @type {module:ol/geom/MultiPoint} */ (geometry).getCoordinates()\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONPolygon} EsriJSON geometry.\n */\nfunction writeMultiPolygonGeometry(geometry, opt_options) {\n  const hasZM = getHasZM(/** @type {module:ol/geom/MultiPolygon} */(geometry));\n  const coordinates = /** @type {module:ol/geom/MultiPolygon} */ (geometry).getCoordinates(false);\n  const output = [];\n  for (let i = 0; i < coordinates.length; i++) {\n    for (let x = coordinates[i].length - 1; x >= 0; x--) {\n      output.push(coordinates[i][x]);\n    }\n  }\n  return /** @type {EsriJSONPolygon} */ ({\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    rings: output\n  });\n}\n\n\n/**\n * Read a feature from a EsriJSON Feature source.  Only works for Feature,\n * use `readFeatures` to read FeatureCollection source.\n *\n * @function\n * @param {ArrayBuffer|Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nEsriJSON.prototype.readFeature;\n\n\n/**\n * Read all features from a EsriJSON source.  Works with both Feature and\n * FeatureCollection sources.\n *\n * @function\n * @param {ArrayBuffer|Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nEsriJSON.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nEsriJSON.prototype.readFeatureFromObject = function(object, opt_options) {\n  const esriJSONFeature = /** @type {EsriJSONFeature} */ (object);\n  const geometry = readGeometry(esriJSONFeature.geometry, opt_options);\n  const feature = new Feature();\n  if (this.geometryName_) {\n    feature.setGeometryName(this.geometryName_);\n  }\n  feature.setGeometry(geometry);\n  if (opt_options && opt_options.idField &&\n    esriJSONFeature.attributes[opt_options.idField]) {\n    feature.setId(/** @type {number} */(esriJSONFeature.attributes[opt_options.idField]));\n  }\n  if (esriJSONFeature.attributes) {\n    feature.setProperties(esriJSONFeature.attributes);\n  }\n  return feature;\n};\n\n\n/**\n * @inheritDoc\n */\nEsriJSON.prototype.readFeaturesFromObject = function(object, opt_options) {\n  const esriJSONObject = /** @type {EsriJSONObject} */ (object);\n  const options = opt_options ? opt_options : {};\n  if (esriJSONObject.features) {\n    const esriJSONFeatureCollection = /** @type {EsriJSONFeatureCollection} */ (object);\n    /** @type {Array.<module:ol/Feature>} */\n    const features = [];\n    const esriJSONFeatures = esriJSONFeatureCollection.features;\n    options.idField = object.objectIdFieldName;\n    for (let i = 0, ii = esriJSONFeatures.length; i < ii; ++i) {\n      features.push(this.readFeatureFromObject(esriJSONFeatures[i], options));\n    }\n    return features;\n  } else {\n    return [this.readFeatureFromObject(object, options)];\n  }\n};\n\n\n/**\n * Read a geometry from a EsriJSON source.\n *\n * @function\n * @param {ArrayBuffer|Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n * @api\n */\nEsriJSON.prototype.readGeometry;\n\n\n/**\n * @inheritDoc\n */\nEsriJSON.prototype.readGeometryFromObject = function(object, opt_options) {\n  return readGeometry(/** @type {EsriJSONGeometry} */(object), opt_options);\n};\n\n\n/**\n * Read the projection from a EsriJSON source.\n *\n * @function\n * @param {ArrayBuffer|Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nEsriJSON.prototype.readProjection;\n\n\n/**\n * @inheritDoc\n */\nEsriJSON.prototype.readProjectionFromObject = function(object) {\n  const esriJSONObject = /** @type {EsriJSONObject} */ (object);\n  if (esriJSONObject.spatialReference && esriJSONObject.spatialReference.wkid) {\n    const crs = esriJSONObject.spatialReference.wkid;\n    return getProjection('EPSG:' + crs);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONGeometry} EsriJSON geometry.\n */\nfunction writeGeometry(geometry, opt_options) {\n  const geometryWriter = GEOMETRY_WRITERS[geometry.getType()];\n  return geometryWriter(/** @type {module:ol/geom/Geometry} */(\n    transformWithOptions(geometry, true, opt_options)), opt_options);\n}\n\n\n/**\n * Encode a geometry as a EsriJSON string.\n *\n * @function\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} EsriJSON.\n * @api\n */\nEsriJSON.prototype.writeGeometry;\n\n\n/**\n * Encode a geometry as a EsriJSON object.\n *\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {EsriJSONGeometry} Object.\n * @override\n * @api\n */\nEsriJSON.prototype.writeGeometryObject = function(geometry, opt_options) {\n  return writeGeometry(geometry, this.adaptOptions(opt_options));\n};\n\n\n/**\n * Encode a feature as a EsriJSON Feature string.\n *\n * @function\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} EsriJSON.\n * @api\n */\nEsriJSON.prototype.writeFeature;\n\n\n/**\n * Encode a feature as a esriJSON Feature object.\n *\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {Object} Object.\n * @override\n * @api\n */\nEsriJSON.prototype.writeFeatureObject = function(feature, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const object = {};\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    object['geometry'] = writeGeometry(geometry, opt_options);\n    if (opt_options && opt_options.featureProjection) {\n      object['geometry']['spatialReference'] = /** @type {EsriJSONCRS} */({\n        wkid: getProjection(opt_options.featureProjection).getCode().split(':').pop()\n      });\n    }\n  }\n  const properties = feature.getProperties();\n  delete properties[feature.getGeometryName()];\n  if (!isEmpty(properties)) {\n    object['attributes'] = properties;\n  } else {\n    object['attributes'] = {};\n  }\n  return object;\n};\n\n\n/**\n * Encode an array of features as EsriJSON.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} EsriJSON.\n * @api\n */\nEsriJSON.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features as a EsriJSON object.\n *\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {Object} EsriJSON Object.\n * @override\n * @api\n */\nEsriJSON.prototype.writeFeaturesObject = function(features, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const objects = [];\n  for (let i = 0, ii = features.length; i < ii; ++i) {\n    objects.push(this.writeFeatureObject(features[i], opt_options));\n  }\n  return /** @type {EsriJSONFeatureCollection} */ ({\n    'features': objects\n  });\n};\n\nexport default EsriJSON;\n","/**\n * @module ol/xml\n */\nimport {extend} from './array.js';\n\n\n/**\n * When using {@link module:ol/xml~makeChildAppender} or\n * {@link module:ol/xml~makeSimpleNodeFactory}, the top `objectStack` item needs\n * to have this structure.\n * @typedef {Object} NodeStackItem\n * @property {Node} node\n */\n\n\n/**\n * @typedef {function(Node, Array.<*>)} Parser\n */\n\n\n/**\n * @typedef {function(Node, *, Array.<*>)} Serializer\n */\n\n\n/**\n * This document should be used when creating nodes for XML serializations. This\n * document is also used by {@link module:ol/xml~createElementNS}\n * @const\n * @type {Document}\n */\nexport const DOCUMENT = document.implementation.createDocument('', '', null);\n\n\n/**\n * @type {string}\n */\nexport const XML_SCHEMA_INSTANCE_URI = 'http://www.w3.org/2001/XMLSchema-instance';\n\n\n/**\n * @param {string} namespaceURI Namespace URI.\n * @param {string} qualifiedName Qualified name.\n * @return {Node} Node.\n */\nexport function createElementNS(namespaceURI, qualifiedName) {\n  return DOCUMENT.createElementNS(namespaceURI, qualifiedName);\n}\n\n\n/**\n * Recursively grab all text content of child nodes into a single string.\n * @param {Node} node Node.\n * @param {boolean} normalizeWhitespace Normalize whitespace: remove all line\n * breaks.\n * @return {string} All text content.\n * @api\n */\nexport function getAllTextContent(node, normalizeWhitespace) {\n  return getAllTextContent_(node, normalizeWhitespace, []).join('');\n}\n\n\n/**\n * Recursively grab all text content of child nodes into a single string.\n * @param {Node} node Node.\n * @param {boolean} normalizeWhitespace Normalize whitespace: remove all line\n * breaks.\n * @param {Array.<string>} accumulator Accumulator.\n * @private\n * @return {Array.<string>} Accumulator.\n */\nexport function getAllTextContent_(node, normalizeWhitespace, accumulator) {\n  if (node.nodeType == Node.CDATA_SECTION_NODE ||\n      node.nodeType == Node.TEXT_NODE) {\n    if (normalizeWhitespace) {\n      accumulator.push(String(node.nodeValue).replace(/(\\r\\n|\\r|\\n)/g, ''));\n    } else {\n      accumulator.push(node.nodeValue);\n    }\n  } else {\n    let n;\n    for (n = node.firstChild; n; n = n.nextSibling) {\n      getAllTextContent_(n, normalizeWhitespace, accumulator);\n    }\n  }\n  return accumulator;\n}\n\n\n/**\n * @param {?} value Value.\n * @return {boolean} Is document.\n */\nexport function isDocument(value) {\n  return value instanceof Document;\n}\n\n\n/**\n * @param {?} value Value.\n * @return {boolean} Is node.\n */\nexport function isNode(value) {\n  return value instanceof Node;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {?string} namespaceURI Namespace URI.\n * @param {string} name Attribute name.\n * @return {string} Value\n */\nexport function getAttributeNS(node, namespaceURI, name) {\n  return node.getAttributeNS(namespaceURI, name) || '';\n}\n\n\n/**\n * Parse an XML string to an XML Document.\n * @param {string} xml XML.\n * @return {Document} Document.\n * @api\n */\nexport function parse(xml) {\n  return new DOMParser().parseFromString(xml, 'application/xml');\n}\n\n\n/**\n * Make an array extender function for extending the array at the top of the\n * object stack.\n * @param {function(this: T, Node, Array.<*>): (Array.<*>|undefined)}\n *     valueReader Value reader.\n * @param {T=} opt_this The object to use as `this` in `valueReader`.\n * @return {module:ol/xml~Parser} Parser.\n * @template T\n */\nexport function makeArrayExtender(valueReader, opt_this) {\n  return (\n    /**\n     * @param {Node} node Node.\n     * @param {Array.<*>} objectStack Object stack.\n     */\n    function(node, objectStack) {\n      const value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);\n      if (value !== undefined) {\n        const array = /** @type {Array.<*>} */ (objectStack[objectStack.length - 1]);\n        extend(array, value);\n      }\n    }\n  );\n}\n\n\n/**\n * Make an array pusher function for pushing to the array at the top of the\n * object stack.\n * @param {function(this: T, Node, Array.<*>): *} valueReader Value reader.\n * @param {T=} opt_this The object to use as `this` in `valueReader`.\n * @return {module:ol/xml~Parser} Parser.\n * @template T\n */\nexport function makeArrayPusher(valueReader, opt_this) {\n  return (\n    /**\n     * @param {Node} node Node.\n     * @param {Array.<*>} objectStack Object stack.\n     */\n    function(node, objectStack) {\n      const value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);\n      if (value !== undefined) {\n        const array = /** @type {Array.<*>} */ (objectStack[objectStack.length - 1]);\n        array.push(value);\n      }\n    });\n}\n\n\n/**\n * Make an object stack replacer function for replacing the object at the\n * top of the stack.\n * @param {function(this: T, Node, Array.<*>): *} valueReader Value reader.\n * @param {T=} opt_this The object to use as `this` in `valueReader`.\n * @return {module:ol/xml~Parser} Parser.\n * @template T\n */\nexport function makeReplacer(valueReader, opt_this) {\n  return (\n    /**\n     * @param {Node} node Node.\n     * @param {Array.<*>} objectStack Object stack.\n     */\n    function(node, objectStack) {\n      const value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);\n      if (value !== undefined) {\n        objectStack[objectStack.length - 1] = value;\n      }\n    });\n}\n\n\n/**\n * Make an object property pusher function for adding a property to the\n * object at the top of the stack.\n * @param {function(this: T, Node, Array.<*>): *} valueReader Value reader.\n * @param {string=} opt_property Property.\n * @param {T=} opt_this The object to use as `this` in `valueReader`.\n * @return {module:ol/xml~Parser} Parser.\n * @template T\n */\nexport function makeObjectPropertyPusher(valueReader, opt_property, opt_this) {\n  return (\n    /**\n     * @param {Node} node Node.\n     * @param {Array.<*>} objectStack Object stack.\n     */\n    function(node, objectStack) {\n      const value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);\n      if (value !== undefined) {\n        const object = /** @type {!Object} */ (objectStack[objectStack.length - 1]);\n        const property = opt_property !== undefined ? opt_property : node.localName;\n        let array;\n        if (property in object) {\n          array = object[property];\n        } else {\n          array = object[property] = [];\n        }\n        array.push(value);\n      }\n    });\n}\n\n\n/**\n * Make an object property setter function.\n * @param {function(this: T, Node, Array.<*>): *} valueReader Value reader.\n * @param {string=} opt_property Property.\n * @param {T=} opt_this The object to use as `this` in `valueReader`.\n * @return {module:ol/xml~Parser} Parser.\n * @template T\n */\nexport function makeObjectPropertySetter(valueReader, opt_property, opt_this) {\n  return (\n    /**\n     * @param {Node} node Node.\n     * @param {Array.<*>} objectStack Object stack.\n     */\n    function(node, objectStack) {\n      const value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);\n      if (value !== undefined) {\n        const object = /** @type {!Object} */ (objectStack[objectStack.length - 1]);\n        const property = opt_property !== undefined ? opt_property : node.localName;\n        object[property] = value;\n      }\n    });\n}\n\n\n/**\n * Create a serializer that appends nodes written by its `nodeWriter` to its\n * designated parent. The parent is the `node` of the\n * {@link module:ol/xml~NodeStackItem} at the top of the `objectStack`.\n * @param {function(this: T, Node, V, Array.<*>)}\n *     nodeWriter Node writer.\n * @param {T=} opt_this The object to use as `this` in `nodeWriter`.\n * @return {module:ol/xml~Serializer} Serializer.\n * @template T, V\n */\nexport function makeChildAppender(nodeWriter, opt_this) {\n  return function(node, value, objectStack) {\n    nodeWriter.call(opt_this !== undefined ? opt_this : this, node, value, objectStack);\n    const parent = /** @type {module:ol/xml~NodeStackItem} */ (objectStack[objectStack.length - 1]);\n    const parentNode = parent.node;\n    parentNode.appendChild(node);\n  };\n}\n\n\n/**\n * Create a serializer that calls the provided `nodeWriter` from\n * {@link module:ol/xml~serialize}. This can be used by the parent writer to have the\n * 'nodeWriter' called with an array of values when the `nodeWriter` was\n * designed to serialize a single item. An example would be a LineString\n * geometry writer, which could be reused for writing MultiLineString\n * geometries.\n * @param {function(this: T, Node, V, Array.<*>)}\n *     nodeWriter Node writer.\n * @param {T=} opt_this The object to use as `this` in `nodeWriter`.\n * @return {module:ol/xml~Serializer} Serializer.\n * @template T, V\n */\nexport function makeArraySerializer(nodeWriter, opt_this) {\n  let serializersNS, nodeFactory;\n  return function(node, value, objectStack) {\n    if (serializersNS === undefined) {\n      serializersNS = {};\n      const serializers = {};\n      serializers[node.localName] = nodeWriter;\n      serializersNS[node.namespaceURI] = serializers;\n      nodeFactory = makeSimpleNodeFactory(node.localName);\n    }\n    serialize(serializersNS, nodeFactory, value, objectStack);\n  };\n}\n\n\n/**\n * Create a node factory which can use the `opt_keys` passed to\n * {@link module:ol/xml~serialize} or {@link module:ol/xml~pushSerializeAndPop} as node names,\n * or a fixed node name. The namespace of the created nodes can either be fixed,\n * or the parent namespace will be used.\n * @param {string=} opt_nodeName Fixed node name which will be used for all\n *     created nodes. If not provided, the 3rd argument to the resulting node\n *     factory needs to be provided and will be the nodeName.\n * @param {string=} opt_namespaceURI Fixed namespace URI which will be used for\n *     all created nodes. If not provided, the namespace of the parent node will\n *     be used.\n * @return {function(*, Array.<*>, string=): (Node|undefined)} Node factory.\n */\nexport function makeSimpleNodeFactory(opt_nodeName, opt_namespaceURI) {\n  const fixedNodeName = opt_nodeName;\n  return (\n    /**\n     * @param {*} value Value.\n     * @param {Array.<*>} objectStack Object stack.\n     * @param {string=} opt_nodeName Node name.\n     * @return {Node} Node.\n     */\n    function(value, objectStack, opt_nodeName) {\n      const context = /** @type {module:ol/xml~NodeStackItem} */ (objectStack[objectStack.length - 1]);\n      const node = context.node;\n      let nodeName = fixedNodeName;\n      if (nodeName === undefined) {\n        nodeName = opt_nodeName;\n      }\n\n      const namespaceURI = opt_namespaceURI !== undefined ? opt_namespaceURI : node.namespaceURI;\n      return createElementNS(namespaceURI, /** @type {string} */ (nodeName));\n    }\n  );\n}\n\n\n/**\n * A node factory that creates a node using the parent's `namespaceURI` and the\n * `nodeName` passed by {@link module:ol/xml~serialize} or\n * {@link module:ol/xml~pushSerializeAndPop} to the node factory.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nexport const OBJECT_PROPERTY_NODE_FACTORY = makeSimpleNodeFactory();\n\n\n/**\n * Create an array of `values` to be used with {@link module:ol/xml~serialize} or\n * {@link module:ol/xml~pushSerializeAndPop}, where `orderedKeys` has to be provided as\n * `opt_key` argument.\n * @param {Object.<string, V>} object Key-value pairs for the sequence. Keys can\n *     be a subset of the `orderedKeys`.\n * @param {Array.<string>} orderedKeys Keys in the order of the sequence.\n * @return {Array.<V>} Values in the order of the sequence. The resulting array\n *     has the same length as the `orderedKeys` array. Values that are not\n *     present in `object` will be `undefined` in the resulting array.\n * @template V\n */\nexport function makeSequence(object, orderedKeys) {\n  const length = orderedKeys.length;\n  const sequence = new Array(length);\n  for (let i = 0; i < length; ++i) {\n    sequence[i] = object[orderedKeys[i]];\n  }\n  return sequence;\n}\n\n\n/**\n * Create a namespaced structure, using the same values for each namespace.\n * This can be used as a starting point for versioned parsers, when only a few\n * values are version specific.\n * @param {Array.<string>} namespaceURIs Namespace URIs.\n * @param {T} structure Structure.\n * @param {Object.<string, T>=} opt_structureNS Namespaced structure to add to.\n * @return {Object.<string, T>} Namespaced structure.\n * @template T\n */\nexport function makeStructureNS(namespaceURIs, structure, opt_structureNS) {\n  /**\n   * @type {Object.<string, T>}\n   */\n  const structureNS = opt_structureNS !== undefined ? opt_structureNS : {};\n  let i, ii;\n  for (i = 0, ii = namespaceURIs.length; i < ii; ++i) {\n    structureNS[namespaceURIs[i]] = structure;\n  }\n  return structureNS;\n}\n\n\n/**\n * Parse a node using the parsers and object stack.\n * @param {Object.<string, Object.<string, module:ol/xml~Parser>>} parsersNS\n *     Parsers by namespace.\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @param {*=} opt_this The object to use as `this`.\n */\nexport function parseNode(parsersNS, node, objectStack, opt_this) {\n  let n;\n  for (n = node.firstElementChild; n; n = n.nextElementSibling) {\n    const parsers = parsersNS[n.namespaceURI];\n    if (parsers !== undefined) {\n      const parser = parsers[n.localName];\n      if (parser !== undefined) {\n        parser.call(opt_this, n, objectStack);\n      }\n    }\n  }\n}\n\n\n/**\n * Push an object on top of the stack, parse and return the popped object.\n * @param {T} object Object.\n * @param {Object.<string, Object.<string, module:ol/xml~Parser>>} parsersNS\n *     Parsers by namespace.\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @param {*=} opt_this The object to use as `this`.\n * @return {T} Object.\n * @template T\n */\nexport function pushParseAndPop(object, parsersNS, node, objectStack, opt_this) {\n  objectStack.push(object);\n  parseNode(parsersNS, node, objectStack, opt_this);\n  return /** @type {T} */ (objectStack.pop());\n}\n\n\n/**\n * Walk through an array of `values` and call a serializer for each value.\n * @param {Object.<string, Object.<string, module:ol/xml~Serializer>>} serializersNS\n *     Namespaced serializers.\n * @param {function(this: T, *, Array.<*>, (string|undefined)): (Node|undefined)} nodeFactory\n *     Node factory. The `nodeFactory` creates the node whose namespace and name\n *     will be used to choose a node writer from `serializersNS`. This\n *     separation allows us to decide what kind of node to create, depending on\n *     the value we want to serialize. An example for this would be different\n *     geometry writers based on the geometry type.\n * @param {Array.<*>} values Values to serialize. An example would be an array\n *     of {@link module:ol/Feature~Feature} instances.\n * @param {Array.<*>} objectStack Node stack.\n * @param {Array.<string>=} opt_keys Keys of the `values`. Will be passed to the\n *     `nodeFactory`. This is used for serializing object literals where the\n *     node name relates to the property key. The array length of `opt_keys` has\n *     to match the length of `values`. For serializing a sequence, `opt_keys`\n *     determines the order of the sequence.\n * @param {T=} opt_this The object to use as `this` for the node factory and\n *     serializers.\n * @template T\n */\nexport function serialize(\n  serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this) {\n  const length = (opt_keys !== undefined ? opt_keys : values).length;\n  let value, node;\n  for (let i = 0; i < length; ++i) {\n    value = values[i];\n    if (value !== undefined) {\n      node = nodeFactory.call(opt_this !== undefined ? opt_this : this, value, objectStack,\n        opt_keys !== undefined ? opt_keys[i] : undefined);\n      if (node !== undefined) {\n        serializersNS[node.namespaceURI][node.localName]\n          .call(opt_this, node, value, objectStack);\n      }\n    }\n  }\n}\n\n\n/**\n * @param {O} object Object.\n * @param {Object.<string, Object.<string, module:ol/xml~Serializer>>} serializersNS\n *     Namespaced serializers.\n * @param {function(this: T, *, Array.<*>, (string|undefined)): (Node|undefined)} nodeFactory\n *     Node factory. The `nodeFactory` creates the node whose namespace and name\n *     will be used to choose a node writer from `serializersNS`. This\n *     separation allows us to decide what kind of node to create, depending on\n *     the value we want to serialize. An example for this would be different\n *     geometry writers based on the geometry type.\n * @param {Array.<*>} values Values to serialize. An example would be an array\n *     of {@link module:ol/Feature~Feature} instances.\n * @param {Array.<*>} objectStack Node stack.\n * @param {Array.<string>=} opt_keys Keys of the `values`. Will be passed to the\n *     `nodeFactory`. This is used for serializing object literals where the\n *     node name relates to the property key. The array length of `opt_keys` has\n *     to match the length of `values`. For serializing a sequence, `opt_keys`\n *     determines the order of the sequence.\n * @param {T=} opt_this The object to use as `this` for the node factory and\n *     serializers.\n * @return {O|undefined} Object.\n * @template O, T\n */\nexport function pushSerializeAndPop(object, serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this) {\n  objectStack.push(object);\n  serialize(serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this);\n  return /** @type {O|undefined} */ (objectStack.pop());\n}\n","/**\n * @module ol/format/XMLFeature\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport FeatureFormat from '../format/Feature.js';\nimport FormatType from '../format/FormatType.js';\nimport {isDocument, isNode, parse} from '../xml.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for XML feature formats.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/format/Feature}\n */\nconst XMLFeature = function() {\n\n  /**\n   * @type {XMLSerializer}\n   * @private\n   */\n  this.xmlSerializer_ = new XMLSerializer();\n\n  FeatureFormat.call(this);\n};\n\ninherits(XMLFeature, FeatureFormat);\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.getType = function() {\n  return FormatType.XML;\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.readFeature = function(source, opt_options) {\n  if (isDocument(source)) {\n    return this.readFeatureFromDocument(/** @type {Document} */ (source), opt_options);\n  } else if (isNode(source)) {\n    return this.readFeatureFromNode(/** @type {Node} */ (source), opt_options);\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readFeatureFromDocument(doc, opt_options);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @return {module:ol/Feature} Feature.\n */\nXMLFeature.prototype.readFeatureFromDocument = function(doc, opt_options) {\n  const features = this.readFeaturesFromDocument(doc, opt_options);\n  if (features.length > 0) {\n    return features[0];\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @return {module:ol/Feature} Feature.\n */\nXMLFeature.prototype.readFeatureFromNode = function(node, opt_options) {\n  return null; // not implemented\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.readFeatures = function(source, opt_options) {\n  if (isDocument(source)) {\n    return this.readFeaturesFromDocument(\n      /** @type {Document} */ (source), opt_options);\n  } else if (isNode(source)) {\n    return this.readFeaturesFromNode(/** @type {Node} */ (source), opt_options);\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readFeaturesFromDocument(doc, opt_options);\n  } else {\n    return [];\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @protected\n * @return {Array.<module:ol/Feature>} Features.\n */\nXMLFeature.prototype.readFeaturesFromDocument = function(doc, opt_options) {\n  /** @type {Array.<module:ol/Feature>} */\n  const features = [];\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      extend(features, this.readFeaturesFromNode(n, opt_options));\n    }\n  }\n  return features;\n};\n\n\n/**\n * @abstract\n * @param {Node} node Node.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @protected\n * @return {Array.<module:ol/Feature>} Features.\n */\nXMLFeature.prototype.readFeaturesFromNode = function(node, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.readGeometry = function(source, opt_options) {\n  if (isDocument(source)) {\n    return this.readGeometryFromDocument(\n      /** @type {Document} */ (source), opt_options);\n  } else if (isNode(source)) {\n    return this.readGeometryFromNode(/** @type {Node} */ (source), opt_options);\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readGeometryFromDocument(doc, opt_options);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @protected\n * @return {module:ol/geom/Geometry} Geometry.\n */\nXMLFeature.prototype.readGeometryFromDocument = function(doc, opt_options) {\n  return null; // not implemented\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @protected\n * @return {module:ol/geom/Geometry} Geometry.\n */\nXMLFeature.prototype.readGeometryFromNode = function(node, opt_options) {\n  return null; // not implemented\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.readProjection = function(source) {\n  if (isDocument(source)) {\n    return this.readProjectionFromDocument(/** @type {Document} */ (source));\n  } else if (isNode(source)) {\n    return this.readProjectionFromNode(/** @type {Node} */ (source));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readProjectionFromDocument(doc);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @protected\n * @return {module:ol/proj/Projection} Projection.\n */\nXMLFeature.prototype.readProjectionFromDocument = function(doc) {\n  return this.dataProjection;\n};\n\n\n/**\n * @param {Node} node Node.\n * @protected\n * @return {module:ol/proj/Projection} Projection.\n */\nXMLFeature.prototype.readProjectionFromNode = function(node) {\n  return this.dataProjection;\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.writeFeature = function(feature, opt_options) {\n  const node = this.writeFeatureNode(feature, opt_options);\n  return this.xmlSerializer_.serializeToString(node);\n};\n\n\n/**\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @protected\n * @return {Node} Node.\n */\nXMLFeature.prototype.writeFeatureNode = function(feature, opt_options) {\n  return null; // not implemented\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.writeFeatures = function(features, opt_options) {\n  const node = this.writeFeaturesNode(features, opt_options);\n  return this.xmlSerializer_.serializeToString(node);\n};\n\n\n/**\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n */\nXMLFeature.prototype.writeFeaturesNode = function(features, opt_options) {\n  return null; // not implemented\n};\n\n\n/**\n * @inheritDoc\n */\nXMLFeature.prototype.writeGeometry = function(geometry, opt_options) {\n  const node = this.writeGeometryNode(geometry, opt_options);\n  return this.xmlSerializer_.serializeToString(node);\n};\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n */\nXMLFeature.prototype.writeGeometryNode = function(geometry, opt_options) {\n  return null; // not implemented\n};\nexport default XMLFeature;\n","/**\n * @module ol/format/GMLBase\n */\n// FIXME Envelopes should not be treated as geometries! readEnvelope_ is part\n// of GEOMETRY_PARSERS_ and methods using GEOMETRY_PARSERS_ do not expect\n// envelopes/extents, only geometries!\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport LinearRing from '../geom/LinearRing.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection} from '../proj.js';\nimport {getAllTextContent, getAttributeNS, makeArrayPusher, makeReplacer, parseNode, pushParseAndPop} from '../xml.js';\n\n\n/**\n * @const\n * @type {string}\n */\nexport const GMLNS = 'http://www.opengis.net/gml';\n\n\n/**\n * @typedef {Object} Options\n * @property {Object.<string, string>|string} [featureNS] Feature\n * namespace. If not defined will be derived from GML. If multiple\n * feature types have been configured which come from different feature\n * namespaces, this will be an object with the keys being the prefixes used\n * in the entries of featureType array. The values of the object will be the\n * feature namespaces themselves. So for instance there might be a featureType\n * item `topp:states` in the `featureType` array and then there will be a key\n * `topp` in the featureNS object with value `http://www.openplans.org/topp`.\n * @property {Array.<string>|string} [featureType] Feature type(s) to parse.\n * If multiple feature types need to be configured\n * which come from different feature namespaces, `featureNS` will be an object\n * with the keys being the prefixes used in the entries of featureType array.\n * The values of the object will be the feature namespaces themselves.\n * So for instance there might be a featureType item `topp:states` and then\n * there will be a key named `topp` in the featureNS object with value\n * `http://www.openplans.org/topp`.\n * @property {string} srsName srsName to use when writing geometries.\n * @property {boolean} [surface=false] Write gml:Surface instead of gml:Polygon\n * elements. This also affects the elements in multi-part geometries.\n * @property {boolean} [curve=false] Write gml:Curve instead of gml:LineString\n * elements. This also affects the elements in multi-part geometries.\n * @property {boolean} [multiCurve=true] Write gml:MultiCurve instead of gml:MultiLineString.\n * Since the latter is deprecated in GML 3.\n * @property {boolean} [multiSurface=true] Write gml:multiSurface instead of\n * gml:MultiPolygon. Since the latter is deprecated in GML 3.\n * @property {string} [schemaLocation] Optional schemaLocation to use when\n * writing out the GML, this will override the default provided.\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Feature base format for reading and writing data in the GML format.\n * This class cannot be instantiated, it contains only base content that\n * is shared with versioned format classes GML2 and GML3.\n *\n * @constructor\n * @abstract\n * @param {module:ol/format/GMLBase~Options=} opt_options\n *     Optional configuration object.\n * @extends {module:ol/format/XMLFeature}\n */\nconst GMLBase = function(opt_options) {\n  const options = /** @type {module:ol/format/GMLBase~Options} */ (opt_options ? opt_options : {});\n\n  /**\n   * @protected\n   * @type {Array.<string>|string|undefined}\n   */\n  this.featureType = options.featureType;\n\n  /**\n   * @protected\n   * @type {Object.<string, string>|string|undefined}\n   */\n  this.featureNS = options.featureNS;\n\n  /**\n   * @protected\n   * @type {string}\n   */\n  this.srsName = options.srsName;\n\n  /**\n   * @protected\n   * @type {string}\n   */\n  this.schemaLocation = '';\n\n  /**\n   * @type {Object.<string, Object.<string, Object>>}\n   */\n  this.FEATURE_COLLECTION_PARSERS = {};\n  this.FEATURE_COLLECTION_PARSERS[GMLNS] = {\n    'featureMember': makeReplacer(GMLBase.prototype.readFeaturesInternal),\n    'featureMembers': makeReplacer(GMLBase.prototype.readFeaturesInternal)\n  };\n\n  XMLFeature.call(this);\n};\n\ninherits(GMLBase, XMLFeature);\n\n\n/**\n * A regular expression that matches if a string only contains whitespace\n * characters. It will e.g. match `''`, `' '`, `'\\n'` etc. The non-breaking\n * space (0xa0) is explicitly included as IE doesn't include it in its\n * definition of `\\s`.\n *\n * Information from `goog.string.isEmptyOrWhitespace`: https://github.com/google/closure-library/blob/e877b1e/closure/goog/string/string.js#L156-L160\n *\n * @const\n * @type {RegExp}\n */\nconst ONLY_WHITESPACE_RE = /^[\\s\\xa0]*$/;\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<module:ol/Feature> | undefined} Features.\n */\nGMLBase.prototype.readFeaturesInternal = function(node, objectStack) {\n  const localName = node.localName;\n  let features = null;\n  if (localName == 'FeatureCollection') {\n    if (node.namespaceURI === 'http://www.opengis.net/wfs') {\n      features = pushParseAndPop([],\n        this.FEATURE_COLLECTION_PARSERS, node,\n        objectStack, this);\n    } else {\n      features = pushParseAndPop(null,\n        this.FEATURE_COLLECTION_PARSERS, node,\n        objectStack, this);\n    }\n  } else if (localName == 'featureMembers' || localName == 'featureMember') {\n    const context = objectStack[0];\n    let featureType = context['featureType'];\n    let featureNS = context['featureNS'];\n    const prefix = 'p';\n    const defaultPrefix = 'p0';\n    if (!featureType && node.childNodes) {\n      featureType = [], featureNS = {};\n      for (let i = 0, ii = node.childNodes.length; i < ii; ++i) {\n        const child = node.childNodes[i];\n        if (child.nodeType === 1) {\n          const ft = child.nodeName.split(':').pop();\n          if (featureType.indexOf(ft) === -1) {\n            let key = '';\n            let count = 0;\n            const uri = child.namespaceURI;\n            for (const candidate in featureNS) {\n              if (featureNS[candidate] === uri) {\n                key = candidate;\n                break;\n              }\n              ++count;\n            }\n            if (!key) {\n              key = prefix + count;\n              featureNS[key] = uri;\n            }\n            featureType.push(key + ':' + ft);\n          }\n        }\n      }\n      if (localName != 'featureMember') {\n        // recheck featureType for each featureMember\n        context['featureType'] = featureType;\n        context['featureNS'] = featureNS;\n      }\n    }\n    if (typeof featureNS === 'string') {\n      const ns = featureNS;\n      featureNS = {};\n      featureNS[defaultPrefix] = ns;\n    }\n    const parsersNS = {};\n    const featureTypes = Array.isArray(featureType) ? featureType : [featureType];\n    for (const p in featureNS) {\n      const parsers = {};\n      for (let i = 0, ii = featureTypes.length; i < ii; ++i) {\n        const featurePrefix = featureTypes[i].indexOf(':') === -1 ?\n          defaultPrefix : featureTypes[i].split(':')[0];\n        if (featurePrefix === p) {\n          parsers[featureTypes[i].split(':').pop()] =\n              (localName == 'featureMembers') ?\n                makeArrayPusher(this.readFeatureElement, this) :\n                makeReplacer(this.readFeatureElement, this);\n        }\n      }\n      parsersNS[featureNS[p]] = parsers;\n    }\n    if (localName == 'featureMember') {\n      features = pushParseAndPop(undefined, parsersNS, node, objectStack);\n    } else {\n      features = pushParseAndPop([], parsersNS, node, objectStack);\n    }\n  }\n  if (features === null) {\n    features = [];\n  }\n  return features;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Geometry|undefined} Geometry.\n */\nGMLBase.prototype.readGeometryElement = function(node, objectStack) {\n  const context = /** @type {Object} */ (objectStack[0]);\n  context['srsName'] = node.firstElementChild.getAttribute('srsName');\n  context['srsDimension'] = node.firstElementChild.getAttribute('srsDimension');\n  /** @type {module:ol/geom/Geometry} */\n  const geometry = pushParseAndPop(null, this.GEOMETRY_PARSERS_, node, objectStack, this);\n  if (geometry) {\n    return (\n      /** @type {module:ol/geom/Geometry} */ (transformWithOptions(geometry, false, context))\n    );\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/Feature} Feature.\n */\nGMLBase.prototype.readFeatureElement = function(node, objectStack) {\n  let n;\n  const fid = node.getAttribute('fid') || getAttributeNS(node, GMLNS, 'id');\n  const values = {};\n  let geometryName;\n  for (n = node.firstElementChild; n; n = n.nextElementSibling) {\n    const localName = n.localName;\n    // Assume attribute elements have one child node and that the child\n    // is a text or CDATA node (to be treated as text).\n    // Otherwise assume it is a geometry node.\n    if (n.childNodes.length === 0 ||\n        (n.childNodes.length === 1 &&\n        (n.firstChild.nodeType === 3 || n.firstChild.nodeType === 4))) {\n      let value = getAllTextContent(n, false);\n      if (ONLY_WHITESPACE_RE.test(value)) {\n        value = undefined;\n      }\n      values[localName] = value;\n    } else {\n      // boundedBy is an extent and must not be considered as a geometry\n      if (localName !== 'boundedBy') {\n        geometryName = localName;\n      }\n      values[localName] = this.readGeometryElement(n, objectStack);\n    }\n  }\n  const feature = new Feature(values);\n  if (geometryName) {\n    feature.setGeometryName(geometryName);\n  }\n  if (fid) {\n    feature.setId(fid);\n  }\n  return feature;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Point|undefined} Point.\n */\nGMLBase.prototype.readPoint = function(node, objectStack) {\n  const flatCoordinates = this.readFlatCoordinatesFromNode_(node, objectStack);\n  if (flatCoordinates) {\n    const point = new Point(null);\n    point.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    return point;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/MultiPoint|undefined} MultiPoint.\n */\nGMLBase.prototype.readMultiPoint = function(node, objectStack) {\n  /** @type {Array.<Array.<number>>} */\n  const coordinates = pushParseAndPop([],\n    this.MULTIPOINT_PARSERS_, node, objectStack, this);\n  if (coordinates) {\n    return new MultiPoint(coordinates);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/MultiLineString|undefined} MultiLineString.\n */\nGMLBase.prototype.readMultiLineString = function(node, objectStack) {\n  /** @type {Array.<module:ol/geom/LineString>} */\n  const lineStrings = pushParseAndPop([],\n    this.MULTILINESTRING_PARSERS_, node, objectStack, this);\n  if (lineStrings) {\n    const multiLineString = new MultiLineString(null);\n    multiLineString.setLineStrings(lineStrings);\n    return multiLineString;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/MultiPolygon|undefined} MultiPolygon.\n */\nGMLBase.prototype.readMultiPolygon = function(node, objectStack) {\n  /** @type {Array.<module:ol/geom/Polygon>} */\n  const polygons = pushParseAndPop([], this.MULTIPOLYGON_PARSERS_, node, objectStack, this);\n  if (polygons) {\n    const multiPolygon = new MultiPolygon(null);\n    multiPolygon.setPolygons(polygons);\n    return multiPolygon;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGMLBase.prototype.pointMemberParser_ = function(node, objectStack) {\n  parseNode(this.POINTMEMBER_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGMLBase.prototype.lineStringMemberParser_ = function(node, objectStack) {\n  parseNode(this.LINESTRINGMEMBER_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGMLBase.prototype.polygonMemberParser_ = function(node, objectStack) {\n  parseNode(this.POLYGONMEMBER_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/LineString|undefined} LineString.\n */\nGMLBase.prototype.readLineString = function(node, objectStack) {\n  const flatCoordinates = this.readFlatCoordinatesFromNode_(node, objectStack);\n  if (flatCoordinates) {\n    const lineString = new LineString(null);\n    lineString.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    return lineString;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} LinearRing flat coordinates.\n */\nGMLBase.prototype.readFlatLinearRing_ = function(node, objectStack) {\n  const ring = pushParseAndPop(null,\n    this.GEOMETRY_FLAT_COORDINATES_PARSERS_, node,\n    objectStack, this);\n  if (ring) {\n    return ring;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/LinearRing|undefined} LinearRing.\n */\nGMLBase.prototype.readLinearRing = function(node, objectStack) {\n  const flatCoordinates = this.readFlatCoordinatesFromNode_(node, objectStack);\n  if (flatCoordinates) {\n    const ring = new LinearRing(null);\n    ring.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    return ring;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Polygon|undefined} Polygon.\n */\nGMLBase.prototype.readPolygon = function(node, objectStack) {\n  /** @type {Array.<Array.<number>>} */\n  const flatLinearRings = pushParseAndPop([null],\n    this.FLAT_LINEAR_RINGS_PARSERS_, node, objectStack, this);\n  if (flatLinearRings && flatLinearRings[0]) {\n    const polygon = new Polygon(null);\n    const flatCoordinates = flatLinearRings[0];\n    const ends = [flatCoordinates.length];\n    let i, ii;\n    for (i = 1, ii = flatLinearRings.length; i < ii; ++i) {\n      extend(flatCoordinates, flatLinearRings[i]);\n      ends.push(flatCoordinates.length);\n    }\n    polygon.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates, ends);\n    return polygon;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>} Flat coordinates.\n */\nGMLBase.prototype.readFlatCoordinatesFromNode_ = function(node, objectStack) {\n  return pushParseAndPop(null, this.GEOMETRY_FLAT_COORDINATES_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.MULTIPOINT_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'pointMember': makeArrayPusher(GMLBase.prototype.pointMemberParser_),\n    'pointMembers': makeArrayPusher(GMLBase.prototype.pointMemberParser_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.MULTILINESTRING_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'lineStringMember': makeArrayPusher(GMLBase.prototype.lineStringMemberParser_),\n    'lineStringMembers': makeArrayPusher(GMLBase.prototype.lineStringMemberParser_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.MULTIPOLYGON_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'polygonMember': makeArrayPusher(GMLBase.prototype.polygonMemberParser_),\n    'polygonMembers': makeArrayPusher(GMLBase.prototype.polygonMemberParser_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.POINTMEMBER_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'Point': makeArrayPusher(GMLBase.prototype.readFlatCoordinatesFromNode_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.LINESTRINGMEMBER_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'LineString': makeArrayPusher(GMLBase.prototype.readLineString)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGMLBase.prototype.POLYGONMEMBER_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'Polygon': makeArrayPusher(GMLBase.prototype.readPolygon)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @protected\n */\nGMLBase.prototype.RING_PARSERS = {\n  'http://www.opengis.net/gml': {\n    'LinearRing': makeReplacer(GMLBase.prototype.readFlatLinearRing_)\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nGMLBase.prototype.readGeometryFromNode = function(node, opt_options) {\n  const geometry = this.readGeometryElement(node,\n    [this.getReadOptions(node, opt_options ? opt_options : {})]);\n  return geometry ? geometry : null;\n};\n\n\n/**\n * Read all features from a GML FeatureCollection.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nGMLBase.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nGMLBase.prototype.readFeaturesFromNode = function(node, opt_options) {\n  const options = {\n    featureType: this.featureType,\n    featureNS: this.featureNS\n  };\n  if (opt_options) {\n    assign(options, this.getReadOptions(node, opt_options));\n  }\n  const features = this.readFeaturesInternal(node, [options]);\n  return features || [];\n};\n\n\n/**\n * @inheritDoc\n */\nGMLBase.prototype.readProjectionFromNode = function(node) {\n  return getProjection(this.srsName ? this.srsName : node.firstElementChild.getAttribute('srsName'));\n};\nexport default GMLBase;\n","/**\n * @module ol/format/xsd\n */\nimport {getAllTextContent, DOCUMENT} from '../xml.js';\nimport {padNumber} from '../string.js';\n\n\n/**\n * @param {Node} node Node.\n * @return {boolean|undefined} Boolean.\n */\nexport function readBoolean(node) {\n  const s = getAllTextContent(node, false);\n  return readBooleanString(s);\n}\n\n\n/**\n * @param {string} string String.\n * @return {boolean|undefined} Boolean.\n */\nexport function readBooleanString(string) {\n  const m = /^\\s*(true|1)|(false|0)\\s*$/.exec(string);\n  if (m) {\n    return m[1] !== undefined || false;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {number|undefined} DateTime in seconds.\n */\nexport function readDateTime(node) {\n  const s = getAllTextContent(node, false);\n  const dateTime = Date.parse(s);\n  return isNaN(dateTime) ? undefined : dateTime / 1000;\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {number|undefined} Decimal.\n */\nexport function readDecimal(node) {\n  const s = getAllTextContent(node, false);\n  return readDecimalString(s);\n}\n\n\n/**\n * @param {string} string String.\n * @return {number|undefined} Decimal.\n */\nexport function readDecimalString(string) {\n  // FIXME check spec\n  const m = /^\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)\\s*$/i.exec(string);\n  if (m) {\n    return parseFloat(m[1]);\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {number|undefined} Non negative integer.\n */\nexport function readNonNegativeInteger(node) {\n  const s = getAllTextContent(node, false);\n  return readNonNegativeIntegerString(s);\n}\n\n\n/**\n * @param {string} string String.\n * @return {number|undefined} Non negative integer.\n */\nexport function readNonNegativeIntegerString(string) {\n  const m = /^\\s*(\\d+)\\s*$/.exec(string);\n  if (m) {\n    return parseInt(m[1], 10);\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {string|undefined} String.\n */\nexport function readString(node) {\n  return getAllTextContent(node, false).trim();\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the boolean to.\n * @param {boolean} bool Boolean.\n */\nexport function writeBooleanTextNode(node, bool) {\n  writeStringTextNode(node, (bool) ? '1' : '0');\n}\n\n\n/**\n * @param {Node} node Node to append a CDATA Section with the string to.\n * @param {string} string String.\n */\nexport function writeCDATASection(node, string) {\n  node.appendChild(DOCUMENT.createCDATASection(string));\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the dateTime to.\n * @param {number} dateTime DateTime in seconds.\n */\nexport function writeDateTimeTextNode(node, dateTime) {\n  const date = new Date(dateTime * 1000);\n  const string = date.getUTCFullYear() + '-' +\n      padNumber(date.getUTCMonth() + 1, 2) + '-' +\n      padNumber(date.getUTCDate(), 2) + 'T' +\n      padNumber(date.getUTCHours(), 2) + ':' +\n      padNumber(date.getUTCMinutes(), 2) + ':' +\n      padNumber(date.getUTCSeconds(), 2) + 'Z';\n  node.appendChild(DOCUMENT.createTextNode(string));\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the decimal to.\n * @param {number} decimal Decimal.\n */\nexport function writeDecimalTextNode(node, decimal) {\n  const string = decimal.toPrecision();\n  node.appendChild(DOCUMENT.createTextNode(string));\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the decimal to.\n * @param {number} nonNegativeInteger Non negative integer.\n */\nexport function writeNonNegativeIntegerTextNode(node, nonNegativeInteger) {\n  const string = nonNegativeInteger.toString();\n  node.appendChild(DOCUMENT.createTextNode(string));\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the string to.\n * @param {string} string String.\n */\nexport function writeStringTextNode(node, string) {\n  node.appendChild(DOCUMENT.createTextNode(string));\n}\n","/**\n * @module ol/format/GML3\n */\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport {createOrUpdate} from '../extent.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport GMLBase, {GMLNS} from '../format/GMLBase.js';\nimport {readNonNegativeIntegerString, writeStringTextNode} from '../format/xsd.js';\nimport Geometry from '../geom/Geometry.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Polygon from '../geom/Polygon.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection, transformExtent} from '../proj.js';\nimport {createElementNS, getAllTextContent, makeArrayPusher, makeChildAppender,\n  makeReplacer, makeSimpleNodeFactory, OBJECT_PROPERTY_NODE_FACTORY, parseNode,\n  pushParseAndPop, pushSerializeAndPop, XML_SCHEMA_INSTANCE_URI} from '../xml.js';\n\n\n/**\n * @const\n * @type {string}\n * @private\n */\nconst schemaLocation = GMLNS +\n    ' http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/' +\n    '1.0.0/gmlsf.xsd';\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GML format\n * version 3.1.1.\n * Currently only supports GML 3.1.1 Simple Features profile.\n *\n * @constructor\n * @param {module:ol/format/GMLBase~Options=} opt_options\n *     Optional configuration object.\n * @extends {module:ol/format/GMLBase}\n * @api\n */\nconst GML3 = function(opt_options) {\n  const options = /** @type {module:ol/format/GMLBase~Options} */\n      (opt_options ? opt_options : {});\n\n  GMLBase.call(this, options);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.surface_ = options.surface !== undefined ? options.surface : false;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.curve_ = options.curve !== undefined ? options.curve : false;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.multiCurve_ = options.multiCurve !== undefined ?\n    options.multiCurve : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.multiSurface_ = options.multiSurface !== undefined ?\n    options.multiSurface : true;\n\n  /**\n   * @inheritDoc\n   */\n  this.schemaLocation = options.schemaLocation ?\n    options.schemaLocation : schemaLocation;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hasZ = options.hasZ !== undefined ?\n    options.hasZ : false;\n\n};\n\ninherits(GML3, GMLBase);\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/geom/MultiLineString|undefined} MultiLineString.\n */\nGML3.prototype.readMultiCurve_ = function(node, objectStack) {\n  /** @type {Array.<module:ol/geom/LineString>} */\n  const lineStrings = pushParseAndPop([],\n    this.MULTICURVE_PARSERS_, node, objectStack, this);\n  if (lineStrings) {\n    const multiLineString = new MultiLineString(null);\n    multiLineString.setLineStrings(lineStrings);\n    return multiLineString;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/geom/MultiPolygon|undefined} MultiPolygon.\n */\nGML3.prototype.readMultiSurface_ = function(node, objectStack) {\n  /** @type {Array.<module:ol/geom/Polygon>} */\n  const polygons = pushParseAndPop([],\n    this.MULTISURFACE_PARSERS_, node, objectStack, this);\n  if (polygons) {\n    const multiPolygon = new MultiPolygon(null);\n    multiPolygon.setPolygons(polygons);\n    return multiPolygon;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML3.prototype.curveMemberParser_ = function(node, objectStack) {\n  parseNode(this.CURVEMEMBER_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML3.prototype.surfaceMemberParser_ = function(node, objectStack) {\n  parseNode(this.SURFACEMEMBER_PARSERS_,\n    node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<(Array.<number>)>|undefined} flat coordinates.\n */\nGML3.prototype.readPatch_ = function(node, objectStack) {\n  return pushParseAndPop([null],\n    this.PATCHES_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} flat coordinates.\n */\nGML3.prototype.readSegment_ = function(node, objectStack) {\n  return pushParseAndPop([null],\n    this.SEGMENTS_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<(Array.<number>)>|undefined} flat coordinates.\n */\nGML3.prototype.readPolygonPatch_ = function(node, objectStack) {\n  return pushParseAndPop([null],\n    this.FLAT_LINEAR_RINGS_PARSERS_, node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} flat coordinates.\n */\nGML3.prototype.readLineStringSegment_ = function(node, objectStack) {\n  return pushParseAndPop([null],\n    this.GEOMETRY_FLAT_COORDINATES_PARSERS_,\n    node, objectStack, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML3.prototype.interiorParser_ = function(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    this.RING_PARSERS, node, objectStack, this);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings.push(flatLinearRing);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML3.prototype.exteriorParser_ = function(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    this.RING_PARSERS, node, objectStack, this);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings[0] = flatLinearRing;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/geom/Polygon|undefined} Polygon.\n */\nGML3.prototype.readSurface_ = function(node, objectStack) {\n  /** @type {Array.<Array.<number>>} */\n  const flatLinearRings = pushParseAndPop([null],\n    this.SURFACE_PARSERS_, node, objectStack, this);\n  if (flatLinearRings && flatLinearRings[0]) {\n    const polygon = new Polygon(null);\n    const flatCoordinates = flatLinearRings[0];\n    const ends = [flatCoordinates.length];\n    let i, ii;\n    for (i = 1, ii = flatLinearRings.length; i < ii; ++i) {\n      extend(flatCoordinates, flatLinearRings[i]);\n      ends.push(flatCoordinates.length);\n    }\n    polygon.setFlatCoordinates(\n      GeometryLayout.XYZ, flatCoordinates, ends);\n    return polygon;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/geom/LineString|undefined} LineString.\n */\nGML3.prototype.readCurve_ = function(node, objectStack) {\n  /** @type {Array.<number>} */\n  const flatCoordinates = pushParseAndPop([null],\n    this.CURVE_PARSERS_, node, objectStack, this);\n  if (flatCoordinates) {\n    const lineString = new LineString(null);\n    lineString.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    return lineString;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/extent~Extent|undefined} Envelope.\n */\nGML3.prototype.readEnvelope_ = function(node, objectStack) {\n  /** @type {Array.<number>} */\n  const flatCoordinates = pushParseAndPop([null],\n    this.ENVELOPE_PARSERS_, node, objectStack, this);\n  return createOrUpdate(flatCoordinates[1][0],\n    flatCoordinates[1][1], flatCoordinates[2][0],\n    flatCoordinates[2][1]);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} Flat coordinates.\n */\nGML3.prototype.readFlatPos_ = function(node, objectStack) {\n  let s = getAllTextContent(node, false);\n  const re = /^\\s*([+\\-]?\\d*\\.?\\d+(?:[eE][+\\-]?\\d+)?)\\s*/;\n  /** @type {Array.<number>} */\n  const flatCoordinates = [];\n  let m;\n  while ((m = re.exec(s))) {\n    flatCoordinates.push(parseFloat(m[1]));\n    s = s.substr(m[0].length);\n  }\n  if (s !== '') {\n    return undefined;\n  }\n  const context = objectStack[0];\n  const containerSrs = context['srsName'];\n  let axisOrientation = 'enu';\n  if (containerSrs) {\n    const proj = getProjection(containerSrs);\n    axisOrientation = proj.getAxisOrientation();\n  }\n  if (axisOrientation === 'neu') {\n    let i, ii;\n    for (i = 0, ii = flatCoordinates.length; i < ii; i += 3) {\n      const y = flatCoordinates[i];\n      const x = flatCoordinates[i + 1];\n      flatCoordinates[i] = x;\n      flatCoordinates[i + 1] = y;\n    }\n  }\n  const len = flatCoordinates.length;\n  if (len == 2) {\n    flatCoordinates.push(0);\n  }\n  if (len === 0) {\n    return undefined;\n  }\n  return flatCoordinates;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} Flat coordinates.\n */\nGML3.prototype.readFlatPosList_ = function(node, objectStack) {\n  const s = getAllTextContent(node, false).replace(/^\\s*|\\s*$/g, '');\n  const context = objectStack[0];\n  const containerSrs = context['srsName'];\n  const contextDimension = context['srsDimension'];\n  let axisOrientation = 'enu';\n  if (containerSrs) {\n    const proj = getProjection(containerSrs);\n    axisOrientation = proj.getAxisOrientation();\n  }\n  const coords = s.split(/\\s+/);\n  // The \"dimension\" attribute is from the GML 3.0.1 spec.\n  let dim = 2;\n  if (node.getAttribute('srsDimension')) {\n    dim = readNonNegativeIntegerString(\n      node.getAttribute('srsDimension'));\n  } else if (node.getAttribute('dimension')) {\n    dim = readNonNegativeIntegerString(\n      node.getAttribute('dimension'));\n  } else if (node.parentNode.getAttribute('srsDimension')) {\n    dim = readNonNegativeIntegerString(\n      node.parentNode.getAttribute('srsDimension'));\n  } else if (contextDimension) {\n    dim = readNonNegativeIntegerString(contextDimension);\n  }\n  let x, y, z;\n  const flatCoordinates = [];\n  for (let i = 0, ii = coords.length; i < ii; i += dim) {\n    x = parseFloat(coords[i]);\n    y = parseFloat(coords[i + 1]);\n    z = (dim === 3) ? parseFloat(coords[i + 2]) : 0;\n    if (axisOrientation.substr(0, 2) === 'en') {\n      flatCoordinates.push(x, y, z);\n    } else {\n      flatCoordinates.push(y, x, z);\n    }\n  }\n  return flatCoordinates;\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'pos': makeReplacer(GML3.prototype.readFlatPos_),\n    'posList': makeReplacer(GML3.prototype.readFlatPosList_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.FLAT_LINEAR_RINGS_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'interior': GML3.prototype.interiorParser_,\n    'exterior': GML3.prototype.exteriorParser_\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.GEOMETRY_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'Point': makeReplacer(GMLBase.prototype.readPoint),\n    'MultiPoint': makeReplacer(\n      GMLBase.prototype.readMultiPoint),\n    'LineString': makeReplacer(\n      GMLBase.prototype.readLineString),\n    'MultiLineString': makeReplacer(\n      GMLBase.prototype.readMultiLineString),\n    'LinearRing': makeReplacer(\n      GMLBase.prototype.readLinearRing),\n    'Polygon': makeReplacer(GMLBase.prototype.readPolygon),\n    'MultiPolygon': makeReplacer(\n      GMLBase.prototype.readMultiPolygon),\n    'Surface': makeReplacer(GML3.prototype.readSurface_),\n    'MultiSurface': makeReplacer(\n      GML3.prototype.readMultiSurface_),\n    'Curve': makeReplacer(GML3.prototype.readCurve_),\n    'MultiCurve': makeReplacer(\n      GML3.prototype.readMultiCurve_),\n    'Envelope': makeReplacer(GML3.prototype.readEnvelope_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.MULTICURVE_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'curveMember': makeArrayPusher(\n      GML3.prototype.curveMemberParser_),\n    'curveMembers': makeArrayPusher(\n      GML3.prototype.curveMemberParser_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.MULTISURFACE_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'surfaceMember': makeArrayPusher(\n      GML3.prototype.surfaceMemberParser_),\n    'surfaceMembers': makeArrayPusher(\n      GML3.prototype.surfaceMemberParser_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.CURVEMEMBER_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'LineString': makeArrayPusher(\n      GMLBase.prototype.readLineString),\n    'Curve': makeArrayPusher(GML3.prototype.readCurve_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.SURFACEMEMBER_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'Polygon': makeArrayPusher(GMLBase.prototype.readPolygon),\n    'Surface': makeArrayPusher(GML3.prototype.readSurface_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.SURFACE_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'patches': makeReplacer(GML3.prototype.readPatch_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.CURVE_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'segments': makeReplacer(GML3.prototype.readSegment_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.ENVELOPE_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'lowerCorner': makeArrayPusher(\n      GML3.prototype.readFlatPosList_),\n    'upperCorner': makeArrayPusher(\n      GML3.prototype.readFlatPosList_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.PATCHES_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'PolygonPatch': makeReplacer(\n      GML3.prototype.readPolygonPatch_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML3.prototype.SEGMENTS_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'LineStringSegment': makeReplacer(\n      GML3.prototype.readLineStringSegment_)\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Point} value Point geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writePos_ = function(node, value, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsDimension = hasZ ? 3 : 2;\n  node.setAttribute('srsDimension', srsDimension);\n  const srsName = context['srsName'];\n  let axisOrientation = 'enu';\n  if (srsName) {\n    axisOrientation = getProjection(srsName).getAxisOrientation();\n  }\n  const point = value.getCoordinates();\n  let coords;\n  // only 2d for simple features profile\n  if (axisOrientation.substr(0, 2) === 'en') {\n    coords = (point[0] + ' ' + point[1]);\n  } else {\n    coords = (point[1] + ' ' + point[0]);\n  }\n  if (hasZ) {\n    // For newly created points, Z can be undefined.\n    const z = point[2] || 0;\n    coords += ' ' + z;\n  }\n  writeStringTextNode(node, coords);\n};\n\n\n/**\n * @param {Array.<number>} point Point geometry.\n * @param {string=} opt_srsName Optional srsName\n * @param {boolean=} opt_hasZ whether the geometry has a Z coordinate (is 3D) or not.\n * @return {string} The coords string.\n * @private\n */\nGML3.prototype.getCoords_ = function(point, opt_srsName, opt_hasZ) {\n  let axisOrientation = 'enu';\n  if (opt_srsName) {\n    axisOrientation = getProjection(opt_srsName).getAxisOrientation();\n  }\n  let coords = ((axisOrientation.substr(0, 2) === 'en') ?\n    point[0] + ' ' + point[1] :\n    point[1] + ' ' + point[0]);\n  if (opt_hasZ) {\n    // For newly created points, Z can be undefined.\n    const z = point[2] || 0;\n    coords += ' ' + z;\n  }\n\n  return coords;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString|module:ol/geom/LinearRing} value Geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writePosList_ = function(node, value, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsDimension = hasZ ? 3 : 2;\n  node.setAttribute('srsDimension', srsDimension);\n  const srsName = context['srsName'];\n  // only 2d for simple features profile\n  const points = value.getCoordinates();\n  const len = points.length;\n  const parts = new Array(len);\n  let point;\n  for (let i = 0; i < len; ++i) {\n    point = points[i];\n    parts[i] = this.getCoords_(point, srsName, hasZ);\n  }\n  writeStringTextNode(node, parts.join(' '));\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Point} geometry Point geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writePoint_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const pos = createElementNS(node.namespaceURI, 'pos');\n  node.appendChild(pos);\n  this.writePos_(pos, geometry, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {Array.<*>} objectStack Node stack.\n */\nGML3.prototype.writeEnvelope = function(node, extent, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const keys = ['lowerCorner', 'upperCorner'];\n  const values = [extent[0] + ' ' + extent[1], extent[2] + ' ' + extent[3]];\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    ({node: node}), this.ENVELOPE_SERIALIZERS_,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    values,\n    objectStack, keys, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LinearRing} geometry LinearRing geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeLinearRing_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const posList = createElementNS(node.namespaceURI, 'posList');\n  node.appendChild(posList);\n  this.writePosList_(posList, geometry, objectStack);\n};\n\n\n/**\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node} Node.\n * @private\n */\nGML3.prototype.RING_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const context = objectStack[objectStack.length - 1];\n  const parentNode = context.node;\n  const exteriorWritten = context['exteriorWritten'];\n  if (exteriorWritten === undefined) {\n    context['exteriorWritten'] = true;\n  }\n  return createElementNS(parentNode.namespaceURI,\n    exteriorWritten !== undefined ? 'interior' : 'exterior');\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} geometry Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeSurfaceOrPolygon_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  if (node.nodeName !== 'PolygonPatch' && srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  if (node.nodeName === 'Polygon' || node.nodeName === 'PolygonPatch') {\n    const rings = geometry.getLinearRings();\n    pushSerializeAndPop(\n      {node: node, hasZ: hasZ, srsName: srsName},\n      this.RING_SERIALIZERS_,\n      this.RING_NODE_FACTORY_,\n      rings, objectStack, undefined, this);\n  } else if (node.nodeName === 'Surface') {\n    const patches = createElementNS(node.namespaceURI, 'patches');\n    node.appendChild(patches);\n    this.writeSurfacePatches_(\n      patches, geometry, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} geometry LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeCurveOrLineString_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (node.nodeName !== 'LineStringSegment' && srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  if (node.nodeName === 'LineString' ||\n      node.nodeName === 'LineStringSegment') {\n    const posList = createElementNS(node.namespaceURI, 'posList');\n    node.appendChild(posList);\n    this.writePosList_(posList, geometry, objectStack);\n  } else if (node.nodeName === 'Curve') {\n    const segments = createElementNS(node.namespaceURI, 'segments');\n    node.appendChild(segments);\n    this.writeCurveSegments_(segments,\n      geometry, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiPolygon} geometry MultiPolygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeMultiSurfaceOrPolygon_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  const surface = context['surface'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const polygons = geometry.getPolygons();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName, surface: surface},\n    this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,\n    this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_, polygons,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiPoint} geometry MultiPoint geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeMultiPoint_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  const hasZ = context['hasZ'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const points = geometry.getPoints();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName},\n    this.POINTMEMBER_SERIALIZERS_,\n    makeSimpleNodeFactory('pointMember'), points,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiLineString} geometry MultiLineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeMultiCurveOrLineString_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  const curve = context['curve'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const lines = geometry.getLineStrings();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName, curve: curve},\n    this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,\n    this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_, lines,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LinearRing} ring LinearRing geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeRing_ = function(node, ring, objectStack) {\n  const linearRing = createElementNS(node.namespaceURI, 'LinearRing');\n  node.appendChild(linearRing);\n  this.writeLinearRing_(linearRing, ring, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} polygon Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeSurfaceOrPolygonMember_ = function(node, polygon, objectStack) {\n  const child = this.GEOMETRY_NODE_FACTORY_(\n    polygon, objectStack);\n  if (child) {\n    node.appendChild(child);\n    this.writeSurfaceOrPolygon_(child, polygon, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Point} point Point geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writePointMember_ = function(node, point, objectStack) {\n  const child = createElementNS(node.namespaceURI, 'Point');\n  node.appendChild(child);\n  this.writePoint_(child, point, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} line LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeLineStringOrCurveMember_ = function(node, line, objectStack) {\n  const child = this.GEOMETRY_NODE_FACTORY_(line, objectStack);\n  if (child) {\n    node.appendChild(child);\n    this.writeCurveOrLineString_(child, line, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} polygon Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeSurfacePatches_ = function(node, polygon, objectStack) {\n  const child = createElementNS(node.namespaceURI, 'PolygonPatch');\n  node.appendChild(child);\n  this.writeSurfaceOrPolygon_(child, polygon, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} line LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeCurveSegments_ = function(node, line, objectStack) {\n  const child = createElementNS(node.namespaceURI,\n    'LineStringSegment');\n  node.appendChild(child);\n  this.writeCurveOrLineString_(child, line, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Geometry|module:ol/extent~Extent} geometry Geometry.\n * @param {Array.<*>} objectStack Node stack.\n */\nGML3.prototype.writeGeometryElement = function(node, geometry, objectStack) {\n  const context = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[objectStack.length - 1]);\n  const item = assign({}, context);\n  item.node = node;\n  let value;\n  if (Array.isArray(geometry)) {\n    if (context.dataProjection) {\n      value = transformExtent(\n        geometry, context.featureProjection, context.dataProjection);\n    } else {\n      value = geometry;\n    }\n  } else {\n    value = transformWithOptions(/** @type {module:ol/geom/Geometry} */ (geometry), true, context);\n  }\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    (item), this.GEOMETRY_SERIALIZERS_,\n    this.GEOMETRY_NODE_FACTORY_, [value],\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Node stack.\n */\nGML3.prototype.writeFeatureElement = function(node, feature, objectStack) {\n  const fid = feature.getId();\n  if (fid) {\n    node.setAttribute('fid', fid);\n  }\n  const context = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const featureNS = context['featureNS'];\n  const geometryName = feature.getGeometryName();\n  if (!context.serializers) {\n    context.serializers = {};\n    context.serializers[featureNS] = {};\n  }\n  const properties = feature.getProperties();\n  const keys = [];\n  const values = [];\n  for (const key in properties) {\n    const value = properties[key];\n    if (value !== null) {\n      keys.push(key);\n      values.push(value);\n      if (key == geometryName || value instanceof Geometry) {\n        if (!(key in context.serializers[featureNS])) {\n          context.serializers[featureNS][key] = makeChildAppender(\n            this.writeGeometryElement, this);\n        }\n      } else {\n        if (!(key in context.serializers[featureNS])) {\n          context.serializers[featureNS][key] = makeChildAppender(writeStringTextNode);\n        }\n      }\n    }\n  }\n  const item = assign({}, context);\n  item.node = node;\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    (item), context.serializers,\n    makeSimpleNodeFactory(undefined, featureNS),\n    values,\n    objectStack, keys);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML3.prototype.writeFeatureMembers_ = function(node, features, objectStack) {\n  const context = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const featureType = context['featureType'];\n  const featureNS = context['featureNS'];\n  const serializers = {};\n  serializers[featureNS] = {};\n  serializers[featureNS][featureType] = makeChildAppender(\n    this.writeFeatureElement, this);\n  const item = assign({}, context);\n  item.node = node;\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    (item),\n    serializers,\n    makeSimpleNodeFactory(featureType, featureNS), features,\n    objectStack);\n};\n\n\n/**\n * @const\n * @type {Object.<string, string>}\n */\nconst MULTIGEOMETRY_TO_MEMBER_NODENAME = {\n  'MultiLineString': 'lineStringMember',\n  'MultiCurve': 'curveMember',\n  'MultiPolygon': 'polygonMember',\n  'MultiSurface': 'surfaceMember'\n};\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n * @private\n */\nGML3.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const parentNode = objectStack[objectStack.length - 1].node;\n  return createElementNS('http://www.opengis.net/gml',\n    MULTIGEOMETRY_TO_MEMBER_NODENAME[parentNode.nodeName]);\n};\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n * @private\n */\nGML3.prototype.GEOMETRY_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const context = objectStack[objectStack.length - 1];\n  const multiSurface = context['multiSurface'];\n  const surface = context['surface'];\n  const curve = context['curve'];\n  const multiCurve = context['multiCurve'];\n  let nodeName;\n  if (!Array.isArray(value)) {\n    nodeName = /** @type {module:ol/geom/Geometry} */ (value).getType();\n    if (nodeName === 'MultiPolygon' && multiSurface === true) {\n      nodeName = 'MultiSurface';\n    } else if (nodeName === 'Polygon' && surface === true) {\n      nodeName = 'Surface';\n    } else if (nodeName === 'LineString' && curve === true) {\n      nodeName = 'Curve';\n    } else if (nodeName === 'MultiLineString' && multiCurve === true) {\n      nodeName = 'MultiCurve';\n    }\n  } else {\n    nodeName = 'Envelope';\n  }\n  return createElementNS('http://www.opengis.net/gml',\n    nodeName);\n};\n\n\n/**\n * Encode a geometry in GML 3.1.1 Simple Features.\n *\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n * @override\n * @api\n */\nGML3.prototype.writeGeometryNode = function(geometry, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const geom = createElementNS('http://www.opengis.net/gml', 'geom');\n  const context = {node: geom, hasZ: this.hasZ, srsName: this.srsName,\n    curve: this.curve_, surface: this.surface_,\n    multiSurface: this.multiSurface_, multiCurve: this.multiCurve_};\n  if (opt_options) {\n    assign(context, opt_options);\n  }\n  this.writeGeometryElement(geom, geometry, [context]);\n  return geom;\n};\n\n\n/**\n * Encode an array of features in GML 3.1.1 Simple Features.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {string} Result.\n * @api\n */\nGML3.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features in the GML 3.1.1 format as an XML node.\n *\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n * @override\n * @api\n */\nGML3.prototype.writeFeaturesNode = function(features, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const node = createElementNS('http://www.opengis.net/gml', 'featureMembers');\n  node.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', this.schemaLocation);\n  const context = {\n    srsName: this.srsName,\n    hasZ: this.hasZ,\n    curve: this.curve_,\n    surface: this.surface_,\n    multiSurface: this.multiSurface_,\n    multiCurve: this.multiCurve_,\n    featureNS: this.featureNS,\n    featureType: this.featureType\n  };\n  if (opt_options) {\n    assign(context, opt_options);\n  }\n  this.writeFeatureMembers_(node, features, [context]);\n  return node;\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.RING_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'exterior': makeChildAppender(GML3.prototype.writeRing_),\n    'interior': makeChildAppender(GML3.prototype.writeRing_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.ENVELOPE_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'lowerCorner': makeChildAppender(writeStringTextNode),\n    'upperCorner': makeChildAppender(writeStringTextNode)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'surfaceMember': makeChildAppender(\n      GML3.prototype.writeSurfaceOrPolygonMember_),\n    'polygonMember': makeChildAppender(\n      GML3.prototype.writeSurfaceOrPolygonMember_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.POINTMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'pointMember': makeChildAppender(\n      GML3.prototype.writePointMember_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'lineStringMember': makeChildAppender(\n      GML3.prototype.writeLineStringOrCurveMember_),\n    'curveMember': makeChildAppender(\n      GML3.prototype.writeLineStringOrCurveMember_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML3.prototype.GEOMETRY_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'Curve': makeChildAppender(\n      GML3.prototype.writeCurveOrLineString_),\n    'MultiCurve': makeChildAppender(\n      GML3.prototype.writeMultiCurveOrLineString_),\n    'Point': makeChildAppender(GML3.prototype.writePoint_),\n    'MultiPoint': makeChildAppender(\n      GML3.prototype.writeMultiPoint_),\n    'LineString': makeChildAppender(\n      GML3.prototype.writeCurveOrLineString_),\n    'MultiLineString': makeChildAppender(\n      GML3.prototype.writeMultiCurveOrLineString_),\n    'LinearRing': makeChildAppender(\n      GML3.prototype.writeLinearRing_),\n    'Polygon': makeChildAppender(\n      GML3.prototype.writeSurfaceOrPolygon_),\n    'MultiPolygon': makeChildAppender(\n      GML3.prototype.writeMultiSurfaceOrPolygon_),\n    'Surface': makeChildAppender(\n      GML3.prototype.writeSurfaceOrPolygon_),\n    'MultiSurface': makeChildAppender(\n      GML3.prototype.writeMultiSurfaceOrPolygon_),\n    'Envelope': makeChildAppender(\n      GML3.prototype.writeEnvelope)\n  }\n};\n\n\nexport default GML3;\n","/**\n * @module ol/format/GML\n */\nimport GML3 from '../format/GML3.js';\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GML format\n * version 3.1.1.\n * Currently only supports GML 3.1.1 Simple Features profile.\n *\n * @constructor\n * @param {module:ol/format/GMLBase~Options=} opt_options\n *     Optional configuration object.\n * @extends {module:ol/format/GMLBase}\n * @api\n */\nconst GML = GML3;\n\n\n/**\n * Encode an array of features in GML 3.1.1 Simple Features.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {string} Result.\n * @api\n */\nGML.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features in the GML 3.1.1 format as an XML node.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n * @api\n */\nGML.prototype.writeFeaturesNode;\n\nexport default GML;\n","/**\n * @module ol/format/GML2\n */\nimport {inherits} from '../util.js';\nimport {createOrUpdate} from '../extent.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport GMLBase, {GMLNS} from '../format/GMLBase.js';\nimport {writeStringTextNode} from '../format/xsd.js';\nimport Geometry from '../geom/Geometry.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection, transformExtent} from '../proj.js';\nimport {createElementNS, getAllTextContent, makeArrayPusher, makeChildAppender,\n  makeReplacer, makeSimpleNodeFactory, OBJECT_PROPERTY_NODE_FACTORY, pushParseAndPop, pushSerializeAndPop} from '../xml.js';\n\n\n/**\n * @const\n * @type {string}\n */\nconst schemaLocation = GMLNS + ' http://schemas.opengis.net/gml/2.1.2/feature.xsd';\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GML format,\n * version 2.1.2.\n *\n * @constructor\n * @param {module:ol/format/GMLBase~Options=} opt_options Optional configuration object.\n * @extends {module:ol/format/GMLBase}\n * @api\n */\nconst GML2 = function(opt_options) {\n  const options = /** @type {module:ol/format/GMLBase~Options} */\n      (opt_options ? opt_options : {});\n\n  GMLBase.call(this, options);\n\n  this.FEATURE_COLLECTION_PARSERS[GMLNS][\n    'featureMember'] =\n      makeArrayPusher(GMLBase.prototype.readFeaturesInternal);\n\n  /**\n   * @inheritDoc\n   */\n  this.schemaLocation = options.schemaLocation ?\n    options.schemaLocation : schemaLocation;\n\n};\n\ninherits(GML2, GMLBase);\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<number>|undefined} Flat coordinates.\n */\nGML2.prototype.readFlatCoordinates_ = function(node, objectStack) {\n  const s = getAllTextContent(node, false).replace(/^\\s*|\\s*$/g, '');\n  const context = /** @type {module:ol/xml~NodeStackItem} */ (objectStack[0]);\n  const containerSrs = context['srsName'];\n  let axisOrientation = 'enu';\n  if (containerSrs) {\n    const proj = getProjection(containerSrs);\n    if (proj) {\n      axisOrientation = proj.getAxisOrientation();\n    }\n  }\n  const coordsGroups = s.trim().split(/\\s+/);\n  const flatCoordinates = [];\n  for (let i = 0, ii = coordsGroups.length; i < ii; i++) {\n    const coords = coordsGroups[i].split(/,+/);\n    const x = parseFloat(coords[0]);\n    const y = parseFloat(coords[1]);\n    const z = (coords.length === 3) ? parseFloat(coords[2]) : 0;\n    if (axisOrientation.substr(0, 2) === 'en') {\n      flatCoordinates.push(x, y, z);\n    } else {\n      flatCoordinates.push(y, x, z);\n    }\n  }\n  return flatCoordinates;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/extent~Extent|undefined} Envelope.\n */\nGML2.prototype.readBox_ = function(node, objectStack) {\n  /** @type {Array.<number>} */\n  const flatCoordinates = pushParseAndPop([null],\n    this.BOX_PARSERS_, node, objectStack, this);\n  return createOrUpdate(flatCoordinates[1][0],\n    flatCoordinates[1][1], flatCoordinates[1][3],\n    flatCoordinates[1][4]);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML2.prototype.innerBoundaryIsParser_ = function(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    this.RING_PARSERS, node, objectStack, this);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings.push(flatLinearRing);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nGML2.prototype.outerBoundaryIsParser_ = function(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    this.RING_PARSERS, node, objectStack, this);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings[0] = flatLinearRing;\n  }\n};\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n * @private\n */\nGML2.prototype.GEOMETRY_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const context = objectStack[objectStack.length - 1];\n  const multiSurface = context['multiSurface'];\n  const surface = context['surface'];\n  const multiCurve = context['multiCurve'];\n  let nodeName;\n  if (!Array.isArray(value)) {\n    nodeName = /** @type {module:ol/geom/Geometry} */ (value).getType();\n    if (nodeName === 'MultiPolygon' && multiSurface === true) {\n      nodeName = 'MultiSurface';\n    } else if (nodeName === 'Polygon' && surface === true) {\n      nodeName = 'Surface';\n    } else if (nodeName === 'MultiLineString' && multiCurve === true) {\n      nodeName = 'MultiCurve';\n    }\n  } else {\n    nodeName = 'Envelope';\n  }\n  return createElementNS('http://www.opengis.net/gml',\n    nodeName);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Node stack.\n */\nGML2.prototype.writeFeatureElement = function(node, feature, objectStack) {\n  const fid = feature.getId();\n  if (fid) {\n    node.setAttribute('fid', fid);\n  }\n  const context = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const featureNS = context['featureNS'];\n  const geometryName = feature.getGeometryName();\n  if (!context.serializers) {\n    context.serializers = {};\n    context.serializers[featureNS] = {};\n  }\n  const properties = feature.getProperties();\n  const keys = [];\n  const values = [];\n  for (const key in properties) {\n    const value = properties[key];\n    if (value !== null) {\n      keys.push(key);\n      values.push(value);\n      if (key == geometryName || value instanceof Geometry) {\n        if (!(key in context.serializers[featureNS])) {\n          context.serializers[featureNS][key] = makeChildAppender(\n            this.writeGeometryElement, this);\n        }\n      } else {\n        if (!(key in context.serializers[featureNS])) {\n          context.serializers[featureNS][key] = makeChildAppender(writeStringTextNode);\n        }\n      }\n    }\n  }\n  const item = assign({}, context);\n  item.node = node;\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    (item), context.serializers,\n    makeSimpleNodeFactory(undefined, featureNS),\n    values,\n    objectStack, keys);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} geometry LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeCurveOrLineString_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (node.nodeName !== 'LineStringSegment' && srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  if (node.nodeName === 'LineString' ||\n      node.nodeName === 'LineStringSegment') {\n    const coordinates = this.createCoordinatesNode_(node.namespaceURI);\n    node.appendChild(coordinates);\n    this.writeCoordinates_(coordinates, geometry, objectStack);\n  } else if (node.nodeName === 'Curve') {\n    const segments = createElementNS(node.namespaceURI, 'segments');\n    node.appendChild(segments);\n    this.writeCurveSegments_(segments,\n      geometry, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} line LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeLineStringOrCurveMember_ = function(node, line, objectStack) {\n  const child = this.GEOMETRY_NODE_FACTORY_(line, objectStack);\n  if (child) {\n    node.appendChild(child);\n    this.writeCurveOrLineString_(child, line, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiLineString} geometry MultiLineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeMultiCurveOrLineString_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  const curve = context['curve'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const lines = geometry.getLineStrings();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName, curve: curve},\n    this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,\n    this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_, lines,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Geometry|module:ol/extent~Extent} geometry Geometry.\n * @param {Array.<*>} objectStack Node stack.\n */\nGML2.prototype.writeGeometryElement = function(node, geometry, objectStack) {\n  const context = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[objectStack.length - 1]);\n  const item = assign({}, context);\n  item.node = node;\n  let value;\n  if (Array.isArray(geometry)) {\n    if (context.dataProjection) {\n      value = transformExtent(\n        geometry, context.featureProjection, context.dataProjection);\n    } else {\n      value = geometry;\n    }\n  } else {\n    value = transformWithOptions(/** @type {module:ol/geom/Geometry} */ (geometry), true, context);\n  }\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    (item), this.GEOMETRY_SERIALIZERS_,\n    this.GEOMETRY_NODE_FACTORY_, [value],\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {string} namespaceURI XML namespace.\n * @returns {Node} coordinates node.\n * @private\n */\nGML2.prototype.createCoordinatesNode_ = function(namespaceURI) {\n  const coordinates = createElementNS(namespaceURI, 'coordinates');\n  coordinates.setAttribute('decimal', '.');\n  coordinates.setAttribute('cs', ',');\n  coordinates.setAttribute('ts', ' ');\n\n  return coordinates;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString|module:ol/geom/LinearRing} value Geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeCoordinates_ = function(node, value, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  // only 2d for simple features profile\n  const points = value.getCoordinates();\n  const len = points.length;\n  const parts = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    const point = points[i];\n    parts[i] = this.getCoords_(point, srsName, hasZ);\n  }\n  writeStringTextNode(node, parts.join(' '));\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} line LineString geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeCurveSegments_ = function(node, line, objectStack) {\n  const child = createElementNS(node.namespaceURI, 'LineStringSegment');\n  node.appendChild(child);\n  this.writeCurveOrLineString_(child, line, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} geometry Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeSurfaceOrPolygon_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  if (node.nodeName !== 'PolygonPatch' && srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  if (node.nodeName === 'Polygon' || node.nodeName === 'PolygonPatch') {\n    const rings = geometry.getLinearRings();\n    pushSerializeAndPop(\n      {node: node, hasZ: hasZ, srsName: srsName},\n      this.RING_SERIALIZERS_,\n      this.RING_NODE_FACTORY_,\n      rings, objectStack, undefined, this);\n  } else if (node.nodeName === 'Surface') {\n    const patches = createElementNS(node.namespaceURI, 'patches');\n    node.appendChild(patches);\n    this.writeSurfacePatches_(\n      patches, geometry, objectStack);\n  }\n};\n\n\n/**\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node} Node.\n * @private\n */\nGML2.prototype.RING_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const context = objectStack[objectStack.length - 1];\n  const parentNode = context.node;\n  const exteriorWritten = context['exteriorWritten'];\n  if (exteriorWritten === undefined) {\n    context['exteriorWritten'] = true;\n  }\n  return createElementNS(parentNode.namespaceURI,\n    exteriorWritten !== undefined ? 'innerBoundaryIs' : 'outerBoundaryIs');\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} polygon Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeSurfacePatches_ = function(node, polygon, objectStack) {\n  const child = createElementNS(node.namespaceURI, 'PolygonPatch');\n  node.appendChild(child);\n  this.writeSurfaceOrPolygon_(child, polygon, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LinearRing} ring LinearRing geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeRing_ = function(node, ring, objectStack) {\n  const linearRing = createElementNS(node.namespaceURI, 'LinearRing');\n  node.appendChild(linearRing);\n  this.writeLinearRing_(linearRing, ring, objectStack);\n};\n\n\n/**\n * @param {Array.<number>} point Point geometry.\n * @param {string=} opt_srsName Optional srsName\n * @param {boolean=} opt_hasZ whether the geometry has a Z coordinate (is 3D) or not.\n * @return {string} The coords string.\n * @private\n */\nGML2.prototype.getCoords_ = function(point, opt_srsName, opt_hasZ) {\n  let axisOrientation = 'enu';\n  if (opt_srsName) {\n    axisOrientation = getProjection(opt_srsName).getAxisOrientation();\n  }\n  let coords = ((axisOrientation.substr(0, 2) === 'en') ?\n    point[0] + ',' + point[1] :\n    point[1] + ',' + point[0]);\n  if (opt_hasZ) {\n    // For newly created points, Z can be undefined.\n    const z = point[2] || 0;\n    coords += ',' + z;\n  }\n\n  return coords;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Point} geometry Point geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writePoint_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const coordinates = this.createCoordinatesNode_(node.namespaceURI);\n  node.appendChild(coordinates);\n  const point = geometry.getCoordinates();\n  const coord = this.getCoords_(point, srsName, hasZ);\n  writeStringTextNode(coordinates, coord);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiPoint} geometry MultiPoint geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeMultiPoint_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const points = geometry.getPoints();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName},\n    this.POINTMEMBER_SERIALIZERS_,\n    makeSimpleNodeFactory('pointMember'), points,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Point} point Point geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writePointMember_ = function(node, point, objectStack) {\n  const child = createElementNS(node.namespaceURI, 'Point');\n  node.appendChild(child);\n  this.writePoint_(child, point, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LinearRing} geometry LinearRing geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeLinearRing_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const coordinates = this.createCoordinatesNode_(node.namespaceURI);\n  node.appendChild(coordinates);\n  this.writeCoordinates_(coordinates, geometry, objectStack);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/MultiPolygon} geometry MultiPolygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeMultiSurfaceOrPolygon_ = function(node, geometry, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const hasZ = context['hasZ'];\n  const srsName = context['srsName'];\n  const surface = context['surface'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const polygons = geometry.getPolygons();\n  pushSerializeAndPop({node: node, hasZ: hasZ, srsName: srsName, surface: surface},\n    this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,\n    this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_, polygons,\n    objectStack, undefined, this);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} polygon Polygon geometry.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeSurfaceOrPolygonMember_ = function(node, polygon, objectStack) {\n  const child = this.GEOMETRY_NODE_FACTORY_(\n    polygon, objectStack);\n  if (child) {\n    node.appendChild(child);\n    this.writeSurfaceOrPolygon_(child, polygon, objectStack);\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {Array.<*>} objectStack Node stack.\n * @private\n */\nGML2.prototype.writeEnvelope = function(node, extent, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const srsName = context['srsName'];\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  const keys = ['lowerCorner', 'upperCorner'];\n  const values = [extent[0] + ' ' + extent[1], extent[2] + ' ' + extent[3]];\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    ({node: node}), this.ENVELOPE_SERIALIZERS_,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    values,\n    objectStack, keys, this);\n};\n\n\n/**\n * @const\n * @type {Object.<string, string>}\n */\nconst MULTIGEOMETRY_TO_MEMBER_NODENAME = {\n  'MultiLineString': 'lineStringMember',\n  'MultiCurve': 'curveMember',\n  'MultiPolygon': 'polygonMember',\n  'MultiSurface': 'surfaceMember'\n};\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n * @private\n */\nGML2.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_ = function(value, objectStack, opt_nodeName) {\n  const parentNode = objectStack[objectStack.length - 1].node;\n  return createElementNS('http://www.opengis.net/gml',\n    MULTIGEOMETRY_TO_MEMBER_NODENAME[parentNode.nodeName]);\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML2.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'coordinates': makeReplacer(GML2.prototype.readFlatCoordinates_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML2.prototype.FLAT_LINEAR_RINGS_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'innerBoundaryIs': GML2.prototype.innerBoundaryIsParser_,\n    'outerBoundaryIs': GML2.prototype.outerBoundaryIsParser_\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML2.prototype.BOX_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'coordinates': makeArrayPusher(\n      GML2.prototype.readFlatCoordinates_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n * @private\n */\nGML2.prototype.GEOMETRY_PARSERS_ = {\n  'http://www.opengis.net/gml': {\n    'Point': makeReplacer(GMLBase.prototype.readPoint),\n    'MultiPoint': makeReplacer(\n      GMLBase.prototype.readMultiPoint),\n    'LineString': makeReplacer(\n      GMLBase.prototype.readLineString),\n    'MultiLineString': makeReplacer(\n      GMLBase.prototype.readMultiLineString),\n    'LinearRing': makeReplacer(\n      GMLBase.prototype.readLinearRing),\n    'Polygon': makeReplacer(GMLBase.prototype.readPolygon),\n    'MultiPolygon': makeReplacer(\n      GMLBase.prototype.readMultiPolygon),\n    'Box': makeReplacer(GML2.prototype.readBox_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.GEOMETRY_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'Curve': makeChildAppender(\n      GML2.prototype.writeCurveOrLineString_),\n    'MultiCurve': makeChildAppender(\n      GML2.prototype.writeMultiCurveOrLineString_),\n    'Point': makeChildAppender(GML2.prototype.writePoint_),\n    'MultiPoint': makeChildAppender(\n      GML2.prototype.writeMultiPoint_),\n    'LineString': makeChildAppender(\n      GML2.prototype.writeCurveOrLineString_),\n    'MultiLineString': makeChildAppender(\n      GML2.prototype.writeMultiCurveOrLineString_),\n    'LinearRing': makeChildAppender(\n      GML2.prototype.writeLinearRing_),\n    'Polygon': makeChildAppender(\n      GML2.prototype.writeSurfaceOrPolygon_),\n    'MultiPolygon': makeChildAppender(\n      GML2.prototype.writeMultiSurfaceOrPolygon_),\n    'Surface': makeChildAppender(\n      GML2.prototype.writeSurfaceOrPolygon_),\n    'MultiSurface': makeChildAppender(\n      GML2.prototype.writeMultiSurfaceOrPolygon_),\n    'Envelope': makeChildAppender(\n      GML2.prototype.writeEnvelope)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'lineStringMember': makeChildAppender(\n      GML2.prototype.writeLineStringOrCurveMember_),\n    'curveMember': makeChildAppender(\n      GML2.prototype.writeLineStringOrCurveMember_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.RING_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'outerBoundaryIs': makeChildAppender(GML2.prototype.writeRing_),\n    'innerBoundaryIs': makeChildAppender(GML2.prototype.writeRing_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.POINTMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'pointMember': makeChildAppender(\n      GML2.prototype.writePointMember_)\n  }\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'surfaceMember': makeChildAppender(\n      GML2.prototype.writeSurfaceOrPolygonMember_),\n    'polygonMember': makeChildAppender(\n      GML2.prototype.writeSurfaceOrPolygonMember_)\n  }\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n * @private\n */\nGML2.prototype.ENVELOPE_SERIALIZERS_ = {\n  'http://www.opengis.net/gml': {\n    'lowerCorner': makeChildAppender(writeStringTextNode),\n    'upperCorner': makeChildAppender(writeStringTextNode)\n  }\n};\n\nexport default GML2;\n","/**\n * @module ol/format/GPX\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {includes} from '../array.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport {readString, readDecimal, readNonNegativeInteger, readDateTime, writeStringTextNode, writeNonNegativeIntegerTextNode, writeDecimalTextNode, writeDateTimeTextNode} from '../format/xsd.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport Point from '../geom/Point.js';\nimport {get as getProjection} from '../proj.js';\nimport {createElementNS, makeArrayPusher, makeArraySerializer, makeChildAppender,\n  makeObjectPropertySetter, makeSequence, makeSimpleNodeFactory, makeStructureNS,\n  OBJECT_PROPERTY_NODE_FACTORY, parseNode, pushParseAndPop, pushSerializeAndPop,\n  XML_SCHEMA_INSTANCE_URI} from '../xml.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {function(module:ol/Feature, Node)} [readExtensions] Callback function\n * to process `extensions` nodes. To prevent memory leaks, this callback function must\n * not store any references to the node. Note that the `extensions`\n * node is not allowed in GPX 1.0. Moreover, only `extensions`\n * nodes from `wpt`, `rte` and `trk` can be processed, as those are\n * directly mapped to a feature.\n */\n\n/**\n * @typedef {Object} LayoutOptions\n * @property {boolean} [hasZ]\n * @property {boolean} [hasM]\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GPX format.\n *\n * @constructor\n * @extends {module:ol/format/XMLFeature}\n * @param {module:ol/format/GPX~Options=} opt_options Options.\n * @api\n */\nconst GPX = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  XMLFeature.call(this);\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection('EPSG:4326');\n\n  /**\n   * @type {function(module:ol/Feature, Node)|undefined}\n   * @private\n   */\n  this.readExtensions_ = options.readExtensions;\n};\n\ninherits(GPX, XMLFeature);\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst NAMESPACE_URIS = [\n  null,\n  'http://www.topografix.com/GPX/1/0',\n  'http://www.topografix.com/GPX/1/1'\n];\n\n\n/**\n * @const\n * @type {string}\n */\nconst SCHEMA_LOCATION = 'http://www.topografix.com/GPX/1/1 ' +\n    'http://www.topografix.com/GPX/1/1/gpx.xsd';\n\n\n/**\n * @const\n * @type {Object.<string, function(Node, Array.<*>): (module:ol/Feature|undefined)>}\n */\nconst FEATURE_READER = {\n  'rte': readRte,\n  'trk': readTrk,\n  'wpt': readWpt\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst GPX_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'rte': makeArrayPusher(readRte),\n    'trk': makeArrayPusher(readTrk),\n    'wpt': makeArrayPusher(readWpt)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LINK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'text': makeObjectPropertySetter(readString, 'linkText'),\n    'type': makeObjectPropertySetter(readString, 'linkType')\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst RTE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'name': makeObjectPropertySetter(readString),\n    'cmt': makeObjectPropertySetter(readString),\n    'desc': makeObjectPropertySetter(readString),\n    'src': makeObjectPropertySetter(readString),\n    'link': parseLink,\n    'number': makeObjectPropertySetter(readNonNegativeInteger),\n    'extensions': parseExtensions,\n    'type': makeObjectPropertySetter(readString),\n    'rtept': parseRtePt\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst RTEPT_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ele': makeObjectPropertySetter(readDecimal),\n    'time': makeObjectPropertySetter(readDateTime)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TRK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'name': makeObjectPropertySetter(readString),\n    'cmt': makeObjectPropertySetter(readString),\n    'desc': makeObjectPropertySetter(readString),\n    'src': makeObjectPropertySetter(readString),\n    'link': parseLink,\n    'number': makeObjectPropertySetter(readNonNegativeInteger),\n    'type': makeObjectPropertySetter(readString),\n    'extensions': parseExtensions,\n    'trkseg': parseTrkSeg\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TRKSEG_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'trkpt': parseTrkPt\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TRKPT_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ele': makeObjectPropertySetter(readDecimal),\n    'time': makeObjectPropertySetter(readDateTime)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst WPT_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ele': makeObjectPropertySetter(readDecimal),\n    'time': makeObjectPropertySetter(readDateTime),\n    'magvar': makeObjectPropertySetter(readDecimal),\n    'geoidheight': makeObjectPropertySetter(readDecimal),\n    'name': makeObjectPropertySetter(readString),\n    'cmt': makeObjectPropertySetter(readString),\n    'desc': makeObjectPropertySetter(readString),\n    'src': makeObjectPropertySetter(readString),\n    'link': parseLink,\n    'sym': makeObjectPropertySetter(readString),\n    'type': makeObjectPropertySetter(readString),\n    'fix': makeObjectPropertySetter(readString),\n    'sat': makeObjectPropertySetter(readNonNegativeInteger),\n    'hdop': makeObjectPropertySetter(readDecimal),\n    'vdop': makeObjectPropertySetter(readDecimal),\n    'pdop': makeObjectPropertySetter(readDecimal),\n    'ageofdgpsdata': makeObjectPropertySetter(readDecimal),\n    'dgpsid': makeObjectPropertySetter(readNonNegativeInteger),\n    'extensions': parseExtensions\n  });\n\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst LINK_SEQUENCE = ['text', 'type'];\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst LINK_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'text': makeChildAppender(writeStringTextNode),\n    'type': makeChildAppender(writeStringTextNode)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst RTE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'name', 'cmt', 'desc', 'src', 'link', 'number', 'type', 'rtept'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst RTE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'name': makeChildAppender(writeStringTextNode),\n    'cmt': makeChildAppender(writeStringTextNode),\n    'desc': makeChildAppender(writeStringTextNode),\n    'src': makeChildAppender(writeStringTextNode),\n    'link': makeChildAppender(writeLink),\n    'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n    'type': makeChildAppender(writeStringTextNode),\n    'rtept': makeArraySerializer(makeChildAppender(writeWptType))\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst RTEPT_TYPE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'ele', 'time'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst TRK_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'name', 'cmt', 'desc', 'src', 'link', 'number', 'type', 'trkseg'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst TRK_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'name': makeChildAppender(writeStringTextNode),\n    'cmt': makeChildAppender(writeStringTextNode),\n    'desc': makeChildAppender(writeStringTextNode),\n    'src': makeChildAppender(writeStringTextNode),\n    'link': makeChildAppender(writeLink),\n    'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n    'type': makeChildAppender(writeStringTextNode),\n    'trkseg': makeArraySerializer(makeChildAppender(writeTrkSeg))\n  });\n\n\n/**\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst TRKSEG_NODE_FACTORY = makeSimpleNodeFactory('trkpt');\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst TRKSEG_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'trkpt': makeChildAppender(writeWptType)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst WPT_TYPE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'ele', 'time', 'magvar', 'geoidheight', 'name', 'cmt', 'desc', 'src',\n    'link', 'sym', 'type', 'fix', 'sat', 'hdop', 'vdop', 'pdop',\n    'ageofdgpsdata', 'dgpsid'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst WPT_TYPE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ele': makeChildAppender(writeDecimalTextNode),\n    'time': makeChildAppender(writeDateTimeTextNode),\n    'magvar': makeChildAppender(writeDecimalTextNode),\n    'geoidheight': makeChildAppender(writeDecimalTextNode),\n    'name': makeChildAppender(writeStringTextNode),\n    'cmt': makeChildAppender(writeStringTextNode),\n    'desc': makeChildAppender(writeStringTextNode),\n    'src': makeChildAppender(writeStringTextNode),\n    'link': makeChildAppender(writeLink),\n    'sym': makeChildAppender(writeStringTextNode),\n    'type': makeChildAppender(writeStringTextNode),\n    'fix': makeChildAppender(writeStringTextNode),\n    'sat': makeChildAppender(writeNonNegativeIntegerTextNode),\n    'hdop': makeChildAppender(writeDecimalTextNode),\n    'vdop': makeChildAppender(writeDecimalTextNode),\n    'pdop': makeChildAppender(writeDecimalTextNode),\n    'ageofdgpsdata': makeChildAppender(writeDecimalTextNode),\n    'dgpsid': makeChildAppender(writeNonNegativeIntegerTextNode)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, string>}\n */\nconst GEOMETRY_TYPE_TO_NODENAME = {\n  'Point': 'wpt',\n  'LineString': 'rte',\n  'MultiLineString': 'trk'\n};\n\n\n/**\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n */\nfunction GPX_NODE_FACTORY(value, objectStack, opt_nodeName) {\n  const geometry = /** @type {module:ol/Feature} */ (value).getGeometry();\n  if (geometry) {\n    const nodeName = GEOMETRY_TYPE_TO_NODENAME[geometry.getType()];\n    if (nodeName) {\n      const parentNode = objectStack[objectStack.length - 1].node;\n      return createElementNS(parentNode.namespaceURI, nodeName);\n    }\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst GPX_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'rte': makeChildAppender(writeRte),\n    'trk': makeChildAppender(writeTrk),\n    'wpt': makeChildAppender(writeWpt)\n  });\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {module:ol/format/GPX~LayoutOptions} layoutOptions Layout options.\n * @param {Node} node Node.\n * @param {!Object} values Values.\n * @return {Array.<number>} Flat coordinates.\n */\nfunction appendCoordinate(flatCoordinates, layoutOptions, node, values) {\n  flatCoordinates.push(\n    parseFloat(node.getAttribute('lon')),\n    parseFloat(node.getAttribute('lat')));\n  if ('ele' in values) {\n    flatCoordinates.push(/** @type {number} */ (values['ele']));\n    delete values['ele'];\n    layoutOptions.hasZ = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  if ('time' in values) {\n    flatCoordinates.push(/** @type {number} */ (values['time']));\n    delete values['time'];\n    layoutOptions.hasM = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  return flatCoordinates;\n}\n\n\n/**\n * Choose GeometryLayout based on flags in layoutOptions and adjust flatCoordinates\n * and ends arrays by shrinking them accordingly (removing unused zero entries).\n *\n * @param {module:ol/format/GPX~LayoutOptions} layoutOptions Layout options.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<number>=} ends Ends.\n * @return {module:ol/geom/GeometryLayout} Layout.\n */\nfunction applyLayoutOptions(layoutOptions, flatCoordinates, ends) {\n  let layout = GeometryLayout.XY;\n  let stride = 2;\n  if (layoutOptions.hasZ && layoutOptions.hasM) {\n    layout = GeometryLayout.XYZM;\n    stride = 4;\n  } else if (layoutOptions.hasZ) {\n    layout = GeometryLayout.XYZ;\n    stride = 3;\n  } else if (layoutOptions.hasM) {\n    layout = GeometryLayout.XYM;\n    stride = 3;\n  }\n  if (stride !== 4) {\n    for (let i = 0, ii = flatCoordinates.length / 4; i < ii; i++) {\n      flatCoordinates[i * stride] = flatCoordinates[i * 4];\n      flatCoordinates[i * stride + 1] = flatCoordinates[i * 4 + 1];\n      if (layoutOptions.hasZ) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 2];\n      }\n      if (layoutOptions.hasM) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 3];\n      }\n    }\n    flatCoordinates.length = flatCoordinates.length / 4 * stride;\n    if (ends) {\n      for (let i = 0, ii = ends.length; i < ii; i++) {\n        ends[i] = ends[i] / 4 * stride;\n      }\n    }\n  }\n  return layout;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction parseLink(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const href = node.getAttribute('href');\n  if (href !== null) {\n    values['link'] = href;\n  }\n  parseNode(LINK_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction parseExtensions(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  values['extensionsNode_'] = node;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction parseRtePt(node, objectStack) {\n  const values = pushParseAndPop({}, RTEPT_PARSERS, node, objectStack);\n  if (values) {\n    const rteValues = /** @type {!Object} */ (objectStack[objectStack.length - 1]);\n    const flatCoordinates = /** @type {Array.<number>} */ (rteValues['flatCoordinates']);\n    const layoutOptions = /** @type {module:ol/format/GPX~LayoutOptions} */ (rteValues['layoutOptions']);\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction parseTrkPt(node, objectStack) {\n  const values = pushParseAndPop({}, TRKPT_PARSERS, node, objectStack);\n  if (values) {\n    const trkValues = /** @type {!Object} */ (objectStack[objectStack.length - 1]);\n    const flatCoordinates = /** @type {Array.<number>} */ (trkValues['flatCoordinates']);\n    const layoutOptions = /** @type {module:ol/format/GPX~LayoutOptions} */ (trkValues['layoutOptions']);\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction parseTrkSeg(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  parseNode(TRKSEG_PARSERS, node, objectStack);\n  const flatCoordinates = /** @type {Array.<number>} */\n      (values['flatCoordinates']);\n  const ends = /** @type {Array.<number>} */ (values['ends']);\n  ends.push(flatCoordinates.length);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/Feature|undefined} Track.\n */\nfunction readRte(node, objectStack) {\n  const options = /** @type {module:ol/format/Feature~ReadOptions} */ (objectStack[0]);\n  const values = pushParseAndPop({\n    'flatCoordinates': [],\n    'layoutOptions': {}\n  }, RTE_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates = /** @type {Array.<number>} */\n      (values['flatCoordinates']);\n  delete values['flatCoordinates'];\n  const layoutOptions = /** @type {module:ol/format/GPX~LayoutOptions} */ (values['layoutOptions']);\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates);\n  const geometry = new LineString(null);\n  geometry.setFlatCoordinates(layout, flatCoordinates);\n  transformWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values);\n  return feature;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/Feature|undefined} Track.\n */\nfunction readTrk(node, objectStack) {\n  const options = /** @type {module:ol/format/Feature~ReadOptions} */ (objectStack[0]);\n  const values = pushParseAndPop({\n    'flatCoordinates': [],\n    'ends': [],\n    'layoutOptions': {}\n  }, TRK_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates = /** @type {Array.<number>} */\n      (values['flatCoordinates']);\n  delete values['flatCoordinates'];\n  const ends = /** @type {Array.<number>} */ (values['ends']);\n  delete values['ends'];\n  const layoutOptions = /** @type {module:ol/format/GPX~LayoutOptions} */ (values['layoutOptions']);\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates, ends);\n  const geometry = new MultiLineString(null);\n  geometry.setFlatCoordinates(layout, flatCoordinates, ends);\n  transformWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values);\n  return feature;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/Feature|undefined} Waypoint.\n */\nfunction readWpt(node, objectStack) {\n  const options = /** @type {module:ol/format/Feature~ReadOptions} */ (objectStack[0]);\n  const values = pushParseAndPop({}, WPT_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const layoutOptions = /** @type {module:ol/format/GPX~LayoutOptions} */ ({});\n  const coordinates = appendCoordinate([], layoutOptions, node, values);\n  const layout = applyLayoutOptions(layoutOptions, coordinates);\n  const geometry = new Point(coordinates, layout);\n  transformWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values);\n  return feature;\n}\n\n\n/**\n * @param {Array.<module:ol/Feature>} features List of features.\n * @private\n */\nGPX.prototype.handleReadExtensions_ = function(features) {\n  if (!features) {\n    features = [];\n  }\n  for (let i = 0, ii = features.length; i < ii; ++i) {\n    const feature = features[i];\n    if (this.readExtensions_) {\n      const extensionsNode = feature.get('extensionsNode_') || null;\n      this.readExtensions_(feature, extensionsNode);\n    }\n    feature.set('extensionsNode_', undefined);\n  }\n};\n\n\n/**\n * Read the first feature from a GPX source.\n * Routes (`<rte>`) are converted into LineString geometries, and tracks (`<trk>`)\n * into MultiLineString. Any properties on route and track waypoints are ignored.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nGPX.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nGPX.prototype.readFeatureFromNode = function(node, opt_options) {\n  if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n    return null;\n  }\n  const featureReader = FEATURE_READER[node.localName];\n  if (!featureReader) {\n    return null;\n  }\n  const feature = featureReader(node, [this.getReadOptions(node, opt_options)]);\n  if (!feature) {\n    return null;\n  }\n  this.handleReadExtensions_([feature]);\n  return feature;\n};\n\n\n/**\n * Read all features from a GPX source.\n * Routes (`<rte>`) are converted into LineString geometries, and tracks (`<trk>`)\n * into MultiLineString. Any properties on route and track waypoints are ignored.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nGPX.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nGPX.prototype.readFeaturesFromNode = function(node, opt_options) {\n  if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n    return [];\n  }\n  if (node.localName == 'gpx') {\n    /** @type {Array.<module:ol/Feature>} */\n    const features = pushParseAndPop([], GPX_PARSERS,\n      node, [this.getReadOptions(node, opt_options)]);\n    if (features) {\n      this.handleReadExtensions_(features);\n      return features;\n    } else {\n      return [];\n    }\n  }\n  return [];\n};\n\n\n/**\n * Read the projection from a GPX source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nGPX.prototype.readProjection;\n\n\n/**\n * @param {Node} node Node.\n * @param {string} value Value for the link's `href` attribute.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeLink(node, value, objectStack) {\n  node.setAttribute('href', value);\n  const context = objectStack[objectStack.length - 1];\n  const properties = context['properties'];\n  const link = [\n    properties['linkText'],\n    properties['linkType']\n  ];\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */ ({node: node}),\n    LINK_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY,\n    link, objectStack, LINK_SEQUENCE);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeWptType(node, coordinate, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const parentNode = context.node;\n  const namespaceURI = parentNode.namespaceURI;\n  const properties = context['properties'];\n  //FIXME Projection handling\n  node.setAttributeNS(null, 'lat', coordinate[1]);\n  node.setAttributeNS(null, 'lon', coordinate[0]);\n  const geometryLayout = context['geometryLayout'];\n  switch (geometryLayout) {\n    case GeometryLayout.XYZM:\n      if (coordinate[3] !== 0) {\n        properties['time'] = coordinate[3];\n      }\n      // fall through\n    case GeometryLayout.XYZ:\n      if (coordinate[2] !== 0) {\n        properties['ele'] = coordinate[2];\n      }\n      break;\n    case GeometryLayout.XYM:\n      if (coordinate[2] !== 0) {\n        properties['time'] = coordinate[2];\n      }\n      break;\n    default:\n      // pass\n  }\n  const orderedKeys = (node.nodeName == 'rtept') ?\n    RTEPT_TYPE_SEQUENCE[namespaceURI] :\n    WPT_TYPE_SEQUENCE[namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    ({node: node, 'properties': properties}),\n    WPT_TYPE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY,\n    values, objectStack, orderedKeys);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeRte(node, feature, objectStack) {\n  const options = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[0]);\n  const properties = feature.getProperties();\n  const context = {node: node, 'properties': properties};\n  let geometry = feature.getGeometry();\n  if (geometry) {\n    geometry = /** @type {module:ol/geom/LineString} */ (transformWithOptions(geometry, true, options));\n    context['geometryLayout'] = geometry.getLayout();\n    properties['rtept'] = geometry.getCoordinates();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = RTE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context,\n    RTE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY,\n    values, objectStack, orderedKeys);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeTrk(node, feature, objectStack) {\n  const options = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[0]);\n  const properties = feature.getProperties();\n  /** @type {module:ol/xml~NodeStackItem} */\n  const context = {node: node, 'properties': properties};\n  let geometry = feature.getGeometry();\n  if (geometry) {\n    geometry = /** @type {module:ol/geom/MultiLineString} */\n      (transformWithOptions(geometry, true, options));\n    properties['trkseg'] = geometry.getLineStrings();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = TRK_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context,\n    TRK_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY,\n    values, objectStack, orderedKeys);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LineString} lineString LineString.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeTrkSeg(node, lineString, objectStack) {\n  /** @type {module:ol/xml~NodeStackItem} */\n  const context = {node: node, 'geometryLayout': lineString.getLayout(),\n    'properties': {}};\n  pushSerializeAndPop(context,\n    TRKSEG_SERIALIZERS, TRKSEG_NODE_FACTORY,\n    lineString.getCoordinates(), objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeWpt(node, feature, objectStack) {\n  const options = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[0]);\n  const context = objectStack[objectStack.length - 1];\n  context['properties'] = feature.getProperties();\n  let geometry = feature.getGeometry();\n  if (geometry) {\n    geometry = /** @type {module:ol/geom/Point} */\n      (transformWithOptions(geometry, true, options));\n    context['geometryLayout'] = geometry.getLayout();\n    writeWptType(node, geometry.getCoordinates(), objectStack);\n  }\n}\n\n\n/**\n * Encode an array of features in the GPX format.\n * LineString geometries are output as routes (`<rte>`), and MultiLineString\n * as tracks (`<trk>`).\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} Result.\n * @api\n */\nGPX.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features in the GPX format as an XML node.\n * LineString geometries are output as routes (`<rte>`), and MultiLineString\n * as tracks (`<trk>`).\n *\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n * @override\n * @api\n */\nGPX.prototype.writeFeaturesNode = function(features, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  //FIXME Serialize metadata\n  const gpx = createElementNS('http://www.topografix.com/GPX/1/1', 'gpx');\n  const xmlnsUri = 'http://www.w3.org/2000/xmlns/';\n  gpx.setAttributeNS(xmlnsUri, 'xmlns:xsi', XML_SCHEMA_INSTANCE_URI);\n  gpx.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', SCHEMA_LOCATION);\n  gpx.setAttribute('version', '1.1');\n  gpx.setAttribute('creator', 'OpenLayers');\n\n  pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */\n    ({node: gpx}), GPX_SERIALIZERS, GPX_NODE_FACTORY, features, [opt_options]);\n  return gpx;\n};\nexport default GPX;\n","/**\n * @module ol/geom/GeometryCollection\n */\nimport {inherits} from '../util.js';\nimport {listen, unlisten} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {createOrUpdateEmpty, closestSquaredDistanceXY, extend, getCenter} from '../extent.js';\nimport Geometry from '../geom/Geometry.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport {clear} from '../obj.js';\n\n/**\n * @classdesc\n * An array of {@link module:ol/geom/Geometry} objects.\n *\n * @constructor\n * @extends {module:ol/geom/Geometry}\n * @param {Array.<module:ol/geom/Geometry>=} opt_geometries Geometries.\n * @api\n */\nconst GeometryCollection = function(opt_geometries) {\n\n  Geometry.call(this);\n\n  /**\n   * @private\n   * @type {Array.<module:ol/geom/Geometry>}\n   */\n  this.geometries_ = opt_geometries ? opt_geometries : null;\n\n  this.listenGeometriesChange_();\n};\n\ninherits(GeometryCollection, Geometry);\n\n\n/**\n * @param {Array.<module:ol/geom/Geometry>} geometries Geometries.\n * @return {Array.<module:ol/geom/Geometry>} Cloned geometries.\n */\nfunction cloneGeometries(geometries) {\n  const clonedGeometries = [];\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    clonedGeometries.push(geometries[i].clone());\n  }\n  return clonedGeometries;\n}\n\n\n/**\n * @private\n */\nGeometryCollection.prototype.unlistenGeometriesChange_ = function() {\n  if (!this.geometries_) {\n    return;\n  }\n  for (let i = 0, ii = this.geometries_.length; i < ii; ++i) {\n    unlisten(\n      this.geometries_[i], EventType.CHANGE,\n      this.changed, this);\n  }\n};\n\n\n/**\n * @private\n */\nGeometryCollection.prototype.listenGeometriesChange_ = function() {\n  if (!this.geometries_) {\n    return;\n  }\n  for (let i = 0, ii = this.geometries_.length; i < ii; ++i) {\n    listen(\n      this.geometries_[i], EventType.CHANGE,\n      this.changed, this);\n  }\n};\n\n\n/**\n * Make a complete copy of the geometry.\n * @return {!module:ol/geom/GeometryCollection} Clone.\n * @override\n * @api\n */\nGeometryCollection.prototype.clone = function() {\n  const geometryCollection = new GeometryCollection(null);\n  geometryCollection.setGeometries(this.geometries_);\n  return geometryCollection;\n};\n\n\n/**\n * @inheritDoc\n */\nGeometryCollection.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {\n  if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n    return minSquaredDistance;\n  }\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    minSquaredDistance = geometries[i].closestPointXY(\n      x, y, closestPoint, minSquaredDistance);\n  }\n  return minSquaredDistance;\n};\n\n\n/**\n * @inheritDoc\n */\nGeometryCollection.prototype.containsXY = function(x, y) {\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    if (geometries[i].containsXY(x, y)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * @inheritDoc\n */\nGeometryCollection.prototype.computeExtent = function(extent) {\n  createOrUpdateEmpty(extent);\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    extend(extent, geometries[i].getExtent());\n  }\n  return extent;\n};\n\n\n/**\n * Return the geometries that make up this geometry collection.\n * @return {Array.<module:ol/geom/Geometry>} Geometries.\n * @api\n */\nGeometryCollection.prototype.getGeometries = function() {\n  return cloneGeometries(this.geometries_);\n};\n\n\n/**\n * @return {Array.<module:ol/geom/Geometry>} Geometries.\n */\nGeometryCollection.prototype.getGeometriesArray = function() {\n  return this.geometries_;\n};\n\n\n/**\n * @inheritDoc\n */\nGeometryCollection.prototype.getSimplifiedGeometry = function(squaredTolerance) {\n  if (this.simplifiedGeometryRevision != this.getRevision()) {\n    clear(this.simplifiedGeometryCache);\n    this.simplifiedGeometryMaxMinSquaredTolerance = 0;\n    this.simplifiedGeometryRevision = this.getRevision();\n  }\n  if (squaredTolerance < 0 ||\n      (this.simplifiedGeometryMaxMinSquaredTolerance !== 0 &&\n       squaredTolerance < this.simplifiedGeometryMaxMinSquaredTolerance)) {\n    return this;\n  }\n  const key = squaredTolerance.toString();\n  if (this.simplifiedGeometryCache.hasOwnProperty(key)) {\n    return this.simplifiedGeometryCache[key];\n  } else {\n    const simplifiedGeometries = [];\n    const geometries = this.geometries_;\n    let simplified = false;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      const geometry = geometries[i];\n      const simplifiedGeometry = geometry.getSimplifiedGeometry(squaredTolerance);\n      simplifiedGeometries.push(simplifiedGeometry);\n      if (simplifiedGeometry !== geometry) {\n        simplified = true;\n      }\n    }\n    if (simplified) {\n      const simplifiedGeometryCollection = new GeometryCollection(null);\n      simplifiedGeometryCollection.setGeometriesArray(simplifiedGeometries);\n      this.simplifiedGeometryCache[key] = simplifiedGeometryCollection;\n      return simplifiedGeometryCollection;\n    } else {\n      this.simplifiedGeometryMaxMinSquaredTolerance = squaredTolerance;\n      return this;\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nGeometryCollection.prototype.getType = function() {\n  return GeometryType.GEOMETRY_COLLECTION;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nGeometryCollection.prototype.intersectsExtent = function(extent) {\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    if (geometries[i].intersectsExtent(extent)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * @return {boolean} Is empty.\n */\nGeometryCollection.prototype.isEmpty = function() {\n  return this.geometries_.length === 0;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nGeometryCollection.prototype.rotate = function(angle, anchor) {\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    geometries[i].rotate(angle, anchor);\n  }\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nGeometryCollection.prototype.scale = function(sx, opt_sy, opt_anchor) {\n  let anchor = opt_anchor;\n  if (!anchor) {\n    anchor = getCenter(this.getExtent());\n  }\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    geometries[i].scale(sx, opt_sy, anchor);\n  }\n  this.changed();\n};\n\n\n/**\n * Set the geometries that make up this geometry collection.\n * @param {Array.<module:ol/geom/Geometry>} geometries Geometries.\n * @api\n */\nGeometryCollection.prototype.setGeometries = function(geometries) {\n  this.setGeometriesArray(cloneGeometries(geometries));\n};\n\n\n/**\n * @param {Array.<module:ol/geom/Geometry>} geometries Geometries.\n */\nGeometryCollection.prototype.setGeometriesArray = function(geometries) {\n  this.unlistenGeometriesChange_();\n  this.geometries_ = geometries;\n  this.listenGeometriesChange_();\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nGeometryCollection.prototype.applyTransform = function(transformFn) {\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    geometries[i].applyTransform(transformFn);\n  }\n  this.changed();\n};\n\n\n/**\n * Translate the geometry.\n * @param {number} deltaX Delta X.\n * @param {number} deltaY Delta Y.\n * @override\n * @api\n */\nGeometryCollection.prototype.translate = function(deltaX, deltaY) {\n  const geometries = this.geometries_;\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    geometries[i].translate(deltaX, deltaY);\n  }\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n */\nGeometryCollection.prototype.disposeInternal = function() {\n  this.unlistenGeometriesChange_();\n  Geometry.prototype.disposeInternal.call(this);\n};\nexport default GeometryCollection;\n","/**\n * @module ol/format/GeoJSON\n */\n// TODO: serialize dataProjection as crs member when writing\n// see https://github.com/openlayers/openlayers/issues/2078\n\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport JSONFeature from '../format/JSONFeature.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {assign, isEmpty} from '../obj.js';\nimport {get as getProjection} from '../proj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/proj~ProjectionLike} [dataProjection='EPSG:4326'] Default data projection.\n * @property {module:ol/proj~ProjectionLike} [featureProjection] Projection for features read or\n * written by the format.  Options passed to read or write methods will take precedence.\n * @property {string} [geometryName] Geometry name to use when creating features.\n * @property {boolean} [extractGeometryName=false] Certain GeoJSON providers include\n * the geometry_name field in the feature GeoJSON. If set to `true` the GeoJSON reader\n * will look for that field to set the geometry name. If both this field is set to `true`\n * and a `geometryName` is provided, the `geometryName` will take precedence.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GeoJSON format.\n *\n * @constructor\n * @extends {module:ol/format/JSONFeature}\n * @param {module:ol/format/GeoJSON~Options=} opt_options Options.\n * @api\n */\nconst GeoJSON = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  JSONFeature.call(this);\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection(\n    options.dataProjection ?\n      options.dataProjection : 'EPSG:4326');\n\n  if (options.featureProjection) {\n    this.defaultFeatureProjection = getProjection(options.featureProjection);\n  }\n\n  /**\n   * Name of the geometry attribute for features.\n   * @type {string|undefined}\n   * @private\n   */\n  this.geometryName_ = options.geometryName;\n\n  /**\n   * Look for the geometry name in the feature GeoJSON\n   * @type {boolean|undefined}\n   * @private\n   */\n  this.extractGeometryName_ = options.extractGeometryName;\n\n};\n\ninherits(GeoJSON, JSONFeature);\n\n\n/**\n * @const\n * @type {Object.<string, function(GeoJSONObject): module:ol/geom/Geometry>}\n */\nconst GEOMETRY_READERS = {\n  'Point': readPointGeometry,\n  'LineString': readLineStringGeometry,\n  'Polygon': readPolygonGeometry,\n  'MultiPoint': readMultiPointGeometry,\n  'MultiLineString': readMultiLineStringGeometry,\n  'MultiPolygon': readMultiPolygonGeometry,\n  'GeometryCollection': readGeometryCollectionGeometry\n};\n\n\n/**\n * @const\n * @type {Object.<string, function(module:ol/geom/Geometry, module:ol/format/Feature~WriteOptions=): (GeoJSONGeometry|GeoJSONGeometryCollection)>}\n */\nconst GEOMETRY_WRITERS = {\n  'Point': writePointGeometry,\n  'LineString': writeLineStringGeometry,\n  'Polygon': writePolygonGeometry,\n  'MultiPoint': writeMultiPointGeometry,\n  'MultiLineString': writeMultiLineStringGeometry,\n  'MultiPolygon': writeMultiPolygonGeometry,\n  'GeometryCollection': writeGeometryCollectionGeometry,\n  'Circle': writeEmptyGeometryCollectionGeometry\n};\n\n\n/**\n * @param {GeoJSONGeometry|GeoJSONGeometryCollection} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n */\nfunction readGeometry(object, opt_options) {\n  if (!object) {\n    return null;\n  }\n  const geometryReader = GEOMETRY_READERS[object.type];\n  return (\n    /** @type {module:ol/geom/Geometry} */ (transformWithOptions(geometryReader(object), false, opt_options))\n  );\n}\n\n\n/**\n * @param {GeoJSONGeometryCollection} object Object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/GeometryCollection} Geometry collection.\n */\nfunction readGeometryCollectionGeometry(object, opt_options) {\n  const geometries = object.geometries.map(\n    /**\n     * @param {GeoJSONGeometry} geometry Geometry.\n     * @return {module:ol/geom/Geometry} geometry Geometry.\n     */\n    function(geometry) {\n      return readGeometry(geometry, opt_options);\n    });\n  return new GeometryCollection(geometries);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/Point} Point.\n */\nfunction readPointGeometry(object) {\n  return new Point(object.coordinates);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/LineString} LineString.\n */\nfunction readLineStringGeometry(object) {\n  return new LineString(object.coordinates);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/MultiLineString} MultiLineString.\n */\nfunction readMultiLineStringGeometry(object) {\n  return new MultiLineString(object.coordinates);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/MultiPoint} MultiPoint.\n */\nfunction readMultiPointGeometry(object) {\n  return new MultiPoint(object.coordinates);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/MultiPolygon} MultiPolygon.\n */\nfunction readMultiPolygonGeometry(object) {\n  return new MultiPolygon(object.coordinates);\n}\n\n\n/**\n * @param {GeoJSONGeometry} object Object.\n * @return {module:ol/geom/Polygon} Polygon.\n */\nfunction readPolygonGeometry(object) {\n  return new Polygon(object.coordinates);\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry|GeoJSONGeometryCollection} GeoJSON geometry.\n */\nfunction writeGeometry(geometry, opt_options) {\n  const geometryWriter = GEOMETRY_WRITERS[geometry.getType()];\n  return geometryWriter(/** @type {module:ol/geom/Geometry} */ (\n    transformWithOptions(geometry, true, opt_options)), opt_options);\n}\n\n\n/**\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @return {GeoJSONGeometryCollection} Empty GeoJSON geometry collection.\n */\nfunction writeEmptyGeometryCollectionGeometry(geometry) {\n  return /** @type {GeoJSONGeometryCollection} */ ({\n    type: 'GeometryCollection',\n    geometries: []\n  });\n}\n\n\n/**\n * @param {module:ol/geom/GeometryCollection} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometryCollection} GeoJSON geometry collection.\n */\nfunction writeGeometryCollectionGeometry(geometry, opt_options) {\n  const geometries = geometry.getGeometriesArray().map(function(geometry) {\n    const options = assign({}, opt_options);\n    delete options.featureProjection;\n    return writeGeometry(geometry, options);\n  });\n  return /** @type {GeoJSONGeometryCollection} */ ({\n    type: 'GeometryCollection',\n    geometries: geometries\n  });\n}\n\n\n/**\n * @param {module:ol/geom/LineString} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeLineStringGeometry(geometry, opt_options) {\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'LineString',\n    coordinates: geometry.getCoordinates()\n  });\n}\n\n\n/**\n * @param {module:ol/geom/MultiLineString} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiLineStringGeometry(geometry, opt_options) {\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'MultiLineString',\n    coordinates: geometry.getCoordinates()\n  });\n}\n\n\n/**\n * @param {module:ol/geom/MultiPoint} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiPointGeometry(geometry, opt_options) {\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'MultiPoint',\n    coordinates: geometry.getCoordinates()\n  });\n}\n\n\n/**\n * @param {module:ol/geom/MultiPolygon} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiPolygonGeometry(geometry, opt_options) {\n  let right;\n  if (opt_options) {\n    right = opt_options.rightHanded;\n  }\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'MultiPolygon',\n    coordinates: geometry.getCoordinates(right)\n  });\n}\n\n\n/**\n * @param {module:ol/geom/Point} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writePointGeometry(geometry, opt_options) {\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'Point',\n    coordinates: geometry.getCoordinates()\n  });\n}\n\n\n/**\n * @param {module:ol/geom/Polygon} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writePolygonGeometry(geometry, opt_options) {\n  let right;\n  if (opt_options) {\n    right = opt_options.rightHanded;\n  }\n  return /** @type {GeoJSONGeometry} */ ({\n    type: 'Polygon',\n    coordinates: geometry.getCoordinates(right)\n  });\n}\n\n\n/**\n * Read a feature from a GeoJSON Feature source.  Only works for Feature or\n * geometry types.  Use {@link module:ol/format/GeoJSON#readFeatures} to read\n * FeatureCollection source. If feature at source has an id, it will be used\n * as Feature id by calling {@link module:ol/Feature#setId} internally.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nGeoJSON.prototype.readFeature;\n\n\n/**\n * Read all features from a GeoJSON source.  Works for all GeoJSON types.\n * If the source includes only geometries, features will be created with those\n * geometries.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nGeoJSON.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nGeoJSON.prototype.readFeatureFromObject = function(object, opt_options) {\n  /**\n   * @type {GeoJSONFeature}\n   */\n  let geoJSONFeature = null;\n  if (object.type === 'Feature') {\n    geoJSONFeature = /** @type {GeoJSONFeature} */ (object);\n  } else {\n    geoJSONFeature = /** @type {GeoJSONFeature} */ ({\n      type: 'Feature',\n      geometry: /** @type {GeoJSONGeometry|GeoJSONGeometryCollection} */ (object)\n    });\n  }\n\n  const geometry = readGeometry(geoJSONFeature.geometry, opt_options);\n  const feature = new Feature();\n  if (this.geometryName_) {\n    feature.setGeometryName(this.geometryName_);\n  } else if (this.extractGeometryName_ && geoJSONFeature.geometry_name !== undefined) {\n    feature.setGeometryName(geoJSONFeature.geometry_name);\n  }\n  feature.setGeometry(geometry);\n  if (geoJSONFeature.id !== undefined) {\n    feature.setId(geoJSONFeature.id);\n  }\n  if (geoJSONFeature.properties) {\n    feature.setProperties(geoJSONFeature.properties);\n  }\n  return feature;\n};\n\n\n/**\n * @inheritDoc\n */\nGeoJSON.prototype.readFeaturesFromObject = function(object, opt_options) {\n  const geoJSONObject = /** @type {GeoJSONObject} */ (object);\n  /** @type {Array.<module:ol/Feature>} */\n  let features = null;\n  if (geoJSONObject.type === 'FeatureCollection') {\n    const geoJSONFeatureCollection = /** @type {GeoJSONFeatureCollection} */ (object);\n    features = [];\n    const geoJSONFeatures = geoJSONFeatureCollection.features;\n    for (let i = 0, ii = geoJSONFeatures.length; i < ii; ++i) {\n      features.push(this.readFeatureFromObject(geoJSONFeatures[i], opt_options));\n    }\n  } else {\n    features = [this.readFeatureFromObject(object, opt_options)];\n  }\n  return features;\n};\n\n\n/**\n * Read a geometry from a GeoJSON source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n * @api\n */\nGeoJSON.prototype.readGeometry;\n\n\n/**\n * @inheritDoc\n */\nGeoJSON.prototype.readGeometryFromObject = function(object, opt_options) {\n  return readGeometry(/** @type {GeoJSONGeometry} */ (object), opt_options);\n};\n\n\n/**\n * Read the projection from a GeoJSON source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nGeoJSON.prototype.readProjection;\n\n\n/**\n * @inheritDoc\n */\nGeoJSON.prototype.readProjectionFromObject = function(object) {\n  const geoJSONObject = /** @type {GeoJSONObject} */ (object);\n  const crs = geoJSONObject.crs;\n  let projection;\n  if (crs) {\n    if (crs.type == 'name') {\n      projection = getProjection(crs.properties.name);\n    } else {\n      assert(false, 36); // Unknown SRS type\n    }\n  } else {\n    projection = this.dataProjection;\n  }\n  return (\n    /** @type {module:ol/proj/Projection} */ (projection)\n  );\n};\n\n\n/**\n * Encode a feature as a GeoJSON Feature string.\n *\n * @function\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} GeoJSON.\n * @override\n * @api\n */\nGeoJSON.prototype.writeFeature;\n\n\n/**\n * Encode a feature as a GeoJSON Feature object.\n *\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONFeature} Object.\n * @override\n * @api\n */\nGeoJSON.prototype.writeFeatureObject = function(feature, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n\n  const object = /** @type {GeoJSONFeature} */ ({\n    'type': 'Feature'\n  });\n  const id = feature.getId();\n  if (id !== undefined) {\n    object.id = id;\n  }\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    object.geometry = writeGeometry(geometry, opt_options);\n  } else {\n    object.geometry = null;\n  }\n  const properties = feature.getProperties();\n  delete properties[feature.getGeometryName()];\n  if (!isEmpty(properties)) {\n    object.properties = properties;\n  } else {\n    object.properties = null;\n  }\n  return object;\n};\n\n\n/**\n * Encode an array of features as GeoJSON.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} GeoJSON.\n * @api\n */\nGeoJSON.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features as a GeoJSON object.\n *\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONFeatureCollection} GeoJSON Object.\n * @override\n * @api\n */\nGeoJSON.prototype.writeFeaturesObject = function(features, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const objects = [];\n  for (let i = 0, ii = features.length; i < ii; ++i) {\n    objects.push(this.writeFeatureObject(features[i], opt_options));\n  }\n  return /** @type {GeoJSONFeatureCollection} */ ({\n    type: 'FeatureCollection',\n    features: objects\n  });\n};\n\n\n/**\n * Encode a geometry as a GeoJSON string.\n *\n * @function\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} GeoJSON.\n * @api\n */\nGeoJSON.prototype.writeGeometry;\n\n\n/**\n * Encode a geometry as a GeoJSON object.\n *\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {GeoJSONGeometry|GeoJSONGeometryCollection} Object.\n * @override\n * @api\n */\nGeoJSON.prototype.writeGeometryObject = function(geometry, opt_options) {\n  return writeGeometry(geometry, this.adaptOptions(opt_options));\n};\nexport default GeoJSON;\n","/**\n * @module ol/format/TextFeature\n */\nimport {inherits} from '../util.js';\nimport FeatureFormat from '../format/Feature.js';\nimport FormatType from '../format/FormatType.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for text feature formats.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/format/Feature}\n */\nconst TextFeature = function() {\n  FeatureFormat.call(this);\n};\n\ninherits(TextFeature, FeatureFormat);\n\n\n/**\n * @param {Document|Node|Object|string} source Source.\n * @return {string} Text.\n */\nfunction getText(source) {\n  if (typeof source === 'string') {\n    return source;\n  } else {\n    return '';\n  }\n}\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.getType = function() {\n  return FormatType.TEXT;\n};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.readFeature = function(source, opt_options) {\n  return this.readFeatureFromText(getText(source), this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {string} text Text.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {module:ol/Feature} Feature.\n */\nTextFeature.prototype.readFeatureFromText = function(text, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.readFeatures = function(source, opt_options) {\n  return this.readFeaturesFromText(getText(source), this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {string} text Text.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {Array.<module:ol/Feature>} Features.\n */\nTextFeature.prototype.readFeaturesFromText = function(text, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.readGeometry = function(source, opt_options) {\n  return this.readGeometryFromText(getText(source), this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {string} text Text.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @protected\n * @return {module:ol/geom/Geometry} Geometry.\n */\nTextFeature.prototype.readGeometryFromText = function(text, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.readProjection = function(source) {\n  return this.readProjectionFromText(getText(source));\n};\n\n\n/**\n * @param {string} text Text.\n * @protected\n * @return {module:ol/proj/Projection} Projection.\n */\nTextFeature.prototype.readProjectionFromText = function(text) {\n  return this.dataProjection;\n};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.writeFeature = function(feature, opt_options) {\n  return this.writeFeatureText(feature, this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {module:ol/Feature} feature Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @protected\n * @return {string} Text.\n */\nTextFeature.prototype.writeFeatureText = function(feature, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.writeFeatures = function(features, opt_options) {\n  return this.writeFeaturesText(features, this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @protected\n * @return {string} Text.\n */\nTextFeature.prototype.writeFeaturesText = function(features, opt_options) {};\n\n\n/**\n * @inheritDoc\n */\nTextFeature.prototype.writeGeometry = function(geometry, opt_options) {\n  return this.writeGeometryText(geometry, this.adaptOptions(opt_options));\n};\n\n\n/**\n * @abstract\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @protected\n * @return {string} Text.\n */\nTextFeature.prototype.writeGeometryText = function(geometry, opt_options) {};\nexport default TextFeature;\n","/**\n * @module ol/format/IGC\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport TextFeature from '../format/TextFeature.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport {get as getProjection} from '../proj.js';\n\n/**\n * IGC altitude/z. One of 'barometric', 'gps', 'none'.\n * @enum {string}\n */\nconst IGCZ = {\n  BAROMETRIC: 'barometric',\n  GPS: 'gps',\n  NONE: 'none'\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {IGCZ|string} [altitudeMode='none'] Altitude mode. Possible\n * values are `'barometric'`, `'gps'`, and `'none'`.\n */\n\n\n/**\n * @classdesc\n * Feature format for `*.igc` flight recording files.\n *\n * @constructor\n * @extends {module:ol/format/TextFeature}\n * @param {module:ol/format/IGC~Options=} opt_options Options.\n * @api\n */\nconst IGC = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  TextFeature.call(this);\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection('EPSG:4326');\n\n  /**\n   * @private\n   * @type {IGCZ}\n   */\n  this.altitudeMode_ = options.altitudeMode ? options.altitudeMode : IGCZ.NONE;\n};\n\ninherits(IGC, TextFeature);\n\n\n/**\n * @const\n * @type {RegExp}\n */\nconst B_RECORD_RE =\n    /^B(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{5})([NS])(\\d{3})(\\d{5})([EW])([AV])(\\d{5})(\\d{5})/;\n\n\n/**\n * @const\n * @type {RegExp}\n */\nconst H_RECORD_RE = /^H.([A-Z]{3}).*?:(.*)/;\n\n\n/**\n * @const\n * @type {RegExp}\n */\nconst HFDTE_RECORD_RE = /^HFDTE(\\d{2})(\\d{2})(\\d{2})/;\n\n\n/**\n * A regular expression matching the newline characters `\\r\\n`, `\\r` and `\\n`.\n *\n * @const\n * @type {RegExp}\n */\nconst NEWLINE_RE = /\\r\\n|\\r|\\n/;\n\n\n/**\n * Read the feature from the IGC source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nIGC.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nIGC.prototype.readFeatureFromText = function(text, opt_options) {\n  const altitudeMode = this.altitudeMode_;\n  const lines = text.split(NEWLINE_RE);\n  /** @type {Object.<string, string>} */\n  const properties = {};\n  const flatCoordinates = [];\n  let year = 2000;\n  let month = 0;\n  let day = 1;\n  let lastDateTime = -1;\n  let i, ii;\n  for (i = 0, ii = lines.length; i < ii; ++i) {\n    const line = lines[i];\n    let m;\n    if (line.charAt(0) == 'B') {\n      m = B_RECORD_RE.exec(line);\n      if (m) {\n        const hour = parseInt(m[1], 10);\n        const minute = parseInt(m[2], 10);\n        const second = parseInt(m[3], 10);\n        let y = parseInt(m[4], 10) + parseInt(m[5], 10) / 60000;\n        if (m[6] == 'S') {\n          y = -y;\n        }\n        let x = parseInt(m[7], 10) + parseInt(m[8], 10) / 60000;\n        if (m[9] == 'W') {\n          x = -x;\n        }\n        flatCoordinates.push(x, y);\n        if (altitudeMode != IGCZ.NONE) {\n          let z;\n          if (altitudeMode == IGCZ.GPS) {\n            z = parseInt(m[11], 10);\n          } else if (altitudeMode == IGCZ.BAROMETRIC) {\n            z = parseInt(m[12], 10);\n          } else {\n            z = 0;\n          }\n          flatCoordinates.push(z);\n        }\n        let dateTime = Date.UTC(year, month, day, hour, minute, second);\n        // Detect UTC midnight wrap around.\n        if (dateTime < lastDateTime) {\n          dateTime = Date.UTC(year, month, day + 1, hour, minute, second);\n        }\n        flatCoordinates.push(dateTime / 1000);\n        lastDateTime = dateTime;\n      }\n    } else if (line.charAt(0) == 'H') {\n      m = HFDTE_RECORD_RE.exec(line);\n      if (m) {\n        day = parseInt(m[1], 10);\n        month = parseInt(m[2], 10) - 1;\n        year = 2000 + parseInt(m[3], 10);\n      } else {\n        m = H_RECORD_RE.exec(line);\n        if (m) {\n          properties[m[1]] = m[2].trim();\n        }\n      }\n    }\n  }\n  if (flatCoordinates.length === 0) {\n    return null;\n  }\n  const lineString = new LineString(null);\n  const layout = altitudeMode == IGCZ.NONE ? GeometryLayout.XYM : GeometryLayout.XYZM;\n  lineString.setFlatCoordinates(layout, flatCoordinates);\n  const feature = new Feature(transformWithOptions(lineString, false, opt_options));\n  feature.setProperties(properties);\n  return feature;\n};\n\n\n/**\n * Read the feature from the source. As IGC sources contain a single\n * feature, this will return the feature in an array.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nIGC.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nIGC.prototype.readFeaturesFromText = function(text, opt_options) {\n  const feature = this.readFeatureFromText(text, opt_options);\n  if (feature) {\n    return [feature];\n  } else {\n    return [];\n  }\n};\n\n\n/**\n * Read the projection from the IGC source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nIGC.prototype.readProjection;\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nIGC.prototype.writeFeatureText = function(feature, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nIGC.prototype.writeFeaturesText = function(features, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nIGC.prototype.writeGeometryText = function(geometry, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nIGC.prototype.readGeometryFromText = function(text, opt_options) {};\nexport default IGC;\n","/**\n * @module ol/style/IconAnchorUnits\n */\n\n/**\n * Icon anchor units. One of 'fraction', 'pixels'.\n * @enum {string}\n */\nexport default {\n  FRACTION: 'fraction',\n  PIXELS: 'pixels'\n};\n","/**\n * @module ol/style/IconImage\n */\nimport {inherits} from '../util.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {listenOnce, unlistenByKey} from '../events.js';\nimport EventTarget from '../events/EventTarget.js';\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport {shared as iconImageCache} from '../style/IconImageCache.js';\n\n/**\n * @constructor\n * @param {Image|HTMLCanvasElement} image Image.\n * @param {string|undefined} src Src.\n * @param {module:ol/size~Size} size Size.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/ImageState} imageState Image state.\n * @param {module:ol/color~Color} color Color.\n * @extends {module:ol/events/EventTarget}\n */\nconst IconImage = function(image, src, size, crossOrigin, imageState, color) {\n\n  EventTarget.call(this);\n\n  /**\n   * @private\n   * @type {Image|HTMLCanvasElement}\n   */\n  this.hitDetectionImage_ = null;\n\n  /**\n   * @private\n   * @type {Image|HTMLCanvasElement}\n   */\n  this.image_ = !image ? new Image() : image;\n\n  if (crossOrigin !== null) {\n    this.image_.crossOrigin = crossOrigin;\n  }\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = color ?\n    /** @type {HTMLCanvasElement} */ (document.createElement('CANVAS')) :\n    null;\n\n  /**\n   * @private\n   * @type {module:ol/color~Color}\n   */\n  this.color_ = color;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.imageListenerKeys_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/ImageState}\n   */\n  this.imageState_ = imageState;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.size_ = size;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.src_ = src;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.tainting_ = false;\n  if (this.imageState_ == ImageState.LOADED) {\n    this.determineTainting_();\n  }\n\n};\n\ninherits(IconImage, EventTarget);\n\n\n/**\n * @param {Image|HTMLCanvasElement} image Image.\n * @param {string} src Src.\n * @param {module:ol/size~Size} size Size.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/ImageState} imageState Image state.\n * @param {module:ol/color~Color} color Color.\n * @return {module:ol/style/IconImage} Icon image.\n */\nexport function get(image, src, size, crossOrigin, imageState, color) {\n  let iconImage = iconImageCache.get(src, crossOrigin, color);\n  if (!iconImage) {\n    iconImage = new IconImage(image, src, size, crossOrigin, imageState, color);\n    iconImageCache.set(src, crossOrigin, color, iconImage);\n  }\n  return iconImage;\n}\n\n\n/**\n * @private\n */\nIconImage.prototype.determineTainting_ = function() {\n  const context = createCanvasContext2D(1, 1);\n  try {\n    context.drawImage(this.image_, 0, 0);\n    context.getImageData(0, 0, 1, 1);\n  } catch (e) {\n    this.tainting_ = true;\n  }\n};\n\n\n/**\n * @private\n */\nIconImage.prototype.dispatchChangeEvent_ = function() {\n  this.dispatchEvent(EventType.CHANGE);\n};\n\n\n/**\n * @private\n */\nIconImage.prototype.handleImageError_ = function() {\n  this.imageState_ = ImageState.ERROR;\n  this.unlistenImage_();\n  this.dispatchChangeEvent_();\n};\n\n\n/**\n * @private\n */\nIconImage.prototype.handleImageLoad_ = function() {\n  this.imageState_ = ImageState.LOADED;\n  if (this.size_) {\n    this.image_.width = this.size_[0];\n    this.image_.height = this.size_[1];\n  }\n  this.size_ = [this.image_.width, this.image_.height];\n  this.unlistenImage_();\n  this.determineTainting_();\n  this.replaceColor_();\n  this.dispatchChangeEvent_();\n};\n\n\n/**\n * @param {number} pixelRatio Pixel ratio.\n * @return {Image|HTMLCanvasElement} Image or Canvas element.\n */\nIconImage.prototype.getImage = function(pixelRatio) {\n  return this.canvas_ ? this.canvas_ : this.image_;\n};\n\n\n/**\n * @return {module:ol/ImageState} Image state.\n */\nIconImage.prototype.getImageState = function() {\n  return this.imageState_;\n};\n\n\n/**\n * @param {number} pixelRatio Pixel ratio.\n * @return {Image|HTMLCanvasElement} Image element.\n */\nIconImage.prototype.getHitDetectionImage = function(pixelRatio) {\n  if (!this.hitDetectionImage_) {\n    if (this.tainting_) {\n      const width = this.size_[0];\n      const height = this.size_[1];\n      const context = createCanvasContext2D(width, height);\n      context.fillRect(0, 0, width, height);\n      this.hitDetectionImage_ = context.canvas;\n    } else {\n      this.hitDetectionImage_ = this.image_;\n    }\n  }\n  return this.hitDetectionImage_;\n};\n\n\n/**\n * @return {module:ol/size~Size} Image size.\n */\nIconImage.prototype.getSize = function() {\n  return this.size_;\n};\n\n\n/**\n * @return {string|undefined} Image src.\n */\nIconImage.prototype.getSrc = function() {\n  return this.src_;\n};\n\n\n/**\n * Load not yet loaded URI.\n */\nIconImage.prototype.load = function() {\n  if (this.imageState_ == ImageState.IDLE) {\n    this.imageState_ = ImageState.LOADING;\n    this.imageListenerKeys_ = [\n      listenOnce(this.image_, EventType.ERROR,\n        this.handleImageError_, this),\n      listenOnce(this.image_, EventType.LOAD,\n        this.handleImageLoad_, this)\n    ];\n    try {\n      this.image_.src = this.src_;\n    } catch (e) {\n      this.handleImageError_();\n    }\n  }\n};\n\n\n/**\n * @private\n */\nIconImage.prototype.replaceColor_ = function() {\n  if (this.tainting_ || this.color_ === null) {\n    return;\n  }\n\n  this.canvas_.width = this.image_.width;\n  this.canvas_.height = this.image_.height;\n\n  const ctx = this.canvas_.getContext('2d');\n  ctx.drawImage(this.image_, 0, 0);\n\n  const imgData = ctx.getImageData(0, 0, this.image_.width, this.image_.height);\n  const data = imgData.data;\n  const r = this.color_[0] / 255.0;\n  const g = this.color_[1] / 255.0;\n  const b = this.color_[2] / 255.0;\n\n  for (let i = 0, ii = data.length; i < ii; i += 4) {\n    data[i] *= r;\n    data[i + 1] *= g;\n    data[i + 2] *= b;\n  }\n  ctx.putImageData(imgData, 0, 0);\n};\n\n\n/**\n * Discards event handlers which listen for load completion or errors.\n *\n * @private\n */\nIconImage.prototype.unlistenImage_ = function() {\n  this.imageListenerKeys_.forEach(unlistenByKey);\n  this.imageListenerKeys_ = null;\n};\nexport default IconImage;\n","/**\n * @module ol/format/KML\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {extend, includes} from '../array.js';\nimport {assert} from '../asserts.js';\nimport {asArray} from '../color.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport {readDecimal, readBoolean, readString, writeStringTextNode, writeCDATASection, writeDecimalTextNode, writeBooleanTextNode} from '../format/xsd.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {toRadians} from '../math.js';\nimport {get as getProjection} from '../proj.js';\nimport Fill from '../style/Fill.js';\nimport Icon from '../style/Icon.js';\nimport IconAnchorUnits from '../style/IconAnchorUnits.js';\nimport IconOrigin from '../style/IconOrigin.js';\nimport Stroke from '../style/Stroke.js';\nimport Style from '../style/Style.js';\nimport Text from '../style/Text.js';\nimport {createElementNS, getAllTextContent, isDocument, isNode, makeArrayExtender,\n  makeArrayPusher, makeChildAppender, makeObjectPropertySetter,\n  makeReplacer, makeSequence, makeSimpleNodeFactory, makeStructureNS,\n  OBJECT_PROPERTY_NODE_FACTORY, parse, parseNode, pushParseAndPop,\n  pushSerializeAndPop, XML_SCHEMA_INSTANCE_URI} from '../xml.js';\n\n/**\n * @typedef {Object} Vec2\n * @property {number} x\n * @property {module:ol/style/IconAnchorUnits} xunits\n * @property {number} y\n * @property {module:ol/style/IconAnchorUnits} yunits\n * @property {module:ol/style/IconOrigin} origin\n */\n\n/**\n * @typedef {Object} GxTrackObject\n * @property {Array.<number>} flatCoordinates\n * @property {Array.<number>} whens\n */\n\n/**\n * @type {module:ol/color~Color}\n */\nlet DEFAULT_COLOR;\n\n/**\n * @type {module:ol/style/Fill}\n */\nlet DEFAULT_FILL_STYLE = null;\n\n/**\n * Get the default fill style (or null if not yet set).\n * @return {module:ol/style/Fill} The default fill style.\n */\nexport function getDefaultFillStyle() {\n  return DEFAULT_FILL_STYLE;\n}\n\n/**\n * @type {module:ol/size~Size}\n */\nlet DEFAULT_IMAGE_STYLE_ANCHOR;\n\n/**\n * @type {module:ol/style/IconAnchorUnits}\n */\nlet DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n\n/**\n * @type {module:ol/style/IconAnchorUnits}\n */\nlet DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n\n/**\n * @type {module:ol/size~Size}\n */\nlet DEFAULT_IMAGE_STYLE_SIZE;\n\n/**\n * @type {string}\n */\nlet DEFAULT_IMAGE_STYLE_SRC;\n\n/**\n * @type {number}\n */\nlet DEFAULT_IMAGE_SCALE_MULTIPLIER;\n\n/**\n * @type {module:ol/style/Image}\n */\nlet DEFAULT_IMAGE_STYLE = null;\n\n/**\n * Get the default image style (or null if not yet set).\n * @return {module:ol/style/Image} The default image style.\n */\nexport function getDefaultImageStyle() {\n  return DEFAULT_IMAGE_STYLE;\n}\n\n/**\n * @type {string}\n */\nlet DEFAULT_NO_IMAGE_STYLE;\n\n/**\n * @type {module:ol/style/Stroke}\n */\nlet DEFAULT_STROKE_STYLE = null;\n\n/**\n * Get the default stroke style (or null if not yet set).\n * @return {module:ol/style/Stroke} The default stroke style.\n */\nexport function getDefaultStrokeStyle() {\n  return DEFAULT_STROKE_STYLE;\n}\n\n/**\n * @type {module:ol/style/Stroke}\n */\nlet DEFAULT_TEXT_STROKE_STYLE;\n\n/**\n * @type {module:ol/style/Text}\n */\nlet DEFAULT_TEXT_STYLE = null;\n\n/**\n * Get the default text style (or null if not yet set).\n * @return {module:ol/style/Text} The default text style.\n */\nexport function getDefaultTextStyle() {\n  return DEFAULT_TEXT_STYLE;\n}\n\n/**\n * @type {module:ol/style/Style}\n */\nlet DEFAULT_STYLE = null;\n\n/**\n * Get the default style (or null if not yet set).\n * @return {module:ol/style/Style} The default style.\n */\nexport function getDefaultStyle() {\n  return DEFAULT_STYLE;\n}\n\n/**\n * @type {Array.<module:ol/style/Style>}\n */\nlet DEFAULT_STYLE_ARRAY = null;\n\n/**\n * Get the default style array (or null if not yet set).\n * @return {Array.<module:ol/style/Style>} The default style.\n */\nexport function getDefaultStyleArray() {\n  return DEFAULT_STYLE_ARRAY;\n}\n\n\nfunction createStyleDefaults() {\n\n  DEFAULT_COLOR = [255, 255, 255, 1];\n\n  DEFAULT_FILL_STYLE = new Fill({\n    color: DEFAULT_COLOR\n  });\n\n  DEFAULT_IMAGE_STYLE_ANCHOR = [20, 2]; // FIXME maybe [8, 32] ?\n\n  DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS = IconAnchorUnits.PIXELS;\n\n  DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS = IconAnchorUnits.PIXELS;\n\n  DEFAULT_IMAGE_STYLE_SIZE = [64, 64];\n\n  DEFAULT_IMAGE_STYLE_SRC =\n      'https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png';\n\n  DEFAULT_IMAGE_SCALE_MULTIPLIER = 0.5;\n\n  DEFAULT_IMAGE_STYLE = new Icon({\n    anchor: DEFAULT_IMAGE_STYLE_ANCHOR,\n    anchorOrigin: IconOrigin.BOTTOM_LEFT,\n    anchorXUnits: DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,\n    anchorYUnits: DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,\n    crossOrigin: 'anonymous',\n    rotation: 0,\n    scale: DEFAULT_IMAGE_SCALE_MULTIPLIER,\n    size: DEFAULT_IMAGE_STYLE_SIZE,\n    src: DEFAULT_IMAGE_STYLE_SRC\n  });\n\n  DEFAULT_NO_IMAGE_STYLE = 'NO_IMAGE';\n\n  DEFAULT_STROKE_STYLE = new Stroke({\n    color: DEFAULT_COLOR,\n    width: 1\n  });\n\n  DEFAULT_TEXT_STROKE_STYLE = new Stroke({\n    color: [51, 51, 51, 1],\n    width: 2\n  });\n\n  DEFAULT_TEXT_STYLE = new Text({\n    font: 'bold 16px Helvetica',\n    fill: DEFAULT_FILL_STYLE,\n    stroke: DEFAULT_TEXT_STROKE_STYLE,\n    scale: 0.8\n  });\n\n  DEFAULT_STYLE = new Style({\n    fill: DEFAULT_FILL_STYLE,\n    image: DEFAULT_IMAGE_STYLE,\n    text: DEFAULT_TEXT_STYLE,\n    stroke: DEFAULT_STROKE_STYLE,\n    zIndex: 0\n  });\n\n  DEFAULT_STYLE_ARRAY = [DEFAULT_STYLE];\n\n}\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [extractStyles=true] Extract styles from the KML.\n * @property {boolean} [showPointNames=true] Show names as labels for placemarks which contain points.\n * @property {Array.<module:ol/style/Style>} [defaultStyle] Default style. The\n * default default style is the same as Google Earth.\n * @property {boolean} [writeStyles=true] Write styles into KML.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the KML format.\n *\n * Note that the KML format uses the URL() constructor. Older browsers such as IE\n * which do not support this will need a URL polyfill to be loaded before use.\n *\n * @constructor\n * @extends {module:ol/format/XMLFeature}\n * @param {module:ol/format/KML~Options=} opt_options Options.\n * @api\n */\nconst KML = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  XMLFeature.call(this);\n\n  if (!DEFAULT_STYLE_ARRAY) {\n    createStyleDefaults();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection('EPSG:4326');\n\n  /**\n   * @private\n   * @type {Array.<module:ol/style/Style>}\n   */\n  this.defaultStyle_ = options.defaultStyle ?\n    options.defaultStyle : DEFAULT_STYLE_ARRAY;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.extractStyles_ = options.extractStyles !== undefined ?\n    options.extractStyles : true;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.writeStyles_ = options.writeStyles !== undefined ?\n    options.writeStyles : true;\n\n  /**\n   * @private\n   * @type {!Object.<string, (Array.<module:ol/style/Style>|string)>}\n   */\n  this.sharedStyles_ = {};\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.showPointNames_ = options.showPointNames !== undefined ?\n    options.showPointNames : true;\n\n};\n\ninherits(KML, XMLFeature);\n\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst GX_NAMESPACE_URIS = [\n  'http://www.google.com/kml/ext/2.2'\n];\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst NAMESPACE_URIS = [\n  null,\n  'http://earth.google.com/kml/2.0',\n  'http://earth.google.com/kml/2.1',\n  'http://earth.google.com/kml/2.2',\n  'http://www.opengis.net/kml/2.2'\n];\n\n\n/**\n * @const\n * @type {string}\n */\nconst SCHEMA_LOCATION = 'http://www.opengis.net/kml/2.2 ' +\n    'https://developers.google.com/kml/schema/kml22gx.xsd';\n\n\n/**\n * @type {Object.<string, module:ol/style/IconAnchorUnits>}\n */\nconst ICON_ANCHOR_UNITS_MAP = {\n  'fraction': IconAnchorUnits.FRACTION,\n  'pixels': IconAnchorUnits.PIXELS,\n  'insetPixels': IconAnchorUnits.PIXELS\n};\n\n\n/**\n * @param {module:ol/style/Style|undefined} foundStyle Style.\n * @param {string} name Name.\n * @return {module:ol/style/Style} style Style.\n */\nfunction createNameStyleFunction(foundStyle, name) {\n  let textStyle = null;\n  const textOffset = [0, 0];\n  let textAlign = 'start';\n  if (foundStyle.getImage()) {\n    let imageSize = foundStyle.getImage().getImageSize();\n    if (imageSize === null) {\n      imageSize = DEFAULT_IMAGE_STYLE_SIZE;\n    }\n    if (imageSize.length == 2) {\n      const imageScale = foundStyle.getImage().getScale();\n      // Offset the label to be centered to the right of the icon, if there is\n      // one.\n      textOffset[0] = imageScale * imageSize[0] / 2;\n      textOffset[1] = -imageScale * imageSize[1] / 2;\n      textAlign = 'left';\n    }\n  }\n  if (foundStyle.getText() !== null) {\n    // clone the text style, customizing it with name, alignments and offset.\n    // Note that kml does not support many text options that OpenLayers does (rotation, textBaseline).\n    const foundText = foundStyle.getText();\n    textStyle = foundText.clone();\n    textStyle.setFont(foundText.getFont() || DEFAULT_TEXT_STYLE.getFont());\n    textStyle.setScale(foundText.getScale() || DEFAULT_TEXT_STYLE.getScale());\n    textStyle.setFill(foundText.getFill() || DEFAULT_TEXT_STYLE.getFill());\n    textStyle.setStroke(foundText.getStroke() || DEFAULT_TEXT_STROKE_STYLE);\n  } else {\n    textStyle = DEFAULT_TEXT_STYLE.clone();\n  }\n  textStyle.setText(name);\n  textStyle.setOffsetX(textOffset[0]);\n  textStyle.setOffsetY(textOffset[1]);\n  textStyle.setTextAlign(textAlign);\n\n  const nameStyle = new Style({\n    text: textStyle\n  });\n  return nameStyle;\n}\n\n\n/**\n * @param {Array.<module:ol/style/Style>|undefined} style Style.\n * @param {string} styleUrl Style URL.\n * @param {Array.<module:ol/style/Style>} defaultStyle Default style.\n * @param {!Object.<string, (Array.<module:ol/style/Style>|string)>} sharedStyles Shared styles.\n * @param {boolean|undefined} showPointNames true to show names for point placemarks.\n * @return {module:ol/style/Style~StyleFunction} Feature style function.\n */\nfunction createFeatureStyleFunction(style, styleUrl, defaultStyle, sharedStyles, showPointNames) {\n\n  return (\n    /**\n     * @param {module:ol/Feature} feature feature.\n     * @param {number} resolution Resolution.\n     * @return {Array.<module:ol/style/Style>} Style.\n     */\n    function(feature, resolution) {\n      let drawName = showPointNames;\n      /** @type {module:ol/style/Style|undefined} */\n      let nameStyle;\n      let name = '';\n      if (drawName) {\n        const geometry = feature.getGeometry();\n        if (geometry) {\n          drawName = geometry.getType() === GeometryType.POINT;\n        }\n      }\n\n      if (drawName) {\n        name = /** @type {string} */ (feature.get('name'));\n        drawName = drawName && name;\n      }\n\n      if (style) {\n        if (drawName) {\n          nameStyle = createNameStyleFunction(style[0], name);\n          return style.concat(nameStyle);\n        }\n        return style;\n      }\n      if (styleUrl) {\n        const foundStyle = findStyle(styleUrl, defaultStyle, sharedStyles);\n        if (drawName) {\n          nameStyle = createNameStyleFunction(foundStyle[0], name);\n          return foundStyle.concat(nameStyle);\n        }\n        return foundStyle;\n      }\n      if (drawName) {\n        nameStyle = createNameStyleFunction(defaultStyle[0], name);\n        return defaultStyle.concat(nameStyle);\n      }\n      return defaultStyle;\n    }\n  );\n}\n\n\n/**\n * @param {Array.<module:ol/style/Style>|string|undefined} styleValue Style value.\n * @param {Array.<module:ol/style/Style>} defaultStyle Default style.\n * @param {!Object.<string, (Array.<module:ol/style/Style>|string)>} sharedStyles\n * Shared styles.\n * @return {Array.<module:ol/style/Style>} Style.\n */\nfunction findStyle(styleValue, defaultStyle, sharedStyles) {\n  if (Array.isArray(styleValue)) {\n    return styleValue;\n  } else if (typeof styleValue === 'string') {\n    // KML files in the wild occasionally forget the leading `#` on styleUrls\n    // defined in the same document.  Add a leading `#` if it enables to find\n    // a style.\n    if (!(styleValue in sharedStyles) && ('#' + styleValue in sharedStyles)) {\n      styleValue = '#' + styleValue;\n    }\n    return findStyle(sharedStyles[styleValue], defaultStyle, sharedStyles);\n  } else {\n    return defaultStyle;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {module:ol/color~Color|undefined} Color.\n */\nfunction readColor(node) {\n  const s = getAllTextContent(node, false);\n  // The KML specification states that colors should not include a leading `#`\n  // but we tolerate them.\n  const m = /^\\s*#?\\s*([0-9A-Fa-f]{8})\\s*$/.exec(s);\n  if (m) {\n    const hexColor = m[1];\n    return [\n      parseInt(hexColor.substr(6, 2), 16),\n      parseInt(hexColor.substr(4, 2), 16),\n      parseInt(hexColor.substr(2, 2), 16),\n      parseInt(hexColor.substr(0, 2), 16) / 255\n    ];\n\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {Array.<number>|undefined} Flat coordinates.\n */\nexport function readFlatCoordinates(node) {\n  let s = getAllTextContent(node, false);\n  const flatCoordinates = [];\n  // The KML specification states that coordinate tuples should not include\n  // spaces, but we tolerate them.\n  const re =\n      /^\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)\\s*,\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)(?:\\s*,\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?))?\\s*/i;\n  let m;\n  while ((m = re.exec(s))) {\n    const x = parseFloat(m[1]);\n    const y = parseFloat(m[2]);\n    const z = m[3] ? parseFloat(m[3]) : 0;\n    flatCoordinates.push(x, y, z);\n    s = s.substr(m[0].length);\n  }\n  if (s !== '') {\n    return undefined;\n  }\n  return flatCoordinates;\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {string} URI.\n */\nfunction readURI(node) {\n  const s = getAllTextContent(node, false).trim();\n  let baseURI = node.baseURI;\n  if (!baseURI || baseURI == 'about:blank') {\n    baseURI = window.location.href;\n  }\n  if (baseURI) {\n    const url = new URL(s, baseURI);\n    return url.href;\n  } else {\n    return s;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {module:ol/format/KML~Vec2} Vec2.\n */\nfunction readVec2(node) {\n  const xunits = node.getAttribute('xunits');\n  const yunits = node.getAttribute('yunits');\n  let origin;\n  if (xunits !== 'insetPixels') {\n    if (yunits !== 'insetPixels') {\n      origin = IconOrigin.BOTTOM_LEFT;\n    } else {\n      origin = IconOrigin.TOP_LEFT;\n    }\n  } else {\n    if (yunits !== 'insetPixels') {\n      origin = IconOrigin.BOTTOM_RIGHT;\n    } else {\n      origin = IconOrigin.TOP_RIGHT;\n    }\n  }\n  return {\n    x: parseFloat(node.getAttribute('x')),\n    xunits: ICON_ANCHOR_UNITS_MAP[xunits],\n    y: parseFloat(node.getAttribute('y')),\n    yunits: ICON_ANCHOR_UNITS_MAP[yunits],\n    origin: origin\n  };\n}\n\n\n/**\n * @param {Node} node Node.\n * @return {number|undefined} Scale.\n */\nfunction readScale(node) {\n  return readDecimal(node);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst STYLE_MAP_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Pair': pairDataParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<module:ol/style/Style>|string|undefined} StyleMap.\n */\nfunction readStyleMapValue(node, objectStack) {\n  return pushParseAndPop(undefined,\n    STYLE_MAP_PARSERS, node, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst ICON_STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Icon': makeObjectPropertySetter(readIcon),\n    'heading': makeObjectPropertySetter(readDecimal),\n    'hotSpot': makeObjectPropertySetter(readVec2),\n    'scale': makeObjectPropertySetter(readScale)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction iconStyleParser(node, objectStack) {\n  // FIXME refreshMode\n  // FIXME refreshInterval\n  // FIXME viewRefreshTime\n  // FIXME viewBoundScale\n  // FIXME viewFormat\n  // FIXME httpQuery\n  const object = pushParseAndPop(\n    {}, ICON_STYLE_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const styleObject = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const IconObject = 'Icon' in object ? object['Icon'] : {};\n  const drawIcon = (!('Icon' in object) || Object.keys(IconObject).length > 0);\n  let src;\n  const href = /** @type {string|undefined} */\n      (IconObject['href']);\n  if (href) {\n    src = href;\n  } else if (drawIcon) {\n    src = DEFAULT_IMAGE_STYLE_SRC;\n  }\n  let anchor, anchorXUnits, anchorYUnits;\n  let anchorOrigin = IconOrigin.BOTTOM_LEFT;\n  const hotSpot = /** @type {module:ol/format/KML~Vec2|undefined} */\n      (object['hotSpot']);\n  if (hotSpot) {\n    anchor = [hotSpot.x, hotSpot.y];\n    anchorXUnits = hotSpot.xunits;\n    anchorYUnits = hotSpot.yunits;\n    anchorOrigin = hotSpot.origin;\n  } else if (src === DEFAULT_IMAGE_STYLE_SRC) {\n    anchor = DEFAULT_IMAGE_STYLE_ANCHOR;\n    anchorXUnits = DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS;\n    anchorYUnits = DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS;\n  } else if (/^http:\\/\\/maps\\.(?:google|gstatic)\\.com\\//.test(src)) {\n    anchor = [0.5, 0];\n    anchorXUnits = IconAnchorUnits.FRACTION;\n    anchorYUnits = IconAnchorUnits.FRACTION;\n  }\n\n  let offset;\n  const x = /** @type {number|undefined} */\n      (IconObject['x']);\n  const y = /** @type {number|undefined} */\n      (IconObject['y']);\n  if (x !== undefined && y !== undefined) {\n    offset = [x, y];\n  }\n\n  let size;\n  const w = /** @type {number|undefined} */\n      (IconObject['w']);\n  const h = /** @type {number|undefined} */\n      (IconObject['h']);\n  if (w !== undefined && h !== undefined) {\n    size = [w, h];\n  }\n\n  let rotation;\n  const heading = /** @type {number} */\n      (object['heading']);\n  if (heading !== undefined) {\n    rotation = toRadians(heading);\n  }\n\n  let scale = /** @type {number|undefined} */\n      (object['scale']);\n\n  if (drawIcon) {\n    if (src == DEFAULT_IMAGE_STYLE_SRC) {\n      size = DEFAULT_IMAGE_STYLE_SIZE;\n      if (scale === undefined) {\n        scale = DEFAULT_IMAGE_SCALE_MULTIPLIER;\n      }\n    }\n\n    const imageStyle = new Icon({\n      anchor: anchor,\n      anchorOrigin: anchorOrigin,\n      anchorXUnits: anchorXUnits,\n      anchorYUnits: anchorYUnits,\n      crossOrigin: 'anonymous', // FIXME should this be configurable?\n      offset: offset,\n      offsetOrigin: IconOrigin.BOTTOM_LEFT,\n      rotation: rotation,\n      scale: scale,\n      size: size,\n      src: src\n    });\n    styleObject['imageStyle'] = imageStyle;\n  } else {\n    // handle the case when we explicitly want to draw no icon.\n    styleObject['imageStyle'] = DEFAULT_NO_IMAGE_STYLE;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LABEL_STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeObjectPropertySetter(readColor),\n    'scale': makeObjectPropertySetter(readScale)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction labelStyleParser(node, objectStack) {\n  // FIXME colorMode\n  const object = pushParseAndPop(\n    {}, LABEL_STYLE_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const styleObject = objectStack[objectStack.length - 1];\n  const textStyle = new Text({\n    fill: new Fill({\n      color: /** @type {module:ol/color~Color} */\n          ('color' in object ? object['color'] : DEFAULT_COLOR)\n    }),\n    scale: /** @type {number|undefined} */\n        (object['scale'])\n  });\n  styleObject['textStyle'] = textStyle;\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LINE_STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeObjectPropertySetter(readColor),\n    'width': makeObjectPropertySetter(readDecimal)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction lineStyleParser(node, objectStack) {\n  // FIXME colorMode\n  // FIXME gx:outerColor\n  // FIXME gx:outerWidth\n  // FIXME gx:physicalWidth\n  // FIXME gx:labelVisibility\n  const object = pushParseAndPop(\n    {}, LINE_STYLE_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const styleObject = objectStack[objectStack.length - 1];\n  const strokeStyle = new Stroke({\n    color: /** @type {module:ol/color~Color} */\n        ('color' in object ? object['color'] : DEFAULT_COLOR),\n    width: /** @type {number} */ ('width' in object ? object['width'] : 1)\n  });\n  styleObject['strokeStyle'] = strokeStyle;\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst POLY_STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeObjectPropertySetter(readColor),\n    'fill': makeObjectPropertySetter(readBoolean),\n    'outline': makeObjectPropertySetter(readBoolean)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction polyStyleParser(node, objectStack) {\n  // FIXME colorMode\n  const object = pushParseAndPop(\n    {}, POLY_STYLE_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const styleObject = objectStack[objectStack.length - 1];\n  const fillStyle = new Fill({\n    color: /** @type {module:ol/color~Color} */\n        ('color' in object ? object['color'] : DEFAULT_COLOR)\n  });\n  styleObject['fillStyle'] = fillStyle;\n  const fill = /** @type {boolean|undefined} */ (object['fill']);\n  if (fill !== undefined) {\n    styleObject['fill'] = fill;\n  }\n  const outline = /** @type {boolean|undefined} */ (object['outline']);\n  if (outline !== undefined) {\n    styleObject['outline'] = outline;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst FLAT_LINEAR_RING_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'coordinates': makeReplacer(readFlatCoordinates)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<number>} LinearRing flat coordinates.\n */\nfunction readFlatLinearRing(node, objectStack) {\n  return pushParseAndPop(null,\n    FLAT_LINEAR_RING_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction gxCoordParser(node, objectStack) {\n  const gxTrackObject = /** @type {module:ol/format/KML~GxTrackObject} */\n      (objectStack[objectStack.length - 1]);\n  const flatCoordinates = gxTrackObject.flatCoordinates;\n  const s = getAllTextContent(node, false);\n  const re =\n      /^\\s*([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s*$/i;\n  const m = re.exec(s);\n  if (m) {\n    const x = parseFloat(m[1]);\n    const y = parseFloat(m[2]);\n    const z = parseFloat(m[3]);\n    flatCoordinates.push(x, y, z, 0);\n  } else {\n    flatCoordinates.push(0, 0, 0, 0);\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst GX_MULTITRACK_GEOMETRY_PARSERS = makeStructureNS(\n  GX_NAMESPACE_URIS, {\n    'Track': makeArrayPusher(readGxTrack)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/MultiLineString|undefined} MultiLineString.\n */\nfunction readGxMultiTrack(node, objectStack) {\n  const lineStrings = pushParseAndPop([],\n    GX_MULTITRACK_GEOMETRY_PARSERS, node, objectStack);\n  if (!lineStrings) {\n    return undefined;\n  }\n  const multiLineString = new MultiLineString(null);\n  multiLineString.setLineStrings(lineStrings);\n  return multiLineString;\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst GX_TRACK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'when': whenParser\n  }, makeStructureNS(\n    GX_NAMESPACE_URIS, {\n      'coord': gxCoordParser\n    }));\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/LineString|undefined} LineString.\n */\nfunction readGxTrack(node, objectStack) {\n  const gxTrackObject = pushParseAndPop(\n    /** @type {module:ol/format/KML~GxTrackObject} */ ({\n      flatCoordinates: [],\n      whens: []\n    }), GX_TRACK_PARSERS, node, objectStack);\n  if (!gxTrackObject) {\n    return undefined;\n  }\n  const flatCoordinates = gxTrackObject.flatCoordinates;\n  const whens = gxTrackObject.whens;\n  for (let i = 0, ii = Math.min(flatCoordinates.length, whens.length); i < ii; ++i) {\n    flatCoordinates[4 * i + 3] = whens[i];\n  }\n  const lineString = new LineString(null);\n  lineString.setFlatCoordinates(GeometryLayout.XYZM, flatCoordinates);\n  return lineString;\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst ICON_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'href': makeObjectPropertySetter(readURI)\n  }, makeStructureNS(\n    GX_NAMESPACE_URIS, {\n      'x': makeObjectPropertySetter(readDecimal),\n      'y': makeObjectPropertySetter(readDecimal),\n      'w': makeObjectPropertySetter(readDecimal),\n      'h': makeObjectPropertySetter(readDecimal)\n    }));\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object} Icon object.\n */\nfunction readIcon(node, objectStack) {\n  const iconObject = pushParseAndPop(\n    {}, ICON_PARSERS, node, objectStack);\n  if (iconObject) {\n    return iconObject;\n  } else {\n    return null;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst GEOMETRY_FLAT_COORDINATES_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'coordinates': makeReplacer(readFlatCoordinates)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<number>} Flat coordinates.\n */\nfunction readFlatCoordinatesFromNode(node, objectStack) {\n  return pushParseAndPop(null,\n    GEOMETRY_FLAT_COORDINATES_PARSERS, node, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst EXTRUDE_AND_ALTITUDE_MODE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'extrude': makeObjectPropertySetter(readBoolean),\n    'tessellate': makeObjectPropertySetter(readBoolean),\n    'altitudeMode': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/LineString|undefined} LineString.\n */\nfunction readLineString(node, objectStack) {\n  const properties = pushParseAndPop({},\n    EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node,\n    objectStack);\n  const flatCoordinates =\n      readFlatCoordinatesFromNode(node, objectStack);\n  if (flatCoordinates) {\n    const lineString = new LineString(null);\n    lineString.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    lineString.setProperties(properties);\n    return lineString;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Polygon|undefined} Polygon.\n */\nfunction readLinearRing(node, objectStack) {\n  const properties = pushParseAndPop({},\n    EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node,\n    objectStack);\n  const flatCoordinates =\n      readFlatCoordinatesFromNode(node, objectStack);\n  if (flatCoordinates) {\n    const polygon = new Polygon(null);\n    polygon.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates,\n      [flatCoordinates.length]);\n    polygon.setProperties(properties);\n    return polygon;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst MULTI_GEOMETRY_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LineString': makeArrayPusher(readLineString),\n    'LinearRing': makeArrayPusher(readLinearRing),\n    'MultiGeometry': makeArrayPusher(readMultiGeometry),\n    'Point': makeArrayPusher(readPoint),\n    'Polygon': makeArrayPusher(readPolygon)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Geometry} Geometry.\n */\nfunction readMultiGeometry(node, objectStack) {\n  const geometries = pushParseAndPop([],\n    MULTI_GEOMETRY_PARSERS, node, objectStack);\n  if (!geometries) {\n    return null;\n  }\n  if (geometries.length === 0) {\n    return new GeometryCollection(geometries);\n  }\n  /** @type {module:ol/geom/Geometry} */\n  let multiGeometry;\n  let homogeneous = true;\n  const type = geometries[0].getType();\n  let geometry;\n  for (let i = 1, ii = geometries.length; i < ii; ++i) {\n    geometry = geometries[i];\n    if (geometry.getType() != type) {\n      homogeneous = false;\n      break;\n    }\n  }\n  if (homogeneous) {\n    let layout;\n    let flatCoordinates;\n    if (type == GeometryType.POINT) {\n      const point = geometries[0];\n      layout = point.getLayout();\n      flatCoordinates = point.getFlatCoordinates();\n      for (let i = 1, ii = geometries.length; i < ii; ++i) {\n        geometry = geometries[i];\n        extend(flatCoordinates, geometry.getFlatCoordinates());\n      }\n      multiGeometry = new MultiPoint(null);\n      multiGeometry.setFlatCoordinates(layout, flatCoordinates);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.LINE_STRING) {\n      multiGeometry = new MultiLineString(null);\n      multiGeometry.setLineStrings(geometries);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.POLYGON) {\n      multiGeometry = new MultiPolygon(null);\n      multiGeometry.setPolygons(geometries);\n      setCommonGeometryProperties(multiGeometry, geometries);\n    } else if (type == GeometryType.GEOMETRY_COLLECTION) {\n      multiGeometry = new GeometryCollection(geometries);\n    } else {\n      assert(false, 37); // Unknown geometry type found\n    }\n  } else {\n    multiGeometry = new GeometryCollection(geometries);\n  }\n  return (\n    /** @type {module:ol/geom/Geometry} */ (multiGeometry)\n  );\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Point|undefined} Point.\n */\nfunction readPoint(node, objectStack) {\n  const properties = pushParseAndPop({},\n    EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node,\n    objectStack);\n  const flatCoordinates =\n      readFlatCoordinatesFromNode(node, objectStack);\n  if (flatCoordinates) {\n    const point = new Point(null);\n    point.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates);\n    point.setProperties(properties);\n    return point;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst FLAT_LINEAR_RINGS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'innerBoundaryIs': innerBoundaryIsParser,\n    'outerBoundaryIs': outerBoundaryIsParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/geom/Polygon|undefined} Polygon.\n */\nfunction readPolygon(node, objectStack) {\n  const properties = pushParseAndPop(/** @type {Object<string,*>} */ ({}),\n    EXTRUDE_AND_ALTITUDE_MODE_PARSERS, node,\n    objectStack);\n  const flatLinearRings = pushParseAndPop([null],\n    FLAT_LINEAR_RINGS_PARSERS, node, objectStack);\n  if (flatLinearRings && flatLinearRings[0]) {\n    const polygon = new Polygon(null);\n    const flatCoordinates = flatLinearRings[0];\n    const ends = [flatCoordinates.length];\n    for (let i = 1, ii = flatLinearRings.length; i < ii; ++i) {\n      extend(flatCoordinates, flatLinearRings[i]);\n      ends.push(flatCoordinates.length);\n    }\n    polygon.setFlatCoordinates(GeometryLayout.XYZ, flatCoordinates, ends);\n    polygon.setProperties(properties);\n    return polygon;\n  } else {\n    return undefined;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'IconStyle': iconStyleParser,\n    'LabelStyle': labelStyleParser,\n    'LineStyle': lineStyleParser,\n    'PolyStyle': polyStyleParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<module:ol/style/Style>} Style.\n */\nfunction readStyle(node, objectStack) {\n  const styleObject = pushParseAndPop(\n    {}, STYLE_PARSERS, node, objectStack);\n  if (!styleObject) {\n    return null;\n  }\n  let fillStyle = /** @type {module:ol/style/Fill} */\n      ('fillStyle' in styleObject ?\n        styleObject['fillStyle'] : DEFAULT_FILL_STYLE);\n  const fill = /** @type {boolean|undefined} */ (styleObject['fill']);\n  if (fill !== undefined && !fill) {\n    fillStyle = null;\n  }\n  let imageStyle = /** @type {module:ol/style/Image} */\n      ('imageStyle' in styleObject ?\n        styleObject['imageStyle'] : DEFAULT_IMAGE_STYLE);\n  if (imageStyle == DEFAULT_NO_IMAGE_STYLE) {\n    imageStyle = undefined;\n  }\n  const textStyle = /** @type {module:ol/style/Text} */\n      ('textStyle' in styleObject ?\n        styleObject['textStyle'] : DEFAULT_TEXT_STYLE);\n  let strokeStyle = /** @type {module:ol/style/Stroke} */\n      ('strokeStyle' in styleObject ?\n        styleObject['strokeStyle'] : DEFAULT_STROKE_STYLE);\n  const outline = /** @type {boolean|undefined} */\n      (styleObject['outline']);\n  if (outline !== undefined && !outline) {\n    strokeStyle = null;\n  }\n  return [new Style({\n    fill: fillStyle,\n    image: imageStyle,\n    stroke: strokeStyle,\n    text: textStyle,\n    zIndex: undefined // FIXME\n  })];\n}\n\n\n/**\n * Reads an array of geometries and creates arrays for common geometry\n * properties. Then sets them to the multi geometry.\n * @param {module:ol/geom/MultiPoint|module:ol/geom/MultiLineString|module:ol/geom/MultiPolygon}\n *     multiGeometry A multi-geometry.\n * @param {Array.<module:ol/geom/Geometry>} geometries List of geometries.\n */\nfunction setCommonGeometryProperties(multiGeometry, geometries) {\n  const ii = geometries.length;\n  const extrudes = new Array(geometries.length);\n  const tessellates = new Array(geometries.length);\n  const altitudeModes = new Array(geometries.length);\n  let hasExtrude, hasTessellate, hasAltitudeMode;\n  hasExtrude = hasTessellate = hasAltitudeMode = false;\n  for (let i = 0; i < ii; ++i) {\n    const geometry = geometries[i];\n    extrudes[i] = geometry.get('extrude');\n    tessellates[i] = geometry.get('tessellate');\n    altitudeModes[i] = geometry.get('altitudeMode');\n    hasExtrude = hasExtrude || extrudes[i] !== undefined;\n    hasTessellate = hasTessellate || tessellates[i] !== undefined;\n    hasAltitudeMode = hasAltitudeMode || altitudeModes[i];\n  }\n  if (hasExtrude) {\n    multiGeometry.set('extrude', extrudes);\n  }\n  if (hasTessellate) {\n    multiGeometry.set('tessellate', tessellates);\n  }\n  if (hasAltitudeMode) {\n    multiGeometry.set('altitudeMode', altitudeModes);\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst DATA_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'displayName': makeObjectPropertySetter(readString),\n    'value': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction dataParser(node, objectStack) {\n  const name = node.getAttribute('name');\n  parseNode(DATA_PARSERS, node, objectStack);\n  const featureObject = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  if (name !== null) {\n    featureObject[name] = featureObject.value;\n  } else if (featureObject.displayName !== null) {\n    featureObject[featureObject.displayName] = featureObject.value;\n  }\n  delete featureObject['value'];\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst EXTENDED_DATA_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Data': dataParser,\n    'SchemaData': schemaDataParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction extendedDataParser(node, objectStack) {\n  parseNode(EXTENDED_DATA_PARSERS, node, objectStack);\n}\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst REGION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LatLonAltBox': latLonAltBoxParser,\n    'Lod': lodParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction regionParser(node, objectStack) {\n  parseNode(REGION_PARSERS, node, objectStack);\n}\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PAIR_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Style': makeObjectPropertySetter(readStyle),\n    'key': makeObjectPropertySetter(readString),\n    'styleUrl': makeObjectPropertySetter(readURI)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction pairDataParser(node, objectStack) {\n  const pairObject = pushParseAndPop(\n    {}, PAIR_PARSERS, node, objectStack);\n  if (!pairObject) {\n    return;\n  }\n  const key = /** @type {string|undefined} */\n      (pairObject['key']);\n  if (key && key == 'normal') {\n    const styleUrl = /** @type {string|undefined} */\n        (pairObject['styleUrl']);\n    if (styleUrl) {\n      objectStack[objectStack.length - 1] = styleUrl;\n    }\n    const Style = /** @type {module:ol/style/Style} */\n        (pairObject['Style']);\n    if (Style) {\n      objectStack[objectStack.length - 1] = Style;\n    }\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction placemarkStyleMapParser(node, objectStack) {\n  const styleMapValue = readStyleMapValue(node, objectStack);\n  if (!styleMapValue) {\n    return;\n  }\n  const placemarkObject = objectStack[objectStack.length - 1];\n  if (Array.isArray(styleMapValue)) {\n    placemarkObject['Style'] = styleMapValue;\n  } else if (typeof styleMapValue === 'string') {\n    placemarkObject['styleUrl'] = styleMapValue;\n  } else {\n    assert(false, 38); // `styleMapValue` has an unknown type\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst SCHEMA_DATA_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'SimpleData': simpleDataParser\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction schemaDataParser(node, objectStack) {\n  parseNode(SCHEMA_DATA_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction simpleDataParser(node, objectStack) {\n  const name = node.getAttribute('name');\n  if (name !== null) {\n    const data = readString(node);\n    const featureObject = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n    featureObject[name] = data;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LAT_LON_ALT_BOX_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'altitudeMode': makeObjectPropertySetter(readString),\n    'minAltitude': makeObjectPropertySetter(readDecimal),\n    'maxAltitude': makeObjectPropertySetter(readDecimal),\n    'north': makeObjectPropertySetter(readDecimal),\n    'south': makeObjectPropertySetter(readDecimal),\n    'east': makeObjectPropertySetter(readDecimal),\n    'west': makeObjectPropertySetter(readDecimal)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction latLonAltBoxParser(node, objectStack) {\n  const object = pushParseAndPop({}, LAT_LON_ALT_BOX_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const regionObject = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const extent = [\n    parseFloat(object['west']),\n    parseFloat(object['south']),\n    parseFloat(object['east']),\n    parseFloat(object['north'])\n  ];\n  regionObject['extent'] = extent;\n  regionObject['altitudeMode'] = object['altitudeMode'];\n  regionObject['minAltitude'] = parseFloat(object['minAltitude']);\n  regionObject['maxAltitude'] = parseFloat(object['maxAltitude']);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LOD_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'minLodPixels': makeObjectPropertySetter(readDecimal),\n    'maxLodPixels': makeObjectPropertySetter(readDecimal),\n    'minFadeExtent': makeObjectPropertySetter(readDecimal),\n    'maxFadeExtent': makeObjectPropertySetter(readDecimal)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction lodParser(node, objectStack) {\n  const object = pushParseAndPop({}, LOD_PARSERS, node, objectStack);\n  if (!object) {\n    return;\n  }\n  const lodObject = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  lodObject['minLodPixels'] = parseFloat(object['minLodPixels']);\n  lodObject['maxLodPixels'] = parseFloat(object['maxLodPixels']);\n  lodObject['minFadeExtent'] = parseFloat(object['minFadeExtent']);\n  lodObject['maxFadeExtent'] = parseFloat(object['maxFadeExtent']);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst INNER_BOUNDARY_IS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LinearRing': makeReplacer(readFlatLinearRing)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction innerBoundaryIsParser(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    INNER_BOUNDARY_IS_PARSERS, node, objectStack);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings.push(flatLinearRing);\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst OUTER_BOUNDARY_IS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LinearRing': makeReplacer(readFlatLinearRing)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction outerBoundaryIsParser(node, objectStack) {\n  /** @type {Array.<number>|undefined} */\n  const flatLinearRing = pushParseAndPop(undefined,\n    OUTER_BOUNDARY_IS_PARSERS, node, objectStack);\n  if (flatLinearRing) {\n    const flatLinearRings = /** @type {Array.<Array.<number>>} */\n        (objectStack[objectStack.length - 1]);\n    flatLinearRings[0] = flatLinearRing;\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst NETWORK_LINK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ExtendedData': extendedDataParser,\n    'Region': regionParser,\n    'Link': linkParser,\n    'address': makeObjectPropertySetter(readString),\n    'description': makeObjectPropertySetter(readString),\n    'name': makeObjectPropertySetter(readString),\n    'open': makeObjectPropertySetter(readBoolean),\n    'phoneNumber': makeObjectPropertySetter(readString),\n    'visibility': makeObjectPropertySetter(readBoolean)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LINK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'href': makeObjectPropertySetter(readURI)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction linkParser(node, objectStack) {\n  parseNode(LINK_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction whenParser(node, objectStack) {\n  const gxTrackObject = /** @type {module:ol/format/KML~GxTrackObject} */\n      (objectStack[objectStack.length - 1]);\n  const whens = gxTrackObject.whens;\n  const s = getAllTextContent(node, false);\n  const when = Date.parse(s);\n  whens.push(isNaN(when) ? 0 : when);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PLACEMARK_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ExtendedData': extendedDataParser,\n    'Region': regionParser,\n    'MultiGeometry': makeObjectPropertySetter(\n      readMultiGeometry, 'geometry'),\n    'LineString': makeObjectPropertySetter(\n      readLineString, 'geometry'),\n    'LinearRing': makeObjectPropertySetter(\n      readLinearRing, 'geometry'),\n    'Point': makeObjectPropertySetter(\n      readPoint, 'geometry'),\n    'Polygon': makeObjectPropertySetter(\n      readPolygon, 'geometry'),\n    'Style': makeObjectPropertySetter(readStyle),\n    'StyleMap': placemarkStyleMapParser,\n    'address': makeObjectPropertySetter(readString),\n    'description': makeObjectPropertySetter(readString),\n    'name': makeObjectPropertySetter(readString),\n    'open': makeObjectPropertySetter(readBoolean),\n    'phoneNumber': makeObjectPropertySetter(readString),\n    'styleUrl': makeObjectPropertySetter(readURI),\n    'visibility': makeObjectPropertySetter(readBoolean)\n  }, makeStructureNS(\n    GX_NAMESPACE_URIS, {\n      'MultiTrack': makeObjectPropertySetter(\n        readGxMultiTrack, 'geometry'),\n      'Track': makeObjectPropertySetter(\n        readGxTrack, 'geometry')\n    }\n  ));\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {Array.<module:ol/Feature>|undefined} Features.\n */\nKML.prototype.readDocumentOrFolder_ = function(node, objectStack) {\n  // FIXME use scope somehow\n  const parsersNS = makeStructureNS(\n    NAMESPACE_URIS, {\n      'Document': makeArrayExtender(this.readDocumentOrFolder_, this),\n      'Folder': makeArrayExtender(this.readDocumentOrFolder_, this),\n      'Placemark': makeArrayPusher(this.readPlacemark_, this),\n      'Style': this.readSharedStyle_.bind(this),\n      'StyleMap': this.readSharedStyleMap_.bind(this)\n    });\n  /** @type {Array.<module:ol/Feature>} */\n  const features = pushParseAndPop([], parsersNS, node, objectStack, this);\n  if (features) {\n    return features;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n * @return {module:ol/Feature|undefined} Feature.\n */\nKML.prototype.readPlacemark_ = function(node, objectStack) {\n  const object = pushParseAndPop({'geometry': null},\n    PLACEMARK_PARSERS, node, objectStack);\n  if (!object) {\n    return undefined;\n  }\n  const feature = new Feature();\n  const id = node.getAttribute('id');\n  if (id !== null) {\n    feature.setId(id);\n  }\n  const options = /** @type {module:ol/format/Feature~ReadOptions} */ (objectStack[0]);\n\n  const geometry = object['geometry'];\n  if (geometry) {\n    transformWithOptions(geometry, false, options);\n  }\n  feature.setGeometry(geometry);\n  delete object['geometry'];\n\n  if (this.extractStyles_) {\n    const style = object['Style'];\n    const styleUrl = object['styleUrl'];\n    const styleFunction = createFeatureStyleFunction(\n      style, styleUrl, this.defaultStyle_, this.sharedStyles_,\n      this.showPointNames_);\n    feature.setStyle(styleFunction);\n  }\n  delete object['Style'];\n  // we do not remove the styleUrl property from the object, so it\n  // gets stored on feature when setProperties is called\n\n  feature.setProperties(object);\n\n  return feature;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nKML.prototype.readSharedStyle_ = function(node, objectStack) {\n  const id = node.getAttribute('id');\n  if (id !== null) {\n    const style = readStyle(node, objectStack);\n    if (style) {\n      let styleUri;\n      let baseURI = node.baseURI;\n      if (!baseURI || baseURI == 'about:blank') {\n        baseURI = window.location.href;\n      }\n      if (baseURI) {\n        const url = new URL('#' + id, baseURI);\n        styleUri = url.href;\n      } else {\n        styleUri = '#' + id;\n      }\n      this.sharedStyles_[styleUri] = style;\n    }\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @private\n */\nKML.prototype.readSharedStyleMap_ = function(node, objectStack) {\n  const id = node.getAttribute('id');\n  if (id === null) {\n    return;\n  }\n  const styleMapValue = readStyleMapValue(node, objectStack);\n  if (!styleMapValue) {\n    return;\n  }\n  let styleUri;\n  let baseURI = node.baseURI;\n  if (!baseURI || baseURI == 'about:blank') {\n    baseURI = window.location.href;\n  }\n  if (baseURI) {\n    const url = new URL('#' + id, baseURI);\n    styleUri = url.href;\n  } else {\n    styleUri = '#' + id;\n  }\n  this.sharedStyles_[styleUri] = styleMapValue;\n};\n\n\n/**\n * Read the first feature from a KML source. MultiGeometries are converted into\n * GeometryCollections if they are a mix of geometry types, and into MultiPoint/\n * MultiLineString/MultiPolygon if they are all of the same type.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nKML.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nKML.prototype.readFeatureFromNode = function(node, opt_options) {\n  if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n    return null;\n  }\n  const feature = this.readPlacemark_(\n    node, [this.getReadOptions(node, opt_options)]);\n  if (feature) {\n    return feature;\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * Read all features from a KML source. MultiGeometries are converted into\n * GeometryCollections if they are a mix of geometry types, and into MultiPoint/\n * MultiLineString/MultiPolygon if they are all of the same type.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nKML.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nKML.prototype.readFeaturesFromNode = function(node, opt_options) {\n  if (!includes(NAMESPACE_URIS, node.namespaceURI)) {\n    return [];\n  }\n  let features;\n  const localName = node.localName;\n  if (localName == 'Document' || localName == 'Folder') {\n    features = this.readDocumentOrFolder_(\n      node, [this.getReadOptions(node, opt_options)]);\n    if (features) {\n      return features;\n    } else {\n      return [];\n    }\n  } else if (localName == 'Placemark') {\n    const feature = this.readPlacemark_(\n      node, [this.getReadOptions(node, opt_options)]);\n    if (feature) {\n      return [feature];\n    } else {\n      return [];\n    }\n  } else if (localName == 'kml') {\n    features = [];\n    for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n      const fs = this.readFeaturesFromNode(n, opt_options);\n      if (fs) {\n        extend(features, fs);\n      }\n    }\n    return features;\n  } else {\n    return [];\n  }\n};\n\n\n/**\n * Read the name of the KML.\n *\n * @param {Document|Node|string} source Source.\n * @return {string|undefined} Name.\n * @api\n */\nKML.prototype.readName = function(source) {\n  if (isDocument(source)) {\n    return this.readNameFromDocument(/** @type {Document} */ (source));\n  } else if (isNode(source)) {\n    return this.readNameFromNode(/** @type {Node} */ (source));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readNameFromDocument(doc);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @return {string|undefined} Name.\n */\nKML.prototype.readNameFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      const name = this.readNameFromNode(n);\n      if (name) {\n        return name;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @param {Node} node Node.\n * @return {string|undefined} Name.\n */\nKML.prototype.readNameFromNode = function(node) {\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        n.localName == 'name') {\n      return readString(n);\n    }\n  }\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    const localName = n.localName;\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        (localName == 'Document' ||\n         localName == 'Folder' ||\n         localName == 'Placemark' ||\n         localName == 'kml')) {\n      const name = this.readNameFromNode(n);\n      if (name) {\n        return name;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * Read the network links of the KML.\n *\n * @param {Document|Node|string} source Source.\n * @return {Array.<Object>} Network links.\n * @api\n */\nKML.prototype.readNetworkLinks = function(source) {\n  const networkLinks = [];\n  if (isDocument(source)) {\n    extend(networkLinks, this.readNetworkLinksFromDocument(\n      /** @type {Document} */ (source)));\n  } else if (isNode(source)) {\n    extend(networkLinks, this.readNetworkLinksFromNode(\n      /** @type {Node} */ (source)));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    extend(networkLinks, this.readNetworkLinksFromDocument(doc));\n  }\n  return networkLinks;\n};\n\n\n/**\n * @param {Document} doc Document.\n * @return {Array.<Object>} Network links.\n */\nKML.prototype.readNetworkLinksFromDocument = function(doc) {\n  const networkLinks = [];\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      extend(networkLinks, this.readNetworkLinksFromNode(n));\n    }\n  }\n  return networkLinks;\n};\n\n\n/**\n * @param {Node} node Node.\n * @return {Array.<Object>} Network links.\n */\nKML.prototype.readNetworkLinksFromNode = function(node) {\n  const networkLinks = [];\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        n.localName == 'NetworkLink') {\n      const obj = pushParseAndPop({}, NETWORK_LINK_PARSERS,\n        n, []);\n      networkLinks.push(obj);\n    }\n  }\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    const localName = n.localName;\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        (localName == 'Document' ||\n         localName == 'Folder' ||\n         localName == 'kml')) {\n      extend(networkLinks, this.readNetworkLinksFromNode(n));\n    }\n  }\n  return networkLinks;\n};\n\n\n/**\n * Read the regions of the KML.\n *\n * @param {Document|Node|string} source Source.\n * @return {Array.<Object>} Regions.\n * @api\n */\nKML.prototype.readRegion = function(source) {\n  const regions = [];\n  if (isDocument(source)) {\n    extend(regions, this.readRegionFromDocument(\n      /** @type {Document} */ (source)));\n  } else if (isNode(source)) {\n    extend(regions, this.readRegionFromNode(\n      /** @type {Node} */ (source)));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    extend(regions, this.readRegionFromDocument(doc));\n  }\n  return regions;\n};\n\n\n/**\n * @param {Document} doc Document.\n * @return {Array.<Object>} Region.\n */\nKML.prototype.readRegionFromDocument = function(doc) {\n  const regions = [];\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      extend(regions, this.readRegionFromNode(n));\n    }\n  }\n  return regions;\n};\n\n\n/**\n * @param {Node} node Node.\n * @return {Array.<Object>} Region.\n * @api\n */\nKML.prototype.readRegionFromNode = function(node) {\n  const regions = [];\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        n.localName == 'Region') {\n      const obj = pushParseAndPop({}, REGION_PARSERS,\n        n, []);\n      regions.push(obj);\n    }\n  }\n  for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n    const localName = n.localName;\n    if (includes(NAMESPACE_URIS, n.namespaceURI) &&\n        (localName == 'Document' ||\n         localName == 'Folder' ||\n         localName == 'kml')) {\n      extend(regions, this.readRegionFromNode(n));\n    }\n  }\n  return regions;\n};\n\n\n/**\n * Read the projection from a KML source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nKML.prototype.readProjection;\n\n\n/**\n * @param {Node} node Node to append a TextNode with the color to.\n * @param {module:ol/color~Color|string} color Color.\n */\nfunction writeColorTextNode(node, color) {\n  const rgba = asArray(color);\n  const opacity = (rgba.length == 4) ? rgba[3] : 1;\n  const abgr = [opacity * 255, rgba[2], rgba[1], rgba[0]];\n  for (let i = 0; i < 4; ++i) {\n    const hex = parseInt(abgr[i], 10).toString(16);\n    abgr[i] = (hex.length == 1) ? '0' + hex : hex;\n  }\n  writeStringTextNode(node, abgr.join(''));\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the coordinates to.\n * @param {Array.<number>} coordinates Coordinates.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeCoordinatesTextNode(node, coordinates, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n\n  const layout = context['layout'];\n  const stride = context['stride'];\n\n  let dimension;\n  if (layout == GeometryLayout.XY ||\n      layout == GeometryLayout.XYM) {\n    dimension = 2;\n  } else if (layout == GeometryLayout.XYZ ||\n      layout == GeometryLayout.XYZM) {\n    dimension = 3;\n  } else {\n    assert(false, 34); // Invalid geometry layout\n  }\n\n  const ii = coordinates.length;\n  let text = '';\n  if (ii > 0) {\n    text += coordinates[0];\n    for (let d = 1; d < dimension; ++d) {\n      text += ',' + coordinates[d];\n    }\n    for (let i = stride; i < ii; i += stride) {\n      text += ' ' + coordinates[i];\n      for (let d = 1; d < dimension; ++d) {\n        text += ',' + coordinates[i + d];\n      }\n    }\n  }\n  writeStringTextNode(node, text);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst EXTENDEDDATA_NODE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Data': makeChildAppender(writeDataNode),\n    'value': makeChildAppender(writeDataNodeValue),\n    'displayName': makeChildAppender(writeDataNodeName)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {{name: *, value: *}} pair Name value pair.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeDataNode(node, pair, objectStack) {\n  node.setAttribute('name', pair.name);\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const value = pair.value;\n\n  if (typeof value == 'object') {\n    if (value !== null && value.displayName) {\n      pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS,\n        OBJECT_PROPERTY_NODE_FACTORY, [value.displayName], objectStack, ['displayName']);\n    }\n\n    if (value !== null && value.value) {\n      pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS,\n        OBJECT_PROPERTY_NODE_FACTORY, [value.value], objectStack, ['value']);\n    }\n  } else {\n    pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS,\n      OBJECT_PROPERTY_NODE_FACTORY, [value], objectStack, ['value']);\n  }\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the name to.\n * @param {string} name DisplayName.\n */\nfunction writeDataNodeName(node, name) {\n  writeCDATASection(node, name);\n}\n\n\n/**\n * @param {Node} node Node to append a CDATA Section with the value to.\n * @param {string} value Value.\n */\nfunction writeDataNodeValue(node, value) {\n  writeStringTextNode(node, value);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst DOCUMENT_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Placemark': makeChildAppender(writePlacemark)\n  });\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n */\nconst DOCUMENT_NODE_FACTORY = function(value, objectStack, opt_nodeName) {\n  const parentNode = objectStack[objectStack.length - 1].node;\n  return createElementNS(parentNode.namespaceURI, 'Placemark');\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {Array.<*>} objectStack Object stack.\n * @this {module:ol/format/KML}\n */\nfunction writeDocument(node, features, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  pushSerializeAndPop(context, DOCUMENT_SERIALIZERS,\n    DOCUMENT_NODE_FACTORY, features, objectStack, undefined,\n    this);\n}\n\n\n/**\n * A factory for creating Data nodes.\n * @const\n * @type {function(*, Array.<*>): (Node|undefined)}\n */\nconst DATA_NODE_FACTORY = makeSimpleNodeFactory('Data');\n\n\n/**\n * @param {Node} node Node.\n * @param {{names: Array<string>, values: (Array<*>)}} namesAndValues Names and values.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeExtendedData(node, namesAndValues, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const names = namesAndValues.names;\n  const values = namesAndValues.values;\n  const length = names.length;\n\n  for (let i = 0; i < length; i++) {\n    pushSerializeAndPop(context, EXTENDEDDATA_NODE_SERIALIZERS,\n      DATA_NODE_FACTORY, [{name: names[i], value: values[i]}], objectStack);\n  }\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst ICON_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'href'\n  ],\n  makeStructureNS(GX_NAMESPACE_URIS, [\n    'x', 'y', 'w', 'h'\n  ]));\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst ICON_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'href': makeChildAppender(writeStringTextNode)\n  }, makeStructureNS(\n    GX_NAMESPACE_URIS, {\n      'x': makeChildAppender(writeDecimalTextNode),\n      'y': makeChildAppender(writeDecimalTextNode),\n      'w': makeChildAppender(writeDecimalTextNode),\n      'h': makeChildAppender(writeDecimalTextNode)\n    }));\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n */\nconst GX_NODE_FACTORY = function(value, objectStack, opt_nodeName) {\n  return createElementNS(GX_NAMESPACE_URIS[0],\n    'gx:' + opt_nodeName);\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Object} icon Icon object.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeIcon(node, icon, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const parentNode = objectStack[objectStack.length - 1].node;\n  let orderedKeys = ICON_SEQUENCE[parentNode.namespaceURI];\n  let values = makeSequence(icon, orderedKeys);\n  pushSerializeAndPop(context,\n    ICON_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY,\n    values, objectStack, orderedKeys);\n  orderedKeys =\n      ICON_SEQUENCE[GX_NAMESPACE_URIS[0]];\n  values = makeSequence(icon, orderedKeys);\n  pushSerializeAndPop(context, ICON_SERIALIZERS,\n    GX_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst ICON_STYLE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'scale', 'heading', 'Icon', 'hotSpot'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst ICON_STYLE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Icon': makeChildAppender(writeIcon),\n    'heading': makeChildAppender(writeDecimalTextNode),\n    'hotSpot': makeChildAppender(writeVec2),\n    'scale': makeChildAppender(writeScaleTextNode)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/style/Icon} style Icon style.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeIconStyle(node, style, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const properties = {};\n  const src = style.getSrc();\n  const size = style.getSize();\n  const iconImageSize = style.getImageSize();\n  const iconProperties = {\n    'href': src\n  };\n\n  if (size) {\n    iconProperties['w'] = size[0];\n    iconProperties['h'] = size[1];\n    const anchor = style.getAnchor(); // top-left\n    const origin = style.getOrigin(); // top-left\n\n    if (origin && iconImageSize && origin[0] !== 0 && origin[1] !== size[1]) {\n      iconProperties['x'] = origin[0];\n      iconProperties['y'] = iconImageSize[1] - (origin[1] + size[1]);\n    }\n\n    if (anchor && (anchor[0] !== size[0] / 2 || anchor[1] !== size[1] / 2)) {\n      const /** @type {module:ol/format/KML~Vec2} */ hotSpot = {\n        x: anchor[0],\n        xunits: IconAnchorUnits.PIXELS,\n        y: size[1] - anchor[1],\n        yunits: IconAnchorUnits.PIXELS\n      };\n      properties['hotSpot'] = hotSpot;\n    }\n  }\n\n  properties['Icon'] = iconProperties;\n\n  const scale = style.getScale();\n  if (scale !== 1) {\n    properties['scale'] = scale;\n  }\n\n  const rotation = style.getRotation();\n  if (rotation !== 0) {\n    properties['heading'] = rotation; // 0-360\n  }\n\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = ICON_STYLE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, ICON_STYLE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst LABEL_STYLE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'color', 'scale'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst LABEL_STYLE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeChildAppender(writeColorTextNode),\n    'scale': makeChildAppender(writeScaleTextNode)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/style/Text} style style.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeLabelStyle(node, style, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const properties = {};\n  const fill = style.getFill();\n  if (fill) {\n    properties['color'] = fill.getColor();\n  }\n  const scale = style.getScale();\n  if (scale && scale !== 1) {\n    properties['scale'] = scale;\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys =\n      LABEL_STYLE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, LABEL_STYLE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst LINE_STYLE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'color', 'width'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst LINE_STYLE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeChildAppender(writeColorTextNode),\n    'width': makeChildAppender(writeDecimalTextNode)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/style/Stroke} style style.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeLineStyle(node, style, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const properties = {\n    'color': style.getColor(),\n    'width': style.getWidth()\n  };\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = LINE_STYLE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, LINE_STYLE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @const\n * @type {Object.<string, string>}\n */\nconst GEOMETRY_TYPE_TO_NODENAME = {\n  'Point': 'Point',\n  'LineString': 'LineString',\n  'LinearRing': 'LinearRing',\n  'Polygon': 'Polygon',\n  'MultiPoint': 'MultiGeometry',\n  'MultiLineString': 'MultiGeometry',\n  'MultiPolygon': 'MultiGeometry',\n  'GeometryCollection': 'MultiGeometry'\n};\n\n\n/**\n * @const\n * @param {*} value Value.\n * @param {Array.<*>} objectStack Object stack.\n * @param {string=} opt_nodeName Node name.\n * @return {Node|undefined} Node.\n */\nconst GEOMETRY_NODE_FACTORY = function(value, objectStack, opt_nodeName) {\n  if (value) {\n    const parentNode = objectStack[objectStack.length - 1].node;\n    return createElementNS(parentNode.namespaceURI,\n      GEOMETRY_TYPE_TO_NODENAME[/** @type {module:ol/geom/Geometry} */ (value).getType()]);\n  }\n};\n\n\n/**\n * A factory for creating Point nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst POINT_NODE_FACTORY = makeSimpleNodeFactory('Point');\n\n\n/**\n * A factory for creating LineString nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst LINE_STRING_NODE_FACTORY = makeSimpleNodeFactory('LineString');\n\n\n/**\n * A factory for creating LinearRing nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst LINEAR_RING_NODE_FACTORY = makeSimpleNodeFactory('LinearRing');\n\n\n/**\n * A factory for creating Polygon nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst POLYGON_NODE_FACTORY = makeSimpleNodeFactory('Polygon');\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst MULTI_GEOMETRY_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LineString': makeChildAppender(\n      writePrimitiveGeometry),\n    'Point': makeChildAppender(\n      writePrimitiveGeometry),\n    'Polygon': makeChildAppender(writePolygon),\n    'GeometryCollection': makeChildAppender(\n      writeMultiGeometry)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeMultiGeometry(node, geometry, objectStack) {\n  /** @type {module:ol/xml~NodeStackItem} */\n  const context = {node: node};\n  const type = geometry.getType();\n  /** @type {Array.<module:ol/geom/Geometry>} */\n  let geometries;\n  /** @type {function(*, Array.<*>, string=): (Node|undefined)} */\n  let factory;\n  if (type == GeometryType.GEOMETRY_COLLECTION) {\n    geometries = /** @type {module:ol/geom/GeometryCollection} */ (geometry).getGeometries();\n    factory = GEOMETRY_NODE_FACTORY;\n  } else if (type == GeometryType.MULTI_POINT) {\n    geometries = /** @type {module:ol/geom/MultiPoint} */ (geometry).getPoints();\n    factory = POINT_NODE_FACTORY;\n  } else if (type == GeometryType.MULTI_LINE_STRING) {\n    geometries =\n        (/** @type {module:ol/geom/MultiLineString} */ (geometry)).getLineStrings();\n    factory = LINE_STRING_NODE_FACTORY;\n  } else if (type == GeometryType.MULTI_POLYGON) {\n    geometries =\n        (/** @type {module:ol/geom/MultiPolygon} */ (geometry)).getPolygons();\n    factory = POLYGON_NODE_FACTORY;\n  } else {\n    assert(false, 39); // Unknown geometry type\n  }\n  pushSerializeAndPop(context,\n    MULTI_GEOMETRY_SERIALIZERS, factory,\n    geometries, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst BOUNDARY_IS_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LinearRing': makeChildAppender(\n      writePrimitiveGeometry)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/LinearRing} linearRing Linear ring.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeBoundaryIs(node, linearRing, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  pushSerializeAndPop(context,\n    BOUNDARY_IS_SERIALIZERS,\n    LINEAR_RING_NODE_FACTORY, [linearRing], objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst PLACEMARK_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ExtendedData': makeChildAppender(writeExtendedData),\n    'MultiGeometry': makeChildAppender(writeMultiGeometry),\n    'LineString': makeChildAppender(writePrimitiveGeometry),\n    'LinearRing': makeChildAppender(writePrimitiveGeometry),\n    'Point': makeChildAppender(writePrimitiveGeometry),\n    'Polygon': makeChildAppender(writePolygon),\n    'Style': makeChildAppender(writeStyle),\n    'address': makeChildAppender(writeStringTextNode),\n    'description': makeChildAppender(writeStringTextNode),\n    'name': makeChildAppender(writeStringTextNode),\n    'open': makeChildAppender(writeBooleanTextNode),\n    'phoneNumber': makeChildAppender(writeStringTextNode),\n    'styleUrl': makeChildAppender(writeStringTextNode),\n    'visibility': makeChildAppender(writeBooleanTextNode)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst PLACEMARK_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'name', 'open', 'visibility', 'address', 'phoneNumber', 'description',\n    'styleUrl', 'Style'\n  ]);\n\n\n/**\n * A factory for creating ExtendedData nodes.\n * @const\n * @type {function(*, Array.<*>): (Node|undefined)}\n */\nconst EXTENDEDDATA_NODE_FACTORY = makeSimpleNodeFactory('ExtendedData');\n\n\n/**\n * FIXME currently we do serialize arbitrary/custom feature properties\n * (ExtendedData).\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Object stack.\n * @this {module:ol/format/KML}\n */\nfunction writePlacemark(node, feature, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n\n  // set id\n  if (feature.getId()) {\n    node.setAttribute('id', feature.getId());\n  }\n\n  // serialize properties (properties unknown to KML are not serialized)\n  const properties = feature.getProperties();\n\n  // don't export these to ExtendedData\n  const filter = {'address': 1, 'description': 1, 'name': 1, 'open': 1,\n    'phoneNumber': 1, 'styleUrl': 1, 'visibility': 1};\n  filter[feature.getGeometryName()] = 1;\n  const keys = Object.keys(properties || {}).sort().filter(function(v) {\n    return !filter[v];\n  });\n\n  if (keys.length > 0) {\n    const sequence = makeSequence(properties, keys);\n    const namesAndValues = {names: keys, values: sequence};\n    pushSerializeAndPop(context, PLACEMARK_SERIALIZERS,\n      EXTENDEDDATA_NODE_FACTORY, [namesAndValues], objectStack);\n  }\n\n  const styleFunction = feature.getStyleFunction();\n  if (styleFunction) {\n    // FIXME the styles returned by the style function are supposed to be\n    // resolution-independent here\n    const styles = styleFunction(feature, 0);\n    if (styles) {\n      const style = Array.isArray(styles) ? styles[0] : styles;\n      if (this.writeStyles_) {\n        properties['Style'] = style;\n      }\n      const textStyle = style.getText();\n      if (textStyle) {\n        properties['name'] = textStyle.getText();\n      }\n    }\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = PLACEMARK_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, PLACEMARK_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n\n  // serialize geometry\n  const options = /** @type {module:ol/format/Feature~WriteOptions} */ (objectStack[0]);\n  let geometry = feature.getGeometry();\n  if (geometry) {\n    geometry = transformWithOptions(geometry, true, options);\n  }\n  pushSerializeAndPop(context, PLACEMARK_SERIALIZERS,\n    GEOMETRY_NODE_FACTORY, [geometry], objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst PRIMITIVE_GEOMETRY_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'extrude', 'tessellate', 'altitudeMode', 'coordinates'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst PRIMITIVE_GEOMETRY_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'extrude': makeChildAppender(writeBooleanTextNode),\n    'tessellate': makeChildAppender(writeBooleanTextNode),\n    'altitudeMode': makeChildAppender(writeStringTextNode),\n    'coordinates': makeChildAppender(writeCoordinatesTextNode)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/SimpleGeometry} geometry Geometry.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writePrimitiveGeometry(node, geometry, objectStack) {\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  context['layout'] = geometry.getLayout();\n  context['stride'] = geometry.getStride();\n\n  // serialize properties (properties unknown to KML are not serialized)\n  const properties = geometry.getProperties();\n  properties.coordinates = flatCoordinates;\n\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = PRIMITIVE_GEOMETRY_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, PRIMITIVE_GEOMETRY_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst POLYGON_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'outerBoundaryIs': makeChildAppender(\n      writeBoundaryIs),\n    'innerBoundaryIs': makeChildAppender(\n      writeBoundaryIs)\n  });\n\n\n/**\n * A factory for creating innerBoundaryIs nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst INNER_BOUNDARY_NODE_FACTORY = makeSimpleNodeFactory('innerBoundaryIs');\n\n\n/**\n * A factory for creating outerBoundaryIs nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst OUTER_BOUNDARY_NODE_FACTORY = makeSimpleNodeFactory('outerBoundaryIs');\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/geom/Polygon} polygon Polygon.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writePolygon(node, polygon, objectStack) {\n  const linearRings = polygon.getLinearRings();\n  const outerRing = linearRings.shift();\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  // inner rings\n  pushSerializeAndPop(context,\n    POLYGON_SERIALIZERS,\n    INNER_BOUNDARY_NODE_FACTORY,\n    linearRings, objectStack);\n  // outer ring\n  pushSerializeAndPop(context,\n    POLYGON_SERIALIZERS,\n    OUTER_BOUNDARY_NODE_FACTORY,\n    [outerRing], objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst POLY_STYLE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'color': makeChildAppender(writeColorTextNode)\n  });\n\n\n/**\n * A factory for creating coordinates nodes.\n * @const\n * @type {function(*, Array.<*>, string=): (Node|undefined)}\n */\nconst COLOR_NODE_FACTORY = makeSimpleNodeFactory('color');\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/style/Fill} style Style.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writePolyStyle(node, style, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  pushSerializeAndPop(context, POLY_STYLE_SERIALIZERS,\n    COLOR_NODE_FACTORY, [style.getColor()], objectStack);\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the scale to.\n * @param {number|undefined} scale Scale.\n */\nfunction writeScaleTextNode(node, scale) {\n  // the Math is to remove any excess decimals created by float arithmetic\n  writeDecimalTextNode(node,\n    Math.round(scale * 1e6) / 1e6);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst STYLE_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'IconStyle', 'LabelStyle', 'LineStyle', 'PolyStyle'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst STYLE_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'IconStyle': makeChildAppender(writeIconStyle),\n    'LabelStyle': makeChildAppender(writeLabelStyle),\n    'LineStyle': makeChildAppender(writeLineStyle),\n    'PolyStyle': makeChildAppender(writePolyStyle)\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/style/Style} style Style.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction writeStyle(node, style, objectStack) {\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: node};\n  const properties = {};\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  const imageStyle = style.getImage();\n  const textStyle = style.getText();\n  if (imageStyle instanceof Icon) {\n    properties['IconStyle'] = imageStyle;\n  }\n  if (textStyle) {\n    properties['LabelStyle'] = textStyle;\n  }\n  if (strokeStyle) {\n    properties['LineStyle'] = strokeStyle;\n  }\n  if (fillStyle) {\n    properties['PolyStyle'] = fillStyle;\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = STYLE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, STYLE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n\n/**\n * @param {Node} node Node to append a TextNode with the Vec2 to.\n * @param {module:ol/format/KML~Vec2} vec2 Vec2.\n */\nfunction writeVec2(node, vec2) {\n  node.setAttribute('x', vec2.x);\n  node.setAttribute('y', vec2.y);\n  node.setAttribute('xunits', vec2.xunits);\n  node.setAttribute('yunits', vec2.yunits);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Array.<string>>}\n */\nconst KML_SEQUENCE = makeStructureNS(\n  NAMESPACE_URIS, [\n    'Document', 'Placemark'\n  ]);\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst KML_SERIALIZERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Document': makeChildAppender(writeDocument),\n    'Placemark': makeChildAppender(writePlacemark)\n  });\n\n\n/**\n * Encode an array of features in the KML format. GeometryCollections, MultiPoints,\n * MultiLineStrings, and MultiPolygons are output as MultiGeometries.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {string} Result.\n * @api\n */\nKML.prototype.writeFeatures;\n\n\n/**\n * Encode an array of features in the KML format as an XML node. GeometryCollections,\n * MultiPoints, MultiLineStrings, and MultiPolygons are output as MultiGeometries.\n *\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Options.\n * @return {Node} Node.\n * @override\n * @api\n */\nKML.prototype.writeFeaturesNode = function(features, opt_options) {\n  opt_options = this.adaptOptions(opt_options);\n  const kml = createElementNS(NAMESPACE_URIS[4], 'kml');\n  const xmlnsUri = 'http://www.w3.org/2000/xmlns/';\n  kml.setAttributeNS(xmlnsUri, 'xmlns:gx', GX_NAMESPACE_URIS[0]);\n  kml.setAttributeNS(xmlnsUri, 'xmlns:xsi', XML_SCHEMA_INSTANCE_URI);\n  kml.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', SCHEMA_LOCATION);\n\n  const /** @type {module:ol/xml~NodeStackItem} */ context = {node: kml};\n  const properties = {};\n  if (features.length > 1) {\n    properties['Document'] = features;\n  } else if (features.length == 1) {\n    properties['Placemark'] = features[0];\n  }\n  const orderedKeys = KML_SEQUENCE[kml.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, KML_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY, values, [opt_options], orderedKeys,\n    this);\n  return kml;\n};\n\nexport default KML;\n","/**\n * @module ol/style/IconOrigin\n */\n\n/**\n * Icon origin. One of 'bottom-left', 'bottom-right', 'top-left', 'top-right'.\n * @enum {string}\n */\nexport default {\n  BOTTOM_LEFT: 'bottom-left',\n  BOTTOM_RIGHT: 'bottom-right',\n  TOP_LEFT: 'top-left',\n  TOP_RIGHT: 'top-right'\n};\n","/**\n * @module ol/style/Icon\n */\nimport {getUid, inherits} from '../util.js';\nimport ImageState from '../ImageState.js';\nimport {assert} from '../asserts.js';\nimport {asArray} from '../color.js';\nimport {listen, unlisten} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport IconAnchorUnits from '../style/IconAnchorUnits.js';\nimport {get as getIconImage} from '../style/IconImage.js';\nimport IconOrigin from '../style/IconOrigin.js';\nimport ImageStyle from '../style/Image.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {Array.<number>} [anchor=[0.5, 0.5]] Anchor. Default value is the icon center.\n * @property {module:ol/style/IconOrigin} [anchorOrigin] Origin of the anchor: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`. Default is `top-left`.\n * @property {module:ol/style/IconAnchorUnits} [anchorXUnits] Units in which the anchor x value is\n * specified. A value of `'fraction'` indicates the x value is a fraction of the icon. A value of `'pixels'` indicates\n * the x value in pixels. Default is `'fraction'`.\n * @property {module:ol/style/IconAnchorUnits} [anchorYUnits] Units in which the anchor y value is\n * specified. A value of `'fraction'` indicates the y value is a fraction of the icon. A value of `'pixels'` indicates\n * the y value in pixels. Default is `'fraction'`.\n * @property {module:ol/color~Color|string} [color] Color to tint the icon. If not specified,\n * the icon will be left as is.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images. Note that you must provide a\n * `crossOrigin` value if you are using the WebGL renderer or if you want to access pixel data with the Canvas renderer.\n * See {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {Image|HTMLCanvasElement} [img] Image object for the icon. If the `src` option is not provided then the\n * provided image must already be loaded. And in that case, it is required\n * to provide the size of the image, with the `imgSize` option.\n * @property {Array.<number>} [offset=[0, 0]] Offset, which, together with the size and the offset origin, define the\n * sub-rectangle to use from the original icon image.\n * @property {module:ol/style/IconOrigin} [offsetOrigin] Origin of the offset: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`. Default is `top-left`.\n * @property {number} [opacity=1] Opacity of the icon.\n * @property {number} [scale=1] Scale.\n * @property {boolean} [snapToPixel=true] If `true` integral numbers of pixels are used as the X and Y pixel coordinate\n * when drawing the icon in the output canvas. If `false` fractional numbers may be used. Using `true` allows for\n * \"sharp\" rendering (no blur), while using `false` allows for \"accurate\" rendering. Note that accuracy is important if\n * the icon's position is animated. Without it, the icon may jitter noticeably.\n * @property {boolean} [rotateWithView=false] Whether to rotate the icon with the view.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {module:ol/size~Size} [size] Icon size in pixel. Can be used together with `offset` to define the\n * sub-rectangle to use from the origin (sprite) icon image.\n * @property {module:ol/size~Size} [imgSize] Image size in pixels. Only required if `img` is set and `src` is not, and\n * for SVG images in Internet Explorer 11. The provided `imgSize` needs to match the actual size of the image.\n * @property {string} [src] Image source URI.\n */\n\n\n/**\n * @classdesc\n * Set icon style for vector features.\n *\n * @constructor\n * @param {module:ol/style/Icon~Options=} opt_options Options.\n * @extends {module:ol/style/Image}\n * @api\n */\nconst Icon = function(opt_options) {\n\n  const options = opt_options || {};\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.anchor_ = options.anchor !== undefined ? options.anchor : [0.5, 0.5];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.normalizedAnchor_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/style/IconOrigin}\n   */\n  this.anchorOrigin_ = options.anchorOrigin !== undefined ?\n    options.anchorOrigin : IconOrigin.TOP_LEFT;\n\n  /**\n   * @private\n   * @type {module:ol/style/IconAnchorUnits}\n   */\n  this.anchorXUnits_ = options.anchorXUnits !== undefined ?\n    options.anchorXUnits : IconAnchorUnits.FRACTION;\n\n  /**\n   * @private\n   * @type {module:ol/style/IconAnchorUnits}\n   */\n  this.anchorYUnits_ = options.anchorYUnits !== undefined ?\n    options.anchorYUnits : IconAnchorUnits.FRACTION;\n\n  /**\n   * @private\n   * @type {?string}\n   */\n  this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n  /**\n   * @type {Image|HTMLCanvasElement}\n   */\n  const image = options.img !== undefined ? options.img : null;\n\n  /**\n   * @type {module:ol/size~Size}\n   */\n  const imgSize = options.imgSize !== undefined ? options.imgSize : null;\n\n  /**\n   * @type {string|undefined}\n   */\n  let src = options.src;\n\n  assert(!(src !== undefined && image),\n    4); // `image` and `src` cannot be provided at the same time\n  assert(!image || (image && imgSize),\n    5); // `imgSize` must be set when `image` is provided\n\n  if ((src === undefined || src.length === 0) && image) {\n    src = image.src || getUid(image).toString();\n  }\n  assert(src !== undefined && src.length > 0,\n    6); // A defined and non-empty `src` or `image` must be provided\n\n  /**\n   * @type {module:ol/ImageState}\n   */\n  const imageState = options.src !== undefined ?\n    ImageState.IDLE : ImageState.LOADED;\n\n  /**\n   * @private\n   * @type {module:ol/color~Color}\n   */\n  this.color_ = options.color !== undefined ? asArray(options.color) : null;\n\n  /**\n   * @private\n   * @type {module:ol/style/IconImage}\n   */\n  this.iconImage_ = getIconImage(\n    image, /** @type {string} */ (src), imgSize, this.crossOrigin_, imageState, this.color_);\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.offset_ = options.offset !== undefined ? options.offset : [0, 0];\n\n  /**\n   * @private\n   * @type {module:ol/style/IconOrigin}\n   */\n  this.offsetOrigin_ = options.offsetOrigin !== undefined ?\n    options.offsetOrigin : IconOrigin.TOP_LEFT;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.origin_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.size_ = options.size !== undefined ? options.size : null;\n\n  /**\n   * @type {number}\n   */\n  const opacity = options.opacity !== undefined ? options.opacity : 1;\n\n  /**\n   * @type {boolean}\n   */\n  const rotateWithView = options.rotateWithView !== undefined ?\n    options.rotateWithView : false;\n\n  /**\n   * @type {number}\n   */\n  const rotation = options.rotation !== undefined ? options.rotation : 0;\n\n  /**\n   * @type {number}\n   */\n  const scale = options.scale !== undefined ? options.scale : 1;\n\n  /**\n   * @type {boolean}\n   */\n  const snapToPixel = options.snapToPixel !== undefined ?\n    options.snapToPixel : true;\n\n  ImageStyle.call(this, {\n    opacity: opacity,\n    rotation: rotation,\n    scale: scale,\n    snapToPixel: snapToPixel,\n    rotateWithView: rotateWithView\n  });\n\n};\n\ninherits(Icon, ImageStyle);\n\n\n/**\n * Clones the style. The underlying Image/HTMLCanvasElement is not cloned.\n * @return {module:ol/style/Icon} The cloned style.\n * @api\n */\nIcon.prototype.clone = function() {\n  return new Icon({\n    anchor: this.anchor_.slice(),\n    anchorOrigin: this.anchorOrigin_,\n    anchorXUnits: this.anchorXUnits_,\n    anchorYUnits: this.anchorYUnits_,\n    crossOrigin: this.crossOrigin_,\n    color: (this.color_ && this.color_.slice) ? this.color_.slice() : this.color_ || undefined,\n    src: this.getSrc(),\n    offset: this.offset_.slice(),\n    offsetOrigin: this.offsetOrigin_,\n    size: this.size_ !== null ? this.size_.slice() : undefined,\n    opacity: this.getOpacity(),\n    scale: this.getScale(),\n    snapToPixel: this.getSnapToPixel(),\n    rotation: this.getRotation(),\n    rotateWithView: this.getRotateWithView()\n  });\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nIcon.prototype.getAnchor = function() {\n  if (this.normalizedAnchor_) {\n    return this.normalizedAnchor_;\n  }\n  let anchor = this.anchor_;\n  const size = this.getSize();\n  if (this.anchorXUnits_ == IconAnchorUnits.FRACTION ||\n      this.anchorYUnits_ == IconAnchorUnits.FRACTION) {\n    if (!size) {\n      return null;\n    }\n    anchor = this.anchor_.slice();\n    if (this.anchorXUnits_ == IconAnchorUnits.FRACTION) {\n      anchor[0] *= size[0];\n    }\n    if (this.anchorYUnits_ == IconAnchorUnits.FRACTION) {\n      anchor[1] *= size[1];\n    }\n  }\n\n  if (this.anchorOrigin_ != IconOrigin.TOP_LEFT) {\n    if (!size) {\n      return null;\n    }\n    if (anchor === this.anchor_) {\n      anchor = this.anchor_.slice();\n    }\n    if (this.anchorOrigin_ == IconOrigin.TOP_RIGHT ||\n        this.anchorOrigin_ == IconOrigin.BOTTOM_RIGHT) {\n      anchor[0] = -anchor[0] + size[0];\n    }\n    if (this.anchorOrigin_ == IconOrigin.BOTTOM_LEFT ||\n        this.anchorOrigin_ == IconOrigin.BOTTOM_RIGHT) {\n      anchor[1] = -anchor[1] + size[1];\n    }\n  }\n  this.normalizedAnchor_ = anchor;\n  return this.normalizedAnchor_;\n};\n\n\n/**\n * Get the icon color.\n * @return {module:ol/color~Color} Color.\n * @api\n */\nIcon.prototype.getColor = function() {\n  return this.color_;\n};\n\n\n/**\n * Get the image icon.\n * @param {number} pixelRatio Pixel ratio.\n * @return {Image|HTMLCanvasElement} Image or Canvas element.\n * @override\n * @api\n */\nIcon.prototype.getImage = function(pixelRatio) {\n  return this.iconImage_.getImage(pixelRatio);\n};\n\n\n/**\n * @override\n */\nIcon.prototype.getImageSize = function() {\n  return this.iconImage_.getSize();\n};\n\n\n/**\n * @override\n */\nIcon.prototype.getHitDetectionImageSize = function() {\n  return this.getImageSize();\n};\n\n\n/**\n * @override\n */\nIcon.prototype.getImageState = function() {\n  return this.iconImage_.getImageState();\n};\n\n\n/**\n * @override\n */\nIcon.prototype.getHitDetectionImage = function(pixelRatio) {\n  return this.iconImage_.getHitDetectionImage(pixelRatio);\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nIcon.prototype.getOrigin = function() {\n  if (this.origin_) {\n    return this.origin_;\n  }\n  let offset = this.offset_;\n\n  if (this.offsetOrigin_ != IconOrigin.TOP_LEFT) {\n    const size = this.getSize();\n    const iconImageSize = this.iconImage_.getSize();\n    if (!size || !iconImageSize) {\n      return null;\n    }\n    offset = offset.slice();\n    if (this.offsetOrigin_ == IconOrigin.TOP_RIGHT ||\n        this.offsetOrigin_ == IconOrigin.BOTTOM_RIGHT) {\n      offset[0] = iconImageSize[0] - size[0] - offset[0];\n    }\n    if (this.offsetOrigin_ == IconOrigin.BOTTOM_LEFT ||\n        this.offsetOrigin_ == IconOrigin.BOTTOM_RIGHT) {\n      offset[1] = iconImageSize[1] - size[1] - offset[1];\n    }\n  }\n  this.origin_ = offset;\n  return this.origin_;\n};\n\n\n/**\n * Get the image URL.\n * @return {string|undefined} Image src.\n * @api\n */\nIcon.prototype.getSrc = function() {\n  return this.iconImage_.getSrc();\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nIcon.prototype.getSize = function() {\n  return !this.size_ ? this.iconImage_.getSize() : this.size_;\n};\n\n\n/**\n * @override\n */\nIcon.prototype.listenImageChange = function(listener, thisArg) {\n  return listen(this.iconImage_, EventType.CHANGE,\n    listener, thisArg);\n};\n\n\n/**\n * Load not yet loaded URI.\n * When rendering a feature with an icon style, the vector renderer will\n * automatically call this method. However, you might want to call this\n * method yourself for preloading or other purposes.\n * @override\n * @api\n */\nIcon.prototype.load = function() {\n  this.iconImage_.load();\n};\n\n\n/**\n * @override\n */\nIcon.prototype.unlistenImageChange = function(listener, thisArg) {\n  unlisten(this.iconImage_, EventType.CHANGE,\n    listener, thisArg);\n};\nexport default Icon;\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","'use strict';\n\nmodule.exports = Pbf;\n\nvar ieee754 = require('ieee754');\n\nfunction Pbf(buf) {\n    this.buf = ArrayBuffer.isView && ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf || 0);\n    this.pos = 0;\n    this.type = 0;\n    this.length = this.buf.length;\n}\n\nPbf.Varint  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nPbf.Fixed64 = 1; // 64-bit: double, fixed64, sfixed64\nPbf.Bytes   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nPbf.Fixed32 = 5; // 32-bit: float, fixed32, sfixed32\n\nvar SHIFT_LEFT_32 = (1 << 16) * (1 << 16),\n    SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\nPbf.prototype = {\n\n    destroy: function() {\n        this.buf = null;\n    },\n\n    // === READING =================================================================\n\n    readFields: function(readField, result, end) {\n        end = end || this.length;\n\n        while (this.pos < end) {\n            var val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    },\n\n    readMessage: function(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    },\n\n    readFixed32: function() {\n        var val = readUInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    readSFixed32: function() {\n        var val = readInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readUInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readSFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readFloat: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 23, 4);\n        this.pos += 4;\n        return val;\n    },\n\n    readDouble: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 52, 8);\n        this.pos += 8;\n        return val;\n    },\n\n    readVarint: function(isSigned) {\n        var buf = this.buf,\n            val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    },\n\n    readVarint64: function() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    },\n\n    readSVarint: function() {\n        var num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    },\n\n    readBoolean: function() {\n        return Boolean(this.readVarint());\n    },\n\n    readString: function() {\n        var end = this.readVarint() + this.pos,\n            str = readUtf8(this.buf, this.pos, end);\n        this.pos = end;\n        return str;\n    },\n\n    readBytes: function() {\n        var end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    },\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    readPackedVarint: function(arr, isSigned) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    },\n    readPackedSVarint: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    },\n    readPackedBoolean: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    },\n    readPackedFloat: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    },\n    readPackedDouble: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    },\n    readPackedFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    },\n    readPackedSFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    },\n    readPackedFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    },\n    readPackedSFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    },\n\n    skip: function(val) {\n        var type = val & 0x7;\n        if (type === Pbf.Varint) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === Pbf.Bytes) this.pos = this.readVarint() + this.pos;\n        else if (type === Pbf.Fixed32) this.pos += 4;\n        else if (type === Pbf.Fixed64) this.pos += 8;\n        else throw new Error('Unimplemented type: ' + type);\n    },\n\n    // === WRITING =================================================================\n\n    writeTag: function(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    },\n\n    realloc: function(min) {\n        var length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            var buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.length = length;\n        }\n    },\n\n    finish: function() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    },\n\n    writeFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeSFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeSFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeVarint: function(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    },\n\n    writeSVarint: function(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    },\n\n    writeBoolean: function(val) {\n        this.writeVarint(Boolean(val));\n    },\n\n    writeString: function(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        var startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeFloat: function(val) {\n        this.realloc(4);\n        ieee754.write(this.buf, val, this.pos, true, 23, 4);\n        this.pos += 4;\n    },\n\n    writeDouble: function(val) {\n        this.realloc(8);\n        ieee754.write(this.buf, val, this.pos, true, 52, 8);\n        this.pos += 8;\n    },\n\n    writeBytes: function(buffer) {\n        var len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (var i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    },\n\n    writeRawMessage: function(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        var startPos = this.pos;\n        fn(obj, this);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeMessage: function(tag, fn, obj) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeRawMessage(fn, obj);\n    },\n\n    writePackedVarint:   function(tag, arr) { this.writeMessage(tag, writePackedVarint, arr);   },\n    writePackedSVarint:  function(tag, arr) { this.writeMessage(tag, writePackedSVarint, arr);  },\n    writePackedBoolean:  function(tag, arr) { this.writeMessage(tag, writePackedBoolean, arr);  },\n    writePackedFloat:    function(tag, arr) { this.writeMessage(tag, writePackedFloat, arr);    },\n    writePackedDouble:   function(tag, arr) { this.writeMessage(tag, writePackedDouble, arr);   },\n    writePackedFixed32:  function(tag, arr) { this.writeMessage(tag, writePackedFixed32, arr);  },\n    writePackedSFixed32: function(tag, arr) { this.writeMessage(tag, writePackedSFixed32, arr); },\n    writePackedFixed64:  function(tag, arr) { this.writeMessage(tag, writePackedFixed64, arr);  },\n    writePackedSFixed64: function(tag, arr) { this.writeMessage(tag, writePackedSFixed64, arr); },\n\n    writeBytesField: function(tag, buffer) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeBytes(buffer);\n    },\n    writeFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFixed32(val);\n    },\n    writeSFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeSFixed32(val);\n    },\n    writeFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeFixed64(val);\n    },\n    writeSFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeSFixed64(val);\n    },\n    writeVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeVarint(val);\n    },\n    writeSVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeSVarint(val);\n    },\n    writeStringField: function(tag, str) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeString(str);\n    },\n    writeFloatField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFloat(val);\n    },\n    writeDoubleField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeDouble(val);\n    },\n    writeBooleanField: function(tag, val) {\n        this.writeVarintField(tag, Boolean(val));\n    }\n};\n\nfunction readVarintRemainder(l, s, p) {\n    var buf = p.buf,\n        h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\nfunction readPackedEnd(pbf) {\n    return pbf.type === Pbf.Bytes ?\n        pbf.readVarint() + pbf.pos : pbf.pos + 1;\n}\n\nfunction toNum(low, high, isSigned) {\n    if (isSigned) {\n        return high * 0x100000000 + (low >>> 0);\n    }\n\n    return ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\nfunction writeBigVarint(val, pbf) {\n    var low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\nfunction writeBigVarintHigh(high, pbf) {\n    var lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    var extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.ceil(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (var i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\nfunction writePackedVarint(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);   }\nfunction writePackedSVarint(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);  }\nfunction writePackedFloat(arr, pbf)    { for (var i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);    }\nfunction writePackedDouble(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);   }\nfunction writePackedBoolean(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);  }\nfunction writePackedFixed32(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);  }\nfunction writePackedSFixed32(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]); }\nfunction writePackedFixed64(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);  }\nfunction writePackedSFixed64(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]); }\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\nfunction readUInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] * 0x1000000);\n}\n\nfunction writeInt32(buf, val, pos) {\n    buf[pos] = val;\n    buf[pos + 1] = (val >>> 8);\n    buf[pos + 2] = (val >>> 16);\n    buf[pos + 3] = (val >>> 24);\n}\n\nfunction readInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] << 24);\n}\n\nfunction readUtf8(buf, pos, end) {\n    var str = '';\n    var i = pos;\n\n    while (i < end) {\n        var b0 = buf[i];\n        var c = null; // codepoint\n        var bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        var b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\nfunction writeUtf8(buf, str, pos) {\n    for (var i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","/**\n * @module ol/render/Feature\n */\nimport {UNDEFINED} from '../functions.js';\nimport {extend} from '../array.js';\nimport {createOrUpdateFromCoordinate, createOrUpdateFromFlatCoordinates, getCenter, getHeight} from '../extent.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport {linearRingss as linearRingssCenter} from '../geom/flat/center.js';\nimport {getInteriorPointOfArray, getInteriorPointsOfMultiArray} from '../geom/flat/interiorpoint.js';\nimport {interpolatePoint} from '../geom/flat/interpolate.js';\nimport {get as getProjection} from '../proj.js';\nimport {transform2D} from '../geom/flat/transform.js';\nimport {create as createTransform, compose as composeTransform} from '../transform.js';\n\n/**\n * Lightweight, read-only, {@link module:ol/Feature~Feature} and {@link module:ol/geom/Geometry~Geometry} like\n * structure, optimized for vector tile rendering and styling. Geometry access\n * through the API is limited to getting the type and extent of the geometry.\n *\n * @constructor\n * @param {module:ol/geom/GeometryType} type Geometry type.\n * @param {Array.<number>} flatCoordinates Flat coordinates. These always need\n *     to be right-handed for polygons.\n * @param {Array.<number>|Array.<Array.<number>>} ends Ends or Endss.\n * @param {Object.<string, *>} properties Properties.\n * @param {number|string|undefined} id Feature id.\n */\nconst RenderFeature = function(type, flatCoordinates, ends, properties, id) {\n  /**\n   * @private\n   * @type {module:ol/extent~Extent|undefined}\n   */\n  this.extent_;\n\n  /**\n   * @private\n   * @type {number|string|undefined}\n   */\n  this.id_ = id;\n\n  /**\n   * @private\n   * @type {module:ol/geom/GeometryType}\n   */\n  this.type_ = type;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.flatCoordinates_ = flatCoordinates;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.flatInteriorPoints_ = null;\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.flatMidpoints_ = null;\n\n  /**\n   * @private\n   * @type {Array.<number>|Array.<Array.<number>>}\n   */\n  this.ends_ = ends;\n\n  /**\n   * @private\n   * @type {Object.<string, *>}\n   */\n  this.properties_ = properties;\n\n};\n\n\n/**\n * @type {module:ol/transform~Transform}\n */\nconst tmpTransform = createTransform();\n\n\n/**\n * Get a feature property by its key.\n * @param {string} key Key\n * @return {*} Value for the requested key.\n * @api\n */\nRenderFeature.prototype.get = function(key) {\n  return this.properties_[key];\n};\n\n\n/**\n * @return {Array.<number>|Array.<Array.<number>>} Ends or endss.\n */\nRenderFeature.prototype.getEnds =\nRenderFeature.prototype.getEndss = function() {\n  return this.ends_;\n};\n\n\n/**\n * Get the extent of this feature's geometry.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nRenderFeature.prototype.getExtent = function() {\n  if (!this.extent_) {\n    this.extent_ = this.type_ === GeometryType.POINT ?\n      createOrUpdateFromCoordinate(this.flatCoordinates_) :\n      createOrUpdateFromFlatCoordinates(\n        this.flatCoordinates_, 0, this.flatCoordinates_.length, 2);\n\n  }\n  return this.extent_;\n};\n\n\n/**\n * @return {Array.<number>} Flat interior points.\n */\nRenderFeature.prototype.getFlatInteriorPoint = function() {\n  if (!this.flatInteriorPoints_) {\n    const flatCenter = getCenter(this.getExtent());\n    this.flatInteriorPoints_ = getInteriorPointOfArray(\n      this.flatCoordinates_, 0, this.ends_, 2, flatCenter, 0);\n  }\n  return this.flatInteriorPoints_;\n};\n\n\n/**\n * @return {Array.<number>} Flat interior points.\n */\nRenderFeature.prototype.getFlatInteriorPoints = function() {\n  if (!this.flatInteriorPoints_) {\n    const flatCenters = linearRingssCenter(\n      this.flatCoordinates_, 0, this.ends_, 2);\n    this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\n      this.flatCoordinates_, 0, this.ends_, 2, flatCenters);\n  }\n  return this.flatInteriorPoints_;\n};\n\n\n/**\n * @return {Array.<number>} Flat midpoint.\n */\nRenderFeature.prototype.getFlatMidpoint = function() {\n  if (!this.flatMidpoints_) {\n    this.flatMidpoints_ = interpolatePoint(\n      this.flatCoordinates_, 0, this.flatCoordinates_.length, 2, 0.5);\n  }\n  return this.flatMidpoints_;\n};\n\n\n/**\n * @return {Array.<number>} Flat midpoints.\n */\nRenderFeature.prototype.getFlatMidpoints = function() {\n  if (!this.flatMidpoints_) {\n    this.flatMidpoints_ = [];\n    const flatCoordinates = this.flatCoordinates_;\n    let offset = 0;\n    const ends = this.ends_;\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      const end = ends[i];\n      const midpoint = interpolatePoint(\n        flatCoordinates, offset, end, 2, 0.5);\n      extend(this.flatMidpoints_, midpoint);\n      offset = end;\n    }\n  }\n  return this.flatMidpoints_;\n};\n\n/**\n * Get the feature identifier.  This is a stable identifier for the feature and\n * is set when reading data from a remote source.\n * @return {number|string|undefined} Id.\n * @api\n */\nRenderFeature.prototype.getId = function() {\n  return this.id_;\n};\n\n\n/**\n * @return {Array.<number>} Flat coordinates.\n */\nRenderFeature.prototype.getOrientedFlatCoordinates = function() {\n  return this.flatCoordinates_;\n};\n\n\n/**\n * @return {Array.<number>} Flat coordinates.\n */\nRenderFeature.prototype.getFlatCoordinates =\n    RenderFeature.prototype.getOrientedFlatCoordinates;\n\n\n/**\n * For API compatibility with {@link module:ol/Feature~Feature}, this method is useful when\n * determining the geometry type in style function (see {@link #getType}).\n * @return {module:ol/render/Feature} Feature.\n * @api\n */\nRenderFeature.prototype.getGeometry = function() {\n  return this;\n};\n\n\n/**\n * Get the feature properties.\n * @return {Object.<string, *>} Feature properties.\n * @api\n */\nRenderFeature.prototype.getProperties = function() {\n  return this.properties_;\n};\n\n\n/**\n * Get the feature for working with its geometry.\n * @return {module:ol/render/Feature} Feature.\n */\nRenderFeature.prototype.getSimplifiedGeometry =\n    RenderFeature.prototype.getGeometry;\n\n\n/**\n * @return {number} Stride.\n */\nRenderFeature.prototype.getStride = function() {\n  return 2;\n};\n\n\n/**\n * @return {undefined}\n */\nRenderFeature.prototype.getStyleFunction = UNDEFINED;\n\n\n/**\n * Get the type of this feature's geometry.\n * @return {module:ol/geom/GeometryType} Geometry type.\n * @api\n */\nRenderFeature.prototype.getType = function() {\n  return this.type_;\n};\n\n/**\n * Transform geometry coordinates from tile pixel space to projected.\n * The SRS of the source and destination are expected to be the same.\n *\n * @param {module:ol/proj~ProjectionLike} source The current projection\n * @param {module:ol/proj~ProjectionLike} destination The desired projection.\n */\nRenderFeature.prototype.transform = function(source, destination) {\n  source = getProjection(source);\n  const pixelExtent = source.getExtent();\n  const projectedExtent = source.getWorldExtent();\n  const scale = getHeight(projectedExtent) / getHeight(pixelExtent);\n  composeTransform(tmpTransform,\n    projectedExtent[0], projectedExtent[3],\n    scale, -scale, 0,\n    0, 0);\n  transform2D(this.flatCoordinates_, 0, this.flatCoordinates_.length, 2,\n    tmpTransform, this.flatCoordinates_);\n};\nexport default RenderFeature;\n","/**\n * @module ol/format/MVT\n */\n//FIXME Implement projection handling\n\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport PBF from 'pbf';\nimport FeatureFormat, {transformWithOptions} from '../format/Feature.js';\nimport FormatType from '../format/FormatType.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {linearRingIsClockwise} from '../geom/flat/orient.js';\nimport Projection from '../proj/Projection.js';\nimport Units from '../proj/Units.js';\nimport RenderFeature from '../render/Feature.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {function((module:ol/geom/Geometry|Object.<string,*>)=)|function(module:ol/geom/GeometryType,Array.<number>,(Array.<number>|Array.<Array.<number>>),Object.<string,*>,number)} [featureClass]\n * Class for features returned by {@link module:ol/format/MVT#readFeatures}. Set to\n * {@link module:ol/Feature~Feature} to get full editing and geometry support at the cost of\n * decreased rendering performance. The default is {@link module:ol/render/Feature~RenderFeature},\n * which is optimized for rendering and hit detection.\n * @property {string} [geometryName='geometry'] Geometry name to use when creating\n * features.\n * @property {string} [layerName='layer'] Name of the feature attribute that\n * holds the layer name.\n * @property {Array.<string>} [layers] Layers to read features from. If not\n * provided, features will be read from all layers.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading data in the Mapbox MVT format.\n *\n * @constructor\n * @extends {module:ol/format/Feature}\n * @param {module:ol/format/MVT~Options=} opt_options Options.\n * @api\n */\nconst MVT = function(opt_options) {\n\n  FeatureFormat.call(this);\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @type {module:ol/proj/Projection}\n   */\n  this.dataProjection = new Projection({\n    code: '',\n    units: Units.TILE_PIXELS\n  });\n\n  /**\n   * @private\n   * @type {function((module:ol/geom/Geometry|Object.<string,*>)=)|\n   *     function(module:ol/geom/GeometryType,Array.<number>,\n   *         (Array.<number>|Array.<Array.<number>>),Object.<string,*>,number)}\n   */\n  this.featureClass_ = options.featureClass ?\n    options.featureClass : RenderFeature;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.geometryName_ = options.geometryName;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.layerName_ = options.layerName ? options.layerName : 'layer';\n\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.layers_ = options.layers ? options.layers : null;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = null;\n\n};\n\ninherits(MVT, FeatureFormat);\n\n\n/**\n * Reader callback for parsing layers.\n * @param {number} tag The tag.\n * @param {Object} layers The layers object.\n * @param {Object} pbf The PBF.\n */\nfunction layersPBFReader(tag, layers, pbf) {\n  if (tag === 3) {\n    const layer = {\n      keys: [],\n      values: [],\n      features: []\n    };\n    const end = pbf.readVarint() + pbf.pos;\n    pbf.readFields(layerPBFReader, layer, end);\n    layer.length = layer.features.length;\n    if (layer.length) {\n      layers[layer.name] = layer;\n    }\n  }\n}\n\n/**\n * Reader callback for parsing layer.\n * @param {number} tag The tag.\n * @param {Object} layer The layer object.\n * @param {Object} pbf The PBF.\n */\nfunction layerPBFReader(tag, layer, pbf) {\n  if (tag === 15) {\n    layer.version = pbf.readVarint();\n  } else if (tag === 1) {\n    layer.name = pbf.readString();\n  } else if (tag === 5) {\n    layer.extent = pbf.readVarint();\n  } else if (tag === 2) {\n    layer.features.push(pbf.pos);\n  } else if (tag === 3) {\n    layer.keys.push(pbf.readString());\n  } else if (tag === 4) {\n    let value = null;\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      tag = pbf.readVarint() >> 3;\n      value = tag === 1 ? pbf.readString() :\n        tag === 2 ? pbf.readFloat() :\n          tag === 3 ? pbf.readDouble() :\n            tag === 4 ? pbf.readVarint64() :\n              tag === 5 ? pbf.readVarint() :\n                tag === 6 ? pbf.readSVarint() :\n                  tag === 7 ? pbf.readBoolean() : null;\n    }\n    layer.values.push(value);\n  }\n}\n\n/**\n * Reader callback for parsing feature.\n * @param {number} tag The tag.\n * @param {Object} feature The feature object.\n * @param {Object} pbf The PBF.\n */\nfunction featurePBFReader(tag, feature, pbf) {\n  if (tag == 1) {\n    feature.id = pbf.readVarint();\n  } else if (tag == 2) {\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      const key = feature.layer.keys[pbf.readVarint()];\n      const value = feature.layer.values[pbf.readVarint()];\n      feature.properties[key] = value;\n    }\n  } else if (tag == 3) {\n    feature.type = pbf.readVarint();\n  } else if (tag == 4) {\n    feature.geometry = pbf.pos;\n  }\n}\n\n\n/**\n * Read a raw feature from the pbf offset stored at index `i` in the raw layer.\n * @suppress {missingProperties}\n * @param {Object} pbf PBF.\n * @param {Object} layer Raw layer.\n * @param {number} i Index of the feature in the raw layer's `features` array.\n * @return {Object} Raw feature.\n */\nfunction readRawFeature(pbf, layer, i) {\n  pbf.pos = layer.features[i];\n  const end = pbf.readVarint() + pbf.pos;\n\n  const feature = {\n    layer: layer,\n    type: 0,\n    properties: {}\n  };\n  pbf.readFields(featurePBFReader, feature, end);\n  return feature;\n}\n\n\n/**\n * Read the raw geometry from the pbf offset stored in a raw feature's geometry\n * property.\n * @suppress {missingProperties}\n * @param {Object} pbf PBF.\n * @param {Object} feature Raw feature.\n * @param {Array.<number>} flatCoordinates Array to store flat coordinates in.\n * @param {Array.<number>} ends Array to store ends in.\n * @private\n */\nMVT.prototype.readRawGeometry_ = function(pbf, feature, flatCoordinates, ends) {\n  pbf.pos = feature.geometry;\n\n  const end = pbf.readVarint() + pbf.pos;\n  let cmd = 1;\n  let length = 0;\n  let x = 0;\n  let y = 0;\n  let coordsLen = 0;\n  let currentEnd = 0;\n\n  while (pbf.pos < end) {\n    if (!length) {\n      const cmdLen = pbf.readVarint();\n      cmd = cmdLen & 0x7;\n      length = cmdLen >> 3;\n    }\n\n    length--;\n\n    if (cmd === 1 || cmd === 2) {\n      x += pbf.readSVarint();\n      y += pbf.readSVarint();\n\n      if (cmd === 1) { // moveTo\n        if (coordsLen > currentEnd) {\n          ends.push(coordsLen);\n          currentEnd = coordsLen;\n        }\n      }\n\n      flatCoordinates.push(x, y);\n      coordsLen += 2;\n\n    } else if (cmd === 7) {\n\n      if (coordsLen > currentEnd) {\n        // close polygon\n        flatCoordinates.push(\n          flatCoordinates[currentEnd], flatCoordinates[currentEnd + 1]);\n        coordsLen += 2;\n      }\n\n    } else {\n      assert(false, 59); // Invalid command found in the PBF\n    }\n  }\n\n  if (coordsLen > currentEnd) {\n    ends.push(coordsLen);\n    currentEnd = coordsLen;\n  }\n\n};\n\n\n/**\n * @suppress {missingProperties}\n * @param {number} type The raw feature's geometry type\n * @param {number} numEnds Number of ends of the flat coordinates of the\n * geometry.\n * @return {module:ol/geom/GeometryType} The geometry type.\n */\nfunction getGeometryType(type, numEnds) {\n  /** @type {module:ol/geom/GeometryType} */\n  let geometryType;\n  if (type === 1) {\n    geometryType = numEnds === 1 ?\n      GeometryType.POINT : GeometryType.MULTI_POINT;\n  } else if (type === 2) {\n    geometryType = numEnds === 1 ?\n      GeometryType.LINE_STRING :\n      GeometryType.MULTI_LINE_STRING;\n  } else if (type === 3) {\n    geometryType = GeometryType.POLYGON;\n    // MultiPolygon not relevant for rendering - winding order determines\n    // outer rings of polygons.\n  }\n  return geometryType;\n}\n\n/**\n * @private\n * @param {Object} pbf PBF\n * @param {Object} rawFeature Raw Mapbox feature.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature|module:ol/render/Feature} Feature.\n */\nMVT.prototype.createFeature_ = function(pbf, rawFeature, opt_options) {\n  const type = rawFeature.type;\n  if (type === 0) {\n    return null;\n  }\n\n  let feature;\n  const id = rawFeature.id;\n  const values = rawFeature.properties;\n  values[this.layerName_] = rawFeature.layer.name;\n\n  const flatCoordinates = [];\n  let ends = [];\n  this.readRawGeometry_(pbf, rawFeature, flatCoordinates, ends);\n\n  const geometryType = getGeometryType(type, ends.length);\n\n  if (this.featureClass_ === RenderFeature) {\n    feature = new this.featureClass_(geometryType, flatCoordinates, ends, values, id);\n  } else {\n    let geom;\n    if (geometryType == GeometryType.POLYGON) {\n      const endss = [];\n      let offset = 0;\n      let prevEndIndex = 0;\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        const end = ends[i];\n        if (!linearRingIsClockwise(flatCoordinates, offset, end, 2)) {\n          endss.push(ends.slice(prevEndIndex, i));\n          prevEndIndex = i;\n        }\n        offset = end;\n      }\n      if (endss.length > 1) {\n        ends = endss;\n        geom = new MultiPolygon(null);\n      } else {\n        geom = new Polygon(null);\n      }\n    } else {\n      geom = geometryType === GeometryType.POINT ? new Point(null) :\n        geometryType === GeometryType.LINE_STRING ? new LineString(null) :\n          geometryType === GeometryType.POLYGON ? new Polygon(null) :\n            geometryType === GeometryType.MULTI_POINT ? new MultiPoint (null) :\n              geometryType === GeometryType.MULTI_LINE_STRING ? new MultiLineString(null) :\n                null;\n    }\n    geom.setFlatCoordinates(GeometryLayout.XY, flatCoordinates, ends);\n    feature = new this.featureClass_();\n    if (this.geometryName_) {\n      feature.setGeometryName(this.geometryName_);\n    }\n    const geometry = transformWithOptions(geom, false, this.adaptOptions(opt_options));\n    feature.setGeometry(geometry);\n    feature.setId(id);\n    feature.setProperties(values);\n  }\n\n  return feature;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMVT.prototype.getLastExtent = function() {\n  return this.extent_;\n};\n\n\n/**\n * @inheritDoc\n */\nMVT.prototype.getType = function() {\n  return FormatType.ARRAY_BUFFER;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMVT.prototype.readFeatures = function(source, opt_options) {\n  const layers = this.layers_;\n\n  const pbf = new PBF(/** @type {ArrayBuffer} */ (source));\n  const pbfLayers = pbf.readFields(layersPBFReader, {});\n  /** @type {Array.<module:ol/Feature|module:ol/render/Feature>} */\n  const features = [];\n  for (const name in pbfLayers) {\n    if (layers && layers.indexOf(name) == -1) {\n      continue;\n    }\n    const pbfLayer = pbfLayers[name];\n\n    for (let i = 0, ii = pbfLayer.length; i < ii; ++i) {\n      const rawFeature = readRawFeature(pbf, pbfLayer, i);\n      features.push(this.createFeature_(pbf, rawFeature));\n    }\n    this.extent_ = pbfLayer ? [0, 0, pbfLayer.extent, pbfLayer.extent] : null;\n  }\n\n  return features;\n};\n\n\n/**\n * @inheritDoc\n * @api\n */\nMVT.prototype.readProjection = function(source) {\n  return this.dataProjection;\n};\n\n\n/**\n * Sets the layers that features will be read from.\n * @param {Array.<string>} layers Layers.\n * @api\n */\nMVT.prototype.setLayers = function(layers) {\n  this.layers_ = layers;\n};\n\n\n/**\n * Not implemented.\n * @override\n */\nMVT.prototype.readFeature = function() {};\n\n\n/**\n * Not implemented.\n * @override\n */\nMVT.prototype.readGeometry = function() {};\n\n\n/**\n * Not implemented.\n * @override\n */\nMVT.prototype.writeFeature = function() {};\n\n\n/**\n * Not implemented.\n * @override\n */\nMVT.prototype.writeGeometry = function() {};\n\n\n/**\n * Not implemented.\n * @override\n */\nMVT.prototype.writeFeatures = function() {};\nexport default MVT;\n","/**\n * @module ol/format/OSMXML\n */\n// FIXME add typedef for stack state objects\nimport {inherits} from '../util.js';\nimport {extend} from '../array.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {isEmpty} from '../obj.js';\nimport {get as getProjection} from '../proj.js';\nimport {pushParseAndPop, makeStructureNS} from '../xml.js';\n\n/**\n * @classdesc\n * Feature format for reading data in the\n * [OSMXML format](http://wiki.openstreetmap.org/wiki/OSM_XML).\n *\n * @constructor\n * @extends {module:ol/format/XMLFeature}\n * @api\n */\nconst OSMXML = function() {\n  XMLFeature.call(this);\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection('EPSG:4326');\n};\n\ninherits(OSMXML, XMLFeature);\n\n\n/**\n * @const\n * @type {Array.<null>}\n */\nconst NAMESPACE_URIS = [null];\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst WAY_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'nd': readNd,\n    'tag': readTag\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'node': readNode,\n    'way': readWay\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst NODE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'tag': readTag\n  });\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction readNode(node, objectStack) {\n  const options = /** @type {module:ol/format/Feature~ReadOptions} */ (objectStack[0]);\n  const state = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const id = node.getAttribute('id');\n  /** @type {module:ol/coordinate~Coordinate} */\n  const coordinates = [\n    parseFloat(node.getAttribute('lon')),\n    parseFloat(node.getAttribute('lat'))\n  ];\n  state.nodes[id] = coordinates;\n\n  const values = pushParseAndPop({\n    tags: {}\n  }, NODE_PARSERS, node, objectStack);\n  if (!isEmpty(values.tags)) {\n    const geometry = new Point(coordinates);\n    transformWithOptions(geometry, false, options);\n    const feature = new Feature(geometry);\n    feature.setId(id);\n    feature.setProperties(values.tags);\n    state.features.push(feature);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction readWay(node, objectStack) {\n  const id = node.getAttribute('id');\n  const values = pushParseAndPop({\n    id: id,\n    ndrefs: [],\n    tags: {}\n  }, WAY_PARSERS, node, objectStack);\n  const state = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  state.ways.push(values);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction readNd(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  values.ndrefs.push(node.getAttribute('ref'));\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction readTag(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  values.tags[node.getAttribute('k')] = node.getAttribute('v');\n}\n\n\n/**\n * Read all features from an OSM source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nOSMXML.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nOSMXML.prototype.readFeaturesFromNode = function(node, opt_options) {\n  const options = this.getReadOptions(node, opt_options);\n  if (node.localName == 'osm') {\n    const state = pushParseAndPop({\n      nodes: {},\n      ways: [],\n      features: []\n    }, PARSERS, node, [options]);\n    // parse nodes in ways\n    for (let j = 0; j < state.ways.length; j++) {\n      const values = /** @type {Object} */ (state.ways[j]);\n      /** @type {Array.<number>} */\n      const flatCoordinates = [];\n      for (let i = 0, ii = values.ndrefs.length; i < ii; i++) {\n        const point = state.nodes[values.ndrefs[i]];\n        extend(flatCoordinates, point);\n      }\n      let geometry;\n      if (values.ndrefs[0] == values.ndrefs[values.ndrefs.length - 1]) {\n        // closed way\n        geometry = new Polygon(null);\n        geometry.setFlatCoordinates(GeometryLayout.XY, flatCoordinates,\n          [flatCoordinates.length]);\n      } else {\n        geometry = new LineString(null);\n        geometry.setFlatCoordinates(GeometryLayout.XY, flatCoordinates);\n      }\n      transformWithOptions(geometry, false, options);\n      const feature = new Feature(geometry);\n      feature.setId(values.id);\n      feature.setProperties(values.tags);\n      state.features.push(feature);\n    }\n    if (state.features) {\n      return state.features;\n    }\n  }\n  return [];\n};\n\n\n/**\n * Read the projection from an OSM source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nOSMXML.prototype.readProjection;\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nOSMXML.prototype.writeFeatureNode = function(feature, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nOSMXML.prototype.writeFeaturesNode = function(features, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nOSMXML.prototype.writeGeometryNode = function(geometry, opt_options) {};\nexport default OSMXML;\n","/**\n * @module ol/geom/flat/flip\n */\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {Array.<number>=} opt_dest Destination.\n * @param {number=} opt_destOffset Destination offset.\n * @return {Array.<number>} Flat coordinates.\n */\nexport function flipXY(flatCoordinates, offset, end, stride, opt_dest, opt_destOffset) {\n  let dest, destOffset;\n  if (opt_dest !== undefined) {\n    dest = opt_dest;\n    destOffset = opt_destOffset !== undefined ? opt_destOffset : 0;\n  } else {\n    dest = [];\n    destOffset = 0;\n  }\n  let j = offset;\n  while (j < end) {\n    const x = flatCoordinates[j++];\n    dest[destOffset++] = flatCoordinates[j++];\n    dest[destOffset++] = x;\n    for (let k = 2; k < stride; ++k) {\n      dest[destOffset++] = flatCoordinates[j++];\n    }\n  }\n  dest.length = destOffset;\n  return dest;\n}\n","/**\n * @module ol/format/Polyline\n */\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport TextFeature from '../format/TextFeature.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport {getStrideForLayout} from '../geom/SimpleGeometry.js';\nimport {flipXY} from '../geom/flat/flip.js';\nimport {inflateCoordinates} from '../geom/flat/inflate.js';\nimport {get as getProjection} from '../proj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [factor=1e5] The factor by which the coordinates values will be scaled.\n * @property {module:ol/geom/GeometryLayout} [geometryLayout='XY'] Layout of the\n * feature geometries created by the format reader.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the Encoded\n * Polyline Algorithm Format.\n *\n * @constructor\n * @extends {module:ol/format/TextFeature}\n * @param {module:ol/format/Polyline~Options=} opt_options Optional configuration object.\n * @api\n */\nconst Polyline = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  TextFeature.call(this);\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection('EPSG:4326');\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.factor_ = options.factor ? options.factor : 1e5;\n\n  /**\n   * @private\n   * @type {module:ol/geom/GeometryLayout}\n   */\n  this.geometryLayout_ = options.geometryLayout ?\n    options.geometryLayout : GeometryLayout.XY;\n};\n\ninherits(Polyline, TextFeature);\n\n\n/**\n * Encode a list of n-dimensional points and return an encoded string\n *\n * Attention: This function will modify the passed array!\n *\n * @param {Array.<number>} numbers A list of n-dimensional points.\n * @param {number} stride The number of dimension of the points in the list.\n * @param {number=} opt_factor The factor by which the numbers will be\n *     multiplied. The remaining decimal places will get rounded away.\n *     Default is `1e5`.\n * @return {string} The encoded string.\n * @api\n */\nexport function encodeDeltas(numbers, stride, opt_factor) {\n  const factor = opt_factor ? opt_factor : 1e5;\n  let d;\n\n  const lastNumbers = new Array(stride);\n  for (d = 0; d < stride; ++d) {\n    lastNumbers[d] = 0;\n  }\n\n  for (let i = 0, ii = numbers.length; i < ii;) {\n    for (d = 0; d < stride; ++d, ++i) {\n      const num = numbers[i];\n      const delta = num - lastNumbers[d];\n      lastNumbers[d] = num;\n\n      numbers[i] = delta;\n    }\n  }\n\n  return encodeFloats(numbers, factor);\n}\n\n\n/**\n * Decode a list of n-dimensional points from an encoded string\n *\n * @param {string} encoded An encoded string.\n * @param {number} stride The number of dimension of the points in the\n *     encoded string.\n * @param {number=} opt_factor The factor by which the resulting numbers will\n *     be divided. Default is `1e5`.\n * @return {Array.<number>} A list of n-dimensional points.\n * @api\n */\nexport function decodeDeltas(encoded, stride, opt_factor) {\n  const factor = opt_factor ? opt_factor : 1e5;\n  let d;\n\n  /** @type {Array.<number>} */\n  const lastNumbers = new Array(stride);\n  for (d = 0; d < stride; ++d) {\n    lastNumbers[d] = 0;\n  }\n\n  const numbers = decodeFloats(encoded, factor);\n\n  for (let i = 0, ii = numbers.length; i < ii;) {\n    for (d = 0; d < stride; ++d, ++i) {\n      lastNumbers[d] += numbers[i];\n\n      numbers[i] = lastNumbers[d];\n    }\n  }\n\n  return numbers;\n}\n\n\n/**\n * Encode a list of floating point numbers and return an encoded string\n *\n * Attention: This function will modify the passed array!\n *\n * @param {Array.<number>} numbers A list of floating point numbers.\n * @param {number=} opt_factor The factor by which the numbers will be\n *     multiplied. The remaining decimal places will get rounded away.\n *     Default is `1e5`.\n * @return {string} The encoded string.\n * @api\n */\nexport function encodeFloats(numbers, opt_factor) {\n  const factor = opt_factor ? opt_factor : 1e5;\n  for (let i = 0, ii = numbers.length; i < ii; ++i) {\n    numbers[i] = Math.round(numbers[i] * factor);\n  }\n\n  return encodeSignedIntegers(numbers);\n}\n\n\n/**\n * Decode a list of floating point numbers from an encoded string\n *\n * @param {string} encoded An encoded string.\n * @param {number=} opt_factor The factor by which the result will be divided.\n *     Default is `1e5`.\n * @return {Array.<number>} A list of floating point numbers.\n * @api\n */\nexport function decodeFloats(encoded, opt_factor) {\n  const factor = opt_factor ? opt_factor : 1e5;\n  const numbers = decodeSignedIntegers(encoded);\n  for (let i = 0, ii = numbers.length; i < ii; ++i) {\n    numbers[i] /= factor;\n  }\n  return numbers;\n}\n\n\n/**\n * Encode a list of signed integers and return an encoded string\n *\n * Attention: This function will modify the passed array!\n *\n * @param {Array.<number>} numbers A list of signed integers.\n * @return {string} The encoded string.\n */\nexport function encodeSignedIntegers(numbers) {\n  for (let i = 0, ii = numbers.length; i < ii; ++i) {\n    const num = numbers[i];\n    numbers[i] = (num < 0) ? ~(num << 1) : (num << 1);\n  }\n  return encodeUnsignedIntegers(numbers);\n}\n\n\n/**\n * Decode a list of signed integers from an encoded string\n *\n * @param {string} encoded An encoded string.\n * @return {Array.<number>} A list of signed integers.\n */\nexport function decodeSignedIntegers(encoded) {\n  const numbers = decodeUnsignedIntegers(encoded);\n  for (let i = 0, ii = numbers.length; i < ii; ++i) {\n    const num = numbers[i];\n    numbers[i] = (num & 1) ? ~(num >> 1) : (num >> 1);\n  }\n  return numbers;\n}\n\n\n/**\n * Encode a list of unsigned integers and return an encoded string\n *\n * @param {Array.<number>} numbers A list of unsigned integers.\n * @return {string} The encoded string.\n */\nexport function encodeUnsignedIntegers(numbers) {\n  let encoded = '';\n  for (let i = 0, ii = numbers.length; i < ii; ++i) {\n    encoded += encodeUnsignedInteger(numbers[i]);\n  }\n  return encoded;\n}\n\n\n/**\n * Decode a list of unsigned integers from an encoded string\n *\n * @param {string} encoded An encoded string.\n * @return {Array.<number>} A list of unsigned integers.\n */\nexport function decodeUnsignedIntegers(encoded) {\n  const numbers = [];\n  let current = 0;\n  let shift = 0;\n  for (let i = 0, ii = encoded.length; i < ii; ++i) {\n    const b = encoded.charCodeAt(i) - 63;\n    current |= (b & 0x1f) << shift;\n    if (b < 0x20) {\n      numbers.push(current);\n      current = 0;\n      shift = 0;\n    } else {\n      shift += 5;\n    }\n  }\n  return numbers;\n}\n\n\n/**\n * Encode one single unsigned integer and return an encoded string\n *\n * @param {number} num Unsigned integer that should be encoded.\n * @return {string} The encoded string.\n */\nexport function encodeUnsignedInteger(num) {\n  let value, encoded = '';\n  while (num >= 0x20) {\n    value = (0x20 | (num & 0x1f)) + 63;\n    encoded += String.fromCharCode(value);\n    num >>= 5;\n  }\n  value = num + 63;\n  encoded += String.fromCharCode(value);\n  return encoded;\n}\n\n\n/**\n * Read the feature from the Polyline source. The coordinates are assumed to be\n * in two dimensions and in latitude, longitude order.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nPolyline.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.readFeatureFromText = function(text, opt_options) {\n  const geometry = this.readGeometryFromText(text, opt_options);\n  return new Feature(geometry);\n};\n\n\n/**\n * Read the feature from the source. As Polyline sources contain a single\n * feature, this will return the feature in an array.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nPolyline.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.readFeaturesFromText = function(text, opt_options) {\n  const feature = this.readFeatureFromText(text, opt_options);\n  return [feature];\n};\n\n\n/**\n * Read the geometry from the source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n * @api\n */\nPolyline.prototype.readGeometry;\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.readGeometryFromText = function(text, opt_options) {\n  const stride = getStrideForLayout(this.geometryLayout_);\n  const flatCoordinates = decodeDeltas(text, stride, this.factor_);\n  flipXY(flatCoordinates, 0, flatCoordinates.length, stride, flatCoordinates);\n  const coordinates = inflateCoordinates(flatCoordinates, 0, flatCoordinates.length, stride);\n\n  return (\n    /** @type {module:ol/geom/Geometry} */ (transformWithOptions(\n      new LineString(coordinates, this.geometryLayout_),\n      false,\n      this.adaptOptions(opt_options)\n    ))\n  );\n};\n\n\n/**\n * Read the projection from a Polyline source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/proj/Projection} Projection.\n * @api\n */\nPolyline.prototype.readProjection;\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.writeFeatureText = function(feature, opt_options) {\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    return this.writeGeometryText(geometry, opt_options);\n  } else {\n    assert(false, 40); // Expected `feature` to have a geometry\n    return '';\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.writeFeaturesText = function(features, opt_options) {\n  return this.writeFeatureText(features[0], opt_options);\n};\n\n\n/**\n * Write a single geometry in Polyline format.\n *\n * @function\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} Geometry.\n * @api\n */\nPolyline.prototype.writeGeometry;\n\n\n/**\n * @inheritDoc\n */\nPolyline.prototype.writeGeometryText = function(geometry, opt_options) {\n  geometry = /** @type {module:ol/geom/LineString} */\n    (transformWithOptions(geometry, true, this.adaptOptions(opt_options)));\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  flipXY(flatCoordinates, 0, flatCoordinates.length, stride, flatCoordinates);\n  return encodeDeltas(flatCoordinates, stride, this.factor_);\n};\nexport default Polyline;\n","/**\n * @module ol/format/TopoJSON\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport JSONFeature from '../format/JSONFeature.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {get as getProjection} from '../proj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/proj~ProjectionLike} [dataProjection='EPSG:4326'] Default data projection.\n * @property {string} [layerName] Set the name of the TopoJSON topology\n * `objects`'s children as feature property with the specified name. This means\n * that when set to `'layer'`, a topology like\n * ```\n * {\n *   \"type\": \"Topology\",\n *   \"objects\": {\n *     \"example\": {\n *       \"type\": \"GeometryCollection\",\n *       \"geometries\": []\n *     }\n *   }\n * }\n * ```\n * will result in features that have a property `'layer'` set to `'example'`.\n * When not set, no property will be added to features.\n * @property {Array.<string>} [layers] Names of the TopoJSON topology's\n * `objects`'s children to read features from.  If not provided, features will\n * be read from all children.\n */\n\n\n/**\n * @classdesc\n * Feature format for reading data in the TopoJSON format.\n *\n * @constructor\n * @extends {module:ol/format/JSONFeature}\n * @param {module:ol/format/TopoJSON~Options=} opt_options Options.\n * @api\n */\nconst TopoJSON = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  JSONFeature.call(this);\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.layerName_ = options.layerName;\n\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.layers_ = options.layers ? options.layers : null;\n\n  /**\n   * @inheritDoc\n   */\n  this.dataProjection = getProjection(\n    options.dataProjection ?\n      options.dataProjection : 'EPSG:4326');\n\n};\n\ninherits(TopoJSON, JSONFeature);\n\n\n/**\n * @const\n * @type {Object.<string, function(TopoJSONGeometry, Array, ...Array): module:ol/geom/Geometry>}\n */\nconst GEOMETRY_READERS = {\n  'Point': readPointGeometry,\n  'LineString': readLineStringGeometry,\n  'Polygon': readPolygonGeometry,\n  'MultiPoint': readMultiPointGeometry,\n  'MultiLineString': readMultiLineStringGeometry,\n  'MultiPolygon': readMultiPolygonGeometry\n};\n\n\n/**\n * Concatenate arcs into a coordinate array.\n * @param {Array.<number>} indices Indices of arcs to concatenate.  Negative\n *     values indicate arcs need to be reversed.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs (already\n *     transformed).\n * @return {Array.<module:ol/coordinate~Coordinate>} Coordinates array.\n */\nfunction concatenateArcs(indices, arcs) {\n  /** @type {Array.<module:ol/coordinate~Coordinate>} */\n  const coordinates = [];\n  let index, arc;\n  for (let i = 0, ii = indices.length; i < ii; ++i) {\n    index = indices[i];\n    if (i > 0) {\n      // splicing together arcs, discard last point\n      coordinates.pop();\n    }\n    if (index >= 0) {\n      // forward arc\n      arc = arcs[index];\n    } else {\n      // reverse arc\n      arc = arcs[~index].slice().reverse();\n    }\n    coordinates.push.apply(coordinates, arc);\n  }\n  // provide fresh copies of coordinate arrays\n  for (let j = 0, jj = coordinates.length; j < jj; ++j) {\n    coordinates[j] = coordinates[j].slice();\n  }\n  return coordinates;\n}\n\n\n/**\n * Create a point from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n * @return {module:ol/geom/Point} Geometry.\n */\nfunction readPointGeometry(object, scale, translate) {\n  const coordinates = object.coordinates;\n  if (scale && translate) {\n    transformVertex(coordinates, scale, translate);\n  }\n  return new Point(coordinates);\n}\n\n\n/**\n * Create a multi-point from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n * @return {module:ol/geom/MultiPoint} Geometry.\n */\nfunction readMultiPointGeometry(object, scale, translate) {\n  const coordinates = object.coordinates;\n  if (scale && translate) {\n    for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n      transformVertex(coordinates[i], scale, translate);\n    }\n  }\n  return new MultiPoint(coordinates);\n}\n\n\n/**\n * Create a linestring from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @return {module:ol/geom/LineString} Geometry.\n */\nfunction readLineStringGeometry(object, arcs) {\n  const coordinates = concatenateArcs(object.arcs, arcs);\n  return new LineString(coordinates);\n}\n\n\n/**\n * Create a multi-linestring from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @return {module:ol/geom/MultiLineString} Geometry.\n */\nfunction readMultiLineStringGeometry(object, arcs) {\n  const coordinates = [];\n  for (let i = 0, ii = object.arcs.length; i < ii; ++i) {\n    coordinates[i] = concatenateArcs(object.arcs[i], arcs);\n  }\n  return new MultiLineString(coordinates);\n}\n\n\n/**\n * Create a polygon from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @return {module:ol/geom/Polygon} Geometry.\n */\nfunction readPolygonGeometry(object, arcs) {\n  const coordinates = [];\n  for (let i = 0, ii = object.arcs.length; i < ii; ++i) {\n    coordinates[i] = concatenateArcs(object.arcs[i], arcs);\n  }\n  return new Polygon(coordinates);\n}\n\n\n/**\n * Create a multi-polygon from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @return {module:ol/geom/MultiPolygon} Geometry.\n */\nfunction readMultiPolygonGeometry(object, arcs) {\n  const coordinates = [];\n  for (let i = 0, ii = object.arcs.length; i < ii; ++i) {\n    // for each polygon\n    const polyArray = object.arcs[i];\n    const ringCoords = [];\n    for (let j = 0, jj = polyArray.length; j < jj; ++j) {\n      // for each ring\n      ringCoords[j] = concatenateArcs(polyArray[j], arcs);\n    }\n    coordinates[i] = ringCoords;\n  }\n  return new MultiPolygon(coordinates);\n}\n\n\n/**\n * Create features from a TopoJSON GeometryCollection object.\n *\n * @param {TopoJSONGeometryCollection} collection TopoJSON Geometry\n *     object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n * @param {string|undefined} property Property to set the `GeometryCollection`'s parent\n *     object to.\n * @param {string} name Name of the `Topology`'s child object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Array of features.\n */\nfunction readFeaturesFromGeometryCollection(collection, arcs, scale, translate, property, name, opt_options) {\n  const geometries = collection.geometries;\n  const features = [];\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    features[i] = readFeatureFromGeometry(\n      geometries[i], arcs, scale, translate, property, name, opt_options);\n  }\n  return features;\n}\n\n\n/**\n * Create a feature from a TopoJSON geometry object.\n *\n * @param {TopoJSONGeometry} object TopoJSON geometry object.\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n * @param {string|undefined} property Property to set the `GeometryCollection`'s parent\n *     object to.\n * @param {string} name Name of the `Topology`'s child object.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n */\nfunction readFeatureFromGeometry(object, arcs, scale, translate, property, name, opt_options) {\n  let geometry;\n  const type = object.type;\n  const geometryReader = GEOMETRY_READERS[type];\n  if ((type === 'Point') || (type === 'MultiPoint')) {\n    geometry = geometryReader(object, scale, translate);\n  } else {\n    geometry = geometryReader(object, arcs);\n  }\n  const feature = new Feature();\n  feature.setGeometry(/** @type {module:ol/geom/Geometry} */ (\n    transformWithOptions(geometry, false, opt_options)));\n  if (object.id !== undefined) {\n    feature.setId(object.id);\n  }\n  let properties = object.properties;\n  if (property) {\n    if (!properties) {\n      properties = {};\n    }\n    properties[property] = name;\n  }\n  if (properties) {\n    feature.setProperties(properties);\n  }\n  return feature;\n}\n\n\n/**\n * Read all features from a TopoJSON source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nTopoJSON.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nTopoJSON.prototype.readFeaturesFromObject = function(object, opt_options) {\n  if (object.type == 'Topology') {\n    const topoJSONTopology = /** @type {TopoJSONTopology} */ (object);\n    let transform, scale = null, translate = null;\n    if (topoJSONTopology.transform) {\n      transform = topoJSONTopology.transform;\n      scale = transform.scale;\n      translate = transform.translate;\n    }\n    const arcs = topoJSONTopology.arcs;\n    if (transform) {\n      transformArcs(arcs, scale, translate);\n    }\n    /** @type {Array.<module:ol/Feature>} */\n    const features = [];\n    const topoJSONFeatures = topoJSONTopology.objects;\n    const property = this.layerName_;\n    let feature;\n    for (const objectName in topoJSONFeatures) {\n      if (this.layers_ && this.layers_.indexOf(objectName) == -1) {\n        continue;\n      }\n      if (topoJSONFeatures[objectName].type === 'GeometryCollection') {\n        feature = /** @type {TopoJSONGeometryCollection} */ (topoJSONFeatures[objectName]);\n        features.push.apply(features, readFeaturesFromGeometryCollection(\n          feature, arcs, scale, translate, property, objectName, opt_options));\n      } else {\n        feature = /** @type {TopoJSONGeometry} */ (topoJSONFeatures[objectName]);\n        features.push(readFeatureFromGeometry(\n          feature, arcs, scale, translate, property, objectName, opt_options));\n      }\n    }\n    return features;\n  } else {\n    return [];\n  }\n};\n\n\n/**\n * Apply a linear transform to array of arcs.  The provided array of arcs is\n * modified in place.\n *\n * @param {Array.<Array.<module:ol/coordinate~Coordinate>>} arcs Array of arcs.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n */\nfunction transformArcs(arcs, scale, translate) {\n  for (let i = 0, ii = arcs.length; i < ii; ++i) {\n    transformArc(arcs[i], scale, translate);\n  }\n}\n\n\n/**\n * Apply a linear transform to an arc.  The provided arc is modified in place.\n *\n * @param {Array.<module:ol/coordinate~Coordinate>} arc Arc.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n */\nfunction transformArc(arc, scale, translate) {\n  let x = 0;\n  let y = 0;\n  for (let i = 0, ii = arc.length; i < ii; ++i) {\n    const vertex = arc[i];\n    x += vertex[0];\n    y += vertex[1];\n    vertex[0] = x;\n    vertex[1] = y;\n    transformVertex(vertex, scale, translate);\n  }\n}\n\n\n/**\n * Apply a linear transform to a vertex.  The provided vertex is modified in\n * place.\n *\n * @param {module:ol/coordinate~Coordinate} vertex Vertex.\n * @param {Array.<number>} scale Scale for each dimension.\n * @param {Array.<number>} translate Translation for each dimension.\n */\nfunction transformVertex(vertex, scale, translate) {\n  vertex[0] = vertex[0] * scale[0] + translate[0];\n  vertex[1] = vertex[1] * scale[1] + translate[1];\n}\n\n\n/**\n * Read the projection from a TopoJSON source.\n *\n * @param {Document|Node|Object|string} object Source.\n * @return {module:ol/proj/Projection} Projection.\n * @override\n * @api\n */\nTopoJSON.prototype.readProjection;\n\n\n/**\n * @inheritDoc\n */\nTopoJSON.prototype.readProjectionFromObject = function(object) {\n  return this.dataProjection;\n};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nTopoJSON.prototype.writeFeatureObject = function(feature, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nTopoJSON.prototype.writeFeaturesObject = function(features, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nTopoJSON.prototype.writeGeometryObject = function(geometry, opt_options) {};\n\n\n/**\n * Not implemented.\n * @override\n */\nTopoJSON.prototype.readGeometryFromObject = function() {};\n\n\n/**\n * Not implemented.\n * @override\n */\nTopoJSON.prototype.readFeatureFromObject = function() {};\nexport default TopoJSON;\n","/**\n * @module ol/format/filter/Filter\n */\n\n\n/**\n * @classdesc\n * Abstract class; normally only used for creating subclasses and not instantiated in apps.\n * Base class for WFS GetFeature filters.\n *\n * @constructor\n * @abstract\n * @param {!string} tagName The XML tag name for this filter.\n * @struct\n */\nconst Filter = function(tagName) {\n\n  /**\n   * @private\n   * @type {!string}\n   */\n  this.tagName_ = tagName;\n};\n\n/**\n * The XML tag name for a filter.\n * @returns {!string} Name.\n */\nFilter.prototype.getTagName = function() {\n  return this.tagName_;\n};\n\nexport default Filter;\n","/**\n * @module ol/format/filter/LogicalNary\n */\nimport {inherits} from '../../util.js';\nimport {assert} from '../../asserts.js';\nimport Filter from '../filter/Filter.js';\n\n/**\n * @classdesc\n * Abstract class; normally only used for creating subclasses and not instantiated in apps.\n * Base class for WFS GetFeature n-ary logical filters.\n *\n * @constructor\n * @abstract\n * @param {!string} tagName The XML tag name for this filter.\n * @param {...module:ol/format/filter/Filter} conditions Conditions.\n * @extends {module:ol/format/filter/Filter}\n */\nconst LogicalNary = function(tagName, conditions) {\n\n  Filter.call(this, tagName);\n\n  /**\n   * @type {Array.<module:ol/format/filter/Filter>}\n   */\n  this.conditions = Array.prototype.slice.call(arguments, 1);\n  assert(this.conditions.length >= 2, 57); // At least 2 conditions are required.\n};\n\ninherits(LogicalNary, Filter);\nexport default LogicalNary;\n","/**\n * @module ol/format/filter/And\n */\nimport {inherits} from '../../util.js';\nimport LogicalNary from '../filter/LogicalNary.js';\n\n/**\n * @classdesc\n * Represents a logical `<And>` operator between two or more filter conditions.\n *\n * @constructor\n * @abstract\n * @param {...module:ol/format/filter/Filter} conditions Conditions.\n * @extends {module:ol/format/filter/LogicalNary}\n */\nconst And = function(conditions) {\n  const params = ['And'].concat(Array.prototype.slice.call(arguments));\n  LogicalNary.apply(this, params);\n};\n\ninherits(And, LogicalNary);\n\nexport default And;\n","/**\n * @module ol/format/filter/Bbox\n */\nimport {inherits} from '../../util.js';\nimport Filter from '../filter/Filter.js';\n\n/**\n * @classdesc\n * Represents a `<BBOX>` operator to test whether a geometry-valued property\n * intersects a fixed bounding box\n *\n * @constructor\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/extent~Extent} extent Extent.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @extends {module:ol/format/filter/Filter}\n * @api\n */\nconst Bbox = function(geometryName, extent, opt_srsName) {\n\n  Filter.call(this, 'BBOX');\n\n  /**\n   * @type {!string}\n   */\n  this.geometryName = geometryName;\n\n  /**\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent = extent;\n\n  /**\n   * @type {string|undefined}\n   */\n  this.srsName = opt_srsName;\n};\n\ninherits(Bbox, Filter);\n\nexport default Bbox;\n","/**\n * @module ol/format/filter/Spatial\n */\nimport {inherits} from '../../util.js';\nimport Filter from '../filter/Filter.js';\n\n/**\n * @classdesc\n * Abstract class; normally only used for creating subclasses and not instantiated in apps.\n * Represents a spatial operator to test whether a geometry-valued property\n * relates to a given geometry.\n *\n * @constructor\n * @abstract\n * @param {!string} tagName The XML tag name for this filter.\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @extends {module:ol/format/filter/Filter}\n */\nconst Spatial = function(tagName, geometryName, geometry, opt_srsName) {\n\n  Filter.call(this, tagName);\n\n  /**\n   * @type {!string}\n   */\n  this.geometryName = geometryName || 'the_geom';\n\n  /**\n   * @type {module:ol/geom/Geometry}\n   */\n  this.geometry = geometry;\n\n  /**\n   * @type {string|undefined}\n   */\n  this.srsName = opt_srsName;\n};\n\ninherits(Spatial, Filter);\n\nexport default Spatial;\n","/**\n * @module ol/format/filter/Contains\n */\nimport {inherits} from '../../util.js';\nimport Spatial from '../filter/Spatial.js';\n\n/**\n * @classdesc\n * Represents a `<Contains>` operator to test whether a geometry-valued property\n * contains a given geometry.\n *\n * @constructor\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @extends {module:ol/format/filter/Spatial}\n * @api\n */\nconst Contains = function(geometryName, geometry, opt_srsName) {\n\n  Spatial.call(this, 'Contains', geometryName, geometry, opt_srsName);\n\n};\n\ninherits(Contains, Spatial);\nexport default Contains;\n","/**\n * @module ol/format/filter/Comparison\n */\nimport {inherits} from '../../util.js';\nimport Filter from '../filter/Filter.js';\n\n/**\n * @classdesc\n * Abstract class; normally only used for creating subclasses and not instantiated in apps.\n * Base class for WFS GetFeature property comparison filters.\n *\n * @constructor\n * @abstract\n * @param {!string} tagName The XML tag name for this filter.\n * @param {!string} propertyName Name of the context property to compare.\n * @extends {module:ol/format/filter/Filter}\n */\nconst Comparison = function(tagName, propertyName) {\n\n  Filter.call(this, tagName);\n\n  /**\n   * @type {!string}\n   */\n  this.propertyName = propertyName;\n};\n\ninherits(Comparison, Filter);\n\nexport default Comparison;\n","/**\n * @module ol/format/filter/During\n */\nimport {inherits} from '../../util.js';\nimport Comparison from '../filter/Comparison.js';\n\n/**\n * @classdesc\n * Represents a `<During>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!string} begin The begin date in ISO-8601 format.\n * @param {!string} end The end date in ISO-8601 format.\n * @extends {module:ol/format/filter/Comparison}\n * @api\n */\nconst During = function(propertyName, begin, end) {\n  Comparison.call(this, 'During', propertyName);\n\n  /**\n   * @type {!string}\n   */\n  this.begin = begin;\n\n  /**\n   * @type {!string}\n   */\n  this.end = end;\n};\n\ninherits(During, Comparison);\nexport default During;\n","/**\n * @module ol/format/filter/ComparisonBinary\n */\nimport {inherits} from '../../util.js';\nimport Comparison from '../filter/Comparison.js';\n\n/**\n * @classdesc\n * Abstract class; normally only used for creating subclasses and not instantiated in apps.\n * Base class for WFS GetFeature property binary comparison filters.\n *\n * @constructor\n * @abstract\n * @param {!string} tagName The XML tag name for this filter.\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!(string|number)} expression The value to compare.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @extends {module:ol/format/filter/Comparison}\n */\nconst ComparisonBinary = function(tagName, propertyName, expression, opt_matchCase) {\n\n  Comparison.call(this, tagName, propertyName);\n\n  /**\n   * @type {!(string|number)}\n   */\n  this.expression = expression;\n\n  /**\n   * @type {boolean|undefined}\n   */\n  this.matchCase = opt_matchCase;\n};\n\ninherits(ComparisonBinary, Comparison);\nexport default ComparisonBinary;\n","/**\n * @module ol/format/filter/EqualTo\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsEqualTo>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!(string|number)} expression The value to compare.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst EqualTo = function(propertyName, expression, opt_matchCase) {\n  ComparisonBinary.call(this, 'PropertyIsEqualTo', propertyName, expression, opt_matchCase);\n};\n\ninherits(EqualTo, ComparisonBinary);\nexport default EqualTo;\n","/**\n * @module ol/format/filter/GreaterThan\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsGreaterThan>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst GreaterThan = function(propertyName, expression) {\n  ComparisonBinary.call(this, 'PropertyIsGreaterThan', propertyName, expression);\n};\n\ninherits(GreaterThan, ComparisonBinary);\nexport default GreaterThan;\n","/**\n * @module ol/format/filter/GreaterThanOrEqualTo\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsGreaterThanOrEqualTo>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst GreaterThanOrEqualTo = function(propertyName, expression) {\n  ComparisonBinary.call(this, 'PropertyIsGreaterThanOrEqualTo', propertyName, expression);\n};\n\ninherits(GreaterThanOrEqualTo, ComparisonBinary);\nexport default GreaterThanOrEqualTo;\n","/**\n * @module ol/format/filter/Intersects\n */\nimport {inherits} from '../../util.js';\nimport Spatial from '../filter/Spatial.js';\n\n/**\n * @classdesc\n * Represents a `<Intersects>` operator to test whether a geometry-valued property\n * intersects a given geometry.\n *\n * @constructor\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @extends {module:ol/format/filter/Spatial}\n * @api\n */\nconst Intersects = function(geometryName, geometry, opt_srsName) {\n\n  Spatial.call(this, 'Intersects', geometryName, geometry, opt_srsName);\n\n};\n\ninherits(Intersects, Spatial);\nexport default Intersects;\n","/**\n * @module ol/format/filter/IsBetween\n */\nimport {inherits} from '../../util.js';\nimport Comparison from '../filter/Comparison.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsBetween>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} lowerBoundary The lower bound of the range.\n * @param {!number} upperBoundary The upper bound of the range.\n * @extends {module:ol/format/filter/Comparison}\n * @api\n */\nconst IsBetween = function(propertyName, lowerBoundary, upperBoundary) {\n  Comparison.call(this, 'PropertyIsBetween', propertyName);\n\n  /**\n   * @type {!number}\n   */\n  this.lowerBoundary = lowerBoundary;\n\n  /**\n   * @type {!number}\n   */\n  this.upperBoundary = upperBoundary;\n};\n\ninherits(IsBetween, Comparison);\nexport default IsBetween;\n","/**\n * @module ol/format/filter/IsLike\n */\nimport {inherits} from '../../util.js';\nimport Comparison from '../filter/Comparison.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsLike>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!string} pattern Text pattern.\n * @param {string=} opt_wildCard Pattern character which matches any sequence of\n *    zero or more string characters. Default is '*'.\n * @param {string=} opt_singleChar pattern character which matches any single\n *    string character. Default is '.'.\n * @param {string=} opt_escapeChar Escape character which can be used to escape\n *    the pattern characters. Default is '!'.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @extends {module:ol/format/filter/Comparison}\n * @api\n */\nconst IsLike = function(propertyName, pattern, opt_wildCard, opt_singleChar, opt_escapeChar, opt_matchCase) {\n  Comparison.call(this, 'PropertyIsLike', propertyName);\n\n  /**\n   * @type {!string}\n   */\n  this.pattern = pattern;\n\n  /**\n   * @type {!string}\n   */\n  this.wildCard = (opt_wildCard !== undefined) ? opt_wildCard : '*';\n\n  /**\n   * @type {!string}\n   */\n  this.singleChar = (opt_singleChar !== undefined) ? opt_singleChar : '.';\n\n  /**\n   * @type {!string}\n   */\n  this.escapeChar = (opt_escapeChar !== undefined) ? opt_escapeChar : '!';\n\n  /**\n   * @type {boolean|undefined}\n   */\n  this.matchCase = opt_matchCase;\n};\n\ninherits(IsLike, Comparison);\nexport default IsLike;\n","/**\n * @module ol/format/filter/IsNull\n */\nimport {inherits} from '../../util.js';\nimport Comparison from '../filter/Comparison.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsNull>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @extends {module:ol/format/filter/Comparison}\n * @api\n */\nconst IsNull = function(propertyName) {\n  Comparison.call(this, 'PropertyIsNull', propertyName);\n};\n\ninherits(IsNull, Comparison);\nexport default IsNull;\n","/**\n * @module ol/format/filter/LessThan\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsLessThan>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst LessThan = function(propertyName, expression) {\n  ComparisonBinary.call(this, 'PropertyIsLessThan', propertyName, expression);\n};\n\ninherits(LessThan, ComparisonBinary);\nexport default LessThan;\n","/**\n * @module ol/format/filter/LessThanOrEqualTo\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsLessThanOrEqualTo>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst LessThanOrEqualTo = function(propertyName, expression) {\n  ComparisonBinary.call(this, 'PropertyIsLessThanOrEqualTo', propertyName, expression);\n};\n\ninherits(LessThanOrEqualTo, ComparisonBinary);\nexport default LessThanOrEqualTo;\n","/**\n * @module ol/format/filter/Not\n */\nimport {inherits} from '../../util.js';\nimport Filter from '../filter/Filter.js';\n\n/**\n * @classdesc\n * Represents a logical `<Not>` operator for a filter condition.\n *\n * @constructor\n * @param {!module:ol/format/filter/Filter} condition Filter condition.\n * @extends {module:ol/format/filter/Filter}\n * @api\n */\nconst Not = function(condition) {\n\n  Filter.call(this, 'Not');\n\n  /**\n   * @type {!module:ol/format/filter/Filter}\n   */\n  this.condition = condition;\n};\n\ninherits(Not, Filter);\nexport default Not;\n","/**\n * @module ol/format/filter/NotEqualTo\n */\nimport {inherits} from '../../util.js';\nimport ComparisonBinary from '../filter/ComparisonBinary.js';\n\n/**\n * @classdesc\n * Represents a `<PropertyIsNotEqualTo>` comparison operator.\n *\n * @constructor\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!(string|number)} expression The value to compare.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @extends {module:ol/format/filter/ComparisonBinary}\n * @api\n */\nconst NotEqualTo = function(propertyName, expression, opt_matchCase) {\n  ComparisonBinary.call(this, 'PropertyIsNotEqualTo', propertyName, expression, opt_matchCase);\n};\n\ninherits(NotEqualTo, ComparisonBinary);\nexport default NotEqualTo;\n","/**\n * @module ol/format/filter/Or\n */\nimport {inherits} from '../../util.js';\nimport LogicalNary from '../filter/LogicalNary.js';\n\n/**\n * @classdesc\n * Represents a logical `<Or>` operator between two ore more filter conditions.\n *\n * @constructor\n * @param {...module:ol/format/filter/Filter} conditions Conditions.\n * @extends {module:ol/format/filter/LogicalNary}\n * @api\n */\nconst Or = function(conditions) {\n  const params = ['Or'].concat(Array.prototype.slice.call(arguments));\n  LogicalNary.apply(this, params);\n};\n\ninherits(Or, LogicalNary);\nexport default Or;\n","/**\n * @module ol/format/filter/Within\n */\nimport {inherits} from '../../util.js';\nimport Spatial from '../filter/Spatial.js';\n\n/**\n * @classdesc\n * Represents a `<Within>` operator to test whether a geometry-valued property\n * is within a given geometry.\n *\n * @constructor\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @extends {module:ol/format/filter/Spatial}\n * @api\n */\nconst Within = function(geometryName, geometry, opt_srsName) {\n\n  Spatial.call(this, 'Within', geometryName, geometry, opt_srsName);\n\n};\n\ninherits(Within, Spatial);\nexport default Within;\n","/**\n * @module ol/format/filter\n */\nimport And from '../format/filter/And.js';\nimport Bbox from '../format/filter/Bbox.js';\nimport Contains from '../format/filter/Contains.js';\nimport During from '../format/filter/During.js';\nimport EqualTo from '../format/filter/EqualTo.js';\nimport GreaterThan from '../format/filter/GreaterThan.js';\nimport GreaterThanOrEqualTo from '../format/filter/GreaterThanOrEqualTo.js';\nimport Intersects from '../format/filter/Intersects.js';\nimport IsBetween from '../format/filter/IsBetween.js';\nimport IsLike from '../format/filter/IsLike.js';\nimport IsNull from '../format/filter/IsNull.js';\nimport LessThan from '../format/filter/LessThan.js';\nimport LessThanOrEqualTo from '../format/filter/LessThanOrEqualTo.js';\nimport Not from '../format/filter/Not.js';\nimport NotEqualTo from '../format/filter/NotEqualTo.js';\nimport Or from '../format/filter/Or.js';\nimport Within from '../format/filter/Within.js';\n\n\n/**\n * Create a logical `<And>` operator between two or more filter conditions.\n *\n * @param {...module:ol/format/filter/Filter} conditions Filter conditions.\n * @returns {!module:ol/format/filter/And} `<And>` operator.\n * @api\n */\nexport function and(conditions) {\n  const params = [null].concat(Array.prototype.slice.call(arguments));\n  return new (Function.prototype.bind.apply(And, params));\n}\n\n\n/**\n * Create a logical `<Or>` operator between two or more filter conditions.\n *\n * @param {...module:ol/format/filter/Filter} conditions Filter conditions.\n * @returns {!module:ol/format/filter/Or} `<Or>` operator.\n * @api\n */\nexport function or(conditions) {\n  const params = [null].concat(Array.prototype.slice.call(arguments));\n  return new (Function.prototype.bind.apply(Or, params));\n}\n\n\n/**\n * Represents a logical `<Not>` operator for a filter condition.\n *\n * @param {!module:ol/format/filter/Filter} condition Filter condition.\n * @returns {!module:ol/format/filter/Not} `<Not>` operator.\n * @api\n */\nexport function not(condition) {\n  return new Not(condition);\n}\n\n\n/**\n * Create a `<BBOX>` operator to test whether a geometry-valued property\n * intersects a fixed bounding box\n *\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/extent~Extent} extent Extent.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @returns {!module:ol/format/filter/Bbox} `<BBOX>` operator.\n * @api\n */\nexport function bbox(geometryName, extent, opt_srsName) {\n  return new Bbox(geometryName, extent, opt_srsName);\n}\n\n/**\n * Create a `<Contains>` operator to test whether a geometry-valued property\n * contains a given geometry.\n *\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @returns {!module:ol/format/filter/Contains} `<Contains>` operator.\n * @api\n */\nexport function contains(geometryName, geometry, opt_srsName) {\n  return new Contains(geometryName, geometry, opt_srsName);\n}\n\n/**\n * Create a `<Intersects>` operator to test whether a geometry-valued property\n * intersects a given geometry.\n *\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @returns {!module:ol/format/filter/Intersects} `<Intersects>` operator.\n * @api\n */\nexport function intersects(geometryName, geometry, opt_srsName) {\n  return new Intersects(geometryName, geometry, opt_srsName);\n}\n\n/**\n * Create a `<Within>` operator to test whether a geometry-valued property\n * is within a given geometry.\n *\n * @param {!string} geometryName Geometry name to use.\n * @param {!module:ol/geom/Geometry} geometry Geometry.\n * @param {string=} opt_srsName SRS name. No srsName attribute will be\n *    set on geometries when this is not provided.\n * @returns {!module:ol/format/filter/Within} `<Within>` operator.\n * @api\n */\nexport function within(geometryName, geometry, opt_srsName) {\n  return new Within(geometryName, geometry, opt_srsName);\n}\n\n\n/**\n * Creates a `<PropertyIsEqualTo>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!(string|number)} expression The value to compare.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @returns {!module:ol/format/filter/EqualTo} `<PropertyIsEqualTo>` operator.\n * @api\n */\nexport function equalTo(propertyName, expression, opt_matchCase) {\n  return new EqualTo(propertyName, expression, opt_matchCase);\n}\n\n\n/**\n * Creates a `<PropertyIsNotEqualTo>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!(string|number)} expression The value to compare.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @returns {!module:ol/format/filter/NotEqualTo} `<PropertyIsNotEqualTo>` operator.\n * @api\n */\nexport function notEqualTo(propertyName, expression, opt_matchCase) {\n  return new NotEqualTo(propertyName, expression, opt_matchCase);\n}\n\n\n/**\n * Creates a `<PropertyIsLessThan>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @returns {!module:ol/format/filter/LessThan} `<PropertyIsLessThan>` operator.\n * @api\n */\nexport function lessThan(propertyName, expression) {\n  return new LessThan(propertyName, expression);\n}\n\n\n/**\n * Creates a `<PropertyIsLessThanOrEqualTo>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @returns {!module:ol/format/filter/LessThanOrEqualTo} `<PropertyIsLessThanOrEqualTo>` operator.\n * @api\n */\nexport function lessThanOrEqualTo(propertyName, expression) {\n  return new LessThanOrEqualTo(propertyName, expression);\n}\n\n\n/**\n * Creates a `<PropertyIsGreaterThan>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @returns {!module:ol/format/filter/GreaterThan} `<PropertyIsGreaterThan>` operator.\n * @api\n */\nexport function greaterThan(propertyName, expression) {\n  return new GreaterThan(propertyName, expression);\n}\n\n\n/**\n * Creates a `<PropertyIsGreaterThanOrEqualTo>` comparison operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} expression The value to compare.\n * @returns {!module:ol/format/filter/GreaterThanOrEqualTo} `<PropertyIsGreaterThanOrEqualTo>` operator.\n * @api\n */\nexport function greaterThanOrEqualTo(propertyName, expression) {\n  return new GreaterThanOrEqualTo(propertyName, expression);\n}\n\n\n/**\n * Creates a `<PropertyIsNull>` comparison operator to test whether a property value\n * is null.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @returns {!module:ol/format/filter/IsNull} `<PropertyIsNull>` operator.\n * @api\n */\nexport function isNull(propertyName) {\n  return new IsNull(propertyName);\n}\n\n\n/**\n * Creates a `<PropertyIsBetween>` comparison operator to test whether an expression\n * value lies within a range given by a lower and upper bound (inclusive).\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!number} lowerBoundary The lower bound of the range.\n * @param {!number} upperBoundary The upper bound of the range.\n * @returns {!module:ol/format/filter/IsBetween} `<PropertyIsBetween>` operator.\n * @api\n */\nexport function between(propertyName, lowerBoundary, upperBoundary) {\n  return new IsBetween(propertyName, lowerBoundary, upperBoundary);\n}\n\n\n/**\n * Represents a `<PropertyIsLike>` comparison operator that matches a string property\n * value against a text pattern.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!string} pattern Text pattern.\n * @param {string=} opt_wildCard Pattern character which matches any sequence of\n *    zero or more string characters. Default is '*'.\n * @param {string=} opt_singleChar pattern character which matches any single\n *    string character. Default is '.'.\n * @param {string=} opt_escapeChar Escape character which can be used to escape\n *    the pattern characters. Default is '!'.\n * @param {boolean=} opt_matchCase Case-sensitive?\n * @returns {!module:ol/format/filter/IsLike} `<PropertyIsLike>` operator.\n * @api\n */\nexport function like(propertyName, pattern,\n  opt_wildCard, opt_singleChar, opt_escapeChar, opt_matchCase) {\n  return new IsLike(propertyName, pattern,\n    opt_wildCard, opt_singleChar, opt_escapeChar, opt_matchCase);\n}\n\n\n/**\n * Create a `<During>` temporal operator.\n *\n * @param {!string} propertyName Name of the context property to compare.\n * @param {!string} begin The begin date in ISO-8601 format.\n * @param {!string} end The end date in ISO-8601 format.\n * @returns {!module:ol/format/filter/During} `<During>` operator.\n * @api\n */\nexport function during(propertyName, begin, end) {\n  return new During(propertyName, begin, end);\n}\n","/**\n * @module ol/format/WFS\n */\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport GML2 from '../format/GML2.js';\nimport GML3 from '../format/GML3.js';\nimport GMLBase, {GMLNS} from '../format/GMLBase.js';\nimport {and as andFilter, bbox as bboxFilter} from '../format/filter.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport {readNonNegativeIntegerString, readNonNegativeInteger, writeStringTextNode} from '../format/xsd.js';\nimport Geometry from '../geom/Geometry.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection} from '../proj.js';\nimport {createElementNS, isDocument, isNode, makeArrayPusher, makeChildAppender,\n  makeObjectPropertySetter, makeSimpleNodeFactory, parse, parseNode,\n  pushParseAndPop, pushSerializeAndPop, XML_SCHEMA_INSTANCE_URI} from '../xml.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {Object.<string, string>|string} [featureNS] The namespace URI used for features.\n * @property {Array.<string>|string} [featureType] The feature type to parse. Only used for read operations.\n * @property {module:ol/format/GMLBase} [gmlFormat] The GML format to use to parse the response. Default is `ol/format/GML3`.\n * @property {string} [schemaLocation] Optional schemaLocation to use for serialization, this will override the default.\n */\n\n\n/**\n * @typedef {Object} WriteGetFeatureOptions\n * @property {string} featureNS The namespace URI used for features.\n * @property {string} featurePrefix The prefix for the feature namespace.\n * @property {Array.<string>} featureTypes The feature type names.\n * @property {string} [srsName] SRS name. No srsName attribute will be set on\n * geometries when this is not provided.\n * @property {string} [handle] Handle.\n * @property {string} [outputFormat] Output format.\n * @property {number} [maxFeatures] Maximum number of features to fetch.\n * @property {string} [geometryName] Geometry name to use in a BBOX filter.\n * @property {Array.<string>} [propertyNames] Optional list of property names to serialize.\n * @property {number} [startIndex] Start index to use for WFS paging. This is a\n * WFS 2.0 feature backported to WFS 1.1.0 by some Web Feature Services.\n * @property {number} [count] Number of features to retrieve when paging. This is a\n * WFS 2.0 feature backported to WFS 1.1.0 by some Web Feature Services. Please note that some\n * Web Feature Services have repurposed `maxfeatures` instead.\n * @property {module:ol/extent~Extent} [bbox] Extent to use for the BBOX filter.\n * @property {module:ol/format/filter/Filter} [filter] Filter condition. See\n * {@link module:ol/format/Filter} for more information.\n * @property {string} [resultType] Indicates what response should be returned,\n * E.g. `hits` only includes the `numberOfFeatures` attribute in the response and no features.\n */\n\n\n/**\n * @typedef {Object} WriteTransactionOptions\n * @property {string} featureNS The namespace URI used for features.\n * @property {string} featurePrefix The prefix for the feature namespace.\n * @property {string} featureType The feature type name.\n * @property {string} [srsName] SRS name. No srsName attribute will be set on\n * geometries when this is not provided.\n * @property {string} [handle] Handle.\n * @property {boolean} [hasZ] Must be set to true if the transaction is for\n * a 3D layer. This will allow the Z coordinate to be included in the transaction.\n * @property {Array.<Object>} nativeElements Native elements. Currently not supported.\n * @property {module:ol/format/GMLBase~Options} [gmlOptions] GML options for the WFS transaction writer.\n * @property {string} [version='1.1.0'] WFS version to use for the transaction. Can be either `1.0.0` or `1.1.0`.\n */\n\n\n/**\n * Number of features; bounds/extent.\n * @typedef {Object} FeatureCollectionMetadata\n * @property {number} numberOfFeatures\n * @property {module:ol/extent~Extent} bounds\n */\n\n\n/**\n * Total deleted; total inserted; total updated; array of insert ids.\n * @typedef {Object} TransactionResponse\n * @property {number} totalDeleted\n * @property {number} totalInserted\n * @property {number} totalUpdated\n * @property {Array.<string>} insertIds\n */\n\n\n/**\n * @type {string}\n */\nconst FEATURE_PREFIX = 'feature';\n\n\n/**\n * @type {string}\n */\nconst XMLNS = 'http://www.w3.org/2000/xmlns/';\n\n\n/**\n * @type {string}\n */\nconst OGCNS = 'http://www.opengis.net/ogc';\n\n\n/**\n * @type {string}\n */\nconst WFSNS = 'http://www.opengis.net/wfs';\n\n\n/**\n * @type {string}\n */\nconst FESNS = 'http://www.opengis.net/fes';\n\n\n/**\n * @type {Object.<string, string>}\n */\nconst SCHEMA_LOCATIONS = {\n  '1.1.0': 'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd',\n  '1.0.0': 'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd'\n};\n\n\n/**\n * @const\n * @type {string}\n */\nconst DEFAULT_VERSION = '1.1.0';\n\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the WFS format.\n * By default, supports WFS version 1.1.0. You can pass a GML format\n * as option if you want to read a WFS that contains GML2 (WFS 1.0.0).\n * Also see {@link module:ol/format/GMLBase~GMLBase} which is used by this format.\n *\n * @constructor\n * @param {module:ol/format/WFS~Options=} opt_options Optional configuration object.\n * @extends {module:ol/format/XMLFeature}\n * @api\n */\nconst WFS = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {Array.<string>|string|undefined}\n   */\n  this.featureType_ = options.featureType;\n\n  /**\n   * @private\n   * @type {Object.<string, string>|string|undefined}\n   */\n  this.featureNS_ = options.featureNS;\n\n  /**\n   * @private\n   * @type {module:ol/format/GMLBase}\n   */\n  this.gmlFormat_ = options.gmlFormat ?\n    options.gmlFormat : new GML3();\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.schemaLocation_ = options.schemaLocation ?\n    options.schemaLocation : SCHEMA_LOCATIONS[DEFAULT_VERSION];\n\n  XMLFeature.call(this);\n};\n\ninherits(WFS, XMLFeature);\n\n\n/**\n * @return {Array.<string>|string|undefined} featureType\n */\nWFS.prototype.getFeatureType = function() {\n  return this.featureType_;\n};\n\n\n/**\n * @param {Array.<string>|string|undefined} featureType Feature type(s) to parse.\n */\nWFS.prototype.setFeatureType = function(featureType) {\n  this.featureType_ = featureType;\n};\n\n\n/**\n * Read all features from a WFS FeatureCollection.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nWFS.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nWFS.prototype.readFeaturesFromNode = function(node, opt_options) {\n  const context = /** @type {module:ol/xml~NodeStackItem} */ ({\n    'featureType': this.featureType_,\n    'featureNS': this.featureNS_\n  });\n  assign(context, this.getReadOptions(node, opt_options ? opt_options : {}));\n  const objectStack = [context];\n  this.gmlFormat_.FEATURE_COLLECTION_PARSERS[GMLNS][\n    'featureMember'] =\n      makeArrayPusher(GMLBase.prototype.readFeaturesInternal);\n  let features = pushParseAndPop([],\n    this.gmlFormat_.FEATURE_COLLECTION_PARSERS, node,\n    objectStack, this.gmlFormat_);\n  if (!features) {\n    features = [];\n  }\n  return features;\n};\n\n\n/**\n * Read transaction response of the source.\n *\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/format/WFS~TransactionResponse|undefined} Transaction response.\n * @api\n */\nWFS.prototype.readTransactionResponse = function(source) {\n  if (isDocument(source)) {\n    return this.readTransactionResponseFromDocument(\n      /** @type {Document} */ (source));\n  } else if (isNode(source)) {\n    return this.readTransactionResponseFromNode(/** @type {Node} */ (source));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readTransactionResponseFromDocument(doc);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * Read feature collection metadata of the source.\n *\n * @param {Document|Node|Object|string} source Source.\n * @return {module:ol/format/WFS~FeatureCollectionMetadata|undefined}\n *     FeatureCollection metadata.\n * @api\n */\nWFS.prototype.readFeatureCollectionMetadata = function(source) {\n  if (isDocument(source)) {\n    return this.readFeatureCollectionMetadataFromDocument(\n      /** @type {Document} */ (source));\n  } else if (isNode(source)) {\n    return this.readFeatureCollectionMetadataFromNode(\n      /** @type {Node} */ (source));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readFeatureCollectionMetadataFromDocument(doc);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @return {module:ol/format/WFS~FeatureCollectionMetadata|undefined}\n *     FeatureCollection metadata.\n */\nWFS.prototype.readFeatureCollectionMetadataFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readFeatureCollectionMetadataFromNode(n);\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst FEATURE_COLLECTION_PARSERS = {\n  'http://www.opengis.net/gml': {\n    'boundedBy': makeObjectPropertySetter(\n      GMLBase.prototype.readGeometryElement, 'bounds')\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @return {module:ol/format/WFS~FeatureCollectionMetadata|undefined}\n *     FeatureCollection metadata.\n */\nWFS.prototype.readFeatureCollectionMetadataFromNode = function(node) {\n  const result = {};\n  const value = readNonNegativeIntegerString(\n    node.getAttribute('numberOfFeatures'));\n  result['numberOfFeatures'] = value;\n  return pushParseAndPop(\n    /** @type {module:ol/format/WFS~FeatureCollectionMetadata} */ (result),\n    FEATURE_COLLECTION_PARSERS, node, [], this.gmlFormat_);\n};\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TRANSACTION_SUMMARY_PARSERS = {\n  'http://www.opengis.net/wfs': {\n    'totalInserted': makeObjectPropertySetter(readNonNegativeInteger),\n    'totalUpdated': makeObjectPropertySetter(readNonNegativeInteger),\n    'totalDeleted': makeObjectPropertySetter(readNonNegativeInteger)\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Transaction Summary.\n */\nfunction readTransactionSummary(node, objectStack) {\n  return pushParseAndPop(\n    {}, TRANSACTION_SUMMARY_PARSERS, node, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst OGC_FID_PARSERS = {\n  'http://www.opengis.net/ogc': {\n    'FeatureId': makeArrayPusher(function(node, objectStack) {\n      return node.getAttribute('fid');\n    })\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n */\nfunction fidParser(node, objectStack) {\n  parseNode(OGC_FID_PARSERS, node, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst INSERT_RESULTS_PARSERS = {\n  'http://www.opengis.net/wfs': {\n    'Feature': fidParser\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<string>|undefined} Insert results.\n */\nfunction readInsertResults(node, objectStack) {\n  return pushParseAndPop(\n    [], INSERT_RESULTS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TRANSACTION_RESPONSE_PARSERS = {\n  'http://www.opengis.net/wfs': {\n    'TransactionSummary': makeObjectPropertySetter(\n      readTransactionSummary, 'transactionSummary'),\n    'InsertResults': makeObjectPropertySetter(\n      readInsertResults, 'insertIds')\n  }\n};\n\n\n/**\n * @param {Document} doc Document.\n * @return {module:ol/format/WFS~TransactionResponse|undefined} Transaction response.\n */\nWFS.prototype.readTransactionResponseFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readTransactionResponseFromNode(n);\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @param {Node} node Node.\n * @return {module:ol/format/WFS~TransactionResponse|undefined} Transaction response.\n */\nWFS.prototype.readTransactionResponseFromNode = function(node) {\n  return pushParseAndPop(\n    /** @type {module:ol/format/WFS~TransactionResponse} */({}),\n    TRANSACTION_RESPONSE_PARSERS, node, []);\n};\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst QUERY_SERIALIZERS = {\n  'http://www.opengis.net/wfs': {\n    'PropertyName': makeChildAppender(writeStringTextNode)\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeFeature(node, feature, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const featureType = context['featureType'];\n  const featureNS = context['featureNS'];\n  const gmlVersion = context['gmlVersion'];\n  const child = createElementNS(featureNS, featureType);\n  node.appendChild(child);\n  if (gmlVersion === 2) {\n    GML2.prototype.writeFeatureElement(child, feature, objectStack);\n  } else {\n    GML3.prototype.writeFeatureElement(child, feature, objectStack);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {number|string} fid Feature identifier.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeOgcFidFilter(node, fid, objectStack) {\n  const filter = createElementNS(OGCNS, 'Filter');\n  const child = createElementNS(OGCNS, 'FeatureId');\n  filter.appendChild(child);\n  child.setAttribute('fid', fid);\n  node.appendChild(filter);\n}\n\n\n/**\n * @param {string|undefined} featurePrefix The prefix of the feature.\n * @param {string} featureType The type of the feature.\n * @returns {string} The value of the typeName property.\n */\nfunction getTypeName(featurePrefix, featureType) {\n  featurePrefix = featurePrefix ? featurePrefix : FEATURE_PREFIX;\n  const prefix = featurePrefix + ':';\n  // The featureType already contains the prefix.\n  if (featureType.indexOf(prefix) === 0) {\n    return featureType;\n  } else {\n    return prefix + featureType;\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeDelete(node, feature, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  assert(feature.getId() !== undefined, 26); // Features must have an id set\n  const featureType = context['featureType'];\n  const featurePrefix = context['featurePrefix'];\n  const featureNS = context['featureNS'];\n  const typeName = getTypeName(featurePrefix, featureType);\n  node.setAttribute('typeName', typeName);\n  node.setAttributeNS(XMLNS, 'xmlns:' + featurePrefix, featureNS);\n  const fid = feature.getId();\n  if (fid !== undefined) {\n    writeOgcFidFilter(node, fid, objectStack);\n  }\n}\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst TRANSACTION_SERIALIZERS = {\n  'http://www.opengis.net/wfs': {\n    'Insert': makeChildAppender(writeFeature),\n    'Update': makeChildAppender(writeUpdate),\n    'Delete': makeChildAppender(writeDelete),\n    'Property': makeChildAppender(writeProperty),\n    'Native': makeChildAppender(writeNative)\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/Feature} feature Feature.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeUpdate(node, feature, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  assert(feature.getId() !== undefined, 27); // Features must have an id set\n  const featureType = context['featureType'];\n  const featurePrefix = context['featurePrefix'];\n  const featureNS = context['featureNS'];\n  const typeName = getTypeName(featurePrefix, featureType);\n  const geometryName = feature.getGeometryName();\n  node.setAttribute('typeName', typeName);\n  node.setAttributeNS(XMLNS, 'xmlns:' + featurePrefix, featureNS);\n  const fid = feature.getId();\n  if (fid !== undefined) {\n    const keys = feature.getKeys();\n    const values = [];\n    for (let i = 0, ii = keys.length; i < ii; i++) {\n      const value = feature.get(keys[i]);\n      if (value !== undefined) {\n        let name = keys[i];\n        if (value instanceof Geometry) {\n          name = geometryName;\n        }\n        values.push({name: name, value: value});\n      }\n    }\n    pushSerializeAndPop(/** @type {module:ol/xml~NodeStackItem} */ (\n      {'gmlVersion': context['gmlVersion'], node: node,\n        'hasZ': context['hasZ'], 'srsName': context['srsName']}),\n    TRANSACTION_SERIALIZERS,\n    makeSimpleNodeFactory('Property'), values,\n    objectStack);\n    writeOgcFidFilter(node, fid, objectStack);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Object} pair Property name and value.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeProperty(node, pair, objectStack) {\n  const name = createElementNS(WFSNS, 'Name');\n  const context = objectStack[objectStack.length - 1];\n  const gmlVersion = context['gmlVersion'];\n  node.appendChild(name);\n  writeStringTextNode(name, pair.name);\n  if (pair.value !== undefined && pair.value !== null) {\n    const value = createElementNS(WFSNS, 'Value');\n    node.appendChild(value);\n    if (pair.value instanceof Geometry) {\n      if (gmlVersion === 2) {\n        GML2.prototype.writeGeometryElement(value,\n          pair.value, objectStack);\n      } else {\n        GML3.prototype.writeGeometryElement(value,\n          pair.value, objectStack);\n      }\n    } else {\n      writeStringTextNode(value, pair.value);\n    }\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {{vendorId: string, safeToIgnore: boolean, value: string}}\n *     nativeElement The native element.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeNative(node, nativeElement, objectStack) {\n  if (nativeElement.vendorId) {\n    node.setAttribute('vendorId', nativeElement.vendorId);\n  }\n  if (nativeElement.safeToIgnore !== undefined) {\n    node.setAttribute('safeToIgnore', nativeElement.safeToIgnore);\n  }\n  if (nativeElement.value !== undefined) {\n    writeStringTextNode(node, nativeElement.value);\n  }\n}\n\n\n/**\n * @type {Object.<string, Object.<string, module:ol/xml~Serializer>>}\n */\nconst GETFEATURE_SERIALIZERS = {\n  'http://www.opengis.net/wfs': {\n    'Query': makeChildAppender(writeQuery)\n  },\n  'http://www.opengis.net/ogc': {\n    'During': makeChildAppender(writeDuringFilter),\n    'And': makeChildAppender(writeLogicalFilter),\n    'Or': makeChildAppender(writeLogicalFilter),\n    'Not': makeChildAppender(writeNotFilter),\n    'BBOX': makeChildAppender(writeBboxFilter),\n    'Contains': makeChildAppender(writeContainsFilter),\n    'Intersects': makeChildAppender(writeIntersectsFilter),\n    'Within': makeChildAppender(writeWithinFilter),\n    'PropertyIsEqualTo': makeChildAppender(writeComparisonFilter),\n    'PropertyIsNotEqualTo': makeChildAppender(writeComparisonFilter),\n    'PropertyIsLessThan': makeChildAppender(writeComparisonFilter),\n    'PropertyIsLessThanOrEqualTo': makeChildAppender(writeComparisonFilter),\n    'PropertyIsGreaterThan': makeChildAppender(writeComparisonFilter),\n    'PropertyIsGreaterThanOrEqualTo': makeChildAppender(writeComparisonFilter),\n    'PropertyIsNull': makeChildAppender(writeIsNullFilter),\n    'PropertyIsBetween': makeChildAppender(writeIsBetweenFilter),\n    'PropertyIsLike': makeChildAppender(writeIsLikeFilter)\n  }\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {string} featureType Feature type.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeQuery(node, featureType, objectStack) {\n  const context = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const featurePrefix = context['featurePrefix'];\n  const featureNS = context['featureNS'];\n  const propertyNames = context['propertyNames'];\n  const srsName = context['srsName'];\n  let typeName;\n  // If feature prefix is not defined, we must not use the default prefix.\n  if (featurePrefix) {\n    typeName = getTypeName(featurePrefix, featureType);\n  } else {\n    typeName = featureType;\n  }\n  node.setAttribute('typeName', typeName);\n  if (srsName) {\n    node.setAttribute('srsName', srsName);\n  }\n  if (featureNS) {\n    node.setAttributeNS(XMLNS, 'xmlns:' + featurePrefix, featureNS);\n  }\n  const item = /** @type {module:ol/xml~NodeStackItem} */ (assign({}, context));\n  item.node = node;\n  pushSerializeAndPop(item,\n    QUERY_SERIALIZERS,\n    makeSimpleNodeFactory('PropertyName'), propertyNames,\n    objectStack);\n  const filter = context['filter'];\n  if (filter) {\n    const child = createElementNS(OGCNS, 'Filter');\n    node.appendChild(child);\n    writeFilterCondition(child, filter, objectStack);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Filter} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeFilterCondition(node, filter, objectStack) {\n  /** @type {module:ol/xml~NodeStackItem} */\n  const item = {node: node};\n  pushSerializeAndPop(item,\n    GETFEATURE_SERIALIZERS,\n    makeSimpleNodeFactory(filter.getTagName()),\n    [filter], objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Bbox} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeBboxFilter(node, filter, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  context['srsName'] = filter.srsName;\n\n  writeOgcPropertyName(node, filter.geometryName);\n  GML3.prototype.writeGeometryElement(node, filter.extent, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Contains} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeContainsFilter(node, filter, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  context['srsName'] = filter.srsName;\n\n  writeOgcPropertyName(node, filter.geometryName);\n  GML3.prototype.writeGeometryElement(node, filter.geometry, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Intersects} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeIntersectsFilter(node, filter, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  context['srsName'] = filter.srsName;\n\n  writeOgcPropertyName(node, filter.geometryName);\n  GML3.prototype.writeGeometryElement(node, filter.geometry, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Within} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeWithinFilter(node, filter, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  context['srsName'] = filter.srsName;\n\n  writeOgcPropertyName(node, filter.geometryName);\n  GML3.prototype.writeGeometryElement(node, filter.geometry, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/During} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeDuringFilter(node, filter, objectStack) {\n\n  const valueReference = createElementNS(FESNS, 'ValueReference');\n  writeStringTextNode(valueReference, filter.propertyName);\n  node.appendChild(valueReference);\n\n  const timePeriod = createElementNS(GMLNS, 'TimePeriod');\n\n  node.appendChild(timePeriod);\n\n  const begin = createElementNS(GMLNS, 'begin');\n  timePeriod.appendChild(begin);\n  writeTimeInstant(begin, filter.begin);\n\n  const end = createElementNS(GMLNS, 'end');\n  timePeriod.appendChild(end);\n  writeTimeInstant(end, filter.end);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/LogicalNary} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeLogicalFilter(node, filter, objectStack) {\n  /** @type {module:ol/xml~NodeStackItem} */\n  const item = {node: node};\n  const conditions = filter.conditions;\n  for (let i = 0, ii = conditions.length; i < ii; ++i) {\n    const condition = conditions[i];\n    pushSerializeAndPop(item,\n      GETFEATURE_SERIALIZERS,\n      makeSimpleNodeFactory(condition.getTagName()),\n      [condition], objectStack);\n  }\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/Not} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeNotFilter(node, filter, objectStack) {\n  /** @type {module:ol/xml~NodeStackItem} */\n  const item = {node: node};\n  const condition = filter.condition;\n  pushSerializeAndPop(item,\n    GETFEATURE_SERIALIZERS,\n    makeSimpleNodeFactory(condition.getTagName()),\n    [condition], objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/ComparisonBinary} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeComparisonFilter(node, filter, objectStack) {\n  if (filter.matchCase !== undefined) {\n    node.setAttribute('matchCase', filter.matchCase.toString());\n  }\n  writeOgcPropertyName(node, filter.propertyName);\n  writeOgcLiteral(node, '' + filter.expression);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/IsNull} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeIsNullFilter(node, filter, objectStack) {\n  writeOgcPropertyName(node, filter.propertyName);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/IsBetween} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeIsBetweenFilter(node, filter, objectStack) {\n  writeOgcPropertyName(node, filter.propertyName);\n\n  const lowerBoundary = createElementNS(OGCNS, 'LowerBoundary');\n  node.appendChild(lowerBoundary);\n  writeOgcLiteral(lowerBoundary, '' + filter.lowerBoundary);\n\n  const upperBoundary = createElementNS(OGCNS, 'UpperBoundary');\n  node.appendChild(upperBoundary);\n  writeOgcLiteral(upperBoundary, '' + filter.upperBoundary);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {module:ol/format/filter/IsLike} filter Filter.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeIsLikeFilter(node, filter, objectStack) {\n  node.setAttribute('wildCard', filter.wildCard);\n  node.setAttribute('singleChar', filter.singleChar);\n  node.setAttribute('escapeChar', filter.escapeChar);\n  if (filter.matchCase !== undefined) {\n    node.setAttribute('matchCase', filter.matchCase.toString());\n  }\n  writeOgcPropertyName(node, filter.propertyName);\n  writeOgcLiteral(node, '' + filter.pattern);\n}\n\n\n/**\n * @param {string} tagName Tag name.\n * @param {Node} node Node.\n * @param {string} value Value.\n */\nfunction writeOgcExpression(tagName, node, value) {\n  const property = createElementNS(OGCNS, tagName);\n  writeStringTextNode(property, value);\n  node.appendChild(property);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {string} value PropertyName value.\n */\nfunction writeOgcPropertyName(node, value) {\n  writeOgcExpression('PropertyName', node, value);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {string} value PropertyName value.\n */\nfunction writeOgcLiteral(node, value) {\n  writeOgcExpression('Literal', node, value);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {string} time PropertyName value.\n */\nfunction writeTimeInstant(node, time) {\n  const timeInstant = createElementNS(GMLNS, 'TimeInstant');\n  node.appendChild(timeInstant);\n\n  const timePosition = createElementNS(GMLNS, 'timePosition');\n  timeInstant.appendChild(timePosition);\n  writeStringTextNode(timePosition, time);\n}\n\n\n/**\n * Encode filter as WFS `Filter` and return the Node.\n *\n * @param {module:ol/format/filter/Filter} filter Filter.\n * @return {Node} Result.\n * @api\n */\nexport function writeFilter(filter) {\n  const child = createElementNS(OGCNS, 'Filter');\n  writeFilterCondition(child, filter, []);\n  return child;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<string>} featureTypes Feature types.\n * @param {Array.<*>} objectStack Node stack.\n */\nfunction writeGetFeature(node, featureTypes, objectStack) {\n  const context = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const item = /** @type {module:ol/xml~NodeStackItem} */ (assign({}, context));\n  item.node = node;\n  pushSerializeAndPop(item,\n    GETFEATURE_SERIALIZERS,\n    makeSimpleNodeFactory('Query'), featureTypes,\n    objectStack);\n}\n\n\n/**\n * Encode format as WFS `GetFeature` and return the Node.\n *\n * @param {module:ol/format/WFS~WriteGetFeatureOptions} options Options.\n * @return {Node} Result.\n * @api\n */\nWFS.prototype.writeGetFeature = function(options) {\n  const node = createElementNS(WFSNS, 'GetFeature');\n  node.setAttribute('service', 'WFS');\n  node.setAttribute('version', '1.1.0');\n  let filter;\n  if (options) {\n    if (options.handle) {\n      node.setAttribute('handle', options.handle);\n    }\n    if (options.outputFormat) {\n      node.setAttribute('outputFormat', options.outputFormat);\n    }\n    if (options.maxFeatures !== undefined) {\n      node.setAttribute('maxFeatures', options.maxFeatures);\n    }\n    if (options.resultType) {\n      node.setAttribute('resultType', options.resultType);\n    }\n    if (options.startIndex !== undefined) {\n      node.setAttribute('startIndex', options.startIndex);\n    }\n    if (options.count !== undefined) {\n      node.setAttribute('count', options.count);\n    }\n    filter = options.filter;\n    if (options.bbox) {\n      assert(options.geometryName,\n        12); // `options.geometryName` must also be provided when `options.bbox` is set\n      const bbox = bboxFilter(\n        /** @type {string} */ (options.geometryName), options.bbox, options.srsName);\n      if (filter) {\n        // if bbox and filter are both set, combine the two into a single filter\n        filter = andFilter(filter, bbox);\n      } else {\n        filter = bbox;\n      }\n    }\n  }\n  node.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', this.schemaLocation_);\n  /** @type {module:ol/xml~NodeStackItem} */\n  const context = {\n    node: node,\n    'srsName': options.srsName,\n    'featureNS': options.featureNS ? options.featureNS : this.featureNS_,\n    'featurePrefix': options.featurePrefix,\n    'geometryName': options.geometryName,\n    'filter': filter,\n    'propertyNames': options.propertyNames ? options.propertyNames : []\n  };\n  assert(Array.isArray(options.featureTypes),\n    11); // `options.featureTypes` should be an Array\n  writeGetFeature(node, /** @type {!Array.<string>} */ (options.featureTypes), [context]);\n  return node;\n};\n\n\n/**\n * Encode format as WFS `Transaction` and return the Node.\n *\n * @param {Array.<module:ol/Feature>} inserts The features to insert.\n * @param {Array.<module:ol/Feature>} updates The features to update.\n * @param {Array.<module:ol/Feature>} deletes The features to delete.\n * @param {module:ol/format/WFS~WriteTransactionOptions} options Write options.\n * @return {Node} Result.\n * @api\n */\nWFS.prototype.writeTransaction = function(inserts, updates, deletes, options) {\n  const objectStack = [];\n  const node = createElementNS(WFSNS, 'Transaction');\n  const version = options.version ? options.version : DEFAULT_VERSION;\n  const gmlVersion = version === '1.0.0' ? 2 : 3;\n  node.setAttribute('service', 'WFS');\n  node.setAttribute('version', version);\n  let baseObj;\n  /** @type {module:ol/xml~NodeStackItem} */\n  let obj;\n  if (options) {\n    baseObj = options.gmlOptions ? options.gmlOptions : {};\n    if (options.handle) {\n      node.setAttribute('handle', options.handle);\n    }\n  }\n  const schemaLocation = SCHEMA_LOCATIONS[version];\n  node.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', schemaLocation);\n  const featurePrefix = options.featurePrefix ? options.featurePrefix : FEATURE_PREFIX;\n  if (inserts) {\n    obj = {node: node, 'featureNS': options.featureNS,\n      'featureType': options.featureType, 'featurePrefix': featurePrefix,\n      'gmlVersion': gmlVersion, 'hasZ': options.hasZ, 'srsName': options.srsName};\n    assign(obj, baseObj);\n    pushSerializeAndPop(obj,\n      TRANSACTION_SERIALIZERS,\n      makeSimpleNodeFactory('Insert'), inserts,\n      objectStack);\n  }\n  if (updates) {\n    obj = {node: node, 'featureNS': options.featureNS,\n      'featureType': options.featureType, 'featurePrefix': featurePrefix,\n      'gmlVersion': gmlVersion, 'hasZ': options.hasZ, 'srsName': options.srsName};\n    assign(obj, baseObj);\n    pushSerializeAndPop(obj,\n      TRANSACTION_SERIALIZERS,\n      makeSimpleNodeFactory('Update'), updates,\n      objectStack);\n  }\n  if (deletes) {\n    pushSerializeAndPop({node: node, 'featureNS': options.featureNS,\n      'featureType': options.featureType, 'featurePrefix': featurePrefix,\n      'gmlVersion': gmlVersion, 'srsName': options.srsName},\n    TRANSACTION_SERIALIZERS,\n    makeSimpleNodeFactory('Delete'), deletes,\n    objectStack);\n  }\n  if (options.nativeElements) {\n    pushSerializeAndPop({node: node, 'featureNS': options.featureNS,\n      'featureType': options.featureType, 'featurePrefix': featurePrefix,\n      'gmlVersion': gmlVersion, 'srsName': options.srsName},\n    TRANSACTION_SERIALIZERS,\n    makeSimpleNodeFactory('Native'), options.nativeElements,\n    objectStack);\n  }\n  return node;\n};\n\n\n/**\n * Read the projection from a WFS source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @return {?module:ol/proj/Projection} Projection.\n * @api\n */\nWFS.prototype.readProjection;\n\n\n/**\n * @inheritDoc\n */\nWFS.prototype.readProjectionFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readProjectionFromNode(n);\n    }\n  }\n  return null;\n};\n\n\n/**\n * @inheritDoc\n */\nWFS.prototype.readProjectionFromNode = function(node) {\n  if (node.firstElementChild &&\n      node.firstElementChild.firstElementChild) {\n    node = node.firstElementChild.firstElementChild;\n    for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (!(n.childNodes.length === 0 ||\n          (n.childNodes.length === 1 &&\n          n.firstChild.nodeType === 3))) {\n        const objectStack = [{}];\n        this.gmlFormat_.readGeometryElement(n, objectStack);\n        return getProjection(objectStack.pop().srsName);\n      }\n    }\n  }\n\n  return null;\n};\nexport default WFS;\n","/**\n * @module ol/format/WKT\n */\nimport {inherits} from '../util.js';\nimport Feature from '../Feature.js';\nimport {transformWithOptions} from '../format/Feature.js';\nimport TextFeature from '../format/TextFeature.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport GeometryType from '../geom/GeometryType.js';\nimport GeometryLayout from '../geom/GeometryLayout.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport SimpleGeometry from '../geom/SimpleGeometry.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [splitCollection=false] Whether to split GeometryCollections into\n * multiple features on reading.\n */\n\n/**\n * @typedef {Object} Token\n * @property {number} type\n * @property {number|string} [value]\n * @property {number} position\n */\n\n/**\n * @const\n * @type {string}\n */\nconst EMPTY = 'EMPTY';\n\n\n/**\n * @const\n * @type {string}\n */\nconst Z = 'Z';\n\n\n/**\n * @const\n * @type {string}\n */\nconst M = 'M';\n\n\n/**\n * @const\n * @type {string}\n */\nconst ZM = 'ZM';\n\n\n/**\n * @const\n * @enum {number}\n */\nconst TokenType = {\n  TEXT: 1,\n  LEFT_PAREN: 2,\n  RIGHT_PAREN: 3,\n  NUMBER: 4,\n  COMMA: 5,\n  EOF: 6\n};\n\n\n/**\n * Class to tokenize a WKT string.\n * @param {string} wkt WKT string.\n * @constructor\n */\nconst Lexer = function(wkt) {\n\n  /**\n   * @type {string}\n   */\n  this.wkt = wkt;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.index_ = -1;\n};\n\n\n/**\n * @param {string} c Character.\n * @return {boolean} Whether the character is alphabetic.\n * @private\n */\nLexer.prototype.isAlpha_ = function(c) {\n  return c >= 'a' && c <= 'z' || c >= 'A' && c <= 'Z';\n};\n\n\n/**\n * @param {string} c Character.\n * @param {boolean=} opt_decimal Whether the string number\n *     contains a dot, i.e. is a decimal number.\n * @return {boolean} Whether the character is numeric.\n * @private\n */\nLexer.prototype.isNumeric_ = function(c, opt_decimal) {\n  const decimal = opt_decimal !== undefined ? opt_decimal : false;\n  return c >= '0' && c <= '9' || c == '.' && !decimal;\n};\n\n\n/**\n * @param {string} c Character.\n * @return {boolean} Whether the character is whitespace.\n * @private\n */\nLexer.prototype.isWhiteSpace_ = function(c) {\n  return c == ' ' || c == '\\t' || c == '\\r' || c == '\\n';\n};\n\n\n/**\n * @return {string} Next string character.\n * @private\n */\nLexer.prototype.nextChar_ = function() {\n  return this.wkt.charAt(++this.index_);\n};\n\n\n/**\n * Fetch and return the next token.\n * @return {!module:ol/format/WKT~Token} Next string token.\n */\nLexer.prototype.nextToken = function() {\n  const c = this.nextChar_();\n  const token = {position: this.index_, value: c};\n\n  if (c == '(') {\n    token.type = TokenType.LEFT_PAREN;\n  } else if (c == ',') {\n    token.type = TokenType.COMMA;\n  } else if (c == ')') {\n    token.type = TokenType.RIGHT_PAREN;\n  } else if (this.isNumeric_(c) || c == '-') {\n    token.type = TokenType.NUMBER;\n    token.value = this.readNumber_();\n  } else if (this.isAlpha_(c)) {\n    token.type = TokenType.TEXT;\n    token.value = this.readText_();\n  } else if (this.isWhiteSpace_(c)) {\n    return this.nextToken();\n  } else if (c === '') {\n    token.type = TokenType.EOF;\n  } else {\n    throw new Error('Unexpected character: ' + c);\n  }\n\n  return token;\n};\n\n\n/**\n * @return {number} Numeric token value.\n * @private\n */\nLexer.prototype.readNumber_ = function() {\n  let c;\n  const index = this.index_;\n  let decimal = false;\n  let scientificNotation = false;\n  do {\n    if (c == '.') {\n      decimal = true;\n    } else if (c == 'e' || c == 'E') {\n      scientificNotation = true;\n    }\n    c = this.nextChar_();\n  } while (\n    this.isNumeric_(c, decimal) ||\n      // if we haven't detected a scientific number before, 'e' or 'E'\n      // hint that we should continue to read\n      !scientificNotation && (c == 'e' || c == 'E') ||\n      // once we know that we have a scientific number, both '-' and '+'\n      // are allowed\n      scientificNotation && (c == '-' || c == '+')\n  );\n  return parseFloat(this.wkt.substring(index, this.index_--));\n};\n\n\n/**\n * @return {string} String token value.\n * @private\n */\nLexer.prototype.readText_ = function() {\n  let c;\n  const index = this.index_;\n  do {\n    c = this.nextChar_();\n  } while (this.isAlpha_(c));\n  return this.wkt.substring(index, this.index_--).toUpperCase();\n};\n\n\n/**\n * Class to parse the tokens from the WKT string.\n * @param {module:ol/format/WKT~Lexer} lexer The lexer.\n * @constructor\n */\nconst Parser = function(lexer) {\n\n  /**\n   * @type {module:ol/format/WKT~Lexer}\n   * @private\n   */\n  this.lexer_ = lexer;\n\n  /**\n   * @type {module:ol/format/WKT~Token}\n   * @private\n   */\n  this.token_;\n\n  /**\n   * @type {module:ol/geom/GeometryLayout}\n   * @private\n   */\n  this.layout_ = GeometryLayout.XY;\n};\n\n\n/**\n * Fetch the next token form the lexer and replace the active token.\n * @private\n */\nParser.prototype.consume_ = function() {\n  this.token_ = this.lexer_.nextToken();\n};\n\n/**\n * Tests if the given type matches the type of the current token.\n * @param {module:ol/format/WKT~TokenType} type Token type.\n * @return {boolean} Whether the token matches the given type.\n */\nParser.prototype.isTokenType = function(type) {\n  const isMatch = this.token_.type == type;\n  return isMatch;\n};\n\n\n/**\n * If the given type matches the current token, consume it.\n * @param {module:ol/format/WKT~TokenType} type Token type.\n * @return {boolean} Whether the token matches the given type.\n */\nParser.prototype.match = function(type) {\n  const isMatch = this.isTokenType(type);\n  if (isMatch) {\n    this.consume_();\n  }\n  return isMatch;\n};\n\n\n/**\n * Try to parse the tokens provided by the lexer.\n * @return {module:ol/geom/Geometry} The geometry.\n */\nParser.prototype.parse = function() {\n  this.consume_();\n  const geometry = this.parseGeometry_();\n  return geometry;\n};\n\n\n/**\n * Try to parse the dimensional info.\n * @return {module:ol/geom/GeometryLayout} The layout.\n * @private\n */\nParser.prototype.parseGeometryLayout_ = function() {\n  let layout = GeometryLayout.XY;\n  const dimToken = this.token_;\n  if (this.isTokenType(TokenType.TEXT)) {\n    const dimInfo = dimToken.value;\n    if (dimInfo === Z) {\n      layout = GeometryLayout.XYZ;\n    } else if (dimInfo === M) {\n      layout = GeometryLayout.XYM;\n    } else if (dimInfo === ZM) {\n      layout = GeometryLayout.XYZM;\n    }\n    if (layout !== GeometryLayout.XY) {\n      this.consume_();\n    }\n  }\n  return layout;\n};\n\n\n/**\n * @return {!Array.<module:ol/geom/Geometry>} A collection of geometries.\n * @private\n */\nParser.prototype.parseGeometryCollectionText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const geometries = [];\n    do {\n      geometries.push(this.parseGeometry_());\n    } while (this.match(TokenType.COMMA));\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return geometries;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {Array.<number>} All values in a point.\n * @private\n */\nParser.prototype.parsePointText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const coordinates = this.parsePoint_();\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return null;\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} All points in a linestring.\n * @private\n */\nParser.prototype.parseLineStringText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const coordinates = this.parsePointList_();\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} All points in a polygon.\n * @private\n */\nParser.prototype.parsePolygonText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const coordinates = this.parseLineStringTextList_();\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} All points in a multipoint.\n * @private\n */\nParser.prototype.parseMultiPointText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    let coordinates;\n    if (this.token_.type == TokenType.LEFT_PAREN) {\n      coordinates = this.parsePointTextList_();\n    } else {\n      coordinates = this.parsePointList_();\n    }\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} All linestring points\n *                                        in a multilinestring.\n * @private\n */\nParser.prototype.parseMultiLineStringText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const coordinates = this.parseLineStringTextList_();\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} All polygon points in a multipolygon.\n * @private\n */\nParser.prototype.parseMultiPolygonText_ = function() {\n  if (this.match(TokenType.LEFT_PAREN)) {\n    const coordinates = this.parsePolygonTextList_();\n    if (this.match(TokenType.RIGHT_PAREN)) {\n      return coordinates;\n    }\n  } else if (this.isEmptyGeometry_()) {\n    return [];\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<number>} A point.\n * @private\n */\nParser.prototype.parsePoint_ = function() {\n  const coordinates = [];\n  const dimensions = this.layout_.length;\n  for (let i = 0; i < dimensions; ++i) {\n    const token = this.token_;\n    if (this.match(TokenType.NUMBER)) {\n      coordinates.push(token.value);\n    } else {\n      break;\n    }\n  }\n  if (coordinates.length == dimensions) {\n    return coordinates;\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} An array of points.\n * @private\n */\nParser.prototype.parsePointList_ = function() {\n  const coordinates = [this.parsePoint_()];\n  while (this.match(TokenType.COMMA)) {\n    coordinates.push(this.parsePoint_());\n  }\n  return coordinates;\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} An array of points.\n * @private\n */\nParser.prototype.parsePointTextList_ = function() {\n  const coordinates = [this.parsePointText_()];\n  while (this.match(TokenType.COMMA)) {\n    coordinates.push(this.parsePointText_());\n  }\n  return coordinates;\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} An array of points.\n * @private\n */\nParser.prototype.parseLineStringTextList_ = function() {\n  const coordinates = [this.parseLineStringText_()];\n  while (this.match(TokenType.COMMA)) {\n    coordinates.push(this.parseLineStringText_());\n  }\n  return coordinates;\n};\n\n\n/**\n * @return {!Array.<!Array.<number>>} An array of points.\n * @private\n */\nParser.prototype.parsePolygonTextList_ = function() {\n  const coordinates = [this.parsePolygonText_()];\n  while (this.match(TokenType.COMMA)) {\n    coordinates.push(this.parsePolygonText_());\n  }\n  return coordinates;\n};\n\n\n/**\n * @return {boolean} Whether the token implies an empty geometry.\n * @private\n */\nParser.prototype.isEmptyGeometry_ = function() {\n  const isEmpty = this.isTokenType(TokenType.TEXT) &&\n      this.token_.value == EMPTY;\n  if (isEmpty) {\n    this.consume_();\n  }\n  return isEmpty;\n};\n\n\n/**\n * Create an error message for an unexpected token error.\n * @return {string} Error message.\n * @private\n */\nParser.prototype.formatErrorMessage_ = function() {\n  return 'Unexpected `' + this.token_.value + '` at position ' +\n      this.token_.position + ' in `' + this.lexer_.wkt + '`';\n};\n\n\n/**\n * @classdesc\n * Geometry format for reading and writing data in the `WellKnownText` (WKT)\n * format.\n *\n * @constructor\n * @extends {module:ol/format/TextFeature}\n * @param {module:ol/format/WKT~Options=} opt_options Options.\n * @api\n */\nconst WKT = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  TextFeature.call(this);\n\n  /**\n   * Split GeometryCollection into multiple features.\n   * @type {boolean}\n   * @private\n   */\n  this.splitCollection_ = options.splitCollection !== undefined ?\n    options.splitCollection : false;\n\n};\n\ninherits(WKT, TextFeature);\n\n\n/**\n * @param {module:ol/geom/Point} geom Point geometry.\n * @return {string} Coordinates part of Point as WKT.\n */\nfunction encodePointGeometry(geom) {\n  const coordinates = geom.getCoordinates();\n  if (coordinates.length === 0) {\n    return '';\n  }\n  return coordinates.join(' ');\n}\n\n\n/**\n * @param {module:ol/geom/MultiPoint} geom MultiPoint geometry.\n * @return {string} Coordinates part of MultiPoint as WKT.\n */\nfunction encodeMultiPointGeometry(geom) {\n  const array = [];\n  const components = geom.getPoints();\n  for (let i = 0, ii = components.length; i < ii; ++i) {\n    array.push('(' + encodePointGeometry(components[i]) + ')');\n  }\n  return array.join(',');\n}\n\n\n/**\n * @param {module:ol/geom/GeometryCollection} geom GeometryCollection geometry.\n * @return {string} Coordinates part of GeometryCollection as WKT.\n */\nfunction encodeGeometryCollectionGeometry(geom) {\n  const array = [];\n  const geoms = geom.getGeometries();\n  for (let i = 0, ii = geoms.length; i < ii; ++i) {\n    array.push(encode(geoms[i]));\n  }\n  return array.join(',');\n}\n\n\n/**\n * @param {module:ol/geom/LineString|module:ol/geom/LinearRing} geom LineString geometry.\n * @return {string} Coordinates part of LineString as WKT.\n */\nfunction encodeLineStringGeometry(geom) {\n  const coordinates = geom.getCoordinates();\n  const array = [];\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    array.push(coordinates[i].join(' '));\n  }\n  return array.join(',');\n}\n\n\n/**\n * @param {module:ol/geom/MultiLineString} geom MultiLineString geometry.\n * @return {string} Coordinates part of MultiLineString as WKT.\n */\nfunction encodeMultiLineStringGeometry(geom) {\n  const array = [];\n  const components = geom.getLineStrings();\n  for (let i = 0, ii = components.length; i < ii; ++i) {\n    array.push('(' + encodeLineStringGeometry(components[i]) + ')');\n  }\n  return array.join(',');\n}\n\n\n/**\n * @param {module:ol/geom/Polygon} geom Polygon geometry.\n * @return {string} Coordinates part of Polygon as WKT.\n */\nfunction encodePolygonGeometry(geom) {\n  const array = [];\n  const rings = geom.getLinearRings();\n  for (let i = 0, ii = rings.length; i < ii; ++i) {\n    array.push('(' + encodeLineStringGeometry(rings[i]) + ')');\n  }\n  return array.join(',');\n}\n\n\n/**\n * @param {module:ol/geom/MultiPolygon} geom MultiPolygon geometry.\n * @return {string} Coordinates part of MultiPolygon as WKT.\n */\nfunction encodeMultiPolygonGeometry(geom) {\n  const array = [];\n  const components = geom.getPolygons();\n  for (let i = 0, ii = components.length; i < ii; ++i) {\n    array.push('(' + encodePolygonGeometry(components[i]) + ')');\n  }\n  return array.join(',');\n}\n\n/**\n * @param {module:ol/geom/SimpleGeometry} geom SimpleGeometry geometry.\n * @return {string} Potential dimensional information for WKT type.\n */\nfunction encodeGeometryLayout(geom) {\n  const layout = geom.getLayout();\n  let dimInfo = '';\n  if (layout === GeometryLayout.XYZ || layout === GeometryLayout.XYZM) {\n    dimInfo += Z;\n  }\n  if (layout === GeometryLayout.XYM || layout === GeometryLayout.XYZM) {\n    dimInfo += M;\n  }\n  return dimInfo;\n}\n\n\n/**\n * @const\n * @type {Object.<string, function(module:ol/geom/Geometry): string>}\n */\nconst GeometryEncoder = {\n  'Point': encodePointGeometry,\n  'LineString': encodeLineStringGeometry,\n  'Polygon': encodePolygonGeometry,\n  'MultiPoint': encodeMultiPointGeometry,\n  'MultiLineString': encodeMultiLineStringGeometry,\n  'MultiPolygon': encodeMultiPolygonGeometry,\n  'GeometryCollection': encodeGeometryCollectionGeometry\n};\n\n\n/**\n * Encode a geometry as WKT.\n * @param {module:ol/geom/Geometry} geom The geometry to encode.\n * @return {string} WKT string for the geometry.\n */\nfunction encode(geom) {\n  let type = geom.getType();\n  const geometryEncoder = GeometryEncoder[type];\n  const enc = geometryEncoder(geom);\n  type = type.toUpperCase();\n  if (geom instanceof SimpleGeometry) {\n    const dimInfo = encodeGeometryLayout(geom);\n    if (dimInfo.length > 0) {\n      type += ' ' + dimInfo;\n    }\n  }\n  if (enc.length === 0) {\n    return type + ' ' + EMPTY;\n  }\n  return type + '(' + enc + ')';\n}\n\n\n/**\n * Parse a WKT string.\n * @param {string} wkt WKT string.\n * @return {module:ol/geom/Geometry|undefined}\n *     The geometry created.\n * @private\n */\nWKT.prototype.parse_ = function(wkt) {\n  const lexer = new Lexer(wkt);\n  const parser = new Parser(lexer);\n  return parser.parse();\n};\n\n\n/**\n * Read a feature from a WKT source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/Feature} Feature.\n * @api\n */\nWKT.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.readFeatureFromText = function(text, opt_options) {\n  const geom = this.readGeometryFromText(text, opt_options);\n  if (geom) {\n    const feature = new Feature();\n    feature.setGeometry(geom);\n    return feature;\n  }\n  return null;\n};\n\n\n/**\n * Read all features from a WKT source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nWKT.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.readFeaturesFromText = function(text, opt_options) {\n  let geometries = [];\n  const geometry = this.readGeometryFromText(text, opt_options);\n  if (this.splitCollection_ &&\n      geometry.getType() == GeometryType.GEOMETRY_COLLECTION) {\n    geometries = (/** @type {module:ol/geom/GeometryCollection} */ (geometry))\n      .getGeometriesArray();\n  } else {\n    geometries = [geometry];\n  }\n  const features = [];\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    const feature = new Feature();\n    feature.setGeometry(geometries[i]);\n    features.push(feature);\n  }\n  return features;\n};\n\n\n/**\n * Read a single geometry from a WKT source.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Read options.\n * @return {module:ol/geom/Geometry} Geometry.\n * @api\n */\nWKT.prototype.readGeometry;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.readGeometryFromText = function(text, opt_options) {\n  const geometry = this.parse_(text);\n  if (geometry) {\n    return (\n      /** @type {module:ol/geom/Geometry} */ (transformWithOptions(geometry, false, opt_options))\n    );\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @enum {function (new:module:ol/geom/Geometry, Array, module:ol/geom/GeometryLayout)}\n */\nconst GeometryConstructor = {\n  'POINT': Point,\n  'LINESTRING': LineString,\n  'POLYGON': Polygon,\n  'MULTIPOINT': MultiPoint,\n  'MULTILINESTRING': MultiLineString,\n  'MULTIPOLYGON': MultiPolygon\n};\n\n\n/**\n * @enum {(function(): Array)}\n */\nconst GeometryParser = {\n  'POINT': Parser.prototype.parsePointText_,\n  'LINESTRING': Parser.prototype.parseLineStringText_,\n  'POLYGON': Parser.prototype.parsePolygonText_,\n  'MULTIPOINT': Parser.prototype.parseMultiPointText_,\n  'MULTILINESTRING': Parser.prototype.parseMultiLineStringText_,\n  'MULTIPOLYGON': Parser.prototype.parseMultiPolygonText_\n};\n\n\n/**\n * @return {!module:ol/geom/Geometry} The geometry.\n * @private\n */\nParser.prototype.parseGeometry_ = function() {\n  const token = this.token_;\n  if (this.match(TokenType.TEXT)) {\n    const geomType = token.value;\n    this.layout_ = this.parseGeometryLayout_();\n    if (geomType == GeometryType.GEOMETRY_COLLECTION.toUpperCase()) {\n      const geometries = this.parseGeometryCollectionText_();\n      return new GeometryCollection(geometries);\n    } else {\n      const parser = GeometryParser[geomType];\n      const ctor = GeometryConstructor[geomType];\n      if (!parser || !ctor) {\n        throw new Error('Invalid geometry type: ' + geomType);\n      }\n      const coordinates = parser.call(this);\n      return new ctor(coordinates, this.layout_);\n    }\n  }\n  throw new Error(this.formatErrorMessage_());\n};\n\n\n/**\n * Encode a feature as a WKT string.\n *\n * @function\n * @param {module:ol/Feature} feature Feature.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} WKT string.\n * @api\n */\nWKT.prototype.writeFeature;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.writeFeatureText = function(feature, opt_options) {\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    return this.writeGeometryText(geometry, opt_options);\n  }\n  return '';\n};\n\n\n/**\n * Encode an array of features as a WKT string.\n *\n * @function\n * @param {Array.<module:ol/Feature>} features Features.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} WKT string.\n * @api\n */\nWKT.prototype.writeFeatures;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.writeFeaturesText = function(features, opt_options) {\n  if (features.length == 1) {\n    return this.writeFeatureText(features[0], opt_options);\n  }\n  const geometries = [];\n  for (let i = 0, ii = features.length; i < ii; ++i) {\n    geometries.push(features[i].getGeometry());\n  }\n  const collection = new GeometryCollection(geometries);\n  return this.writeGeometryText(collection, opt_options);\n};\n\n\n/**\n * Write a single geometry as a WKT string.\n *\n * @function\n * @param {module:ol/geom/Geometry} geometry Geometry.\n * @param {module:ol/format/Feature~WriteOptions=} opt_options Write options.\n * @return {string} WKT string.\n * @api\n */\nWKT.prototype.writeGeometry;\n\n\n/**\n * @inheritDoc\n */\nWKT.prototype.writeGeometryText = function(geometry, opt_options) {\n  return encode(/** @type {module:ol/geom/Geometry} */ (\n    transformWithOptions(geometry, true, opt_options)));\n};\n\n\nexport default WKT;\n","/**\n * @module ol/format/XLink\n */\n\n\n/**\n * @const\n * @type {string}\n */\nconst NAMESPACE_URI = 'http://www.w3.org/1999/xlink';\n\n\n/**\n * @param {Node} node Node.\n * @return {boolean|undefined} Boolean.\n */\nexport function readHref(node) {\n  return node.getAttributeNS(NAMESPACE_URI, 'href');\n}\n","/**\n * @module ol/format/XML\n */\nimport {isDocument, isNode, parse} from '../xml.js';\n\n/**\n * @classdesc\n * Generic format for reading non-feature XML data\n *\n * @constructor\n * @abstract\n * @struct\n */\nconst XML = function() {\n};\n\n\n/**\n * @param {Document|Node|string} source Source.\n * @return {Object} The parsed result.\n */\nXML.prototype.read = function(source) {\n  if (isDocument(source)) {\n    return this.readFromDocument(/** @type {Document} */ (source));\n  } else if (isNode(source)) {\n    return this.readFromNode(/** @type {Node} */ (source));\n  } else if (typeof source === 'string') {\n    const doc = parse(source);\n    return this.readFromDocument(doc);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @abstract\n * @param {Document} doc Document.\n * @return {Object} Object\n */\nXML.prototype.readFromDocument = function(doc) {};\n\n\n/**\n * @abstract\n * @param {Node} node Node.\n * @return {Object} Object\n */\nXML.prototype.readFromNode = function(node) {};\nexport default XML;\n","/**\n * @module ol/format/WMSCapabilities\n */\nimport {inherits} from '../util.js';\nimport {readHref} from '../format/XLink.js';\nimport XML from '../format/XML.js';\nimport {readDecimalString, readString, readNonNegativeInteger, readDecimal, readBooleanString, readNonNegativeIntegerString} from '../format/xsd.js';\nimport {makeArrayPusher, makeObjectPropertyPusher, makeObjectPropertySetter,\n  makeStructureNS, pushParseAndPop} from '../xml.js';\n\n\n/**\n * @classdesc\n * Format for reading WMS capabilities data\n *\n * @constructor\n * @extends {module:ol/format/XML}\n * @api\n */\nconst WMSCapabilities = function() {\n\n  XML.call(this);\n\n  /**\n   * @type {string|undefined}\n   */\n  this.version = undefined;\n};\n\ninherits(WMSCapabilities, XML);\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst NAMESPACE_URIS = [\n  null,\n  'http://www.opengis.net/wms'\n];\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Service': makeObjectPropertySetter(readService),\n    'Capability': makeObjectPropertySetter(readCapability)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CAPABILITY_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Request': makeObjectPropertySetter(readRequest),\n    'Exception': makeObjectPropertySetter(readException),\n    'Layer': makeObjectPropertySetter(readCapabilityLayer)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst SERVICE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Name': makeObjectPropertySetter(readString),\n    'Title': makeObjectPropertySetter(readString),\n    'Abstract': makeObjectPropertySetter(readString),\n    'KeywordList': makeObjectPropertySetter(readKeywordList),\n    'OnlineResource': makeObjectPropertySetter(readHref),\n    'ContactInformation': makeObjectPropertySetter(readContactInformation),\n    'Fees': makeObjectPropertySetter(readString),\n    'AccessConstraints': makeObjectPropertySetter(readString),\n    'LayerLimit': makeObjectPropertySetter(readNonNegativeInteger),\n    'MaxWidth': makeObjectPropertySetter(readNonNegativeInteger),\n    'MaxHeight': makeObjectPropertySetter(readNonNegativeInteger)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONTACT_INFORMATION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ContactPersonPrimary': makeObjectPropertySetter(readContactPersonPrimary),\n    'ContactPosition': makeObjectPropertySetter(readString),\n    'ContactAddress': makeObjectPropertySetter(readContactAddress),\n    'ContactVoiceTelephone': makeObjectPropertySetter(readString),\n    'ContactFacsimileTelephone': makeObjectPropertySetter(readString),\n    'ContactElectronicMailAddress': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONTACT_PERSON_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ContactPerson': makeObjectPropertySetter(readString),\n    'ContactOrganization': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONTACT_ADDRESS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'AddressType': makeObjectPropertySetter(readString),\n    'Address': makeObjectPropertySetter(readString),\n    'City': makeObjectPropertySetter(readString),\n    'StateOrProvince': makeObjectPropertySetter(readString),\n    'PostCode': makeObjectPropertySetter(readString),\n    'Country': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst EXCEPTION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Format': makeArrayPusher(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LAYER_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Name': makeObjectPropertySetter(readString),\n    'Title': makeObjectPropertySetter(readString),\n    'Abstract': makeObjectPropertySetter(readString),\n    'KeywordList': makeObjectPropertySetter(readKeywordList),\n    'CRS': makeObjectPropertyPusher(readString),\n    'EX_GeographicBoundingBox': makeObjectPropertySetter(readEXGeographicBoundingBox),\n    'BoundingBox': makeObjectPropertyPusher(readBoundingBox),\n    'Dimension': makeObjectPropertyPusher(readDimension),\n    'Attribution': makeObjectPropertySetter(readAttribution),\n    'AuthorityURL': makeObjectPropertyPusher(readAuthorityURL),\n    'Identifier': makeObjectPropertyPusher(readString),\n    'MetadataURL': makeObjectPropertyPusher(readMetadataURL),\n    'DataURL': makeObjectPropertyPusher(readFormatOnlineresource),\n    'FeatureListURL': makeObjectPropertyPusher(readFormatOnlineresource),\n    'Style': makeObjectPropertyPusher(readStyle),\n    'MinScaleDenominator': makeObjectPropertySetter(readDecimal),\n    'MaxScaleDenominator': makeObjectPropertySetter(readDecimal),\n    'Layer': makeObjectPropertyPusher(readLayer)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst ATTRIBUTION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Title': makeObjectPropertySetter(readString),\n    'OnlineResource': makeObjectPropertySetter(readHref),\n    'LogoURL': makeObjectPropertySetter(readSizedFormatOnlineresource)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS =\n    makeStructureNS(NAMESPACE_URIS, {\n      'westBoundLongitude': makeObjectPropertySetter(readDecimal),\n      'eastBoundLongitude': makeObjectPropertySetter(readDecimal),\n      'southBoundLatitude': makeObjectPropertySetter(readDecimal),\n      'northBoundLatitude': makeObjectPropertySetter(readDecimal)\n    });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst REQUEST_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'GetCapabilities': makeObjectPropertySetter(readOperationType),\n    'GetMap': makeObjectPropertySetter(readOperationType),\n    'GetFeatureInfo': makeObjectPropertySetter(readOperationType)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst OPERATIONTYPE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Format': makeObjectPropertyPusher(readString),\n    'DCPType': makeObjectPropertyPusher(readDCPType)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst DCPTYPE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'HTTP': makeObjectPropertySetter(readHTTP)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst HTTP_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Get': makeObjectPropertySetter(readFormatOnlineresource),\n    'Post': makeObjectPropertySetter(readFormatOnlineresource)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Name': makeObjectPropertySetter(readString),\n    'Title': makeObjectPropertySetter(readString),\n    'Abstract': makeObjectPropertySetter(readString),\n    'LegendURL': makeObjectPropertyPusher(readSizedFormatOnlineresource),\n    'StyleSheetURL': makeObjectPropertySetter(readFormatOnlineresource),\n    'StyleURL': makeObjectPropertySetter(readFormatOnlineresource)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst FORMAT_ONLINERESOURCE_PARSERS =\n    makeStructureNS(NAMESPACE_URIS, {\n      'Format': makeObjectPropertySetter(readString),\n      'OnlineResource': makeObjectPropertySetter(readHref)\n    });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst KEYWORDLIST_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Keyword': makeArrayPusher(readString)\n  });\n\n\n/**\n * Read a WMS capabilities document.\n *\n * @function\n * @param {Document|Node|string} source The XML source.\n * @return {Object} An object representing the WMS capabilities.\n * @api\n */\nWMSCapabilities.prototype.read;\n\n\n/**\n * @inheritDoc\n */\nWMSCapabilities.prototype.readFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readFromNode(n);\n    }\n  }\n  return null;\n};\n\n\n/**\n * @inheritDoc\n */\nWMSCapabilities.prototype.readFromNode = function(node) {\n  this.version = node.getAttribute('version').trim();\n  const wmsCapabilityObject = pushParseAndPop({\n    'version': this.version\n  }, PARSERS, node, []);\n  return wmsCapabilityObject ? wmsCapabilityObject : null;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Attribution object.\n */\nfunction readAttribution(node, objectStack) {\n  return pushParseAndPop({}, ATTRIBUTION_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object} Bounding box object.\n */\nfunction readBoundingBox(node, objectStack) {\n  const extent = [\n    readDecimalString(node.getAttribute('minx')),\n    readDecimalString(node.getAttribute('miny')),\n    readDecimalString(node.getAttribute('maxx')),\n    readDecimalString(node.getAttribute('maxy'))\n  ];\n\n  const resolutions = [\n    readDecimalString(node.getAttribute('resx')),\n    readDecimalString(node.getAttribute('resy'))\n  ];\n\n  return {\n    'crs': node.getAttribute('CRS'),\n    'extent': extent,\n    'res': resolutions\n  };\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {module:ol/extent~Extent|undefined} Bounding box object.\n */\nfunction readEXGeographicBoundingBox(node, objectStack) {\n  const geographicBoundingBox = pushParseAndPop(\n    {},\n    EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,\n    node, objectStack);\n  if (!geographicBoundingBox) {\n    return undefined;\n  }\n  const westBoundLongitude = /** @type {number|undefined} */\n        (geographicBoundingBox['westBoundLongitude']);\n  const southBoundLatitude = /** @type {number|undefined} */\n        (geographicBoundingBox['southBoundLatitude']);\n  const eastBoundLongitude = /** @type {number|undefined} */\n        (geographicBoundingBox['eastBoundLongitude']);\n  const northBoundLatitude = /** @type {number|undefined} */\n        (geographicBoundingBox['northBoundLatitude']);\n  if (westBoundLongitude === undefined || southBoundLatitude === undefined ||\n        eastBoundLongitude === undefined || northBoundLatitude === undefined) {\n    return undefined;\n  }\n  return [\n    westBoundLongitude, southBoundLatitude,\n    eastBoundLongitude, northBoundLatitude\n  ];\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Capability object.\n */\nfunction readCapability(node, objectStack) {\n  return pushParseAndPop({}, CAPABILITY_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Service object.\n */\nfunction readService(node, objectStack) {\n  return pushParseAndPop({}, SERVICE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Contact information object.\n */\nfunction readContactInformation(node, objectStack) {\n  return pushParseAndPop({}, CONTACT_INFORMATION_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Contact person object.\n */\nfunction readContactPersonPrimary(node, objectStack) {\n  return pushParseAndPop({}, CONTACT_PERSON_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Contact address object.\n */\nfunction readContactAddress(node, objectStack) {\n  return pushParseAndPop({}, CONTACT_ADDRESS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<string>|undefined} Format array.\n */\nfunction readException(node, objectStack) {\n  return pushParseAndPop([], EXCEPTION_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Layer object.\n */\nfunction readCapabilityLayer(node, objectStack) {\n  return pushParseAndPop({}, LAYER_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Layer object.\n */\nfunction readLayer(node, objectStack) {\n  const parentLayerObject = /**  @type {!Object.<string,*>} */ (objectStack[objectStack.length - 1]);\n\n  const layerObject = pushParseAndPop({}, LAYER_PARSERS, node, objectStack);\n\n  if (!layerObject) {\n    return undefined;\n  }\n  let queryable = readBooleanString(node.getAttribute('queryable'));\n  if (queryable === undefined) {\n    queryable = parentLayerObject['queryable'];\n  }\n  layerObject['queryable'] = queryable !== undefined ? queryable : false;\n\n  let cascaded = readNonNegativeIntegerString(\n    node.getAttribute('cascaded'));\n  if (cascaded === undefined) {\n    cascaded = parentLayerObject['cascaded'];\n  }\n  layerObject['cascaded'] = cascaded;\n\n  let opaque = readBooleanString(node.getAttribute('opaque'));\n  if (opaque === undefined) {\n    opaque = parentLayerObject['opaque'];\n  }\n  layerObject['opaque'] = opaque !== undefined ? opaque : false;\n\n  let noSubsets = readBooleanString(node.getAttribute('noSubsets'));\n  if (noSubsets === undefined) {\n    noSubsets = parentLayerObject['noSubsets'];\n  }\n  layerObject['noSubsets'] = noSubsets !== undefined ? noSubsets : false;\n\n  let fixedWidth = readDecimalString(node.getAttribute('fixedWidth'));\n  if (!fixedWidth) {\n    fixedWidth = parentLayerObject['fixedWidth'];\n  }\n  layerObject['fixedWidth'] = fixedWidth;\n\n  let fixedHeight = readDecimalString(node.getAttribute('fixedHeight'));\n  if (!fixedHeight) {\n    fixedHeight = parentLayerObject['fixedHeight'];\n  }\n  layerObject['fixedHeight'] = fixedHeight;\n\n  // See 7.2.4.8\n  const addKeys = ['Style', 'CRS', 'AuthorityURL'];\n  addKeys.forEach(function(key) {\n    if (key in parentLayerObject) {\n      const childValue = layerObject[key] || [];\n      layerObject[key] = childValue.concat(parentLayerObject[key]);\n    }\n  });\n\n  const replaceKeys = ['EX_GeographicBoundingBox', 'BoundingBox', 'Dimension',\n    'Attribution', 'MinScaleDenominator', 'MaxScaleDenominator'];\n  replaceKeys.forEach(function(key) {\n    if (!(key in layerObject)) {\n      const parentValue = parentLayerObject[key];\n      layerObject[key] = parentValue;\n    }\n  });\n\n  return layerObject;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object} Dimension object.\n */\nfunction readDimension(node, objectStack) {\n  const dimensionObject = {\n    'name': node.getAttribute('name'),\n    'units': node.getAttribute('units'),\n    'unitSymbol': node.getAttribute('unitSymbol'),\n    'default': node.getAttribute('default'),\n    'multipleValues': readBooleanString(node.getAttribute('multipleValues')),\n    'nearestValue': readBooleanString(node.getAttribute('nearestValue')),\n    'current': readBooleanString(node.getAttribute('current')),\n    'values': readString(node)\n  };\n  return dimensionObject;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Online resource object.\n */\nfunction readFormatOnlineresource(node, objectStack) {\n  return pushParseAndPop({}, FORMAT_ONLINERESOURCE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Request object.\n */\nfunction readRequest(node, objectStack) {\n  return pushParseAndPop({}, REQUEST_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} DCP type object.\n */\nfunction readDCPType(node, objectStack) {\n  return pushParseAndPop({}, DCPTYPE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} HTTP object.\n */\nfunction readHTTP(node, objectStack) {\n  return pushParseAndPop({}, HTTP_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Operation type object.\n */\nfunction readOperationType(node, objectStack) {\n  return pushParseAndPop({}, OPERATIONTYPE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Online resource object.\n */\nfunction readSizedFormatOnlineresource(node, objectStack) {\n  const formatOnlineresource = readFormatOnlineresource(node, objectStack);\n  if (formatOnlineresource) {\n    const size = [\n      readNonNegativeIntegerString(node.getAttribute('width')),\n      readNonNegativeIntegerString(node.getAttribute('height'))\n    ];\n    formatOnlineresource['size'] = size;\n    return formatOnlineresource;\n  }\n  return undefined;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Authority URL object.\n */\nfunction readAuthorityURL(node, objectStack) {\n  const authorityObject = readFormatOnlineresource(node, objectStack);\n  if (authorityObject) {\n    authorityObject['name'] = node.getAttribute('name');\n    return authorityObject;\n  }\n  return undefined;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Metadata URL object.\n */\nfunction readMetadataURL(node, objectStack) {\n  const metadataObject = readFormatOnlineresource(node, objectStack);\n  if (metadataObject) {\n    metadataObject['type'] = node.getAttribute('type');\n    return metadataObject;\n  }\n  return undefined;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Style object.\n */\nfunction readStyle(node, objectStack) {\n  return pushParseAndPop({}, STYLE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<string>|undefined} Keyword list.\n */\nfunction readKeywordList(node, objectStack) {\n  return pushParseAndPop([], KEYWORDLIST_PARSERS, node, objectStack);\n}\n\n\nexport default WMSCapabilities;\n","/**\n * @module ol/format/WMSGetFeatureInfo\n */\nimport {inherits} from '../util.js';\nimport {extend, includes} from '../array.js';\nimport GML2 from '../format/GML2.js';\nimport XMLFeature from '../format/XMLFeature.js';\nimport {assign} from '../obj.js';\nimport {makeArrayPusher, makeStructureNS, pushParseAndPop} from '../xml.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {Array.<string>} [layers] If set, only features of the given layers will be returned by the format when read.\n */\n\n\n/**\n * @classdesc\n * Format for reading WMSGetFeatureInfo format. It uses\n * {@link module:ol/format/GML2~GML2} to read features.\n *\n * @constructor\n * @extends {module:ol/format/XMLFeature}\n * @param {module:ol/format/WMSGetFeatureInfo~Options=} opt_options Options.\n * @api\n */\nconst WMSGetFeatureInfo = function(opt_options) {\n\n  const options = opt_options ? opt_options : {};\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.featureNS_ = 'http://mapserver.gis.umn.edu/mapserver';\n\n\n  /**\n   * @private\n   * @type {module:ol/format/GML2}\n   */\n  this.gmlFormat_ = new GML2();\n\n\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.layers_ = options.layers ? options.layers : null;\n\n  XMLFeature.call(this);\n};\n\ninherits(WMSGetFeatureInfo, XMLFeature);\n\n\n/**\n * @const\n * @type {string}\n */\nconst featureIdentifier = '_feature';\n\n\n/**\n * @const\n * @type {string}\n */\nconst layerIdentifier = '_layer';\n\n\n/**\n * @return {Array.<string>} layers\n */\nWMSGetFeatureInfo.prototype.getLayers = function() {\n  return this.layers_;\n};\n\n\n/**\n * @param {Array.<string>} layers Layers to parse.\n */\nWMSGetFeatureInfo.prototype.setLayers = function(layers) {\n  this.layers_ = layers;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Array.<module:ol/Feature>} Features.\n * @private\n */\nWMSGetFeatureInfo.prototype.readFeatures_ = function(node, objectStack) {\n  node.setAttribute('namespaceURI', this.featureNS_);\n  const localName = node.localName;\n  /** @type {Array.<module:ol/Feature>} */\n  let features = [];\n  if (node.childNodes.length === 0) {\n    return features;\n  }\n  if (localName == 'msGMLOutput') {\n    for (let i = 0, ii = node.childNodes.length; i < ii; i++) {\n      const layer = node.childNodes[i];\n      if (layer.nodeType !== Node.ELEMENT_NODE) {\n        continue;\n      }\n      const context = objectStack[0];\n\n      const toRemove = layerIdentifier;\n      const layerName = layer.localName.replace(toRemove, '');\n\n      if (this.layers_ && !includes(this.layers_, layerName)) {\n        continue;\n      }\n\n      const featureType = layerName +\n          featureIdentifier;\n\n      context['featureType'] = featureType;\n      context['featureNS'] = this.featureNS_;\n\n      const parsers = {};\n      parsers[featureType] = makeArrayPusher(\n        this.gmlFormat_.readFeatureElement, this.gmlFormat_);\n      const parsersNS = makeStructureNS(\n        [context['featureNS'], null], parsers);\n      layer.setAttribute('namespaceURI', this.featureNS_);\n      const layerFeatures = pushParseAndPop(\n        [], parsersNS, layer, objectStack, this.gmlFormat_);\n      if (layerFeatures) {\n        extend(features, layerFeatures);\n      }\n    }\n  }\n  if (localName == 'FeatureCollection') {\n    const gmlFeatures = pushParseAndPop([],\n      this.gmlFormat_.FEATURE_COLLECTION_PARSERS, node,\n      [{}], this.gmlFormat_);\n    if (gmlFeatures) {\n      features = gmlFeatures;\n    }\n  }\n  return features;\n};\n\n\n/**\n * Read all features from a WMSGetFeatureInfo response.\n *\n * @function\n * @param {Document|Node|Object|string} source Source.\n * @param {module:ol/format/Feature~ReadOptions=} opt_options Options.\n * @return {Array.<module:ol/Feature>} Features.\n * @api\n */\nWMSGetFeatureInfo.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nWMSGetFeatureInfo.prototype.readFeaturesFromNode = function(node, opt_options) {\n  const options = {};\n  if (opt_options) {\n    assign(options, this.getReadOptions(node, opt_options));\n  }\n  return this.readFeatures_(node, [options]);\n};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nWMSGetFeatureInfo.prototype.writeFeatureNode = function(feature, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nWMSGetFeatureInfo.prototype.writeFeaturesNode = function(features, opt_options) {};\n\n\n/**\n * Not implemented.\n * @inheritDoc\n */\nWMSGetFeatureInfo.prototype.writeGeometryNode = function(geometry, opt_options) {};\nexport default WMSGetFeatureInfo;\n","/**\n * @module ol/format/OWS\n */\nimport {inherits} from '../util.js';\nimport {readHref} from '../format/XLink.js';\nimport XML from '../format/XML.js';\nimport {readString} from '../format/xsd.js';\nimport {makeObjectPropertyPusher, makeObjectPropertySetter, makeStructureNS, pushParseAndPop} from '../xml.js';\n\n/**\n * @constructor\n * @extends {module:ol/format/XML}\n */\nconst OWS = function() {\n  XML.call(this);\n};\n\ninherits(OWS, XML);\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst NAMESPACE_URIS = [null, 'http://www.opengis.net/ows/1.1'];\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'ServiceIdentification': makeObjectPropertySetter(readServiceIdentification),\n    'ServiceProvider': makeObjectPropertySetter(readServiceProvider),\n    'OperationsMetadata': makeObjectPropertySetter(readOperationsMetadata)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst ADDRESS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'DeliveryPoint': makeObjectPropertySetter(readString),\n    'City': makeObjectPropertySetter(readString),\n    'AdministrativeArea': makeObjectPropertySetter(readString),\n    'PostalCode': makeObjectPropertySetter(readString),\n    'Country': makeObjectPropertySetter(readString),\n    'ElectronicMailAddress': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst ALLOWED_VALUES_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Value': makeObjectPropertyPusher(readValue)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONSTRAINT_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'AllowedValues': makeObjectPropertySetter(readAllowedValues)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONTACT_INFO_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Phone': makeObjectPropertySetter(readPhone),\n    'Address': makeObjectPropertySetter(readAddress)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst DCP_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'HTTP': makeObjectPropertySetter(readHttp)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst HTTP_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Get': makeObjectPropertyPusher(readGet),\n    'Post': undefined // TODO\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst OPERATION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'DCP': makeObjectPropertySetter(readDcp)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst OPERATIONS_METADATA_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Operation': readOperation\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PHONE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Voice': makeObjectPropertySetter(readString),\n    'Facsimile': makeObjectPropertySetter(readString)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst REQUEST_METHOD_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Constraint': makeObjectPropertyPusher(readConstraint)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst SERVICE_CONTACT_PARSERS =\n    makeStructureNS(\n      NAMESPACE_URIS, {\n        'IndividualName': makeObjectPropertySetter(readString),\n        'PositionName': makeObjectPropertySetter(readString),\n        'ContactInfo': makeObjectPropertySetter(readContactInfo)\n      });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst SERVICE_IDENTIFICATION_PARSERS =\n    makeStructureNS(\n      NAMESPACE_URIS, {\n        'Abstract': makeObjectPropertySetter(readString),\n        'AccessConstraints': makeObjectPropertySetter(readString),\n        'Fees': makeObjectPropertySetter(readString),\n        'Title': makeObjectPropertySetter(readString),\n        'ServiceTypeVersion': makeObjectPropertySetter(readString),\n        'ServiceType': makeObjectPropertySetter(readString)\n      });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst SERVICE_PROVIDER_PARSERS =\n    makeStructureNS(\n      NAMESPACE_URIS, {\n        'ProviderName': makeObjectPropertySetter(readString),\n        'ProviderSite': makeObjectPropertySetter(readHref),\n        'ServiceContact': makeObjectPropertySetter(readServiceContact)\n      });\n\n\n/**\n * @inheritDoc\n */\nOWS.prototype.readFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readFromNode(n);\n    }\n  }\n  return null;\n};\n\n\n/**\n * @inheritDoc\n */\nOWS.prototype.readFromNode = function(node) {\n  const owsObject = pushParseAndPop({},\n    PARSERS, node, []);\n  return owsObject ? owsObject : null;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The address.\n */\nfunction readAddress(node, objectStack) {\n  return pushParseAndPop({},\n    ADDRESS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The values.\n */\nfunction readAllowedValues(node, objectStack) {\n  return pushParseAndPop({},\n    ALLOWED_VALUES_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The constraint.\n */\nfunction readConstraint(node, objectStack) {\n  const name = node.getAttribute('name');\n  if (!name) {\n    return undefined;\n  }\n  return pushParseAndPop({'name': name},\n    CONSTRAINT_PARSERS, node,\n    objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The contact info.\n */\nfunction readContactInfo(node, objectStack) {\n  return pushParseAndPop({},\n    CONTACT_INFO_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The DCP.\n */\nfunction readDcp(node, objectStack) {\n  return pushParseAndPop({},\n    DCP_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The GET object.\n */\nfunction readGet(node, objectStack) {\n  const href = readHref(node);\n  if (!href) {\n    return undefined;\n  }\n  return pushParseAndPop({'href': href},\n    REQUEST_METHOD_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The HTTP object.\n */\nfunction readHttp(node, objectStack) {\n  return pushParseAndPop({}, HTTP_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The operation.\n */\nfunction readOperation(node, objectStack) {\n  const name = node.getAttribute('name');\n  const value = pushParseAndPop({},\n    OPERATION_PARSERS, node, objectStack);\n  if (!value) {\n    return undefined;\n  }\n  const object = /** @type {Object} */\n      (objectStack[objectStack.length - 1]);\n  object[name] = value;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The operations metadata.\n */\nfunction readOperationsMetadata(node, objectStack) {\n  return pushParseAndPop({},\n    OPERATIONS_METADATA_PARSERS, node,\n    objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The phone.\n */\nfunction readPhone(node, objectStack) {\n  return pushParseAndPop({},\n    PHONE_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The service identification.\n */\nfunction readServiceIdentification(node, objectStack) {\n  return pushParseAndPop(\n    {}, SERVICE_IDENTIFICATION_PARSERS, node,\n    objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The service contact.\n */\nfunction readServiceContact(node, objectStack) {\n  return pushParseAndPop(\n    {}, SERVICE_CONTACT_PARSERS, node,\n    objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} The service provider.\n */\nfunction readServiceProvider(node, objectStack) {\n  return pushParseAndPop(\n    {}, SERVICE_PROVIDER_PARSERS, node,\n    objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {string|undefined} The value.\n */\nfunction readValue(node, objectStack) {\n  return readString(node);\n}\n\n\nexport default OWS;\n","/**\n * @module ol/format/WMTSCapabilities\n */\nimport {inherits} from '../util.js';\nimport {boundingExtent} from '../extent.js';\nimport OWS from '../format/OWS.js';\nimport {readHref} from '../format/XLink.js';\nimport XML from '../format/XML.js';\nimport {readString, readNonNegativeInteger, readDecimal} from '../format/xsd.js';\nimport {pushParseAndPop, makeStructureNS,\n  makeObjectPropertySetter, makeObjectPropertyPusher, makeArrayPusher} from '../xml.js';\n\n/**\n * @classdesc\n * Format for reading WMTS capabilities data.\n *\n * @constructor\n * @extends {module:ol/format/XML}\n * @api\n */\nconst WMTSCapabilities = function() {\n  XML.call(this);\n\n  /**\n   * @type {module:ol/format/OWS}\n   * @private\n   */\n  this.owsParser_ = new OWS();\n};\n\ninherits(WMTSCapabilities, XML);\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst NAMESPACE_URIS = [\n  null,\n  'http://www.opengis.net/wmts/1.0'\n];\n\n\n/**\n * @const\n * @type {Array.<null|string>}\n */\nconst OWS_NAMESPACE_URIS = [\n  null,\n  'http://www.opengis.net/ows/1.1'\n];\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Contents': makeObjectPropertySetter(readContents)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst CONTENTS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Layer': makeObjectPropertyPusher(readLayer),\n    'TileMatrixSet': makeObjectPropertyPusher(readTileMatrixSet)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst LAYER_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Style': makeObjectPropertyPusher(readStyle),\n    'Format': makeObjectPropertyPusher(readString),\n    'TileMatrixSetLink': makeObjectPropertyPusher(readTileMatrixSetLink),\n    'Dimension': makeObjectPropertyPusher(readDimensions),\n    'ResourceURL': makeObjectPropertyPusher(readResourceUrl)\n  }, makeStructureNS(OWS_NAMESPACE_URIS, {\n    'Title': makeObjectPropertySetter(readString),\n    'Abstract': makeObjectPropertySetter(readString),\n    'WGS84BoundingBox': makeObjectPropertySetter(readWgs84BoundingBox),\n    'Identifier': makeObjectPropertySetter(readString)\n  }));\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst STYLE_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'LegendURL': makeObjectPropertyPusher(readLegendUrl)\n  }, makeStructureNS(OWS_NAMESPACE_URIS, {\n    'Title': makeObjectPropertySetter(readString),\n    'Identifier': makeObjectPropertySetter(readString)\n  }));\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TMS_LINKS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'TileMatrixSet': makeObjectPropertySetter(readString),\n    'TileMatrixSetLimits': makeObjectPropertySetter(readTileMatrixLimitsList)\n  });\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TMS_LIMITS_LIST_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'TileMatrixLimits': makeArrayPusher(readTileMatrixLimits)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TMS_LIMITS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'TileMatrix': makeObjectPropertySetter(readString),\n    'MinTileRow': makeObjectPropertySetter(readNonNegativeInteger),\n    'MaxTileRow': makeObjectPropertySetter(readNonNegativeInteger),\n    'MinTileCol': makeObjectPropertySetter(readNonNegativeInteger),\n    'MaxTileCol': makeObjectPropertySetter(readNonNegativeInteger)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst DIMENSION_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'Default': makeObjectPropertySetter(readString),\n    'Value': makeObjectPropertyPusher(readString)\n  }, makeStructureNS(OWS_NAMESPACE_URIS, {\n    'Identifier': makeObjectPropertySetter(readString)\n  }));\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst WGS84_BBOX_READERS = makeStructureNS(\n  OWS_NAMESPACE_URIS, {\n    'LowerCorner': makeArrayPusher(readCoordinates),\n    'UpperCorner': makeArrayPusher(readCoordinates)\n  });\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TMS_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'WellKnownScaleSet': makeObjectPropertySetter(readString),\n    'TileMatrix': makeObjectPropertyPusher(readTileMatrix)\n  }, makeStructureNS(OWS_NAMESPACE_URIS, {\n    'SupportedCRS': makeObjectPropertySetter(readString),\n    'Identifier': makeObjectPropertySetter(readString)\n  }));\n\n\n/**\n * @const\n * @type {Object.<string, Object.<string, module:ol/xml~Parser>>}\n */\nconst TM_PARSERS = makeStructureNS(\n  NAMESPACE_URIS, {\n    'TopLeftCorner': makeObjectPropertySetter(readCoordinates),\n    'ScaleDenominator': makeObjectPropertySetter(readDecimal),\n    'TileWidth': makeObjectPropertySetter(readNonNegativeInteger),\n    'TileHeight': makeObjectPropertySetter(readNonNegativeInteger),\n    'MatrixWidth': makeObjectPropertySetter(readNonNegativeInteger),\n    'MatrixHeight': makeObjectPropertySetter(readNonNegativeInteger)\n  }, makeStructureNS(OWS_NAMESPACE_URIS, {\n    'Identifier': makeObjectPropertySetter(readString)\n  }));\n\n\n/**\n * Read a WMTS capabilities document.\n *\n * @function\n * @param {Document|Node|string} source The XML source.\n * @return {Object} An object representing the WMTS capabilities.\n * @api\n */\nWMTSCapabilities.prototype.read;\n\n\n/**\n * @inheritDoc\n */\nWMTSCapabilities.prototype.readFromDocument = function(doc) {\n  for (let n = doc.firstChild; n; n = n.nextSibling) {\n    if (n.nodeType == Node.ELEMENT_NODE) {\n      return this.readFromNode(n);\n    }\n  }\n  return null;\n};\n\n\n/**\n * @inheritDoc\n */\nWMTSCapabilities.prototype.readFromNode = function(node) {\n  const version = node.getAttribute('version').trim();\n  let WMTSCapabilityObject = this.owsParser_.readFromNode(node);\n  if (!WMTSCapabilityObject) {\n    return null;\n  }\n  WMTSCapabilityObject['version'] = version;\n  WMTSCapabilityObject = pushParseAndPop(WMTSCapabilityObject, PARSERS, node, []);\n  return WMTSCapabilityObject ? WMTSCapabilityObject : null;\n};\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Attribution object.\n */\nfunction readContents(node, objectStack) {\n  return pushParseAndPop({}, CONTENTS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Layers object.\n */\nfunction readLayer(node, objectStack) {\n  return pushParseAndPop({}, LAYER_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Tile Matrix Set object.\n */\nfunction readTileMatrixSet(node, objectStack) {\n  return pushParseAndPop({}, TMS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Style object.\n */\nfunction readStyle(node, objectStack) {\n  const style = pushParseAndPop({}, STYLE_PARSERS, node, objectStack);\n  if (!style) {\n    return undefined;\n  }\n  const isDefault = node.getAttribute('isDefault') === 'true';\n  style['isDefault'] = isDefault;\n  return style;\n\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Tile Matrix Set Link object.\n */\nfunction readTileMatrixSetLink(node, objectStack) {\n  return pushParseAndPop({}, TMS_LINKS_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Dimension object.\n */\nfunction readDimensions(node, objectStack) {\n  return pushParseAndPop({}, DIMENSION_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Resource URL object.\n */\nfunction readResourceUrl(node, objectStack) {\n  const format = node.getAttribute('format');\n  const template = node.getAttribute('template');\n  const resourceType = node.getAttribute('resourceType');\n  const resource = {};\n  if (format) {\n    resource['format'] = format;\n  }\n  if (template) {\n    resource['template'] = template;\n  }\n  if (resourceType) {\n    resource['resourceType'] = resourceType;\n  }\n  return resource;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} WGS84 BBox object.\n */\nfunction readWgs84BoundingBox(node, objectStack) {\n  const coordinates = pushParseAndPop([], WGS84_BBOX_READERS, node, objectStack);\n  if (coordinates.length != 2) {\n    return undefined;\n  }\n  return boundingExtent(coordinates);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Legend object.\n */\nfunction readLegendUrl(node, objectStack) {\n  const legend = {};\n  legend['format'] = node.getAttribute('format');\n  legend['href'] = readHref(node);\n  return legend;\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} Coordinates object.\n */\nfunction readCoordinates(node, objectStack) {\n  const coordinates = readString(node).split(' ');\n  if (!coordinates || coordinates.length != 2) {\n    return undefined;\n  }\n  const x = +coordinates[0];\n  const y = +coordinates[1];\n  if (isNaN(x) || isNaN(y)) {\n    return undefined;\n  }\n  return [x, y];\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} TileMatrix object.\n */\nfunction readTileMatrix(node, objectStack) {\n  return pushParseAndPop({}, TM_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} TileMatrixSetLimits Object.\n */\nfunction readTileMatrixLimitsList(node, objectStack) {\n  return pushParseAndPop([], TMS_LIMITS_LIST_PARSERS, node, objectStack);\n}\n\n\n/**\n * @param {Node} node Node.\n * @param {Array.<*>} objectStack Object stack.\n * @return {Object|undefined} TileMatrixLimits Array.\n */\nfunction readTileMatrixLimits(node, objectStack) {\n  return pushParseAndPop({}, TMS_LIMITS_PARSERS, node, objectStack);\n}\n\n\nexport default WMTSCapabilities;\n","/**\n * @module ol/layer/Heatmap\n */\nimport {listen} from '../events.js';\nimport {inherits} from '../util.js';\nimport {getChangeEventType} from '../Object.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport VectorLayer from '../layer/Vector.js';\nimport {clamp} from '../math.js';\nimport {assign} from '../obj.js';\nimport RenderEventType from '../render/EventType.js';\nimport Icon from '../style/Icon.js';\nimport Style from '../style/Style.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {Array.<string>} [gradient=['#00f', '#0ff', '#0f0', '#ff0', '#f00']] The color gradient\n * of the heatmap, specified as an array of CSS color strings.\n * @property {number} [radius=8] Radius size in pixels.\n * @property {number} [blur=15] Blur size in pixels.\n * @property {number} [shadow=250] Shadow size in pixels.\n * @property {string|function(module:ol/Feature):number} [weight='weight'] The feature\n * attribute to use for the weight or a function that returns a weight from a feature. Weight values\n * should range from 0 to 1 (and values outside will be clamped to that range).\n * @property {module:ol/source/Vector} [source] Source.\n */\n\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  BLUR: 'blur',\n  GRADIENT: 'gradient',\n  RADIUS: 'radius'\n};\n\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst DEFAULT_GRADIENT = ['#00f', '#0ff', '#0f0', '#ff0', '#f00'];\n\n\n/**\n * @classdesc\n * Layer for rendering vector data as a heatmap.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @constructor\n * @extends {module:ol/layer/Vector}\n * @fires module:ol/render/Event~RenderEvent\n * @param {module:ol/layer/Heatmap~Options=} opt_options Options.\n * @api\n */\nconst Heatmap = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  const baseOptions = assign({}, options);\n\n  delete baseOptions.gradient;\n  delete baseOptions.radius;\n  delete baseOptions.blur;\n  delete baseOptions.shadow;\n  delete baseOptions.weight;\n  VectorLayer.call(this, /** @type {module:ol/layer/Vector~Options} */ (baseOptions));\n\n  /**\n   * @private\n   * @type {Uint8ClampedArray}\n   */\n  this.gradient_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.shadow_ = options.shadow !== undefined ? options.shadow : 250;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.circleImage_ = undefined;\n\n  /**\n   * @private\n   * @type {Array.<Array.<module:ol/style/Style>>}\n   */\n  this.styleCache_ = null;\n\n  listen(this,\n    getChangeEventType(Property.GRADIENT),\n    this.handleGradientChanged_, this);\n\n  this.setGradient(options.gradient ? options.gradient : DEFAULT_GRADIENT);\n\n  this.setBlur(options.blur !== undefined ? options.blur : 15);\n\n  this.setRadius(options.radius !== undefined ? options.radius : 8);\n\n  listen(this,\n    getChangeEventType(Property.BLUR),\n    this.handleStyleChanged_, this);\n  listen(this,\n    getChangeEventType(Property.RADIUS),\n    this.handleStyleChanged_, this);\n\n  this.handleStyleChanged_();\n\n  const weight = options.weight ? options.weight : 'weight';\n  let weightFunction;\n  if (typeof weight === 'string') {\n    weightFunction = function(feature) {\n      return feature.get(weight);\n    };\n  } else {\n    weightFunction = weight;\n  }\n\n  this.setStyle(function(feature, resolution) {\n    const weight = weightFunction(feature);\n    const opacity = weight !== undefined ? clamp(weight, 0, 1) : 1;\n    // cast to 8 bits\n    const index = (255 * opacity) | 0;\n    let style = this.styleCache_[index];\n    if (!style) {\n      style = [\n        new Style({\n          image: new Icon({\n            opacity: opacity,\n            src: this.circleImage_\n          })\n        })\n      ];\n      this.styleCache_[index] = style;\n    }\n    return style;\n  }.bind(this));\n\n  // For performance reasons, don't sort the features before rendering.\n  // The render order is not relevant for a heatmap representation.\n  this.setRenderOrder(null);\n\n  listen(this, RenderEventType.RENDER, this.handleRender_, this);\n};\n\ninherits(Heatmap, VectorLayer);\n\n\n/**\n * @param {Array.<string>} colors A list of colored.\n * @return {Uint8ClampedArray} An array.\n * @private\n */\nconst createGradient = function(colors) {\n  const width = 1;\n  const height = 256;\n  const context = createCanvasContext2D(width, height);\n\n  const gradient = context.createLinearGradient(0, 0, width, height);\n  const step = 1 / (colors.length - 1);\n  for (let i = 0, ii = colors.length; i < ii; ++i) {\n    gradient.addColorStop(i * step, colors[i]);\n  }\n\n  context.fillStyle = gradient;\n  context.fillRect(0, 0, width, height);\n\n  return context.getImageData(0, 0, width, height).data;\n};\n\n\n/**\n * @return {string} Data URL for a circle.\n * @private\n */\nHeatmap.prototype.createCircle_ = function() {\n  const radius = this.getRadius();\n  const blur = this.getBlur();\n  const halfSize = radius + blur + 1;\n  const size = 2 * halfSize;\n  const context = createCanvasContext2D(size, size);\n  context.shadowOffsetX = context.shadowOffsetY = this.shadow_;\n  context.shadowBlur = blur;\n  context.shadowColor = '#000';\n  context.beginPath();\n  const center = halfSize - this.shadow_;\n  context.arc(center, center, radius, 0, Math.PI * 2, true);\n  context.fill();\n  return context.canvas.toDataURL();\n};\n\n\n/**\n * Return the blur size in pixels.\n * @return {number} Blur size in pixels.\n * @api\n * @observable\n */\nHeatmap.prototype.getBlur = function() {\n  return /** @type {number} */ (this.get(Property.BLUR));\n};\n\n\n/**\n * Return the gradient colors as array of strings.\n * @return {Array.<string>} Colors.\n * @api\n * @observable\n */\nHeatmap.prototype.getGradient = function() {\n  return /** @type {Array.<string>} */ (this.get(Property.GRADIENT));\n};\n\n\n/**\n * Return the size of the radius in pixels.\n * @return {number} Radius size in pixel.\n * @api\n * @observable\n */\nHeatmap.prototype.getRadius = function() {\n  return /** @type {number} */ (this.get(Property.RADIUS));\n};\n\n\n/**\n * @private\n */\nHeatmap.prototype.handleGradientChanged_ = function() {\n  this.gradient_ = createGradient(this.getGradient());\n};\n\n\n/**\n * @private\n */\nHeatmap.prototype.handleStyleChanged_ = function() {\n  this.circleImage_ = this.createCircle_();\n  this.styleCache_ = new Array(256);\n  this.changed();\n};\n\n\n/**\n * @param {module:ol/render/Event} event Post compose event\n * @private\n */\nHeatmap.prototype.handleRender_ = function(event) {\n  const context = event.context;\n  const canvas = context.canvas;\n  const image = context.getImageData(0, 0, canvas.width, canvas.height);\n  const view8 = image.data;\n  for (let i = 0, ii = view8.length; i < ii; i += 4) {\n    const alpha = view8[i + 3] * 4;\n    if (alpha) {\n      view8[i] = this.gradient_[alpha];\n      view8[i + 1] = this.gradient_[alpha + 1];\n      view8[i + 2] = this.gradient_[alpha + 2];\n    }\n  }\n  context.putImageData(image, 0, 0);\n};\n\n\n/**\n * Set the blur size in pixels.\n * @param {number} blur Blur size in pixels.\n * @api\n * @observable\n */\nHeatmap.prototype.setBlur = function(blur) {\n  this.set(Property.BLUR, blur);\n};\n\n\n/**\n * Set the gradient colors as array of strings.\n * @param {Array.<string>} colors Gradient.\n * @api\n * @observable\n */\nHeatmap.prototype.setGradient = function(colors) {\n  this.set(Property.GRADIENT, colors);\n};\n\n\n/**\n * Set the size of the radius in pixels.\n * @param {number} radius Radius size in pixel.\n * @api\n * @observable\n */\nHeatmap.prototype.setRadius = function(radius) {\n  this.set(Property.RADIUS, radius);\n};\n\nexport default Heatmap;\n","/**\n * @module ol/layer/Image\n */\nimport {inherits} from '../util.js';\nimport LayerType from '../LayerType.js';\nimport Layer from '../layer/Layer.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {module:ol/PluggableMap} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map#addLayer}.\n * @property {module:ol/source/Image} [source] Source for this layer.\n */\n\n\n/**\n * @classdesc\n * Server-rendered images that are available for arbitrary extents and\n * resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @constructor\n * @extends {module:ol/layer/Layer}\n * @fires module:ol/render/Event~RenderEvent\n * @param {module:ol/layer/Image~Options=} opt_options Layer options.\n * @api\n */\nconst ImageLayer = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n  Layer.call(this,  /** @type {module:ol/layer/Layer~Options} */ (options));\n\n  /**\n   * The layer type.\n   * @protected\n   * @type {module:ol/LayerType}\n   */\n  this.type = LayerType.IMAGE;\n\n};\n\ninherits(ImageLayer, Layer);\n\n\n/**\n * Return the associated {@link module:ol/source/Image source} of the image layer.\n * @function\n * @return {module:ol/source/Image} Source.\n * @api\n */\nImageLayer.prototype.getSource;\nexport default ImageLayer;\n","/**\n * @module ol/layer/TileProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  PRELOAD: 'preload',\n  USE_INTERIM_TILES_ON_ERROR: 'useInterimTilesOnError'\n};\n","/**\n * @module ol/layer/Tile\n */\nimport {inherits} from '../util.js';\nimport LayerType from '../LayerType.js';\nimport Layer from '../layer/Layer.js';\nimport TileProperty from '../layer/TileProperty.js';\nimport {assign} from '../obj.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {module:ol/source/Tile} [source] Source for this layer.\n * @property {module:ol/PluggableMap} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map#addLayer}.\n * @property {boolean} [useInterimTilesOnError=true] Use interim tiles on error.\n */\n\n\n/**\n * @classdesc\n * For layer sources that provide pre-rendered, tiled images in grids that are\n * organized by zoom levels for specific resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @constructor\n * @extends {module:ol/layer/Layer}\n * @fires module:ol/render/Event~RenderEvent\n * @param {module:ol/layer/Tile~Options=} opt_options Tile layer options.\n * @api\n */\nconst TileLayer = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  const baseOptions = assign({}, options);\n\n  delete baseOptions.preload;\n  delete baseOptions.useInterimTilesOnError;\n  Layer.call(this,  /** @type {module:ol/layer/Layer~Options} */ (baseOptions));\n\n  this.setPreload(options.preload !== undefined ? options.preload : 0);\n  this.setUseInterimTilesOnError(options.useInterimTilesOnError !== undefined ?\n    options.useInterimTilesOnError : true);\n\n  /**\n   * The layer type.\n   * @protected\n   * @type {module:ol/LayerType}\n   */\n  this.type = LayerType.TILE;\n\n};\n\ninherits(TileLayer, Layer);\n\n\n/**\n * Return the level as number to which we will preload tiles up to.\n * @return {number} The level to preload tiles up to.\n * @observable\n * @api\n */\nTileLayer.prototype.getPreload = function() {\n  return /** @type {number} */ (this.get(TileProperty.PRELOAD));\n};\n\n\n/**\n * Return the associated {@link module:ol/source/Tile tilesource} of the layer.\n * @function\n * @return {module:ol/source/Tile} Source.\n * @api\n */\nTileLayer.prototype.getSource;\n\n\n/**\n * Set the level as number to which we will preload tiles up to.\n * @param {number} preload The level to preload tiles up to.\n * @observable\n * @api\n */\nTileLayer.prototype.setPreload = function(preload) {\n  this.set(TileProperty.PRELOAD, preload);\n};\n\n\n/**\n * Whether we use interim tiles on error.\n * @return {boolean} Use interim tiles on error.\n * @observable\n * @api\n */\nTileLayer.prototype.getUseInterimTilesOnError = function() {\n  return /** @type {boolean} */ (this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR));\n};\n\n\n/**\n * Set whether we use interim tiles on error.\n * @param {boolean} useInterimTilesOnError Use interim tiles on error.\n * @observable\n * @api\n */\nTileLayer.prototype.setUseInterimTilesOnError = function(useInterimTilesOnError) {\n  this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR, useInterimTilesOnError);\n};\nexport default TileLayer;\n","/**\n * @module ol/layer/VectorTile\n */\nimport {inherits} from '../util.js';\nimport LayerType from '../LayerType.js';\nimport {assert} from '../asserts.js';\nimport TileProperty from '../layer/TileProperty.js';\nimport VectorLayer from '../layer/Vector.js';\nimport VectorTileRenderType from '../layer/VectorTileRenderType.js';\nimport {assign} from '../obj.js';\n\n\n/**\n * @enum {string}\n * Render mode for vector tiles:\n *  * `'image'`: Vector tiles are rendered as images. Great performance, but\n *    point symbols and texts are always rotated with the view and pixels are\n *    scaled during zoom animations.\n *  * `'hybrid'`: Polygon and line elements are rendered as images, so pixels\n *    are scaled during zoom animations. Point symbols and texts are accurately\n *    rendered as vectors and can stay upright on rotated views.\n *  * `'vector'`: Vector tiles are rendered as vectors. Most accurate rendering\n *    even during animations, but slower performance than the other options.\n * @api\n */\nexport const RenderType = {\n  IMAGE: 'image',\n  HYBRID: 'hybrid',\n  VECTOR: 'vector'\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {module:ol/render~OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created. Use\n * `null` to avoid the sort, but get an undefined draw order.\n * @property {number} [renderBuffer=100] The buffer in pixels around the tile extent used by the\n * renderer when getting features from the vector tile for the rendering or hit-detection.\n * Recommended value: Vector tiles are usually generated with a buffer, so this value should match\n * the largest possible buffer of the used tiles. It should be at least the size of the largest\n * point symbol or line width.\n * @property {module:ol/layer/VectorTileRenderType|string} [renderMode='hybrid'] Render mode for vector tiles:\n *  * `'image'`: Vector tiles are rendered as images. Great performance, but point symbols and texts\n *    are always rotated with the view and pixels are scaled during zoom animations.\n *  * `'hybrid'`: Polygon and line elements are rendered as images, so pixels are scaled during zoom\n *    animations. Point symbols and texts are accurately rendered as vectors and can stay upright on\n *    rotated views.\n *  * `'vector'`: Vector tiles are rendered as vectors. Most accurate rendering even during\n *    animations, but slower performance than the other options.\n *\n * When `declutter` is set to `true`, `'hybrid'` will be used instead of `'image'`.\n * @property {module:ol/source/VectorTile} [source] Source.\n * @property {module:ol/PluggableMap} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map#addLayer}.\n * @property {boolean} [declutter=false] Declutter images and text. Decluttering is applied to all\n * image and text styles, and the priority is defined by the z-index of the style. Lower z-index\n * means higher priority. When set to `true`, a `renderMode` of `'image'` will be overridden with\n * `'hybrid'`.\n * @property {module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction} [style] Layer style. See\n * {@link module:ol/style} for default style which will be used if this is not defined.\n * @property {boolean} [updateWhileAnimating=false] When set to `true`, feature batches will be\n * recreated during animations. This means that no vectors will be shown clipped, but the setting\n * will have a performance impact for large amounts of vector data. When set to `false`, batches\n * will be recreated when no animation is active.\n * @property {boolean} [updateWhileInteracting=false] When set to `true`, feature batches will be\n * recreated during interactions. See also `updateWhileAnimating`.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {module:ol/render~OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created.\n * @property {(module:ol/style/Style|Array.<module:ol/style/Style>|module:ol/style/Style~StyleFunction)} [style] Layer style. See\n * {@link module:ol/style} for default style which will be used if this is not defined.\n * @property {boolean} [useInterimTilesOnError=true] Use interim tiles on error.\n */\n\n\n/**\n * @classdesc\n * Layer for vector tile data that is rendered client-side.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @constructor\n * @extends {module:ol/layer/Vector}\n * @param {module:ol/layer/VectorTile~Options=} opt_options Options.\n * @api\n */\nconst VectorTileLayer = function(opt_options) {\n  const options = opt_options ? opt_options : {};\n\n  let renderMode = options.renderMode || VectorTileRenderType.HYBRID;\n  assert(renderMode == undefined ||\n      renderMode == VectorTileRenderType.IMAGE ||\n      renderMode == VectorTileRenderType.HYBRID ||\n      renderMode == VectorTileRenderType.VECTOR,\n  28); // `renderMode` must be `'image'`, `'hybrid'` or `'vector'`\n  if (options.declutter && renderMode == VectorTileRenderType.IMAGE) {\n    renderMode = VectorTileRenderType.HYBRID;\n  }\n  options.renderMode = renderMode;\n\n  const baseOptions = assign({}, options);\n\n  delete baseOptions.preload;\n  delete baseOptions.useInterimTilesOnError;\n  VectorLayer.call(this,  /** @type {module:ol/layer/Vector~Options} */ (baseOptions));\n\n  this.setPreload(options.preload ? options.preload : 0);\n  this.setUseInterimTilesOnError(options.useInterimTilesOnError !== undefined ?\n    options.useInterimTilesOnError : true);\n\n  /**\n   * The layer type.\n   * @protected\n   * @type {module:ol/LayerType}\n   */\n  this.type = LayerType.VECTOR_TILE;\n\n};\n\ninherits(VectorTileLayer, VectorLayer);\n\n\n/**\n * Return the level as number to which we will preload tiles up to.\n * @return {number} The level to preload tiles up to.\n * @observable\n * @api\n */\nVectorTileLayer.prototype.getPreload = function() {\n  return /** @type {number} */ (this.get(TileProperty.PRELOAD));\n};\n\n\n/**\n * Whether we use interim tiles on error.\n * @return {boolean} Use interim tiles on error.\n * @observable\n * @api\n */\nVectorTileLayer.prototype.getUseInterimTilesOnError = function() {\n  return /** @type {boolean} */ (this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR));\n};\n\n\n/**\n * Set the level as number to which we will preload tiles up to.\n * @param {number} preload The level to preload tiles up to.\n * @observable\n * @api\n */\nVectorTileLayer.prototype.setPreload = function(preload) {\n  this.set(TileProperty.PRELOAD, preload);\n};\n\n\n/**\n * Set whether we use interim tiles on error.\n * @param {boolean} useInterimTilesOnError Use interim tiles on error.\n * @observable\n * @api\n */\nVectorTileLayer.prototype.setUseInterimTilesOnError = function(useInterimTilesOnError) {\n  this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR, useInterimTilesOnError);\n};\n\n\n/**\n * Return the associated {@link module:ol/source/VectorTile vectortilesource} of the layer.\n * @function\n * @return {module:ol/source/VectorTile} Source.\n * @api\n */\nVectorTileLayer.prototype.getSource;\nexport default VectorTileLayer;\n","/**\n * @module ol/tilecoord\n */\n\n\n/**\n * An array of three numbers representing the location of a tile in a tile\n * grid. The order is `z`, `x`, and `y`. `z` is the zoom level.\n * @typedef {Array.<number>} TileCoord\n * @api\n */\n\n\n/**\n * @param {number} z Z.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {module:ol/tilecoord~TileCoord=} opt_tileCoord Tile coordinate.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n */\nexport function createOrUpdate(z, x, y, opt_tileCoord) {\n  if (opt_tileCoord !== undefined) {\n    opt_tileCoord[0] = z;\n    opt_tileCoord[1] = x;\n    opt_tileCoord[2] = y;\n    return opt_tileCoord;\n  } else {\n    return [z, x, y];\n  }\n}\n\n\n/**\n * @param {number} z Z.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {string} Key.\n */\nexport function getKeyZXY(z, x, y) {\n  return z + '/' + x + '/' + y;\n}\n\n\n/**\n * Get the key for a tile coord.\n * @param {module:ol/tilecoord~TileCoord} tileCoord The tile coord.\n * @return {string} Key.\n */\nexport function getKey(tileCoord) {\n  return getKeyZXY(tileCoord[0], tileCoord[1], tileCoord[2]);\n}\n\n\n/**\n * Get a tile coord given a key.\n * @param {string} key The tile coord key.\n * @return {module:ol/tilecoord~TileCoord} The tile coord.\n */\nexport function fromKey(key) {\n  return key.split('/').map(Number);\n}\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coord.\n * @return {number} Hash.\n */\nexport function hash(tileCoord) {\n  return (tileCoord[1] << tileCoord[0]) + tileCoord[2];\n}\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coord.\n * @return {string} Quad key.\n */\nexport function quadKey(tileCoord) {\n  const z = tileCoord[0];\n  const digits = new Array(z);\n  let mask = 1 << (z - 1);\n  let i, charCode;\n  for (i = 0; i < z; ++i) {\n    // 48 is charCode for 0 - '0'.charCodeAt(0)\n    charCode = 48;\n    if (tileCoord[1] & mask) {\n      charCode += 1;\n    }\n    if (tileCoord[2] & mask) {\n      charCode += 2;\n    }\n    digits[i] = String.fromCharCode(charCode);\n    mask >>= 1;\n  }\n  return digits.join('');\n}\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {!module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @return {boolean} Tile coordinate is within extent and zoom level range.\n */\nexport function withinExtentAndZ(tileCoord, tileGrid) {\n  const z = tileCoord[0];\n  const x = tileCoord[1];\n  const y = tileCoord[2];\n\n  if (tileGrid.getMinZoom() > z || z > tileGrid.getMaxZoom()) {\n    return false;\n  }\n  const extent = tileGrid.getExtent();\n  let tileRange;\n  if (!extent) {\n    tileRange = tileGrid.getFullTileRange(z);\n  } else {\n    tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n  }\n  if (!tileRange) {\n    return true;\n  } else {\n    return tileRange.containsXY(x, y);\n  }\n}\n","/**\n * @module ol/tileurlfunction\n */\nimport {assert} from './asserts.js';\nimport {modulo} from './math.js';\nimport {hash as tileCoordHash} from './tilecoord.js';\n\n\n/**\n * @param {string} template Template.\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\n */\nexport function createFromTemplate(template, tileGrid) {\n  const zRegEx = /\\{z\\}/g;\n  const xRegEx = /\\{x\\}/g;\n  const yRegEx = /\\{y\\}/g;\n  const dashYRegEx = /\\{-y\\}/g;\n  return (\n    /**\n     * @param {module:ol/tilecoord~TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {module:ol/proj/Projection} projection Projection.\n     * @return {string|undefined} Tile URL.\n     */\n    function(tileCoord, pixelRatio, projection) {\n      if (!tileCoord) {\n        return undefined;\n      } else {\n        return template.replace(zRegEx, tileCoord[0].toString())\n          .replace(xRegEx, tileCoord[1].toString())\n          .replace(yRegEx, function() {\n            const y = -tileCoord[2] - 1;\n            return y.toString();\n          })\n          .replace(dashYRegEx, function() {\n            const z = tileCoord[0];\n            const range = tileGrid.getFullTileRange(z);\n            assert(range, 55); // The {-y} placeholder requires a tile grid with extent\n            const y = range.getHeight() + tileCoord[2];\n            return y.toString();\n          });\n      }\n    }\n  );\n}\n\n\n/**\n * @param {Array.<string>} templates Templates.\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\n */\nexport function createFromTemplates(templates, tileGrid) {\n  const len = templates.length;\n  const tileUrlFunctions = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    tileUrlFunctions[i] = createFromTemplate(templates[i], tileGrid);\n  }\n  return createFromTileUrlFunctions(tileUrlFunctions);\n}\n\n\n/**\n * @param {Array.<module:ol/Tile~UrlFunction>} tileUrlFunctions Tile URL Functions.\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\n */\nexport function createFromTileUrlFunctions(tileUrlFunctions) {\n  if (tileUrlFunctions.length === 1) {\n    return tileUrlFunctions[0];\n  }\n  return (\n    /**\n     * @param {module:ol/tilecoord~TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {module:ol/proj/Projection} projection Projection.\n     * @return {string|undefined} Tile URL.\n     */\n    function(tileCoord, pixelRatio, projection) {\n      if (!tileCoord) {\n        return undefined;\n      } else {\n        const h = tileCoordHash(tileCoord);\n        const index = modulo(h, tileUrlFunctions.length);\n        return tileUrlFunctions[index](tileCoord, pixelRatio, projection);\n      }\n    }\n  );\n}\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {string|undefined} Tile URL.\n */\nexport function nullTileUrlFunction(tileCoord, pixelRatio, projection) {\n  return undefined;\n}\n\n\n/**\n * @param {string} url URL.\n * @return {Array.<string>} Array of urls.\n */\nexport function expandUrl(url) {\n  const urls = [];\n  let match = /\\{([a-z])-([a-z])\\}/.exec(url);\n  if (match) {\n    // char range\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      urls.push(url.replace(match[0], String.fromCharCode(charCode)));\n    }\n    return urls;\n  }\n  match = match = /\\{(\\d+)-(\\d+)\\}/.exec(url);\n  if (match) {\n    // number range\n    const stop = parseInt(match[2], 10);\n    for (let i = parseInt(match[1], 10); i <= stop; i++) {\n      urls.push(url.replace(match[0], i.toString()));\n    }\n    return urls;\n  }\n  urls.push(url);\n  return urls;\n}\n","/**\n * @module ol/net\n */\nimport {getUid} from './util.js';\n\n\n/**\n * Simple JSONP helper. Supports error callbacks and a custom callback param.\n * The error callback will be called when no JSONP is executed after 10 seconds.\n *\n * @param {string} url Request url. A 'callback' query parameter will be\n *     appended.\n * @param {Function} callback Callback on success.\n * @param {function()=} opt_errback Callback on error.\n * @param {string=} opt_callbackParam Custom query parameter for the JSONP\n *     callback. Default is 'callback'.\n */\nexport function jsonp(url, callback, opt_errback, opt_callbackParam) {\n  const script = document.createElement('script');\n  const key = 'olc_' + getUid(callback);\n  function cleanup() {\n    delete window[key];\n    script.parentNode.removeChild(script);\n  }\n  script.async = true;\n  script.src = url + (url.indexOf('?') == -1 ? '?' : '&') +\n      (opt_callbackParam || 'callback') + '=' + key;\n  const timer = setTimeout(function() {\n    cleanup();\n    if (opt_errback) {\n      opt_errback();\n    }\n  }, 10000);\n  window[key] = function(data) {\n    clearTimeout(timer);\n    cleanup();\n    callback(data);\n  };\n  document.getElementsByTagName('head')[0].appendChild(script);\n}\n","/**\n * @module ol/TileCache\n */\nimport {inherits} from './util.js';\nimport LRUCache from './structs/LRUCache.js';\nimport {fromKey, getKey} from './tilecoord.js';\n\n/**\n * @constructor\n * @extends {module:ol/structs/LRUCache.<module:ol/Tile>}\n * @param {number=} opt_highWaterMark High water mark.\n * @struct\n */\nconst TileCache = function(opt_highWaterMark) {\n\n  LRUCache.call(this, opt_highWaterMark);\n\n};\n\ninherits(TileCache, LRUCache);\n\n\n/**\n * @param {!Object.<string, module:ol/TileRange>} usedTiles Used tiles.\n */\nTileCache.prototype.expireCache = function(usedTiles) {\n  while (this.canExpireCache()) {\n    const tile = this.peekLast();\n    const zKey = tile.tileCoord[0].toString();\n    if (zKey in usedTiles && usedTiles[zKey].contains(tile.tileCoord)) {\n      break;\n    } else {\n      this.pop().dispose();\n    }\n  }\n};\n\n\n/**\n * Prune all tiles from the cache that don't have the same z as the newest tile.\n */\nTileCache.prototype.pruneExceptNewestZ = function() {\n  if (this.getCount() === 0) {\n    return;\n  }\n  const key = this.peekFirstKey();\n  const tileCoord = fromKey(key);\n  const z = tileCoord[0];\n  this.forEach(function(tile) {\n    if (tile.tileCoord[0] !== z) {\n      this.remove(getKey(tile.tileCoord));\n      tile.dispose();\n    }\n  }, this);\n};\nexport default TileCache;\n","/**\n * @module ol/reproj\n */\nimport {createCanvasContext2D} from './dom.js';\nimport {containsCoordinate, createEmpty, extend, getHeight, getTopLeft, getWidth} from './extent.js';\nimport {solveLinearSystem} from './math.js';\nimport {getPointResolution, transform} from './proj.js';\n\n\n/**\n * Calculates ideal resolution to use from the source in order to achieve\n * pixel mapping as close as possible to 1:1 during reprojection.\n * The resolution is calculated regardless of what resolutions\n * are actually available in the dataset (TileGrid, Image, ...).\n *\n * @param {module:ol/proj/Projection} sourceProj Source projection.\n * @param {module:ol/proj/Projection} targetProj Target projection.\n * @param {module:ol/coordinate~Coordinate} targetCenter Target center.\n * @param {number} targetResolution Target resolution.\n * @return {number} The best resolution to use. Can be +-Infinity, NaN or 0.\n */\nexport function calculateSourceResolution(sourceProj, targetProj,\n  targetCenter, targetResolution) {\n\n  const sourceCenter = transform(targetCenter, targetProj, sourceProj);\n\n  // calculate the ideal resolution of the source data\n  let sourceResolution = getPointResolution(targetProj, targetResolution, targetCenter);\n\n  const targetMetersPerUnit = targetProj.getMetersPerUnit();\n  if (targetMetersPerUnit !== undefined) {\n    sourceResolution *= targetMetersPerUnit;\n  }\n  const sourceMetersPerUnit = sourceProj.getMetersPerUnit();\n  if (sourceMetersPerUnit !== undefined) {\n    sourceResolution /= sourceMetersPerUnit;\n  }\n\n  // Based on the projection properties, the point resolution at the specified\n  // coordinates may be slightly different. We need to reverse-compensate this\n  // in order to achieve optimal results.\n\n  const sourceExtent = sourceProj.getExtent();\n  if (!sourceExtent || containsCoordinate(sourceExtent, sourceCenter)) {\n    const compensationFactor = getPointResolution(sourceProj, sourceResolution, sourceCenter) /\n        sourceResolution;\n    if (isFinite(compensationFactor) && compensationFactor > 0) {\n      sourceResolution /= compensationFactor;\n    }\n  }\n\n  return sourceResolution;\n}\n\n\n/**\n * Enlarge the clipping triangle point by 1 pixel to ensure the edges overlap\n * in order to mask gaps caused by antialiasing.\n *\n * @param {number} centroidX Centroid of the triangle (x coordinate in pixels).\n * @param {number} centroidY Centroid of the triangle (y coordinate in pixels).\n * @param {number} x X coordinate of the point (in pixels).\n * @param {number} y Y coordinate of the point (in pixels).\n * @return {module:ol/coordinate~Coordinate} New point 1 px farther from the centroid.\n */\nfunction enlargeClipPoint(centroidX, centroidY, x, y) {\n  const dX = x - centroidX;\n  const dY = y - centroidY;\n  const distance = Math.sqrt(dX * dX + dY * dY);\n  return [Math.round(x + dX / distance), Math.round(y + dY / distance)];\n}\n\n\n/**\n * Renders the source data into new canvas based on the triangulation.\n *\n * @param {number} width Width of the canvas.\n * @param {number} height Height of the canvas.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} sourceResolution Source resolution.\n * @param {module:ol/extent~Extent} sourceExtent Extent of the data source.\n * @param {number} targetResolution Target resolution.\n * @param {module:ol/extent~Extent} targetExtent Target extent.\n * @param {module:ol/reproj/Triangulation} triangulation\n * Calculated triangulation.\n * @param {Array.<{extent: module:ol/extent~Extent,\n *                 image: (HTMLCanvasElement|Image|HTMLVideoElement)}>} sources\n * Array of sources.\n * @param {number} gutter Gutter of the sources.\n * @param {boolean=} opt_renderEdges Render reprojection edges.\n * @return {HTMLCanvasElement} Canvas with reprojected data.\n */\nexport function render(width, height, pixelRatio,\n  sourceResolution, sourceExtent, targetResolution, targetExtent,\n  triangulation, sources, gutter, opt_renderEdges) {\n\n  const context = createCanvasContext2D(Math.round(pixelRatio * width),\n    Math.round(pixelRatio * height));\n\n  if (sources.length === 0) {\n    return context.canvas;\n  }\n\n  context.scale(pixelRatio, pixelRatio);\n\n  const sourceDataExtent = createEmpty();\n  sources.forEach(function(src, i, arr) {\n    extend(sourceDataExtent, src.extent);\n  });\n\n  const canvasWidthInUnits = getWidth(sourceDataExtent);\n  const canvasHeightInUnits = getHeight(sourceDataExtent);\n  const stitchContext = createCanvasContext2D(\n    Math.round(pixelRatio * canvasWidthInUnits / sourceResolution),\n    Math.round(pixelRatio * canvasHeightInUnits / sourceResolution));\n\n  const stitchScale = pixelRatio / sourceResolution;\n\n  sources.forEach(function(src, i, arr) {\n    const xPos = src.extent[0] - sourceDataExtent[0];\n    const yPos = -(src.extent[3] - sourceDataExtent[3]);\n    const srcWidth = getWidth(src.extent);\n    const srcHeight = getHeight(src.extent);\n\n    stitchContext.drawImage(\n      src.image,\n      gutter, gutter,\n      src.image.width - 2 * gutter, src.image.height - 2 * gutter,\n      xPos * stitchScale, yPos * stitchScale,\n      srcWidth * stitchScale, srcHeight * stitchScale);\n  });\n\n  const targetTopLeft = getTopLeft(targetExtent);\n\n  triangulation.getTriangles().forEach(function(triangle, i, arr) {\n    /* Calculate affine transform (src -> dst)\n     * Resulting matrix can be used to transform coordinate\n     * from `sourceProjection` to destination pixels.\n     *\n     * To optimize number of context calls and increase numerical stability,\n     * we also do the following operations:\n     * trans(-topLeftExtentCorner), scale(1 / targetResolution), scale(1, -1)\n     * here before solving the linear system so [ui, vi] are pixel coordinates.\n     *\n     * Src points: xi, yi\n     * Dst points: ui, vi\n     * Affine coefficients: aij\n     *\n     * | x0 y0 1  0  0 0 |   |a00|   |u0|\n     * | x1 y1 1  0  0 0 |   |a01|   |u1|\n     * | x2 y2 1  0  0 0 | x |a02| = |u2|\n     * |  0  0 0 x0 y0 1 |   |a10|   |v0|\n     * |  0  0 0 x1 y1 1 |   |a11|   |v1|\n     * |  0  0 0 x2 y2 1 |   |a12|   |v2|\n     */\n    const source = triangle.source;\n    const target = triangle.target;\n    let x0 = source[0][0], y0 = source[0][1];\n    let x1 = source[1][0], y1 = source[1][1];\n    let x2 = source[2][0], y2 = source[2][1];\n    const u0 = (target[0][0] - targetTopLeft[0]) / targetResolution;\n    const v0 = -(target[0][1] - targetTopLeft[1]) / targetResolution;\n    const u1 = (target[1][0] - targetTopLeft[0]) / targetResolution;\n    const v1 = -(target[1][1] - targetTopLeft[1]) / targetResolution;\n    const u2 = (target[2][0] - targetTopLeft[0]) / targetResolution;\n    const v2 = -(target[2][1] - targetTopLeft[1]) / targetResolution;\n\n    // Shift all the source points to improve numerical stability\n    // of all the subsequent calculations. The [x0, y0] is used here.\n    // This is also used to simplify the linear system.\n    const sourceNumericalShiftX = x0;\n    const sourceNumericalShiftY = y0;\n    x0 = 0;\n    y0 = 0;\n    x1 -= sourceNumericalShiftX;\n    y1 -= sourceNumericalShiftY;\n    x2 -= sourceNumericalShiftX;\n    y2 -= sourceNumericalShiftY;\n\n    const augmentedMatrix = [\n      [x1, y1, 0, 0, u1 - u0],\n      [x2, y2, 0, 0, u2 - u0],\n      [0, 0, x1, y1, v1 - v0],\n      [0, 0, x2, y2, v2 - v0]\n    ];\n    const affineCoefs = solveLinearSystem(augmentedMatrix);\n    if (!affineCoefs) {\n      return;\n    }\n\n    context.save();\n    context.beginPath();\n    const centroidX = (u0 + u1 + u2) / 3;\n    const centroidY = (v0 + v1 + v2) / 3;\n    const p0 = enlargeClipPoint(centroidX, centroidY, u0, v0);\n    const p1 = enlargeClipPoint(centroidX, centroidY, u1, v1);\n    const p2 = enlargeClipPoint(centroidX, centroidY, u2, v2);\n\n    context.moveTo(p1[0], p1[1]);\n    context.lineTo(p0[0], p0[1]);\n    context.lineTo(p2[0], p2[1]);\n    context.clip();\n\n    context.transform(\n      affineCoefs[0], affineCoefs[2], affineCoefs[1], affineCoefs[3], u0, v0);\n\n    context.translate(sourceDataExtent[0] - sourceNumericalShiftX,\n      sourceDataExtent[3] - sourceNumericalShiftY);\n\n    context.scale(sourceResolution / pixelRatio,\n      -sourceResolution / pixelRatio);\n\n    context.drawImage(stitchContext.canvas, 0, 0);\n    context.restore();\n  });\n\n  if (opt_renderEdges) {\n    context.save();\n\n    context.strokeStyle = 'black';\n    context.lineWidth = 1;\n\n    triangulation.getTriangles().forEach(function(triangle, i, arr) {\n      const target = triangle.target;\n      const u0 = (target[0][0] - targetTopLeft[0]) / targetResolution;\n      const v0 = -(target[0][1] - targetTopLeft[1]) / targetResolution;\n      const u1 = (target[1][0] - targetTopLeft[0]) / targetResolution;\n      const v1 = -(target[1][1] - targetTopLeft[1]) / targetResolution;\n      const u2 = (target[2][0] - targetTopLeft[0]) / targetResolution;\n      const v2 = -(target[2][1] - targetTopLeft[1]) / targetResolution;\n\n      context.beginPath();\n      context.moveTo(u1, v1);\n      context.lineTo(u0, v0);\n      context.lineTo(u2, v2);\n      context.closePath();\n      context.stroke();\n    });\n\n    context.restore();\n  }\n  return context.canvas;\n}\n","/**\n * @module ol/reproj/Triangulation\n */\nimport {boundingExtent, createEmpty, extendCoordinate, getBottomLeft, getBottomRight,\n  getTopLeft, getTopRight, getWidth, intersects} from '../extent.js';\nimport {modulo} from '../math.js';\nimport {getTransform} from '../proj.js';\n\n\n/**\n * Single triangle; consists of 3 source points and 3 target points.\n * @typedef {Object} Triangle\n * @property {Array.<module:ol/coordinate~Coordinate>} source\n * @property {Array.<module:ol/coordinate~Coordinate>} target\n */\n\n\n/**\n * Maximum number of subdivision steps during raster reprojection triangulation.\n * Prevents high memory usage and large number of proj4 calls (for certain\n * transformations and areas). At most `2*(2^this)` triangles are created for\n * each triangulated extent (tile/image).\n * @type {number}\n */\nconst MAX_SUBDIVISION = 10;\n\n\n/**\n * Maximum allowed size of triangle relative to world width. When transforming\n * corners of world extent between certain projections, the resulting\n * triangulation seems to have zero error and no subdivision is performed. If\n * the triangle width is more than this (relative to world width; 0-1),\n * subdivison is forced (up to `MAX_SUBDIVISION`). Default is `0.25`.\n * @type {number}\n */\nconst MAX_TRIANGLE_WIDTH = 0.25;\n\n\n/**\n * @classdesc\n * Class containing triangulation of the given target extent.\n * Used for determining source data and the reprojection itself.\n *\n * @param {module:ol/proj/Projection} sourceProj Source projection.\n * @param {module:ol/proj/Projection} targetProj Target projection.\n * @param {module:ol/extent~Extent} targetExtent Target extent to triangulate.\n * @param {module:ol/extent~Extent} maxSourceExtent Maximal source extent that can be used.\n * @param {number} errorThreshold Acceptable error (in source units).\n * @constructor\n */\nconst Triangulation = function(sourceProj, targetProj, targetExtent,\n  maxSourceExtent, errorThreshold) {\n\n  /**\n   * @type {module:ol/proj/Projection}\n   * @private\n   */\n  this.sourceProj_ = sourceProj;\n\n  /**\n   * @type {module:ol/proj/Projection}\n   * @private\n   */\n  this.targetProj_ = targetProj;\n\n  /** @type {!Object.<string, module:ol/coordinate~Coordinate>} */\n  let transformInvCache = {};\n  const transformInv = getTransform(this.targetProj_, this.sourceProj_);\n\n  /**\n   * @param {module:ol/coordinate~Coordinate} c A coordinate.\n   * @return {module:ol/coordinate~Coordinate} Transformed coordinate.\n   * @private\n   */\n  this.transformInv_ = function(c) {\n    const key = c[0] + '/' + c[1];\n    if (!transformInvCache[key]) {\n      transformInvCache[key] = transformInv(c);\n    }\n    return transformInvCache[key];\n  };\n\n  /**\n   * @type {module:ol/extent~Extent}\n   * @private\n   */\n  this.maxSourceExtent_ = maxSourceExtent;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.errorThresholdSquared_ = errorThreshold * errorThreshold;\n\n  /**\n   * @type {Array.<module:ol/reproj/Triangulation~Triangle>}\n   * @private\n   */\n  this.triangles_ = [];\n\n  /**\n   * Indicates that the triangulation crosses edge of the source projection.\n   * @type {boolean}\n   * @private\n   */\n  this.wrapsXInSource_ = false;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.canWrapXInSource_ = this.sourceProj_.canWrapX() &&\n      !!maxSourceExtent &&\n      !!this.sourceProj_.getExtent() &&\n      (getWidth(maxSourceExtent) == getWidth(this.sourceProj_.getExtent()));\n\n  /**\n   * @type {?number}\n   * @private\n   */\n  this.sourceWorldWidth_ = this.sourceProj_.getExtent() ?\n    getWidth(this.sourceProj_.getExtent()) : null;\n\n  /**\n   * @type {?number}\n   * @private\n   */\n  this.targetWorldWidth_ = this.targetProj_.getExtent() ?\n    getWidth(this.targetProj_.getExtent()) : null;\n\n  const destinationTopLeft = getTopLeft(targetExtent);\n  const destinationTopRight = getTopRight(targetExtent);\n  const destinationBottomRight = getBottomRight(targetExtent);\n  const destinationBottomLeft = getBottomLeft(targetExtent);\n  const sourceTopLeft = this.transformInv_(destinationTopLeft);\n  const sourceTopRight = this.transformInv_(destinationTopRight);\n  const sourceBottomRight = this.transformInv_(destinationBottomRight);\n  const sourceBottomLeft = this.transformInv_(destinationBottomLeft);\n\n  this.addQuad_(\n    destinationTopLeft, destinationTopRight,\n    destinationBottomRight, destinationBottomLeft,\n    sourceTopLeft, sourceTopRight, sourceBottomRight, sourceBottomLeft,\n    MAX_SUBDIVISION);\n\n  if (this.wrapsXInSource_) {\n    let leftBound = Infinity;\n    this.triangles_.forEach(function(triangle, i, arr) {\n      leftBound = Math.min(leftBound,\n        triangle.source[0][0], triangle.source[1][0], triangle.source[2][0]);\n    });\n\n    // Shift triangles to be as close to `leftBound` as possible\n    // (if the distance is more than `worldWidth / 2` it can be closer.\n    this.triangles_.forEach(function(triangle) {\n      if (Math.max(triangle.source[0][0], triangle.source[1][0],\n        triangle.source[2][0]) - leftBound > this.sourceWorldWidth_ / 2) {\n        const newTriangle = [[triangle.source[0][0], triangle.source[0][1]],\n          [triangle.source[1][0], triangle.source[1][1]],\n          [triangle.source[2][0], triangle.source[2][1]]];\n        if ((newTriangle[0][0] - leftBound) > this.sourceWorldWidth_ / 2) {\n          newTriangle[0][0] -= this.sourceWorldWidth_;\n        }\n        if ((newTriangle[1][0] - leftBound) > this.sourceWorldWidth_ / 2) {\n          newTriangle[1][0] -= this.sourceWorldWidth_;\n        }\n        if ((newTriangle[2][0] - leftBound) > this.sourceWorldWidth_ / 2) {\n          newTriangle[2][0] -= this.sourceWorldWidth_;\n        }\n\n        // Rarely (if the extent contains both the dateline and prime meridian)\n        // the shift can in turn break some triangles.\n        // Detect this here and don't shift in such cases.\n        const minX = Math.min(\n          newTriangle[0][0], newTriangle[1][0], newTriangle[2][0]);\n        const maxX = Math.max(\n          newTriangle[0][0], newTriangle[1][0], newTriangle[2][0]);\n        if ((maxX - minX) < this.sourceWorldWidth_ / 2) {\n          triangle.source = newTriangle;\n        }\n      }\n    }.bind(this));\n  }\n\n  transformInvCache = {};\n};\n\n\n/**\n * Adds triangle to the triangulation.\n * @param {module:ol/coordinate~Coordinate} a The target a coordinate.\n * @param {module:ol/coordinate~Coordinate} b The target b coordinate.\n * @param {module:ol/coordinate~Coordinate} c The target c coordinate.\n * @param {module:ol/coordinate~Coordinate} aSrc The source a coordinate.\n * @param {module:ol/coordinate~Coordinate} bSrc The source b coordinate.\n * @param {module:ol/coordinate~Coordinate} cSrc The source c coordinate.\n * @private\n */\nTriangulation.prototype.addTriangle_ = function(a, b, c,\n  aSrc, bSrc, cSrc) {\n  this.triangles_.push({\n    source: [aSrc, bSrc, cSrc],\n    target: [a, b, c]\n  });\n};\n\n\n/**\n * Adds quad (points in clock-wise order) to the triangulation\n * (and reprojects the vertices) if valid.\n * Performs quad subdivision if needed to increase precision.\n *\n * @param {module:ol/coordinate~Coordinate} a The target a coordinate.\n * @param {module:ol/coordinate~Coordinate} b The target b coordinate.\n * @param {module:ol/coordinate~Coordinate} c The target c coordinate.\n * @param {module:ol/coordinate~Coordinate} d The target d coordinate.\n * @param {module:ol/coordinate~Coordinate} aSrc The source a coordinate.\n * @param {module:ol/coordinate~Coordinate} bSrc The source b coordinate.\n * @param {module:ol/coordinate~Coordinate} cSrc The source c coordinate.\n * @param {module:ol/coordinate~Coordinate} dSrc The source d coordinate.\n * @param {number} maxSubdivision Maximal allowed subdivision of the quad.\n * @private\n */\nTriangulation.prototype.addQuad_ = function(a, b, c, d,\n  aSrc, bSrc, cSrc, dSrc, maxSubdivision) {\n\n  const sourceQuadExtent = boundingExtent([aSrc, bSrc, cSrc, dSrc]);\n  const sourceCoverageX = this.sourceWorldWidth_ ?\n    getWidth(sourceQuadExtent) / this.sourceWorldWidth_ : null;\n  const sourceWorldWidth = /** @type {number} */ (this.sourceWorldWidth_);\n\n  // when the quad is wrapped in the source projection\n  // it covers most of the projection extent, but not fully\n  const wrapsX = this.sourceProj_.canWrapX() &&\n               sourceCoverageX > 0.5 && sourceCoverageX < 1;\n\n  let needsSubdivision = false;\n\n  if (maxSubdivision > 0) {\n    if (this.targetProj_.isGlobal() && this.targetWorldWidth_) {\n      const targetQuadExtent = boundingExtent([a, b, c, d]);\n      const targetCoverageX = getWidth(targetQuadExtent) / this.targetWorldWidth_;\n      needsSubdivision |=\n          targetCoverageX > MAX_TRIANGLE_WIDTH;\n    }\n    if (!wrapsX && this.sourceProj_.isGlobal() && sourceCoverageX) {\n      needsSubdivision |=\n          sourceCoverageX > MAX_TRIANGLE_WIDTH;\n    }\n  }\n\n  if (!needsSubdivision && this.maxSourceExtent_) {\n    if (!intersects(sourceQuadExtent, this.maxSourceExtent_)) {\n      // whole quad outside source projection extent -> ignore\n      return;\n    }\n  }\n\n  if (!needsSubdivision) {\n    if (!isFinite(aSrc[0]) || !isFinite(aSrc[1]) ||\n        !isFinite(bSrc[0]) || !isFinite(bSrc[1]) ||\n        !isFinite(cSrc[0]) || !isFinite(cSrc[1]) ||\n        !isFinite(dSrc[0]) || !isFinite(dSrc[1])) {\n      if (maxSubdivision > 0) {\n        needsSubdivision = true;\n      } else {\n        return;\n      }\n    }\n  }\n\n  if (maxSubdivision > 0) {\n    if (!needsSubdivision) {\n      const center = [(a[0] + c[0]) / 2, (a[1] + c[1]) / 2];\n      const centerSrc = this.transformInv_(center);\n\n      let dx;\n      if (wrapsX) {\n        const centerSrcEstimX =\n            (modulo(aSrc[0], sourceWorldWidth) +\n             modulo(cSrc[0], sourceWorldWidth)) / 2;\n        dx = centerSrcEstimX -\n            modulo(centerSrc[0], sourceWorldWidth);\n      } else {\n        dx = (aSrc[0] + cSrc[0]) / 2 - centerSrc[0];\n      }\n      const dy = (aSrc[1] + cSrc[1]) / 2 - centerSrc[1];\n      const centerSrcErrorSquared = dx * dx + dy * dy;\n      needsSubdivision = centerSrcErrorSquared > this.errorThresholdSquared_;\n    }\n    if (needsSubdivision) {\n      if (Math.abs(a[0] - c[0]) <= Math.abs(a[1] - c[1])) {\n        // split horizontally (top & bottom)\n        const bc = [(b[0] + c[0]) / 2, (b[1] + c[1]) / 2];\n        const bcSrc = this.transformInv_(bc);\n        const da = [(d[0] + a[0]) / 2, (d[1] + a[1]) / 2];\n        const daSrc = this.transformInv_(da);\n\n        this.addQuad_(\n          a, b, bc, da, aSrc, bSrc, bcSrc, daSrc, maxSubdivision - 1);\n        this.addQuad_(\n          da, bc, c, d, daSrc, bcSrc, cSrc, dSrc, maxSubdivision - 1);\n      } else {\n        // split vertically (left & right)\n        const ab = [(a[0] + b[0]) / 2, (a[1] + b[1]) / 2];\n        const abSrc = this.transformInv_(ab);\n        const cd = [(c[0] + d[0]) / 2, (c[1] + d[1]) / 2];\n        const cdSrc = this.transformInv_(cd);\n\n        this.addQuad_(\n          a, ab, cd, d, aSrc, abSrc, cdSrc, dSrc, maxSubdivision - 1);\n        this.addQuad_(\n          ab, b, c, cd, abSrc, bSrc, cSrc, cdSrc, maxSubdivision - 1);\n      }\n      return;\n    }\n  }\n\n  if (wrapsX) {\n    if (!this.canWrapXInSource_) {\n      return;\n    }\n    this.wrapsXInSource_ = true;\n  }\n\n  this.addTriangle_(a, c, d, aSrc, cSrc, dSrc);\n  this.addTriangle_(a, b, c, aSrc, bSrc, cSrc);\n};\n\n\n/**\n * Calculates extent of the 'source' coordinates from all the triangles.\n *\n * @return {module:ol/extent~Extent} Calculated extent.\n */\nTriangulation.prototype.calculateSourceExtent = function() {\n  const extent = createEmpty();\n\n  this.triangles_.forEach(function(triangle, i, arr) {\n    const src = triangle.source;\n    extendCoordinate(extent, src[0]);\n    extendCoordinate(extent, src[1]);\n    extendCoordinate(extent, src[2]);\n  });\n\n  return extent;\n};\n\n\n/**\n * @return {Array.<module:ol/reproj/Triangulation~Triangle>} Array of the calculated triangles.\n */\nTriangulation.prototype.getTriangles = function() {\n  return this.triangles_;\n};\nexport default Triangulation;\n","/**\n * @module ol/reproj/Tile\n */\nimport {ERROR_THRESHOLD} from './common.js';\nimport {inherits} from '../util.js';\nimport Tile from '../Tile.js';\nimport TileState from '../TileState.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getArea, getCenter, getIntersection} from '../extent.js';\nimport {clamp} from '../math.js';\nimport {calculateSourceResolution, render as renderReprojected} from '../reproj.js';\nimport Triangulation from '../reproj/Triangulation.js';\n\n\n/**\n * @typedef {function(number, number, number, number) : module:ol/Tile} FunctionType\n */\n\n\n/**\n * @classdesc\n * Class encapsulating single reprojected tile.\n * See {@link module:ol/source/TileImage~TileImage}.\n *\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/proj/Projection} sourceProj Source projection.\n * @param {module:ol/tilegrid/TileGrid} sourceTileGrid Source tile grid.\n * @param {module:ol/proj/Projection} targetProj Target projection.\n * @param {module:ol/tilegrid/TileGrid} targetTileGrid Target tile grid.\n * @param {module:ol/tilecoord~TileCoord} tileCoord Coordinate of the tile.\n * @param {module:ol/tilecoord~TileCoord} wrappedTileCoord Coordinate of the tile wrapped in X.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} gutter Gutter of the source tiles.\n * @param {module:ol/reproj/Tile~FunctionType} getTileFunction\n *     Function returning source tiles (z, x, y, pixelRatio).\n * @param {number=} opt_errorThreshold Acceptable reprojection error (in px).\n * @param {boolean=} opt_renderEdges Render reprojection edges.\n */\nconst ReprojTile = function(sourceProj, sourceTileGrid,\n  targetProj, targetTileGrid, tileCoord, wrappedTileCoord,\n  pixelRatio, gutter, getTileFunction,\n  opt_errorThreshold, opt_renderEdges) {\n  Tile.call(this, tileCoord, TileState.IDLE);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderEdges_ = opt_renderEdges !== undefined ? opt_renderEdges : false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.pixelRatio_ = pixelRatio;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.gutter_ = gutter;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/tilegrid/TileGrid}\n   */\n  this.sourceTileGrid_ = sourceTileGrid;\n\n  /**\n   * @private\n   * @type {module:ol/tilegrid/TileGrid}\n   */\n  this.targetTileGrid_ = targetTileGrid;\n\n  /**\n   * @private\n   * @type {module:ol/tilecoord~TileCoord}\n   */\n  this.wrappedTileCoord_ = wrappedTileCoord ? wrappedTileCoord : tileCoord;\n\n  /**\n   * @private\n   * @type {!Array.<module:ol/Tile>}\n   */\n  this.sourceTiles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.sourcesListenerKeys_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.sourceZ_ = 0;\n\n  const targetExtent = targetTileGrid.getTileCoordExtent(this.wrappedTileCoord_);\n  const maxTargetExtent = this.targetTileGrid_.getExtent();\n  let maxSourceExtent = this.sourceTileGrid_.getExtent();\n\n  const limitedTargetExtent = maxTargetExtent ?\n    getIntersection(targetExtent, maxTargetExtent) : targetExtent;\n\n  if (getArea(limitedTargetExtent) === 0) {\n    // Tile is completely outside range -> EMPTY\n    // TODO: is it actually correct that the source even creates the tile ?\n    this.state = TileState.EMPTY;\n    return;\n  }\n\n  const sourceProjExtent = sourceProj.getExtent();\n  if (sourceProjExtent) {\n    if (!maxSourceExtent) {\n      maxSourceExtent = sourceProjExtent;\n    } else {\n      maxSourceExtent = getIntersection(maxSourceExtent, sourceProjExtent);\n    }\n  }\n\n  const targetResolution = targetTileGrid.getResolution(\n    this.wrappedTileCoord_[0]);\n\n  const targetCenter = getCenter(limitedTargetExtent);\n  const sourceResolution = calculateSourceResolution(\n    sourceProj, targetProj, targetCenter, targetResolution);\n\n  if (!isFinite(sourceResolution) || sourceResolution <= 0) {\n    // invalid sourceResolution -> EMPTY\n    // probably edges of the projections when no extent is defined\n    this.state = TileState.EMPTY;\n    return;\n  }\n\n  const errorThresholdInPixels = opt_errorThreshold !== undefined ?\n    opt_errorThreshold : ERROR_THRESHOLD;\n\n  /**\n   * @private\n   * @type {!module:ol/reproj/Triangulation}\n   */\n  this.triangulation_ = new Triangulation(\n    sourceProj, targetProj, limitedTargetExtent, maxSourceExtent,\n    sourceResolution * errorThresholdInPixels);\n\n  if (this.triangulation_.getTriangles().length === 0) {\n    // no valid triangles -> EMPTY\n    this.state = TileState.EMPTY;\n    return;\n  }\n\n  this.sourceZ_ = sourceTileGrid.getZForResolution(sourceResolution);\n  let sourceExtent = this.triangulation_.calculateSourceExtent();\n\n  if (maxSourceExtent) {\n    if (sourceProj.canWrapX()) {\n      sourceExtent[1] = clamp(\n        sourceExtent[1], maxSourceExtent[1], maxSourceExtent[3]);\n      sourceExtent[3] = clamp(\n        sourceExtent[3], maxSourceExtent[1], maxSourceExtent[3]);\n    } else {\n      sourceExtent = getIntersection(sourceExtent, maxSourceExtent);\n    }\n  }\n\n  if (!getArea(sourceExtent)) {\n    this.state = TileState.EMPTY;\n  } else {\n    const sourceRange = sourceTileGrid.getTileRangeForExtentAndZ(\n      sourceExtent, this.sourceZ_);\n\n    for (let srcX = sourceRange.minX; srcX <= sourceRange.maxX; srcX++) {\n      for (let srcY = sourceRange.minY; srcY <= sourceRange.maxY; srcY++) {\n        const tile = getTileFunction(this.sourceZ_, srcX, srcY, pixelRatio);\n        if (tile) {\n          this.sourceTiles_.push(tile);\n        }\n      }\n    }\n\n    if (this.sourceTiles_.length === 0) {\n      this.state = TileState.EMPTY;\n    }\n  }\n};\n\ninherits(ReprojTile, Tile);\n\n\n/**\n * @inheritDoc\n */\nReprojTile.prototype.disposeInternal = function() {\n  if (this.state == TileState.LOADING) {\n    this.unlistenSources_();\n  }\n  Tile.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * Get the HTML Canvas element for this tile.\n * @return {HTMLCanvasElement} Canvas.\n */\nReprojTile.prototype.getImage = function() {\n  return this.canvas_;\n};\n\n\n/**\n * @private\n */\nReprojTile.prototype.reproject_ = function() {\n  const sources = [];\n  this.sourceTiles_.forEach(function(tile, i, arr) {\n    if (tile && tile.getState() == TileState.LOADED) {\n      sources.push({\n        extent: this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord),\n        image: tile.getImage()\n      });\n    }\n  }.bind(this));\n  this.sourceTiles_.length = 0;\n\n  if (sources.length === 0) {\n    this.state = TileState.ERROR;\n  } else {\n    const z = this.wrappedTileCoord_[0];\n    const size = this.targetTileGrid_.getTileSize(z);\n    const width = typeof size === 'number' ? size : size[0];\n    const height = typeof size === 'number' ? size : size[1];\n    const targetResolution = this.targetTileGrid_.getResolution(z);\n    const sourceResolution = this.sourceTileGrid_.getResolution(this.sourceZ_);\n\n    const targetExtent = this.targetTileGrid_.getTileCoordExtent(\n      this.wrappedTileCoord_);\n    this.canvas_ = renderReprojected(width, height, this.pixelRatio_,\n      sourceResolution, this.sourceTileGrid_.getExtent(),\n      targetResolution, targetExtent, this.triangulation_, sources,\n      this.gutter_, this.renderEdges_);\n\n    this.state = TileState.LOADED;\n  }\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n */\nReprojTile.prototype.load = function() {\n  if (this.state == TileState.IDLE) {\n    this.state = TileState.LOADING;\n    this.changed();\n\n    let leftToLoad = 0;\n\n    this.sourcesListenerKeys_ = [];\n    this.sourceTiles_.forEach(function(tile, i, arr) {\n      const state = tile.getState();\n      if (state == TileState.IDLE || state == TileState.LOADING) {\n        leftToLoad++;\n\n        const sourceListenKey = listen(tile, EventType.CHANGE,\n          function(e) {\n            const state = tile.getState();\n            if (state == TileState.LOADED ||\n                  state == TileState.ERROR ||\n                  state == TileState.EMPTY) {\n              unlistenByKey(sourceListenKey);\n              leftToLoad--;\n              if (leftToLoad === 0) {\n                this.unlistenSources_();\n                this.reproject_();\n              }\n            }\n          }, this);\n        this.sourcesListenerKeys_.push(sourceListenKey);\n      }\n    }.bind(this));\n\n    this.sourceTiles_.forEach(function(tile, i, arr) {\n      const state = tile.getState();\n      if (state == TileState.IDLE) {\n        tile.load();\n      }\n    });\n\n    if (leftToLoad === 0) {\n      setTimeout(this.reproject_.bind(this), 0);\n    }\n  }\n};\n\n\n/**\n * @private\n */\nReprojTile.prototype.unlistenSources_ = function() {\n  this.sourcesListenerKeys_.forEach(unlistenByKey);\n  this.sourcesListenerKeys_ = null;\n};\nexport default ReprojTile;\n","/**\n * @module ol/tilegrid/TileGrid\n */\nimport {DEFAULT_TILE_SIZE} from './common.js';\nimport {assert} from '../asserts.js';\nimport TileRange, {createOrUpdate as createOrUpdateTileRange} from '../TileRange.js';\nimport {isSorted, linearFindNearest} from '../array.js';\nimport {createOrUpdate, getTopLeft} from '../extent.js';\nimport {clamp} from '../math.js';\nimport {toSize} from '../size.js';\nimport {createOrUpdate as createOrUpdateTileCoord} from '../tilecoord.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/extent~Extent} [extent] Extent for the tile grid. No tiles outside this\n * extent will be requested by {@link module:ol/source/Tile} sources. When no `origin` or\n * `origins` are configured, the `origin` will be set to the top-left corner of the extent.\n * @property {number} [minZoom=0] Minimum zoom.\n * @property {module:ol/coordinate~Coordinate} [origin] The tile grid origin, i.e. where the `x`\n * and `y` axes meet (`[z, 0, 0]`). Tile coordinates increase left to right and upwards. If not\n * specified, `extent` or `origins` must be provided.\n * @property {Array.<module:ol/coordinate~Coordinate>} [origins] Tile grid origins, i.e. where\n * the `x` and `y` axes meet (`[z, 0, 0]`), for each zoom level. If given, the array length\n * should match the length of the `resolutions` array, i.e. each resolution can have a different\n * origin. Tile coordinates increase left to right and upwards. If not specified, `extent` or\n * `origin` must be provided.\n * @property {!Array.<number>} resolutions Resolutions. The array index of each resolution needs\n * to match the zoom level. This means that even if a `minZoom` is configured, the resolutions\n * array will have a length of `maxZoom + 1`.\n * @property {Array.<module:ol/size~Size>} [sizes] Sizes.\n * @property {number|module:ol/size~Size} [tileSize] Tile size.\n * Default is `[256, 256]`.\n * @property {Array.<module:ol/size~Size>} [tileSizes] Tile sizes. If given, the array length\n * should match the length of the `resolutions` array, i.e. each resolution can have a different\n * tile size.\n */\n\n\n/**\n * @classdesc\n * Base class for setting the grid pattern for sources accessing tiled-image\n * servers.\n *\n * @constructor\n * @param {module:ol/tilegrid/TileGrid~Options} options Tile grid options.\n * @struct\n * @api\n */\nconst TileGrid = function(options) {\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.minZoom = options.minZoom !== undefined ? options.minZoom : 0;\n\n  /**\n   * @private\n   * @type {!Array.<number>}\n   */\n  this.resolutions_ = options.resolutions;\n  assert(isSorted(this.resolutions_, function(a, b) {\n    return b - a;\n  }, true), 17); // `resolutions` must be sorted in descending order\n\n\n  // check if we've got a consistent zoom factor and origin\n  let zoomFactor;\n  if (!options.origins) {\n    for (let i = 0, ii = this.resolutions_.length - 1; i < ii; ++i) {\n      if (!zoomFactor) {\n        zoomFactor = this.resolutions_[i] / this.resolutions_[i + 1];\n      } else {\n        if (this.resolutions_[i] / this.resolutions_[i + 1] !== zoomFactor) {\n          zoomFactor = undefined;\n          break;\n        }\n      }\n    }\n  }\n\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.zoomFactor_ = zoomFactor;\n\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.maxZoom = this.resolutions_.length - 1;\n\n  /**\n   * @private\n   * @type {module:ol/coordinate~Coordinate}\n   */\n  this.origin_ = options.origin !== undefined ? options.origin : null;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/coordinate~Coordinate>}\n   */\n  this.origins_ = null;\n  if (options.origins !== undefined) {\n    this.origins_ = options.origins;\n    assert(this.origins_.length == this.resolutions_.length,\n      20); // Number of `origins` and `resolutions` must be equal\n  }\n\n  const extent = options.extent;\n\n  if (extent !== undefined &&\n      !this.origin_ && !this.origins_) {\n    this.origin_ = getTopLeft(extent);\n  }\n\n  assert(\n    (!this.origin_ && this.origins_) || (this.origin_ && !this.origins_),\n    18); // Either `origin` or `origins` must be configured, never both\n\n  /**\n   * @private\n   * @type {Array.<number|module:ol/size~Size>}\n   */\n  this.tileSizes_ = null;\n  if (options.tileSizes !== undefined) {\n    this.tileSizes_ = options.tileSizes;\n    assert(this.tileSizes_.length == this.resolutions_.length,\n      19); // Number of `tileSizes` and `resolutions` must be equal\n  }\n\n  /**\n   * @private\n   * @type {number|module:ol/size~Size}\n   */\n  this.tileSize_ = options.tileSize !== undefined ?\n    options.tileSize :\n    !this.tileSizes_ ? DEFAULT_TILE_SIZE : null;\n  assert(\n    (!this.tileSize_ && this.tileSizes_) ||\n      (this.tileSize_ && !this.tileSizes_),\n    22); // Either `tileSize` or `tileSizes` must be configured, never both\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = extent !== undefined ? extent : null;\n\n\n  /**\n   * @private\n   * @type {Array.<module:ol/TileRange>}\n   */\n  this.fullTileRanges_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.tmpSize_ = [0, 0];\n\n  if (options.sizes !== undefined) {\n    this.fullTileRanges_ = options.sizes.map(function(size, z) {\n      const tileRange = new TileRange(\n        Math.min(0, size[0]), Math.max(size[0] - 1, -1),\n        Math.min(0, size[1]), Math.max(size[1] - 1, -1));\n      return tileRange;\n    }, this);\n  } else if (extent) {\n    this.calculateTileRanges_(extent);\n  }\n\n};\n\n\n/**\n * @private\n * @type {module:ol/tilecoord~TileCoord}\n */\nconst tmpTileCoord = [0, 0, 0];\n\n\n/**\n * Call a function with each tile coordinate for a given extent and zoom level.\n *\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} zoom Integer zoom level.\n * @param {function(module:ol/tilecoord~TileCoord)} callback Function called with each tile coordinate.\n * @api\n */\nTileGrid.prototype.forEachTileCoord = function(extent, zoom, callback) {\n  const tileRange = this.getTileRangeForExtentAndZ(extent, zoom);\n  for (let i = tileRange.minX, ii = tileRange.maxX; i <= ii; ++i) {\n    for (let j = tileRange.minY, jj = tileRange.maxY; j <= jj; ++j) {\n      callback([zoom, i, j]);\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {function(this: T, number, module:ol/TileRange): boolean} callback Callback.\n * @param {T=} opt_this The object to use as `this` in `callback`.\n * @param {module:ol/TileRange=} opt_tileRange Temporary module:ol/TileRange object.\n * @param {module:ol/extent~Extent=} opt_extent Temporary module:ol/extent~Extent object.\n * @return {boolean} Callback succeeded.\n * @template T\n */\nTileGrid.prototype.forEachTileCoordParentTileRange = function(tileCoord, callback, opt_this, opt_tileRange, opt_extent) {\n  let tileRange, x, y;\n  let tileCoordExtent = null;\n  let z = tileCoord[0] - 1;\n  if (this.zoomFactor_ === 2) {\n    x = tileCoord[1];\n    y = tileCoord[2];\n  } else {\n    tileCoordExtent = this.getTileCoordExtent(tileCoord, opt_extent);\n  }\n  while (z >= this.minZoom) {\n    if (this.zoomFactor_ === 2) {\n      x = Math.floor(x / 2);\n      y = Math.floor(y / 2);\n      tileRange = createOrUpdateTileRange(x, x, y, y, opt_tileRange);\n    } else {\n      tileRange = this.getTileRangeForExtentAndZ(tileCoordExtent, z, opt_tileRange);\n    }\n    if (callback.call(opt_this, z, tileRange)) {\n      return true;\n    }\n    --z;\n  }\n  return false;\n};\n\n\n/**\n * Get the extent for this tile grid, if it was configured.\n * @return {module:ol/extent~Extent} Extent.\n */\nTileGrid.prototype.getExtent = function() {\n  return this.extent_;\n};\n\n\n/**\n * Get the maximum zoom level for the grid.\n * @return {number} Max zoom.\n * @api\n */\nTileGrid.prototype.getMaxZoom = function() {\n  return this.maxZoom;\n};\n\n\n/**\n * Get the minimum zoom level for the grid.\n * @return {number} Min zoom.\n * @api\n */\nTileGrid.prototype.getMinZoom = function() {\n  return this.minZoom;\n};\n\n\n/**\n * Get the origin for the grid at the given zoom level.\n * @param {number} z Integer zoom level.\n * @return {module:ol/coordinate~Coordinate} Origin.\n * @api\n */\nTileGrid.prototype.getOrigin = function(z) {\n  if (this.origin_) {\n    return this.origin_;\n  } else {\n    return this.origins_[z];\n  }\n};\n\n\n/**\n * Get the resolution for the given zoom level.\n * @param {number} z Integer zoom level.\n * @return {number} Resolution.\n * @api\n */\nTileGrid.prototype.getResolution = function(z) {\n  return this.resolutions_[z];\n};\n\n\n/**\n * Get the list of resolutions for the tile grid.\n * @return {Array.<number>} Resolutions.\n * @api\n */\nTileGrid.prototype.getResolutions = function() {\n  return this.resolutions_;\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileRange=} opt_tileRange Temporary module:ol/TileRange object.\n * @param {module:ol/extent~Extent=} opt_extent Temporary module:ol/extent~Extent object.\n * @return {module:ol/TileRange} Tile range.\n */\nTileGrid.prototype.getTileCoordChildTileRange = function(tileCoord, opt_tileRange, opt_extent) {\n  if (tileCoord[0] < this.maxZoom) {\n    if (this.zoomFactor_ === 2) {\n      const minX = tileCoord[1] * 2;\n      const minY = tileCoord[2] * 2;\n      return createOrUpdateTileRange(minX, minX + 1, minY, minY + 1, opt_tileRange);\n    }\n    const tileCoordExtent = this.getTileCoordExtent(tileCoord, opt_extent);\n    return this.getTileRangeForExtentAndZ(\n      tileCoordExtent, tileCoord[0] + 1, opt_tileRange);\n  }\n  return null;\n};\n\n\n/**\n * Get the extent for a tile range.\n * @param {number} z Integer zoom level.\n * @param {module:ol/TileRange} tileRange Tile range.\n * @param {module:ol/extent~Extent=} opt_extent Temporary module:ol/extent~Extent object.\n * @return {module:ol/extent~Extent} Extent.\n */\nTileGrid.prototype.getTileRangeExtent = function(z, tileRange, opt_extent) {\n  const origin = this.getOrigin(z);\n  const resolution = this.getResolution(z);\n  const tileSize = toSize(this.getTileSize(z), this.tmpSize_);\n  const minX = origin[0] + tileRange.minX * tileSize[0] * resolution;\n  const maxX = origin[0] + (tileRange.maxX + 1) * tileSize[0] * resolution;\n  const minY = origin[1] + tileRange.minY * tileSize[1] * resolution;\n  const maxY = origin[1] + (tileRange.maxY + 1) * tileSize[1] * resolution;\n  return createOrUpdate(minX, minY, maxX, maxY, opt_extent);\n};\n\n\n/**\n * Get a tile range for the given extent and integer zoom level.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} z Integer zoom level.\n * @param {module:ol/TileRange=} opt_tileRange Temporary tile range object.\n * @return {module:ol/TileRange} Tile range.\n */\nTileGrid.prototype.getTileRangeForExtentAndZ = function(extent, z, opt_tileRange) {\n  const tileCoord = tmpTileCoord;\n  this.getTileCoordForXYAndZ_(extent[0], extent[1], z, false, tileCoord);\n  const minX = tileCoord[1];\n  const minY = tileCoord[2];\n  this.getTileCoordForXYAndZ_(extent[2], extent[3], z, true, tileCoord);\n  return createOrUpdateTileRange(minX, tileCoord[1], minY, tileCoord[2], opt_tileRange);\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @return {module:ol/coordinate~Coordinate} Tile center.\n */\nTileGrid.prototype.getTileCoordCenter = function(tileCoord) {\n  const origin = this.getOrigin(tileCoord[0]);\n  const resolution = this.getResolution(tileCoord[0]);\n  const tileSize = toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);\n  return [\n    origin[0] + (tileCoord[1] + 0.5) * tileSize[0] * resolution,\n    origin[1] + (tileCoord[2] + 0.5) * tileSize[1] * resolution\n  ];\n};\n\n\n/**\n * Get the extent of a tile coordinate.\n *\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/extent~Extent=} opt_extent Temporary extent object.\n * @return {module:ol/extent~Extent} Extent.\n * @api\n */\nTileGrid.prototype.getTileCoordExtent = function(tileCoord, opt_extent) {\n  const origin = this.getOrigin(tileCoord[0]);\n  const resolution = this.getResolution(tileCoord[0]);\n  const tileSize = toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);\n  const minX = origin[0] + tileCoord[1] * tileSize[0] * resolution;\n  const minY = origin[1] + tileCoord[2] * tileSize[1] * resolution;\n  const maxX = minX + tileSize[0] * resolution;\n  const maxY = minY + tileSize[1] * resolution;\n  return createOrUpdate(minX, minY, maxX, maxY, opt_extent);\n};\n\n\n/**\n * Get the tile coordinate for the given map coordinate and resolution.  This\n * method considers that coordinates that intersect tile boundaries should be\n * assigned the higher tile coordinate.\n *\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {module:ol/tilecoord~TileCoord=} opt_tileCoord Destination module:ol/tilecoord~TileCoord object.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n * @api\n */\nTileGrid.prototype.getTileCoordForCoordAndResolution = function(coordinate, resolution, opt_tileCoord) {\n  return this.getTileCoordForXYAndResolution_(\n    coordinate[0], coordinate[1], resolution, false, opt_tileCoord);\n};\n\n\n/**\n * Note that this method should not be called for resolutions that correspond\n * to an integer zoom level.  Instead call the `getTileCoordForXYAndZ_` method.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {number} resolution Resolution (for a non-integer zoom level).\n * @param {boolean} reverseIntersectionPolicy Instead of letting edge\n *     intersections go to the higher tile coordinate, let edge intersections\n *     go to the lower tile coordinate.\n * @param {module:ol/tilecoord~TileCoord=} opt_tileCoord Temporary module:ol/tilecoord~TileCoord object.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n * @private\n */\nTileGrid.prototype.getTileCoordForXYAndResolution_ = function(\n  x, y, resolution, reverseIntersectionPolicy, opt_tileCoord) {\n  const z = this.getZForResolution(resolution);\n  const scale = resolution / this.getResolution(z);\n  const origin = this.getOrigin(z);\n  const tileSize = toSize(this.getTileSize(z), this.tmpSize_);\n\n  const adjustX = reverseIntersectionPolicy ? 0.5 : 0;\n  const adjustY = reverseIntersectionPolicy ? 0 : 0.5;\n  const xFromOrigin = Math.floor((x - origin[0]) / resolution + adjustX);\n  const yFromOrigin = Math.floor((y - origin[1]) / resolution + adjustY);\n  let tileCoordX = scale * xFromOrigin / tileSize[0];\n  let tileCoordY = scale * yFromOrigin / tileSize[1];\n\n  if (reverseIntersectionPolicy) {\n    tileCoordX = Math.ceil(tileCoordX) - 1;\n    tileCoordY = Math.ceil(tileCoordY) - 1;\n  } else {\n    tileCoordX = Math.floor(tileCoordX);\n    tileCoordY = Math.floor(tileCoordY);\n  }\n\n  return createOrUpdateTileCoord(z, tileCoordX, tileCoordY, opt_tileCoord);\n};\n\n\n/**\n * Although there is repetition between this method and `getTileCoordForXYAndResolution_`,\n * they should have separate implementations.  This method is for integer zoom\n * levels.  The other method should only be called for resolutions corresponding\n * to non-integer zoom levels.\n * @param {number} x Map x coordinate.\n * @param {number} y Map y coordinate.\n * @param {number} z Integer zoom level.\n * @param {boolean} reverseIntersectionPolicy Instead of letting edge\n *     intersections go to the higher tile coordinate, let edge intersections\n *     go to the lower tile coordinate.\n * @param {module:ol/tilecoord~TileCoord=} opt_tileCoord Temporary module:ol/tilecoord~TileCoord object.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n * @private\n */\nTileGrid.prototype.getTileCoordForXYAndZ_ = function(x, y, z, reverseIntersectionPolicy, opt_tileCoord) {\n  const origin = this.getOrigin(z);\n  const resolution = this.getResolution(z);\n  const tileSize = toSize(this.getTileSize(z), this.tmpSize_);\n\n  const adjustX = reverseIntersectionPolicy ? 0.5 : 0;\n  const adjustY = reverseIntersectionPolicy ? 0 : 0.5;\n  const xFromOrigin = Math.floor((x - origin[0]) / resolution + adjustX);\n  const yFromOrigin = Math.floor((y - origin[1]) / resolution + adjustY);\n  let tileCoordX = xFromOrigin / tileSize[0];\n  let tileCoordY = yFromOrigin / tileSize[1];\n\n  if (reverseIntersectionPolicy) {\n    tileCoordX = Math.ceil(tileCoordX) - 1;\n    tileCoordY = Math.ceil(tileCoordY) - 1;\n  } else {\n    tileCoordX = Math.floor(tileCoordX);\n    tileCoordY = Math.floor(tileCoordY);\n  }\n\n  return createOrUpdateTileCoord(z, tileCoordX, tileCoordY, opt_tileCoord);\n};\n\n\n/**\n * Get a tile coordinate given a map coordinate and zoom level.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} z Zoom level.\n * @param {module:ol/tilecoord~TileCoord=} opt_tileCoord Destination module:ol/tilecoord~TileCoord object.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n * @api\n */\nTileGrid.prototype.getTileCoordForCoordAndZ = function(coordinate, z, opt_tileCoord) {\n  return this.getTileCoordForXYAndZ_(\n    coordinate[0], coordinate[1], z, false, opt_tileCoord);\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @return {number} Tile resolution.\n */\nTileGrid.prototype.getTileCoordResolution = function(tileCoord) {\n  return this.resolutions_[tileCoord[0]];\n};\n\n\n/**\n * Get the tile size for a zoom level. The type of the return value matches the\n * `tileSize` or `tileSizes` that the tile grid was configured with. To always\n * get an `module:ol/size~Size`, run the result through `module:ol/size~Size.toSize()`.\n * @param {number} z Z.\n * @return {number|module:ol/size~Size} Tile size.\n * @api\n */\nTileGrid.prototype.getTileSize = function(z) {\n  if (this.tileSize_) {\n    return this.tileSize_;\n  } else {\n    return this.tileSizes_[z];\n  }\n};\n\n\n/**\n * @param {number} z Zoom level.\n * @return {module:ol/TileRange} Extent tile range for the specified zoom level.\n */\nTileGrid.prototype.getFullTileRange = function(z) {\n  if (!this.fullTileRanges_) {\n    return null;\n  } else {\n    return this.fullTileRanges_[z];\n  }\n};\n\n\n/**\n * @param {number} resolution Resolution.\n * @param {number=} opt_direction If 0, the nearest resolution will be used.\n *     If 1, the nearest lower resolution will be used. If -1, the nearest\n *     higher resolution will be used. Default is 0.\n * @return {number} Z.\n * @api\n */\nTileGrid.prototype.getZForResolution = function(resolution, opt_direction) {\n  const z = linearFindNearest(this.resolutions_, resolution, opt_direction || 0);\n  return clamp(z, this.minZoom, this.maxZoom);\n};\n\n\n/**\n * @param {!module:ol/extent~Extent} extent Extent for this tile grid.\n * @private\n */\nTileGrid.prototype.calculateTileRanges_ = function(extent) {\n  const length = this.resolutions_.length;\n  const fullTileRanges = new Array(length);\n  for (let z = this.minZoom; z < length; ++z) {\n    fullTileRanges[z] = this.getTileRangeForExtentAndZ(extent, z);\n  }\n  this.fullTileRanges_ = fullTileRanges;\n};\nexport default TileGrid;\n","/**\n * @module ol/tilegrid\n */\nimport {DEFAULT_MAX_ZOOM, DEFAULT_TILE_SIZE} from './tilegrid/common.js';\nimport {toSize} from './size.js';\nimport {containsCoordinate, createOrUpdate, getCorner, getHeight, getWidth} from './extent.js';\nimport Corner from './extent/Corner.js';\nimport {assign} from './obj.js';\nimport {get as getProjection, METERS_PER_UNIT} from './proj.js';\nimport Units from './proj/Units.js';\nimport TileGrid from './tilegrid/TileGrid.js';\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {!module:ol/tilegrid/TileGrid} Default tile grid for the\n * passed projection.\n */\nexport function getForProjection(projection) {\n  let tileGrid = projection.getDefaultTileGrid();\n  if (!tileGrid) {\n    tileGrid = createForProjection(projection);\n    projection.setDefaultTileGrid(tileGrid);\n  }\n  return tileGrid;\n}\n\n\n/**\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate.\n */\nexport function wrapX(tileGrid, tileCoord, projection) {\n  const z = tileCoord[0];\n  const center = tileGrid.getTileCoordCenter(tileCoord);\n  const projectionExtent = extentFromProjection(projection);\n  if (!containsCoordinate(projectionExtent, center)) {\n    const worldWidth = getWidth(projectionExtent);\n    const worldsAway = Math.ceil((projectionExtent[0] - center[0]) / worldWidth);\n    center[0] += worldWidth * worldsAway;\n    return tileGrid.getTileCoordForCoordAndZ(center, z);\n  } else {\n    return tileCoord;\n  }\n}\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number=} opt_maxZoom Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|module:ol/size~Size=} opt_tileSize Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @param {module:ol/extent/Corner=} opt_corner Extent corner (default is `'top-left'`).\n * @return {!module:ol/tilegrid/TileGrid} TileGrid instance.\n */\nexport function createForExtent(extent, opt_maxZoom, opt_tileSize, opt_corner) {\n  const corner = opt_corner !== undefined ? opt_corner : Corner.TOP_LEFT;\n\n  const resolutions = resolutionsFromExtent(extent, opt_maxZoom, opt_tileSize);\n\n  return new TileGrid({\n    extent: extent,\n    origin: getCorner(extent, corner),\n    resolutions: resolutions,\n    tileSize: opt_tileSize\n  });\n}\n\n\n/**\n * @typedef {Object} XYZOptions\n * @property {module:ol/extent~Extent} [extent] Extent for the tile grid. The origin for an XYZ tile grid is the\n * top-left corner of the extent. The zero level of the grid is defined by the resolution at which one tile fits in the\n * provided extent. If not provided, the extent of the EPSG:3857 projection is used.\n * @property {number} [maxZoom] Maximum zoom. The default is `42`. This determines the number of levels\n * in the grid set. For example, a `maxZoom` of 21 means there are 22 levels in the grid set.\n * @property {number} [minZoom=0] Minimum zoom.\n * @property {number|module:ol/size~Size} [tileSize=[256, 256]] Tile size in pixels.\n */\n\n\n/**\n * Creates a tile grid with a standard XYZ tiling scheme.\n * @param {module:ol/tilegrid~XYZOptions=} opt_options Tile grid options.\n * @return {!module:ol/tilegrid/TileGrid} Tile grid instance.\n * @api\n */\nexport function createXYZ(opt_options) {\n  const options = /** @type {module:ol/tilegrid/TileGrid~Options} */ ({});\n  assign(options, opt_options !== undefined ?\n    opt_options : /** @type {module:ol/tilegrid~XYZOptions} */ ({}));\n  if (options.extent === undefined) {\n    options.extent = getProjection('EPSG:3857').getExtent();\n  }\n  options.resolutions = resolutionsFromExtent(\n    options.extent, options.maxZoom, options.tileSize);\n  delete options.maxZoom;\n\n  return new TileGrid(options);\n}\n\n\n/**\n * Create a resolutions array from an extent.  A zoom factor of 2 is assumed.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number=} opt_maxZoom Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|module:ol/size~Size=} opt_tileSize Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @return {!Array.<number>} Resolutions array.\n */\nfunction resolutionsFromExtent(extent, opt_maxZoom, opt_tileSize) {\n  const maxZoom = opt_maxZoom !== undefined ?\n    opt_maxZoom : DEFAULT_MAX_ZOOM;\n\n  const height = getHeight(extent);\n  const width = getWidth(extent);\n\n  const tileSize = toSize(opt_tileSize !== undefined ?\n    opt_tileSize : DEFAULT_TILE_SIZE);\n  const maxResolution = Math.max(\n    width / tileSize[0], height / tileSize[1]);\n\n  const length = maxZoom + 1;\n  const resolutions = new Array(length);\n  for (let z = 0; z < length; ++z) {\n    resolutions[z] = maxResolution / Math.pow(2, z);\n  }\n  return resolutions;\n}\n\n\n/**\n * @param {module:ol/proj~ProjectionLike} projection Projection.\n * @param {number=} opt_maxZoom Maximum zoom level (default is\n *     DEFAULT_MAX_ZOOM).\n * @param {number|module:ol/size~Size=} opt_tileSize Tile size (default uses\n *     DEFAULT_TILE_SIZE).\n * @param {module:ol/extent/Corner=} opt_corner Extent corner (default is `'top-left'`).\n * @return {!module:ol/tilegrid/TileGrid} TileGrid instance.\n */\nexport function createForProjection(projection, opt_maxZoom, opt_tileSize, opt_corner) {\n  const extent = extentFromProjection(projection);\n  return createForExtent(extent, opt_maxZoom, opt_tileSize, opt_corner);\n}\n\n\n/**\n * Generate a tile grid extent from a projection.  If the projection has an\n * extent, it is used.  If not, a global extent is assumed.\n * @param {module:ol/proj~ProjectionLike} projection Projection.\n * @return {module:ol/extent~Extent} Extent.\n */\nexport function extentFromProjection(projection) {\n  projection = getProjection(projection);\n  let extent = projection.getExtent();\n  if (!extent) {\n    const half = 180 * METERS_PER_UNIT[Units.DEGREES] / projection.getMetersPerUnit();\n    extent = createOrUpdate(-half, -half, half, half);\n  }\n  return extent;\n}\n","/**\n * @module ol/source/Tile\n */\nimport {inherits} from '../util.js';\nimport {UNDEFINED} from '../functions.js';\nimport TileCache from '../TileCache.js';\nimport TileState from '../TileState.js';\nimport Event from '../events/Event.js';\nimport {equivalent} from '../proj.js';\nimport {toSize, scale as scaleSize} from '../size.js';\nimport Source from '../source/Source.js';\nimport {getKeyZXY, withinExtentAndZ} from '../tilecoord.js';\nimport {wrapX, getForProjection as getTileGridForProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions]\n * @property {number} [cacheSize]\n * @property {module:ol/extent~Extent} [extent]\n * @property {boolean} [opaque]\n * @property {number} [tilePixelRatio]\n * @property {module:ol/proj~ProjectionLike} [projection]\n * @property {module:ol/source/State} [state]\n * @property {module:ol/tilegrid/TileGrid} [tileGrid]\n * @property {boolean} [wrapX=true]\n * @property {number} [transition]\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for sources providing images divided into a tile grid.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/source/Source}\n * @param {module:ol/source/Tile~Options=} options SourceTile source options.\n * @api\n */\nconst TileSource = function(options) {\n\n  Source.call(this, {\n    attributions: options.attributions,\n    extent: options.extent,\n    projection: options.projection,\n    state: options.state,\n    wrapX: options.wrapX\n  });\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.opaque_ = options.opaque !== undefined ? options.opaque : false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.tilePixelRatio_ = options.tilePixelRatio !== undefined ?\n    options.tilePixelRatio : 1;\n\n  /**\n   * @protected\n   * @type {module:ol/tilegrid/TileGrid}\n   */\n  this.tileGrid = options.tileGrid !== undefined ? options.tileGrid : null;\n\n  /**\n   * @protected\n   * @type {module:ol/TileCache}\n   */\n  this.tileCache = new TileCache(options.cacheSize);\n\n  /**\n   * @protected\n   * @type {module:ol/size~Size}\n   */\n  this.tmpSize = [0, 0];\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.key_ = '';\n\n  /**\n   * @protected\n   * @type {module:ol/Tile~Options}\n   */\n  this.tileOptions = {transition: options.transition};\n\n};\n\ninherits(TileSource, Source);\n\n\n/**\n * @return {boolean} Can expire cache.\n */\nTileSource.prototype.canExpireCache = function() {\n  return this.tileCache.canExpireCache();\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {!Object.<string, module:ol/TileRange>} usedTiles Used tiles.\n */\nTileSource.prototype.expireCache = function(projection, usedTiles) {\n  const tileCache = this.getTileCacheForProjection(projection);\n  if (tileCache) {\n    tileCache.expireCache(usedTiles);\n  }\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {number} z Zoom level.\n * @param {module:ol/TileRange} tileRange Tile range.\n * @param {function(module:ol/Tile):(boolean|undefined)} callback Called with each\n *     loaded tile.  If the callback returns `false`, the tile will not be\n *     considered loaded.\n * @return {boolean} The tile range is fully covered with loaded tiles.\n */\nTileSource.prototype.forEachLoadedTile = function(projection, z, tileRange, callback) {\n  const tileCache = this.getTileCacheForProjection(projection);\n  if (!tileCache) {\n    return false;\n  }\n\n  let covered = true;\n  let tile, tileCoordKey, loaded;\n  for (let x = tileRange.minX; x <= tileRange.maxX; ++x) {\n    for (let y = tileRange.minY; y <= tileRange.maxY; ++y) {\n      tileCoordKey = getKeyZXY(z, x, y);\n      loaded = false;\n      if (tileCache.containsKey(tileCoordKey)) {\n        tile = /** @type {!module:ol/Tile} */ (tileCache.get(tileCoordKey));\n        loaded = tile.getState() === TileState.LOADED;\n        if (loaded) {\n          loaded = (callback(tile) !== false);\n        }\n      }\n      if (!loaded) {\n        covered = false;\n      }\n    }\n  }\n  return covered;\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {number} Gutter.\n */\nTileSource.prototype.getGutter = function(projection) {\n  return 0;\n};\n\n\n/**\n * Return the key to be used for all tiles in the source.\n * @return {string} The key for all tiles.\n * @protected\n */\nTileSource.prototype.getKey = function() {\n  return this.key_;\n};\n\n\n/**\n * Set the value to be used as the key for all tiles in the source.\n * @param {string} key The key for tiles.\n * @protected\n */\nTileSource.prototype.setKey = function(key) {\n  if (this.key_ !== key) {\n    this.key_ = key;\n    this.changed();\n  }\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {boolean} Opaque.\n */\nTileSource.prototype.getOpaque = function(projection) {\n  return this.opaque_;\n};\n\n\n/**\n * @inheritDoc\n */\nTileSource.prototype.getResolutions = function() {\n  return this.tileGrid.getResolutions();\n};\n\n\n/**\n * @abstract\n * @param {number} z Tile coordinate z.\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {!module:ol/Tile} Tile.\n */\nTileSource.prototype.getTile = function(z, x, y, pixelRatio, projection) {};\n\n\n/**\n * Return the tile grid of the tile source.\n * @return {module:ol/tilegrid/TileGrid} Tile grid.\n * @api\n */\nTileSource.prototype.getTileGrid = function() {\n  return this.tileGrid;\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {!module:ol/tilegrid/TileGrid} Tile grid.\n */\nTileSource.prototype.getTileGridForProjection = function(projection) {\n  if (!this.tileGrid) {\n    return getTileGridForProjection(projection);\n  } else {\n    return this.tileGrid;\n  }\n};\n\n\n/**\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {module:ol/TileCache} Tile cache.\n * @protected\n */\nTileSource.prototype.getTileCacheForProjection = function(projection) {\n  const thisProj = this.getProjection();\n  if (thisProj && !equivalent(thisProj, projection)) {\n    return null;\n  } else {\n    return this.tileCache;\n  }\n};\n\n\n/**\n * Get the tile pixel ratio for this source. Subclasses may override this\n * method, which is meant to return a supported pixel ratio that matches the\n * provided `pixelRatio` as close as possible.\n * @param {number} pixelRatio Pixel ratio.\n * @return {number} Tile pixel ratio.\n */\nTileSource.prototype.getTilePixelRatio = function(pixelRatio) {\n  return this.tilePixelRatio_;\n};\n\n\n/**\n * @param {number} z Z.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {module:ol/size~Size} Tile size.\n */\nTileSource.prototype.getTilePixelSize = function(z, pixelRatio, projection) {\n  const tileGrid = this.getTileGridForProjection(projection);\n  const tilePixelRatio = this.getTilePixelRatio(pixelRatio);\n  const tileSize = toSize(tileGrid.getTileSize(z), this.tmpSize);\n  if (tilePixelRatio == 1) {\n    return tileSize;\n  } else {\n    return scaleSize(tileSize, tilePixelRatio, this.tmpSize);\n  }\n};\n\n\n/**\n * Returns a tile coordinate wrapped around the x-axis. When the tile coordinate\n * is outside the resolution and extent range of the tile grid, `null` will be\n * returned.\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/proj/Projection=} opt_projection Projection.\n * @return {module:ol/tilecoord~TileCoord} Tile coordinate to be passed to the tileUrlFunction or\n *     null if no tile URL should be created for the passed `tileCoord`.\n */\nTileSource.prototype.getTileCoordForTileUrlFunction = function(tileCoord, opt_projection) {\n  const projection = opt_projection !== undefined ?\n    opt_projection : this.getProjection();\n  const tileGrid = this.getTileGridForProjection(projection);\n  if (this.getWrapX() && projection.isGlobal()) {\n    tileCoord = wrapX(tileGrid, tileCoord, projection);\n  }\n  return withinExtentAndZ(tileCoord, tileGrid) ? tileCoord : null;\n};\n\n\n/**\n * @inheritDoc\n */\nTileSource.prototype.refresh = function() {\n  this.tileCache.clear();\n  this.changed();\n};\n\n\n/**\n * Marks a tile coord as being used, without triggering a load.\n * @param {number} z Tile coordinate z.\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @param {module:ol/proj/Projection} projection Projection.\n */\nTileSource.prototype.useTile = UNDEFINED;\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Tile~TileSource} instances are instances of this\n * type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type Type.\n * @param {module:ol/Tile} tile The tile.\n */\nexport const TileSourceEvent = function(type, tile) {\n\n  Event.call(this, type);\n\n  /**\n   * The tile related to the event.\n   * @type {module:ol/Tile}\n   * @api\n   */\n  this.tile = tile;\n\n};\ninherits(TileSourceEvent, Event);\n\nexport default TileSource;\n","/**\n * @module ol/source/TileEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n\n  /**\n   * Triggered when a tile starts loading.\n   * @event module:ol/source/Tile~TileSourceEvent#tileloadstart\n   * @api\n   */\n  TILELOADSTART: 'tileloadstart',\n\n  /**\n   * Triggered when a tile finishes loading, either when its data is loaded,\n   * or when loading was aborted because the tile is no longer needed.\n   * @event module:ol/source/Tile~TileSourceEvent#tileloadend\n   * @api\n   */\n  TILELOADEND: 'tileloadend',\n\n  /**\n   * Triggered if tile loading results in an error.\n   * @event module:ol/source/Tile~TileSourceEvent#tileloaderror\n   * @api\n   */\n  TILELOADERROR: 'tileloaderror'\n\n};\n","/**\n * @module ol/source/UrlTile\n */\nimport {getUid, inherits} from '../util.js';\nimport TileState from '../TileState.js';\nimport {expandUrl, createFromTemplates, nullTileUrlFunction} from '../tileurlfunction.js';\nimport TileSource, {TileSourceEvent} from '../source/Tile.js';\nimport TileEventType from '../source/TileEventType.js';\nimport {getKeyZXY} from '../tilecoord.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions]\n * @property {number} [cacheSize]\n * @property {module:ol/extent~Extent} [extent]\n * @property {boolean} [opaque]\n * @property {module:ol/proj~ProjectionLike} [projection]\n * @property {module:ol/source/State} [state]\n * @property {module:ol/tilegrid/TileGrid} [tileGrid]\n * @property {module:ol/Tile~LoadFunction} tileLoadFunction\n * @property {number} [tilePixelRatio]\n * @property {module:ol/Tile~UrlFunction} [tileUrlFunction]\n * @property {string} [url]\n * @property {Array.<string>} [urls]\n * @property {boolean} [wrapX=true]\n * @property {number} [transition]\n */\n\n\n/**\n * @classdesc\n * Base class for sources providing tiles divided into a tile grid over http.\n *\n * @constructor\n * @abstract\n * @fires module:ol/source/TileEvent\n * @extends {module:ol/source/Tile}\n * @param {module:ol/source/UrlTile~Options=} options Image tile options.\n */\nconst UrlTile = function(options) {\n\n  TileSource.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    extent: options.extent,\n    opaque: options.opaque,\n    projection: options.projection,\n    state: options.state,\n    tileGrid: options.tileGrid,\n    tilePixelRatio: options.tilePixelRatio,\n    wrapX: options.wrapX,\n    transition: options.transition\n  });\n\n  /**\n   * @protected\n   * @type {module:ol/Tile~LoadFunction}\n   */\n  this.tileLoadFunction = options.tileLoadFunction;\n\n  /**\n   * @protected\n   * @type {module:ol/Tile~UrlFunction}\n   */\n  this.tileUrlFunction = this.fixedTileUrlFunction ?\n    this.fixedTileUrlFunction.bind(this) : nullTileUrlFunction;\n\n  /**\n   * @protected\n   * @type {!Array.<string>|null}\n   */\n  this.urls = null;\n\n  if (options.urls) {\n    this.setUrls(options.urls);\n  } else if (options.url) {\n    this.setUrl(options.url);\n  }\n  if (options.tileUrlFunction) {\n    this.setTileUrlFunction(options.tileUrlFunction);\n  }\n\n  /**\n   * @private\n   * @type {!Object.<number, boolean>}\n   */\n  this.tileLoadingKeys_ = {};\n\n};\n\ninherits(UrlTile, TileSource);\n\n\n/**\n * @type {module:ol/Tile~UrlFunction|undefined}\n * @protected\n */\nUrlTile.prototype.fixedTileUrlFunction;\n\n/**\n * Return the tile load function of the source.\n * @return {module:ol/Tile~LoadFunction} TileLoadFunction\n * @api\n */\nUrlTile.prototype.getTileLoadFunction = function() {\n  return this.tileLoadFunction;\n};\n\n\n/**\n * Return the tile URL function of the source.\n * @return {module:ol/Tile~UrlFunction} TileUrlFunction\n * @api\n */\nUrlTile.prototype.getTileUrlFunction = function() {\n  return this.tileUrlFunction;\n};\n\n\n/**\n * Return the URLs used for this source.\n * When a tileUrlFunction is used instead of url or urls,\n * null will be returned.\n * @return {!Array.<string>|null} URLs.\n * @api\n */\nUrlTile.prototype.getUrls = function() {\n  return this.urls;\n};\n\n\n/**\n * Handle tile change events.\n * @param {module:ol/events/Event} event Event.\n * @protected\n */\nUrlTile.prototype.handleTileChange = function(event) {\n  const tile = /** @type {module:ol/Tile} */ (event.target);\n  const uid = getUid(tile);\n  const tileState = tile.getState();\n  let type;\n  if (tileState == TileState.LOADING) {\n    this.tileLoadingKeys_[uid] = true;\n    type = TileEventType.TILELOADSTART;\n  } else if (uid in this.tileLoadingKeys_) {\n    delete this.tileLoadingKeys_[uid];\n    type = tileState == TileState.ERROR ? TileEventType.TILELOADERROR :\n      (tileState == TileState.LOADED || tileState == TileState.ABORT) ?\n        TileEventType.TILELOADEND : undefined;\n  }\n  if (type != undefined) {\n    this.dispatchEvent(new TileSourceEvent(type, tile));\n  }\n};\n\n\n/**\n * Set the tile load function of the source.\n * @param {module:ol/Tile~LoadFunction} tileLoadFunction Tile load function.\n * @api\n */\nUrlTile.prototype.setTileLoadFunction = function(tileLoadFunction) {\n  this.tileCache.clear();\n  this.tileLoadFunction = tileLoadFunction;\n  this.changed();\n};\n\n\n/**\n * Set the tile URL function of the source.\n * @param {module:ol/Tile~UrlFunction} tileUrlFunction Tile URL function.\n * @param {string=} opt_key Optional new tile key for the source.\n * @api\n */\nUrlTile.prototype.setTileUrlFunction = function(tileUrlFunction, opt_key) {\n  this.tileUrlFunction = tileUrlFunction;\n  this.tileCache.pruneExceptNewestZ();\n  if (typeof opt_key !== 'undefined') {\n    this.setKey(opt_key);\n  } else {\n    this.changed();\n  }\n};\n\n\n/**\n * Set the URL to use for requests.\n * @param {string} url URL.\n * @api\n */\nUrlTile.prototype.setUrl = function(url) {\n  const urls = this.urls = expandUrl(url);\n  this.setTileUrlFunction(this.fixedTileUrlFunction ?\n    this.fixedTileUrlFunction.bind(this) :\n    createFromTemplates(urls, this.tileGrid), url);\n};\n\n\n/**\n * Set the URLs to use for requests.\n * @param {Array.<string>} urls URLs.\n * @api\n */\nUrlTile.prototype.setUrls = function(urls) {\n  this.urls = urls;\n  const key = urls.join('\\n');\n  this.setTileUrlFunction(this.fixedTileUrlFunction ?\n    this.fixedTileUrlFunction.bind(this) :\n    createFromTemplates(urls, this.tileGrid), key);\n};\n\n\n/**\n * @inheritDoc\n */\nUrlTile.prototype.useTile = function(z, x, y) {\n  const tileCoordKey = getKeyZXY(z, x, y);\n  if (this.tileCache.containsKey(tileCoordKey)) {\n    this.tileCache.get(tileCoordKey);\n  }\n};\nexport default UrlTile;\n","/**\n * @module ol/source/TileImage\n */\nimport {ENABLE_RASTER_REPROJECTION} from '../reproj/common.js';\nimport {getUid, inherits} from '../util.js';\nimport ImageTile from '../ImageTile.js';\nimport TileCache from '../TileCache.js';\nimport TileState from '../TileState.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {equivalent, get as getProjection} from '../proj.js';\nimport ReprojTile from '../reproj/Tile.js';\nimport UrlTile from '../source/UrlTile.js';\nimport {getKey, getKeyZXY} from '../tilecoord.js';\nimport {getForProjection as getTileGridForProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {boolean} [opaque=true] Whether the layer is opaque.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/source/State} [state] Source state.\n * @property {module:ol/ImageTile~TileClass} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service. For example, if the tile\n * service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {module:ol/Tile~UrlFunction} [tileUrlFunction] Optional function to get tile URL given a tile coordinate and the projection.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {Array.<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX] Whether to wrap the world horizontally. The default, is to\n * request out-of-bounds tiles from the server. When set to `false`, only one\n * world will be rendered. When set to `true`, tiles will be requested for one\n * world only, but they will be wrapped horizontally to render multiple worlds.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n\n/**\n * @classdesc\n * Base class for sources providing images divided into a tile grid.\n *\n * @constructor\n * @fires module:ol/source/Tile~TileSourceEvent\n * @extends {module:ol/source/UrlTile}\n * @param {module:ol/source/TileImage~Options=} options Image tile options.\n * @api\n */\nconst TileImage = function(options) {\n\n  UrlTile.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    extent: options.extent,\n    opaque: options.opaque,\n    projection: options.projection,\n    state: options.state,\n    tileGrid: options.tileGrid,\n    tileLoadFunction: options.tileLoadFunction ?\n      options.tileLoadFunction : defaultTileLoadFunction,\n    tilePixelRatio: options.tilePixelRatio,\n    tileUrlFunction: options.tileUrlFunction,\n    url: options.url,\n    urls: options.urls,\n    wrapX: options.wrapX,\n    transition: options.transition\n  });\n\n  /**\n   * @protected\n   * @type {?string}\n   */\n  this.crossOrigin =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n  /**\n   * @protected\n   * @type {function(new: module:ol/ImageTile, module:ol/tilecoord~TileCoord, module:ol/TileState, string,\n   *        ?string, module:ol/Tile~LoadFunction, module:ol/Tile~Options=)}\n   */\n  this.tileClass = options.tileClass !== undefined ?\n    options.tileClass : ImageTile;\n\n  /**\n   * @protected\n   * @type {!Object.<string, module:ol/TileCache>}\n   */\n  this.tileCacheForProjection = {};\n\n  /**\n   * @protected\n   * @type {!Object.<string, module:ol/tilegrid/TileGrid>}\n   */\n  this.tileGridForProjection = {};\n\n  /**\n   * @private\n   * @type {number|undefined}\n   */\n  this.reprojectionErrorThreshold_ = options.reprojectionErrorThreshold;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderReprojectionEdges_ = false;\n};\n\ninherits(TileImage, UrlTile);\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.canExpireCache = function() {\n  if (!ENABLE_RASTER_REPROJECTION) {\n    return UrlTile.prototype.canExpireCache.call(this);\n  }\n  if (this.tileCache.canExpireCache()) {\n    return true;\n  } else {\n    for (const key in this.tileCacheForProjection) {\n      if (this.tileCacheForProjection[key].canExpireCache()) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.expireCache = function(projection, usedTiles) {\n  if (!ENABLE_RASTER_REPROJECTION) {\n    UrlTile.prototype.expireCache.call(this, projection, usedTiles);\n    return;\n  }\n  const usedTileCache = this.getTileCacheForProjection(projection);\n\n  this.tileCache.expireCache(this.tileCache == usedTileCache ? usedTiles : {});\n  for (const id in this.tileCacheForProjection) {\n    const tileCache = this.tileCacheForProjection[id];\n    tileCache.expireCache(tileCache == usedTileCache ? usedTiles : {});\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.getGutter = function(projection) {\n  if (ENABLE_RASTER_REPROJECTION &&\n      this.getProjection() && projection && !equivalent(this.getProjection(), projection)) {\n    return 0;\n  } else {\n    return this.getGutterInternal();\n  }\n};\n\n\n/**\n * @protected\n * @return {number} Gutter.\n */\nTileImage.prototype.getGutterInternal = function() {\n  return 0;\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.getOpaque = function(projection) {\n  if (ENABLE_RASTER_REPROJECTION &&\n      this.getProjection() && projection && !equivalent(this.getProjection(), projection)) {\n    return false;\n  } else {\n    return UrlTile.prototype.getOpaque.call(this, projection);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.getTileGridForProjection = function(projection) {\n  if (!ENABLE_RASTER_REPROJECTION) {\n    return UrlTile.prototype.getTileGridForProjection.call(this, projection);\n  }\n  const thisProj = this.getProjection();\n  if (this.tileGrid && (!thisProj || equivalent(thisProj, projection))) {\n    return this.tileGrid;\n  } else {\n    const projKey = getUid(projection).toString();\n    if (!(projKey in this.tileGridForProjection)) {\n      this.tileGridForProjection[projKey] = getTileGridForProjection(projection);\n    }\n    return (\n      /** @type {!module:ol/tilegrid/TileGrid} */ (this.tileGridForProjection[projKey])\n    );\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.getTileCacheForProjection = function(projection) {\n  if (!ENABLE_RASTER_REPROJECTION) {\n    return UrlTile.prototype.getTileCacheForProjection.call(this, projection);\n  }\n  const thisProj = this.getProjection(); if (!thisProj || equivalent(thisProj, projection)) {\n    return this.tileCache;\n  } else {\n    const projKey = getUid(projection).toString();\n    if (!(projKey in this.tileCacheForProjection)) {\n      this.tileCacheForProjection[projKey] = new TileCache(this.tileCache.highWaterMark);\n    }\n    return this.tileCacheForProjection[projKey];\n  }\n};\n\n\n/**\n * @param {number} z Tile coordinate z.\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {string} key The key set on the tile.\n * @return {!module:ol/Tile} Tile.\n * @private\n */\nTileImage.prototype.createTile_ = function(z, x, y, pixelRatio, projection, key) {\n  const tileCoord = [z, x, y];\n  const urlTileCoord = this.getTileCoordForTileUrlFunction(\n    tileCoord, projection);\n  const tileUrl = urlTileCoord ?\n    this.tileUrlFunction(urlTileCoord, pixelRatio, projection) : undefined;\n  const tile = new this.tileClass(\n    tileCoord,\n    tileUrl !== undefined ? TileState.IDLE : TileState.EMPTY,\n    tileUrl !== undefined ? tileUrl : '',\n    this.crossOrigin,\n    this.tileLoadFunction,\n    this.tileOptions);\n  tile.key = key;\n  listen(tile, EventType.CHANGE,\n    this.handleTileChange, this);\n  return tile;\n};\n\n\n/**\n * @inheritDoc\n */\nTileImage.prototype.getTile = function(z, x, y, pixelRatio, projection) {\n  const sourceProjection = /** @type {!module:ol/proj/Projection} */ (this.getProjection());\n  if (!ENABLE_RASTER_REPROJECTION ||\n      !sourceProjection || !projection || equivalent(sourceProjection, projection)) {\n    return this.getTileInternal(z, x, y, pixelRatio, sourceProjection || projection);\n  } else {\n    const cache = this.getTileCacheForProjection(projection);\n    const tileCoord = [z, x, y];\n    let tile;\n    const tileCoordKey = getKey(tileCoord);\n    if (cache.containsKey(tileCoordKey)) {\n      tile = /** @type {!module:ol/Tile} */ (cache.get(tileCoordKey));\n    }\n    const key = this.getKey();\n    if (tile && tile.key == key) {\n      return tile;\n    } else {\n      const sourceTileGrid = this.getTileGridForProjection(sourceProjection);\n      const targetTileGrid = this.getTileGridForProjection(projection);\n      const wrappedTileCoord =\n          this.getTileCoordForTileUrlFunction(tileCoord, projection);\n      const newTile = new ReprojTile(\n        sourceProjection, sourceTileGrid,\n        projection, targetTileGrid,\n        tileCoord, wrappedTileCoord, this.getTilePixelRatio(pixelRatio),\n        this.getGutterInternal(),\n        function(z, x, y, pixelRatio) {\n          return this.getTileInternal(z, x, y, pixelRatio, sourceProjection);\n        }.bind(this), this.reprojectionErrorThreshold_,\n        this.renderReprojectionEdges_);\n      newTile.key = key;\n\n      if (tile) {\n        newTile.interimTile = tile;\n        newTile.refreshInterimChain();\n        cache.replace(tileCoordKey, newTile);\n      } else {\n        cache.set(tileCoordKey, newTile);\n      }\n      return newTile;\n    }\n  }\n};\n\n\n/**\n * @param {number} z Tile coordinate z.\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @param {number} pixelRatio Pixel ratio.\n * @param {!module:ol/proj/Projection} projection Projection.\n * @return {!module:ol/Tile} Tile.\n * @protected\n */\nTileImage.prototype.getTileInternal = function(z, x, y, pixelRatio, projection) {\n  let tile = null;\n  const tileCoordKey = getKeyZXY(z, x, y);\n  const key = this.getKey();\n  if (!this.tileCache.containsKey(tileCoordKey)) {\n    tile = this.createTile_(z, x, y, pixelRatio, projection, key);\n    this.tileCache.set(tileCoordKey, tile);\n  } else {\n    tile = this.tileCache.get(tileCoordKey);\n    if (tile.key != key) {\n      // The source's params changed. If the tile has an interim tile and if we\n      // can use it then we use it. Otherwise we create a new tile.  In both\n      // cases we attempt to assign an interim tile to the new tile.\n      const interimTile = tile;\n      tile = this.createTile_(z, x, y, pixelRatio, projection, key);\n\n      //make the new tile the head of the list,\n      if (interimTile.getState() == TileState.IDLE) {\n        //the old tile hasn't begun loading yet, and is now outdated, so we can simply discard it\n        tile.interimTile = interimTile.interimTile;\n      } else {\n        tile.interimTile = interimTile;\n      }\n      tile.refreshInterimChain();\n      this.tileCache.replace(tileCoordKey, tile);\n    }\n  }\n  return tile;\n};\n\n\n/**\n * Sets whether to render reprojection edges or not (usually for debugging).\n * @param {boolean} render Render the edges.\n * @api\n */\nTileImage.prototype.setRenderReprojectionEdges = function(render) {\n  if (!ENABLE_RASTER_REPROJECTION ||\n      this.renderReprojectionEdges_ == render) {\n    return;\n  }\n  this.renderReprojectionEdges_ = render;\n  for (const id in this.tileCacheForProjection) {\n    this.tileCacheForProjection[id].clear();\n  }\n  this.changed();\n};\n\n\n/**\n * Sets the tile grid to use when reprojecting the tiles to the given\n * projection instead of the default tile grid for the projection.\n *\n * This can be useful when the default tile grid cannot be created\n * (e.g. projection has no extent defined) or\n * for optimization reasons (custom tile size, resolutions, ...).\n *\n * @param {module:ol/proj~ProjectionLike} projection Projection.\n * @param {module:ol/tilegrid/TileGrid} tilegrid Tile grid to use for the projection.\n * @api\n */\nTileImage.prototype.setTileGridForProjection = function(projection, tilegrid) {\n  if (ENABLE_RASTER_REPROJECTION) {\n    const proj = getProjection(projection);\n    if (proj) {\n      const projKey = getUid(proj).toString();\n      if (!(projKey in this.tileGridForProjection)) {\n        this.tileGridForProjection[projKey] = tilegrid;\n      }\n    }\n  }\n};\n\n\n/**\n * @param {module:ol/ImageTile} imageTile Image tile.\n * @param {string} src Source.\n */\nfunction defaultTileLoadFunction(imageTile, src) {\n  imageTile.getImage().src = src;\n}\n\nexport default TileImage;\n","/**\n * @module ol/source/BingMaps\n */\nimport {inherits} from '../util.js';\nimport {createFromTileUrlFunctions} from '../tileurlfunction.js';\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport SourceState from '../source/State.js';\nimport TileImage from '../source/TileImage.js';\nimport {createOrUpdate, quadKey} from '../tilecoord.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {number} [cacheSize=2048] Cache size.\n * @property {boolean} [hidpi=false] If `true` hidpi tiles will be requested.\n * @property {string} [culture='en-us'] Culture code.\n * @property {string} key Bing Maps API key. Get yours at http://www.bingmapsportal.com/.\n * @property {string} imagerySet Type of imagery.\n * @property {number} [maxZoom=21] Max zoom. Default is what's advertized by the BingMaps service.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n/**\n * @classdesc\n * Layer source for Bing Maps tile data.\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/BingMaps~Options=} options Bing Maps options.\n * @api\n */\nconst BingMaps = function(options) {\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hidpi_ = options.hidpi !== undefined ? options.hidpi : false;\n\n  TileImage.call(this, {\n    cacheSize: options.cacheSize,\n    crossOrigin: 'anonymous',\n    opaque: true,\n    projection: getProjection('EPSG:3857'),\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    state: SourceState.LOADING,\n    tileLoadFunction: options.tileLoadFunction,\n    tilePixelRatio: this.hidpi_ ? 2 : 1,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    transition: options.transition\n  });\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.culture_ = options.culture !== undefined ? options.culture : 'en-us';\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.maxZoom_ = options.maxZoom !== undefined ? options.maxZoom : -1;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.apiKey_ = options.key;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.imagerySet_ = options.imagerySet;\n\n  const url = 'https://dev.virtualearth.net/REST/v1/Imagery/Metadata/' +\n      this.imagerySet_ +\n      '?uriScheme=https&include=ImageryProviders&key=' + this.apiKey_ +\n      '&c=' + this.culture_;\n\n  requestJSONP(url, this.handleImageryMetadataResponse.bind(this), undefined,\n    'jsonp');\n\n};\n\ninherits(BingMaps, TileImage);\n\n\n/**\n * The attribution containing a link to the Microsoft Bing Maps Platform APIs\n * Terms Of Use.\n * @const\n * @type {string}\n */\nconst TOS_ATTRIBUTION = '<a class=\"ol-attribution-bing-tos\" ' +\n      'href=\"https://www.microsoft.com/maps/product/terms.html\">' +\n      'Terms of Use</a>';\n\n\n/**\n * Get the api key used for this source.\n *\n * @return {string} The api key.\n * @api\n */\nBingMaps.prototype.getApiKey = function() {\n  return this.apiKey_;\n};\n\n\n/**\n * Get the imagery set associated with this source.\n *\n * @return {string} The imagery set.\n * @api\n */\nBingMaps.prototype.getImagerySet = function() {\n  return this.imagerySet_;\n};\n\n\n/**\n * @param {BingMapsImageryMetadataResponse} response Response.\n */\nBingMaps.prototype.handleImageryMetadataResponse = function(response) {\n  if (response.statusCode != 200 ||\n      response.statusDescription != 'OK' ||\n      response.authenticationResultCode != 'ValidCredentials' ||\n      response.resourceSets.length != 1 ||\n      response.resourceSets[0].resources.length != 1) {\n    this.setState(SourceState.ERROR);\n    return;\n  }\n\n  const resource = response.resourceSets[0].resources[0];\n  const maxZoom = this.maxZoom_ == -1 ? resource.zoomMax : this.maxZoom_;\n\n  const sourceProjection = this.getProjection();\n  const extent = extentFromProjection(sourceProjection);\n  const tileSize = resource.imageWidth == resource.imageHeight ?\n    resource.imageWidth : [resource.imageWidth, resource.imageHeight];\n  const tileGrid = createXYZ({\n    extent: extent,\n    minZoom: resource.zoomMin,\n    maxZoom: maxZoom,\n    tileSize: tileSize / (this.hidpi_ ? 2 : 1)\n  });\n  this.tileGrid = tileGrid;\n\n  const culture = this.culture_;\n  const hidpi = this.hidpi_;\n  this.tileUrlFunction = createFromTileUrlFunctions(\n    resource.imageUrlSubdomains.map(function(subdomain) {\n      const quadKeyTileCoord = [0, 0, 0];\n      const imageUrl = resource.imageUrl\n        .replace('{subdomain}', subdomain)\n        .replace('{culture}', culture);\n      return (\n        /**\n         * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n         * @param {number} pixelRatio Pixel ratio.\n         * @param {module:ol/proj/Projection} projection Projection.\n         * @return {string|undefined} Tile URL.\n         */\n        function(tileCoord, pixelRatio, projection) {\n          if (!tileCoord) {\n            return undefined;\n          } else {\n            createOrUpdate(tileCoord[0], tileCoord[1], -tileCoord[2] - 1, quadKeyTileCoord);\n            let url = imageUrl;\n            if (hidpi) {\n              url += '&dpi=d1&device=mobile';\n            }\n            return url.replace('{quadkey}', quadKey(quadKeyTileCoord));\n          }\n        }\n      );\n    }));\n\n  if (resource.imageryProviders) {\n    const transform = getTransformFromProjections(\n      getProjection('EPSG:4326'), this.getProjection());\n\n    this.setAttributions(function(frameState) {\n      const attributions = [];\n      const zoom = frameState.viewState.zoom;\n      resource.imageryProviders.map(function(imageryProvider) {\n        let intersecting = false;\n        const coverageAreas = imageryProvider.coverageAreas;\n        for (let i = 0, ii = coverageAreas.length; i < ii; ++i) {\n          const coverageArea = coverageAreas[i];\n          if (zoom >= coverageArea.zoomMin && zoom <= coverageArea.zoomMax) {\n            const bbox = coverageArea.bbox;\n            const epsg4326Extent = [bbox[1], bbox[0], bbox[3], bbox[2]];\n            const extent = applyTransform(epsg4326Extent, transform);\n            if (intersects(extent, frameState.extent)) {\n              intersecting = true;\n              break;\n            }\n          }\n        }\n        if (intersecting) {\n          attributions.push(imageryProvider.attribution);\n        }\n      });\n\n      attributions.push(TOS_ATTRIBUTION);\n      return attributions;\n    });\n  }\n\n  this.setState(SourceState.READY);\n};\nexport default BingMaps;\n","/**\n * @module ol/source/XYZ\n */\nimport {inherits} from '../util.js';\nimport TileImage from '../source/TileImage.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {boolean} [opaque=true] Whether the layer is opaque.\n * @property {module:ol/proj~ProjectionLike} [projection='EPSG:3857'] Projection.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {number} [maxZoom=18] Optional max zoom level.\n * @property {number} [minZoom=0] Optional min zoom level.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service.\n * For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {number|module:ol/size~Size} [tileSize=[256, 256]] The tile size used by the tile service.\n * @property {module:ol/Tile~UrlFunction} [tileUrlFunction] Optional function to get\n * tile URL given a tile coordinate and the projection.\n * Required if url or urls are not provided.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`,\n * and `{z}` placeholders. A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`,\n * may be used instead of defining each one separately in the `urls` option.\n * @property {Array.<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data with URLs in a set XYZ format that are\n * defined in a URL template. By default, this follows the widely-used\n * Google grid where `x` 0 and `y` 0 are in the top left. Grids like\n * TMS where `x` 0 and `y` 0 are in the bottom left can be used by\n * using the `{-y}` placeholder in the URL template, so long as the\n * source does not have a custom tile grid. In this case,\n * {@link module:ol/source/TileImage} can be used with a `tileUrlFunction`\n * such as:\n *\n *  tileUrlFunction: function(coordinate) {\n *    return 'http://mapserver.com/' + coordinate[0] + '/' +\n *        coordinate[1] + '/' + coordinate[2] + '.png';\n *    }\n *\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/XYZ~Options=} opt_options XYZ options.\n * @api\n */\nconst XYZ = function(opt_options) {\n  const options = opt_options || {};\n  const projection = options.projection !== undefined ?\n    options.projection : 'EPSG:3857';\n\n  const tileGrid = options.tileGrid !== undefined ? options.tileGrid :\n    createXYZ({\n      extent: extentFromProjection(projection),\n      maxZoom: options.maxZoom,\n      minZoom: options.minZoom,\n      tileSize: options.tileSize\n    });\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    opaque: options.opaque,\n    projection: projection,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileGrid: tileGrid,\n    tileLoadFunction: options.tileLoadFunction,\n    tilePixelRatio: options.tilePixelRatio,\n    tileUrlFunction: options.tileUrlFunction,\n    url: options.url,\n    urls: options.urls,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    transition: options.transition\n  });\n\n};\n\ninherits(XYZ, TileImage);\nexport default XYZ;\n","/**\n * @module ol/source/CartoDB\n */\nimport {inherits} from '../util.js';\nimport {assign} from '../obj.js';\nimport SourceState from '../source/State.js';\nimport XYZ from '../source/XYZ.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {module:ol/proj~ProjectionLike} [projection='EPSG:3857'] Projection.\n * @property {number} [maxZoom=18] Max zoom.\n * @property {number} [minZoom] Minimum zoom.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {Object} [config] If using anonymous maps, the CartoDB config to use. See\n * {@link http://docs.cartodb.com/cartodb-platform/maps-api/anonymous-maps/}\n * for more detail.\n * If using named maps, a key-value lookup with the template parameters.\n * See {@link http://docs.cartodb.com/cartodb-platform/maps-api/named-maps/}\n * for more detail.\n * @property {string} [map] If using named maps, this will be the name of the template to load.\n * See {@link http://docs.cartodb.com/cartodb-platform/maps-api/named-maps/}\n * for more detail.\n * @property {string} account If using named maps, this will be the name of the template to load.\n */\n\n\n/**\n * @classdesc\n * Layer source for the CartoDB Maps API.\n *\n * @constructor\n * @extends {module:ol/source/XYZ}\n * @param {module:ol/source/CartoDB~Options=} options CartoDB options.\n * @api\n */\nconst CartoDB = function(options) {\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.account_ = options.account;\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.mapId_ = options.map || '';\n\n  /**\n   * @type {!Object}\n   * @private\n   */\n  this.config_ = options.config || {};\n\n  /**\n   * @type {!Object.<string, CartoDBLayerInfo>}\n   * @private\n   */\n  this.templateCache_ = {};\n\n  XYZ.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    maxZoom: options.maxZoom !== undefined ? options.maxZoom : 18,\n    minZoom: options.minZoom,\n    projection: options.projection,\n    state: SourceState.LOADING,\n    wrapX: options.wrapX\n  });\n  this.initializeMap_();\n};\n\ninherits(CartoDB, XYZ);\n\n\n/**\n * Returns the current config.\n * @return {!Object} The current configuration.\n * @api\n */\nCartoDB.prototype.getConfig = function() {\n  return this.config_;\n};\n\n\n/**\n * Updates the carto db config.\n * @param {Object} config a key-value lookup. Values will replace current values\n *     in the config.\n * @api\n */\nCartoDB.prototype.updateConfig = function(config) {\n  assign(this.config_, config);\n  this.initializeMap_();\n};\n\n\n/**\n * Sets the CartoDB config\n * @param {Object} config In the case of anonymous maps, a CartoDB configuration\n *     object.\n * If using named maps, a key-value lookup with the template parameters.\n * @api\n */\nCartoDB.prototype.setConfig = function(config) {\n  this.config_ = config || {};\n  this.initializeMap_();\n};\n\n\n/**\n * Issue a request to initialize the CartoDB map.\n * @private\n */\nCartoDB.prototype.initializeMap_ = function() {\n  const paramHash = JSON.stringify(this.config_);\n  if (this.templateCache_[paramHash]) {\n    this.applyTemplate_(this.templateCache_[paramHash]);\n    return;\n  }\n  let mapUrl = 'https://' + this.account_ + '.carto.com/api/v1/map';\n\n  if (this.mapId_) {\n    mapUrl += '/named/' + this.mapId_;\n  }\n\n  const client = new XMLHttpRequest();\n  client.addEventListener('load', this.handleInitResponse_.bind(this, paramHash));\n  client.addEventListener('error', this.handleInitError_.bind(this));\n  client.open('POST', mapUrl);\n  client.setRequestHeader('Content-type', 'application/json');\n  client.send(JSON.stringify(this.config_));\n};\n\n\n/**\n * Handle map initialization response.\n * @param {string} paramHash a hash representing the parameter set that was used\n *     for the request\n * @param {Event} event Event.\n * @private\n */\nCartoDB.prototype.handleInitResponse_ = function(paramHash, event) {\n  const client = /** @type {XMLHttpRequest} */ (event.target);\n  // status will be 0 for file:// urls\n  if (!client.status || client.status >= 200 && client.status < 300) {\n    let response;\n    try {\n      response = /** @type {CartoDBLayerInfo} */(JSON.parse(client.responseText));\n    } catch (err) {\n      this.setState(SourceState.ERROR);\n      return;\n    }\n    this.applyTemplate_(response);\n    this.templateCache_[paramHash] = response;\n    this.setState(SourceState.READY);\n  } else {\n    this.setState(SourceState.ERROR);\n  }\n};\n\n\n/**\n * @private\n * @param {Event} event Event.\n */\nCartoDB.prototype.handleInitError_ = function(event) {\n  this.setState(SourceState.ERROR);\n};\n\n\n/**\n * Apply the new tile urls returned by carto db\n * @param {CartoDBLayerInfo} data Result of carto db call.\n * @private\n */\nCartoDB.prototype.applyTemplate_ = function(data) {\n  const tilesUrl = 'https://' + data.cdn_url.https + '/' + this.account_ +\n      '/api/v1/map/' + data.layergroupid + '/{z}/{x}/{y}.png';\n  this.setUrl(tilesUrl);\n};\nexport default CartoDB;\n","/**\n * @module ol/source/Cluster\n */\n\nimport {getUid, inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport Feature from '../Feature.js';\nimport {scale as scaleCoordinate, add as addCoordinate} from '../coordinate.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {buffer, createEmpty, createOrUpdateFromCoordinate} from '../extent.js';\nimport Point from '../geom/Point.js';\nimport VectorSource from '../source/Vector.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [distance=20] Minimum distance in pixels between clusters.\n * @property {module:ol/extent~Extent} [extent] Extent.\n * @property {function(module:ol/Feature):module:ol/geom/Point} [geometryFunction]\n * Function that takes an {@link module:ol/Feature} as argument and returns an\n * {@link module:ol/geom/Point} as cluster calculation point for the feature. When a\n * feature should not be considered for clustering, the function should return\n * `null`. The default, which works when the underyling source contains point\n * features only, is\n * ```js\n * function(feature) {\n *   return feature.getGeometry();\n * }\n * ```\n * See {@link module:ol/geom/Polygon~Polygon#getInteriorPoint} for a way to get a cluster\n * calculation point for polygons.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {module:ol/source/Vector} source Source.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n\n/**\n * @classdesc\n * Layer source to cluster vector data. Works out of the box with point\n * geometries. For other geometry types, or if not all geometries should be\n * considered for clustering, a custom `geometryFunction` can be defined.\n *\n * @constructor\n * @param {module:ol/source/Cluster~Options=} options Cluster options.\n * @extends {module:ol/source/Vector}\n * @api\n */\nconst Cluster = function(options) {\n  VectorSource.call(this, {\n    attributions: options.attributions,\n    extent: options.extent,\n    projection: options.projection,\n    wrapX: options.wrapX\n  });\n\n  /**\n   * @type {number|undefined}\n   * @protected\n   */\n  this.resolution = undefined;\n\n  /**\n   * @type {number}\n   * @protected\n   */\n  this.distance = options.distance !== undefined ? options.distance : 20;\n\n  /**\n   * @type {Array.<module:ol/Feature>}\n   * @protected\n   */\n  this.features = [];\n\n  /**\n   * @param {module:ol/Feature} feature Feature.\n   * @return {module:ol/geom/Point} Cluster calculation point.\n   * @protected\n   */\n  this.geometryFunction = options.geometryFunction || function(feature) {\n    const geometry = /** @type {module:ol/geom/Point} */ (feature.getGeometry());\n    assert(geometry instanceof Point,\n      10); // The default `geometryFunction` can only handle `module:ol/geom/Point~Point` geometries\n    return geometry;\n  };\n\n  /**\n   * @type {module:ol/source/Vector}\n   * @protected\n   */\n  this.source = options.source;\n\n  listen(this.source, EventType.CHANGE, this.refresh, this);\n};\n\ninherits(Cluster, VectorSource);\n\n\n/**\n * Get the distance in pixels between clusters.\n * @return {number} Distance.\n * @api\n */\nCluster.prototype.getDistance = function() {\n  return this.distance;\n};\n\n\n/**\n * Get a reference to the wrapped source.\n * @return {module:ol/source/Vector} Source.\n * @api\n */\nCluster.prototype.getSource = function() {\n  return this.source;\n};\n\n\n/**\n * @inheritDoc\n */\nCluster.prototype.loadFeatures = function(extent, resolution, projection) {\n  this.source.loadFeatures(extent, resolution, projection);\n  if (resolution !== this.resolution) {\n    this.clear();\n    this.resolution = resolution;\n    this.cluster();\n    this.addFeatures(this.features);\n  }\n};\n\n\n/**\n * Set the distance in pixels between clusters.\n * @param {number} distance The distance in pixels.\n * @api\n */\nCluster.prototype.setDistance = function(distance) {\n  this.distance = distance;\n  this.refresh();\n};\n\n\n/**\n * handle the source changing\n * @override\n */\nCluster.prototype.refresh = function() {\n  this.clear();\n  this.cluster();\n  this.addFeatures(this.features);\n  VectorSource.prototype.refresh.call(this);\n};\n\n\n/**\n * @protected\n */\nCluster.prototype.cluster = function() {\n  if (this.resolution === undefined) {\n    return;\n  }\n  this.features.length = 0;\n  const extent = createEmpty();\n  const mapDistance = this.distance * this.resolution;\n  const features = this.source.getFeatures();\n\n  /**\n   * @type {!Object.<string, boolean>}\n   */\n  const clustered = {};\n\n  for (let i = 0, ii = features.length; i < ii; i++) {\n    const feature = features[i];\n    if (!(getUid(feature).toString() in clustered)) {\n      const geometry = this.geometryFunction(feature);\n      if (geometry) {\n        const coordinates = geometry.getCoordinates();\n        createOrUpdateFromCoordinate(coordinates, extent);\n        buffer(extent, mapDistance, extent);\n\n        let neighbors = this.source.getFeaturesInExtent(extent);\n        neighbors = neighbors.filter(function(neighbor) {\n          const uid = getUid(neighbor).toString();\n          if (!(uid in clustered)) {\n            clustered[uid] = true;\n            return true;\n          } else {\n            return false;\n          }\n        });\n        this.features.push(this.createCluster(neighbors));\n      }\n    }\n  }\n};\n\n\n/**\n * @param {Array.<module:ol/Feature>} features Features\n * @return {module:ol/Feature} The cluster feature.\n * @protected\n */\nCluster.prototype.createCluster = function(features) {\n  const centroid = [0, 0];\n  for (let i = features.length - 1; i >= 0; --i) {\n    const geometry = this.geometryFunction(features[i]);\n    if (geometry) {\n      addCoordinate(centroid, geometry.getCoordinates());\n    } else {\n      features.splice(i, 1);\n    }\n  }\n  scaleCoordinate(centroid, 1 / features.length);\n\n  const cluster = new Feature(new Point(centroid));\n  cluster.set('features', features);\n  return cluster;\n};\nexport default Cluster;\n","/**\n * @module ol/reproj/Image\n */\nimport {ERROR_THRESHOLD} from './common.js';\nimport {inherits} from '../util.js';\nimport ImageBase from '../ImageBase.js';\nimport ImageState from '../ImageState.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {getCenter, getIntersection, getHeight, getWidth} from '../extent.js';\nimport {calculateSourceResolution, render as renderReprojected} from '../reproj.js';\nimport Triangulation from '../reproj/Triangulation.js';\n\n\n/**\n * @typedef {function(module:ol/extent~Extent, number, number) : module:ol/ImageBase} FunctionType\n */\n\n\n/**\n * @classdesc\n * Class encapsulating single reprojected image.\n * See {@link module:ol/source/Image~ImageSource}.\n *\n * @constructor\n * @extends {module:ol/ImageBase}\n * @param {module:ol/proj/Projection} sourceProj Source projection (of the data).\n * @param {module:ol/proj/Projection} targetProj Target projection.\n * @param {module:ol/extent~Extent} targetExtent Target extent.\n * @param {number} targetResolution Target resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/reproj/Image~FunctionType} getImageFunction\n *     Function returning source images (extent, resolution, pixelRatio).\n */\nconst ReprojImage = function(sourceProj, targetProj,\n  targetExtent, targetResolution, pixelRatio, getImageFunction) {\n\n  /**\n   * @private\n   * @type {module:ol/proj/Projection}\n   */\n  this.targetProj_ = targetProj;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.maxSourceExtent_ = sourceProj.getExtent();\n  const maxTargetExtent = targetProj.getExtent();\n\n  const limitedTargetExtent = maxTargetExtent ?\n    getIntersection(targetExtent, maxTargetExtent) : targetExtent;\n\n  const targetCenter = getCenter(limitedTargetExtent);\n  const sourceResolution = calculateSourceResolution(\n    sourceProj, targetProj, targetCenter, targetResolution);\n\n  const errorThresholdInPixels = ERROR_THRESHOLD;\n\n  /**\n   * @private\n   * @type {!module:ol/reproj/Triangulation}\n   */\n  this.triangulation_ = new Triangulation(\n    sourceProj, targetProj, limitedTargetExtent, this.maxSourceExtent_,\n    sourceResolution * errorThresholdInPixels);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.targetResolution_ = targetResolution;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.targetExtent_ = targetExtent;\n\n  const sourceExtent = this.triangulation_.calculateSourceExtent();\n\n  /**\n   * @private\n   * @type {module:ol/ImageBase}\n   */\n  this.sourceImage_ =\n      getImageFunction(sourceExtent, sourceResolution, pixelRatio);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.sourcePixelRatio_ =\n      this.sourceImage_ ? this.sourceImage_.getPixelRatio() : 1;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = null;\n\n  /**\n   * @private\n   * @type {?module:ol/events~EventsKey}\n   */\n  this.sourceListenerKey_ = null;\n\n\n  let state = ImageState.LOADED;\n\n  if (this.sourceImage_) {\n    state = ImageState.IDLE;\n  }\n\n  ImageBase.call(this, targetExtent, targetResolution, this.sourcePixelRatio_, state);\n};\n\ninherits(ReprojImage, ImageBase);\n\n\n/**\n * @inheritDoc\n */\nReprojImage.prototype.disposeInternal = function() {\n  if (this.state == ImageState.LOADING) {\n    this.unlistenSource_();\n  }\n  ImageBase.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\nReprojImage.prototype.getImage = function() {\n  return this.canvas_;\n};\n\n\n/**\n * @return {module:ol/proj/Projection} Projection.\n */\nReprojImage.prototype.getProjection = function() {\n  return this.targetProj_;\n};\n\n\n/**\n * @private\n */\nReprojImage.prototype.reproject_ = function() {\n  const sourceState = this.sourceImage_.getState();\n  if (sourceState == ImageState.LOADED) {\n    const width = getWidth(this.targetExtent_) / this.targetResolution_;\n    const height = getHeight(this.targetExtent_) / this.targetResolution_;\n\n    this.canvas_ = renderReprojected(width, height, this.sourcePixelRatio_,\n      this.sourceImage_.getResolution(), this.maxSourceExtent_,\n      this.targetResolution_, this.targetExtent_, this.triangulation_, [{\n        extent: this.sourceImage_.getExtent(),\n        image: this.sourceImage_.getImage()\n      }], 0);\n  }\n  this.state = sourceState;\n  this.changed();\n};\n\n\n/**\n * @inheritDoc\n */\nReprojImage.prototype.load = function() {\n  if (this.state == ImageState.IDLE) {\n    this.state = ImageState.LOADING;\n    this.changed();\n\n    const sourceState = this.sourceImage_.getState();\n    if (sourceState == ImageState.LOADED || sourceState == ImageState.ERROR) {\n      this.reproject_();\n    } else {\n      this.sourceListenerKey_ = listen(this.sourceImage_,\n        EventType.CHANGE, function(e) {\n          const sourceState = this.sourceImage_.getState();\n          if (sourceState == ImageState.LOADED || sourceState == ImageState.ERROR) {\n            this.unlistenSource_();\n            this.reproject_();\n          }\n        }, this);\n      this.sourceImage_.load();\n    }\n  }\n};\n\n\n/**\n * @private\n */\nReprojImage.prototype.unlistenSource_ = function() {\n  unlistenByKey(/** @type {!module:ol/events~EventsKey} */ (this.sourceListenerKey_));\n  this.sourceListenerKey_ = null;\n};\nexport default ReprojImage;\n","/**\n * @module ol/source/Image\n */\nimport {ENABLE_RASTER_REPROJECTION} from '../reproj/common.js';\nimport {inherits} from '../util.js';\nimport ImageState from '../ImageState.js';\nimport {linearFindNearest} from '../array.js';\nimport Event from '../events/Event.js';\nimport {equals} from '../extent.js';\nimport {equivalent} from '../proj.js';\nimport ReprojImage from '../reproj/Image.js';\nimport Source from '../source/Source.js';\n\n\n/**\n * @enum {string}\n */\nconst ImageSourceEventType = {\n\n  /**\n   * Triggered when an image starts loading.\n   * @event ol/source/Image~ImageSourceEvent#imageloadstart\n   * @api\n   */\n  IMAGELOADSTART: 'imageloadstart',\n\n  /**\n   * Triggered when an image finishes loading.\n   * @event ol/source/Image~ImageSourceEvent#imageloadend\n   * @api\n   */\n  IMAGELOADEND: 'imageloadend',\n\n  /**\n   * Triggered if image loading results in an error.\n   * @event ol/source/Image~ImageSourceEvent#imageloaderror\n   * @api\n   */\n  IMAGELOADERROR: 'imageloaderror'\n\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Image~ImageSource} instances are instances of this\n * type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type Type.\n * @param {module:ol/Image} image The image.\n */\nconst ImageSourceEvent = function(type, image) {\n\n  Event.call(this, type);\n\n  /**\n   * The image related to the event.\n   * @type {module:ol/Image}\n   * @api\n   */\n  this.image = image;\n\n};\ninherits(ImageSourceEvent, Event);\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions]\n * @property {module:ol/extent~Extent} [extent]\n * @property {module:ol/proj~ProjectionLike} projection\n * @property {Array.<number>} [resolutions]\n * @property {module:ol/source/State} [state]\n */\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for sources providing a single image.\n *\n * @constructor\n * @abstract\n * @extends {module:ol/source/Source}\n * @param {module:ol/source/Image~Options} options Single image source options.\n * @api\n */\nconst ImageSource = function(options) {\n  Source.call(this, {\n    attributions: options.attributions,\n    extent: options.extent,\n    projection: options.projection,\n    state: options.state\n  });\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.resolutions_ = options.resolutions !== undefined ?\n    options.resolutions : null;\n\n\n  /**\n   * @private\n   * @type {module:ol/reproj/Image}\n   */\n  this.reprojectedImage_ = null;\n\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.reprojectedRevision_ = 0;\n};\n\ninherits(ImageSource, Source);\n\n\n/**\n * @return {Array.<number>} Resolutions.\n * @override\n */\nImageSource.prototype.getResolutions = function() {\n  return this.resolutions_;\n};\n\n\n/**\n * @protected\n * @param {number} resolution Resolution.\n * @return {number} Resolution.\n */\nImageSource.prototype.findNearestResolution = function(resolution) {\n  if (this.resolutions_) {\n    const idx = linearFindNearest(this.resolutions_, resolution, 0);\n    resolution = this.resolutions_[idx];\n  }\n  return resolution;\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {module:ol/ImageBase} Single image.\n */\nImageSource.prototype.getImage = function(extent, resolution, pixelRatio, projection) {\n  const sourceProjection = this.getProjection();\n  if (!ENABLE_RASTER_REPROJECTION ||\n      !sourceProjection ||\n      !projection ||\n      equivalent(sourceProjection, projection)) {\n    if (sourceProjection) {\n      projection = sourceProjection;\n    }\n    return this.getImageInternal(extent, resolution, pixelRatio, projection);\n  } else {\n    if (this.reprojectedImage_) {\n      if (this.reprojectedRevision_ == this.getRevision() &&\n          equivalent(\n            this.reprojectedImage_.getProjection(), projection) &&\n          this.reprojectedImage_.getResolution() == resolution &&\n          equals(this.reprojectedImage_.getExtent(), extent)) {\n        return this.reprojectedImage_;\n      }\n      this.reprojectedImage_.dispose();\n      this.reprojectedImage_ = null;\n    }\n\n    this.reprojectedImage_ = new ReprojImage(\n      sourceProjection, projection, extent, resolution, pixelRatio,\n      function(extent, resolution, pixelRatio) {\n        return this.getImageInternal(extent, resolution,\n          pixelRatio, sourceProjection);\n      }.bind(this));\n    this.reprojectedRevision_ = this.getRevision();\n\n    return this.reprojectedImage_;\n  }\n};\n\n\n/**\n * @abstract\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {module:ol/ImageBase} Single image.\n * @protected\n */\nImageSource.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {};\n\n\n/**\n * Handle image change events.\n * @param {module:ol/events/Event} event Event.\n * @protected\n */\nImageSource.prototype.handleImageChange = function(event) {\n  const image = /** @type {module:ol/Image} */ (event.target);\n  switch (image.getState()) {\n    case ImageState.LOADING:\n      this.dispatchEvent(\n        new ImageSourceEvent(ImageSourceEventType.IMAGELOADSTART,\n          image));\n      break;\n    case ImageState.LOADED:\n      this.dispatchEvent(\n        new ImageSourceEvent(ImageSourceEventType.IMAGELOADEND,\n          image));\n      break;\n    case ImageState.ERROR:\n      this.dispatchEvent(\n        new ImageSourceEvent(ImageSourceEventType.IMAGELOADERROR,\n          image));\n      break;\n    default:\n      // pass\n  }\n};\n\n\n/**\n * Default image load function for image sources that use module:ol/Image~Image image\n * instances.\n * @param {module:ol/Image} image Image.\n * @param {string} src Source.\n */\nexport function defaultImageLoadFunction(image, src) {\n  image.getImage().src = src;\n}\n\n\nexport default ImageSource;\n","/**\n * @module ol/uri\n */\n\n\n/**\n * Appends query parameters to a URI.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {!Object} params An object where keys are URI-encoded parameter keys,\n *     and the values are arbitrary types or arrays.\n * @return {string} The new URI.\n */\nexport function appendParams(uri, params) {\n  const keyParams = [];\n  // Skip any null or undefined parameter values\n  Object.keys(params).forEach(function(k) {\n    if (params[k] !== null && params[k] !== undefined) {\n      keyParams.push(k + '=' + encodeURIComponent(params[k]));\n    }\n  });\n  const qs = keyParams.join('&');\n  // remove any trailing ? or &\n  uri = uri.replace(/[?&]$/, '');\n  // append ? or & depending on whether uri has existing parameters\n  uri = uri.indexOf('?') === -1 ? uri + '?' : uri + '&';\n  return uri + qs;\n}\n","/**\n * @module ol/source/ImageArcGISRest\n */\nimport {inherits} from '../util.js';\nimport ImageWrapper from '../Image.js';\nimport {assert} from '../asserts.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {containsExtent, getHeight, getWidth} from '../extent.js';\nimport {assign} from '../obj.js';\nimport ImageSource, {defaultImageLoadFunction} from '../source/Image.js';\nimport {appendParams} from '../uri.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting the image from\n * the remote server.\n * @property {module:ol/Image~LoadFunction} [imageLoadFunction] Optional function to load an image given\n * a URL.\n * @property {Object.<string,*>} params ArcGIS Rest parameters. This field is optional. Service\n * defaults will be used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is\n * `IMAGE` by default. `TRANSPARENT` is `true` by default.  `BBOX, `SIZE`, `BBOXSR`, and `IMAGESR`\n * will be set dynamically. Set `LAYERS` to override the default service layer visibility. See\n * {@link http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/Export_Map/02r3000000v7000000/}\n * for further reference.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport,\n * `2` means twice the size of the map viewport, and so on.\n * @property {Array.<number>} [resolutions] Resolutions. If specified, requests will be made for\n * these resolutions only.\n * @property {string} [url] ArcGIS Rest service URL for a Map Service or Image Service. The url\n * should include /MapServer or /ImageServer.\n */\n\n\n/**\n * @classdesc\n * Source for data from ArcGIS Rest services providing single, untiled images.\n * Useful when underlying map service has labels.\n *\n * If underlying map service is not using labels,\n * take advantage of ol image caching and use\n * {@link module:ol/source/TileArcGISRest} data source.\n *\n * @constructor\n * @fires ol/source/Image~ImageSourceEvent\n * @extends {module:ol/source/Image}\n * @param {module:ol/source/ImageArcGISRest~Options=} opt_options Image ArcGIS Rest Options.\n * @api\n */\nconst ImageArcGISRest = function(opt_options) {\n\n  const options = opt_options || {};\n\n  ImageSource.call(this, {\n    attributions: options.attributions,\n    projection: options.projection,\n    resolutions: options.resolutions\n  });\n\n  /**\n   * @private\n   * @type {?string}\n   */\n  this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.url_ = options.url;\n\n  /**\n   * @private\n   * @type {module:ol/Image~LoadFunction}\n   */\n  this.imageLoadFunction_ = options.imageLoadFunction !== undefined ?\n    options.imageLoadFunction : defaultImageLoadFunction;\n\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.params_ = options.params || {};\n\n  /**\n   * @private\n   * @type {module:ol/Image}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.imageSize_ = [0, 0];\n\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n\n};\n\ninherits(ImageArcGISRest, ImageSource);\n\n\n/**\n * Get the user-provided params, i.e. those passed to the constructor through\n * the \"params\" option, and possibly updated using the updateParams method.\n * @return {Object} Params.\n * @api\n */\nImageArcGISRest.prototype.getParams = function() {\n  return this.params_;\n};\n\n\n/**\n * @inheritDoc\n */\nImageArcGISRest.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {\n\n  if (this.url_ === undefined) {\n    return null;\n  }\n\n  resolution = this.findNearestResolution(resolution);\n  pixelRatio = this.hidpi_ ? pixelRatio : 1;\n\n  const image = this.image_;\n  if (image &&\n      this.renderedRevision_ == this.getRevision() &&\n      image.getResolution() == resolution &&\n      image.getPixelRatio() == pixelRatio &&\n      containsExtent(image.getExtent(), extent)) {\n    return image;\n  }\n\n  const params = {\n    'F': 'image',\n    'FORMAT': 'PNG32',\n    'TRANSPARENT': true\n  };\n  assign(params, this.params_);\n\n  extent = extent.slice();\n  const centerX = (extent[0] + extent[2]) / 2;\n  const centerY = (extent[1] + extent[3]) / 2;\n  if (this.ratio_ != 1) {\n    const halfWidth = this.ratio_ * getWidth(extent) / 2;\n    const halfHeight = this.ratio_ * getHeight(extent) / 2;\n    extent[0] = centerX - halfWidth;\n    extent[1] = centerY - halfHeight;\n    extent[2] = centerX + halfWidth;\n    extent[3] = centerY + halfHeight;\n  }\n\n  const imageResolution = resolution / pixelRatio;\n\n  // Compute an integer width and height.\n  const width = Math.ceil(getWidth(extent) / imageResolution);\n  const height = Math.ceil(getHeight(extent) / imageResolution);\n\n  // Modify the extent to match the integer width and height.\n  extent[0] = centerX - imageResolution * width / 2;\n  extent[2] = centerX + imageResolution * width / 2;\n  extent[1] = centerY - imageResolution * height / 2;\n  extent[3] = centerY + imageResolution * height / 2;\n\n  this.imageSize_[0] = width;\n  this.imageSize_[1] = height;\n\n  const url = this.getRequestUrl_(extent, this.imageSize_, pixelRatio,\n    projection, params);\n\n  this.image_ = new ImageWrapper(extent, resolution, pixelRatio,\n    url, this.crossOrigin_, this.imageLoadFunction_);\n\n  this.renderedRevision_ = this.getRevision();\n\n  listen(this.image_, EventType.CHANGE,\n    this.handleImageChange, this);\n\n  return this.image_;\n\n};\n\n\n/**\n * Return the image load function of the source.\n * @return {module:ol/Image~LoadFunction} The image load function.\n * @api\n */\nImageArcGISRest.prototype.getImageLoadFunction = function() {\n  return this.imageLoadFunction_;\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {Object} params Params.\n * @return {string} Request URL.\n * @private\n */\nImageArcGISRest.prototype.getRequestUrl_ = function(extent, size, pixelRatio, projection, params) {\n  // ArcGIS Server only wants the numeric portion of the projection ID.\n  const srid = projection.getCode().split(':').pop();\n\n  params['SIZE'] = size[0] + ',' + size[1];\n  params['BBOX'] = extent.join(',');\n  params['BBOXSR'] = srid;\n  params['IMAGESR'] = srid;\n  params['DPI'] = Math.round(90 * pixelRatio);\n\n  const url = this.url_;\n\n  const modifiedUrl = url\n    .replace(/MapServer\\/?$/, 'MapServer/export')\n    .replace(/ImageServer\\/?$/, 'ImageServer/exportImage');\n  if (modifiedUrl == url) {\n    assert(false, 50); // `options.featureTypes` should be an Array\n  }\n  return appendParams(modifiedUrl, params);\n};\n\n\n/**\n * Return the URL used for this ArcGIS source.\n * @return {string|undefined} URL.\n * @api\n */\nImageArcGISRest.prototype.getUrl = function() {\n  return this.url_;\n};\n\n\n/**\n * Set the image load function of the source.\n * @param {module:ol/Image~LoadFunction} imageLoadFunction Image load function.\n * @api\n */\nImageArcGISRest.prototype.setImageLoadFunction = function(imageLoadFunction) {\n  this.image_ = null;\n  this.imageLoadFunction_ = imageLoadFunction;\n  this.changed();\n};\n\n\n/**\n * Set the URL to use for requests.\n * @param {string|undefined} url URL.\n * @api\n */\nImageArcGISRest.prototype.setUrl = function(url) {\n  if (url != this.url_) {\n    this.url_ = url;\n    this.image_ = null;\n    this.changed();\n  }\n};\n\n\n/**\n * Update the user-provided params.\n * @param {Object} params Params.\n * @api\n */\nImageArcGISRest.prototype.updateParams = function(params) {\n  assign(this.params_, params);\n  this.image_ = null;\n  this.changed();\n};\nexport default ImageArcGISRest;\n","/**\n * @module ol/source/ImageCanvas\n */\nimport {inherits} from '../util.js';\nimport ImageCanvas from '../ImageCanvas.js';\nimport {containsExtent, getHeight, getWidth, scaleFromCenter} from '../extent.js';\nimport ImageSource from '../source/Image.js';\n\n\n/**\n * A function returning the canvas element (`{HTMLCanvasElement}`)\n * used by the source as an image. The arguments passed to the function are:\n * {@link module:ol/extent~Extent} the image extent, `{number}` the image resolution,\n * `{number}` the device pixel ratio, {@link module:ol/size~Size} the image size, and\n * {@link module:ol/proj/Projection} the image projection. The canvas returned by\n * this function is cached by the source. The this keyword inside the function\n * references the {@link module:ol/source/ImageCanvas}.\n *\n * @typedef {function(this:module:ol/ImageCanvas, module:ol/extent~Extent, number,\n *     number, module:ol/size~Size, module:ol/proj/Projection): HTMLCanvasElement} FunctionType\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {module:ol/source/ImageCanvas~FunctionType} [canvasFunction] Canvas function.\n * The function returning the canvas element used by the source\n * as an image. The arguments passed to the function are: `{module:ol/extent~Extent}` the\n * image extent, `{number}` the image resolution, `{number}` the device pixel\n * ratio, `{module:ol/size~Size}` the image size, and `{module:ol/proj/Projection~Projection}` the image\n * projection. The canvas returned by this function is cached by the source. If\n * the value returned by the function is later changed then\n * `changed` should be called on the source for the source to\n * invalidate the current cached image. See @link: {@link module:ol/Observable~Observable#changed}\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {number} [ratio=1.5] Ratio. 1 means canvases are the size of the map viewport, 2 means twice the\n * width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array.<number>} [resolutions] Resolutions.\n * If specified, new canvases will be created for these resolutions\n * @property {module:ol/source/State} [state] Source state.\n */\n\n\n/**\n * @classdesc\n * Base class for image sources where a canvas element is the image.\n *\n * @constructor\n * @extends {module:ol/source/Image}\n * @param {module:ol/source/ImageCanvas~Options=} options ImageCanvas options.\n * @api\n */\nconst ImageCanvasSource = function(options) {\n\n  ImageSource.call(this, {\n    attributions: options.attributions,\n    projection: options.projection,\n    resolutions: options.resolutions,\n    state: options.state\n  });\n\n  /**\n   * @private\n   * @type {module:ol/source/ImageCanvas~FunctionType}\n   */\n  this.canvasFunction_ = options.canvasFunction;\n\n  /**\n   * @private\n   * @type {module:ol/ImageCanvas}\n   */\n  this.canvas_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.ratio_ = options.ratio !== undefined ?\n    options.ratio : 1.5;\n\n};\n\ninherits(ImageCanvasSource, ImageSource);\n\n\n/**\n * @inheritDoc\n */\nImageCanvasSource.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {\n  resolution = this.findNearestResolution(resolution);\n\n  let canvas = this.canvas_;\n  if (canvas &&\n      this.renderedRevision_ == this.getRevision() &&\n      canvas.getResolution() == resolution &&\n      canvas.getPixelRatio() == pixelRatio &&\n      containsExtent(canvas.getExtent(), extent)) {\n    return canvas;\n  }\n\n  extent = extent.slice();\n  scaleFromCenter(extent, this.ratio_);\n  const width = getWidth(extent) / resolution;\n  const height = getHeight(extent) / resolution;\n  const size = [width * pixelRatio, height * pixelRatio];\n\n  const canvasElement = this.canvasFunction_(\n    extent, resolution, pixelRatio, size, projection);\n  if (canvasElement) {\n    canvas = new ImageCanvas(extent, resolution, pixelRatio, canvasElement);\n  }\n  this.canvas_ = canvas;\n  this.renderedRevision_ = this.getRevision();\n\n  return canvas;\n};\nexport default ImageCanvasSource;\n","/**\n * @module ol/source/ImageMapGuide\n */\nimport {inherits} from '../util.js';\nimport ImageWrapper from '../Image.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {containsExtent, getCenter, getHeight, getWidth, scaleFromCenter} from '../extent.js';\nimport {assign} from '../obj.js';\nimport ImageSource, {defaultImageLoadFunction} from '../source/Image.js';\nimport {appendParams} from '../uri.js';\n\n/**\n * @typedef {Object} Options\n * @property {string} [url] The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array.<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {module:ol/Image~LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {Object} [params] Additional parameters.\n */\n\n\n/**\n * @classdesc\n * Source for images from Mapguide servers\n *\n * @constructor\n * @fires ol/source/Image~ImageSourceEvent\n * @extends {module:ol/source/Image}\n * @param {module:ol/source/ImageMapGuide~Options=} options ImageMapGuide options.\n * @api\n */\nconst ImageMapGuide = function(options) {\n\n  ImageSource.call(this, {\n    projection: options.projection,\n    resolutions: options.resolutions\n  });\n\n  /**\n   * @private\n   * @type {?string}\n   */\n  this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.displayDpi_ = options.displayDpi !== undefined ?\n    options.displayDpi : 96;\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.params_ = options.params || {};\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.url_ = options.url;\n\n  /**\n   * @private\n   * @type {module:ol/Image~LoadFunction}\n   */\n  this.imageLoadFunction_ = options.imageLoadFunction !== undefined ?\n    options.imageLoadFunction : defaultImageLoadFunction;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.metersPerUnit_ = options.metersPerUnit !== undefined ?\n    options.metersPerUnit : 1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.ratio_ = options.ratio !== undefined ? options.ratio : 1;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.useOverlay_ = options.useOverlay !== undefined ?\n    options.useOverlay : false;\n\n  /**\n   * @private\n   * @type {module:ol/Image}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = 0;\n\n};\n\ninherits(ImageMapGuide, ImageSource);\n\n\n/**\n * Get the user-provided params, i.e. those passed to the constructor through\n * the \"params\" option, and possibly updated using the updateParams method.\n * @return {Object} Params.\n * @api\n */\nImageMapGuide.prototype.getParams = function() {\n  return this.params_;\n};\n\n\n/**\n * @inheritDoc\n */\nImageMapGuide.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {\n  resolution = this.findNearestResolution(resolution);\n  pixelRatio = this.hidpi_ ? pixelRatio : 1;\n\n  let image = this.image_;\n  if (image &&\n      this.renderedRevision_ == this.getRevision() &&\n      image.getResolution() == resolution &&\n      image.getPixelRatio() == pixelRatio &&\n      containsExtent(image.getExtent(), extent)) {\n    return image;\n  }\n\n  if (this.ratio_ != 1) {\n    extent = extent.slice();\n    scaleFromCenter(extent, this.ratio_);\n  }\n  const width = getWidth(extent) / resolution;\n  const height = getHeight(extent) / resolution;\n  const size = [width * pixelRatio, height * pixelRatio];\n\n  if (this.url_ !== undefined) {\n    const imageUrl = this.getUrl(this.url_, this.params_, extent, size,\n      projection);\n    image = new ImageWrapper(extent, resolution, pixelRatio,\n      imageUrl, this.crossOrigin_,\n      this.imageLoadFunction_);\n    listen(image, EventType.CHANGE,\n      this.handleImageChange, this);\n  } else {\n    image = null;\n  }\n  this.image_ = image;\n  this.renderedRevision_ = this.getRevision();\n\n  return image;\n};\n\n\n/**\n * Return the image load function of the source.\n * @return {module:ol/Image~LoadFunction} The image load function.\n * @api\n */\nImageMapGuide.prototype.getImageLoadFunction = function() {\n  return this.imageLoadFunction_;\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent The map extents.\n * @param {module:ol/size~Size} size The viewport size.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} dpi The display resolution.\n * @return {number} The computed map scale.\n */\nfunction getScale(extent, size, metersPerUnit, dpi) {\n  const mcsW = getWidth(extent);\n  const mcsH = getHeight(extent);\n  const devW = size[0];\n  const devH = size[1];\n  const mpp = 0.0254 / dpi;\n  if (devH * mcsW > devW * mcsH) {\n    return mcsW * metersPerUnit / (devW * mpp); // width limited\n  } else {\n    return mcsH * metersPerUnit / (devH * mpp); // height limited\n  }\n}\n\n\n/**\n * Update the user-provided params.\n * @param {Object} params Params.\n * @api\n */\nImageMapGuide.prototype.updateParams = function(params) {\n  assign(this.params_, params);\n  this.changed();\n};\n\n\n/**\n * @param {string} baseUrl The mapagent url.\n * @param {Object.<string, string|number>} params Request parameters.\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/size~Size} size Size.\n * @param {module:ol/proj/Projection} projection Projection.\n * @return {string} The mapagent map image request URL.\n */\nImageMapGuide.prototype.getUrl = function(baseUrl, params, extent, size, projection) {\n  const scale = getScale(extent, size,\n    this.metersPerUnit_, this.displayDpi_);\n  const center = getCenter(extent);\n  const baseParams = {\n    'OPERATION': this.useOverlay_ ? 'GETDYNAMICMAPOVERLAYIMAGE' : 'GETMAPIMAGE',\n    'VERSION': '2.0.0',\n    'LOCALE': 'en',\n    'CLIENTAGENT': 'ol/source/ImageMapGuide source',\n    'CLIP': '1',\n    'SETDISPLAYDPI': this.displayDpi_,\n    'SETDISPLAYWIDTH': Math.round(size[0]),\n    'SETDISPLAYHEIGHT': Math.round(size[1]),\n    'SETVIEWSCALE': scale,\n    'SETVIEWCENTERX': center[0],\n    'SETVIEWCENTERY': center[1]\n  };\n  assign(baseParams, params);\n  return appendParams(baseUrl, baseParams);\n};\n\n\n/**\n * Set the image load function of the MapGuide source.\n * @param {module:ol/Image~LoadFunction} imageLoadFunction Image load function.\n * @api\n */\nImageMapGuide.prototype.setImageLoadFunction = function(imageLoadFunction) {\n  this.image_ = null;\n  this.imageLoadFunction_ = imageLoadFunction;\n  this.changed();\n};\nexport default ImageMapGuide;\n","/**\n * @module ol/source/ImageStatic\n */\nimport {inherits} from '../util.js';\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {intersects, getHeight, getWidth} from '../extent.js';\nimport {get as getProjection} from '../proj.js';\nimport ImageSource, {defaultImageLoadFunction} from '../source/Image.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {module:ol/extent~Extent} [imageExtent] Extent of the image in map coordinates.\n * This is the [left, bottom, right, top] map coordinates of your image.\n * @property {module:ol/Image~LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {module:ol/size~Size} [imageSize] Size of the image in pixels. Usually the image size is auto-detected, so this\n * only needs to be set if auto-detection fails for some reason.\n * @property {string} url Image URL.\n */\n\n\n/**\n * @classdesc\n * A layer source for displaying a single, static image.\n *\n * @constructor\n * @extends {module:ol/source/Image}\n * @param {module:ol/source/ImageStatic~Options=} options ImageStatic options.\n * @api\n */\nconst Static = function(options) {\n  const imageExtent = options.imageExtent;\n\n  const crossOrigin = options.crossOrigin !== undefined ?\n    options.crossOrigin : null;\n\n  const /** @type {module:ol/Image~LoadFunction} */ imageLoadFunction =\n      options.imageLoadFunction !== undefined ?\n        options.imageLoadFunction : defaultImageLoadFunction;\n\n  ImageSource.call(this, {\n    attributions: options.attributions,\n    projection: getProjection(options.projection)\n  });\n\n  /**\n   * @private\n   * @type {module:ol/Image}\n   */\n  this.image_ = new ImageWrapper(imageExtent, undefined, 1, options.url, crossOrigin, imageLoadFunction);\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.imageSize_ = options.imageSize ? options.imageSize : null;\n\n  listen(this.image_, EventType.CHANGE,\n    this.handleImageChange, this);\n\n};\n\ninherits(Static, ImageSource);\n\n\n/**\n * @inheritDoc\n */\nStatic.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {\n  if (intersects(extent, this.image_.getExtent())) {\n    return this.image_;\n  }\n  return null;\n};\n\n\n/**\n * @inheritDoc\n */\nStatic.prototype.handleImageChange = function(evt) {\n  if (this.image_.getState() == ImageState.LOADED) {\n    const imageExtent = this.image_.getExtent();\n    const image = this.image_.getImage();\n    let imageWidth, imageHeight;\n    if (this.imageSize_) {\n      imageWidth = this.imageSize_[0];\n      imageHeight = this.imageSize_[1];\n    } else {\n      imageWidth = image.width;\n      imageHeight = image.height;\n    }\n    const resolution = getHeight(imageExtent) / imageHeight;\n    const targetWidth = Math.ceil(getWidth(imageExtent) / resolution);\n    if (targetWidth != imageWidth) {\n      const context = createCanvasContext2D(targetWidth, imageHeight);\n      const canvas = context.canvas;\n      context.drawImage(image, 0, 0, imageWidth, imageHeight,\n        0, 0, canvas.width, canvas.height);\n      this.image_.setImage(canvas);\n    }\n  }\n  ImageSource.prototype.handleImageChange.call(this, evt);\n};\nexport default Static;\n","/**\n * Default WMS version.\n * @type {string}\n */\nexport const DEFAULT_WMS_VERSION = '1.3.0';\n","/**\n * @module ol/source/WMSServerType\n */\n\n/**\n * Available server types: `'carmentaserver'`, `'geoserver'`, `'mapserver'`,\n *     `'qgis'`. These are servers that have vendor parameters beyond the WMS\n *     specification that OpenLayers can make use of.\n * @enum {string}\n */\nexport default {\n  CARMENTA_SERVER: 'carmentaserver',\n  GEOSERVER: 'geoserver',\n  MAPSERVER: 'mapserver',\n  QGIS: 'qgis'\n};\n","/**\n * @module ol/source/ImageWMS\n */\n\nimport {DEFAULT_WMS_VERSION} from './common.js';\nimport {inherits} from '../util.js';\nimport ImageWrapper from '../Image.js';\nimport {assert} from '../asserts.js';\nimport {listen} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {containsExtent, getCenter, getForViewAndSize, getHeight, getWidth} from '../extent.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection, transform} from '../proj.js';\nimport {calculateSourceResolution} from '../reproj.js';\nimport ImageSource, {defaultImageLoadFunction} from '../source/Image.js';\nimport WMSServerType from '../source/WMSServerType.js';\nimport {compareVersions} from '../string.js';\nimport {appendParams} from '../uri.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {module:ol/source/WMSServerType|string} [serverType] The type of\n * the remote WMS server: `mapserver`, `geoserver` or `qgis`. Only needed if `hidpi` is `true`.\n * @property {module:ol/Image~LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {Object.<string,*>} params WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT`, `BBOX`\n * and `CRS` (`SRS` for WMS version < 1.3.0) will be set dynamically.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or\n * higher.\n * @property {Array.<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {string} url WMS service URL.\n */\n\n\n/**\n * @classdesc\n * Source for WMS servers providing single, untiled images.\n *\n * @constructor\n * @fires ol/source/Image~ImageSourceEvent\n * @extends {module:ol/source/Image}\n * @param {module:ol/source/ImageWMS~Options=} [opt_options] ImageWMS options.\n * @api\n */\nconst ImageWMS = function(opt_options) {\n\n  const options = opt_options || {};\n\n  ImageSource.call(this, {\n    attributions: options.attributions,\n    projection: options.projection,\n    resolutions: options.resolutions\n  });\n\n  /**\n   * @private\n   * @type {?string}\n   */\n  this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.url_ = options.url;\n\n  /**\n   * @private\n   * @type {module:ol/Image~LoadFunction}\n   */\n  this.imageLoadFunction_ = options.imageLoadFunction !== undefined ?\n    options.imageLoadFunction : defaultImageLoadFunction;\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.params_ = options.params || {};\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.v13_ = true;\n  this.updateV13_();\n\n  /**\n   * @private\n   * @type {module:ol/source/WMSServerType|undefined}\n   */\n  this.serverType_ = /** @type {module:ol/source/WMSServerType|undefined} */ (options.serverType);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n  /**\n   * @private\n   * @type {module:ol/Image}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.imageSize_ = [0, 0];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n\n};\n\ninherits(ImageWMS, ImageSource);\n\n\n/**\n * @const\n * @type {module:ol/size~Size}\n */\nconst GETFEATUREINFO_IMAGE_SIZE = [101, 101];\n\n\n/**\n * Return the GetFeatureInfo URL for the passed coordinate, resolution, and\n * projection. Return `undefined` if the GetFeatureInfo URL cannot be\n * constructed.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {module:ol/proj~ProjectionLike} projection Projection.\n * @param {!Object} params GetFeatureInfo params. `INFO_FORMAT` at least should\n *     be provided. If `QUERY_LAYERS` is not provided then the layers specified\n *     in the `LAYERS` parameter will be used. `VERSION` should not be\n *     specified here.\n * @return {string|undefined} GetFeatureInfo URL.\n * @api\n */\nImageWMS.prototype.getGetFeatureInfoUrl = function(coordinate, resolution, projection, params) {\n  if (this.url_ === undefined) {\n    return undefined;\n  }\n  const projectionObj = getProjection(projection);\n  const sourceProjectionObj = this.getProjection();\n\n  if (sourceProjectionObj && sourceProjectionObj !== projectionObj) {\n    resolution = calculateSourceResolution(sourceProjectionObj, projectionObj, coordinate, resolution);\n    coordinate = transform(coordinate, projectionObj, sourceProjectionObj);\n  }\n\n  const extent = getForViewAndSize(coordinate, resolution, 0,\n    GETFEATUREINFO_IMAGE_SIZE);\n\n  const baseParams = {\n    'SERVICE': 'WMS',\n    'VERSION': DEFAULT_WMS_VERSION,\n    'REQUEST': 'GetFeatureInfo',\n    'FORMAT': 'image/png',\n    'TRANSPARENT': true,\n    'QUERY_LAYERS': this.params_['LAYERS']\n  };\n  assign(baseParams, this.params_, params);\n\n  const x = Math.floor((coordinate[0] - extent[0]) / resolution);\n  const y = Math.floor((extent[3] - coordinate[1]) / resolution);\n  baseParams[this.v13_ ? 'I' : 'X'] = x;\n  baseParams[this.v13_ ? 'J' : 'Y'] = y;\n\n  return this.getRequestUrl_(\n    extent, GETFEATUREINFO_IMAGE_SIZE,\n    1, sourceProjectionObj || projectionObj, baseParams);\n};\n\n\n/**\n * Get the user-provided params, i.e. those passed to the constructor through\n * the \"params\" option, and possibly updated using the updateParams method.\n * @return {Object} Params.\n * @api\n */\nImageWMS.prototype.getParams = function() {\n  return this.params_;\n};\n\n\n/**\n * @inheritDoc\n */\nImageWMS.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {\n\n  if (this.url_ === undefined) {\n    return null;\n  }\n\n  resolution = this.findNearestResolution(resolution);\n\n  if (pixelRatio != 1 && (!this.hidpi_ || this.serverType_ === undefined)) {\n    pixelRatio = 1;\n  }\n\n  const imageResolution = resolution / pixelRatio;\n\n  const center = getCenter(extent);\n  const viewWidth = Math.ceil(getWidth(extent) / imageResolution);\n  const viewHeight = Math.ceil(getHeight(extent) / imageResolution);\n  const viewExtent = getForViewAndSize(center, imageResolution, 0,\n    [viewWidth, viewHeight]);\n  const requestWidth = Math.ceil(this.ratio_ * getWidth(extent) / imageResolution);\n  const requestHeight = Math.ceil(this.ratio_ * getHeight(extent) / imageResolution);\n  const requestExtent = getForViewAndSize(center, imageResolution, 0,\n    [requestWidth, requestHeight]);\n\n  const image = this.image_;\n  if (image &&\n      this.renderedRevision_ == this.getRevision() &&\n      image.getResolution() == resolution &&\n      image.getPixelRatio() == pixelRatio &&\n      containsExtent(image.getExtent(), viewExtent)) {\n    return image;\n  }\n\n  const params = {\n    'SERVICE': 'WMS',\n    'VERSION': DEFAULT_WMS_VERSION,\n    'REQUEST': 'GetMap',\n    'FORMAT': 'image/png',\n    'TRANSPARENT': true\n  };\n  assign(params, this.params_);\n\n  this.imageSize_[0] = Math.round(getWidth(requestExtent) / imageResolution);\n  this.imageSize_[1] = Math.round(getHeight(requestExtent) / imageResolution);\n\n  const url = this.getRequestUrl_(requestExtent, this.imageSize_, pixelRatio,\n    projection, params);\n\n  this.image_ = new ImageWrapper(requestExtent, resolution, pixelRatio,\n    url, this.crossOrigin_, this.imageLoadFunction_);\n\n  this.renderedRevision_ = this.getRevision();\n\n  listen(this.image_, EventType.CHANGE,\n    this.handleImageChange, this);\n\n  return this.image_;\n\n};\n\n\n/**\n * Return the image load function of the source.\n * @return {module:ol/Image~LoadFunction} The image load function.\n * @api\n */\nImageWMS.prototype.getImageLoadFunction = function() {\n  return this.imageLoadFunction_;\n};\n\n\n/**\n * @param {module:ol/extent~Extent} extent Extent.\n * @param {module:ol/size~Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {Object} params Params.\n * @return {string} Request URL.\n * @private\n */\nImageWMS.prototype.getRequestUrl_ = function(extent, size, pixelRatio, projection, params) {\n\n  assert(this.url_ !== undefined, 9); // `url` must be configured or set using `#setUrl()`\n\n  params[this.v13_ ? 'CRS' : 'SRS'] = projection.getCode();\n\n  if (!('STYLES' in this.params_)) {\n    params['STYLES'] = '';\n  }\n\n  if (pixelRatio != 1) {\n    switch (this.serverType_) {\n      case WMSServerType.GEOSERVER:\n        const dpi = (90 * pixelRatio + 0.5) | 0;\n        if ('FORMAT_OPTIONS' in params) {\n          params['FORMAT_OPTIONS'] += ';dpi:' + dpi;\n        } else {\n          params['FORMAT_OPTIONS'] = 'dpi:' + dpi;\n        }\n        break;\n      case WMSServerType.MAPSERVER:\n        params['MAP_RESOLUTION'] = 90 * pixelRatio;\n        break;\n      case WMSServerType.CARMENTA_SERVER:\n      case WMSServerType.QGIS:\n        params['DPI'] = 90 * pixelRatio;\n        break;\n      default:\n        assert(false, 8); // Unknown `serverType` configured\n        break;\n    }\n  }\n\n  params['WIDTH'] = size[0];\n  params['HEIGHT'] = size[1];\n\n  const axisOrientation = projection.getAxisOrientation();\n  let bbox;\n  if (this.v13_ && axisOrientation.substr(0, 2) == 'ne') {\n    bbox = [extent[1], extent[0], extent[3], extent[2]];\n  } else {\n    bbox = extent;\n  }\n  params['BBOX'] = bbox.join(',');\n\n  return appendParams(/** @type {string} */ (this.url_), params);\n};\n\n\n/**\n * Return the URL used for this WMS source.\n * @return {string|undefined} URL.\n * @api\n */\nImageWMS.prototype.getUrl = function() {\n  return this.url_;\n};\n\n\n/**\n * Set the image load function of the source.\n * @param {module:ol/Image~LoadFunction} imageLoadFunction Image load function.\n * @api\n */\nImageWMS.prototype.setImageLoadFunction = function(imageLoadFunction) {\n  this.image_ = null;\n  this.imageLoadFunction_ = imageLoadFunction;\n  this.changed();\n};\n\n\n/**\n * Set the URL to use for requests.\n * @param {string|undefined} url URL.\n * @api\n */\nImageWMS.prototype.setUrl = function(url) {\n  if (url != this.url_) {\n    this.url_ = url;\n    this.image_ = null;\n    this.changed();\n  }\n};\n\n\n/**\n * Update the user-provided params.\n * @param {Object} params Params.\n * @api\n */\nImageWMS.prototype.updateParams = function(params) {\n  assign(this.params_, params);\n  this.updateV13_();\n  this.image_ = null;\n  this.changed();\n};\n\n\n/**\n * @private\n */\nImageWMS.prototype.updateV13_ = function() {\n  const version = this.params_['VERSION'] || DEFAULT_WMS_VERSION;\n  this.v13_ = compareVersions(version, '1.3') >= 0;\n};\nexport default ImageWMS;\n","/**\n * @module ol/source/OSM\n */\nimport {inherits} from '../util.js';\nimport XYZ from '../source/XYZ.js';\n\n\n/**\n * The attribution containing a link to the OpenStreetMap Copyright and License\n * page.\n * @const\n * @type {string}\n * @api\n */\nexport const ATTRIBUTION = '&copy; ' +\n      '<a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> ' +\n      'contributors.';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {number} [maxZoom=19] Max zoom.\n * @property {boolean} [opaque=true] Whether the layer is opaque.\n * @property {number} [reprojectionErrorThreshold=1.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url='https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png'] URL template.\n * Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n\n/**\n * @classdesc\n * Layer source for the OpenStreetMap tile server.\n *\n * @constructor\n * @extends {module:ol/source/XYZ}\n * @param {module:ol/source/OSM~Options=} [opt_options] Open Street Map options.\n * @api\n */\nconst OSM = function(opt_options) {\n\n  const options = opt_options || {};\n\n  let attributions;\n  if (options.attributions !== undefined) {\n    attributions = options.attributions;\n  } else {\n    attributions = [ATTRIBUTION];\n  }\n\n  const crossOrigin = options.crossOrigin !== undefined ?\n    options.crossOrigin : 'anonymous';\n\n  const url = options.url !== undefined ?\n    options.url : 'https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png';\n\n  XYZ.call(this, {\n    attributions: attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: crossOrigin,\n    opaque: options.opaque !== undefined ? options.opaque : true,\n    maxZoom: options.maxZoom !== undefined ? options.maxZoom : 19,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileLoadFunction: options.tileLoadFunction,\n    url: url,\n    wrapX: options.wrapX\n  });\n\n};\n\ninherits(OSM, XYZ);\n\nexport default OSM;\n","var hasImageData = true;\ntry {\n  new ImageData(10, 10);\n} catch (_) {\n  hasImageData = false;\n}\n\nvar context = document.createElement('canvas').getContext('2d');\n\nfunction newImageData(data, width, height) {\n  if (hasImageData) {\n    return new ImageData(data, width, height);\n  } else {\n    var imageData = context.createImageData(width, height);\n    imageData.data.set(data);\n    return imageData;\n  }\n}\n\nexports.newImageData = newImageData;\n","var newImageData = require('./util').newImageData;\n\n/**\n * Create a function for running operations.  This function is serialized for\n * use in a worker.\n * @param {function(Array, Object):*} operation The operation.\n * @return {function(Object):ArrayBuffer} A function that takes an object with\n * buffers, meta, imageOps, width, and height properties and returns an array\n * buffer.\n */\nfunction createMinion(operation) {\n  var workerHasImageData = true;\n  try {\n    new ImageData(10, 10);\n  } catch (_) {\n    workerHasImageData = false;\n  }\n\n  function newWorkerImageData(data, width, height) {\n    if (workerHasImageData) {\n      return new ImageData(data, width, height);\n    } else {\n      return {data: data, width: width, height: height};\n    }\n  }\n\n  return function(data) {\n    // bracket notation for minification support\n    var buffers = data['buffers'];\n    var meta = data['meta'];\n    var imageOps = data['imageOps'];\n    var width = data['width'];\n    var height = data['height'];\n\n    var numBuffers = buffers.length;\n    var numBytes = buffers[0].byteLength;\n    var output, b;\n\n    if (imageOps) {\n      var images = new Array(numBuffers);\n      for (b = 0; b < numBuffers; ++b) {\n        images[b] = newWorkerImageData(\n            new Uint8ClampedArray(buffers[b]), width, height);\n      }\n      output = operation(images, meta).data;\n    } else {\n      output = new Uint8ClampedArray(numBytes);\n      var arrays = new Array(numBuffers);\n      var pixels = new Array(numBuffers);\n      for (b = 0; b < numBuffers; ++b) {\n        arrays[b] = new Uint8ClampedArray(buffers[b]);\n        pixels[b] = [0, 0, 0, 0];\n      }\n      for (var i = 0; i < numBytes; i += 4) {\n        for (var j = 0; j < numBuffers; ++j) {\n          var array = arrays[j];\n          pixels[j][0] = array[i];\n          pixels[j][1] = array[i + 1];\n          pixels[j][2] = array[i + 2];\n          pixels[j][3] = array[i + 3];\n        }\n        var pixel = operation(pixels, meta);\n        output[i] = pixel[0];\n        output[i + 1] = pixel[1];\n        output[i + 2] = pixel[2];\n        output[i + 3] = pixel[3];\n      }\n    }\n    return output.buffer;\n  };\n}\n\n/**\n * Create a worker for running operations.\n * @param {Object} config Configuration.\n * @param {function(MessageEvent)} onMessage Called with a message event.\n * @return {Worker} The worker.\n */\nfunction createWorker(config, onMessage) {\n  var lib = Object.keys(config.lib || {}).map(function(name) {\n    return 'var ' + name + ' = ' + config.lib[name].toString() + ';';\n  });\n\n  var lines = lib.concat([\n    'var __minion__ = (' + createMinion.toString() + ')(', config.operation.toString(), ');',\n    'self.addEventListener(\"message\", function(event) {',\n    '  var buffer = __minion__(event.data);',\n    '  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);',\n    '});'\n  ]);\n\n  var blob = new Blob(lines, {type: 'text/javascript'});\n  var source = URL.createObjectURL(blob);\n  var worker = new Worker(source);\n  worker.addEventListener('message', onMessage);\n  return worker;\n}\n\n/**\n * Create a faux worker for running operations.\n * @param {Object} config Configuration.\n * @param {function(MessageEvent)} onMessage Called with a message event.\n * @return {Object} The faux worker.\n */\nfunction createFauxWorker(config, onMessage) {\n  var minion = createMinion(config.operation);\n  return {\n    postMessage: function(data) {\n      setTimeout(function() {\n        onMessage({'data': {'buffer': minion(data), 'meta': data['meta']}});\n      }, 0);\n    }\n  };\n}\n\n/**\n * A processor runs pixel or image operations in workers.\n * @param {Object} config Configuration.\n */\nfunction Processor(config) {\n  this._imageOps = !!config.imageOps;\n  var threads;\n  if (config.threads === 0) {\n    threads = 0;\n  } else if (this._imageOps) {\n    threads = 1;\n  } else {\n    threads = config.threads || 1;\n  }\n  var workers = [];\n  if (threads) {\n    for (var i = 0; i < threads; ++i) {\n      workers[i] = createWorker(config, this._onWorkerMessage.bind(this, i));\n    }\n  } else {\n    workers[0] = createFauxWorker(config, this._onWorkerMessage.bind(this, 0));\n  }\n  this._workers = workers;\n  this._queue = [];\n  this._maxQueueLength = config.queue || Infinity;\n  this._running = 0;\n  this._dataLookup = {};\n  this._job = null;\n}\n\n/**\n * Run operation on input data.\n * @param {Array.<Array|ImageData>} inputs Array of pixels or image data\n *     (depending on the operation type).\n * @param {Object} meta A user data object.  This is passed to all operations\n *     and must be serializable.\n * @param {function(Error, ImageData, Object)} callback Called when work\n *     completes.  The first argument is any error.  The second is the ImageData\n *     generated by operations.  The third is the user data object.\n */\nProcessor.prototype.process = function(inputs, meta, callback) {\n  this._enqueue({\n    inputs: inputs,\n    meta: meta,\n    callback: callback\n  });\n  this._dispatch();\n};\n\n/**\n * Stop responding to any completed work and destroy the processor.\n */\nProcessor.prototype.destroy = function() {\n  for (var key in this) {\n    this[key] = null;\n  }\n  this._destroyed = true;\n};\n\n/**\n * Add a job to the queue.\n * @param {Object} job The job.\n */\nProcessor.prototype._enqueue = function(job) {\n  this._queue.push(job);\n  while (this._queue.length > this._maxQueueLength) {\n    this._queue.shift().callback(null, null);\n  }\n};\n\n/**\n * Dispatch a job.\n */\nProcessor.prototype._dispatch = function() {\n  if (this._running === 0 && this._queue.length > 0) {\n    var job = this._job = this._queue.shift();\n    var width = job.inputs[0].width;\n    var height = job.inputs[0].height;\n    var buffers = job.inputs.map(function(input) {\n      return input.data.buffer;\n    });\n    var threads = this._workers.length;\n    this._running = threads;\n    if (threads === 1) {\n      this._workers[0].postMessage({\n        'buffers': buffers,\n        'meta': job.meta,\n        'imageOps': this._imageOps,\n        'width': width,\n        'height': height\n      }, buffers);\n    } else {\n      var length = job.inputs[0].data.length;\n      var segmentLength = 4 * Math.ceil(length / 4 / threads);\n      for (var i = 0; i < threads; ++i) {\n        var offset = i * segmentLength;\n        var slices = [];\n        for (var j = 0, jj = buffers.length; j < jj; ++j) {\n          slices.push(buffers[i].slice(offset, offset + segmentLength));\n        }\n        this._workers[i].postMessage({\n          'buffers': slices,\n          'meta': job.meta,\n          'imageOps': this._imageOps,\n          'width': width,\n          'height': height\n        }, slices);\n      }\n    }\n  }\n};\n\n/**\n * Handle messages from the worker.\n * @param {number} index The worker index.\n * @param {MessageEvent} event The message event.\n */\nProcessor.prototype._onWorkerMessage = function(index, event) {\n  if (this._destroyed) {\n    return;\n  }\n  this._dataLookup[index] = event.data;\n  --this._running;\n  if (this._running === 0) {\n    this._resolveJob();\n  }\n};\n\n/**\n * Resolve a job.  If there are no more worker threads, the processor callback\n * will be called.\n */\nProcessor.prototype._resolveJob = function() {\n  var job = this._job;\n  var threads = this._workers.length;\n  var data, meta;\n  if (threads === 1) {\n    data = new Uint8ClampedArray(this._dataLookup[0]['buffer']);\n    meta = this._dataLookup[0]['meta'];\n  } else {\n    var length = job.inputs[0].data.length;\n    data = new Uint8ClampedArray(length);\n    meta = new Array(length);\n    var segmentLength = 4 * Math.ceil(length / 4 / threads);\n    for (var i = 0; i < threads; ++i) {\n      var buffer = this._dataLookup[i]['buffer'];\n      var offset = i * segmentLength;\n      data.set(new Uint8ClampedArray(buffer), offset);\n      meta[i] = this._dataLookup[i]['meta'];\n    }\n  }\n  this._job = null;\n  this._dataLookup = {};\n  job.callback(null,\n      newImageData(data, job.inputs[0].width, job.inputs[0].height), meta);\n  this._dispatch();\n};\n\nmodule.exports = Processor;\n","/**\n * @module ol/source/Raster\n */\nimport {getUid, inherits} from '../util.js';\nimport ImageCanvas from '../ImageCanvas.js';\nimport TileQueue from '../TileQueue.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {listen} from '../events.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {Processor} from 'pixelworks/lib/index';\nimport {equals, getCenter, getHeight, getWidth} from '../extent.js';\nimport LayerType from '../LayerType.js';\nimport Layer from '../layer/Layer.js';\nimport ImageLayer from '../layer/Image.js';\nimport TileLayer from '../layer/Tile.js';\nimport {assign} from '../obj.js';\nimport CanvasImageLayerRenderer from '../renderer/canvas/ImageLayer.js';\nimport CanvasTileLayerRenderer from '../renderer/canvas/TileLayer.js';\nimport ImageSource from '../source/Image.js';\nimport SourceState from '../source/State.js';\nimport TileSource from '../source/Tile.js';\nimport {create as createTransform} from '../transform.js';\n\n\n/**\n * A function that takes an array of input data, performs some operation, and\n * returns an array of output data.\n * For `pixel` type operations, the function will be called with an array of\n * pixels, where each pixel is an array of four numbers (`[r, g, b, a]`) in the\n * range of 0 - 255. It should return a single pixel array.\n * For `'image'` type operations, functions will be called with an array of\n * {@link ImageData https://developer.mozilla.org/en-US/docs/Web/API/ImageData}\n * and should return a single {@link ImageData\n * https://developer.mozilla.org/en-US/docs/Web/API/ImageData}.  The operations\n * are called with a second \"data\" argument, which can be used for storage.  The\n * data object is accessible from raster events, where it can be initialized in\n * \"beforeoperations\" and accessed again in \"afteroperations\".\n *\n * @typedef {function((Array.<Array.<number>>|Array.<ImageData>), Object):\n *     (Array.<number>|ImageData)} Operation\n */\n\n\n/**\n * @enum {string}\n */\nconst RasterEventType = {\n  /**\n   * Triggered before operations are run.\n   * @event ol/source/Raster~RasterSourceEvent#beforeoperations\n   * @api\n   */\n  BEFOREOPERATIONS: 'beforeoperations',\n\n  /**\n   * Triggered after operations are run.\n   * @event ol/source/Raster~RasterSourceEvent#afteroperations\n   * @api\n   */\n  AFTEROPERATIONS: 'afteroperations'\n};\n\n\n/**\n * Raster operation type. Supported values are `'pixel'` and `'image'`.\n * @enum {string}\n */\nconst RasterOperationType = {\n  PIXEL: 'pixel',\n  IMAGE: 'image'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Raster} instances are instances of this\n * type.\n *\n * @constructor\n * @extends {module:ol/events/Event}\n * @param {string} type Type.\n * @param {module:ol/PluggableMap~FrameState} frameState The frame state.\n * @param {Object} data An object made available to operations.\n */\nconst RasterSourceEvent = function(type, frameState, data) {\n  Event.call(this, type);\n\n  /**\n   * The raster extent.\n   * @type {module:ol/extent~Extent}\n   * @api\n   */\n  this.extent = frameState.extent;\n\n  /**\n   * The pixel resolution (map units per pixel).\n   * @type {number}\n   * @api\n   */\n  this.resolution = frameState.viewState.resolution / frameState.pixelRatio;\n\n  /**\n   * An object made available to all operations.  This can be used by operations\n   * as a storage object (e.g. for calculating statistics).\n   * @type {Object}\n   * @api\n   */\n  this.data = data;\n\n};\ninherits(RasterSourceEvent, Event);\n\n/**\n * @typedef {Object} Options\n * @property {Array.<module:ol/source/Source|module:ol/layer/Layer>} sources Input\n * sources or layers. Vector layers must be configured with `renderMode: 'image'`.\n * @property {module:ol/source/Raster~Operation} [operation] Raster operation.\n * The operation will be called with data from input sources\n * and the output will be assigned to the raster source.\n * @property {Object} [lib] Functions that will be made available to operations run in a worker.\n * @property {number} [threads] By default, operations will be run in a single worker thread.\n * To avoid using workers altogether, set `threads: 0`.  For pixel operations, operations can\n * be run in multiple worker threads.  Note that there is additional overhead in\n * transferring data to multiple workers, and that depending on the user's\n * system, it may not be possible to parallelize the work.\n * @property {module:ol/source/Raster~RasterOperationType} [operationType='pixel'] Operation type.\n * Supported values are `'pixel'` and `'image'`.  By default,\n * `'pixel'` operations are assumed, and operations will be called with an\n * array of pixels from input sources.  If set to `'image'`, operations will\n * be called with an array of ImageData objects from input sources.\n */\n\n\n/**\n * @classdesc\n * A source that transforms data from any number of input sources using an\n * {@link module:ol/source/Raster~Operation} function to transform input pixel values into\n * output pixel values.\n *\n * @constructor\n * @extends {module:ol/source/Image}\n * @fires ol/source/Raster~RasterSourceEvent\n * @param {module:ol/source/Raster~Options=} options Options.\n * @api\n */\nconst RasterSource = function(options) {\n\n  /**\n   * @private\n   * @type {*}\n   */\n  this.worker_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/source/Raster~RasterOperationType}\n   */\n  this.operationType_ = options.operationType !== undefined ?\n    options.operationType : RasterOperationType.PIXEL;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.threads_ = options.threads !== undefined ? options.threads : 1;\n\n  /**\n   * @private\n   * @type {Array.<module:ol/renderer/canvas/Layer>}\n   */\n  this.renderers_ = createRenderers(options.sources);\n\n  for (let r = 0, rr = this.renderers_.length; r < rr; ++r) {\n    listen(this.renderers_[r], EventType.CHANGE,\n      this.changed, this);\n  }\n\n  /**\n   * @private\n   * @type {module:ol/TileQueue}\n   */\n  this.tileQueue_ = new TileQueue(\n    function() {\n      return 1;\n    },\n    this.changed.bind(this));\n\n  const layerStatesArray = getLayerStatesArray(this.renderers_);\n  const layerStates = {};\n  for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerStates[getUid(layerStatesArray[i].layer)] = layerStatesArray[i];\n  }\n\n  /**\n   * The most recently requested frame state.\n   * @type {module:ol/PluggableMap~FrameState}\n   * @private\n   */\n  this.requestedFrameState_;\n\n  /**\n   * The most recently rendered image canvas.\n   * @type {module:ol/ImageCanvas}\n   * @private\n   */\n  this.renderedImageCanvas_ = null;\n\n  /**\n   * The most recently rendered revision.\n   * @type {number}\n   */\n  this.renderedRevision_;\n\n  /**\n   * @private\n   * @type {module:ol/PluggableMap~FrameState}\n   */\n  this.frameState_ = {\n    animate: false,\n    coordinateToPixelTransform: createTransform(),\n    extent: null,\n    focus: null,\n    index: 0,\n    layerStates: layerStates,\n    layerStatesArray: layerStatesArray,\n    pixelRatio: 1,\n    pixelToCoordinateTransform: createTransform(),\n    postRenderFunctions: [],\n    size: [0, 0],\n    skippedFeatureUids: {},\n    tileQueue: this.tileQueue_,\n    time: Date.now(),\n    usedTiles: {},\n    viewState: /** @type {module:ol/View~State} */ ({\n      rotation: 0\n    }),\n    viewHints: [],\n    wantedTiles: {}\n  };\n\n  ImageSource.call(this, {});\n\n  if (options.operation !== undefined) {\n    this.setOperation(options.operation, options.lib);\n  }\n\n};\n\ninherits(RasterSource, ImageSource);\n\n\n/**\n * Set the operation.\n * @param {module:ol/source/Raster~Operation} operation New operation.\n * @param {Object=} opt_lib Functions that will be available to operations run\n *     in a worker.\n * @api\n */\nRasterSource.prototype.setOperation = function(operation, opt_lib) {\n  this.worker_ = new Processor({\n    operation: operation,\n    imageOps: this.operationType_ === RasterOperationType.IMAGE,\n    queue: 1,\n    lib: opt_lib,\n    threads: this.threads_\n  });\n  this.changed();\n};\n\n\n/**\n * Update the stored frame state.\n * @param {module:ol/extent~Extent} extent The view extent (in map units).\n * @param {number} resolution The view resolution.\n * @param {module:ol/proj/Projection} projection The view projection.\n * @return {module:ol/PluggableMap~FrameState} The updated frame state.\n * @private\n */\nRasterSource.prototype.updateFrameState_ = function(extent, resolution, projection) {\n\n  const frameState = /** @type {module:ol/PluggableMap~FrameState} */ (assign({}, this.frameState_));\n\n  frameState.viewState = /** @type {module:ol/View~State} */ (assign({}, frameState.viewState));\n\n  const center = getCenter(extent);\n\n  frameState.extent = extent.slice();\n  frameState.focus = center;\n  frameState.size[0] = Math.round(getWidth(extent) / resolution);\n  frameState.size[1] = Math.round(getHeight(extent) / resolution);\n  frameState.time = Date.now();\n  frameState.animate = false;\n\n  const viewState = frameState.viewState;\n  viewState.center = center;\n  viewState.projection = projection;\n  viewState.resolution = resolution;\n  return frameState;\n};\n\n\n/**\n * Determine if all sources are ready.\n * @return {boolean} All sources are ready.\n * @private\n */\nRasterSource.prototype.allSourcesReady_ = function() {\n  let ready = true;\n  let source;\n  for (let i = 0, ii = this.renderers_.length; i < ii; ++i) {\n    source = this.renderers_[i].getLayer().getSource();\n    if (source.getState() !== SourceState.READY) {\n      ready = false;\n      break;\n    }\n  }\n  return ready;\n};\n\n\n/**\n * @inheritDoc\n */\nRasterSource.prototype.getImage = function(extent, resolution, pixelRatio, projection) {\n  if (!this.allSourcesReady_()) {\n    return null;\n  }\n\n  const frameState = this.updateFrameState_(extent, resolution, projection);\n  this.requestedFrameState_ = frameState;\n\n  // check if we can't reuse the existing ol/ImageCanvas\n  if (this.renderedImageCanvas_) {\n    const renderedResolution = this.renderedImageCanvas_.getResolution();\n    const renderedExtent = this.renderedImageCanvas_.getExtent();\n    if (resolution !== renderedResolution || !equals(extent, renderedExtent)) {\n      this.renderedImageCanvas_ = null;\n    }\n  }\n\n  if (!this.renderedImageCanvas_ || this.getRevision() !== this.renderedRevision_) {\n    this.processSources_();\n  }\n\n  frameState.tileQueue.loadMoreTiles(16, 16);\n\n  if (frameState.animate) {\n    requestAnimationFrame(this.changed.bind(this));\n  }\n\n  return this.renderedImageCanvas_;\n};\n\n\n/**\n * Start processing source data.\n * @private\n */\nRasterSource.prototype.processSources_ = function() {\n  const frameState = this.requestedFrameState_;\n  const len = this.renderers_.length;\n  const imageDatas = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    const imageData = getImageData(\n      this.renderers_[i], frameState, frameState.layerStatesArray[i]);\n    if (imageData) {\n      imageDatas[i] = imageData;\n    } else {\n      return;\n    }\n  }\n\n  const data = {};\n  this.dispatchEvent(new RasterSourceEvent(RasterEventType.BEFOREOPERATIONS, frameState, data));\n  this.worker_.process(imageDatas, data, this.onWorkerComplete_.bind(this, frameState));\n};\n\n\n/**\n * Called when pixel processing is complete.\n * @param {module:ol/PluggableMap~FrameState} frameState The frame state.\n * @param {Error} err Any error during processing.\n * @param {ImageData} output The output image data.\n * @param {Object} data The user data.\n * @private\n */\nRasterSource.prototype.onWorkerComplete_ = function(frameState, err, output, data) {\n  if (err || !output) {\n    return;\n  }\n\n  // do nothing if extent or resolution changed\n  const extent = frameState.extent;\n  const resolution = frameState.viewState.resolution;\n  if (resolution !== this.requestedFrameState_.viewState.resolution ||\n      !equals(extent, this.requestedFrameState_.extent)) {\n    return;\n  }\n\n  let context;\n  if (this.renderedImageCanvas_) {\n    context = this.renderedImageCanvas_.getImage().getContext('2d');\n  } else {\n    const width = Math.round(getWidth(extent) / resolution);\n    const height = Math.round(getHeight(extent) / resolution);\n    context = createCanvasContext2D(width, height);\n    this.renderedImageCanvas_ = new ImageCanvas(extent, resolution, 1, context.canvas);\n  }\n  context.putImageData(output, 0, 0);\n\n  this.changed();\n  this.renderedRevision_ = this.getRevision();\n\n  this.dispatchEvent(new RasterSourceEvent(RasterEventType.AFTEROPERATIONS, frameState, data));\n};\n\n\n/**\n * A reusable canvas context.\n * @type {CanvasRenderingContext2D}\n * @private\n */\nlet sharedContext = null;\n\n\n/**\n * Get image data from a renderer.\n * @param {module:ol/renderer/canvas/Layer} renderer Layer renderer.\n * @param {module:ol/PluggableMap~FrameState} frameState The frame state.\n * @param {module:ol/layer/Layer~State} layerState The layer state.\n * @return {ImageData} The image data.\n */\nfunction getImageData(renderer, frameState, layerState) {\n  if (!renderer.prepareFrame(frameState, layerState)) {\n    return null;\n  }\n  const width = frameState.size[0];\n  const height = frameState.size[1];\n  if (!sharedContext) {\n    sharedContext = createCanvasContext2D(width, height);\n  } else {\n    const canvas = sharedContext.canvas;\n    if (canvas.width !== width || canvas.height !== height) {\n      sharedContext = createCanvasContext2D(width, height);\n    } else {\n      sharedContext.clearRect(0, 0, width, height);\n    }\n  }\n  renderer.composeFrame(frameState, layerState, sharedContext);\n  return sharedContext.getImageData(0, 0, width, height);\n}\n\n\n/**\n * Get a list of layer states from a list of renderers.\n * @param {Array.<module:ol/renderer/canvas/Layer>} renderers Layer renderers.\n * @return {Array.<module:ol/layer/Layer~State>} The layer states.\n */\nfunction getLayerStatesArray(renderers) {\n  return renderers.map(function(renderer) {\n    return renderer.getLayer().getLayerState();\n  });\n}\n\n\n/**\n * Create renderers for all sources.\n * @param {Array.<module:ol/source/Source>} sources The sources.\n * @return {Array.<module:ol/renderer/canvas/Layer>} Array of layer renderers.\n */\nfunction createRenderers(sources) {\n  const len = sources.length;\n  const renderers = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    renderers[i] = createRenderer(sources[i]);\n  }\n  return renderers;\n}\n\n\n/**\n * Create a renderer for the provided source.\n * @param {module:ol/source/Source} source The source.\n * @return {module:ol/renderer/canvas/Layer} The renderer.\n */\nfunction createRenderer(source) {\n  let renderer = null;\n  if (source instanceof TileSource) {\n    renderer = createTileRenderer(source);\n  } else if (source instanceof ImageSource) {\n    renderer = createImageRenderer(source);\n  } else if (source instanceof TileLayer) {\n    renderer = new CanvasTileLayerRenderer(source);\n  } else if (source instanceof Layer &&\n      (source.getType() == LayerType.IMAGE || source.getType() == LayerType.VECTOR)) {\n    renderer = new CanvasImageLayerRenderer(source);\n  }\n  return renderer;\n}\n\n\n/**\n * Create an image renderer for the provided source.\n * @param {module:ol/source/Image} source The source.\n * @return {module:ol/renderer/canvas/Layer} The renderer.\n */\nfunction createImageRenderer(source) {\n  const layer = new ImageLayer({source: source});\n  return new CanvasImageLayerRenderer(layer);\n}\n\n\n/**\n * Create a tile renderer for the provided source.\n * @param {module:ol/source/Tile} source The source.\n * @return {module:ol/renderer/canvas/Layer} The renderer.\n */\nfunction createTileRenderer(source) {\n  const layer = new TileLayer({source: source});\n  return new CanvasTileLayerRenderer(layer);\n}\n\n\n/**\n * @override\n */\nRasterSource.prototype.getImageInternal = function() {\n  return null; // not implemented\n};\n\n\nexport default RasterSource;\n","/**\n * @module ol/source/Stamen\n */\nimport {inherits} from '../util.js';\nimport {ATTRIBUTION as OSM_ATTRIBUTION} from '../source/OSM.js';\nimport XYZ from '../source/XYZ.js';\n\n\n/**\n * @const\n * @type {Array.<string>}\n */\nconst ATTRIBUTIONS = [\n  'Map tiles by <a href=\"https://stamen.com/\">Stamen Design</a>, ' +\n        'under <a href=\"https://creativecommons.org/licenses/by/3.0/\">CC BY' +\n        ' 3.0</a>.',\n  OSM_ATTRIBUTION\n];\n\n\n/**\n * @type {Object.<string, {extension: string, opaque: boolean}>}\n */\nconst LayerConfig = {\n  'terrain': {\n    extension: 'jpg',\n    opaque: true\n  },\n  'terrain-background': {\n    extension: 'jpg',\n    opaque: true\n  },\n  'terrain-labels': {\n    extension: 'png',\n    opaque: false\n  },\n  'terrain-lines': {\n    extension: 'png',\n    opaque: false\n  },\n  'toner-background': {\n    extension: 'png',\n    opaque: true\n  },\n  'toner': {\n    extension: 'png',\n    opaque: true\n  },\n  'toner-hybrid': {\n    extension: 'png',\n    opaque: false\n  },\n  'toner-labels': {\n    extension: 'png',\n    opaque: false\n  },\n  'toner-lines': {\n    extension: 'png',\n    opaque: false\n  },\n  'toner-lite': {\n    extension: 'png',\n    opaque: true\n  },\n  'watercolor': {\n    extension: 'jpg',\n    opaque: true\n  }\n};\n\n\n/**\n * @type {Object.<string, {minZoom: number, maxZoom: number}>}\n */\nconst ProviderConfig = {\n  'terrain': {\n    minZoom: 4,\n    maxZoom: 18\n  },\n  'toner': {\n    minZoom: 0,\n    maxZoom: 20\n  },\n  'watercolor': {\n    minZoom: 1,\n    maxZoom: 16\n  }\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [cacheSize=2048] Cache size.\n * @property {string} [layer] Layer.\n * @property {number} [minZoom] Minimum zoom.\n * @property {number} [maxZoom] Maximum zoom.\n * @property {boolean} [opaque] Whether the layer is opaque.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction]\n * Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n\n/**\n * @classdesc\n * Layer source for the Stamen tile server.\n *\n * @constructor\n * @extends {module:ol/source/XYZ}\n * @param {module:ol/source/Stamen~Options=} options Stamen options.\n * @api\n */\nconst Stamen = function(options) {\n  const i = options.layer.indexOf('-');\n  const provider = i == -1 ? options.layer : options.layer.slice(0, i);\n  const providerConfig = ProviderConfig[provider];\n\n  const layerConfig = LayerConfig[options.layer];\n\n  const url = options.url !== undefined ? options.url :\n    'https://stamen-tiles-{a-d}.a.ssl.fastly.net/' + options.layer +\n      '/{z}/{x}/{y}.' + layerConfig.extension;\n\n  XYZ.call(this, {\n    attributions: ATTRIBUTIONS,\n    cacheSize: options.cacheSize,\n    crossOrigin: 'anonymous',\n    maxZoom: options.maxZoom != undefined ? options.maxZoom : providerConfig.maxZoom,\n    minZoom: options.minZoom != undefined ? options.minZoom : providerConfig.minZoom,\n    opaque: layerConfig.opaque,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileLoadFunction: options.tileLoadFunction,\n    url: url,\n    wrapX: options.wrapX\n  });\n};\n\ninherits(Stamen, XYZ);\n\nexport default Stamen;\n","/**\n * @module ol/source/TileArcGISRest\n */\nimport {inherits} from '../util.js';\nimport {createEmpty} from '../extent.js';\nimport {modulo} from '../math.js';\nimport {assign} from '../obj.js';\nimport {toSize, scale as scaleSize} from '../size.js';\nimport TileImage from '../source/TileImage.js';\nimport {hash as tileCoordHash} from '../tilecoord.js';\nimport {appendParams} from '../uri.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.\n * Note that you must provide a `crossOrigin` value if you are using the WebGL renderer\n * or if you want to access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image}\n * for more detail.\n * @property {Object.<string,*>} [params] ArcGIS Rest parameters. This field is optional. Service defaults will be\n * used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is `IMAGE` by\n * default. `TRANSPARENT` is `true` by default.  `BBOX, `SIZE`, `BBOXSR`,\n * and `IMAGESR` will be set dynamically. Set `LAYERS` to\n * override the default service layer visibility. See\n * {@link http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/Export_Map/02r3000000v7000000/}\n * for further reference.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid. Base this on the resolutions,\n * tilesize and extent supported by the server.\n * If this is not defined, a default grid will be used: if there is a projection\n * extent, the grid will be based on that; if not, a grid based on a global\n * extent with origin at 0,0 will be used.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL.\n * The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] ArcGIS Rest service URL for a Map Service or Image Service. The\n * url should include /MapServer or /ImageServer.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.  To disable the opacity\n * transition, pass `transition: 0`.\n * @property {Array.<string>} urls ArcGIS Rest service urls. Use this instead of `url` when the ArcGIS\n * Service supports multiple urls for export requests.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data from ArcGIS Rest services. Map and Image\n * Services are supported.\n *\n * For cached ArcGIS services, better performance is available using the\n * {@link module:ol/source/XYZ~XYZ} data source.\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/TileArcGISRest~Options=} opt_options Tile ArcGIS Rest options.\n * @api\n */\nconst TileArcGISRest = function(opt_options) {\n\n  const options = opt_options || {};\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    projection: options.projection,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileGrid: options.tileGrid,\n    tileLoadFunction: options.tileLoadFunction,\n    url: options.url,\n    urls: options.urls,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    transition: options.transition\n  });\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.params_ = options.params || {};\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.tmpExtent_ = createEmpty();\n\n  this.setKey(this.getKeyForParams_());\n};\n\ninherits(TileArcGISRest, TileImage);\n\n\n/**\n * @private\n * @return {string} The key for the current params.\n */\nTileArcGISRest.prototype.getKeyForParams_ = function() {\n  let i = 0;\n  const res = [];\n  for (const key in this.params_) {\n    res[i++] = key + '-' + this.params_[key];\n  }\n  return res.join('/');\n};\n\n\n/**\n * Get the user-provided params, i.e. those passed to the constructor through\n * the \"params\" option, and possibly updated using the updateParams method.\n * @return {Object} Params.\n * @api\n */\nTileArcGISRest.prototype.getParams = function() {\n  return this.params_;\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/size~Size} tileSize Tile size.\n * @param {module:ol/extent~Extent} tileExtent Tile extent.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {Object} params Params.\n * @return {string|undefined} Request URL.\n * @private\n */\nTileArcGISRest.prototype.getRequestUrl_ = function(tileCoord, tileSize, tileExtent,\n  pixelRatio, projection, params) {\n\n  const urls = this.urls;\n  if (!urls) {\n    return undefined;\n  }\n\n  // ArcGIS Server only wants the numeric portion of the projection ID.\n  const srid = projection.getCode().split(':').pop();\n\n  params['SIZE'] = tileSize[0] + ',' + tileSize[1];\n  params['BBOX'] = tileExtent.join(',');\n  params['BBOXSR'] = srid;\n  params['IMAGESR'] = srid;\n  params['DPI'] = Math.round(\n    params['DPI'] ? params['DPI'] * pixelRatio : 90 * pixelRatio\n  );\n\n  let url;\n  if (urls.length == 1) {\n    url = urls[0];\n  } else {\n    const index = modulo(tileCoordHash(tileCoord), urls.length);\n    url = urls[index];\n  }\n\n  const modifiedUrl = url\n    .replace(/MapServer\\/?$/, 'MapServer/export')\n    .replace(/ImageServer\\/?$/, 'ImageServer/exportImage');\n  return appendParams(modifiedUrl, params);\n};\n\n\n/**\n * @inheritDoc\n */\nTileArcGISRest.prototype.getTilePixelRatio = function(pixelRatio) {\n  return /** @type {number} */ (pixelRatio);\n};\n\n\n/**\n * @inheritDoc\n */\nTileArcGISRest.prototype.fixedTileUrlFunction = function(tileCoord, pixelRatio, projection) {\n\n  let tileGrid = this.getTileGrid();\n  if (!tileGrid) {\n    tileGrid = this.getTileGridForProjection(projection);\n  }\n\n  if (tileGrid.getResolutions().length <= tileCoord[0]) {\n    return undefined;\n  }\n\n  const tileExtent = tileGrid.getTileCoordExtent(\n    tileCoord, this.tmpExtent_);\n  let tileSize = toSize(\n    tileGrid.getTileSize(tileCoord[0]), this.tmpSize);\n\n  if (pixelRatio != 1) {\n    tileSize = scaleSize(tileSize, pixelRatio, this.tmpSize);\n  }\n\n  // Apply default params and override with user specified values.\n  const baseParams = {\n    'F': 'image',\n    'FORMAT': 'PNG32',\n    'TRANSPARENT': true\n  };\n  assign(baseParams, this.params_);\n\n  return this.getRequestUrl_(tileCoord, tileSize, tileExtent,\n    pixelRatio, projection, baseParams);\n};\n\n\n/**\n * Update the user-provided params.\n * @param {Object} params Params.\n * @api\n */\nTileArcGISRest.prototype.updateParams = function(params) {\n  assign(this.params_, params);\n  this.setKey(this.getKeyForParams_());\n};\nexport default TileArcGISRest;\n","/**\n * @module ol/source/TileDebug\n */\nimport {inherits} from '../util.js';\nimport Tile from '../Tile.js';\nimport TileState from '../TileState.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {toSize} from '../size.js';\nimport TileSource from '../source/Tile.js';\nimport {getKeyZXY} from '../tilecoord.js';\n\n\n/**\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/size~Size} tileSize Tile size.\n * @param {string} text Text.\n */\nconst LabeledTile = function(tileCoord, tileSize, text) {\n\n  Tile.call(this, tileCoord, TileState.LOADED);\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.tileSize_ = tileSize;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.text_ = text;\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = null;\n\n};\ninherits(LabeledTile, Tile);\n\n\n/**\n * Get the image element for this tile.\n * @return {HTMLCanvasElement} Image.\n */\nLabeledTile.prototype.getImage = function() {\n  if (this.canvas_) {\n    return this.canvas_;\n  } else {\n    const tileSize = this.tileSize_;\n    const context = createCanvasContext2D(tileSize[0], tileSize[1]);\n\n    context.strokeStyle = 'black';\n    context.strokeRect(0.5, 0.5, tileSize[0] + 0.5, tileSize[1] + 0.5);\n\n    context.fillStyle = 'black';\n    context.textAlign = 'center';\n    context.textBaseline = 'middle';\n    context.font = '24px sans-serif';\n    context.fillText(this.text_, tileSize[0] / 2, tileSize[1] / 2);\n\n    this.canvas_ = context.canvas;\n    return context.canvas;\n  }\n};\n\n\n/**\n * @override\n */\nLabeledTile.prototype.load = function() {};\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n\n/**\n * @classdesc\n * A pseudo tile source, which does not fetch tiles from a server, but renders\n * a grid outline for the tile grid/projection along with the coordinates for\n * each tile. See examples/canvas-tiles for an example.\n *\n * Uses Canvas context2d, so requires Canvas support.\n *\n * @constructor\n * @extends {module:ol/source/Tile}\n * @param {module:ol/source/TileDebug~Options=} options Debug tile options.\n * @api\n */\nconst TileDebug = function(options) {\n\n  TileSource.call(this, {\n    opaque: false,\n    projection: options.projection,\n    tileGrid: options.tileGrid,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true\n  });\n\n};\n\ninherits(TileDebug, TileSource);\n\n\n/**\n * @inheritDoc\n */\nTileDebug.prototype.getTile = function(z, x, y) {\n  const tileCoordKey = getKeyZXY(z, x, y);\n  if (this.tileCache.containsKey(tileCoordKey)) {\n    return /** @type {!module:ol/source/TileDebug~LabeledTile} */ (this.tileCache.get(tileCoordKey));\n  } else {\n    const tileSize = toSize(this.tileGrid.getTileSize(z));\n    const tileCoord = [z, x, y];\n    const textTileCoord = this.getTileCoordForTileUrlFunction(tileCoord);\n    const text = !textTileCoord ? '' :\n      this.getTileCoordForTileUrlFunction(textTileCoord).toString();\n    const tile = new LabeledTile(tileCoord, tileSize, text);\n    this.tileCache.set(tileCoordKey, tile);\n    return tile;\n  }\n};\n\n\nexport default TileDebug;\n","/**\n * @module ol/source/TileJSON\n */\n// FIXME check order of async callbacks\n\n/**\n * @see http://mapbox.com/developers/api/\n */\n\nimport {inherits} from '../util.js';\nimport {createFromTemplates} from '../tileurlfunction.js';\nimport {assert} from '../asserts.js';\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport SourceState from '../source/State.js';\nimport TileImage from '../source/TileImage.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {boolean} [jsonp=false] Use JSONP with callback to load the TileJSON.\n * Useful when the server does not support CORS..\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {tileJSON} [tileJSON] TileJSON configuration for this source.\n * If not provided, `url` must be configured.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] URL to the TileJSON file. If not provided, `tileJSON` must be configured.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data in TileJSON format.\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/TileJSON~Options=} options TileJSON options.\n * @api\n */\nconst TileJSON = function(options) {\n\n  /**\n   * @type {TileJSON}\n   * @private\n   */\n  this.tileJSON_ = null;\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    projection: getProjection('EPSG:3857'),\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    state: SourceState.LOADING,\n    tileLoadFunction: options.tileLoadFunction,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    transition: options.transition\n  });\n\n  if (options.url) {\n    if (options.jsonp) {\n      requestJSONP(options.url, this.handleTileJSONResponse.bind(this),\n        this.handleTileJSONError.bind(this));\n    } else {\n      const client = new XMLHttpRequest();\n      client.addEventListener('load', this.onXHRLoad_.bind(this));\n      client.addEventListener('error', this.onXHRError_.bind(this));\n      client.open('GET', options.url);\n      client.send();\n    }\n  } else if (options.tileJSON) {\n    this.handleTileJSONResponse(options.tileJSON);\n  } else {\n    assert(false, 51); // Either `url` or `tileJSON` options must be provided\n  }\n\n};\n\ninherits(TileJSON, TileImage);\n\n\n/**\n * @private\n * @param {Event} event The load event.\n */\nTileJSON.prototype.onXHRLoad_ = function(event) {\n  const client = /** @type {XMLHttpRequest} */ (event.target);\n  // status will be 0 for file:// urls\n  if (!client.status || client.status >= 200 && client.status < 300) {\n    let response;\n    try {\n      response = /** @type {TileJSON} */(JSON.parse(client.responseText));\n    } catch (err) {\n      this.handleTileJSONError();\n      return;\n    }\n    this.handleTileJSONResponse(response);\n  } else {\n    this.handleTileJSONError();\n  }\n};\n\n\n/**\n * @private\n * @param {Event} event The error event.\n */\nTileJSON.prototype.onXHRError_ = function(event) {\n  this.handleTileJSONError();\n};\n\n\n/**\n * @return {TileJSON} The tilejson object.\n * @api\n */\nTileJSON.prototype.getTileJSON = function() {\n  return this.tileJSON_;\n};\n\n\n/**\n * @protected\n * @param {TileJSON} tileJSON Tile JSON.\n */\nTileJSON.prototype.handleTileJSONResponse = function(tileJSON) {\n\n  const epsg4326Projection = getProjection('EPSG:4326');\n\n  const sourceProjection = this.getProjection();\n  let extent;\n  if (tileJSON.bounds !== undefined) {\n    const transform = getTransformFromProjections(\n      epsg4326Projection, sourceProjection);\n    extent = applyTransform(tileJSON.bounds, transform);\n  }\n\n  const minZoom = tileJSON.minzoom || 0;\n  const maxZoom = tileJSON.maxzoom || 22;\n  const tileGrid = createXYZ({\n    extent: extentFromProjection(sourceProjection),\n    maxZoom: maxZoom,\n    minZoom: minZoom\n  });\n  this.tileGrid = tileGrid;\n\n  this.tileUrlFunction = createFromTemplates(tileJSON.tiles, tileGrid);\n\n  if (tileJSON.attribution !== undefined && !this.getAttributions()) {\n    const attributionExtent = extent !== undefined ?\n      extent : epsg4326Projection.getExtent();\n\n    this.setAttributions(function(frameState) {\n      if (intersects(attributionExtent, frameState.extent)) {\n        return [tileJSON.attribution];\n      }\n      return null;\n    });\n\n  }\n  this.tileJSON_ = tileJSON;\n  this.setState(SourceState.READY);\n\n};\n\n\n/**\n * @protected\n */\nTileJSON.prototype.handleTileJSONError = function() {\n  this.setState(SourceState.ERROR);\n};\nexport default TileJSON;\n","/**\n * @module ol/source/TileWMS\n */\n\nimport {DEFAULT_WMS_VERSION} from './common.js';\nimport {inherits} from '../util.js';\nimport {assert} from '../asserts.js';\nimport {buffer, createEmpty} from '../extent.js';\nimport {assign} from '../obj.js';\nimport {modulo} from '../math.js';\nimport {get as getProjection, transform, transformExtent} from '../proj.js';\nimport {calculateSourceResolution} from '../reproj.js';\nimport {toSize, buffer as bufferSize, scale as scaleSize} from '../size.js';\nimport TileImage from '../source/TileImage.js';\nimport WMSServerType from '../source/WMSServerType.js';\nimport {hash as tileCoordHash} from '../tilecoord.js';\nimport {compareVersions} from '../string.js';\nimport {appendParams} from '../uri.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {Object.<string,*>} params WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT`, `BBOX`\n * and `CRS` (`SRS` for WMS version < 1.3.0) will be set dynamically.\n * @property {number} [gutter=0]\n * The size in pixels of the gutter around image tiles to ignore. By setting\n * this property to a non-zero value, images will be requested that are wider\n * and taller than the tile size by a value of `2 x gutter`.\n * Using a non-zero value allows artifacts of rendering at tile edges to be\n * ignored. If you control the WMS service it is recommended to address\n * \"artifacts at tile edges\" issues by properly configuring the WMS service. For\n * example, MapServer has a `tile_map_edge_buffer` configuration parameter for\n * this. See http://mapserver.org/output/tile_mode.html.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/ImageTile~TileClass} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/ImageTile~TileClass}.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid. Base this on the resolutions,\n * tilesize and extent supported by the server.\n * If this is not defined, a default grid will be used: if there is a projection\n * extent, the grid will be based on that; if not, a grid based on a global\n * extent with origin at 0,0 will be used..\n * @property {module:ol/source/WMSServerType|string} [serverType]\n * The type of the remote WMS server. Currently only used when `hidpi` is\n * `true`.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] WMS service URL.\n * @property {Array.<string>} [urls] WMS service urls.\n * Use this instead of `url` when the WMS supports multiple urls for GetMap requests.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When `true`, tiles will be requested for one world only,\n * but they will be wrapped horizontally to render multiple worlds.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data from WMS servers.\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/TileWMS~Options=} [opt_options] Tile WMS options.\n * @api\n */\nconst TileWMS = function(opt_options) {\n\n  const options = opt_options || {};\n\n  const params = options.params || {};\n\n  const transparent = 'TRANSPARENT' in params ? params['TRANSPARENT'] : true;\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    opaque: !transparent,\n    projection: options.projection,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileClass: options.tileClass,\n    tileGrid: options.tileGrid,\n    tileLoadFunction: options.tileLoadFunction,\n    url: options.url,\n    urls: options.urls,\n    wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    transition: options.transition\n  });\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.gutter_ = options.gutter !== undefined ? options.gutter : 0;\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.params_ = params;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.v13_ = true;\n\n  /**\n   * @private\n   * @type {module:ol/source/WMSServerType|undefined}\n   */\n  this.serverType_ = /** @type {module:ol/source/WMSServerType|undefined} */ (options.serverType);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.tmpExtent_ = createEmpty();\n\n  this.updateV13_();\n  this.setKey(this.getKeyForParams_());\n\n};\n\ninherits(TileWMS, TileImage);\n\n\n/**\n * Return the GetFeatureInfo URL for the passed coordinate, resolution, and\n * projection. Return `undefined` if the GetFeatureInfo URL cannot be\n * constructed.\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {module:ol/proj~ProjectionLike} projection Projection.\n * @param {!Object} params GetFeatureInfo params. `INFO_FORMAT` at least should\n *     be provided. If `QUERY_LAYERS` is not provided then the layers specified\n *     in the `LAYERS` parameter will be used. `VERSION` should not be\n *     specified here.\n * @return {string|undefined} GetFeatureInfo URL.\n * @api\n */\nTileWMS.prototype.getGetFeatureInfoUrl = function(coordinate, resolution, projection, params) {\n  const projectionObj = getProjection(projection);\n  const sourceProjectionObj = this.getProjection();\n\n  let tileGrid = this.getTileGrid();\n  if (!tileGrid) {\n    tileGrid = this.getTileGridForProjection(projectionObj);\n  }\n\n  const tileCoord = tileGrid.getTileCoordForCoordAndResolution(coordinate, resolution);\n\n  if (tileGrid.getResolutions().length <= tileCoord[0]) {\n    return undefined;\n  }\n\n  let tileResolution = tileGrid.getResolution(tileCoord[0]);\n  let tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n  let tileSize = toSize(tileGrid.getTileSize(tileCoord[0]), this.tmpSize);\n\n\n  const gutter = this.gutter_;\n  if (gutter !== 0) {\n    tileSize = bufferSize(tileSize, gutter, this.tmpSize);\n    tileExtent = buffer(tileExtent, tileResolution * gutter, tileExtent);\n  }\n\n  if (sourceProjectionObj && sourceProjectionObj !== projectionObj) {\n    tileResolution = calculateSourceResolution(sourceProjectionObj, projectionObj, coordinate, tileResolution);\n    tileExtent = transformExtent(tileExtent, projectionObj, sourceProjectionObj);\n    coordinate = transform(coordinate, projectionObj, sourceProjectionObj);\n  }\n\n  const baseParams = {\n    'SERVICE': 'WMS',\n    'VERSION': DEFAULT_WMS_VERSION,\n    'REQUEST': 'GetFeatureInfo',\n    'FORMAT': 'image/png',\n    'TRANSPARENT': true,\n    'QUERY_LAYERS': this.params_['LAYERS']\n  };\n  assign(baseParams, this.params_, params);\n\n  const x = Math.floor((coordinate[0] - tileExtent[0]) / tileResolution);\n  const y = Math.floor((tileExtent[3] - coordinate[1]) / tileResolution);\n\n  baseParams[this.v13_ ? 'I' : 'X'] = x;\n  baseParams[this.v13_ ? 'J' : 'Y'] = y;\n\n  return this.getRequestUrl_(tileCoord, tileSize, tileExtent,\n    1, sourceProjectionObj || projectionObj, baseParams);\n};\n\n\n/**\n * @inheritDoc\n */\nTileWMS.prototype.getGutterInternal = function() {\n  return this.gutter_;\n};\n\n\n/**\n * Get the user-provided params, i.e. those passed to the constructor through\n * the \"params\" option, and possibly updated using the updateParams method.\n * @return {Object} Params.\n * @api\n */\nTileWMS.prototype.getParams = function() {\n  return this.params_;\n};\n\n\n/**\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/size~Size} tileSize Tile size.\n * @param {module:ol/extent~Extent} tileExtent Tile extent.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {Object} params Params.\n * @return {string|undefined} Request URL.\n * @private\n */\nTileWMS.prototype.getRequestUrl_ = function(tileCoord, tileSize, tileExtent,\n  pixelRatio, projection, params) {\n\n  const urls = this.urls;\n  if (!urls) {\n    return undefined;\n  }\n\n  params['WIDTH'] = tileSize[0];\n  params['HEIGHT'] = tileSize[1];\n\n  params[this.v13_ ? 'CRS' : 'SRS'] = projection.getCode();\n\n  if (!('STYLES' in this.params_)) {\n    params['STYLES'] = '';\n  }\n\n  if (pixelRatio != 1) {\n    switch (this.serverType_) {\n      case WMSServerType.GEOSERVER:\n        const dpi = (90 * pixelRatio + 0.5) | 0;\n        if ('FORMAT_OPTIONS' in params) {\n          params['FORMAT_OPTIONS'] += ';dpi:' + dpi;\n        } else {\n          params['FORMAT_OPTIONS'] = 'dpi:' + dpi;\n        }\n        break;\n      case WMSServerType.MAPSERVER:\n        params['MAP_RESOLUTION'] = 90 * pixelRatio;\n        break;\n      case WMSServerType.CARMENTA_SERVER:\n      case WMSServerType.QGIS:\n        params['DPI'] = 90 * pixelRatio;\n        break;\n      default:\n        assert(false, 52); // Unknown `serverType` configured\n        break;\n    }\n  }\n\n  const axisOrientation = projection.getAxisOrientation();\n  const bbox = tileExtent;\n  if (this.v13_ && axisOrientation.substr(0, 2) == 'ne') {\n    let tmp;\n    tmp = tileExtent[0];\n    bbox[0] = tileExtent[1];\n    bbox[1] = tmp;\n    tmp = tileExtent[2];\n    bbox[2] = tileExtent[3];\n    bbox[3] = tmp;\n  }\n  params['BBOX'] = bbox.join(',');\n\n  let url;\n  if (urls.length == 1) {\n    url = urls[0];\n  } else {\n    const index = modulo(tileCoordHash(tileCoord), urls.length);\n    url = urls[index];\n  }\n  return appendParams(url, params);\n};\n\n\n/**\n * @inheritDoc\n */\nTileWMS.prototype.getTilePixelRatio = function(pixelRatio) {\n  return (!this.hidpi_ || this.serverType_ === undefined) ? 1 :\n  /** @type {number} */ (pixelRatio);\n};\n\n\n/**\n * @private\n * @return {string} The key for the current params.\n */\nTileWMS.prototype.getKeyForParams_ = function() {\n  let i = 0;\n  const res = [];\n  for (const key in this.params_) {\n    res[i++] = key + '-' + this.params_[key];\n  }\n  return res.join('/');\n};\n\n\n/**\n * @inheritDoc\n */\nTileWMS.prototype.fixedTileUrlFunction = function(tileCoord, pixelRatio, projection) {\n\n  let tileGrid = this.getTileGrid();\n  if (!tileGrid) {\n    tileGrid = this.getTileGridForProjection(projection);\n  }\n\n  if (tileGrid.getResolutions().length <= tileCoord[0]) {\n    return undefined;\n  }\n\n  if (pixelRatio != 1 && (!this.hidpi_ || this.serverType_ === undefined)) {\n    pixelRatio = 1;\n  }\n\n  const tileResolution = tileGrid.getResolution(tileCoord[0]);\n  let tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n  let tileSize = toSize(\n    tileGrid.getTileSize(tileCoord[0]), this.tmpSize);\n\n  const gutter = this.gutter_;\n  if (gutter !== 0) {\n    tileSize = bufferSize(tileSize, gutter, this.tmpSize);\n    tileExtent = buffer(tileExtent, tileResolution * gutter, tileExtent);\n  }\n\n  if (pixelRatio != 1) {\n    tileSize = scaleSize(tileSize, pixelRatio, this.tmpSize);\n  }\n\n  const baseParams = {\n    'SERVICE': 'WMS',\n    'VERSION': DEFAULT_WMS_VERSION,\n    'REQUEST': 'GetMap',\n    'FORMAT': 'image/png',\n    'TRANSPARENT': true\n  };\n  assign(baseParams, this.params_);\n\n  return this.getRequestUrl_(tileCoord, tileSize, tileExtent,\n    pixelRatio, projection, baseParams);\n};\n\n/**\n * Update the user-provided params.\n * @param {Object} params Params.\n * @api\n */\nTileWMS.prototype.updateParams = function(params) {\n  assign(this.params_, params);\n  this.updateV13_();\n  this.setKey(this.getKeyForParams_());\n};\n\n\n/**\n * @private\n */\nTileWMS.prototype.updateV13_ = function() {\n  const version = this.params_['VERSION'] || DEFAULT_WMS_VERSION;\n  this.v13_ = compareVersions(version, '1.3') >= 0;\n};\nexport default TileWMS;\n","/**\n * @module ol/source/UTFGrid\n */\nimport {inherits} from '../util.js';\nimport Tile from '../Tile.js';\nimport TileState from '../TileState.js';\nimport {createFromTemplates, nullTileUrlFunction} from '../tileurlfunction.js';\nimport {assert} from '../asserts.js';\nimport {listenOnce} from '../events.js';\nimport EventType from '../events/EventType.js';\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport SourceState from '../source/State.js';\nimport TileSource from '../source/Tile.js';\nimport {getKeyZXY} from '../tilecoord.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\n\n\n/**\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {string} src Image source URI.\n * @param {module:ol/extent~Extent} extent Extent of the tile.\n * @param {boolean} preemptive Load the tile when visible (before it's needed).\n * @param {boolean} jsonp Load the tile as a script.\n */\nexport const CustomTile = function(tileCoord, state, src, extent, preemptive, jsonp) {\n\n  Tile.call(this, tileCoord, state);\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.src_ = src;\n\n  /**\n   * @private\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent_ = extent;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.preemptive_ = preemptive;\n\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.grid_ = null;\n\n  /**\n   * @private\n   * @type {Array.<string>}\n   */\n  this.keys_ = null;\n\n  /**\n   * @private\n   * @type {Object.<string, Object>|undefined}\n   */\n  this.data_ = null;\n\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.jsonp_ = jsonp;\n\n};\ninherits(CustomTile, Tile);\n\n\n/**\n * Get the image element for this tile.\n * @return {Image} Image.\n */\nCustomTile.prototype.getImage = function() {\n  return null;\n};\n\n\n/**\n * Synchronously returns data at given coordinate (if available).\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @return {*} The data.\n */\nCustomTile.prototype.getData = function(coordinate) {\n  if (!this.grid_ || !this.keys_) {\n    return null;\n  }\n  const xRelative = (coordinate[0] - this.extent_[0]) /\n      (this.extent_[2] - this.extent_[0]);\n  const yRelative = (coordinate[1] - this.extent_[1]) /\n      (this.extent_[3] - this.extent_[1]);\n\n  const row = this.grid_[Math.floor((1 - yRelative) * this.grid_.length)];\n\n  if (typeof row !== 'string') {\n    return null;\n  }\n\n  let code = row.charCodeAt(Math.floor(xRelative * row.length));\n  if (code >= 93) {\n    code--;\n  }\n  if (code >= 35) {\n    code--;\n  }\n  code -= 32;\n\n  let data = null;\n  if (code in this.keys_) {\n    const id = this.keys_[code];\n    if (this.data_ && id in this.data_) {\n      data = this.data_[id];\n    } else {\n      data = id;\n    }\n  }\n  return data;\n};\n\n\n/**\n * Calls the callback (synchronously by default) with the available data\n * for given coordinate (or `null` if not yet loaded).\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {function(this: T, *)} callback Callback.\n * @param {T=} opt_this The object to use as `this` in the callback.\n * @param {boolean=} opt_request If `true` the callback is always async.\n *                               The tile data is requested if not yet loaded.\n * @template T\n */\nCustomTile.prototype.forDataAtCoordinate = function(coordinate, callback, opt_this, opt_request) {\n  if (this.state == TileState.IDLE && opt_request === true) {\n    listenOnce(this, EventType.CHANGE, function(e) {\n      callback.call(opt_this, this.getData(coordinate));\n    }, this);\n    this.loadInternal_();\n  } else {\n    if (opt_request === true) {\n      setTimeout(function() {\n        callback.call(opt_this, this.getData(coordinate));\n      }.bind(this), 0);\n    } else {\n      callback.call(opt_this, this.getData(coordinate));\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nCustomTile.prototype.getKey = function() {\n  return this.src_;\n};\n\n\n/**\n * @private\n */\nCustomTile.prototype.handleError_ = function() {\n  this.state = TileState.ERROR;\n  this.changed();\n};\n\n\n/**\n * @param {!UTFGridJSON} json UTFGrid data.\n * @private\n */\nCustomTile.prototype.handleLoad_ = function(json) {\n  this.grid_ = json.grid;\n  this.keys_ = json.keys;\n  this.data_ = json.data;\n\n  this.state = TileState.EMPTY;\n  this.changed();\n};\n\n\n/**\n * @private\n */\nCustomTile.prototype.loadInternal_ = function() {\n  if (this.state == TileState.IDLE) {\n    this.state = TileState.LOADING;\n    if (this.jsonp_) {\n      requestJSONP(this.src_, this.handleLoad_.bind(this),\n        this.handleError_.bind(this));\n    } else {\n      const client = new XMLHttpRequest();\n      client.addEventListener('load', this.onXHRLoad_.bind(this));\n      client.addEventListener('error', this.onXHRError_.bind(this));\n      client.open('GET', this.src_);\n      client.send();\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {Event} event The load event.\n */\nCustomTile.prototype.onXHRLoad_ = function(event) {\n  const client = /** @type {XMLHttpRequest} */ (event.target);\n  // status will be 0 for file:// urls\n  if (!client.status || client.status >= 200 && client.status < 300) {\n    let response;\n    try {\n      response = /** @type {!UTFGridJSON} */(JSON.parse(client.responseText));\n    } catch (err) {\n      this.handleError_();\n      return;\n    }\n    this.handleLoad_(response);\n  } else {\n    this.handleError_();\n  }\n};\n\n\n/**\n * @private\n * @param {Event} event The error event.\n */\nCustomTile.prototype.onXHRError_ = function(event) {\n  this.handleError_();\n};\n\n\n/**\n * @override\n */\nCustomTile.prototype.load = function() {\n  if (this.preemptive_) {\n    this.loadInternal_();\n  }\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [preemptive=true]\n * If `true` the UTFGrid source loads the tiles based on their \"visibility\".\n * This improves the speed of response, but increases traffic.\n * Note that if set to `false`, you need to pass `true` as `opt_request`\n * to the `forDataAtCoordinateAndResolution` method otherwise no data\n * will ever be loaded.\n * @property {boolean} [jsonp=false] Use JSONP with callback to load the TileJSON.\n * Useful when the server does not support CORS..\n * @property {tileJSON} [tileJSON] TileJSON configuration for this source.\n * If not provided, `url` must be configured.\n * @property {string} [url] TileJSON endpoint that provides the configuration for this source.\n * Request will be made through JSONP. If not provided, `tileJSON` must be configured.\n */\n\n\n/**\n * @classdesc\n * Layer source for UTFGrid interaction data loaded from TileJSON format.\n *\n * @constructor\n * @extends {module:ol/source/Tile}\n * @param {module:ol/source/UTFGrid~Options=} options Source options.\n * @api\n */\nconst UTFGrid = function(options) {\n  TileSource.call(this, {\n    projection: getProjection('EPSG:3857'),\n    state: SourceState.LOADING\n  });\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.preemptive_ = options.preemptive !== undefined ?\n    options.preemptive : true;\n\n  /**\n   * @private\n   * @type {!module:ol/Tile~UrlFunction}\n   */\n  this.tileUrlFunction_ = nullTileUrlFunction;\n\n  /**\n   * @private\n   * @type {string|undefined}\n   */\n  this.template_ = undefined;\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.jsonp_ = options.jsonp || false;\n\n  if (options.url) {\n    if (this.jsonp_) {\n      requestJSONP(options.url, this.handleTileJSONResponse.bind(this),\n        this.handleTileJSONError.bind(this));\n    } else {\n      const client = new XMLHttpRequest();\n      client.addEventListener('load', this.onXHRLoad_.bind(this));\n      client.addEventListener('error', this.onXHRError_.bind(this));\n      client.open('GET', options.url);\n      client.send();\n    }\n  } else if (options.tileJSON) {\n    this.handleTileJSONResponse(options.tileJSON);\n  } else {\n    assert(false, 51); // Either `url` or `tileJSON` options must be provided\n  }\n};\n\ninherits(UTFGrid, TileSource);\n\n\n/**\n * @private\n * @param {Event} event The load event.\n */\nUTFGrid.prototype.onXHRLoad_ = function(event) {\n  const client = /** @type {XMLHttpRequest} */ (event.target);\n  // status will be 0 for file:// urls\n  if (!client.status || client.status >= 200 && client.status < 300) {\n    let response;\n    try {\n      response = /** @type {TileJSON} */(JSON.parse(client.responseText));\n    } catch (err) {\n      this.handleTileJSONError();\n      return;\n    }\n    this.handleTileJSONResponse(response);\n  } else {\n    this.handleTileJSONError();\n  }\n};\n\n\n/**\n * @private\n * @param {Event} event The error event.\n */\nUTFGrid.prototype.onXHRError_ = function(event) {\n  this.handleTileJSONError();\n};\n\n\n/**\n * Return the template from TileJSON.\n * @return {string|undefined} The template from TileJSON.\n * @api\n */\nUTFGrid.prototype.getTemplate = function() {\n  return this.template_;\n};\n\n\n/**\n * Calls the callback (synchronously by default) with the available data\n * for given coordinate and resolution (or `null` if not yet loaded or\n * in case of an error).\n * @param {module:ol/coordinate~Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @param {function(*)} callback Callback.\n * @param {boolean=} opt_request If `true` the callback is always async.\n *                               The tile data is requested if not yet loaded.\n * @api\n */\nUTFGrid.prototype.forDataAtCoordinateAndResolution = function(\n  coordinate, resolution, callback, opt_request) {\n  if (this.tileGrid) {\n    const tileCoord = this.tileGrid.getTileCoordForCoordAndResolution(\n      coordinate, resolution);\n    const tile = /** @type {!module:ol/source/UTFGrid~CustomTile} */(this.getTile(\n      tileCoord[0], tileCoord[1], tileCoord[2], 1, this.getProjection()));\n    tile.forDataAtCoordinate(coordinate, callback, null, opt_request);\n  } else {\n    if (opt_request === true) {\n      setTimeout(function() {\n        callback(null);\n      }, 0);\n    } else {\n      callback(null);\n    }\n  }\n};\n\n\n/**\n * @protected\n */\nUTFGrid.prototype.handleTileJSONError = function() {\n  this.setState(SourceState.ERROR);\n};\n\n\n/**\n * TODO: very similar to ol/source/TileJSON#handleTileJSONResponse\n * @protected\n * @param {TileJSON} tileJSON Tile JSON.\n */\nUTFGrid.prototype.handleTileJSONResponse = function(tileJSON) {\n\n  const epsg4326Projection = getProjection('EPSG:4326');\n\n  const sourceProjection = this.getProjection();\n  let extent;\n  if (tileJSON.bounds !== undefined) {\n    const transform = getTransformFromProjections(\n      epsg4326Projection, sourceProjection);\n    extent = applyTransform(tileJSON.bounds, transform);\n  }\n\n  const minZoom = tileJSON.minzoom || 0;\n  const maxZoom = tileJSON.maxzoom || 22;\n  const tileGrid = createXYZ({\n    extent: extentFromProjection(sourceProjection),\n    maxZoom: maxZoom,\n    minZoom: minZoom\n  });\n  this.tileGrid = tileGrid;\n\n  this.template_ = tileJSON.template;\n\n  const grids = tileJSON.grids;\n  if (!grids) {\n    this.setState(SourceState.ERROR);\n    return;\n  }\n\n  this.tileUrlFunction_ = createFromTemplates(grids, tileGrid);\n\n  if (tileJSON.attribution !== undefined) {\n    const attributionExtent = extent !== undefined ?\n      extent : epsg4326Projection.getExtent();\n\n    this.setAttributions(function(frameState) {\n      if (intersects(attributionExtent, frameState.extent)) {\n        return [tileJSON.attribution];\n      }\n      return null;\n    });\n  }\n\n  this.setState(SourceState.READY);\n\n};\n\n\n/**\n * @inheritDoc\n */\nUTFGrid.prototype.getTile = function(z, x, y, pixelRatio, projection) {\n  const tileCoordKey = getKeyZXY(z, x, y);\n  if (this.tileCache.containsKey(tileCoordKey)) {\n    return (\n      /** @type {!module:ol/Tile} */ (this.tileCache.get(tileCoordKey))\n    );\n  } else {\n    const tileCoord = [z, x, y];\n    const urlTileCoord =\n        this.getTileCoordForTileUrlFunction(tileCoord, projection);\n    const tileUrl = this.tileUrlFunction_(urlTileCoord, pixelRatio, projection);\n    const tile = new CustomTile(\n      tileCoord,\n      tileUrl !== undefined ? TileState.IDLE : TileState.EMPTY,\n      tileUrl !== undefined ? tileUrl : '',\n      this.tileGrid.getTileCoordExtent(tileCoord),\n      this.preemptive_,\n      this.jsonp_);\n    this.tileCache.set(tileCoordKey, tile);\n    return tile;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nUTFGrid.prototype.useTile = function(z, x, y) {\n  const tileCoordKey = getKeyZXY(z, x, y);\n  if (this.tileCache.containsKey(tileCoordKey)) {\n    this.tileCache.get(tileCoordKey);\n  }\n};\n\n\nexport default UTFGrid;\n","/**\n * @module ol/VectorImageTile\n */\nimport {getUid, inherits} from './util.js';\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\nimport {createCanvasContext2D} from './dom.js';\nimport {listen, unlistenByKey} from './events.js';\nimport {getHeight, getIntersection, getWidth} from './extent.js';\nimport EventType from './events/EventType.js';\nimport {loadFeaturesXhr} from './featureloader.js';\nimport {UNDEFINED} from './functions.js';\n\n\n/**\n * @typedef {Object} ReplayState\n * @property {boolean} dirty\n * @property {null|module:ol/render~OrderFunction} renderedRenderOrder\n * @property {number} renderedTileRevision\n * @property {number} renderedRevision\n */\n\n\n/**\n * @constructor\n * @extends {module:ol/Tile}\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {number} sourceRevision Source revision.\n * @param {module:ol/format/Feature} format Feature format.\n * @param {module:ol/Tile~LoadFunction} tileLoadFunction Tile load function.\n * @param {module:ol/tilecoord~TileCoord} urlTileCoord Wrapped tile coordinate for source urls.\n * @param {module:ol/Tile~UrlFunction} tileUrlFunction Tile url function.\n * @param {module:ol/tilegrid/TileGrid} sourceTileGrid Tile grid of the source.\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid of the renderer.\n * @param {Object.<string, module:ol/VectorTile>} sourceTiles Source tiles.\n * @param {number} pixelRatio Pixel ratio.\n * @param {module:ol/proj/Projection} projection Projection.\n * @param {function(new: module:ol/VectorTile, module:ol/tilecoord~TileCoord, module:ol/TileState, string,\n *     module:ol/format/Feature, module:ol/Tile~LoadFunction)} tileClass Class to\n *     instantiate for source tiles.\n * @param {function(this: module:ol/source/VectorTile, module:ol/events/Event)} handleTileChange\n *     Function to call when a source tile's state changes.\n * @param {number} zoom Integer zoom to render the tile for.\n */\nconst VectorImageTile = function(tileCoord, state, sourceRevision, format,\n  tileLoadFunction, urlTileCoord, tileUrlFunction, sourceTileGrid, tileGrid,\n  sourceTiles, pixelRatio, projection, tileClass, handleTileChange, zoom) {\n\n  Tile.call(this, tileCoord, state, {transition: 0});\n\n  /**\n   * @private\n   * @type {!Object.<string, CanvasRenderingContext2D>}\n   */\n  this.context_ = {};\n\n  /**\n   * @private\n   * @type {module:ol/featureloader~FeatureLoader}\n   */\n  this.loader_;\n\n  /**\n   * @private\n   * @type {!Object.<string, module:ol/VectorImageTile~ReplayState>}\n   */\n  this.replayState_ = {};\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/VectorTile>}\n   */\n  this.sourceTiles_ = sourceTiles;\n\n  /**\n   * Keys of source tiles used by this tile. Use with {@link #getTile}.\n   * @type {Array.<string>}\n   */\n  this.tileKeys = [];\n\n  /**\n   * @type {module:ol/extent~Extent}\n   */\n  this.extent = null;\n\n  /**\n   * @type {number}\n   */\n  this.sourceRevision_ = sourceRevision;\n\n  /**\n   * @type {module:ol/tilecoord~TileCoord}\n   */\n  this.wrappedTileCoord = urlTileCoord;\n\n  /**\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.loadListenerKeys_ = [];\n\n  /**\n   * @type {Array.<module:ol/events~EventsKey>}\n   */\n  this.sourceTileListenerKeys_ = [];\n\n  if (urlTileCoord) {\n    const extent = this.extent = tileGrid.getTileCoordExtent(urlTileCoord);\n    const resolution = tileGrid.getResolution(zoom);\n    const sourceZ = sourceTileGrid.getZForResolution(resolution);\n    const useLoadedOnly = zoom != tileCoord[0];\n    let loadCount = 0;\n    sourceTileGrid.forEachTileCoord(extent, sourceZ, function(sourceTileCoord) {\n      let sharedExtent = getIntersection(extent,\n        sourceTileGrid.getTileCoordExtent(sourceTileCoord));\n      const sourceExtent = sourceTileGrid.getExtent();\n      if (sourceExtent) {\n        sharedExtent = getIntersection(sharedExtent, sourceExtent, sharedExtent);\n      }\n      if (getWidth(sharedExtent) / resolution >= 0.5 &&\n          getHeight(sharedExtent) / resolution >= 0.5) {\n        // only include source tile if overlap is at least 1 pixel\n        ++loadCount;\n        const sourceTileKey = sourceTileCoord.toString();\n        let sourceTile = sourceTiles[sourceTileKey];\n        if (!sourceTile && !useLoadedOnly) {\n          const tileUrl = tileUrlFunction(sourceTileCoord, pixelRatio, projection);\n          sourceTile = sourceTiles[sourceTileKey] = new tileClass(sourceTileCoord,\n            tileUrl == undefined ? TileState.EMPTY : TileState.IDLE,\n            tileUrl == undefined ? '' : tileUrl,\n            format, tileLoadFunction);\n          this.sourceTileListenerKeys_.push(\n            listen(sourceTile, EventType.CHANGE, handleTileChange));\n        }\n        if (sourceTile && (!useLoadedOnly || sourceTile.getState() == TileState.LOADED)) {\n          sourceTile.consumers++;\n          this.tileKeys.push(sourceTileKey);\n        }\n      }\n    }.bind(this));\n\n    if (useLoadedOnly && loadCount == this.tileKeys.length) {\n      this.finishLoading_();\n    }\n\n    if (zoom <= tileCoord[0] && this.state != TileState.LOADED) {\n      while (zoom > tileGrid.getMinZoom()) {\n        const tile = new VectorImageTile(tileCoord, state, sourceRevision,\n          format, tileLoadFunction, urlTileCoord, tileUrlFunction,\n          sourceTileGrid, tileGrid, sourceTiles, pixelRatio, projection,\n          tileClass, UNDEFINED, --zoom);\n        if (tile.state == TileState.LOADED) {\n          this.interimTile = tile;\n          break;\n        }\n      }\n    }\n  }\n\n};\n\ninherits(VectorImageTile, Tile);\n\n\n/**\n * @inheritDoc\n */\nVectorImageTile.prototype.disposeInternal = function() {\n  this.state = TileState.ABORT;\n  this.changed();\n  if (this.interimTile) {\n    this.interimTile.dispose();\n  }\n\n  for (let i = 0, ii = this.tileKeys.length; i < ii; ++i) {\n    const sourceTileKey = this.tileKeys[i];\n    const sourceTile = this.getTile(sourceTileKey);\n    sourceTile.consumers--;\n    if (sourceTile.consumers == 0) {\n      delete this.sourceTiles_[sourceTileKey];\n      sourceTile.dispose();\n    }\n  }\n  this.tileKeys.length = 0;\n  this.sourceTiles_ = null;\n  this.loadListenerKeys_.forEach(unlistenByKey);\n  this.loadListenerKeys_.length = 0;\n  this.sourceTileListenerKeys_.forEach(unlistenByKey);\n  this.sourceTileListenerKeys_.length = 0;\n  Tile.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @param {module:ol/layer/Layer} layer Layer.\n * @return {CanvasRenderingContext2D} The rendering context.\n */\nVectorImageTile.prototype.getContext = function(layer) {\n  const key = getUid(layer).toString();\n  if (!(key in this.context_)) {\n    this.context_[key] = createCanvasContext2D();\n  }\n  return this.context_[key];\n};\n\n\n/**\n * Get the Canvas for this tile.\n * @param {module:ol/layer/Layer} layer Layer.\n * @return {HTMLCanvasElement} Canvas.\n */\nVectorImageTile.prototype.getImage = function(layer) {\n  return this.getReplayState(layer).renderedTileRevision == -1 ?\n    null : this.getContext(layer).canvas;\n};\n\n\n/**\n * @param {module:ol/layer/Layer} layer Layer.\n * @return {module:ol/VectorImageTile~ReplayState} The replay state.\n */\nVectorImageTile.prototype.getReplayState = function(layer) {\n  const key = getUid(layer).toString();\n  if (!(key in this.replayState_)) {\n    this.replayState_[key] = {\n      dirty: false,\n      renderedRenderOrder: null,\n      renderedRevision: -1,\n      renderedTileRevision: -1\n    };\n  }\n  return this.replayState_[key];\n};\n\n\n/**\n * @inheritDoc\n */\nVectorImageTile.prototype.getKey = function() {\n  return this.tileKeys.join('/') + '-' + this.sourceRevision_;\n};\n\n\n/**\n * @param {string} tileKey Key (tileCoord) of the source tile.\n * @return {module:ol/VectorTile} Source tile.\n */\nVectorImageTile.prototype.getTile = function(tileKey) {\n  return this.sourceTiles_[tileKey];\n};\n\n\n/**\n * @inheritDoc\n */\nVectorImageTile.prototype.load = function() {\n  // Source tiles with LOADED state - we just count them because once they are\n  // loaded, we're no longer listening to state changes.\n  let leftToLoad = 0;\n  // Source tiles with ERROR state - we track them because they can still have\n  // an ERROR state after another load attempt.\n  const errorSourceTiles = {};\n\n  if (this.state == TileState.IDLE) {\n    this.setState(TileState.LOADING);\n  }\n  if (this.state == TileState.LOADING) {\n    this.tileKeys.forEach(function(sourceTileKey) {\n      const sourceTile = this.getTile(sourceTileKey);\n      if (sourceTile.state == TileState.IDLE) {\n        sourceTile.setLoader(this.loader_);\n        sourceTile.load();\n      }\n      if (sourceTile.state == TileState.LOADING) {\n        const key = listen(sourceTile, EventType.CHANGE, function(e) {\n          const state = sourceTile.getState();\n          if (state == TileState.LOADED ||\n              state == TileState.ERROR) {\n            const uid = getUid(sourceTile);\n            if (state == TileState.ERROR) {\n              errorSourceTiles[uid] = true;\n            } else {\n              --leftToLoad;\n              delete errorSourceTiles[uid];\n            }\n            if (leftToLoad - Object.keys(errorSourceTiles).length == 0) {\n              this.finishLoading_();\n            }\n          }\n        }.bind(this));\n        this.loadListenerKeys_.push(key);\n        ++leftToLoad;\n      }\n    }.bind(this));\n  }\n  if (leftToLoad - Object.keys(errorSourceTiles).length == 0) {\n    setTimeout(this.finishLoading_.bind(this), 0);\n  }\n};\n\n\n/**\n * @private\n */\nVectorImageTile.prototype.finishLoading_ = function() {\n  let loaded = this.tileKeys.length;\n  let empty = 0;\n  for (let i = loaded - 1; i >= 0; --i) {\n    const state = this.getTile(this.tileKeys[i]).getState();\n    if (state != TileState.LOADED) {\n      --loaded;\n    }\n    if (state == TileState.EMPTY) {\n      ++empty;\n    }\n  }\n  if (loaded == this.tileKeys.length) {\n    this.loadListenerKeys_.forEach(unlistenByKey);\n    this.loadListenerKeys_.length = 0;\n    this.setState(TileState.LOADED);\n  } else {\n    this.setState(empty == this.tileKeys.length ? TileState.EMPTY : TileState.ERROR);\n  }\n};\n\nexport default VectorImageTile;\n\n/**\n * Sets the loader for a tile.\n * @param {module:ol/VectorTile} tile Vector tile.\n * @param {string} url URL.\n */\nexport function defaultLoadFunction(tile, url) {\n  const loader = loadFeaturesXhr(url, tile.getFormat(), tile.onLoad.bind(tile), tile.onError.bind(tile));\n  tile.setLoader(loader);\n}\n","/**\n * @module ol/source/VectorTile\n */\nimport {inherits} from '../util.js';\nimport TileState from '../TileState.js';\nimport VectorImageTile, {defaultLoadFunction} from '../VectorImageTile.js';\nimport Tile from '../VectorTile.js';\nimport {toSize} from '../size.js';\nimport UrlTile from '../source/UrlTile.js';\nimport {getKeyZXY} from '../tilecoord.js';\nimport {createXYZ, extentFromProjection, createForProjection} from '../tilegrid.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=128] Cache size.\n * @property {module:ol/format/Feature} [format] Feature format for tiles. Used and required by the default.\n * @property {boolean} [overlaps=true] This source may have overlapping geometries. Setting this\n * to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {module:ol/source/State} [state] Source state.\n * @property {module:ol/VectorTile~TileClass} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/VectorTile}.\n * @property {number} [maxZoom=22] Optional max zoom level.\n * @property {number} [minZoom] Optional min zoom level.\n * @property {number|module:ol/size~Size} [tileSize=512] Optional tile size.\n * @property {module:ol/tilegrid/TileGrid} [tileGrid] Tile grid.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction]\n * Optional function to load a tile given a URL. Could look like this:\n * ```js\n * function(tile, url) {\n *   tile.setLoader(function() {\n *     var data = // ... fetch data\n *     var format = tile.getFormat();\n *     tile.setProjection(format.readProjection(data));\n *     tile.setFeatures(format.readFeatures(data, {\n *       // featureProjection is not required for ol/format/MVT\n *       featureProjection: map.getView().getProjection()\n *     }));\n *     // the line below is only required for ol/format/MVT\n *     tile.setExtent(format.getLastExtent());\n *   };\n * });\n * ```\n * @property {module:ol/Tile~UrlFunction} [tileUrlFunction] Optional function to get tile URL given a tile coordinate and the projection.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {number} [transition] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {Array.<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When set to `true`, tiles will be wrapped horizontally to\n * render multiple worlds.\n */\n\n\n/**\n * @classdesc\n * Class for layer sources providing vector data divided into a tile grid, to be\n * used with {@link module:ol/layer/VectorTile~VectorTile}. Although this source receives tiles\n * with vector features from the server, it is not meant for feature editing.\n * Features are optimized for rendering, their geometries are clipped at or near\n * tile boundaries and simplified for a view resolution. See\n * {@link module:ol/source/Vector} for vector sources that are suitable for feature\n * editing.\n *\n * @constructor\n * @fires module:ol/source/Tile~TileSourceEvent\n * @extends {module:ol/source/UrlTile}\n * @param {module:ol/source/VectorTile~Options=} options Vector tile options.\n * @api\n */\nconst VectorTile = function(options) {\n  const projection = options.projection || 'EPSG:3857';\n\n  const extent = options.extent || extentFromProjection(projection);\n\n  const tileGrid = options.tileGrid || createXYZ({\n    extent: extent,\n    maxZoom: options.maxZoom || 22,\n    minZoom: options.minZoom,\n    tileSize: options.tileSize || 512\n  });\n\n  UrlTile.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize !== undefined ? options.cacheSize : 128,\n    extent: extent,\n    opaque: false,\n    projection: projection,\n    state: options.state,\n    tileGrid: tileGrid,\n    tileLoadFunction: options.tileLoadFunction ? options.tileLoadFunction : defaultLoadFunction,\n    tileUrlFunction: options.tileUrlFunction,\n    url: options.url,\n    urls: options.urls,\n    wrapX: options.wrapX === undefined ? true : options.wrapX,\n    transition: options.transition\n  });\n\n  /**\n   * @private\n   * @type {module:ol/format/Feature}\n   */\n  this.format_ = options.format ? options.format : null;\n\n  /**\n     * @private\n     * @type {Object.<string, module:ol/VectorTile>}\n     */\n  this.sourceTiles_ = {};\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.overlaps_ = options.overlaps == undefined ? true : options.overlaps;\n\n  /**\n     * @protected\n     * @type {function(new: module:ol/VectorTile, module:ol/tilecoord~TileCoord, module:ol/TileState, string,\n     *        module:ol/format/Feature, module:ol/Tile~LoadFunction)}\n     */\n  this.tileClass = options.tileClass ? options.tileClass : Tile;\n\n  /**\n   * @private\n   * @type {Object.<string, module:ol/tilegrid/TileGrid>}\n   */\n  this.tileGrids_ = {};\n\n};\n\ninherits(VectorTile, UrlTile);\n\n\n/**\n * @return {boolean} The source can have overlapping geometries.\n */\nVectorTile.prototype.getOverlaps = function() {\n  return this.overlaps_;\n};\n\n/**\n * clear {@link module:ol/TileCache~TileCache} and delete all source tiles\n * @api\n */\nVectorTile.prototype.clear = function() {\n  this.tileCache.clear();\n  this.sourceTiles_ = {};\n};\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.getTile = function(z, x, y, pixelRatio, projection) {\n  const tileCoordKey = getKeyZXY(z, x, y);\n  if (this.tileCache.containsKey(tileCoordKey)) {\n    return (\n      /** @type {!module:ol/Tile} */ (this.tileCache.get(tileCoordKey))\n    );\n  } else {\n    const tileCoord = [z, x, y];\n    const urlTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord, projection);\n    const tile = new VectorImageTile(\n      tileCoord,\n      urlTileCoord !== null ? TileState.IDLE : TileState.EMPTY,\n      this.getRevision(),\n      this.format_, this.tileLoadFunction, urlTileCoord, this.tileUrlFunction,\n      this.tileGrid, this.getTileGridForProjection(projection),\n      this.sourceTiles_, pixelRatio, projection, this.tileClass,\n      this.handleTileChange.bind(this), tileCoord[0]);\n\n    this.tileCache.set(tileCoordKey, tile);\n    return tile;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.getTileGridForProjection = function(projection) {\n  const code = projection.getCode();\n  let tileGrid = this.tileGrids_[code];\n  if (!tileGrid) {\n    // A tile grid that matches the tile size of the source tile grid is more\n    // likely to have 1:1 relationships between source tiles and rendered tiles.\n    const sourceTileGrid = this.tileGrid;\n    tileGrid = this.tileGrids_[code] = createForProjection(projection, undefined,\n      sourceTileGrid ? sourceTileGrid.getTileSize(sourceTileGrid.getMinZoom()) : undefined);\n  }\n  return tileGrid;\n};\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.getTilePixelRatio = function(pixelRatio) {\n  return pixelRatio;\n};\n\n\n/**\n * @inheritDoc\n */\nVectorTile.prototype.getTilePixelSize = function(z, pixelRatio, projection) {\n  const tileGrid = this.getTileGridForProjection(projection);\n  const tileSize = toSize(tileGrid.getTileSize(z), this.tmpSize);\n  return [Math.round(tileSize[0] * pixelRatio), Math.round(tileSize[1] * pixelRatio)];\n};\nexport default VectorTile;\n","/**\n * @module ol/source/WMTSRequestEncoding\n */\n\n/**\n * Request encoding. One of 'KVP', 'REST'.\n * @enum {string}\n */\nexport default {\n  KVP: 'KVP',  // see spec 8\n  REST: 'REST' // see spec 10\n};\n","/**\n * @module ol/tilegrid/WMTS\n */\nimport {inherits} from '../util.js';\nimport {find} from '../array.js';\nimport {get as getProjection} from '../proj.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/extent~Extent} [extent] Extent for the tile grid. No tiles\n * outside this extent will be requested by {@link module:ol/source/Tile} sources.\n * When no `origin` or `origins` are configured, the `origin` will be set to the\n * top-left corner of the extent.\n * @property {module:ol/coordinate~Coordinate} [origin] The tile grid origin, i.e.\n * where the `x` and `y` axes meet (`[z, 0, 0]`). Tile coordinates increase left\n * to right and upwards. If not specified, `extent` or `origins` must be provided.\n * @property {Array.<module:ol/coordinate~Coordinate>} [origins] Tile grid origins,\n * i.e. where the `x` and `y` axes meet (`[z, 0, 0]`), for each zoom level. If\n * given, the array length should match the length of the `resolutions` array, i.e.\n * each resolution can have a different origin. Tile coordinates increase left to\n * right and upwards. If not specified, `extent` or `origin` must be provided.\n * @property {!Array.<number>} resolutions Resolutions. The array index of each\n * resolution needs to match the zoom level. This means that even if a `minZoom`\n * is configured, the resolutions array will have a length of `maxZoom + 1`\n * @property {!Array.<string>} matrixIds matrix IDs. The length of this array needs\n * to match the length of the `resolutions` array.\n * @property {Array.<module:ol/size~Size>} [sizes] Number of tile rows and columns\n * of the grid for each zoom level. The values here are the `TileMatrixWidth` and\n * `TileMatrixHeight` advertised in the GetCapabilities response of the WMTS, and\n * define the grid's extent together with the `origin`.\n * An `extent` can be configured in addition, and will further limit the extent for\n * which tile requests are made by sources. Note that when the top-left corner of\n * the `extent` is used as `origin` or `origins`, then the `y` value must be\n * negative because OpenLayers tile coordinates increase upwards.\n * @property {number|module:ol/size~Size} [tileSize] Tile size.\n * @property {Array.<module:ol/size~Size>} [tileSizes] Tile sizes. The length of\n * this array needs to match the length of the `resolutions` array.\n * @property {Array.<number>} [widths] Number of tile columns that cover the grid's\n * extent for each zoom level. Only required when used with a source that has `wrapX`\n * set to `true`, and only when the grid's origin differs from the one of the\n * projection's extent. The array length has to match the length of the `resolutions`\n * array, i.e. each resolution will have a matching entry here.\n */\n\n\n/**\n * @classdesc\n * Set the grid pattern for sources accessing WMTS tiled-image servers.\n *\n * @constructor\n * @extends {module:ol/tilegrid/TileGrid}\n * @param {module:ol/tilegrid/WMTS~Options} options WMTS options.\n * @struct\n * @api\n */\nconst WMTSTileGrid = function(options) {\n  /**\n   * @private\n   * @type {!Array.<string>}\n   */\n  this.matrixIds_ = options.matrixIds;\n  // FIXME: should the matrixIds become optional?\n\n  TileGrid.call(this, {\n    extent: options.extent,\n    origin: options.origin,\n    origins: options.origins,\n    resolutions: options.resolutions,\n    tileSize: options.tileSize,\n    tileSizes: options.tileSizes,\n    sizes: options.sizes\n  });\n};\n\ninherits(WMTSTileGrid, TileGrid);\n\n\n/**\n * @param {number} z Z.\n * @return {string} MatrixId..\n */\nWMTSTileGrid.prototype.getMatrixId = function(z) {\n  return this.matrixIds_[z];\n};\n\n\n/**\n * Get the list of matrix identifiers.\n * @return {Array.<string>} MatrixIds.\n * @api\n */\nWMTSTileGrid.prototype.getMatrixIds = function() {\n  return this.matrixIds_;\n};\n\nexport default WMTSTileGrid;\n\n/**\n * Create a tile grid from a WMTS capabilities matrix set and an\n * optional TileMatrixSetLimits.\n * @param {Object} matrixSet An object representing a matrixSet in the\n *     capabilities document.\n * @param {module:ol/extent~Extent=} opt_extent An optional extent to restrict the tile\n *     ranges the server provides.\n * @param {Array.<Object>=} opt_matrixLimits An optional object representing\n *     the available matrices for tileGrid.\n * @return {module:ol/tilegrid/WMTS} WMTS tileGrid instance.\n * @api\n */\nexport function createFromCapabilitiesMatrixSet(matrixSet, opt_extent, opt_matrixLimits) {\n\n  /** @type {!Array.<number>} */\n  const resolutions = [];\n  /** @type {!Array.<string>} */\n  const matrixIds = [];\n  /** @type {!Array.<module:ol/coordinate~Coordinate>} */\n  const origins = [];\n  /** @type {!Array.<module:ol/size~Size>} */\n  const tileSizes = [];\n  /** @type {!Array.<module:ol/size~Size>} */\n  const sizes = [];\n\n  const matrixLimits = opt_matrixLimits !== undefined ? opt_matrixLimits : [];\n\n  const supportedCRSPropName = 'SupportedCRS';\n  const matrixIdsPropName = 'TileMatrix';\n  const identifierPropName = 'Identifier';\n  const scaleDenominatorPropName = 'ScaleDenominator';\n  const topLeftCornerPropName = 'TopLeftCorner';\n  const tileWidthPropName = 'TileWidth';\n  const tileHeightPropName = 'TileHeight';\n\n  const code = matrixSet[supportedCRSPropName];\n  const projection = getProjection(code.replace(/urn:ogc:def:crs:(\\w+):(.*:)?(\\w+)$/, '$1:$3')) ||\n      getProjection(code);\n  const metersPerUnit = projection.getMetersPerUnit();\n  // swap origin x and y coordinates if axis orientation is lat/long\n  const switchOriginXY = projection.getAxisOrientation().substr(0, 2) == 'ne';\n\n  matrixSet[matrixIdsPropName].sort(function(a, b) {\n    return b[scaleDenominatorPropName] - a[scaleDenominatorPropName];\n  });\n\n  matrixSet[matrixIdsPropName].forEach(function(elt) {\n\n    let matrixAvailable;\n    // use of matrixLimits to filter TileMatrices from GetCapabilities\n    // TileMatrixSet from unavailable matrix levels.\n    if (matrixLimits.length > 0) {\n      matrixAvailable = find(matrixLimits, function(elt_ml) {\n        if (elt[identifierPropName] == elt_ml[matrixIdsPropName]) {\n          return true;\n        }\n        // Fallback for tileMatrix identifiers that don't get prefixed\n        // by their tileMatrixSet identifiers.\n        if (elt[identifierPropName].indexOf(':') === -1) {\n          return matrixSet[identifierPropName] + ':' + elt[identifierPropName] === elt_ml[matrixIdsPropName];\n        }\n        return false;\n      });\n    } else {\n      matrixAvailable = true;\n    }\n\n    if (matrixAvailable) {\n      matrixIds.push(elt[identifierPropName]);\n      const resolution = elt[scaleDenominatorPropName] * 0.28E-3 / metersPerUnit;\n      const tileWidth = elt[tileWidthPropName];\n      const tileHeight = elt[tileHeightPropName];\n      if (switchOriginXY) {\n        origins.push([elt[topLeftCornerPropName][1],\n          elt[topLeftCornerPropName][0]]);\n      } else {\n        origins.push(elt[topLeftCornerPropName]);\n      }\n      resolutions.push(resolution);\n      tileSizes.push(tileWidth == tileHeight ?\n        tileWidth : [tileWidth, tileHeight]);\n      // top-left origin, so height is negative\n      sizes.push([elt['MatrixWidth'], -elt['MatrixHeight']]);\n    }\n  });\n\n  return new WMTSTileGrid({\n    extent: opt_extent,\n    origins: origins,\n    resolutions: resolutions,\n    matrixIds: matrixIds,\n    tileSizes: tileSizes,\n    sizes: sizes\n  });\n}\n","/**\n * @module ol/source/WMTS\n */\nimport {inherits} from '../util.js';\nimport {expandUrl, createFromTileUrlFunctions, nullTileUrlFunction} from '../tileurlfunction.js';\nimport {find, findIndex, includes} from '../array.js';\nimport {containsExtent} from '../extent.js';\nimport {assign} from '../obj.js';\nimport {get as getProjection, equivalent, transformExtent} from '../proj.js';\nimport TileImage from '../source/TileImage.js';\nimport WMTSRequestEncoding from '../source/WMTSRequestEncoding.js';\nimport {createFromCapabilitiesMatrixSet} from '../tilegrid/WMTS.js';\nimport {appendParams} from '../uri.js';\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {module:ol/tilegrid/WMTS} tileGrid Tile grid.\n * @property {module:ol/proj~ProjectionLike} projection Projection.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {module:ol/source/WMTSRequestEncoding|string} [requestEncoding='KVP'] Request encoding.\n * @property {string} layer Layer name as advertised in the WMTS capabilities.\n * @property {string} style Style name as advertised in the WMTS capabilities.\n * @property {module:ol/ImageTile~TileClass} [tileClass]  Class used to instantiate image tiles. Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service.\n * For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {string} [version='image/jpeg'] Image format.\n * @property {string} [format='1.0.0'] WMTS version.\n * @property {string} matrixSet Matrix set.\n * @property {!Object} [dimensions] Additional \"dimensions\" for tile requests.\n * This is an object with properties named like the advertised WMTS dimensions.\n * @property {string} [url]  A URL for the service.\n * For the RESTful request encoding, this is a URL\n * template.  For KVP encoding, it is normal URL. A `{?-?}` template pattern,\n * for example `subdomain{a-f}.domain.com`, may be used instead of defining\n * each one separately in the `urls` option.\n * @property {module:ol/Tile~LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {Array.<string>} [urls] An array of URLs.\n * Requests will be distributed among the URLs in this array.\n * @property {boolean} [wrapX=false] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data from WMTS servers.\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/WMTS~Options=} options WMTS options.\n * @api\n */\nconst WMTS = function(options) {\n\n  // TODO: add support for TileMatrixLimits\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.version_ = options.version !== undefined ? options.version : '1.0.0';\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.format_ = options.format !== undefined ? options.format : 'image/jpeg';\n\n  /**\n   * @private\n   * @type {!Object}\n   */\n  this.dimensions_ = options.dimensions !== undefined ? options.dimensions : {};\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.layer_ = options.layer;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.matrixSet_ = options.matrixSet;\n\n  /**\n   * @private\n   * @type {string}\n   */\n  this.style_ = options.style;\n\n  let urls = options.urls;\n  if (urls === undefined && options.url !== undefined) {\n    urls = expandUrl(options.url);\n  }\n\n  // FIXME: should we guess this requestEncoding from options.url(s)\n  //        structure? that would mean KVP only if a template is not provided.\n\n  /**\n   * @private\n   * @type {module:ol/source/WMTSRequestEncoding}\n   */\n  this.requestEncoding_ = options.requestEncoding !== undefined ?\n    /** @type {module:ol/source/WMTSRequestEncoding} */ (options.requestEncoding) :\n    WMTSRequestEncoding.KVP;\n\n  const requestEncoding = this.requestEncoding_;\n\n  // FIXME: should we create a default tileGrid?\n  // we could issue a getCapabilities xhr to retrieve missing configuration\n  const tileGrid = options.tileGrid;\n\n  // context property names are lower case to allow for a case insensitive\n  // replacement as some services use different naming conventions\n  const context = {\n    'layer': this.layer_,\n    'style': this.style_,\n    'tilematrixset': this.matrixSet_\n  };\n\n  if (requestEncoding == WMTSRequestEncoding.KVP) {\n    assign(context, {\n      'Service': 'WMTS',\n      'Request': 'GetTile',\n      'Version': this.version_,\n      'Format': this.format_\n    });\n  }\n\n  const dimensions = this.dimensions_;\n\n  /**\n   * @param {string} template Template.\n   * @return {module:ol/Tile~UrlFunction} Tile URL function.\n   * @private\n   */\n  this.createFromWMTSTemplate_ = function(template) {\n\n    // TODO: we may want to create our own appendParams function so that params\n    // order conforms to wmts spec guidance, and so that we can avoid to escape\n    // special template params\n\n    template = (requestEncoding == WMTSRequestEncoding.KVP) ?\n      appendParams(template, context) :\n      template.replace(/\\{(\\w+?)\\}/g, function(m, p) {\n        return (p.toLowerCase() in context) ? context[p.toLowerCase()] : m;\n      });\n\n    return (\n      /**\n       * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n       * @param {number} pixelRatio Pixel ratio.\n       * @param {module:ol/proj/Projection} projection Projection.\n       * @return {string|undefined} Tile URL.\n       */\n      function(tileCoord, pixelRatio, projection) {\n        if (!tileCoord) {\n          return undefined;\n        } else {\n          const localContext = {\n            'TileMatrix': tileGrid.getMatrixId(tileCoord[0]),\n            'TileCol': tileCoord[1],\n            'TileRow': -tileCoord[2] - 1\n          };\n          assign(localContext, dimensions);\n          let url = template;\n          if (requestEncoding == WMTSRequestEncoding.KVP) {\n            url = appendParams(url, localContext);\n          } else {\n            url = url.replace(/\\{(\\w+?)\\}/g, function(m, p) {\n              return localContext[p];\n            });\n          }\n          return url;\n        }\n      }\n    );\n  };\n\n  const tileUrlFunction = (urls && urls.length > 0) ?\n    createFromTileUrlFunctions(urls.map(this.createFromWMTSTemplate_)) : nullTileUrlFunction;\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    projection: options.projection,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileClass: options.tileClass,\n    tileGrid: tileGrid,\n    tileLoadFunction: options.tileLoadFunction,\n    tilePixelRatio: options.tilePixelRatio,\n    tileUrlFunction: tileUrlFunction,\n    urls: urls,\n    wrapX: options.wrapX !== undefined ? options.wrapX : false,\n    transition: options.transition\n  });\n\n  this.setKey(this.getKeyForDimensions_());\n\n};\n\ninherits(WMTS, TileImage);\n\n/**\n * Set the URLs to use for requests.\n * URLs may contain OCG conform URL Template Variables: {TileMatrix}, {TileRow}, {TileCol}.\n * @override\n */\nWMTS.prototype.setUrls = function(urls) {\n  this.urls = urls;\n  const key = urls.join('\\n');\n  this.setTileUrlFunction(this.fixedTileUrlFunction ?\n    this.fixedTileUrlFunction.bind(this) :\n    createFromTileUrlFunctions(urls.map(this.createFromWMTSTemplate_.bind(this))), key);\n};\n\n/**\n * Get the dimensions, i.e. those passed to the constructor through the\n * \"dimensions\" option, and possibly updated using the updateDimensions\n * method.\n * @return {!Object} Dimensions.\n * @api\n */\nWMTS.prototype.getDimensions = function() {\n  return this.dimensions_;\n};\n\n\n/**\n * Return the image format of the WMTS source.\n * @return {string} Format.\n * @api\n */\nWMTS.prototype.getFormat = function() {\n  return this.format_;\n};\n\n\n/**\n * Return the layer of the WMTS source.\n * @return {string} Layer.\n * @api\n */\nWMTS.prototype.getLayer = function() {\n  return this.layer_;\n};\n\n\n/**\n * Return the matrix set of the WMTS source.\n * @return {string} MatrixSet.\n * @api\n */\nWMTS.prototype.getMatrixSet = function() {\n  return this.matrixSet_;\n};\n\n\n/**\n * Return the request encoding, either \"KVP\" or \"REST\".\n * @return {module:ol/source/WMTSRequestEncoding} Request encoding.\n * @api\n */\nWMTS.prototype.getRequestEncoding = function() {\n  return this.requestEncoding_;\n};\n\n\n/**\n * Return the style of the WMTS source.\n * @return {string} Style.\n * @api\n */\nWMTS.prototype.getStyle = function() {\n  return this.style_;\n};\n\n\n/**\n * Return the version of the WMTS source.\n * @return {string} Version.\n * @api\n */\nWMTS.prototype.getVersion = function() {\n  return this.version_;\n};\n\n\n/**\n * @private\n * @return {string} The key for the current dimensions.\n */\nWMTS.prototype.getKeyForDimensions_ = function() {\n  let i = 0;\n  const res = [];\n  for (const key in this.dimensions_) {\n    res[i++] = key + '-' + this.dimensions_[key];\n  }\n  return res.join('/');\n};\n\n\n/**\n * Update the dimensions.\n * @param {Object} dimensions Dimensions.\n * @api\n */\nWMTS.prototype.updateDimensions = function(dimensions) {\n  assign(this.dimensions_, dimensions);\n  this.setKey(this.getKeyForDimensions_());\n};\n\n\n/**\n * Generate source options from a capabilities object.\n * @param {Object} wmtsCap An object representing the capabilities document.\n * @param {!Object} config Configuration properties for the layer.  Defaults for\n *                  the layer will apply if not provided.\n *\n * Required config properties:\n *  - layer - {string} The layer identifier.\n *\n * Optional config properties:\n *  - matrixSet - {string} The matrix set identifier, required if there is\n *       more than one matrix set in the layer capabilities.\n *  - projection - {string} The desired CRS when no matrixSet is specified.\n *       eg: \"EPSG:3857\". If the desired projection is not available,\n *       an error is thrown.\n *  - requestEncoding - {string} url encoding format for the layer. Default is\n *       the first tile url format found in the GetCapabilities response.\n *  - style - {string} The name of the style\n *  - format - {string} Image format for the layer. Default is the first\n *       format returned in the GetCapabilities response.\n *  - crossOrigin - {string|null|undefined} Cross origin. Default is `undefined`.\n * @return {?module:ol/source/WMTS~Options} WMTS source options object or `null` if the layer was not found.\n * @api\n */\nexport function optionsFromCapabilities(wmtsCap, config) {\n  const layers = wmtsCap['Contents']['Layer'];\n  const l = find(layers, function(elt, index, array) {\n    return elt['Identifier'] == config['layer'];\n  });\n  if (l === null) {\n    return null;\n  }\n  const tileMatrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  let idx;\n  if (l['TileMatrixSetLink'].length > 1) {\n    if ('projection' in config) {\n      idx = findIndex(l['TileMatrixSetLink'],\n        function(elt, index, array) {\n          const tileMatrixSet = find(tileMatrixSets, function(el) {\n            return el['Identifier'] == elt['TileMatrixSet'];\n          });\n          const supportedCRS = tileMatrixSet['SupportedCRS'];\n          const proj1 = getProjection(supportedCRS.replace(/urn:ogc:def:crs:(\\w+):(.*:)?(\\w+)$/, '$1:$3')) ||\n                getProjection(supportedCRS);\n          const proj2 = getProjection(config['projection']);\n          if (proj1 && proj2) {\n            return equivalent(proj1, proj2);\n          } else {\n            return supportedCRS == config['projection'];\n          }\n        });\n    } else {\n      idx = findIndex(l['TileMatrixSetLink'],\n        function(elt, index, array) {\n          return elt['TileMatrixSet'] == config['matrixSet'];\n        });\n    }\n  } else {\n    idx = 0;\n  }\n  if (idx < 0) {\n    idx = 0;\n  }\n  const matrixSet = /** @type {string} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSet']);\n  const matrixLimits = /** @type {Array.<Object>} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSetLimits']);\n\n  let format = /** @type {string} */ (l['Format'][0]);\n  if ('format' in config) {\n    format = config['format'];\n  }\n  idx = findIndex(l['Style'], function(elt, index, array) {\n    if ('style' in config) {\n      return elt['Title'] == config['style'];\n    } else {\n      return elt['isDefault'];\n    }\n  });\n  if (idx < 0) {\n    idx = 0;\n  }\n  const style = /** @type {string} */ (l['Style'][idx]['Identifier']);\n\n  const dimensions = {};\n  if ('Dimension' in l) {\n    l['Dimension'].forEach(function(elt, index, array) {\n      const key = elt['Identifier'];\n      let value = elt['Default'];\n      if (value === undefined) {\n        value = elt['Value'][0];\n      }\n      dimensions[key] = value;\n    });\n  }\n\n  const matrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  const matrixSetObj = find(matrixSets, function(elt, index, array) {\n    return elt['Identifier'] == matrixSet;\n  });\n\n  let projection;\n  const code = matrixSetObj['SupportedCRS'];\n  if (code) {\n    projection = getProjection(code.replace(/urn:ogc:def:crs:(\\w+):(.*:)?(\\w+)$/, '$1:$3')) ||\n        getProjection(code);\n  }\n  if ('projection' in config) {\n    const projConfig = getProjection(config['projection']);\n    if (projConfig) {\n      if (!projection || equivalent(projConfig, projection)) {\n        projection = projConfig;\n      }\n    }\n  }\n\n  const wgs84BoundingBox = l['WGS84BoundingBox'];\n  let extent, wrapX;\n  if (wgs84BoundingBox !== undefined) {\n    const wgs84ProjectionExtent = getProjection('EPSG:4326').getExtent();\n    wrapX = (wgs84BoundingBox[0] == wgs84ProjectionExtent[0] &&\n        wgs84BoundingBox[2] == wgs84ProjectionExtent[2]);\n    extent = transformExtent(\n      wgs84BoundingBox, 'EPSG:4326', projection);\n    const projectionExtent = projection.getExtent();\n    if (projectionExtent) {\n      // If possible, do a sanity check on the extent - it should never be\n      // bigger than the validity extent of the projection of a matrix set.\n      if (!containsExtent(projectionExtent, extent)) {\n        extent = undefined;\n      }\n    }\n  }\n\n  const tileGrid = createFromCapabilitiesMatrixSet(matrixSetObj, extent, matrixLimits);\n\n  /** @type {!Array.<string>} */\n  const urls = [];\n  let requestEncoding = config['requestEncoding'];\n  requestEncoding = requestEncoding !== undefined ? requestEncoding : '';\n\n  if ('OperationsMetadata' in wmtsCap && 'GetTile' in wmtsCap['OperationsMetadata']) {\n    const gets = wmtsCap['OperationsMetadata']['GetTile']['DCP']['HTTP']['Get'];\n\n    for (let i = 0, ii = gets.length; i < ii; ++i) {\n      if (gets[i]['Constraint']) {\n        const constraint = find(gets[i]['Constraint'], function(element) {\n          return element['name'] == 'GetEncoding';\n        });\n        const encodings = constraint['AllowedValues']['Value'];\n\n        if (requestEncoding === '') {\n          // requestEncoding not provided, use the first encoding from the list\n          requestEncoding = encodings[0];\n        }\n        if (requestEncoding === WMTSRequestEncoding.KVP) {\n          if (includes(encodings, WMTSRequestEncoding.KVP)) {\n            urls.push(/** @type {string} */ (gets[i]['href']));\n          }\n        } else {\n          break;\n        }\n      } else if (gets[i]['href']) {\n        requestEncoding = WMTSRequestEncoding.KVP;\n        urls.push(/** @type {string} */ (gets[i]['href']));\n      }\n    }\n  }\n  if (urls.length === 0) {\n    requestEncoding = WMTSRequestEncoding.REST;\n    l['ResourceURL'].forEach(function(element) {\n      if (element['resourceType'] === 'tile') {\n        format = element['format'];\n        urls.push(/** @type {string} */ (element['template']));\n      }\n    });\n  }\n\n  return {\n    urls: urls,\n    layer: config['layer'],\n    matrixSet: matrixSet,\n    format: format,\n    projection: projection,\n    requestEncoding: requestEncoding,\n    tileGrid: tileGrid,\n    style: style,\n    dimensions: dimensions,\n    wrapX: wrapX,\n    crossOrigin: config['crossOrigin']\n  };\n}\n\nexport default WMTS;\n","/**\n * @module ol/source/Zoomify\n */\nimport {DEFAULT_TILE_SIZE} from '../tilegrid/common.js';\nimport {inherits} from '../util.js';\nimport ImageTile from '../ImageTile.js';\nimport TileState from '../TileState.js';\nimport {expandUrl, createFromTileUrlFunctions} from '../tileurlfunction.js';\nimport {assert} from '../asserts.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {getTopLeft} from '../extent.js';\nimport {toSize} from '../size.js';\nimport TileImage from '../source/TileImage.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\n\n\n/**\n * @enum {string}\n */\nconst TierSizeCalculation = {\n  DEFAULT: 'default',\n  TRUNCATED: 'truncated'\n};\n\n\n/**\n * @constructor\n * @extends {module:ol/ImageTile}\n * @param {module:ol/tilegrid/TileGrid} tileGrid TileGrid that the tile belongs to.\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\n * @param {module:ol/TileState} state State.\n * @param {string} src Image source URI.\n * @param {?string} crossOrigin Cross origin.\n * @param {module:ol/Tile~LoadFunction} tileLoadFunction Tile load function.\n * @param {module:ol/Tile~Options=} opt_options Tile options.\n */\nexport const CustomTile = function(\n  tileGrid, tileCoord, state, src, crossOrigin, tileLoadFunction, opt_options) {\n\n  ImageTile.call(this, tileCoord, state, src, crossOrigin, tileLoadFunction, opt_options);\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement}\n   */\n  this.zoomifyImage_ = null;\n\n  /**\n   * @private\n   * @type {module:ol/size~Size}\n   */\n  this.tileSize_ = toSize(tileGrid.getTileSize(tileCoord[0]));\n};\ninherits(CustomTile, ImageTile);\n\n\n/**\n * @inheritDoc\n */\nCustomTile.prototype.getImage = function() {\n  if (this.zoomifyImage_) {\n    return this.zoomifyImage_;\n  }\n  const image = ImageTile.prototype.getImage.call(this);\n  if (this.state == TileState.LOADED) {\n    const tileSize = this.tileSize_;\n    if (image.width == tileSize[0] && image.height == tileSize[1]) {\n      this.zoomifyImage_ = image;\n      return image;\n    } else {\n      const context = createCanvasContext2D(tileSize[0], tileSize[1]);\n      context.drawImage(image, 0, 0);\n      this.zoomifyImage_ = context.canvas;\n      return context.canvas;\n    }\n  } else {\n    return image;\n  }\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize=2048] Cache size.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\n * access pixel data with the Canvas renderer.  See\n * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image} for more detail.\n * @property {module:ol/proj~ProjectionLike} [projection] Projection.\n * @property {boolean} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {string} [url] URL template or base URL of the Zoomify service.\n * A base URL is the fixed part\n * of the URL, excluding the tile group, z, x, and y folder structure, e.g.\n * `http://my.zoomify.info/IMAGE.TIF/`. A URL template must include\n * `{TileGroup}`, `{x}`, `{y}`, and `{z}` placeholders, e.g.\n * `http://my.zoomify.info/IMAGE.TIF/{TileGroup}/{z}-{x}-{y}.jpg`.\n * Internet Imaging Protocol (IIP) with JTL extension can be also used with\n * `{tileIndex}` and `{z}` placeholders, e.g.\n * `http://my.zoomify.info?FIF=IMAGE.TIF&JTL={z},{tileIndex}`.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {string} [tierSizeCalculation] Tier size calculation method: `default` or `truncated`.\n * @property {module:ol/size~Size} [size] Size of the image.\n * @property {module:ol/extent~Extent} [extent] Extent for the TileGrid that is created.\n * Default sets the TileGrid in the\n * fourth quadrant, meaning extent is `[0, -height, width, 0]`. To change the\n * extent to the first quadrant (the default for OpenLayers 2) set the extent\n * as `[0, 0, width, height]`.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number} [tileSize=256] Tile size. Same tile size is used for all zoom levels.\n */\n\n\n/**\n * @classdesc\n * Layer source for tile data in Zoomify format (both Zoomify and Internet\n * Imaging Protocol are supported).\n *\n * @constructor\n * @extends {module:ol/source/TileImage}\n * @param {module:ol/source/Zoomify~Options=} opt_options Options.\n * @api\n */\nconst Zoomify = function(opt_options) {\n\n  const options = opt_options || {};\n\n  const size = options.size;\n  const tierSizeCalculation = options.tierSizeCalculation !== undefined ?\n    options.tierSizeCalculation :\n    TierSizeCalculation.DEFAULT;\n\n  const imageWidth = size[0];\n  const imageHeight = size[1];\n  const extent = options.extent || [0, -size[1], size[0], 0];\n  const tierSizeInTiles = [];\n  const tileSize = options.tileSize || DEFAULT_TILE_SIZE;\n  let tileSizeForTierSizeCalculation = tileSize;\n\n  switch (tierSizeCalculation) {\n    case TierSizeCalculation.DEFAULT:\n      while (imageWidth > tileSizeForTierSizeCalculation || imageHeight > tileSizeForTierSizeCalculation) {\n        tierSizeInTiles.push([\n          Math.ceil(imageWidth / tileSizeForTierSizeCalculation),\n          Math.ceil(imageHeight / tileSizeForTierSizeCalculation)\n        ]);\n        tileSizeForTierSizeCalculation += tileSizeForTierSizeCalculation;\n      }\n      break;\n    case TierSizeCalculation.TRUNCATED:\n      let width = imageWidth;\n      let height = imageHeight;\n      while (width > tileSizeForTierSizeCalculation || height > tileSizeForTierSizeCalculation) {\n        tierSizeInTiles.push([\n          Math.ceil(width / tileSizeForTierSizeCalculation),\n          Math.ceil(height / tileSizeForTierSizeCalculation)\n        ]);\n        width >>= 1;\n        height >>= 1;\n      }\n      break;\n    default:\n      assert(false, 53); // Unknown `tierSizeCalculation` configured\n      break;\n  }\n\n  tierSizeInTiles.push([1, 1]);\n  tierSizeInTiles.reverse();\n\n  const resolutions = [1];\n  const tileCountUpToTier = [0];\n  for (let i = 1, ii = tierSizeInTiles.length; i < ii; i++) {\n    resolutions.push(1 << i);\n    tileCountUpToTier.push(\n      tierSizeInTiles[i - 1][0] * tierSizeInTiles[i - 1][1] +\n        tileCountUpToTier[i - 1]\n    );\n  }\n  resolutions.reverse();\n\n  const tileGrid = new TileGrid({\n    tileSize: tileSize,\n    extent: extent,\n    origin: getTopLeft(extent),\n    resolutions: resolutions\n  });\n\n  let url = options.url;\n  if (url && url.indexOf('{TileGroup}') == -1 && url.indexOf('{tileIndex}') == -1) {\n    url += '{TileGroup}/{z}-{x}-{y}.jpg';\n  }\n  const urls = expandUrl(url);\n\n  /**\n   * @param {string} template Template.\n   * @return {module:ol/Tile~UrlFunction} Tile URL function.\n   */\n  function createFromTemplate(template) {\n\n    return (\n      /**\n       * @param {module:ol/tilecoord~TileCoord} tileCoord Tile Coordinate.\n       * @param {number} pixelRatio Pixel ratio.\n       * @param {module:ol/proj/Projection} projection Projection.\n       * @return {string|undefined} Tile URL.\n       */\n      function(tileCoord, pixelRatio, projection) {\n        if (!tileCoord) {\n          return undefined;\n        } else {\n          const tileCoordZ = tileCoord[0];\n          const tileCoordX = tileCoord[1];\n          const tileCoordY = -tileCoord[2] - 1;\n          const tileIndex =\n              tileCoordX +\n              tileCoordY * tierSizeInTiles[tileCoordZ][0];\n          const tileSize = tileGrid.getTileSize(tileCoordZ);\n          const tileGroup = ((tileIndex + tileCountUpToTier[tileCoordZ]) / tileSize) | 0;\n          const localContext = {\n            'z': tileCoordZ,\n            'x': tileCoordX,\n            'y': tileCoordY,\n            'tileIndex': tileIndex,\n            'TileGroup': 'TileGroup' + tileGroup\n          };\n          return template.replace(/\\{(\\w+?)\\}/g, function(m, p) {\n            return localContext[p];\n          });\n        }\n      }\n    );\n  }\n\n  const tileUrlFunction = createFromTileUrlFunctions(urls.map(createFromTemplate));\n\n  const ZoomifyTileClass = CustomTile.bind(null, tileGrid);\n\n  TileImage.call(this, {\n    attributions: options.attributions,\n    cacheSize: options.cacheSize,\n    crossOrigin: options.crossOrigin,\n    projection: options.projection,\n    reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n    tileClass: ZoomifyTileClass,\n    tileGrid: tileGrid,\n    tileUrlFunction: tileUrlFunction,\n    transition: options.transition\n  });\n\n};\n\ninherits(Zoomify, TileImage);\n\n\nexport default Zoomify;\n","import $ol$Collection from './ol/Collection.js';\nimport $ol$Feature from './ol/Feature.js';\nimport $ol$Geolocation from './ol/Geolocation.js';\nimport $ol$Graticule from './ol/Graticule.js';\nimport $ol$Image from './ol/Image.js';\nimport $ol$ImageTile from './ol/ImageTile.js';\nimport $ol$Kinetic from './ol/Kinetic.js';\nimport $ol$Map from './ol/Map.js';\nimport $ol$MapBrowserEvent from './ol/MapBrowserEvent.js';\nimport $ol$Object from './ol/Object.js';\nimport $ol$Observable from './ol/Observable.js';\nimport $ol$Overlay from './ol/Overlay.js';\nimport $ol$PluggableMap from './ol/PluggableMap.js';\nimport $ol$Tile from './ol/Tile.js';\nimport $ol$VectorTile from './ol/VectorTile.js';\nimport $ol$View from './ol/View.js';\nimport $ol$WebGLMap from './ol/WebGLMap.js';\nimport $ol$control$Attribution from './ol/control/Attribution.js';\nimport $ol$control$Control from './ol/control/Control.js';\nimport $ol$control$FullScreen from './ol/control/FullScreen.js';\nimport $ol$control$MousePosition from './ol/control/MousePosition.js';\nimport $ol$control$OverviewMap from './ol/control/OverviewMap.js';\nimport $ol$control$Rotate from './ol/control/Rotate.js';\nimport $ol$control$ScaleLine from './ol/control/ScaleLine.js';\nimport $ol$control$Zoom from './ol/control/Zoom.js';\nimport $ol$control$ZoomSlider from './ol/control/ZoomSlider.js';\nimport $ol$control$ZoomToExtent from './ol/control/ZoomToExtent.js';\nimport $ol$events$Event from './ol/events/Event.js';\nimport $ol$format$EsriJSON from './ol/format/EsriJSON.js';\nimport $ol$format$Feature from './ol/format/Feature.js';\nimport $ol$format$GML from './ol/format/GML.js';\nimport $ol$format$GML2 from './ol/format/GML2.js';\nimport $ol$format$GML3 from './ol/format/GML3.js';\nimport $ol$format$GMLBase from './ol/format/GMLBase.js';\nimport $ol$format$GPX from './ol/format/GPX.js';\nimport $ol$format$GeoJSON from './ol/format/GeoJSON.js';\nimport $ol$format$IGC from './ol/format/IGC.js';\nimport $ol$format$KML from './ol/format/KML.js';\nimport $ol$format$MVT from './ol/format/MVT.js';\nimport $ol$format$OSMXML from './ol/format/OSMXML.js';\nimport $ol$format$Polyline from './ol/format/Polyline.js';\nimport $ol$format$TopoJSON from './ol/format/TopoJSON.js';\nimport $ol$format$WFS from './ol/format/WFS.js';\nimport $ol$format$WKT from './ol/format/WKT.js';\nimport $ol$format$WMSCapabilities from './ol/format/WMSCapabilities.js';\nimport $ol$format$WMSGetFeatureInfo from './ol/format/WMSGetFeatureInfo.js';\nimport $ol$format$WMTSCapabilities from './ol/format/WMTSCapabilities.js';\nimport $ol$format$filter$Bbox from './ol/format/filter/Bbox.js';\nimport $ol$format$filter$Contains from './ol/format/filter/Contains.js';\nimport $ol$format$filter$During from './ol/format/filter/During.js';\nimport $ol$format$filter$EqualTo from './ol/format/filter/EqualTo.js';\nimport $ol$format$filter$GreaterThan from './ol/format/filter/GreaterThan.js';\nimport $ol$format$filter$GreaterThanOrEqualTo from './ol/format/filter/GreaterThanOrEqualTo.js';\nimport $ol$format$filter$Intersects from './ol/format/filter/Intersects.js';\nimport $ol$format$filter$IsBetween from './ol/format/filter/IsBetween.js';\nimport $ol$format$filter$IsLike from './ol/format/filter/IsLike.js';\nimport $ol$format$filter$IsNull from './ol/format/filter/IsNull.js';\nimport $ol$format$filter$LessThan from './ol/format/filter/LessThan.js';\nimport $ol$format$filter$LessThanOrEqualTo from './ol/format/filter/LessThanOrEqualTo.js';\nimport $ol$format$filter$Not from './ol/format/filter/Not.js';\nimport $ol$format$filter$NotEqualTo from './ol/format/filter/NotEqualTo.js';\nimport $ol$format$filter$Or from './ol/format/filter/Or.js';\nimport $ol$format$filter$Within from './ol/format/filter/Within.js';\nimport $ol$geom$Circle from './ol/geom/Circle.js';\nimport $ol$geom$Geometry from './ol/geom/Geometry.js';\nimport $ol$geom$GeometryCollection from './ol/geom/GeometryCollection.js';\nimport $ol$geom$LineString from './ol/geom/LineString.js';\nimport $ol$geom$LinearRing from './ol/geom/LinearRing.js';\nimport $ol$geom$MultiLineString from './ol/geom/MultiLineString.js';\nimport $ol$geom$MultiPoint from './ol/geom/MultiPoint.js';\nimport $ol$geom$MultiPolygon from './ol/geom/MultiPolygon.js';\nimport $ol$geom$Point from './ol/geom/Point.js';\nimport $ol$geom$Polygon from './ol/geom/Polygon.js';\nimport $ol$geom$SimpleGeometry from './ol/geom/SimpleGeometry.js';\nimport $ol$interaction$DoubleClickZoom from './ol/interaction/DoubleClickZoom.js';\nimport $ol$interaction$DragAndDrop from './ol/interaction/DragAndDrop.js';\nimport $ol$interaction$DragBox from './ol/interaction/DragBox.js';\nimport $ol$interaction$DragPan from './ol/interaction/DragPan.js';\nimport $ol$interaction$DragRotate from './ol/interaction/DragRotate.js';\nimport $ol$interaction$DragRotateAndZoom from './ol/interaction/DragRotateAndZoom.js';\nimport $ol$interaction$DragZoom from './ol/interaction/DragZoom.js';\nimport $ol$interaction$Draw from './ol/interaction/Draw.js';\nimport $ol$interaction$Extent from './ol/interaction/Extent.js';\nimport $ol$interaction$Interaction from './ol/interaction/Interaction.js';\nimport $ol$interaction$KeyboardPan from './ol/interaction/KeyboardPan.js';\nimport $ol$interaction$KeyboardZoom from './ol/interaction/KeyboardZoom.js';\nimport $ol$interaction$Modify from './ol/interaction/Modify.js';\nimport $ol$interaction$MouseWheelZoom from './ol/interaction/MouseWheelZoom.js';\nimport $ol$interaction$PinchRotate from './ol/interaction/PinchRotate.js';\nimport $ol$interaction$PinchZoom from './ol/interaction/PinchZoom.js';\nimport $ol$interaction$Pointer from './ol/interaction/Pointer.js';\nimport $ol$interaction$Select from './ol/interaction/Select.js';\nimport $ol$interaction$Snap from './ol/interaction/Snap.js';\nimport $ol$interaction$Translate from './ol/interaction/Translate.js';\nimport $ol$layer$Base from './ol/layer/Base.js';\nimport $ol$layer$Group from './ol/layer/Group.js';\nimport $ol$layer$Heatmap from './ol/layer/Heatmap.js';\nimport $ol$layer$Image from './ol/layer/Image.js';\nimport $ol$layer$Layer from './ol/layer/Layer.js';\nimport $ol$layer$Tile from './ol/layer/Tile.js';\nimport $ol$layer$Vector from './ol/layer/Vector.js';\nimport $ol$layer$VectorTile from './ol/layer/VectorTile.js';\nimport $ol$proj$Projection from './ol/proj/Projection.js';\nimport $ol$render$Feature from './ol/render/Feature.js';\nimport $ol$render$VectorContext from './ol/render/VectorContext.js';\nimport $ol$render$canvas$Immediate from './ol/render/canvas/Immediate.js';\nimport $ol$render$webgl$Immediate from './ol/render/webgl/Immediate.js';\nimport $ol$renderer$canvas$ImageLayer from './ol/renderer/canvas/ImageLayer.js';\nimport $ol$renderer$canvas$Map from './ol/renderer/canvas/Map.js';\nimport $ol$renderer$canvas$TileLayer from './ol/renderer/canvas/TileLayer.js';\nimport $ol$renderer$canvas$VectorLayer from './ol/renderer/canvas/VectorLayer.js';\nimport $ol$renderer$canvas$VectorTileLayer from './ol/renderer/canvas/VectorTileLayer.js';\nimport $ol$renderer$webgl$ImageLayer from './ol/renderer/webgl/ImageLayer.js';\nimport $ol$renderer$webgl$Map from './ol/renderer/webgl/Map.js';\nimport $ol$renderer$webgl$TileLayer from './ol/renderer/webgl/TileLayer.js';\nimport $ol$renderer$webgl$VectorLayer from './ol/renderer/webgl/VectorLayer.js';\nimport $ol$source$BingMaps from './ol/source/BingMaps.js';\nimport $ol$source$CartoDB from './ol/source/CartoDB.js';\nimport $ol$source$Cluster from './ol/source/Cluster.js';\nimport $ol$source$Image from './ol/source/Image.js';\nimport $ol$source$ImageArcGISRest from './ol/source/ImageArcGISRest.js';\nimport $ol$source$ImageCanvas from './ol/source/ImageCanvas.js';\nimport $ol$source$ImageMapGuide from './ol/source/ImageMapGuide.js';\nimport $ol$source$ImageStatic from './ol/source/ImageStatic.js';\nimport $ol$source$ImageWMS from './ol/source/ImageWMS.js';\nimport $ol$source$OSM from './ol/source/OSM.js';\nimport $ol$source$Raster from './ol/source/Raster.js';\nimport $ol$source$Source from './ol/source/Source.js';\nimport $ol$source$Stamen from './ol/source/Stamen.js';\nimport $ol$source$Tile from './ol/source/Tile.js';\nimport $ol$source$TileArcGISRest from './ol/source/TileArcGISRest.js';\nimport $ol$source$TileDebug from './ol/source/TileDebug.js';\nimport $ol$source$TileImage from './ol/source/TileImage.js';\nimport $ol$source$TileJSON from './ol/source/TileJSON.js';\nimport $ol$source$TileWMS from './ol/source/TileWMS.js';\nimport $ol$source$UTFGrid from './ol/source/UTFGrid.js';\nimport $ol$source$UrlTile from './ol/source/UrlTile.js';\nimport $ol$source$Vector from './ol/source/Vector.js';\nimport $ol$source$VectorTile from './ol/source/VectorTile.js';\nimport $ol$source$WMTS from './ol/source/WMTS.js';\nimport $ol$source$XYZ from './ol/source/XYZ.js';\nimport $ol$source$Zoomify from './ol/source/Zoomify.js';\nimport $ol$structs$LRUCache from './ol/structs/LRUCache.js';\nimport $ol$style$AtlasManager from './ol/style/AtlasManager.js';\nimport $ol$style$Circle from './ol/style/Circle.js';\nimport $ol$style$Fill from './ol/style/Fill.js';\nimport $ol$style$Icon from './ol/style/Icon.js';\nimport $ol$style$IconImageCache from './ol/style/IconImageCache.js';\nimport $ol$style$Image from './ol/style/Image.js';\nimport $ol$style$RegularShape from './ol/style/RegularShape.js';\nimport $ol$style$Stroke from './ol/style/Stroke.js';\nimport $ol$style$Style from './ol/style/Style.js';\nimport $ol$style$Text from './ol/style/Text.js';\nimport $ol$tilegrid$TileGrid from './ol/tilegrid/TileGrid.js';\nimport $ol$tilegrid$WMTS from './ol/tilegrid/WMTS.js';\nimport $ol$webgl$Context from './ol/webgl/Context.js';\nimport * as _ol from './ol/index.js';\nimport * as _ol_Observable from './ol/Observable.js';\nimport * as _ol_color from './ol/color.js';\nimport * as _ol_colorlike from './ol/colorlike.js';\nimport * as _ol_control from './ol/control.js';\nimport * as _ol_control_Attribution from './ol/control/Attribution.js';\nimport * as _ol_control_MousePosition from './ol/control/MousePosition.js';\nimport * as _ol_control_OverviewMap from './ol/control/OverviewMap.js';\nimport * as _ol_control_Rotate from './ol/control/Rotate.js';\nimport * as _ol_control_ScaleLine from './ol/control/ScaleLine.js';\nimport * as _ol_control_ZoomSlider from './ol/control/ZoomSlider.js';\nimport * as _ol_coordinate from './ol/coordinate.js';\nimport * as _ol_easing from './ol/easing.js';\nimport * as _ol_events_condition from './ol/events/condition.js';\nimport * as _ol_extent from './ol/extent.js';\nimport * as _ol_featureloader from './ol/featureloader.js';\nimport * as _ol_format_Polyline from './ol/format/Polyline.js';\nimport * as _ol_format_WFS from './ol/format/WFS.js';\nimport * as _ol_format_filter from './ol/format/filter.js';\nimport * as _ol_geom_Polygon from './ol/geom/Polygon.js';\nimport * as _ol_has from './ol/has.js';\nimport * as _ol_interaction from './ol/interaction.js';\nimport * as _ol_interaction_Draw from './ol/interaction/Draw.js';\nimport * as _ol_interaction_Pointer from './ol/interaction/Pointer.js';\nimport * as _ol_loadingstrategy from './ol/loadingstrategy.js';\nimport * as _ol_proj from './ol/proj.js';\nimport * as _ol_proj_Units from './ol/proj/Units.js';\nimport * as _ol_proj_proj4 from './ol/proj/proj4.js';\nimport * as _ol_render from './ol/render.js';\nimport * as _ol_render_canvas from './ol/render/canvas.js';\nimport * as _ol_size from './ol/size.js';\nimport * as _ol_source_OSM from './ol/source/OSM.js';\nimport * as _ol_source_WMTS from './ol/source/WMTS.js';\nimport * as _ol_sphere from './ol/sphere.js';\nimport * as _ol_style_IconImageCache from './ol/style/IconImageCache.js';\nimport * as _ol_tilegrid from './ol/tilegrid.js';\nimport * as _ol_tilegrid_WMTS from './ol/tilegrid/WMTS.js';\nimport * as _ol_xml from './ol/xml.js';\nimport * as ol_has from './ol/has.js';\nconst ol = window['ol'] = {};\nol.color = {};\nol.colorlike = {};\nol.control = {};\nol.coordinate = {};\nol.easing = {};\nol.events = {};\nol.events.condition = {};\nol.extent = {};\nol.featureloader = {};\nol.format = {};\nol.format.filter = {};\nol.geom = {};\nol.has = {};\nol.interaction = {};\nol.layer = {};\nol.loadingstrategy = {};\nol.proj = {};\nol.proj.Units = {};\nol.proj.proj4 = {};\nol.render = {};\nol.render.canvas = {};\nol.renderer = {};\nol.renderer.canvas = {};\nol.renderer.webgl = {};\nol.size = {};\nol.source = {};\nol.sphere = {};\nol.style = {};\nol.style.IconImageCache = {};\nol.tilegrid = {};\nol.xml = {};\nol.Collection = $ol$Collection;\nol.Feature = $ol$Feature;\nol.Geolocation = $ol$Geolocation;\nol.Graticule = $ol$Graticule;\nol.Kinetic = $ol$Kinetic;\nol.Map = $ol$Map;\nol.Object = $ol$Object;\nol.Observable = $ol$Observable;\nol.Observable.unByKey = _ol_Observable.unByKey;\nol.Overlay = $ol$Overlay;\nol.PluggableMap = $ol$PluggableMap;\nol.View = $ol$View;\nol.WebGLMap = $ol$WebGLMap;\nol.color.asArray = _ol_color.asArray;\nol.color.asString = _ol_color.asString;\nol.colorlike.asColorLike = _ol_colorlike.asColorLike;\nol.control.Attribution = $ol$control$Attribution;\nol.control.Attribution.render = _ol_control_Attribution.render;\nol.control.Control = $ol$control$Control;\nol.control.FullScreen = $ol$control$FullScreen;\nol.control.MousePosition = $ol$control$MousePosition;\nol.control.MousePosition.render = _ol_control_MousePosition.render;\nol.control.OverviewMap = $ol$control$OverviewMap;\nol.control.OverviewMap.render = _ol_control_OverviewMap.render;\nol.control.Rotate = $ol$control$Rotate;\nol.control.Rotate.render = _ol_control_Rotate.render;\nol.control.ScaleLine = $ol$control$ScaleLine;\nol.control.ScaleLine.render = _ol_control_ScaleLine.render;\nol.control.Zoom = $ol$control$Zoom;\nol.control.ZoomSlider = $ol$control$ZoomSlider;\nol.control.ZoomSlider.render = _ol_control_ZoomSlider.render;\nol.control.ZoomToExtent = $ol$control$ZoomToExtent;\nol.control.defaults = _ol_control.defaults;\nol.coordinate.add = _ol_coordinate.add;\nol.coordinate.createStringXY = _ol_coordinate.createStringXY;\nol.coordinate.format = _ol_coordinate.format;\nol.coordinate.rotate = _ol_coordinate.rotate;\nol.coordinate.toStringHDMS = _ol_coordinate.toStringHDMS;\nol.coordinate.toStringXY = _ol_coordinate.toStringXY;\nol.easing.easeIn = _ol_easing.easeIn;\nol.easing.easeOut = _ol_easing.easeOut;\nol.easing.inAndOut = _ol_easing.inAndOut;\nol.easing.linear = _ol_easing.linear;\nol.easing.upAndDown = _ol_easing.upAndDown;\nol.events.condition.altKeyOnly = _ol_events_condition.altKeyOnly;\nol.events.condition.altShiftKeysOnly = _ol_events_condition.altShiftKeysOnly;\nol.events.condition.always = _ol_events_condition.always;\nol.events.condition.click = _ol_events_condition.click;\nol.events.condition.doubleClick = _ol_events_condition.doubleClick;\nol.events.condition.focus = _ol_events_condition.focus;\nol.events.condition.mouseOnly = _ol_events_condition.mouseOnly;\nol.events.condition.never = _ol_events_condition.never;\nol.events.condition.noModifierKeys = _ol_events_condition.noModifierKeys;\nol.events.condition.platformModifierKeyOnly = _ol_events_condition.platformModifierKeyOnly;\nol.events.condition.pointerMove = _ol_events_condition.pointerMove;\nol.events.condition.primaryAction = _ol_events_condition.primaryAction;\nol.events.condition.shiftKeyOnly = _ol_events_condition.shiftKeyOnly;\nol.events.condition.singleClick = _ol_events_condition.singleClick;\nol.events.condition.targetNotEditable = _ol_events_condition.targetNotEditable;\nol.extent.applyTransform = _ol_extent.applyTransform;\nol.extent.boundingExtent = _ol_extent.boundingExtent;\nol.extent.buffer = _ol_extent.buffer;\nol.extent.containsCoordinate = _ol_extent.containsCoordinate;\nol.extent.containsExtent = _ol_extent.containsExtent;\nol.extent.containsXY = _ol_extent.containsXY;\nol.extent.createEmpty = _ol_extent.createEmpty;\nol.extent.equals = _ol_extent.equals;\nol.extent.extend = _ol_extent.extend;\nol.extent.getArea = _ol_extent.getArea;\nol.extent.getBottomLeft = _ol_extent.getBottomLeft;\nol.extent.getBottomRight = _ol_extent.getBottomRight;\nol.extent.getCenter = _ol_extent.getCenter;\nol.extent.getHeight = _ol_extent.getHeight;\nol.extent.getIntersection = _ol_extent.getIntersection;\nol.extent.getSize = _ol_extent.getSize;\nol.extent.getTopLeft = _ol_extent.getTopLeft;\nol.extent.getTopRight = _ol_extent.getTopRight;\nol.extent.getWidth = _ol_extent.getWidth;\nol.extent.intersects = _ol_extent.intersects;\nol.extent.isEmpty = _ol_extent.isEmpty;\nol.featureloader.xhr = _ol_featureloader.xhr;\nol.format.EsriJSON = $ol$format$EsriJSON;\nol.format.Feature = $ol$format$Feature;\nol.format.GML = $ol$format$GML;\nol.format.GML2 = $ol$format$GML2;\nol.format.GML3 = $ol$format$GML3;\nol.format.GPX = $ol$format$GPX;\nol.format.GeoJSON = $ol$format$GeoJSON;\nol.format.IGC = $ol$format$IGC;\nol.format.KML = $ol$format$KML;\nol.format.MVT = $ol$format$MVT;\nol.format.OSMXML = $ol$format$OSMXML;\nol.format.Polyline = $ol$format$Polyline;\nol.format.Polyline.decodeDeltas = _ol_format_Polyline.decodeDeltas;\nol.format.Polyline.decodeFloats = _ol_format_Polyline.decodeFloats;\nol.format.Polyline.encodeDeltas = _ol_format_Polyline.encodeDeltas;\nol.format.Polyline.encodeFloats = _ol_format_Polyline.encodeFloats;\nol.format.TopoJSON = $ol$format$TopoJSON;\nol.format.WFS = $ol$format$WFS;\nol.format.WFS.writeFilter = _ol_format_WFS.writeFilter;\nol.format.WKT = $ol$format$WKT;\nol.format.WMSCapabilities = $ol$format$WMSCapabilities;\nol.format.WMSGetFeatureInfo = $ol$format$WMSGetFeatureInfo;\nol.format.WMTSCapabilities = $ol$format$WMTSCapabilities;\nol.format.filter.Bbox = $ol$format$filter$Bbox;\nol.format.filter.Contains = $ol$format$filter$Contains;\nol.format.filter.During = $ol$format$filter$During;\nol.format.filter.EqualTo = $ol$format$filter$EqualTo;\nol.format.filter.GreaterThan = $ol$format$filter$GreaterThan;\nol.format.filter.GreaterThanOrEqualTo = $ol$format$filter$GreaterThanOrEqualTo;\nol.format.filter.Intersects = $ol$format$filter$Intersects;\nol.format.filter.IsBetween = $ol$format$filter$IsBetween;\nol.format.filter.IsLike = $ol$format$filter$IsLike;\nol.format.filter.IsNull = $ol$format$filter$IsNull;\nol.format.filter.LessThan = $ol$format$filter$LessThan;\nol.format.filter.LessThanOrEqualTo = $ol$format$filter$LessThanOrEqualTo;\nol.format.filter.Not = $ol$format$filter$Not;\nol.format.filter.NotEqualTo = $ol$format$filter$NotEqualTo;\nol.format.filter.Or = $ol$format$filter$Or;\nol.format.filter.Within = $ol$format$filter$Within;\nol.format.filter.and = _ol_format_filter.and;\nol.format.filter.bbox = _ol_format_filter.bbox;\nol.format.filter.between = _ol_format_filter.between;\nol.format.filter.contains = _ol_format_filter.contains;\nol.format.filter.during = _ol_format_filter.during;\nol.format.filter.equalTo = _ol_format_filter.equalTo;\nol.format.filter.greaterThan = _ol_format_filter.greaterThan;\nol.format.filter.greaterThanOrEqualTo = _ol_format_filter.greaterThanOrEqualTo;\nol.format.filter.intersects = _ol_format_filter.intersects;\nol.format.filter.isNull = _ol_format_filter.isNull;\nol.format.filter.lessThan = _ol_format_filter.lessThan;\nol.format.filter.lessThanOrEqualTo = _ol_format_filter.lessThanOrEqualTo;\nol.format.filter.like = _ol_format_filter.like;\nol.format.filter.not = _ol_format_filter.not;\nol.format.filter.notEqualTo = _ol_format_filter.notEqualTo;\nol.format.filter.or = _ol_format_filter.or;\nol.format.filter.within = _ol_format_filter.within;\nol.geom.Circle = $ol$geom$Circle;\nol.geom.Geometry = $ol$geom$Geometry;\nol.geom.GeometryCollection = $ol$geom$GeometryCollection;\nol.geom.LineString = $ol$geom$LineString;\nol.geom.LinearRing = $ol$geom$LinearRing;\nol.geom.MultiLineString = $ol$geom$MultiLineString;\nol.geom.MultiPoint = $ol$geom$MultiPoint;\nol.geom.MultiPolygon = $ol$geom$MultiPolygon;\nol.geom.Point = $ol$geom$Point;\nol.geom.Polygon = $ol$geom$Polygon;\nol.geom.Polygon.circular = _ol_geom_Polygon.circular;\nol.geom.Polygon.fromCircle = _ol_geom_Polygon.fromCircle;\nol.geom.Polygon.fromExtent = _ol_geom_Polygon.fromExtent;\nol.geom.SimpleGeometry = $ol$geom$SimpleGeometry;\nol.has.DEVICE_PIXEL_RATIO = _ol_has.DEVICE_PIXEL_RATIO;\nol.has.GEOLOCATION = _ol_has.GEOLOCATION;\nol.has.TOUCH = _ol_has.TOUCH;\nol.has.WEBGL = _ol_has.WEBGL;\nol.inherits = _ol.inherits;\nol.interaction.DoubleClickZoom = $ol$interaction$DoubleClickZoom;\nol.interaction.DragAndDrop = $ol$interaction$DragAndDrop;\nol.interaction.DragBox = $ol$interaction$DragBox;\nol.interaction.DragPan = $ol$interaction$DragPan;\nol.interaction.DragRotate = $ol$interaction$DragRotate;\nol.interaction.DragRotateAndZoom = $ol$interaction$DragRotateAndZoom;\nol.interaction.DragZoom = $ol$interaction$DragZoom;\nol.interaction.Draw = $ol$interaction$Draw;\nol.interaction.Draw.createBox = _ol_interaction_Draw.createBox;\nol.interaction.Draw.createRegularPolygon = _ol_interaction_Draw.createRegularPolygon;\nol.interaction.Draw.handleEvent = _ol_interaction_Draw.handleEvent;\nol.interaction.Extent = $ol$interaction$Extent;\nol.interaction.Interaction = $ol$interaction$Interaction;\nol.interaction.KeyboardPan = $ol$interaction$KeyboardPan;\nol.interaction.KeyboardZoom = $ol$interaction$KeyboardZoom;\nol.interaction.Modify = $ol$interaction$Modify;\nol.interaction.MouseWheelZoom = $ol$interaction$MouseWheelZoom;\nol.interaction.PinchRotate = $ol$interaction$PinchRotate;\nol.interaction.PinchZoom = $ol$interaction$PinchZoom;\nol.interaction.Pointer = $ol$interaction$Pointer;\nol.interaction.Pointer.handleEvent = _ol_interaction_Pointer.handleEvent;\nol.interaction.Select = $ol$interaction$Select;\nol.interaction.Snap = $ol$interaction$Snap;\nol.interaction.Translate = $ol$interaction$Translate;\nol.interaction.defaults = _ol_interaction.defaults;\nol.layer.Base = $ol$layer$Base;\nol.layer.Group = $ol$layer$Group;\nol.layer.Heatmap = $ol$layer$Heatmap;\nol.layer.Image = $ol$layer$Image;\nol.layer.Layer = $ol$layer$Layer;\nol.layer.Tile = $ol$layer$Tile;\nol.layer.Vector = $ol$layer$Vector;\nol.layer.VectorTile = $ol$layer$VectorTile;\nol.loadingstrategy.all = _ol_loadingstrategy.all;\nol.loadingstrategy.bbox = _ol_loadingstrategy.bbox;\nol.loadingstrategy.tile = _ol_loadingstrategy.tile;\nol.proj.Projection = $ol$proj$Projection;\nol.proj.Units.METERS_PER_UNIT = _ol_proj_Units.METERS_PER_UNIT;\nol.proj.addCoordinateTransforms = _ol_proj.addCoordinateTransforms;\nol.proj.addEquivalentProjections = _ol_proj.addEquivalentProjections;\nol.proj.addProjection = _ol_proj.addProjection;\nol.proj.equivalent = _ol_proj.equivalent;\nol.proj.fromLonLat = _ol_proj.fromLonLat;\nol.proj.get = _ol_proj.get;\nol.proj.getPointResolution = _ol_proj.getPointResolution;\nol.proj.getTransform = _ol_proj.getTransform;\nol.proj.proj4.register = _ol_proj_proj4.register;\nol.proj.toLonLat = _ol_proj.toLonLat;\nol.proj.transform = _ol_proj.transform;\nol.proj.transformExtent = _ol_proj.transformExtent;\nol.render.VectorContext = $ol$render$VectorContext;\nol.render.canvas.labelCache = _ol_render_canvas.labelCache;\nol.render.toContext = _ol_render.toContext;\nol.renderer.canvas.ImageLayer = $ol$renderer$canvas$ImageLayer;\nol.renderer.canvas.Map = $ol$renderer$canvas$Map;\nol.renderer.canvas.TileLayer = $ol$renderer$canvas$TileLayer;\nol.renderer.canvas.VectorLayer = $ol$renderer$canvas$VectorLayer;\nol.renderer.canvas.VectorTileLayer = $ol$renderer$canvas$VectorTileLayer;\nol.renderer.webgl.ImageLayer = $ol$renderer$webgl$ImageLayer;\nol.renderer.webgl.Map = $ol$renderer$webgl$Map;\nol.renderer.webgl.TileLayer = $ol$renderer$webgl$TileLayer;\nol.renderer.webgl.VectorLayer = $ol$renderer$webgl$VectorLayer;\nol.size.toSize = _ol_size.toSize;\nol.source.BingMaps = $ol$source$BingMaps;\nol.source.CartoDB = $ol$source$CartoDB;\nol.source.Cluster = $ol$source$Cluster;\nol.source.Image = $ol$source$Image;\nol.source.ImageArcGISRest = $ol$source$ImageArcGISRest;\nol.source.ImageCanvas = $ol$source$ImageCanvas;\nol.source.ImageMapGuide = $ol$source$ImageMapGuide;\nol.source.ImageStatic = $ol$source$ImageStatic;\nol.source.ImageWMS = $ol$source$ImageWMS;\nol.source.OSM = $ol$source$OSM;\nol.source.OSM.ATTRIBUTION = _ol_source_OSM.ATTRIBUTION;\nol.source.Raster = $ol$source$Raster;\nol.source.Source = $ol$source$Source;\nol.source.Stamen = $ol$source$Stamen;\nol.source.Tile = $ol$source$Tile;\nol.source.TileArcGISRest = $ol$source$TileArcGISRest;\nol.source.TileDebug = $ol$source$TileDebug;\nol.source.TileImage = $ol$source$TileImage;\nol.source.TileJSON = $ol$source$TileJSON;\nol.source.TileWMS = $ol$source$TileWMS;\nol.source.UTFGrid = $ol$source$UTFGrid;\nol.source.Vector = $ol$source$Vector;\nol.source.VectorTile = $ol$source$VectorTile;\nol.source.WMTS = $ol$source$WMTS;\nol.source.WMTS.optionsFromCapabilities = _ol_source_WMTS.optionsFromCapabilities;\nol.source.XYZ = $ol$source$XYZ;\nol.source.Zoomify = $ol$source$Zoomify;\nol.sphere.getArea = _ol_sphere.getArea;\nol.sphere.getDistance = _ol_sphere.getDistance;\nol.sphere.getLength = _ol_sphere.getLength;\nol.style.AtlasManager = $ol$style$AtlasManager;\nol.style.Circle = $ol$style$Circle;\nol.style.Fill = $ol$style$Fill;\nol.style.Icon = $ol$style$Icon;\nol.style.IconImageCache.shared = _ol_style_IconImageCache.shared;\nol.style.Image = $ol$style$Image;\nol.style.RegularShape = $ol$style$RegularShape;\nol.style.Stroke = $ol$style$Stroke;\nol.style.Style = $ol$style$Style;\nol.style.Text = $ol$style$Text;\nol.tilegrid.TileGrid = $ol$tilegrid$TileGrid;\nol.tilegrid.WMTS = $ol$tilegrid$WMTS;\nol.tilegrid.WMTS.createFromCapabilitiesMatrixSet = _ol_tilegrid_WMTS.createFromCapabilitiesMatrixSet;\nol.tilegrid.createXYZ = _ol_tilegrid.createXYZ;\nol.xml.getAllTextContent = _ol_xml.getAllTextContent;\nol.xml.parse = _ol_xml.parse;\n","/**\n * @module ol/proj/proj4\n */\nimport {addCoordinateTransforms, addProjection, addEquivalentProjections, get} from '../proj.js';\nimport {get as getTransform} from './transforms.js';\nimport Projection from './Projection.js';\n\n/**\n * Make projections defined in proj4 (with `proj4.defs()`) available in\n * OpenLayers.\n *\n * This function should be called whenever changes are made to the proj4\n * registry, e.g. after calling `proj4.defs()`. Existing transforms will not be\n * modified by this function.\n *\n * @param {?} proj4 Proj4.\n * @api\n */\nexport function register(proj4) {\n  const projCodes = Object.keys(proj4.defs);\n  const len = projCodes.length;\n  let i, j;\n  for (i = 0; i < len; ++i) {\n    const code = projCodes[i];\n    if (!get(code)) {\n      const def = proj4.defs(code);\n      addProjection(new Projection({\n        code: code,\n        axisOrientation: def.axis,\n        metersPerUnit: def.to_meter,\n        units: def.units\n      }));\n    }\n  }\n  for (i = 0; i < len; ++i) {\n    const code1 = projCodes[i];\n    const proj1 = get(code1);\n    for (j = 0; j < len; ++j) {\n      const code2 = projCodes[j];\n      const proj2 = get(code2);\n      if (!getTransform(code1, code2)) {\n        if (proj4.defs[code1] === proj4.defs[code2]) {\n          addEquivalentProjections([proj1, proj2]);\n        } else {\n          const transform = proj4(code1, code2);\n          addCoordinateTransforms(proj1, proj2, transform.forward, transform.inverse);\n        }\n      }\n    }\n  }\n}\n","/**\n * @module ol/render\n */\nimport {DEVICE_PIXEL_RATIO} from './has.js';\nimport {create as createTransform, scale as scaleTransform} from './transform.js';\nimport CanvasImmediateRenderer from './render/canvas/Immediate.js';\n\n\n/**\n * @typedef {Object} State\n * @property {CanvasRenderingContext2D} context Canvas context that the layer is being rendered to.\n * @property {module:ol/Feature|module:ol/render/Feature} feature\n * @property {module:ol/geom/SimpleGeometry} geometry\n * @property {number} pixelRatio Pixel ratio used by the layer renderer.\n * @property {number} resolution Resolution that the render batch was created and optimized for.\n * This is not the view's resolution that is being rendered.\n * @property {number} rotation Rotation of the rendered layer in radians.\n */\n\n\n/**\n * A function to be used when sorting features before rendering.\n * It takes two instances of {@link module:ol/Feature} or\n * {@link module:ol/render/Feature} and returns a `{number}`.\n *\n * @typedef {function((module:ol/Feature|module:ol/render/Feature),\n *           (module:ol/Feature|module:ol/render/Feature)):number} OrderFunction\n */\n\n\n/**\n * @typedef {Object} ToContextOptions\n * @property {module:ol/size~Size} [size] Desired size of the canvas in css\n * pixels. When provided, both canvas and css size will be set according to the\n * `pixelRatio`. If not provided, the current canvas and css sizes will not be\n * altered.\n * @property {number} [pixelRatio=window.devicePixelRatio] Pixel ratio (canvas\n * pixel to css pixel ratio) for the canvas.\n */\n\n\n/**\n * Binds a Canvas Immediate API to a canvas context, to allow drawing geometries\n * to the context's canvas.\n *\n * The units for geometry coordinates are css pixels relative to the top left\n * corner of the canvas element.\n * ```js\n * import {toContext} from 'ol/render';\n * import Fill from 'ol/style/Fill';\n * import Polygon from 'ol/geom/Polygon';\n *\n * var canvas = document.createElement('canvas');\n * var render = toContext(canvas.getContext('2d'),\n *     { size: [100, 100] });\n * render.setFillStrokeStyle(new Fill({ color: blue }));\n * render.drawPolygon(\n *     new Polygon([[[0, 0], [100, 100], [100, 0], [0, 0]]]));\n * ```\n *\n * @param {CanvasRenderingContext2D} context Canvas context.\n * @param {module:ol/render~ToContextOptions=} opt_options Options.\n * @return {module:ol/render/canvas/Immediate} Canvas Immediate.\n * @api\n */\nexport function toContext(context, opt_options) {\n  const canvas = context.canvas;\n  const options = opt_options ? opt_options : {};\n  const pixelRatio = options.pixelRatio || DEVICE_PIXEL_RATIO;\n  const size = options.size;\n  if (size) {\n    canvas.width = size[0] * pixelRatio;\n    canvas.height = size[1] * pixelRatio;\n    canvas.style.width = size[0] + 'px';\n    canvas.style.height = size[1] + 'px';\n  }\n  const extent = [0, 0, canvas.width, canvas.height];\n  const transform = scaleTransform(createTransform(), pixelRatio, pixelRatio);\n  return new CanvasImmediateRenderer(context, pixelRatio, extent, transform, 0);\n}\n"],"names":["inherits","childCtor","parentCtor","prototype","Object","create","constructor","let","uidCounter_","getUid","obj","ol_uid","const","AssertionError","code","path","split","this","message","name","Error","assign","target","var_sources","TypeError","output","i","ii","arguments","length","source","key","hasOwnProperty","clear","object","property","getValues","values","push","isEmpty","findListener","listeners","listener","opt_this","opt_setDeleteIndex","listenerObj","bindTo","deleteIndex","getListeners","type","listenerMap","ol_lm","undefined","getListenerMap","removeListeners","removeEventListener","boundListener","keys","listen","opt_once","callOnce","addEventListener","evt","unlistenByKey","call","listenOnce","unlisten","indexOf","splice","unlistenAll","TRUE","FALSE","UNDEFINED","Disposable","disposed_","dispose","disposeInternal","Event","propagationStopped","stopPropagation","preventDefault","EventTarget","pendingRemovals_","dispatching_","listeners_","dispatchEvent","event","propagate","pendingRemovals","hasListener","opt_type","index","Observable","revision_","changed","EventType","getRevision","on","Array","isArray","len","once","un","ObjectEvent","oldValue","BaseObject","opt_values","values_","setProperties","changeEventTypeCache","getChangeEventType","get","value","getKeys","getProperties","notify","eventType","ObjectEventType","set","opt_silent","unset","Property","CollectionEvent","opt_element","element","Collection","opt_array","opt_options","options","unique_","unique","array_","assertUnique_","updateLength_","assert","assertion","errorCode","getLength","pop","extend","arr","forEach","f","array","getArray","item","insertAt","elem","CollectionEventType","removeAt","n","remove","prev","setAt","j","opt_except","BOTTOM_LEFT","BOTTOM_RIGHT","TOP_LEFT","TOP_RIGHT","UNKNOWN","INTERSECTING","ABOVE","RIGHT","BELOW","LEFT","boundingExtent","coordinates","extent","createEmpty","extendCoordinate","buffer","opt_extent","clone","slice","closestSquaredDistanceXY","x","y","dx","dy","containsCoordinate","coordinate","containsXY","containsExtent","extent1","extent2","coordinateRelationship","minX","minY","maxX","maxY","relationship","Relationship","Infinity","createOrUpdate","createOrUpdateEmpty","createOrUpdateFromCoordinate","createOrUpdateFromCoordinates","extendCoordinates","createOrUpdateFromFlatCoordinates","flatCoordinates","offset","end","stride","extendFlatCoordinates","equals","extendXY","Math","min","max","forEachCorner","callback","val","getBottomLeft","getBottomRight","getTopRight","getTopLeft","getArea","area","getWidth","getHeight","getCenter","getForViewAndSize","center","resolution","rotation","size","cosRotation","cos","sinRotation","sin","xCos","xSin","yCos","ySin","x0","x1","x2","x3","y0","y1","y2","y3","getIntersection","intersection","intersects","scaleFromCenter","deltaX","deltaY","applyTransform","transformFn","xs","ys","apply","transform2D","transform","opt_dest","dest","translate","k","clamp","cosh","exp","squaredSegmentDistance","t","squaredDistance","toDegrees","angleInRadians","PI","toRadians","angleInDegrees","modulo","a","b","r","lerp","POINT","LINE_STRING","LINEAR_RING","POLYGON","MULTI_POINT","MULTI_LINE_STRING","MULTI_POLYGON","GEOMETRY_COLLECTION","CIRCLE","DEFAULT_RADIUS","getDistance","c1","c2","opt_radius","radius","lat1","lat2","deltaLatBy2","deltaLonBy2","atan2","sqrt","getLengthInternal","getAreaInternal","Units","DEGREES","FEET","METERS","PIXELS","TILE_PIXELS","USFEET","METERS_PER_UNIT","Projection","code_","units_","extent_","worldExtent_","worldExtent","axisOrientation_","axisOrientation","global_","global","canWrapX_","getPointResolutionFunc_","getPointResolution","defaultTileGrid_","metersPerUnit_","metersPerUnit","canWrapX","getCode","getExtent","getUnits","getMetersPerUnit","getWorldExtent","getAxisOrientation","isGlobal","setGlobal","getDefaultTileGrid","setDefaultTileGrid","tileGrid","setExtent","setWorldExtent","setGetPointResolution","func","getPointResolutionFunc","RADIUS","HALF_SIZE","EXTENT","WORLD_EXTENT","EPSG3857Projection","units","point","PROJECTIONS","fromEPSG4326","input","opt_output","opt_dimension","dimension","halfSize","log","tan","toEPSG4326","atan","EPSG4326Projection","opt_axisOrientation","cache","projections2","forwardTransform","inverseTransform","transforms","add","destination","sourceCode","destinationCode","cloneTransform","identityTransform","addProjection","projection","addTransformFunc","projectionLike","opt_units","pointResolution","getter","getTransformFromProjections","vertices","addEquivalentProjections","projections","createProjection","defaultCode","createTransformFromCoordinateTransform","coordTransform","addCoordinateTransforms","forward","inverse","sourceProj","destProj","equivalent","projection1","projection2","equalUnits","sourceProjection","destinationProjection","transformFunc","getTransformFunc","getTransform","transformExtent","EPSG3857_PROJECTIONS","EPSG4326_PROJECTIONS","tmp_","reset","multiply","transform1","transform2","a1","b1","d1","e1","f1","a2","b2","d2","e2","f2","c","d","e","setFromArray","rotate","angle","scale","compose","dx1","dy1","sx","sy","dx2","dy2","invert","mat","det","Geometry","extentRevision_","simplifiedGeometryCache","simplifiedGeometryMaxMinSquaredTolerance","simplifiedGeometryRevision","tmpTransform","closestPointXY","closestPoint","minSquaredDistance","getClosestPoint","opt_closestPoint","NaN","intersectsCoordinate","computeExtent","anchor","opt_sy","opt_anchor","simplify","tolerance","getSimplifiedGeometry","squaredTolerance","getType","intersectsExtent","getProjection","inCoordinates","outCoordinates","pixelExtent","projectedExtent","composeTransform","HEX_COLOR_RE_","NAMED_COLOR_RE_","asString","color","toString","cacheSize","fromString","s","g","exec","el","document","createElement","style","body","appendChild","rgb","getComputedStyle","removeChild","fromNamed","hasAlpha","parseInt","substr","normalize","map","Number","fromStringInternal_","asArray","asColorLike","CanvasPattern","CanvasGradient","createCanvasContext2D","opt_width","opt_height","canvas","width","height","getContext","replaceNode","newNode","oldNode","parent","parentNode","replaceChild","removeNode","node","removeChildren","lastChild","MAX_TEXTURE_SIZE","EXTENSIONS","ARRAY_BUFFER","FLOAT","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_2D","CLAMP_TO_EDGE","FRAMEBUFFER","CONTEXT_IDS","opt_attributes","context","HAS","window","gl","failIfMajorPerformanceCaveat","getParameter","getSupportedExtensions","ua","navigator","userAgent","toLowerCase","FIREFOX","SAFARI","WEBKIT","MAC","DEVICE_PIXEL_RATIO","devicePixelRatio","CANVAS_LINE_DASH","has","setLineDash","GEOLOCATION","TOUCH","POINTER","MSPOINTER","IDLE","LOADING","LOADED","ERROR","CLASS_HIDDEN","CLASS_UNSELECTABLE","CLASS_CONTROL","CLASS_COLLAPSED","getFontFamilies","font","family","fontFamily","LRUCache","opt_highWaterMark","highWaterMark","count_","entries_","oldest_","newest_","canExpireCache","getCount","containsKey","entry","value_","key_","newer","older","peekLast","peekLastKey","peekFirstKey","replace","setSize","prune","defaultFont","defaultFillStyle","defaultLineCap","defaultLineDash","defaultLineJoin","defaultStrokeStyle","defaultTextAlign","defaultPadding","labelCache","checkedFonts","measureContext","textHeights","checkFont","interval","referenceWidth","retries","checked","referenceFonts","text","isAvailable","getMeasureContext","available","referenceFont","measureText","check","done","clearInterval","fontSpec","fontFamilies","setInterval","span","heights","measureTextHeight","textContent","margin","padding","position","left","offsetHeight","measureTextWidth","rotateAtOffset","offsetX","offsetY","resetTransform","drawImage","opacity","image","originX","originY","w","h","alpha","globalAlpha","setTransform","ImageStyle","opacity_","rotateWithView_","rotateWithView","rotation_","scale_","snapToPixel_","snapToPixel","getOpacity","getRotateWithView","getRotation","getScale","getSnapToPixel","getAnchor","getImage","pixelRatio","getHitDetectionImage","getImageState","getImageSize","getHitDetectionImageSize","getOrigin","getSize","setOpacity","setRotateWithView","setRotation","setScale","setSnapToPixel","listenImageChange","thisArg","load","unlistenImageChange","RegularShape","checksums_","canvas_","hitDetectionCanvas_","fill_","fill","origin_","points_","points","radius_","radius1","radius2_","radius2","angle_","stroke_","stroke","anchor_","size_","imageSize_","hitDetectionImageSize_","atlasManager_","atlasManager","render_","getFill","getPoints","getRadius","getRadius2","getAngle","getStroke","ImageState","imageSize","strokeStyle","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","strokeWidth","getColor","getLineDash","getLineDashOffset","getLineJoin","getLineCap","getMiterLimit","renderOptions","draw_","createHitDetectionCanvas_","round","renderHitDetectionCallback","hasCustomHitDetectionImage","drawHitDetectionCanvas_","bind","id","getChecksum","info","hitImage","angle0","radiusC","beginPath","arc","lineTo","fillStyle","lineWidth","closePath","strokeChecksum","fillChecksum","checksum","CircleStyle","setRadius","Fill","color_","checksum_","setColor","Stroke","lineCap_","lineDash_","lineDashOffset_","lineJoin_","miterLimit_","width_","setLineCap","setLineDashOffset","setLineJoin","setMiterLimit","setWidth","Style","geometry_","geometryFunction_","defaultGeometryFunction","geometry","setGeometry","image_","renderer_","renderer","text_","zIndex_","zIndex","getGeometry","getText","getZIndex","getRenderer","setRenderer","getGeometryFunction","setFill","setImage","setStroke","setText","feature","setZIndex","defaultStyles","createDefaultStyle","createEditingStyle","styles","white","blue","GeometryType","concat","Feature","opt_geometryOrProperties","id_","geometryName_","style_","styleFunction_","geometryChangeKey_","handleGeometryChanged_","properties","setGeometryName","getGeometryName","getStyle","setStyle","getId","getStyleFunction","handleGeometryChange_","createStyleFunction","setId","numberSafeCompareFunction","includes","linearFindNearest","direction","reverseSubArray","begin","tmp","data","extension","find","arr1","arr2","len1","stableSort","compareFnc","sort","findIndex","every","idx","XY","XYZ","XYM","XYZM","SimpleGeometry","layout","GeometryLayout","getStrideForLayout","linearRing","twiceArea","linearRings","ends","assignClosest","offset1","offset2","maxSquaredDelta","squaredDelta","squaredDx","arrayMaxSquaredDelta","assignClosestPoint","maxDelta","isRing","opt_tmpPoint","tmpPoint","assignClosestArrayPoint","deflateCoordinate","deflateCoordinates","deflateCoordinatesArray","coordinatess","opt_ends","jj","inflateCoordinates","opt_coordinates","inflateCoordinatesArray","opt_coordinatess","inflateMultiCoordinatesArray","endss","opt_coordinatesss","coordinatesss","douglasPeucker","simplifiedFlatCoordinates","simplifiedOffset","markers","stack","last","first","maxSquaredDistance","snap","quantize","quantizeArray","simplifiedEnds","getCoordinates","getFirstCoordinate","getFlatCoordinates","getLastCoordinate","getLayout","simplifiedGeometry","getSimplifiedGeometryInternal","getStride","setFlatCoordinatesInternal","setCoordinates","opt_layout","setLayout","nesting","anchorX","anchorY","LinearRing","maxDelta_","maxDeltaRevision_","setFlatCoordinates","linearRingArea","simplifiedLinearRing","Point","linearRingContainsExtent","linearRingContainsXY","wn","linearRingsContainsXY","getInteriorPointOfArray","flatCenters","flatCentersOffset","intersections","rr","pointX","maxSegmentLength","segmentLength","abs","isNaN","getInteriorPointsOfMultiArray","interiorPoints","ret","point1","point2","intersectsLineString","coordinatesExtent","forEachSegment","start","startRel","endRel","startX","startY","endX","endY","slope","intersectsSegment","intersectsLinearRingArray","linearRingIsClockwise","edge","linearRingIsOriented","opt_right","right","isClockwise","orientLinearRings","reverseCoordinates","orientLinearRingsArray","Polygon","ends_","flatInteriorPointRevision_","flatInteriorPoint_","orientedRevision_","orientedFlatCoordinates_","circular","opt_n","opt_sphereRadius","distance","bearing","lon1","dByR","lat","asin","polygon","fromExtent","fromCircle","circle","opt_sides","opt_angle","sides","arrayLength","makeRegular","getEnds","startAngle","appendLinearRing","getOrientedFlatCoordinates","linearRingsArea","getFlatInteriorPoint","flatCenter","getInteriorPoint","getLinearRingCount","getLinearRing","getLinearRings","simplifiedPolygon","Geolocation","position_","transform_","watchId_","GeolocationProperty","handleProjectionChanged_","handleTrackingChanged_","setProjection","trackingOptions","setTrackingOptions","setTracking","tracking","padNumber","number","opt_precision","numberString","toFixed","decimal","join","compareVersions","v1","v2","s1","s2","n1","n2","delta","closestOnSegment","segment","along","degreesToStringHDMS","hemispheres","degrees","opt_fractionDigits","normalizedDegrees","dflPrecision","precision","pow","deg","floor","sec","ceil","charAt","format","template","coordinate1","coordinate2","cosAngle","sinAngle","coord1","coord2","squaredDistanceToSegment","toStringXY","interpolatePoint","fraction","pointY","cumulativeLengths","haystack","needle","opt_comparator","mid","cmp","comparator","low","high","found","binarySearch","o","lineStringCoordinateAtM","m","extrapolate","lo","hi","m0","lineStringLength","getTracking","geolocation","watchPosition","positionChange_","positionError_","getTrackingOptions","clearWatch","coords","accuracy","altitude","altitudeAccuracy","heading","longitude","latitude","projectedPosition","speed","circularPolygon","error","getAccuracy","getAccuracyGeometry","getAltitude","getAltitudeAccuracy","getHeading","getPosition","getSpeed","LineString","flatMidpoint_","flatMidpointRevision_","line","interpolate","geoM","fracA","fracB","fracM","geoA","geoB","geoStack","fractionStack","fractions","maxIterations","appendCoordinate","lineString","getCoordinateAtM","opt_extrapolate","getCoordinateAt","getFlatMidpoint","simplifiedLineString","Text","font_","textAlign_","textAlign","textBaseline_","textBaseline","maxAngle_","maxAngle","placement_","placement","TextPlacement","overflow_","overflow","offsetX_","offsetY_","backgroundFill_","backgroundFill","backgroundStroke_","backgroundStroke","padding_","getFont","getPlacement","getMaxAngle","getOverflow","getTextAlign","getTextBaseline","getOffsetX","getOffsetY","getBackgroundFill","getBackgroundStroke","getPadding","setOverflow","setFont","setMaxAngle","setOffsetX","setOffsetY","setPlacement","setTextAlign","setTextBaseline","setBackgroundFill","setBackgroundStroke","setPadding","DEFAULT_STROKE_STYLE","INTERVALS","Graticule","map_","postcomposeListenerKey_","projection_","maxLat_","maxLon_","minLat_","minLon_","maxLatP_","maxLonP_","minLatP_","minLonP_","targetSize_","targetSize","maxLines_","maxLines","meridians_","parallels_","strokeStyle_","fromLonLatTransform_","toLonLatTransform_","projectionCenterLonLat_","meridiansLabels_","parallelsLabels_","showLabels","lonLabelFormatter_","lonLabelFormatter","latLabelFormatter_","latLabelFormatter","lonLabelPosition_","lonLabelPosition","latLabelPosition_","latLabelPosition","lonLabelStyle_","lonLabelStyle","latLabelStyle_","latLabelStyle","setMap","addMeridian_","lon","minLat","maxLat","getMeridian_","textPoint","getMeridianPoint_","geom","clampedBottom","clampedTop","addParallel_","minLon","maxLon","getParallel_","getParallelPoint_","clampedLeft","clampedRight","createGraticule_","getInterval_","cnt","centerLonLat","centerLon","centerLat","validExtent","p1","p2","getMap","frac","getMeridians","lon2","getParallels","handlePostCompose_","l","labelData","vectorContext","frameState","viewState","equivalentProjection","updateProjectionInfo_","setFillStrokeStyle","drawGeometry","setTextStyle","epsg4326Projection","worldExtentP","render","RenderEventType","ImageBase","state","pixelRatio_","getPixelRatio","getResolution","getState","ImageWrapper","src","crossOrigin","imageLoadFunction","src_","Image","imageListenerKeys_","imageLoadFunction_","handleImageError_","unlistenImage_","handleImageLoad_","easeIn","easeOut","inAndOut","linear","Tile","tileCoord","interimTile","transition_","transition","transitionStarts_","getKey","getInterimTile","tile","TileState","refreshInterimChain","getTileCoord","setState","getAlpha","time","inTransition","endTransition","ImageTile","tileLoadFunction","crossOrigin_","tileLoadFunction_","getBlankImage","ctx","fillRect","naturalWidth","naturalHeight","Kinetic","decay","minVelocity","delay","decay_","minVelocity_","delay_","initialVelocity_","update","Date","now","lastIndex","firstIndex","duration","MapEvent","opt_frameState","MapBrowserEvent","browserEvent","opt_dragging","originalEvent","pixel","getEventPixel","getCoordinateFromPixel","dragging","SINGLECLICK","CLICK","DBLCLICK","POINTERDRAG","POINTERMOVE","POINTERDOWN","POINTERUP","POINTEROVER","POINTEROUT","POINTERENTER","POINTERLEAVE","POINTERCANCEL","MapBrowserPointerEvent","pointerEvent","EventSource","dispatcher","mapping","mapping_","getEvents","getHandlerForEvent","MouseSource","mousedown","mousemove","mouseup","mouseover","mouseout","pointerMap","lastTouches","prepareEvent","inEvent","cloneEvent","pd","pointerId","isPrimary","pointerType","isEventSimulatedFromTouch_","lts","clientX","clientY","cancel","down","move","p","button","up","cleanupMouse","enterOver","leaveOut","MsSource","MSPointerDown","msPointerDown","MSPointerMove","msPointerMove","MSPointerUp","msPointerUp","MSPointerOut","msPointerOut","MSPointerOver","msPointerOver","MSPointerCancel","msPointerCancel","MSGotPointerCapture","msGotPointerCapture","MSLostPointerCapture","msLostPointerCapture","POINTER_TYPES","prepareEvent_","cleanup","makeEvent","NativeSource","pointerdown","pointerDown","pointermove","pointerMove","pointerup","pointerUp","pointerout","pointerOut","pointerover","pointerOver","pointercancel","pointerCancel","gotpointercapture","gotPointerCapture","lostpointercapture","lostPointerCapture","fireNativeEvent","PointerEvent","opt_eventDict","eventDict","buttons","getButtons_","pressure","getPressure_","bubbles","cancelable","view","detail","screenX","screenY","ctrlKey","altKey","shiftKey","metaKey","relatedTarget","tiltX","tiltY","hwTimestamp","HAS_BUTTONS","which","ev","MouseEvent","TouchSource","mouseSource","touchstart","touchmove","touchend","touchcancel","firstTouchId_","clickCount_","resetId_","dedupTimeout_","isPrimaryTouch_","inTouch","identifier","setPrimaryTouch_","count","cancelResetClickCount_","removePrimaryPointer_","inPointer","resetClickCount_","setTimeout","resetClickCountHandler_","clearTimeout","touchToPointer_","webkitRadiusX","radiusX","webkitRadiusY","radiusY","webkitForce","force","processTouches_","inFunction","touches","changedTouches","pointer","findTouch_","touchList","searchId","vacuumTouches_","out","cancelOut_","dedupSynthMouse_","overDown_","outTarget","over","enter","moveOverOut_","outEvent","upOut_","leave","cleanUpPointer_","lt","PointerEventHandler","element_","eventMap_","eventSourceList_","registerSources","CLONE_PROPS","registerSource","register_","newEvents","handler","eventSource","addEvents_","unregister_","removeEvents_","eventHandler_","events","eventName","eventCopy","fireEvent","PointerEventType","contains_","container","contained","contains","inType","wrapMouseEvent","MapBrowserEventHandler","moveTolerance","clickTimeoutId_","dragging_","dragListenerKeys_","moveTolerance_","down_","getViewport","activePointers_","trackedTouches_","pointerEventHandler_","documentPointerEventHandler_","pointerdownListenerKey_","handlePointerDown_","relayedListenerKey_","relayEvent_","emulateClick_","newEvent","MapBrowserEventType","updateActivePointers_","handlePointerUp_","isMouseActionButton_","handlePointerMove_","isMoving_","PriorityQueue","priorityFunction","keyFunction","priorityFunction_","keyFunction_","elements_","priorities_","queuedElements_","dequeue","elements","priorities","siftUp_","elementKey","enqueue","priority","siftDown_","getLeftChildIndex_","getRightChildIndex_","getParentIndex_","heapify_","isKeyQueued","isQueued","startIndex","lIndex","rIndex","smallerChildIndex","parentIndex","reprioritize","TileQueue","tilePriorityFunction","tileChangeCallback","tileChangeCallback_","tilesLoading_","tilesLoadingKeys_","added","handleTileChange","getTilesLoading","tileKey","loadMoreTiles","maxTotalLoading","maxNewLoads","newLoads","abortedTiles","DEFAULT_MAX_ZOOM","DEFAULT_TILE_SIZE","none","disable","View","hints_","animations_","updateAnimationKey_","updateAnimations_","applyOptions_","isNoopAnimation","animation","sourceCenter","targetCenter","coordinatesEqual","sourceResolution","targetResolution","sourceRotation","targetRotation","ViewProperty","resolutionConstraintInfo","resolutionConstraint","maxResolution","minResolution","minZoom","maxZoom","zoomFactor","resolutions","z","power","defaultMaxResolution","defaultMinResolution","defaultMaxZoom","opt_maxLevel","oldLevel","newLevel","constraint","createResolutionConstraint","maxResolution_","minResolution_","zoomFactor_","resolutions_","minZoom_","centerConstraint","centerNone","rotationConstraint","enableRotation","constrainRotation","opt_tolerance","rotationNone","theta","createRotationConstraint","constraints_","zoom","constrainResolution","options_","getUpdatedOptions_","newOptions","getZoom","animate","var_args","animationCount","isDef","setCenter","setZoom","series","complete","easing","setHint","ViewHint","getAnimating","getInteracting","cancelAnimations","cancelAnimationFrame","more","seriesComplete","elapsed","progress","calculateCenterZoom","calculateCenterRotate","filter","Boolean","requestAnimationFrame","currentCenter","rotateCoordinate","addCoordinate","currentResolution","getSizeFromViewport_","selector","querySelector","metrics","constrainCenter","opt_delta","opt_direction","getConstraints","getHints","opt_hints","calculateExtent","opt_size","getMaxResolution","getMinResolution","getMaxZoom","getZoomForResolution","setMaxZoom","getMinZoom","setMinZoom","getResolutions","getResolutionForExtent","xResolution","yResolution","getResolutionForValueFunction","opt_power","getValueForResolutionFunction","nearest","getResolutionForZoom","fit","geometryOrExtent","polygonFromExtent","minRotX","minRotY","maxRotX","maxRotY","rotX","rotY","constrainedResolution","centerRotX","centerRotY","setResolution","centerOn","centerX","centerY","hint","BaseLayer","LayerProperty","visible","state_","layer","managed","getLayerState","sourceState","getSourceState","getVisible","getLayersArray","getLayerStatesArray","opt_states","setMaxResolution","setMinResolution","setVisible","zindex","LayerGroup","baseOptions","layers","layersListenerKeys_","listenerKeys_","handleLayersChanged_","setLayers","num","ratio","toSize","handleLayerChange_","getLayers","handleLayersAdd_","handleLayersRemove_","layersArray","collectionEvent","states","pos","ownLayerState","layerState","SourceState","PluggableMap","optionsInternal","keyboardEventTarget","getElementById","controls","interactions","overlays","layerGroup","MapProperty","createOptionsInternal","maxTilesLoading_","maxTilesLoading","loadTilesWhileAnimating_","loadTilesWhileAnimating","loadTilesWhileInteracting_","loadTilesWhileInteracting","animationDelayKey_","animationDelay_","renderFrame_","coordinateToPixelTransform_","pixelToCoordinateTransform_","frameIndex_","frameState_","previousExtent_","viewPropertyListenerKey_","viewChangeListenerKey_","layerGroupPropertyListenerKeys_","viewport_","className","msTouchAction","touchAction","overlayContainer_","overlayContainerStopEvent_","overlayEvents","mapBrowserEventHandler_","handleMapBrowserEvent","keyboardEventTarget_","keyHandlerKeys_","handleBrowserEvent","overlays_","overlayIdIndex_","createRenderer","handleResize_","focus_","postRenderFunctions_","tileQueue_","getTilePriority","handleTileChange_","skippedFeatureUids_","handleLayerGroupChanged_","handleViewChanged_","handleSizeChanged_","handleTargetChanged_","control","interaction","addOverlayInternal_","addControl","getControls","addInteraction","getInteractions","addLayer","getLayerGroup","addOverlay","overlay","getOverlays","setTarget","forEachFeatureAtPixel","hitTolerance","layerFilter","forEachFeatureAtCoordinate","getFeaturesAtPixel","features","forEachLayerAtPixel","hasFeatureAtPixel","hasFeatureAtCoordinate","getEventCoordinate","viewportPosition","getBoundingClientRect","eventPosition","top","getTarget","getTargetElement","pixelToCoordinateTransform","getOverlayById","getPixelFromCoordinate","coordinateToPixelTransform","getView","getOverlayContainer","getOverlayContainerStopEvent","tileSourceKey","tileCenter","tileResolution","wantedTiles","focus","mapBrowserEvent","interactionsArray","getActive","handleEvent","handlePostRender","tileQueue","hints","viewHints","postRenderFunctions","targetElement","updateSize","removeLayerRenderers","handleViewPropertyChanged_","setAttribute","isRendered","renderSync","removeControl","removeInteraction","removeLayer","removeOverlay","previousFrameState","layerStatesArray","layerStates","pixelResolution","skippedFeatureUids","usedTiles","renderFrame","MapEventType","setLayerGroup","setView","skipFeature","featureUid","computedStyle","offsetWidth","parseFloat","unskipFeature","Control","target_","listenerKeys","Layer","mapPrecomposeKey_","mapRenderKey_","sourceChangeKey_","handleSourcePropertyChange_","setSource","visibleAtResolution","getSource","handleSourceChange_","Attribution","ulElement_","collapsed_","collapsed","collapsible_","collapsible","tipLabel","collapseLabel","collapseLabel_","label","label_","activeLabel","title","handleClick_","cssClasses","renderedAttributions_","renderedVisible_","mapEvent","updateElement_","getSourceAttributions_","lookup","visibleAttributions","attributionGetter","getAttributions","attributions","display","innerHTML","handleToggle_","classList","toggle","getCollapsible","setCollapsible","setCollapsed","getCollapsed","Rotate","callResetNorth_","resetNorth","duration_","autoHide_","autoHide","msTransform","webkitTransform","resetNorth_","Zoom","zoomInLabel","zoomOutLabel","zoomInTipLabel","zoomOutTipLabel","inElement","createTextNode","outElement","defaults","zoomOptions","rotateOptions","attribution","attributionOptions","zoomByDelta_","newResolution","Interaction","setActive","opt_duration","rotateWithoutConstraints","currentRotation","zoomWithoutConstraints","zoomByDelta","InteractionProperty","active","DoubleClickZoom","delta_","stopEvent","altKeyOnly","altShiftKeysOnly","always","mouseActionButton","never","singleClick","noModifierKeys","shiftKeyOnly","targetNotEditable","tagName","mouseOnly","primaryAction","handleDragEvent","handleUpEvent","handleDownEvent","handleMoveEvent","PointerInteraction","handleDownEvent_","handleDragEvent_","handleMoveEvent_","handleUpEvent_","handlingDownUpSequence","trackedPointers_","targetPointers","centroid","pointerEvents","updateTrackedPointers_","handledUp","handled","shouldStopEvent","DragPan","kinetic_","kinetic","lastCentroid","lastPointersCount_","condition_","condition","noKinetic_","centroidFromPointers","scaleCoordinate","centerpx","DragRotate","lastAngle_","RenderBox","startPixel_","endPixel_","startPixel","endPixel","setPixels","createOrUpdateGeometry","DragBoxEventType","DragBoxEvent","DragBox","box_","minArea_","minArea","boxEndCondition_","boxEndCondition","defaultBoxEndCondition","onBoxEnd","DragZoom","out_","mapExtent","boxPixelExtent","KeyboardPan","defaultCondition_","pixelDelta_","pixelDelta","keyCode","KeyCode","mapUnitsDelta","pan","KeyboardZoom","charCode","charCodeAt","Mode","MouseWheelZoom","timeout_","timeout","useAnchor_","useAnchor","constrainResolution_","lastAnchor_","startTime_","timeoutId_","mode_","trackpadEventGap_","trackpadTimeoutId_","trackpadDeltaPerZoom_","trackpadZoomBuffer_","wheelEvent","deltaMode","WheelEvent","DOM_DELTA_PIXEL","DOM_DELTA_LINE","wheelDeltaY","decrementInteractingHint_","rebound","timeLeft","handleWheelZoom_","setMouseAnchor","PinchRotate","rotating_","rotationDelta_","threshold_","threshold","rotationDelta","touch0","touch1","PinchZoom","lastDistance_","lastScaleDelta_","scaleDelta","DragAndDropEventType","DragAndDropEvent","file","opt_features","opt_projection","DragAndDrop","formatConstructors_","formatConstructors","dropListenKeys_","source_","handleDrop","files","dataTransfer","reader","FileReader","handleResult_","readAsText","handleStop","dropEffect","result","tryReadFeatures_","featureProjection","addFeatures","registerListeners_","dropArea","unregisterListeners_","readFeatures","DragRotateAndZoom","lastMagnitude_","magnitude","angleDelta","Circle","setCenterAndRadius","getRadiusSquared_","MultiLineString","appendLineString","multiLineString","opt_interpolate","lineStringsCoordinateAtM","getLineString","getLineStrings","lineStrings","getFlatMidpoints","midpoints","douglasPeuckerArray","simplifiedMultiLineString","intersectsLineStringArray","setLineStrings","MultiPoint","linearRingss","appendPoint","multiPoint","getPoint","MultiPolygon","endss_","flatInteriorPointsRevision_","flatInteriorPoints_","appendPolygon","multiPolygon","newEndss","multiArrayMaxSquaredDelta","assignClosestMultiArrayPoint","linearRingssContainsXY","linearRingssArea","getEndss","getFlatInteriorPoints","linearRingssCenter","getInteriorPoints","linearRingsAreOriented","simplifiedEndss","quantizeMultiArray","simplifiedMultiPolygon","getPolygon","prevEnds","getPolygons","polygons","intersectsLinearRingMultiArray","opt_endss","deflateMultiCoordinatesArray","lastEnds","setPolygons","IMAGE","TILE","VECTOR_TILE","VECTOR","VectorLayer","renderBuffer","updateWhileAnimating","updateWhileInteracting","declutter_","declutter","renderBuffer_","updateWhileAnimating_","updateWhileInteracting_","renderMode_","renderMode","VectorRenderType","LayerType","getDeclutter","setDeclutter","getRenderBuffer","getRenderOrder","getUpdateWhileAnimating","getUpdateWhileInteracting","setRenderOrder","renderOrder","styleFunction","getRenderMode","JSON","TEXT","XML","loadFeaturesXhr","url","success","failure","xhr","XMLHttpRequest","open","FormatType","responseType","onload","status","responseText","responseXML","DOMParser","parseFromString","readProjection","getLastExtent","onerror","send","dataProjection","all","Source","attributions_","adaptAttributions_","wrapX_","wrapX","attributionLike","getWrapX","refresh","setAttributions","module","swap","defaultCompare","compare","quickselectStep","sd","newLeft","newRight","factory","rbush","maxEntries","_maxEntries","_minEntries","_initFormat","findItem","items","equalsFn","calcBBox","toBBox","distBBox","children","destNode","createNode","child","leaf","compareNodeMinX","compareNodeMinY","bboxArea","bboxMargin","multiSelect","quickselect","_all","search","bbox","childBBox","nodesToSearch","collides","insert","_build","_splitRoot","tmpNode","_insert","goingUp","indexes","_condense","compareMinX","compareMinY","toJSON","fromJSON","N","M","right2","right3","N2","N1","_chooseSubtree","level","targetNode","enlargement","minEnlargement","isNode","insertPath","_split","_adjustParentBBoxes","_chooseSplitAxis","splitIndex","_chooseSplitIndex","bbox1","bbox2","overlap","minOverlap","_allDistMargin","leftBBox","rightBBox","siblings","compareArr","Function","RBush","opt_maxEntries","rbush_","items_","extents","uid","getAll","getInExtent","forEach_","forEachInExtent","VectorSourceEvent","opt_feature","VectorSource","loader_","format_","overlaps_","overlaps","url_","loader","strategy_","strategy","allStrategy","collection","useSpatialIndex","featuresRtree_","loadedExtentsRtree_","nullGeometryFeatures_","idIndex_","undefIdIndex_","featureChangeKeys_","featuresCollection_","addFeaturesInternal","bindFeaturesCollection_","addFeature","addFeatureInternal","featureKey","addToIndex_","setupChangeEvents_","VectorEventType","handleFeatureChange_","valid","newFeatures","geometryFeatures","modifyingCollection","removeFeature","opt_fast","featureId","removeFeatureInternal","clearEvent","forEachFeature","forEachFeatureAtCoordinateDirect","forEachFeatureInExtent","forEachFeatureIntersectingExtent","getFeaturesCollection","getFeatures","getFeaturesAtCoordinate","getFeaturesInExtent","getClosestFeatureToCoordinate","opt_filter","closestFeature","previousMinSquaredDistance","minDistance","getFeatureById","getFormat","getOverlaps","getUrl","sid","removeFromIdIndex_","hasFeature","loadFeatures","loadedExtentsRtree","extentsToLoad","extentToLoad","removeLoadedExtent","removed","setLoader","DrawEventType","DrawEvent","Draw","shouldHandle_","downPx_","downTimeout_","lastDragTime_","freehand_","features_","snapTolerance_","snapTolerance","type_","mode","getMode","stopClick_","stopClick","minPoints_","minPoints","maxPoints_","maxPoints","finishCondition_","finishCondition","geometryFunction","opt_geometry","squaredLength","squaredCoordinateDistance","Constructor","dragVertexDelay_","dragVertexDelay","finishCoordinate_","sketchFeature_","sketchPoint_","sketchCoords_","sketchLine_","sketchLineCoords_","squaredClickTolerance_","clickTolerance","overlay_","geometryName","freehandCondition_","freehand","freehandCondition","updateState_","pass","addToDrawing_","handlePointerEvent","startDrawing_","circleMode","finishDrawing","atFinish_","abortDrawing_","downPx","clickPx","modifyDrawing_","createOrUpdateSketchPoint_","at","potentiallyDone","potentiallyFinishCoordinates","finishCoordinate","finishPixel","updateSketchFeatures_","ring","removeLastPoint","sketchFeature","sketchFeatures","overlaySource","ExtentEventType","ExtentInteractionEvent","ExtentInteraction","pointerHandler_","pixelTolerance_","pixelTolerance","snappedToVertex_","extentFeature_","vertexFeature_","extentOverlay_","boxStyle","vertexOverlay_","pointerStyle","vertex","snapToVertex_","getOpposingPoint","x_","y_","getPointHandler","getEdgeHandler","pixelCoordinate","createOrUpdatePointerFeature_","fixedPoint","fixedP1","fixedP2","segments","closestSegment","vertexPixel","coordinateDistance","pixel1","pixel2","squaredDist1","squaredDist2","dist","createOrUpdateExtentFeature_","extentFeature","vertexFeature","ModifyEventType","ModifyEvent","mapBrowserPointerEvent","Modify","defaultDeleteCondition_","deleteCondition_","deleteCondition","insertVertexCondition_","insertVertexCondition","vertexSegments_","lastPixel_","ignoreNextSingleClick_","modified_","rBush_","changingFeature_","dragSegments_","SEGMENT_WRITERS_","writePointGeometry_","writeLineStringGeometry_","writePolygonGeometry_","writeMultiPointGeometry_","writeMultiLineStringGeometry_","writeMultiPolygonGeometry_","writeCircleGeometry_","GeometryCollection","writeGeometryCollectionGeometry_","handleSourceAdd_","handleSourceRemove_","addFeature_","handleFeatureAdd_","handleFeatureRemove_","lastPointerEvent_","CIRCLE_CENTER_INDEX","CIRCLE_CIRCUMFERENCE_INDEX","compareIndexes","handlePointerAtPixel_","insertVertices","vertexExtent","segmentDataMatches","componentSegments","segmentDataMatch","depth","closestOnSegmentData","willModifyFeatures_","insertVertex_","dragSegment","segmentData","setGeometryCoordinates_","createOrUpdateVertexFeature_","centerSegmentData","featureSegments","circumferenceSegmentData","removePoint","pointDistanceToSegmentDataSquared","pointCoordinates","circleGeometry","distanceToCenterSquared","distanceToCircumference","removeFeature_","removeFeatureSegmentData_","rBush","nodesToRemove","lines","rings","kk","geometries","getGeometriesArray","box","nodes","vertexSegments","rTree","updateSegmentIndices_","newSegmentData","newSegmentData2","removeVertex_","component","newIndex","dragSegments","segmentsByFeature","deleted","SelectEventType","SelectEvent","selected","deselected","Select","addCondition_","addCondition","removeCondition_","removeCondition","toggleCondition_","toggleCondition","multi_","multi","filter_","hitTolerance_","featureOverlay","featureOverlay_","layerFilter_","featureLayerAssociation_","addFeatureLayerAssociation_","removeFeatureLayerAssociation_","getHitTolerance","getLayer","setHitTolerance","currentMap","selectedFeatures","Snap","vertex_","edge_","featuresListenerKeys_","featureChangeListenerKeys_","indexedFeaturesExtents_","pendingFeatures_","pixelCoordinate_","sortByDistance_","deltaA","deltaB","snapTo","snapped","featuresToUpdate","updateFeature_","opt_listen","register","feature_uid","segmentWriter","forEachFeatureAdd_","forEachFeatureRemove_","getFeatures_","opt_unlisten","unregister","isCircle","closestOnCircle","TranslateEventType","TranslateEvent","Translate","lastCoordinate_","lastFeature_","handleActiveChanged_","featuresAtPixel_","newCoordinate","altShiftDragRotate","doubleClickZoom","zoomDelta","zoomDuration","dragPan","pinchRotate","pinchZoom","keyboard","mouseWheelZoom","shiftDragZoom","oldMap","ImageCanvas","opt_loader","error_","getError","handleLoad_","err","RenderEvent","opt_vectorContext","opt_context","opt_glContext","glContext","VectorContext","drawCustom","drawCircle","drawFeature","drawGeometryCollection","geometryCollectionGeometry","drawLineString","lineStringGeometry","drawMultiLineString","multiLineStringGeometry","drawMultiPoint","multiPointGeometry","drawMultiPolygon","multiPolygonGeometry","drawPoint","pointGeometry","drawPolygon","polygonGeometry","drawText","setImageStyle","imageStyle","opt_declutterGroup","textStyle","CanvasImmediateRenderer","viewRotation","context_","viewRotation_","contextFillState_","contextStrokeState_","contextTextState_","fillState_","strokeState_","imageAnchorX_","imageAnchorY_","imageHeight_","imageOpacity_","imageOriginX_","imageOriginY_","imageRotateWithView_","imageRotation_","imageScale_","imageSnapToPixel_","imageWidth_","textOffsetX_","textOffsetY_","textRotateWithView_","textRotation_","textScale_","textFillState_","textStrokeState_","textState_","pixelCoordinates_","tmpLocalTransform_","drawImages_","pixelCoordinates","localTransform","drawText_","setContextFillState_","setContextStrokeState_","setContextTextState_","strokeText","fillText","moveToLineTo_","close","moveTo","drawRings_","simpleGeometry","transformGeom2D","flatMidpoint","geometryExtent","flatMidpoints","flatInteriorPoint","flatInteriorPoints","fillState","contextFillState","strokeState","contextStrokeState","textState","contextTextState","fillStyleColor","strokeStyleColor","strokeStyleLineCap","strokeStyleLineDash","strokeStyleLineDashOffset","strokeStyleLineJoin","strokeStyleWidth","strokeStyleMiterLimit","imageAnchor","imageImage","imageOrigin","textFillStyle","textFillStyleColor","textStrokeStyle","textStrokeStyleColor","textStrokeStyleLineCap","textStrokeStyleLineDash","textStrokeStyleLineDashOffset","textStrokeStyleLineJoin","textStrokeStyleWidth","textStrokeStyleMiterLimit","textFont","textOffsetX","textOffsetY","textRotateWithView","textRotation","textScale","textText","textTextAlign","textTextBaseline","IconImageCache","cache_","cacheSize_","maxCacheSize_","expire","iconImage","maxCacheSize","shared","MapRenderer","layerRenderers_","layerRendererListeners_","layerRendererConstructors_","expireIconCache","iconImageCache","sortByZIndex","state1","state2","registerLayerRenderers","constructors","getLayerRendererConstructors","calculateMatrices2D","invertTransform","transformSetFromArray","removeLayerRendererByKey_","thisArg2","viewResolution","translatedCoordinate","projectionExtent","worldWidth","layerRenderer","getLayerRenderer","layerKey","candidate","handleLayerRendererChange_","getLayerRendererByKey","getLayerRenderers","removeUnusedLayerRenderers_","scheduleExpireIconCache","scheduleRemoveUnusedLayerRenderers","layerRendererConstructors","CanvasMapRenderer","insertBefore","childNodes","dispatchComposeEvent_","composeEvent","clearRect","save","prepareFrame","composeFrame","restore","numLayers","forEachLayerAtCoordinate","ctor","LayerRenderer","layer_","createLoadedTileFinder","tiles","tileRange","forEachLoadedTile","handleImageChange_","renderIfReadyAndVisible","loadImage","imageState","scheduleExpireCache","tileSource","postRenderFunction","expireCache","updateUsedTiles","zKey","manageTilePyramid","currentZ","preload","opt_tileCallback","getTileRangeForExtentAndZ","getTile","getTileCoordCenter","useTile","CanvasLayerRenderer","renderedResolution","clip","topLeft","topRight","bottomRight","bottomLeft","opt_transform","postCompose","preCompose","dispatchRenderEvent","IntermediateCanvasRenderer","coordinateToCanvasPixelTransform","hitCanvasContext_","clipped","imageTransform","getImageTransform","dw","dh","imageData","getImageData","CanvasImageLayerRenderer","imageLayer","imageTransform_","skippedFeatures_","vectorRenderer_","mapRenderer","viewCenter","imageSource","vectorRenderer","renderedExtent","skippedFeatures","imageFrameState","newSkippedFeatures","replayGroupChanged","imageExtent","imageResolution","imagePixelRatio","TileRange","containsTileRange","CanvasTileLayerRenderer","tileLayer","oversampling_","renderedExtent_","renderedRevision","renderedTiles","newTiles_","tmpExtent","tmpTileRange_","zDirection","isDrawableTile_","tileState","useInterimTilesOnError","getUseInterimTilesOnError","getPreload","sourceRevision","getTileGridForProjection","getZForResolution","oversampling","getTileRangeExtent","tilePixelRatio","getTilePixelRatio","tilesToDrawByZ","findLoadedTiles","animatingOrInteracting","tmpTileRange","childTileRange","getTileCoordChildTileRange","covered","forEachTileCoordParentTileRange","tilePixelSize","getTilePixelSize","currentScale","currentTilePixelSize","tileExtent","tileGutter","tilesToDraw","zs","tileCoordKey","getGutter","getTileCoordExtent","drawTileImage","gutter","getOpaque","alphaChanged","ReplayGroup","getReplay","replayType","DEFAULT","drawTextOnPath","measure","startM","previousAngle","reverse","numChars","segmentM","chunk","chunkLength","char","charLength","charM","segmentPos","unshift","Instruction","fillInstruction","strokeInstruction","beginPathInstruction","closePathInstruction","ORDER","ReplayType","TEXT_ALIGN","middle","hanging","alphabetic","ideographic","bottom","CanvasReplay","maxExtent","declutterTree","maxLineWidth","alignFill_","beginGeometryInstruction1_","beginGeometryInstruction2_","bufferedMaxExtent_","instructions","coordinateCache_","renderedTransform_","hitDetectionInstructions","replayTextBackground_","p3","p4","setStrokeStyle_","replayImage_","declutterGroup","fillStroke","boxW","boxH","boxX","boxY","strokePadding","declutterArgs","applyPixelRatio","dashArray","dash","appendFlatCoordinates","closed","skipFirst","myEnd","getBufferedMaxExtent","lastRel","nextRel","lastCoord","nextCoord","skipped","drawCustomCoordinates_","replayEnds","replayEnd","beginGeometry","replayEndss","replayBegin","myEnds","CanvasInstruction","endGeometry","origin","repeatSize","instruction","renderDeclutter_","groupCount","declutterData","replay_","skippedFeaturesHash","featureCallback","opt_hitExtent","dd","prevX","prevY","roundX","roundY","skipFeatures","pendingFill","pendingStroke","lastFillInstruction","lastStrokeInstruction","coordinateCache","batchSize","fn","baseline","fillKey","strokeKey","textKey","pathLength","textLength","textStates","parts","cc","chars","part","replay","replayHitDetection","opt_featureCallback","reverseHitDetectionInstructions","createFill","applyStroke","createStroke","updateFillStyle","currentFillStyle","updateStrokeStyle","currentStrokeStyle","currentLineCap","currentLineDash","currentLineDashOffset","currentLineJoin","currentLineWidth","currentMiterLimit","endGeometryInstruction","finish","CanvasImageReplay","declutterGroup_","hitDetectionImage_","anchorX_","anchorY_","height_","originX_","originY_","drawCoordinates_","myBegin","hitDetectionImage","CanvasLineStringReplay","drawFlatCoordinates_","moveToLineToInstruction","lastStroke","CanvasPolygonReplay","matchingChunk","m12","m23","x12","y12","x23","y23","chunkStart","chunkEnd","chunkM","acos","drawFlatCoordinatess_","numEnds","setFillStrokeStyles_","circleInstruction","CanvasTextReplay","labels_","fillStates","strokeStates","textKey_","fillKey_","strokeKey_","widths_","geometryType","flatEnd","flatOffset","oo","range","drawChars_","drawTextImage_","align","numLines","widths","currentWidth","measureTextWidths","lineHeight","renderWidth","leftRight","BATCH_CONSTRUCTORS","Default","CanvasReplayGroup","opt_renderBuffer","declutterTree_","tolerance_","maxExtent_","resolution_","replaysByZIndex_","hitDetectionContext_","hitDetectionTransform_","circleArrayCache","0","fillCircleArrayRowToMiddle","addDeclutter","group","flatClipCoords","getClipCoords","hasReplays","replays","candidates","replayKey","declutterReplays","hitExtent","contextSize","declutteredFeatures","mask","arraySize","getCircleArray","zIndexKey","getReplays","opt_replayTypes","opt_declutterReplays","replayTypes","SIMPLIFY_TOLERANCE","GEOMETRY_RENDERERS","replayGroup","imageReplay","textReplay","lineStringReplay","polygonReplay","geometryRenderer","circleReplay","defaultOrder","feature1","feature2","getSquaredTolerance","getTolerance","renderFeature","loading","renderGeometry","getGeometries","renderFeatureInternal","CanvasVectorLayerRenderer","vectorLayer","dirty_","renderedRevision_","renderedResolution_","renderedRenderOrder_","replayGroup_","handleFontsChanged_","vectorSource","clipExtent","replayContext","drawOffsetX","drawOffsetY","transparentLayer","hasRenderListeners","drawWidth","drawHeight","drawSize","world","mainContextAlpha","handleStyleImageChange_","animating","interacting","frameStateExtent","vectorLayerRevision","vectorLayerRenderBuffer","vectorLayerRenderOrder","defaultRenderOrder","getRenderTolerance","dirty","getSquaredRenderTolerance","IMAGE_REPLAYS","hybrid","VECTOR_REPLAYS","vector","CanvasVectorTileLayerRenderer","renderedLayerRevision_","tmpTransform_","VectorTileRenderType","createReplayGroup_","renderTileImage_","layerRevision","revision","replayState","getReplayState","renderedRenderOrder","sourceTileGrid","getTileGrid","sourceTile","tileKeys","sourceTileCoord","sourceTileExtent","sharedExtent","bufferedExtent","tileProjection","reproject","setReplayGroup","tt","getReplayGroup","getReplayTransform_","renderResolution","clips","worldOffset","currentClip","zz","replayData","replayDeclutter","renderedTileRevision","wrappedTileCoord","pixelScale","scaleTransform","translateTransform","Map","defaultControls","defaultInteractions","Overlay","insertFirst","autoPan","autoPanAnimation","autoPanMargin","rendered","bottom_","left_","right_","top_","mapPostrenderListenerKey","handleElementChanged","handleMapChanged","handleOffsetChanged","handlePositionChanged","handlePositioningChanged","setElement","setOffset","setPositioning","positioning","OverlayPositioning","setPosition","getElement","getOffset","getPositioning","updatePixelPosition","panIntoView","mapRect","getRect","overlayRect","marginLeft","marginRight","marginTop","marginBottom","offsetLeft","offsetRight","offsetTop","offsetBottom","centerPx","newCenterPx","pageXOffset","pageYOffset","mapSize","updateRenderedPosition","getOptions","VectorTile","consumers","replayGroups_","DEFAULT_EXTENT","onLoad","setFeatures","onError","changeType","getChangeType","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","requestFullscreen","FullScreen","cssClassName_","labelNode_","labelActive","labelActiveNode_","isFullScreen","isFullScreenSupported","keys_","mozFullScreenEnabled","msFullscreenEnabled","fullscreenEnabled","webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullscreenElement","requestFullScreen","handleFullScreen_","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","mozRequestFullScreenWithKeys","Element","ALLOW_KEYBOARD_INPUT","handleFullScreenChange_","firstElementChild","OverviewMap","ovmapDiv_","ovmap_","ovmap","boxSizing","boxOverlay_","scope","overlayBox","mousePosition","endMoving","validateExtent_","updateBox_","oldView","unbindView_","handleMapPropertyChange_","bindView_","resetExtent_","newView","handleRotationChanged_","ovmapSize","ovextent","topLeftPixel","bottomRightPixel","boxWidth","boxHeight","ovmapWidth","ovmapHeight","recenter_","ovview","steps","MAX_RATIO","LN2","ovresolution","rotateBottomLeft","calculateCoordinateRotate_","coordinateRotate","getOverviewMap","UNITS_PROP","LEADING_DIGITS","ScaleLine","innerElement_","viewState_","minWidth_","minWidth","renderedWidth_","renderedHTML_","handleUnitsChanged_","setUnits","pointResolutionUnits","ProjUnits","nominalCount","suffix","metersPerDegree","html","Direction","ZoomSlider","currentResolution_","direction_","heightLimit_","widthLimit_","previousX_","previousY_","thumbSize_","sliderInitialized_","thumbElement","containerElement","dragger_","handleDraggerStart_","handleDraggerDrag_","handleDraggerEnd_","handleContainerClick_","initSlider_","res","setThumbPosition_","containerSize","thumb","thumbWidth","thumbHeight","relativePosition","getRelativePosition_","getResolutionForPosition_","getPositionForResolution_","ZoomToExtent","handleZoomToExtent","WebGLShader","isAnimated","WebGLFragment","WebGLVertex","fragment","Locations","program","u_projectionMatrix","getUniformLocation","u_offsetScaleMatrix","u_offsetRotateMatrix","u_lineWidth","u_pixelRatio","u_opacity","u_fillColor","u_strokeColor","u_size","a_position","getAttribLocation","a_instruction","a_radius","fromTransform","mat4","WebGLReplay","projectionMatrix_","offsetRotateMatrix_","offsetScaleMatrix_","tmpMat4_","indices","indicesBuffer","startIndices","startIndicesFeature","verticesBuffer","getDeleteResourcesFunction","setUpProgram","shutDownProgram","locations","drawReplay","hitDetection","drawHitDetectionReplayOneByOne","drawHitDetectionReplay","oneByOne","drawHitDetectionReplayAll","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","tmpStencil","tmpStencilFunc","tmpStencilMaskVal","tmpStencilRef","tmpStencilMask","tmpStencilOpFail","tmpStencilOpPass","tmpStencilOpZFail","getGL","isEnabled","STENCIL_TEST","STENCIL_FUNC","STENCIL_VALUE_MASK","STENCIL_REF","STENCIL_WRITEMASK","STENCIL_FAIL","STENCIL_PASS_DEPTH_PASS","STENCIL_PASS_DEPTH_FAIL","enable","STENCIL_BUFFER_BIT","stencilMask","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","NOTEQUAL","bindBuffer","projectionMatrix","rotateTransform","offsetScaleMatrix","offsetRotateMatrix","uniformMatrix4fv","uniform1f","drawElements","elementType","hasOESElementIndexUint","numItems","offsetInBytes","DEFAULT_FILLSTYLE","DEFAULT_LINEDASH","DEFAULT_STROKESTYLE","EPSILON","triangleIsCounterClockwise","BufferUsage","WebGLBuffer","opt_arr","opt_usage","arr_","usage_","getUsage","WebGLCircleReplay","defaultLocations_","styles_","styleIndices_","fillColor","strokeColor","numVertices","numIndices","lastState","deleteBuffer","getProgram","useProgram","enableVertexAttribArray","vertexAttribPointer","uniform2fv","disableVertexAttribArray","nextStyle","setFillStyle_","drawReplaySkipping_","groupStart","featureIndex","featureStart","uniform4fv","u_image","a_texCoord","a_offsets","a_opacity","a_rotateWithView","WebGLContext","gl_","bufferCache_","shaderCache_","programCache_","currentProgram_","hitDetectionFramebuffer_","hitDetectionTexture_","hitDetectionRenderbuffer_","WEBGL_EXTENSIONS","getExtension","ContextEventType","handleWebGLContextLost","handleWebGLContextRestored","createTextureInternal","opt_wrapS","opt_wrapT","texture","createTexture","bindTexture","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","createEmptyTexture","texImage2D","RGBA","UNSIGNED_BYTE","buf","bufferKey","String","bufferCacheEntry","arrayBuffer","createBuffer","Float32Array","Uint32Array","Uint16Array","bufferData","isContextLost","deleteProgram","deleteShader","deleteFramebuffer","deleteRenderbuffer","deleteTexture","getCanvas","getHitDetectionFramebuffer","initHitDetectionFramebuffer_","getShader","shaderObject","shaderKey","shader","createShader","shaderSource","compileShader","fragmentShaderObject","vertexShaderObject","programKey","createProgram","attachShader","linkProgram","framebuffer","createFramebuffer","bindFramebuffer","renderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","WebGLTextureReplay","groupIndices","hitDetectionGroupIndices","imageHeight","imageWidth","defaultLocations","textures","getTextures","drawCoordinates","createTextures","images","texturePerImage","getHitDetectionTextures","drawReplaySkipping","groupEnd","hitDetectionTextures","opt_all","WebGLImageReplay","images_","hitDetectionImages_","textures_","hitDetectionTextures_","lineStringIsClosed","u_miterLimit","u_color","a_lastPos","a_nextPos","a_direction","WebGLLineStringReplay","startCoords","sign","p0","lastSign","addVertices_","product","isValid_","indexCount","drawPolygonCoordinates","holeFlatCoordinates","setPolygonStyle","opt_index","getCurrentIndex","tmpDepthFunc","DEPTH_FUNC","tmpDepthMask","DEPTH_WRITEMASK","DEPTH_TEST","depthMask","depthFunc","LinkedList","opt_circular","first_","last_","head_","circular_","length_","insertItem","next","head","removeItem","firstItem","lastItem","nextItem","getNextItem","prevItem","getPrevItem","getCurrItem","setFirstItem","list","WebGLPolygonReplay","outerRing","rtree","processFlatCoordinates_","maxCoords","getMaxCoords_","holeLists","holeList","classifyPoints_","currList","currItem","getIntersections_","bridgeHole_","triangulate_","clockwise","createPoint_","insertItem_","seg","ccw","s0","pointsReclassified","reflex","removeItem_","hole","holeMaxX","listMaxX","bestPoint","p5","minDist","intersectingSegments","currSeg","calculateIntersection_","pointsInTriangle","getPointsInTriangle_","currPoint","currTheta","p0Bridge","p1Bridge","simple","isSimple_","clipEars_","resolveSelfIntersections_","splitPolygon_","isClockwise_","s3","processedEars","variableCriterion","diagonalIsInside_","opt_touch","resolvedIntersections","breakCond","newPolygon","newRtree","opt_rtree","opt_reflex","segmentsInExtent","denom","ub","p1IsLeftOf","p1IsRightOf","p3IsLeftOf","p3IsRightOf","p1InCone","p3InCone","currIndex","currLineIndex","holes","holeFlatCoords","lineDeleter","nullStrokeStyle","Atlas","space","space_","emptyBlocks_","renderCallback","block","split_","newBlock1","newBlock2","deltaWidth","updateBlocks_","args","AtlasManager","currentSize_","initialSize","maxSize_","maxSize","WEBGL_MAX_TEXTURE_SIZE","atlases_","currentHitSize_","hitAtlases_","getInfo","getInfo_","hitInfo","mergeInfos_","atlases","opt_renderHitCallback","add_","renderHitCallback","isHitAtlas","atlas","WebGLTextReplay","measureCanvas_","currAtlas_","currX","currY","charArr","charInfo","glyphAtlas","textSize","getTextSize_","self","textHeight","str","sum","curr","addCharToAtlas_","reduce","mCtx","getAtlas_","params","hash","calculateHash_","HIT_DETECTION_SIZE","WebGLReplayGroup","functions","replayHitDetection_","Uint8Array","readPixels","WebGLImmediateRenderer","center_","imageStyle_","fillStyle_","textStyle_","u_texCoordMatrix","u_texture","WebGLLayerRenderer","arrayBuffer_","framebufferDimension","texCoordMatrix","uniform1i","getTexCoordMatrix","getProjectionMatrix","getTexture","drawArrays","WebGLImageLayerRenderer","hitTransformationMatrix_","createTexture_","imageElement","updateProjectionMatrix_","canvasWidth","canvasHeight","canvasExtentWidth","canvasExtentHeight","getHitTransformationMatrix_","pixelOnFrameBuffer","mapCoordTransform","projectionMatrixInv","multiplyTransform","WebGLMapRenderer","clipTileCanvasWidth_","clipTileCanvasHeight_","clipTileContext_","antialias","preserveDrawingBuffer","stencil","textureCache_","tileTextureQueue_","loadNextTileTexture_","tileSize","bindTileTexture","textureCacheFrameMarkerCount_","initializeGL_","magFilter","minFilter","textureCacheEntry","clipTileCanvas","clipTileContext","expireCache_","getTileTextureQueue","renderers","activeTexture","blendFuncSeparate","isTileTextureLoaded","layerStatesToDraw","clearColor","viewport","u_tileOffset","WebGLTileLayerRenderer","fragmentShader_","vertexShader_","locations_","renderArrayBuffer_","renderedTileRange_","renderedFramebufferExtent_","tmpSize_","loaded","framebufferExtent","getTileSize","tilePixelResolution","tileRangeSize","maxDimension","framebufferExtentDimension","allTilesLoaded","tileTextureQueue","pixelOnMapScaled","pixelOnFrameBufferScaled","WebGLVectorLayerRenderer","layerState_","SCISSOR_TEST","scissor","WebGLMap","PROJECTION","COORDINATE_FORMAT","MousePosition","coordinateFormat","setCoordinateFormat","undefinedHTML_","undefinedHTML","renderOnMouseOut_","mapProjection_","lastMouseMovePixel_","updateHTML_","getCoordinateFormat","handleMouseMove","handleMouseOut","FeatureFormat","defaultFeatureProjection","transformWithOptions","write","transformed","decimals","getReadOptions","adaptOptions","readFeature","readGeometry","writeFeature","writeFeatures","writeGeometry","JSONFeature","getObject","parse","readFeatureFromObject","readFeaturesFromObject","readGeometryFromObject","readProjectionFromObject","stringify","writeFeatureObject","writeFeaturesObject","writeGeometryObject","GEOMETRY_READERS","getGeometryLayout","paths","GEOMETRY_WRITERS","esriJSON","hasZM","getHasZM","hasZ","hasM","EsriJSON","flatRing","outerRings","shift","matched","containsHole","convertRings","geometryReader","geometryWriter","esriJSONFeature","idField","attributes","esriJSONFeatures","objectIdFieldName","esriJSONObject","spatialReference","wkid","objects","DOCUMENT","implementation","createDocument","XML_SCHEMA_INSTANCE_URI","createElementNS","namespaceURI","qualifiedName","getAllTextContent","normalizeWhitespace","getAllTextContent_","accumulator","nodeType","Node","CDATA_SECTION_NODE","TEXT_NODE","nodeValue","firstChild","nextSibling","isDocument","Document","xml","makeArrayExtender","valueReader","objectStack","makeArrayPusher","makeReplacer","makeObjectPropertyPusher","opt_property","localName","makeObjectPropertySetter","makeChildAppender","nodeWriter","makeArraySerializer","serializersNS","nodeFactory","serializers","makeSimpleNodeFactory","serialize","opt_nodeName","opt_namespaceURI","fixedNodeName","nodeName","OBJECT_PROPERTY_NODE_FACTORY","makeSequence","orderedKeys","sequence","makeStructureNS","namespaceURIs","structure","opt_structureNS","structureNS","parseNode","parsersNS","nextElementSibling","parsers","parser","pushParseAndPop","opt_keys","pushSerializeAndPop","XMLFeature","xmlSerializer_","XMLSerializer","readFeatureFromDocument","readFeatureFromNode","doc","readFeaturesFromDocument","readFeaturesFromNode","ELEMENT_NODE","readGeometryFromDocument","readGeometryFromNode","readProjectionFromDocument","readProjectionFromNode","writeFeatureNode","serializeToString","writeFeaturesNode","writeGeometryNode","GMLNS","GMLBase","featureType","featureNS","srsName","schemaLocation","FEATURE_COLLECTION_PARSERS","featureMember","readFeaturesInternal","featureMembers","ONLY_WHITESPACE_RE","readBoolean","readBooleanString","string","readDateTime","dateTime","readDecimal","readDecimalString","readNonNegativeInteger","readNonNegativeIntegerString","readString","trim","writeBooleanTextNode","bool","writeStringTextNode","writeDecimalTextNode","toPrecision","writeNonNegativeIntegerTextNode","nonNegativeInteger","ft","uri","ns","featureTypes","readFeatureElement","readGeometryElement","getAttribute","GEOMETRY_PARSERS_","fid","getAttributeNS","test","readPoint","readFlatCoordinatesFromNode_","readMultiPoint","MULTIPOINT_PARSERS_","readMultiLineString","MULTILINESTRING_PARSERS_","readMultiPolygon","MULTIPOLYGON_PARSERS_","pointMemberParser_","POINTMEMBER_PARSERS_","lineStringMemberParser_","LINESTRINGMEMBER_PARSERS_","polygonMemberParser_","POLYGONMEMBER_PARSERS_","readLineString","readFlatLinearRing_","GEOMETRY_FLAT_COORDINATES_PARSERS_","readLinearRing","readPolygon","flatLinearRings","FLAT_LINEAR_RINGS_PARSERS_","http://www.opengis.net/gml","pointMember","pointMembers","lineStringMember","lineStringMembers","polygonMember","polygonMembers","RING_PARSERS","GML3","surface_","surface","curve_","curve","multiCurve_","multiCurve","multiSurface_","multiSurface","readMultiCurve_","MULTICURVE_PARSERS_","readMultiSurface_","MULTISURFACE_PARSERS_","curveMemberParser_","CURVEMEMBER_PARSERS_","surfaceMemberParser_","SURFACEMEMBER_PARSERS_","readPatch_","PATCHES_PARSERS_","readSegment_","SEGMENTS_PARSERS_","readPolygonPatch_","readLineStringSegment_","interiorParser_","flatLinearRing","exteriorParser_","readSurface_","SURFACE_PARSERS_","readCurve_","CURVE_PARSERS_","readEnvelope_","ENVELOPE_PARSERS_","readFlatPos_","re","containerSrs","readFlatPosList_","contextDimension","dim","posList","interior","exterior","Surface","MultiSurface","Curve","MultiCurve","Envelope","curveMember","curveMembers","surfaceMember","surfaceMembers","patches","lowerCorner","upperCorner","PolygonPatch","LineStringSegment","writePos_","srsDimension","getCoords_","opt_srsName","opt_hasZ","writePosList_","writePoint_","writeEnvelope","ENVELOPE_SERIALIZERS_","writeLinearRing_","RING_NODE_FACTORY_","exteriorWritten","writeSurfaceOrPolygon_","RING_SERIALIZERS_","writeSurfacePatches_","writeCurveOrLineString_","writeCurveSegments_","writeMultiSurfaceOrPolygon_","SURFACEORPOLYGONMEMBER_SERIALIZERS_","MULTIGEOMETRY_MEMBER_NODE_FACTORY_","writeMultiPoint_","POINTMEMBER_SERIALIZERS_","writeMultiCurveOrLineString_","LINESTRINGORCURVEMEMBER_SERIALIZERS_","writeRing_","writeSurfaceOrPolygonMember_","GEOMETRY_NODE_FACTORY_","writePointMember_","writeLineStringOrCurveMember_","writeGeometryElement","GEOMETRY_SERIALIZERS_","writeFeatureElement","writeFeatureMembers_","MULTIGEOMETRY_TO_MEMBER_NODENAME","setAttributeNS","GML","GML2","readFlatCoordinates_","proj","coordsGroups","readBox_","BOX_PARSERS_","innerBoundaryIsParser_","outerBoundaryIsParser_","createCoordinatesNode_","writeCoordinates_","innerBoundaryIs","outerBoundaryIs","Box","GPX","readExtensions_","readExtensions","NAMESPACE_URIS","FEATURE_READER","rte","readRte","trk","readTrk","wpt","readWpt","GPX_PARSERS","LINK_PARSERS","RTE_PARSERS","cmt","desc","link","parseLink","extensions","parseExtensions","rtept","RTEPT_PARSERS","rteValues","layoutOptions","ele","TRK_PARSERS","trkseg","TRKSEG_PARSERS","trkpt","TRKPT_PARSERS","trkValues","WPT_PARSERS","magvar","geoidheight","sym","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid","LINK_SEQUENCE","LINK_SERIALIZERS","RTE_SEQUENCE","RTE_SERIALIZERS","writeLink","writeWptType","RTEPT_TYPE_SEQUENCE","TRK_SEQUENCE","TRK_SERIALIZERS","geometryLayout","TRKSEG_SERIALIZERS","TRKSEG_NODE_FACTORY","WPT_TYPE_SEQUENCE","WPT_TYPE_SERIALIZERS","date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","GEOMETRY_TYPE_TO_NODENAME","GPX_NODE_FACTORY","GPX_SERIALIZERS","applyLayoutOptions","href","handleReadExtensions_","extensionsNode","featureReader","gpx","opt_geometries","geometries_","listenGeometriesChange_","cloneGeometries","clonedGeometries","unlistenGeometriesChange_","geometryCollection","setGeometries","simplifiedGeometries","simplified","simplifiedGeometryCollection","setGeometriesArray","GeoJSON","extractGeometryName_","extractGeometryName","rightHanded","geoJSONFeature","geometry_name","geoJSONFeatures","crs","TextFeature","readFeatureFromText","readFeaturesFromText","readGeometryFromText","readProjectionFromText","writeFeatureText","writeFeaturesText","writeGeometryText","IGCZ","IGC","altitudeMode_","altitudeMode","B_RECORD_RE","H_RECORD_RE","HFDTE_RECORD_RE","NEWLINE_RE","year","month","day","lastDateTime","hour","minute","second","UTC","IconImage","imageState_","tainting_","determineTainting_","dispatchChangeEvent_","replaceColor_","getSrc","imgData","putImageData","DEFAULT_COLOR","Icon","normalizedAnchor_","anchorOrigin_","anchorOrigin","IconOrigin","anchorXUnits_","anchorXUnits","IconAnchorUnits","anchorYUnits_","anchorYUnits","img","imgSize","iconImage_","offset_","offsetOrigin_","offsetOrigin","iconImageSize","DEFAULT_IMAGE_STYLE_ANCHOR","DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS","DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS","DEFAULT_IMAGE_STYLE_SIZE","DEFAULT_IMAGE_STYLE_SRC","DEFAULT_IMAGE_SCALE_MULTIPLIER","DEFAULT_NO_IMAGE_STYLE","DEFAULT_TEXT_STROKE_STYLE","DEFAULT_FILL_STYLE","DEFAULT_IMAGE_STYLE","DEFAULT_TEXT_STYLE","DEFAULT_STYLE","DEFAULT_STYLE_ARRAY","KML","defaultStyle_","defaultStyle","extractStyles_","extractStyles","writeStyles_","writeStyles","sharedStyles_","showPointNames_","showPointNames","GX_NAMESPACE_URIS","ICON_ANCHOR_UNITS_MAP","pixels","insetPixels","createNameStyleFunction","foundStyle","textOffset","imageScale","foundText","createFeatureStyleFunction","styleUrl","sharedStyles","nameStyle","drawName","findStyle","styleValue","readColor","hexColor","readFlatCoordinates","readURI","baseURI","location","URL","readScale","STYLE_MAP_PARSERS","Pair","pairObject","PAIR_PARSERS","readStyleMapValue","ICON_STYLE_PARSERS","iconObject","ICON_PARSERS","hotSpot","xunits","yunits","LABEL_STYLE_PARSERS","LINE_STYLE_PARSERS","POLY_STYLE_PARSERS","outline","FLAT_LINEAR_RING_PARSERS","readFlatLinearRing","GX_MULTITRACK_GEOMETRY_PARSERS","Track","readGxTrack","GX_TRACK_PARSERS","when","whens","coord","gxTrackObject","GEOMETRY_FLAT_COORDINATES_PARSERS","readFlatCoordinatesFromNode","EXTRUDE_AND_ALTITUDE_MODE_PARSERS","extrude","tessellate","MULTI_GEOMETRY_PARSERS","MultiGeometry","readMultiGeometry","multiGeometry","homogeneous","setCommonGeometryProperties","FLAT_LINEAR_RINGS_PARSERS","INNER_BOUNDARY_IS_PARSERS","OUTER_BOUNDARY_IS_PARSERS","STYLE_PARSERS","IconStyle","styleObject","IconObject","drawIcon","LabelStyle","LineStyle","PolyStyle","readStyle","hasExtrude","hasTessellate","hasAltitudeMode","extrudes","tessellates","altitudeModes","DATA_PARSERS","displayName","EXTENDED_DATA_PARSERS","Data","featureObject","SchemaData","SCHEMA_DATA_PARSERS","extendedDataParser","REGION_PARSERS","LatLonAltBox","LAT_LON_ALT_BOX_PARSERS","regionObject","Lod","LOD_PARSERS","lodObject","regionParser","SimpleData","minAltitude","maxAltitude","north","south","east","west","minLodPixels","maxLodPixels","minFadeExtent","maxFadeExtent","NETWORK_LINK_PARSERS","ExtendedData","Region","Link","address","description","phoneNumber","visibility","PLACEMARK_PARSERS","StyleMap","styleMapValue","placemarkObject","MultiTrack","writeColorTextNode","rgba","abgr","hex","readDocumentOrFolder_","Folder","Placemark","readPlacemark_","readSharedStyle_","readSharedStyleMap_","styleUri","fs","readName","readNameFromDocument","readNameFromNode","readNetworkLinks","networkLinks","readNetworkLinksFromDocument","readNetworkLinksFromNode","readRegion","regions","readRegionFromDocument","readRegionFromNode","EXTENDEDDATA_NODE_SERIALIZERS","pair","createCDATASection","DOCUMENT_SERIALIZERS","writePlacemark","DOCUMENT_NODE_FACTORY","DATA_NODE_FACTORY","ICON_SEQUENCE","ICON_SERIALIZERS","GX_NODE_FACTORY","ICON_STYLE_SEQUENCE","ICON_STYLE_SERIALIZERS","icon","vec2","writeScaleTextNode","LABEL_STYLE_SEQUENCE","LABEL_STYLE_SERIALIZERS","LINE_STYLE_SEQUENCE","LINE_STYLE_SERIALIZERS","GEOMETRY_NODE_FACTORY","POINT_NODE_FACTORY","LINE_STRING_NODE_FACTORY","LINEAR_RING_NODE_FACTORY","POLYGON_NODE_FACTORY","MULTI_GEOMETRY_SERIALIZERS","writePrimitiveGeometry","writePolygon","writeMultiGeometry","BOUNDARY_IS_SERIALIZERS","writeBoundaryIs","PLACEMARK_SERIALIZERS","namesAndValues","names","STYLE_SEQUENCE","STYLE_SERIALIZERS","PLACEMARK_SEQUENCE","EXTENDEDDATA_NODE_FACTORY","v","PRIMITIVE_GEOMETRY_SEQUENCE","PRIMITIVE_GEOMETRY_SERIALIZERS","POLYGON_SERIALIZERS","INNER_BOUNDARY_NODE_FACTORY","OUTER_BOUNDARY_NODE_FACTORY","POLY_STYLE_SERIALIZERS","COLOR_NODE_FACTORY","iconProperties","KML_SEQUENCE","KML_SERIALIZERS","kml","xmlnsUri","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","rt","Pbf","ArrayBuffer","isView","Varint","Fixed64","Bytes","Fixed32","SHIFT_LEFT_32","SHIFT_RIGHT_32","readPackedEnd","pbf","readVarint","toNum","isSigned","makeRoomForExtraLength","startPos","extraLen","realloc","writePackedVarint","writeVarint","writePackedSVarint","writeSVarint","writePackedFloat","writeFloat","writePackedDouble","writeDouble","writePackedBoolean","writeBoolean","writePackedFixed32","writeFixed32","writePackedSFixed32","writeSFixed32","writePackedFixed64","writeFixed64","writePackedSFixed64","writeSFixed64","readUInt32","writeInt32","readInt32","destroy","readFields","readField","tag","skip","readMessage","readFixed32","readSFixed32","readFixed64","readSFixed64","readFloat","ieee754","readDouble","readVarintRemainder","readVarint64","readSVarint","b3","b0","bytesPerSequence","fromCharCode","readUtf8","readBytes","subarray","readPackedVarint","readPackedSVarint","readPackedBoolean","readPackedFloat","readPackedDouble","readPackedFixed32","readPackedSFixed32","readPackedFixed64","readPackedSFixed64","writeTag","lsb","writeBigVarintHigh","writeBigVarint","writeString","lead","writeUtf8","writeBytes","writeRawMessage","writeMessage","writeBytesField","writeFixed32Field","writeSFixed32Field","writeFixed64Field","writeSFixed64Field","writeVarintField","writeSVarintField","writeStringField","writeFloatField","writeDoubleField","writeBooleanField","RenderFeature","flatCoordinates_","flatMidpoints_","properties_","midpoint","MVT","featureClass_","featureClass","layerName_","layerName","layers_","layersPBFReader","layerPBFReader","version","featurePBFReader","readRawFeature","readRawGeometry_","cmd","coordsLen","currentEnd","cmdLen","createFeature_","rawFeature","prevEndIndex","PBF","pbfLayers","pbfLayer","OSMXML","WAY_PARSERS","nd","ndrefs","readTag","PARSERS","tags","NODE_PARSERS","way","ways","flipXY","opt_destOffset","destOffset","Polyline","factor_","factor","geometryLayout_","encodeDeltas","numbers","opt_factor","lastNumbers","encodeFloats","decodeDeltas","encoded","decodeFloats","encodeUnsignedInteger","encodeUnsignedIntegers","encodeSignedIntegers","current","decodeUnsignedIntegers","decodeSignedIntegers","TopoJSON","transformVertex","arcs","concatenateArcs","polyArray","ringCoords","readFeaturesFromGeometryCollection","readFeatureFromGeometry","transformArc","topoJSONTopology","transformArcs","topoJSONFeatures","objectName","Filter","tagName_","getTagName","LogicalNary","conditions","And","Bbox","Spatial","Contains","Comparison","propertyName","During","ComparisonBinary","expression","opt_matchCase","matchCase","EqualTo","GreaterThan","GreaterThanOrEqualTo","Intersects","IsBetween","lowerBoundary","upperBoundary","IsLike","pattern","opt_wildCard","opt_singleChar","opt_escapeChar","wildCard","singleChar","escapeChar","IsNull","LessThan","LessThanOrEqualTo","Not","NotEqualTo","Or","Within","and","FEATURE_PREFIX","XMLNS","OGCNS","WFSNS","SCHEMA_LOCATIONS","1.1.0","1.0.0","WFS","featureType_","featureNS_","gmlFormat_","gmlFormat","schemaLocation_","getFeatureType","setFeatureType","readTransactionResponse","readTransactionResponseFromDocument","readTransactionResponseFromNode","readFeatureCollectionMetadata","readFeatureCollectionMetadataFromDocument","readFeatureCollectionMetadataFromNode","boundedBy","TRANSACTION_SUMMARY_PARSERS","http://www.opengis.net/wfs","totalInserted","totalUpdated","totalDeleted","OGC_FID_PARSERS","http://www.opengis.net/ogc","FeatureId","INSERT_RESULTS_PARSERS","TRANSACTION_RESPONSE_PARSERS","TransactionSummary","InsertResults","QUERY_SERIALIZERS","PropertyName","writeOgcFidFilter","getTypeName","featurePrefix","prefix","TRANSACTION_SERIALIZERS","Insert","gmlVersion","Update","typeName","Delete","Native","nativeElement","vendorId","safeToIgnore","GETFEATURE_SERIALIZERS","Query","propertyNames","writeFilterCondition","valueReference","timePeriod","writeTimeInstant","writeLogicalFilter","BBOX","writeOgcPropertyName","PropertyIsEqualTo","writeComparisonFilter","PropertyIsNotEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsNull","PropertyIsBetween","writeOgcLiteral","PropertyIsLike","writeOgcExpression","timeInstant","timePosition","writeGetFeature","handle","outputFormat","maxFeatures","resultType","bboxFilter","andFilter","writeTransaction","inserts","updates","deletes","baseObj","gmlOptions","nativeElements","EMPTY","Z","TokenType","Lexer","wkt","index_","isAlpha_","isNumeric_","opt_decimal","isWhiteSpace_","nextChar_","nextToken","token","readNumber_","readText_","scientificNotation","substring","toUpperCase","Parser","lexer","lexer_","token_","layout_","consume_","isTokenType","match","isMatch","parseGeometry_","parseGeometryLayout_","dimToken","dimInfo","parseGeometryCollectionText_","isEmptyGeometry_","formatErrorMessage_","parsePointText_","parsePoint_","parseLineStringText_","parsePointList_","parsePolygonText_","parseLineStringTextList_","parseMultiPointText_","parsePointTextList_","parseMultiLineStringText_","parseMultiPolygonText_","parsePolygonTextList_","dimensions","WKT","splitCollection_","splitCollection","encodePointGeometry","encodeLineStringGeometry","encodePolygonGeometry","GeometryEncoder","components","geoms","encode","enc","geometryEncoder","parse_","GeometryConstructor","LINESTRING","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","GeometryParser","geomType","NAMESPACE_URI","readHref","read","readFromDocument","readFromNode","WMSCapabilities","Service","SERVICE_PARSERS","Capability","CAPABILITY_PARSERS","Request","REQUEST_PARSERS","Exception","EXCEPTION_PARSERS","LAYER_PARSERS","Name","Title","Abstract","KeywordList","readKeywordList","OnlineResource","ContactInformation","CONTACT_INFORMATION_PARSERS","Fees","AccessConstraints","LayerLimit","MaxWidth","MaxHeight","ContactPersonPrimary","CONTACT_PERSON_PARSERS","ContactPosition","ContactAddress","CONTACT_ADDRESS_PARSERS","ContactVoiceTelephone","ContactFacsimileTelephone","ContactElectronicMailAddress","ContactPerson","ContactOrganization","AddressType","Address","City","StateOrProvince","PostCode","Country","Format","CRS","EX_GeographicBoundingBox","geographicBoundingBox","EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS","westBoundLongitude","southBoundLatitude","eastBoundLongitude","northBoundLatitude","BoundingBox","Dimension","unitSymbol","default","multipleValues","nearestValue","ATTRIBUTION_PARSERS","AuthorityURL","authorityObject","readFormatOnlineresource","Identifier","MetadataURL","metadataObject","DataURL","FeatureListURL","MinScaleDenominator","MaxScaleDenominator","parentLayerObject","layerObject","queryable","cascaded","opaque","noSubsets","fixedWidth","fixedHeight","childValue","parentValue","LogoURL","readSizedFormatOnlineresource","GetCapabilities","readOperationType","GetMap","GetFeatureInfo","OPERATIONTYPE_PARSERS","DCPType","DCPTYPE_PARSERS","HTTP","HTTP_PARSERS","Get","Post","LegendURL","StyleSheetURL","StyleURL","FORMAT_ONLINERESOURCE_PARSERS","KEYWORDLIST_PARSERS","Keyword","formatOnlineresource","wmsCapabilityObject","WMSGetFeatureInfo","readFeatures_","layerFeatures","gmlFeatures","OWS","ServiceIdentification","SERVICE_IDENTIFICATION_PARSERS","ServiceProvider","SERVICE_PROVIDER_PARSERS","OperationsMetadata","OPERATIONS_METADATA_PARSERS","ADDRESS_PARSERS","DeliveryPoint","AdministrativeArea","PostalCode","ElectronicMailAddress","ALLOWED_VALUES_PARSERS","Value","CONSTRAINT_PARSERS","AllowedValues","CONTACT_INFO_PARSERS","Phone","PHONE_PARSERS","DCP_PARSERS","REQUEST_METHOD_PARSERS","OPERATION_PARSERS","DCP","Operation","Voice","Facsimile","Constraint","SERVICE_CONTACT_PARSERS","IndividualName","PositionName","ContactInfo","ServiceTypeVersion","ServiceType","ProviderName","ProviderSite","ServiceContact","owsObject","WMTSCapabilities","owsParser_","OWS_NAMESPACE_URIS","Contents","CONTENTS_PARSERS","TileMatrixSet","TMS_PARSERS","isDefault","TileMatrixSetLink","TMS_LINKS_PARSERS","DIMENSION_PARSERS","ResourceURL","resourceType","resource","WGS84BoundingBox","WGS84_BBOX_READERS","legend","TileMatrixSetLimits","TMS_LIMITS_LIST_PARSERS","TileMatrixLimits","TMS_LIMITS_PARSERS","TileMatrix","MinTileRow","MaxTileRow","MinTileCol","MaxTileCol","LowerCorner","readCoordinates","UpperCorner","WellKnownScaleSet","TM_PARSERS","SupportedCRS","TopLeftCorner","ScaleDenominator","TileWidth","TileHeight","MatrixWidth","MatrixHeight","WMTSCapabilityObject","DEFAULT_GRADIENT","Heatmap","gradient","blur","shadow","weight","gradient_","shadow_","circleImage_","styleCache_","handleGradientChanged_","setGradient","setBlur","handleStyleChanged_","weightFunction","handleRender_","createCircle_","getBlur","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","toDataURL","getGradient","colors","createLinearGradient","step","addColorStop","createGradient","view8","ImageLayer","TileLayer","setPreload","setUseInterimTilesOnError","TileProperty","VectorTileLayer","opt_tileCoord","getKeyZXY","createFromTemplate","zRegEx","xRegEx","yRegEx","dashYRegEx","getFullTileRange","createFromTemplates","templates","tileUrlFunctions","createFromTileUrlFunctions","tileCoordHash","nullTileUrlFunction","expandUrl","urls","startCharCode","stopCharCode","stop","jsonp","opt_errback","opt_callbackParam","script","async","timer","getElementsByTagName","TileCache","calculateSourceResolution","targetProj","targetMetersPerUnit","sourceMetersPerUnit","sourceExtent","compensationFactor","isFinite","enlargeClipPoint","centroidX","centroidY","dX","dY","targetExtent","triangulation","sources","opt_renderEdges","sourceDataExtent","canvasWidthInUnits","canvasHeightInUnits","stitchContext","stitchScale","xPos","yPos","srcWidth","srcHeight","targetTopLeft","getTriangles","triangle","u0","v0","u1","u2","sourceNumericalShiftX","sourceNumericalShiftY","affineCoefs","maxRow","maxEl","absValue","coef","solveLinearSystem","pruneExceptNewestZ","Triangulation","maxSourceExtent","errorThreshold","sourceProj_","targetProj_","transformInvCache","transformInv","transformInv_","maxSourceExtent_","errorThresholdSquared_","triangles_","wrapsXInSource_","canWrapXInSource_","sourceWorldWidth_","targetWorldWidth_","destinationTopLeft","destinationTopRight","destinationBottomRight","destinationBottomLeft","sourceTopLeft","sourceTopRight","sourceBottomRight","sourceBottomLeft","addQuad_","leftBound","newTriangle","addTriangle_","aSrc","bSrc","cSrc","dSrc","maxSubdivision","sourceQuadExtent","sourceCoverageX","sourceWorldWidth","wrapsX","needsSubdivision","centerSrc","bc","bcSrc","da","daSrc","ab","abSrc","cd","cdSrc","calculateSourceExtent","ReprojTile","targetTileGrid","getTileFunction","opt_errorThreshold","renderEdges_","gutter_","sourceTileGrid_","targetTileGrid_","wrappedTileCoord_","sourceTiles_","sourcesListenerKeys_","sourceZ_","maxTargetExtent","limitedTargetExtent","sourceProjExtent","errorThresholdInPixels","triangulation_","sourceRange","srcX","srcY","unlistenSources_","reproject_","renderReprojected","leftToLoad","sourceListenKey","TileGrid","opt_strict","currentVal","origins","origins_","tileSizes_","tileSizes","tileSize_","fullTileRanges_","sizes","calculateTileRanges_","tmpTileCoord","getForProjection","createForProjection","createForExtent","opt_maxZoom","opt_tileSize","opt_corner","corner","Corner","resolutionsFromExtent","createXYZ","extentFromProjection","half","forEachTileCoord","opt_tileRange","tileCoordExtent","createOrUpdateTileRange","getTileCoordForXYAndZ_","getTileCoordForCoordAndResolution","getTileCoordForXYAndResolution_","reverseIntersectionPolicy","adjustX","adjustY","xFromOrigin","yFromOrigin","tileCoordX","tileCoordY","createOrUpdateTileCoord","getTileCoordForCoordAndZ","getTileCoordResolution","fullTileRanges","TileSource","opaque_","tilePixelRatio_","tileCache","tmpSize","tileOptions","getTileCacheForProjection","setKey","thisProj","scaleSize","getTileCoordForTileUrlFunction","worldsAway","withinExtentAndZ","TileSourceEvent","UrlTile","tileUrlFunction","fixedTileUrlFunction","setUrls","setUrl","setTileUrlFunction","tileLoadingKeys_","getTileLoadFunction","getTileUrlFunction","getUrls","TileEventType","setTileLoadFunction","opt_key","TileImage","defaultTileLoadFunction","tileClass","tileCacheForProjection","tileGridForProjection","reprojectionErrorThreshold_","reprojectionErrorThreshold","renderReprojectionEdges_","imageTile","usedTileCache","getGutterInternal","projKey","createTile_","urlTileCoord","tileUrl","newTile","getTileInternal","setRenderReprojectionEdges","setTileGridForProjection","tilegrid","BingMaps","hidpi_","hidpi","culture_","culture","maxZoom_","apiKey_","imagerySet_","imagerySet","requestJSONP","handleImageryMetadataResponse","getApiKey","getImagerySet","response","statusCode","statusDescription","authenticationResultCode","resourceSets","resources","zoomMax","zoomMin","imageUrlSubdomains","subdomain","quadKeyTileCoord","imageUrl","digits","quadKey","imageryProviders","imageryProvider","intersecting","coverageAreas","coverageArea","CartoDB","account_","account","mapId_","config_","config","templateCache_","initializeMap_","getConfig","updateConfig","setConfig","paramHash","applyTemplate_","mapUrl","client","handleInitResponse_","handleInitError_","setRequestHeader","tilesUrl","cdn_url","https","layergroupid","Cluster","cluster","setDistance","mapDistance","clustered","neighbors","neighbor","createCluster","ReprojImage","getImageFunction","targetResolution_","targetExtent_","sourceImage_","sourcePixelRatio_","sourceListenerKey_","unlistenSource_","ImageSourceEventType","ImageSourceEvent","ImageSource","reprojectedImage_","reprojectedRevision_","defaultImageLoadFunction","appendParams","keyParams","encodeURIComponent","qs","findNearestResolution","getImageInternal","handleImageChange","ImageArcGISRest","params_","ratio_","getParams","F","FORMAT","TRANSPARENT","halfWidth","halfHeight","getRequestUrl_","getImageLoadFunction","srid","modifiedUrl","setImageLoadFunction","updateParams","ImageCanvasSource","canvasFunction_","canvasFunction","canvasElement","ImageMapGuide","displayDpi_","displayDpi","useOverlay_","useOverlay","baseUrl","dpi","mcsW","mcsH","devW","devH","mpp","baseParams","OPERATION","VERSION","LOCALE","CLIENTAGENT","CLIP","SETDISPLAYDPI","SETDISPLAYWIDTH","SETDISPLAYHEIGHT","SETVIEWSCALE","SETVIEWCENTERX","SETVIEWCENTERY","Static","targetWidth","DEFAULT_WMS_VERSION","ImageWMS","v13_","updateV13_","serverType_","GETFEATUREINFO_IMAGE_SIZE","getGetFeatureInfoUrl","projectionObj","sourceProjectionObj","SERVICE","REQUEST","QUERY_LAYERS","viewExtent","requestExtent","WMSServerType","ATTRIBUTION","OSM","hasImageData","ImageData","_","newImageData","createImageData","createMinion","operation","workerHasImageData","buffers","meta","imageOps","numBuffers","numBytes","byteLength","Uint8ClampedArray","arrays","createWorker","onMessage","lib","blob","Blob","createObjectURL","worker","Worker","Processor","threads","_imageOps","minion","workers","_onWorkerMessage","postMessage","_workers","_queue","_maxQueueLength","queue","_running","_dataLookup","_job","process","inputs","_enqueue","_dispatch","_destroyed","job","slices","_resolveJob","RasterEventType","RasterOperationType","RasterSourceEvent","RasterSource","worker_","operationType_","operationType","threads_","renderers_","createRenderers","requestedFrameState_","renderedImageCanvas_","setOperation","opt_lib","updateFrameState_","allSourcesReady_","ready","processSources_","imageDatas","onWorkerComplete_","sharedContext","ATTRIBUTIONS","OSM_ATTRIBUTION","LayerConfig","terrain","terrain-background","terrain-labels","terrain-lines","toner-background","toner","toner-hybrid","toner-labels","toner-lines","toner-lite","watercolor","ProviderConfig","Stamen","provider","providerConfig","layerConfig","TileArcGISRest","tmpExtent_","getKeyForParams_","LabeledTile","strokeRect","TileDebug","textTileCoord","TileJSON","tileJSON_","handleTileJSONResponse","handleTileJSONError","onXHRLoad_","onXHRError_","tileJSON","getTileJSON","bounds","minzoom","maxzoom","attributionExtent","TileWMS","transparent","bufferSize","CustomTile","preemptive","preemptive_","grid_","data_","jsonp_","getData","xRelative","yRelative","row","forDataAtCoordinate","opt_request","loadInternal_","handleError_","json","grid","UTFGrid","tileUrlFunction_","template_","getTemplate","forDataAtCoordinateAndResolution","grids","VectorImageTile","sourceTiles","replayState_","sourceRevision_","loadListenerKeys_","sourceTileListenerKeys_","sourceZ","useLoadedOnly","loadCount","sourceTileKey","finishLoading_","defaultLoadFunction","errorSourceTiles","empty","tileGrids_","WMTSTileGrid","matrixIds_","matrixIds","createFromCapabilitiesMatrixSet","matrixSet","opt_matrixLimits","matrixLimits","matrixIdsPropName","identifierPropName","scaleDenominatorPropName","topLeftCornerPropName","switchOriginXY","elt","elt_ml","tileWidth","tileHeight","getMatrixId","getMatrixIds","WMTS","version_","dimensions_","matrixSet_","requestEncoding_","requestEncoding","WMTSRequestEncoding","tilematrixset","Version","createFromWMTSTemplate_","localContext","TileCol","TileRow","getKeyForDimensions_","getDimensions","getMatrixSet","getRequestEncoding","getVersion","updateDimensions","TierSizeCalculation","zoomifyImage_","Zoomify","tierSizeCalculation","tierSizeInTiles","tileSizeForTierSizeCalculation","tileCountUpToTier","tileCoordZ","tileIndex","TileGroup","ZoomifyTileClass","ol","colorlike","featureloader","loadingstrategy","proj4","webgl","sphere","$ol$Collection","$ol$Feature","$ol$Geolocation","$ol$Graticule","$ol$Kinetic","$ol$Map","$ol$Object","$ol$Observable","unByKey","$ol$Overlay","$ol$PluggableMap","$ol$View","$ol$WebGLMap","_ol_color.asArray","_ol_color.asString","_ol_colorlike.asColorLike","$ol$control$Attribution","_ol_control_Attribution.render","$ol$control$Control","$ol$control$FullScreen","$ol$control$MousePosition","_ol_control_MousePosition.render","$ol$control$OverviewMap","_ol_control_OverviewMap.render","$ol$control$Rotate","_ol_control_Rotate.render","$ol$control$ScaleLine","_ol_control_ScaleLine.render","$ol$control$Zoom","$ol$control$ZoomSlider","_ol_control_ZoomSlider.render","$ol$control$ZoomToExtent","_ol_control.defaults","_ol_coordinate.add","createStringXY","_ol_coordinate.format","_ol_coordinate.rotate","toStringHDMS","_ol_coordinate.toStringXY","_ol_easing.easeIn","_ol_easing.easeOut","_ol_easing.inAndOut","_ol_easing.linear","upAndDown","_ol_events_condition.altKeyOnly","_ol_events_condition.altShiftKeysOnly","_ol_events_condition.always","click","doubleClick","activeElement","_ol_events_condition.mouseOnly","_ol_events_condition.never","_ol_events_condition.noModifierKeys","platformModifierKeyOnly","_ol_events_condition.pointerMove","_ol_events_condition.primaryAction","_ol_events_condition.shiftKeyOnly","_ol_events_condition.singleClick","_ol_events_condition.targetNotEditable","_ol_extent.applyTransform","_ol_extent.boundingExtent","_ol_extent.buffer","_ol_extent.containsCoordinate","_ol_extent.containsExtent","_ol_extent.containsXY","_ol_extent.createEmpty","_ol_extent.equals","_ol_extent.extend","_ol_extent.getArea","_ol_extent.getBottomLeft","_ol_extent.getBottomRight","_ol_extent.getCenter","_ol_extent.getHeight","_ol_extent.getIntersection","_ol_extent.getTopLeft","_ol_extent.getTopRight","_ol_extent.getWidth","_ol_extent.intersects","_ol_extent.isEmpty","_ol_featureloader.xhr","$ol$format$EsriJSON","$ol$format$Feature","$ol$format$GML","$ol$format$GML2","$ol$format$GML3","$ol$format$GPX","$ol$format$GeoJSON","$ol$format$IGC","$ol$format$KML","$ol$format$MVT","$ol$format$OSMXML","$ol$format$Polyline","_ol_format_Polyline.decodeDeltas","_ol_format_Polyline.decodeFloats","_ol_format_Polyline.encodeDeltas","_ol_format_Polyline.encodeFloats","$ol$format$TopoJSON","$ol$format$WFS","writeFilter","$ol$format$WKT","$ol$format$WMSCapabilities","$ol$format$WMSGetFeatureInfo","$ol$format$WMTSCapabilities","$ol$format$filter$Bbox","$ol$format$filter$Contains","$ol$format$filter$During","$ol$format$filter$EqualTo","$ol$format$filter$GreaterThan","$ol$format$filter$GreaterThanOrEqualTo","$ol$format$filter$Intersects","$ol$format$filter$IsBetween","$ol$format$filter$IsLike","$ol$format$filter$IsNull","$ol$format$filter$LessThan","$ol$format$filter$LessThanOrEqualTo","$ol$format$filter$Not","$ol$format$filter$NotEqualTo","$ol$format$filter$Or","$ol$format$filter$Within","_ol_format_filter.and","_ol_format_filter.bbox","between","during","equalTo","greaterThan","greaterThanOrEqualTo","isNull","lessThan","lessThanOrEqualTo","like","not","notEqualTo","or","within","$ol$geom$Circle","$ol$geom$Geometry","$ol$geom$GeometryCollection","$ol$geom$LineString","$ol$geom$LinearRing","$ol$geom$MultiLineString","$ol$geom$MultiPoint","$ol$geom$MultiPolygon","$ol$geom$Point","$ol$geom$Polygon","_ol_geom_Polygon.circular","_ol_geom_Polygon.fromCircle","_ol_geom_Polygon.fromExtent","$ol$geom$SimpleGeometry","_ol_has.DEVICE_PIXEL_RATIO","_ol_has.GEOLOCATION","_ol_has.TOUCH","WEBGL","_ol_has.WEBGL","_ol.inherits","$ol$interaction$DoubleClickZoom","$ol$interaction$DragAndDrop","$ol$interaction$DragBox","$ol$interaction$DragPan","$ol$interaction$DragRotate","$ol$interaction$DragRotateAndZoom","$ol$interaction$DragZoom","$ol$interaction$Draw","createBox","createRegularPolygon","_ol_interaction_Draw.handleEvent","Extent","$ol$interaction$Extent","$ol$interaction$Interaction","$ol$interaction$KeyboardPan","$ol$interaction$KeyboardZoom","$ol$interaction$Modify","$ol$interaction$MouseWheelZoom","$ol$interaction$PinchRotate","$ol$interaction$PinchZoom","Pointer","$ol$interaction$Pointer","_ol_interaction_Pointer.handleEvent","$ol$interaction$Select","$ol$interaction$Snap","$ol$interaction$Translate","_ol_interaction.defaults","Base","$ol$layer$Base","Group","$ol$layer$Group","$ol$layer$Heatmap","$ol$layer$Image","$ol$layer$Layer","$ol$layer$Tile","Vector","$ol$layer$Vector","$ol$layer$VectorTile","_ol_loadingstrategy.all","$ol$proj$Projection","_ol_proj_Units.METERS_PER_UNIT","_ol_proj.addCoordinateTransforms","_ol_proj.addEquivalentProjections","_ol_proj.addProjection","_ol_proj.equivalent","fromLonLat","_ol_proj.get","_ol_proj.getPointResolution","_ol_proj.getTransform","projCodes","defs","def","axis","to_meter","code1","proj1","code2","proj2","toLonLat","lonLat","_ol_proj.transform","_ol_proj.transformExtent","$ol$render$VectorContext","_ol_render_canvas.labelCache","toContext","$ol$renderer$canvas$ImageLayer","$ol$renderer$canvas$Map","$ol$renderer$canvas$TileLayer","$ol$renderer$canvas$VectorLayer","$ol$renderer$canvas$VectorTileLayer","$ol$renderer$webgl$ImageLayer","$ol$renderer$webgl$Map","$ol$renderer$webgl$TileLayer","$ol$renderer$webgl$VectorLayer","_ol_size.toSize","$ol$source$BingMaps","$ol$source$CartoDB","$ol$source$Cluster","$ol$source$Image","$ol$source$ImageArcGISRest","$ol$source$ImageCanvas","$ol$source$ImageMapGuide","ImageStatic","$ol$source$ImageStatic","$ol$source$ImageWMS","$ol$source$OSM","_ol_source_OSM.ATTRIBUTION","Raster","$ol$source$Raster","$ol$source$Source","$ol$source$Stamen","$ol$source$Tile","$ol$source$TileArcGISRest","$ol$source$TileDebug","$ol$source$TileImage","$ol$source$TileJSON","$ol$source$TileWMS","$ol$source$UTFGrid","$ol$source$Vector","$ol$source$VectorTile","$ol$source$WMTS","optionsFromCapabilities","wmtsCap","tileMatrixSets","supportedCRS","matrixSetObj","projConfig","wgs84BoundingBox","wgs84ProjectionExtent","gets","encodings","$ol$source$XYZ","$ol$source$Zoomify","_ol_sphere.getDistance","$ol$style$AtlasManager","$ol$style$Circle","$ol$style$Fill","$ol$style$Icon","_ol_style_IconImageCache.shared","$ol$style$Image","$ol$style$RegularShape","$ol$style$Stroke","$ol$style$Style","$ol$style$Text","$ol$tilegrid$TileGrid","$ol$tilegrid$WMTS","_ol_tilegrid_WMTS.createFromCapabilitiesMatrixSet","_ol_tilegrid.createXYZ","_ol_xml.getAllTextContent","_ol_xml.parse"],"mappings":"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"}